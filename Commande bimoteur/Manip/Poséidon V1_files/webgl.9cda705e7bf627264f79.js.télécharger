"use strict";(self.webpackChunkNewton=self.webpackChunkNewton||[]).push([[327],{733733:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.CullFace=void 0,function(e){e[e.BACK=0]="BACK",e[e.FRONT=1]="FRONT",e[e.NONE=-1]="NONE",e[e.UNSPECIFIED=-2]="UNSPECIFIED"}(i||(t.CullFace=i={}))},690279:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CursorAppendageLeader=void 0;const s=i(114924),n=i(683067),r=i(32620);class a extends s.CursorAppendage{constructor(){super(...arguments),this.APPENDAGE_ID="cursor-appendage-leader"}addListeners(){const e=this.viewer.getEventDispatcher();this.listenTo(e,n.FOLLOW_MODE_LEADER_MOUSE_MOVED,this.updatePosition),this.listenTo(e,n.FOLLOW_MODE_LEADER_MOUSE_OUT,this.onMouseLeave),this.listenTo(e,n.FOLLOW_MODE_DEACTIVATED,this.removeContainer)}updatePosition(e){const t=(0,r.getDevicePixelRatio)(),i=e.map((e=>e*t));super.updatePosition(i)}}t.CursorAppendageLeader=a},772068:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsWebAssemblyUtils=void 0;const s=i(719347),n=i(606544),r=i(705149);class a extends r.WebAssemblyModule{constructor(){super("/js/GraphicsWebAssemblyUtils.js","createGraphicsUtilsModule")}static get module(){return a.singleton||(a.singleton=new a),a.singleton}replaySampleMeshRefinementRoutine(e,t){const i=new s.Timer("GraphicsWebAssemblyUtils.replaySampleMeshRefinementRoutine"),r=this.copyFloat32ArrayToWasmHeap(e.points),a=this.copyInt32ArrayToWasmHeap(e.intIndices),o=this.copyTypedUint8ArrayToWasmHeap(t.history),c=this.module.replaySampleMeshRefinementRoutine(r,e.points.length,a,e.intIndices.length,o,t.recordCount),l=new n.BTSampleMesh;return l.points=this.copyFloat32ArrayFromWasmHeap(c.getPointsLocation(),c.getPointsSize()),l.intIndices=this.copyInt32ArrayFromWasmHeap(c.getIndicesLocation(),c.getIndicesSize()),this.free(r),this.free(a),this.free(o),c.delete(),i.report(),l}}t.GraphicsWebAssemblyUtils=a},376278:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},53538:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},516847:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},559008:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Text2D=void 0;const s=i(736234),n=i(114924),r=i(32620),a=i(264292),o=i(613199);class c extends n.UIElement{constructor(e,t,i){super(e,n.HUD_SCENEGRAPH_ID),this.text=t,this.options=i,this.texture=null,this.material=(0,n.createTextureMaterial)(),this.nodeProperties=new n.NodeProperties({isPickable:!0,primitiveType:n.PrimitiveType.TRIANGLES,material:this.material}),this.updateWithOptions(i)}hasEqualTextAndOptions(e,t){return this.text===e&&(0,s.isEqual)(this.options,t)}remove(){super.remove(),this.texture.destroy(),this.material.destroy()}updateWithOptions(e){this.texture=(0,n.createTextureFromText)(this.viewer,this.text,e),this.material.ambientTexture=this.texture;const t=this.texture.createTexturedQuad();this.bounds=t.getBounds(),this.options=e,this.updateMeshIncrement("text",c.SELECTION_ID,t,this.nodeProperties),this.updatePosition()}getDiagonalVector(e){return this.bounds.diagonalVector(e)}positionRelativeTo(e,t,i){this.anchorPoint=a.vec3.clone(e),this.textAttachmentSpotX=t,this.textAttachmentSpotY=i,this.updatePosition()}updatePosition(){if(this.anchorPoint){const e=n.BoundingSpot.LOW,t=this.bounds.getLocationInBox(this.textAttachmentSpotX,this.textAttachmentSpotY,e);this.setTransform(o.mat4C.translate(a.mat4.create(),o.vec3C.subtract(this.anchorPoint,t,t)))}}getTextCenterInCanvas(){const e=this.bounds.createTransformedCopy(this.transform).center(),t=this.viewer.getCamera(),i=(0,r.getDevicePixelRatio)();return[e[0]/i,(t.getCanvasHeight()-e[1])/i]}getTransformedBounds(){return this.bounds.createTransformedCopy(this.transform)}}t.Text2D=c,c.SELECTION_ID="text"},204151:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ActionSetController=t.ActionIds=void 0;const s=i(142885),n=i(997687),r=i(606544),a=i(114924),o=i(681459);t.ActionIds={ASSEMBLY:"Assembly",PART_STUDIO:"Part Studio",SKETCH:"Sketch",UNSUPPORTED:"Default"};class c extends s.BackboneEventsBaseClass{constructor(e){super(),this.commands={},this.spaceBallConnection=e}startListeningToEvents(){this.listenTo((0,a.getActiveViewerEventDispatcher)(),a.SPACEMOUSE_ACTION_SET_CHANGED,this.setActiveCommandSet),this.listenTo((0,a.getActiveViewerEventDispatcher)(),a.SPACEMOUSE_COMMAND,this.executeCommand),this.listenTo((0,a.getActiveViewerEventDispatcher)(),a.SPACEMOUSE_COMMANDS_RECEIVED,this.commandSetReceived)}stopListeningToEvents(){this.stopListening()}setActiveCommandSet(e){this.spaceBallConnection.update3dcontroller({commands:{activeSet:e}})}commandSetReceived(e){const i=new _3Dconnexion.ActionTree,s=new _3Dconnexion.ImageCache,n=this;for(let t=0;t<e.length;t++){const n=e[t],a=n.tabType,o=i.push(new _3Dconnexion.ActionSet(a,"")).push(new _3Dconnexion.Category("Action_Id_"+a,"Commands"));for(let e=0;e<n.commands.length;e++){const t=n.commands[e];let i=t.command,c=t.icon?"/images/"+t.icon+".svg":"";(this.commands[i]||n.tabId===r.GBTElementType.PARTSTUDIO&&"mateConnector"===t.command)&&(i=a+"-"+t.command),(t.command.indexOf("mate")>-1||t.command.indexOf("Mate")>-1)&&"mateConnector"!==t.command&&(t.icon&&(c="/images/mate/"+t.icon+".svg"),i=t.command+"_"+t.commandDetails),"load"===t.command&&(i=t.command+"_"+t.commandDetails),o.push(new _3Dconnexion.Action(i,i18n(t.name),"")),this.commands[i]=t,c&&s.push(_3Dconnexion.ImageItem.fromURL(c,i))}}i.push(new _3Dconnexion.ActionSet(t.ActionIds.UNSUPPORTED,"")),s.onload=function(){n.spaceBallConnection.update3dcontroller({images:s.images})};let a=t.ActionIds.UNSUPPORTED;(0,o.isInAssemblyElement)()?a=t.ActionIds.ASSEMBLY:(0,o.isInPartStudioElement)()&&(a=t.ActionIds.PART_STUDIO),this.spaceBallConnection.update3dcontroller({commands:{activeSet:a,tree:i}})}executeCommand(e){this.commands[e]&&n.btInjector.SpaceballService.executeCommand(this.commands[e])}}t.ActionSetController=c},918228:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;t.Manager=class{constructor(){this.activeMateConnectorMap=new Map}addMateConnector(e){e&&e.length>0&&this.activeMateConnectorMap.set(e,null)}removeMateConnector(e){if(e&&e.length>0&&this.activeMateConnectorMap.has(e)){const t=this.activeMateConnectorMap.get(e);this.activeMateConnectorMap.delete(e),t&&!t.isHidden&&t.muteIfActive()}}removeAllMateConnectors(){for(const e of this.activeMateConnectorMap.keys())this.removeMateConnector(e)}resetMateConnectors(e){this.removeAllMateConnectors();for(const t of e)this.addMateConnector(t)}isMateConnectorActive(e,t){const i=this.activeMateConnectorMap.has(e);return i&&!this.activeMateConnectorMap.get(e)&&this.activeMateConnectorMap.set(e,t),i}destroy(){this.removeAllMateConnectors()}}},368207:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createAngularToolPreview=t.AngularToolPreview=void 0;const s=i(264292),n=i(736234),r=i(114924),a=i(613199);class o extends r.ToolDisplay{constructor(e,t){super(e,t),this.axisDirection=null,this.axisRoot=null,this.angle=0}setAngle(e){this.update(null,e)}update(e,t,i,s){return!(e&&!(0,n.isEqual)(e,this.sourceIds))&&(t&&(this.angle=t),i&&(this.axisRoot=i),s&&(this.axisDirection=s),this.updateMeshes())}updateMeshes(){let e,t,i,n,o;const c=a.quat4C.fromAngleAxis(this.angle,this.axisDirection,s.quat.create());for(let l=0;l<this.sourceIds.length;++l){for(e=this.sourcePrimitives[l],t=this.duplicatePrimitive(e),i=this.sourceIds[l],n=0;n<e.points.length;n+=3){const i=s.vec3.fromValues(e.points[n],e.points[n+1],e.points[n+2]);for(a.vec3C.subtract(i,this.axisRoot),a.quat4C.multiplyVec3(c,i),a.vec3C.add(i,this.axisRoot),o=0;o<3;++o)t.points[n+o]=i[o]}t.isTriangles()?this.updateMeshIncrement(i,r.NO_SELECTION_ID,t,r.TOOL_FACE_PROPERTIES):this.updateMeshIncrement(i,r.NO_SELECTION_ID,t,r.TOOL_EDGE_PROPERTIES)}return!0}}t.AngularToolPreview=o,t.createAngularToolPreview=function(e,t,i,s,n,r){const a=new o(r,e);return a.axisRoot=s,a.axisDirection=n,a.angle=i,a.initialize(t)?a:null}},921183:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationController=void 0;const s=i(912057),n=i(114924),r=i(514313);t.AnimationController=class{constructor(e){this.viewer=e,this.cameraAnimationCallback=null,this.animationLoopInProgress=!1,this.animationSequenceCounter=0,this.animationSequenceStartTime=0,this.animationSequenceFrameCount=0,this.frameCallback=e=>this.onRequestDrawFulfilled(e),this.ongoingAnimations=new Set,this.incrementAnimationSequence()}onRequestDrawFulfilled(e){if(this.viewer.isOngoingRenderLoopRunning)return;const t=this.advanceAnimation(e);this.viewer.draw(t?e:void 0)}advanceAnimation(e){if(!this.animationLoopInProgress)return!1;let t=!1;if(this.cameraAnimationCallback){this.cameraAnimationCallback(e)===r.AnimationCallbackStatus.COMPLETE?this.cameraAnimationCallback=null:t=!0}for(const i of this.ongoingAnimations.values()){i(e)===r.AnimationCallbackStatus.COMPLETE?this.ongoingAnimations.delete(i):t=!0}if(t)this.viewer.setSystemIsAnimating(),this.viewer.isOngoingRenderLoopRunning||this.viewer.requestDraw(this.frameCallback),++this.animationSequenceFrameCount;else if(this.animationLoopInProgress=!1,this.incrementAnimationSequence(),this.viewer.setSuppressMouseMovePick(!1),this.viewer.isOngoingRenderLoopRunning||this.viewer.getInputHandler().isMouseInCanvas()&&this.viewer.doPreHighlightPick(),this.animationSequenceFrameCount>0){const e=(this.animationSequenceFrameCount/((0,n.getTimeElapsed)(this.animationSequenceStartTime)/1e3)).toFixed(1);s.log.trace("Animation completed with average framerate of "+e+" fps")}return t}requestAnimationFrameIfNeeded(){this.animationLoopInProgress&&!this.viewer.isOngoingRenderLoopRunning&&this.viewer.requestDraw(this.frameCallback)}startCameraAnimation(e){this.haltCameraAnimation(),this.cameraAnimationCallback=e,this.startAnimationRenderLoop()}isCameraAnimating(){return!!this.cameraAnimationCallback}haltCameraAnimation(){this.cameraAnimationCallback=null}startAnimation(e){this.ongoingAnimations.add(e),this.startAnimationRenderLoop()}incrementAnimationSequence(){this.viewer.$el.attr("animation-sequence",++this.animationSequenceCounter)}startAnimationRenderLoop(){this.animationLoopInProgress||(this.viewer.setSuppressMouseMovePick(!0),this.viewer.setSystemIsAnimating(),this.viewer.isOngoingRenderLoopRunning||this.viewer.requestDraw(this.frameCallback),this.animationLoopInProgress=!0,this.animationSequenceStartTime=(0,n.getTimeInMilliseconds)(),this.animationSequenceFrameCount=0)}}},178651:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyIsolateManager=void 0;const s=i(7401),n=i(905898),r=i(114924);class a extends r.AssemblyIsolateManagerBase{setUpListeners(){super.setUpListeners(),this.listenTo((0,n.getCommandDispatcher)(),s.commands.EXIT_ISOLATE,this.clearEffectExit),this.listenTo((0,n.getCommandDispatcher)(),s.commands.ISOLATE_COMPONENTS,this.affectComponents)}clearIsolateNoAnimation(){this.clearEffectNoAnimation()}hasIsolatedInstances(){return this.hasAffectedInstances()}areSelectionsAlreadyIsolated(e){return this.areSelectionsAlreadyAffected(e)}areSelectionsInListAlreadyIsolated(e){return this.areSelectionsInListAlreadyAffected(e)}isInIsolateMode(){return this.isInEffectMode()}addIdsToIsolate(e,t){this.addIdsToAffect(e,t)}removeFromIsolate(e){this.removeFromEffect(e)}isolateOccurrences(e,t){this.affectOccurrences(e,t)}getIsolatedOccurrences(){return this.getAffectedOccurrences()}setIsolatedOccurrenceIds(e){this.setAffectedOccurrenceIds(e)}clearEffect(){this.setSeedComponentsNull(),this.setIsolationForRelatedGraphics(this.affectedOccurrences,!1),this.setInitialAffectedOccurrences([])}shouldAddPreexistingOccurrences(){return!1}shouldClearOccurrenceIds(){return this.hasAffectedInstances()}resetIsolationForRelatedGraphics(e){this.setIsolationForRelatedGraphics(this.affectedOccurrences,!1),this.setIsolationForRelatedGraphics(e,!0)}showDialog(){this.dialog?this.dialog.onAssemblyOrPartStudioDataProcessed():this.dialog=r.IsolatedManagersUtils.createIsolateDialog(this)}updateOccurrenceDataManager(){r.IsolatedManagersUtils.updateOccurrenceDataManager(this.affectedOccurrenceIds,this.viewer.getOccurrenceDataManager())}}t.AssemblyIsolateManager=a},571541:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyIsolateManagerBase=void 0;const s=i(7401),n=i(905898),r=i(196207),a=i(681459),o=i(193786),c=i(723617),l=i(114924),h=i(736234),d=function(e){return e.getPathAsString()};function u(e,t,i,s){const n={};function r(e){const t=e.trimToTopLevel();return n[t.getPathAsString()]=t,!1}Array.isArray(e)?e.forEach(r):e&&e.each(r);for(const e in n){const r=n[e],a=t.getOccurrencesStartingWithPath(r);for(let e=0;e<a.length;++e){const t=a[e].getPathAsString();i.hasOwnProperty(t)||(i[t]=a[e],s.set(t,a[e]))}}}class g extends l.IsolatedManagerBase{constructor(e,t){super(e,t),this.initialAffectedOccurrences=[],this.affectedOccurrences=[],this.setSeedComponentsNull()}setUpListeners(){this.stopListening(),this.listenTo(this.viewer.getEventDispatcher(),l.ASSEMBLY_DATA_PROCESSED,this.onAssemblyDataProcessed)}setSeedComponentsNull(){this.nodeModelOrSelection=null,this.includeSelections=!1,this.initialSelectionList=null}onAssemblyDataProcessed(){this.hasAffectedInstances()&&(0,a.isInAssemblyElement)()&&this.reAffectComponents(l.IsolateFlag.ASSEMBLY_DATA_UPDATE,!1)}setIsolationForRelatedGraphics(e,t){const i=this.getModelViewManager().getDisplayedAssembly();if(i)for(const s of e){const e=i.getMateConnectorGraphicsForOccurrence(s,false);for(let i=0;i<e.length;i++)e[i].getOccurrenceData().setIsolated(t);const n=i.getMateIndicatorsForOccurrence(s,false);for(let e=0;e<n.length;e++)n[e].setIsolated(t);const r=i.getSketchImagesForOccurrence(s);for(let e=0;e<r.length;++e)r[e].setIsolated(t)}}affectComponents(e,t,i,s,n){this.viewer===s&&(i&&0!==i.length?this.reaffectSelections(i,l.IsolateFlag.INITIAL,n):(this.nodeModelOrSelection=e,this.includeSelections=t,this.reAffectComponents(l.IsolateFlag.INITIAL,n)))}reaffectSelections(e,t,i){let s=[];e.forEach((e=>{s=s.concat(e.getOccurrencesFromSelection())})),s=(0,c.unionWithoutDuplicateValues)(s,d);const n=!this.getIsOperationInProgress()&&t!==l.IsolateFlag.ASSEMBLY_DATA_UPDATE&&!r.DocumentController.getOpenDocumentController().getActiveElementController().getViewAlignmentController().isSectionViewDialogVisible();n&&(0,o.clearSelection)(),this.shouldAddPreexistingOccurrences()&&s.length>0&&(s=(0,c.unionWithoutDuplicateValues)([...s,...this.initialAffectedOccurrences],d)),this.affectOccurrences(s,t,i),n&&(0,o.clearPreSelection)()}reAffectComponents(e,t){if(this.nodeModelOrSelection||this.includeSelections){const i=this.getSelectionFromNodeModelOrSelection(this.nodeModelOrSelection),s=[];if(i&&s.push(i),this.includeSelections){e!==l.IsolateFlag.ASSEMBLY_DATA_UPDATE&&(this.initialSelectionList=(0,h.clone)((0,o.getSelectionList)())),this.initialSelectionList.forEach((e=>{s.push(e)}))}this.reaffectSelections(s,e,t)}}affectOccurrences(e,t,i){if(0===e.length)return(0,n.getCommandDispatcher)().trigger(s.commands.EXIT_ISOLATE,this.viewer),void(0,n.getCommandDispatcher)().trigger(s.commands.EXIT_MAKE_TRANSPARENT,this.viewer);const r=t!==l.IsolateFlag.EXPAND;let a=!0;this.hasAffectedInstances()&&(a=!1),this.shouldClearOccurrenceIds()&&this.setAffectedOccurrenceIds([]),this.resetIsolationForRelatedGraphics(e),r?this.setInitialAffectedOccurrences(e):this.setAffectedOccurrences(e),this.makeTransparent(a,i),r&&this.showDialog()}areSelectionsAlreadyAffected(e){const t=this.getSelectionFromNodeModelOrSelection(e),i=[];return(0,o.getSelectionList)().forEach((e=>{i.push(e)})),t&&i.push(t),this.areSelectionsInListAlreadyAffected(i)}areSelectionsInListAlreadyAffected(e){if((0,a.isInAssemblyElement)()){let t=[];e.forEach((e=>{t=t.concat(e.getOccurrencesFromSelection())}));const i=(0,c.unionWithoutDuplicateValues)(t,d);return(0,c.hasEquivalentValues)(i,this.initialAffectedOccurrences,(e=>e.toString()))}return!1}setInitialAffectedOccurrences(e){this.initialAffectedOccurrences=e,this.centersOfInitialAffectedInstances=null,this.setAffectedOccurrences(e)}setAffectedOccurrences(e){this.affectedOccurrences=e,this.setAffectedOccurrenceIdsFromOccurrences(e)}setAffectedOccurrenceIdsFromOccurrences(e){const t=0===e.length?[]:e.map((e=>this.viewer.getIdForOccurrence(e)));this.setAffectedOccurrenceIds(t)}expandEffectByProximity(e){const t=this.getAffectedOccurrencesForExpandEffectByProximity(e);t&&this.affectOccurrences(t,l.IsolateFlag.EXPAND,!1)}updateCentersOfInitialAffectedInstances(){if(!this.centersOfInitialAffectedInstances){const e=this.getModelViewManager(),t=function(t){const i=e.getOccurrenceBounds(t);return i?i.center():null},i=this.initialAffectedOccurrences.map(t,this);this.centersOfInitialAffectedInstances=i.filter(c.isDefined,this)}}expandEffectByConnectivity(e){const t=this.getAffectedOccurrencesForExpandEffectByConnectivity(e);this.affectOccurrences(t,l.IsolateFlag.EXPAND,!1)}getAffectedOccurrencesForExpandEffectByConnectivity(e){if(-1===e)return this.initialAffectedOccurrences;{const t=this.getModelViewManager(),i={};let s=new Map;if(u(this.initialAffectedOccurrences,t,i,s),s.size===this.initialAffectedOccurrences.length&&(e+=1),e>=1){const n=t.getDisplayedAssembly();if(n)for(let r=1;r<=e;r++){const e=n.getMateIndicatorConnectivityMap(s),r=s;s=new Map;for(const[n,a]of r){u(e.get(a.getPathAsString()),t,i,s)}}}return Object.values(i)}}initialAffectedOccurrencesHaveConnectedOccurrences(){return this.getAffectedOccurrencesForExpandEffectByConnectivity(0).length>this.initialAffectedOccurrences.length}getAffectedOccurrencesForExpandEffectByProximity(e){if(0===e)return this.initialAffectedOccurrences;const t=this.getModelViewManager().getDisplayedAssembly();if(t){const i=Object.values(t.occurrences).map((function(e){return e.occurrenceData.occurrence}));this.updateCentersOfInitialAffectedInstances();const s=e*e,n=i.filter((function(e){return this.isWithinDistanceOfAnInitialAffectedOccurrence(s,e)}),this);return(0,c.unionWithoutDuplicateValues)([...n,...this.initialAffectedOccurrences],d)}return null}getIsOperationInProgress(){const e=a.DocumentModel.getOpenDocumentActiveElement();return!!r.DocumentController.getActiveFeatureController()||e&&e.get("isOperationInProgress")}getAffectedOccurrences(){return this.affectedOccurrences}}t.AssemblyIsolateManagerBase=g},263267:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyMakeTransparentManager=void 0;const s=i(859589),n=i(7401),r=i(905898),a=i(114924);class o extends a.AssemblyIsolateManagerBase{constructor(e,t,i,s,n,r){super(e,t),this.affectComponents(i,n,s,r)}getTransparentOccurrences(){return this.getAffectedOccurrences()}areSelectionsAlreadyTransparent(e){return this.areSelectionsAlreadyAffected(e)}areSelectionsInListAlreadyTransparent(e){return this.areSelectionsInListAlreadyAffected(e)}hasTransparentInstances(){return this.hasAffectedInstances()}clearTransparentNoAnimation(){this.clearEffectNoAnimation()}setUpListeners(){super.setUpListeners(),this.listenTo((0,r.getCommandDispatcher)(),n.commands.MAKE_TRANSPARENT_COMPONENTS,this.affectComponents),this.listenTo((0,r.getCommandDispatcher)(),n.commands.EXIT_MAKE_TRANSPARENT,this.clearEffectExit)}showDialog(){if(this.dialog)this.dialog.onAssemblyOrPartStudioDataProcessed();else{const e={isolateManager:this};this.dialog=new s.MakeTransparentDialog(e)}}clearEffect(){this.viewer.getOccurrenceDataManager().clearIsolation(),this.isolatedOccurrencesManager.removeMakeTransparentManager()}updateOccurrenceDataManager(){0===this.affectedOccurrenceIds.length?this.viewer.getOccurrenceDataManager().isolateAll():this.affectedOccurrenceIds.forEach((e=>{e!==a.INVALID_OCCURRENCE_ID&&this.viewer.getOccurrenceDataManager().setOccurrenceIsolated(e,!1)}))}shouldAddPreexistingOccurrences(){return!0}shouldClearOccurrenceIds(){return!0}resetIsolationForRelatedGraphics(e){this.setIsolationForRelatedGraphics(this.affectedOccurrences,!0),this.setIsolationForRelatedGraphics(e,!1)}}t.AssemblyMakeTransparentManager=o},703424:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Axes=t.AxisLabel=t.AXES_ID=void 0;const s=i(545348),n=i(264292),r=i(114924),a=i(613199),o=s.default.getManager(),c=new r.NodeProperties({isShowThrough:!0,isPickable:!1,primitiveType:r.PrimitiveType.LINES}),l=n.vec3.fromValues(1,0,0),h=n.vec3.fromValues(0,1,0),d=n.vec3.fromValues(0,0,1),u=new r.NodeProperties({isPickable:!1,primitiveType:r.PrimitiveType.TRIANGLES,material:null}),g=(0,r.toRadians)(o.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_START_ANGLE")),p=(0,r.toRadians)(o.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_END_ANGLE"));t.AXES_ID="axes3D";const m="axis_label";class E extends r.UIElement{constructor(e,t,i,s,n){super(n,r.HUD_SCENEGRAPH_ID),this.label=e,this.direction=t,this.color=i,this.axisLength=s,this.transformedDirection=null,this.labelTexture=null,this.position=null,this.lastSetOpacity=-1,this.nodeProperties=new r.NodeProperties(u),this.nodeProperties.material=(0,r.createTextureMaterial)(),this.nodeProperties.updateId(),this.ensureTexture(),this.show()}onDevicePixelRatioChanged(e){this.labelTexture=null,this.ensureTexture(),this.updateIncrements()}remove(){this.labelTexture&&(this.labelTexture.destroy(),this.labelTexture=null),this.nodeProperties.material&&(this.nodeProperties.material.destroy(),this.nodeProperties.material=null),super.remove()}updateIncrements(){const e=o.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX"),t=this.labelTexture.filledWidthPx,i=(0,r.createQuad)([-t/2,-e/2,0],[t/2,-e/2,0],[-t/2,e/2,0],void 0,[this.labelTexture.leftCoordinate,this.labelTexture.bottomCoordinate],[this.labelTexture.rightCoordinate,this.labelTexture.topCoordinate]);this.updateMeshIncrement(m,r.NO_SELECTION_ID,i,this.nodeProperties)}ensureTexture(){this.viewer.getGlContext()&&(this.labelTexture||(this.labelTexture=(0,r.createTextureFromText)(this.viewer,this.label,{color:this.color,font:o.getString("VIEW_CUBE_TEXT_FONT"),size:o.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX")}),this.nodeProperties.material.ambientTexture=this.labelTexture,this.updateIncrements()))}updateTransform(e){if(!this.position||!this.transformedDirection)return;const t=Math.acos(Math.abs(n.vec3.dot(e.getForward(),this.transformedDirection))),i=(0,r.smoothstep)(p,g,t);this.setOpacity(i),this.setTransform(a.mat4C.translate(n.mat4.create(),this.position))}setOpacity(e){if(e===this.lastSetOpacity)return;const t=new Uint8Array([255,255,255,255*e]);this.updateIncrementAttribute(m,r.Attributes.COLOR,t),this.lastSetOpacity=e}}t.AxisLabel=E;class I extends r.UIElement{constructor(e,i){super(e),this.coordinateSystemTransform=null,this.axisLabels={},this.setId(t.AXES_ID),this.highlightId=r.NO_SELECTION_ID,i=i||{},this.axesName=i.hasOwnProperty("axesName")?i.axesName:null,this.hasXAxis=!i.hasOwnProperty("hasXAxis")||i.hasXAxis,this.hasYAxis=!i.hasOwnProperty("hasYAxis")||i.hasYAxis,this.hasZAxis=!i.hasOwnProperty("hasZAxis")||i.hasZAxis,this.XAxisColor=i.hasOwnProperty("XAxisColor")?i.XAxisColor:o.getColor("X_AXIS_COLOR"),this.YAxisColor=i.hasOwnProperty("YAxisColor")?i.YAxisColor:o.getColor("Y_AXIS_COLOR"),this.ZAxisColor=i.hasOwnProperty("ZAxisColor")?i.ZAxisColor:o.getColor("Z_AXIS_COLOR");const s=o.getNumber("AXIS_LINE_WIDTH_PX");this.XAxisWidth=i.hasOwnProperty("XAxisWidth")?i.XAxisWidth:s,this.YAxisWidth=i.hasOwnProperty("YAxisWidth")?i.YAxisWidth:s,this.ZAxisWidth=i.hasOwnProperty("ZAxisWidth")?i.ZAxisWidth:s;const n=o.getNumber("AXIS_LINE_LENGTH_PX");this.XAxisStartEndPixel=i.hasOwnProperty("XAxisStartEndPixel")?i.XAxisStartEndPixel:[0,n],this.YAxisStartEndPixel=i.hasOwnProperty("YAxisStartEndPixel")?i.YAxisStartEndPixel:[0,n],this.ZAxisStartEndPixel=i.hasOwnProperty("ZAxisStartEndPixel")?i.ZAxisStartEndPixel:[0,n],this.hasXAxis&&(this.axisLabels.X=new E("X",l,o.getColor("X_AXIS_COLOR"),this.XAxisStartEndPixel[1],this.viewer)),this.hasYAxis&&(this.axisLabels.Y=new E("Y",h,o.getColor("Y_AXIS_COLOR"),this.YAxisStartEndPixel[1],this.viewer)),this.hasZAxis&&(this.axisLabels.Z=new E("Z",d,o.getColor("Z_AXIS_COLOR"),this.ZAxisStartEndPixel[1],this.viewer)),this.ensureTexture(),this.listenTo(this.viewer.getEventDispatcher(),r.VIEW_WILL_DRAW,this.onViewWillDraw)}onViewWillDraw(e,t){if(this.updateGraphics(e),this.coordinateSystemTransform)for(const t in this.axisLabels){const i=this.axisLabels[t],s=i.axisLength+o.getNumber("AXIS_LABEL_OFFSET_PX"),r=a.vec3C.scale(this.axisLabels[t].direction,s,n.vec3.create()),c=a.mat4C.multiplyVec4(this.transform,n.vec4.fromValues(r[0],r[1],r[2],1),n.vec4.create()),l=e.projectWorldPointToViewport(c);i.position=l;const h=n.vec4.fromValues(i.direction[0],i.direction[1],i.direction[2],0);a.mat4C.multiplyVec4(this.transform,h,n.vec4.create());i.transformedDirection||(i.transformedDirection=n.vec4.create()),n.vec3.copy(i.transformedDirection,i.direction),i.transformedDirection[3]=0,a.mat4C.multiplyVec4(this.transform,i.transformedDirection),a.vec3C.normalize(i.transformedDirection),i.updateTransform(e)}}addAxis(e,t,i,s,o){const l=a.vec3C.scale(t,o[0],n.vec3.create()),h=a.vec3C.scale(t,o[1],n.vec3.create()),d=(0,r.createLine)(l,h);(0,r.addSizeToIncrement)(s,d),(0,r.addColorToIncrement)(i,d),this.updateMeshIncrement(e,r.NO_SELECTION_ID,d,c)}updateGraphics(e){if(null===this.coordinateSystemTransform)return;!this.hasMeshIncrements()&&this.coordinateSystemTransform&&(this.hasXAxis&&this.addAxis("X_AXIS",l,this.XAxisColor,this.XAxisWidth,this.XAxisStartEndPixel),this.hasYAxis&&this.addAxis("Y_AXIS",h,this.YAxisColor,this.YAxisWidth,this.YAxisStartEndPixel),this.hasZAxis&&this.addAxis("Z_AXIS",d,this.ZAxisColor,this.ZAxisWidth,this.ZAxisStartEndPixel));const t=n.vec3.fromValues(this.coordinateSystemTransform[12],this.coordinateSystemTransform[13],this.coordinateSystemTransform[14]),i=e.getPixelSizeAtWorldPoint(t),s=n.vec3.fromValues(i,i,i),r=a.mat4C.scale(this.coordinateSystemTransform,s,n.mat4.create());this.setTransform(r)}updateDefinition(e){this.coordinateSystemTransform=e}hide(){this.hasXAxis&&this.axisLabels.X.hide(),this.hasYAxis&&this.axisLabels.Y.hide(),this.hasZAxis&&this.axisLabels.Z.hide(),super.hide()}show(){this.hasXAxis&&this.axisLabels.X.show(),this.hasYAxis&&this.axisLabels.Y.show(),this.hasZAxis&&this.axisLabels.Z.show(),super.show()}ensureTexture(){for(const e in this.axisLabels)this.axisLabels[e].ensureTexture()}remove(){for(const e in this.axisLabels)this.axisLabels[e].remove();super.remove()}}t.Axes=I},455410:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.BoxSelector=t.setBoxSelectionEnabled=t.SELECTION_ID=void 0;const n=i(545348),r=i(114924),a=i(997687),o=i(450798),c=i(193786),l=i(127062);t.SELECTION_ID="box";const h=n.default.getManager();let d=!0;t.setBoxSelectionEnabled=function(e){d=e};const u=new r.NodeProperties({isPickable:!1,primitiveType:r.PrimitiveType.LINES}),g=new r.NodeProperties({isPickable:!1,primitiveType:r.PrimitiveType.TRIANGLES,primitivesHaveTransparency:!0,material:r.UNLIT_COLOR_FROM_ATTRIBUTE});class p extends r.UIElement{constructor(e){super(e,r.HUD_SCENEGRAPH_ID),this.mouseDown=[0,0],this.lastMouse=[0,0],this.canceled=!1,this.zoomCursorOnStack=!1,this.zoomTriggeredByMenu=!1,this.zoomModifier=!1,this.dragging=!1,this.listeningToKeyDispatcher=!1,this.listeningToOutsideClick=!1,this.mouseOnCanvas=!0,this.messageBubble=a.btInjector.MessageBubbleService.createMessageBubble(),this.listenTo(this,r.UiEvents.DRAG_START+t.SELECTION_ID,this.onDragStart),this.listenTo(this,r.UiEvents.DRAG+t.SELECTION_ID,this.onDrag),this.listenTo(this,r.UiEvents.DRAG_STOP+t.SELECTION_ID,this.onDragStop),this.zoomModeEnabledSubscription=(0,r.getZoomToWindowState)().zoomModeEnabledObservable.subscribe((()=>this.onZoomModeChange()))}remove(){this.zoomModeEnabledSubscription.unsubscribe(),super.remove()}getPositionFromEvent(e){return[e.mouseX,e.camera.getViewportHeight()-e.mouseY]}performContainmentSelection(){return this.lastMouse[0]>this.mouseDown[0]}left(){return Math.min(this.lastMouse[0],this.mouseDown[0])}right(){return Math.max(this.lastMouse[0],this.mouseDown[0])}bottom(){return Math.min(this.lastMouse[1],this.mouseDown[1])}top(){return Math.max(this.lastMouse[1],this.mouseDown[1])}onDragStart(e,t,i){this.viewer.getSuppressModelSelection()?this.canceled=!0:(this.lastMouse=this.mouseDown=this.getPositionFromEvent(t),this.updateGraphics(),i.requestDrag=!0,this.canceled=!1,this.dragging=!0,this.listenToKeyDispatcher(),(0,r.requestDraw)())}onDrag(e,t){this.canceled||(this.lastMouse=this.getPositionFromEvent(t),this.updateGraphics(),(0,r.requestDraw)())}onDragStop(e,t){if(this.canceled)return;this.dragging=!1;const i=this.right()-this.left(),s=this.top()-this.bottom(),n=t.camera.getViewportHeight()-this.top();if(this.zoomIsEnabled())(0,r.setZoomModeEnabled)(!1),this.viewer.animateZoomToRectangle(this.left(),n,i,s),this.removeMeshIncrements(),this.stopListeningToKeyDispatcher(),this.tearDownOutsideClickListeners();else{const e=this.viewer.performBoxSelection(this.left(),n,i,s,this.performContainmentSelection()),t=this;e?e.then((function(){t.removeMeshIncrements(),t.stopListeningToKeyDispatcher()})):(t.removeMeshIncrements(),this.stopListeningToKeyDispatcher())}}onKeyDown(e){e.which===o.Keys.CANCEL&&this.cancelSelection()}outsideClickHandler(e){!this.mouseOnCanvas&&e&&e.target&&(0,r.setZoomModeEnabled)(!1)}setupOutsideClickListeners(){this.listeningToOutsideClick||(this.mouseOnCanvas=!0,s(document).on("click.boxSelector",this.outsideClickHandler.bind(this)),this.listenTo(this.viewer.getEventDispatcher(),r.CANVAS_MOUSEENTER,this.onMouseEnter),this.listenTo(this.viewer.getEventDispatcher(),r.CANVAS_MOUSELEAVE,this.onMouseLeave),this.listeningToOutsideClick=!0)}onMouseEnter(e){this.mouseOnCanvas=!0}onMouseLeave(e){this.mouseOnCanvas=!1}tearDownOutsideClickListeners(){this.listeningToOutsideClick&&(s(document).off("click.boxSelector"),this.listeningToOutsideClick=!1)}listenToKeyDispatcher(){this.listeningToKeyDispatcher||(this.listenTo((0,l.getDispatcher)(),l.Events.KEYDOWN,this.onKeyDown),this.listeningToKeyDispatcher=!0)}stopListeningToKeyDispatcher(){this.listeningToKeyDispatcher&&(this.stopListening((0,l.getDispatcher)()),this.listeningToKeyDispatcher=!1)}pushZoomCursor(){this.zoomCursorOnStack||(this.viewer.pushCursor(r.Cursor.ZOOM_IN),this.zoomCursorOnStack=!0)}popZoomCursor(){this.zoomCursorOnStack&&(this.viewer.removeTopOccurrenceOfCursor(r.Cursor.ZOOM_IN),this.zoomCursorOnStack=!1)}cancelSelection(){this.viewer.performingBoxSelection()?this.viewer.stopBoxSelection():(this.resetZoomState(),this.canceled=!0,this.removeMeshIncrements(),this.stopListeningToKeyDispatcher(),this.tearDownOutsideClickListeners()),this.dragging=!1}getVertex(e,t){return[e,t,0]}getBoxLineColor(){if(this.zoomIsEnabled())return h.getColor("BOX_ZOOM_COLOR");return this.performContainmentSelection()?h.getColor("BOX_SELECT_COLOR"):h.getColor("CROSS_SELECT_COLOR")}getBoxStipple(){if(this.zoomIsEnabled())return h.getStipple("BOX_ZOOM_LINE_STIPPLE");return this.performContainmentSelection()?h.getStipple("BOX_SELECT_LINE_STIPPLE"):h.getStipple("CROSS_SELECT_LINE_STIPPLE")}updateGraphics(){const e=(0,r.createLines)([this.getVertex(this.mouseDown[0],this.mouseDown[1]),this.getVertex(this.lastMouse[0],this.mouseDown[1]),this.getVertex(this.lastMouse[0],this.mouseDown[1]),this.getVertex(this.lastMouse[0],this.lastMouse[1]),this.getVertex(this.lastMouse[0],this.lastMouse[1]),this.getVertex(this.mouseDown[0],this.lastMouse[1]),this.getVertex(this.mouseDown[0],this.lastMouse[1]),this.getVertex(this.mouseDown[0],this.mouseDown[1])]);let t;this.left()!==this.right()&&this.bottom()!==this.top()&&(t=(0,r.createQuad)(this.getVertex(this.left(),this.bottom()),this.getVertex(this.right(),this.bottom()),this.getVertex(this.left(),this.top())));const i=this.getBoxLineColor(),s=this.getBoxStipple();if((0,r.addColorToIncrement)(i,e),(0,r.addStyleToIncrement)(s,e),(0,r.addSizeToIncrement)(h.getNumber("BOX_SELECT_LINE_WIDTH"),e),this.updateMeshIncrement("lines",r.NO_SELECTION_ID,e,u),t){const e=i.slice(0);e[3]=h.getNumber("BOX_SELECT_INFILL_OPACITY"),(0,r.addColorToIncrement)(e,t),this.updateMeshIncrement("interior",r.NO_SELECTION_ID,t,g)}else this.removeMeshIncrement("interior")}triggerDragStart(e,t){const i=!!(0,c.getSelectionFocus)()&&(0,c.getSelectionFocus)().getIsAQueryList()&&1===(0,c.getMaximumNumberOfSelections)();return!!(this.zoomIsEnabled()||d&&!i)&&super.triggerDragStart(e,t)}zoomIsEnabled(){return(0,r.getZoomModeEnabled)()}startZoom(){this.pushZoomCursor()}stopZoom(){this.popZoomCursor()}resetZoomState(){(0,r.setZoomModeEnabled)(!1)}showZoomMessage(){this.messageBubble.showMessage(i18n("Drag to create zoom bounding box."))}dismissZoomMessage(){this.messageBubble.dismissMessage()}onZoomModeChange(){this.zoomIsEnabled()?(this.startZoom(),this.listenToKeyDispatcher(),this.setupOutsideClickListeners(),this.dragging?this.updateGraphics():this.showZoomMessage()):(this.dragging&&this.updateGraphics(),this.stopListeningToKeyDispatcher(),this.stopZoom(),this.tearDownOutsideClickListeners(),this.dismissZoomMessage())}}t.BoxSelector=p},815578:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrCamera=t.getHudLayerDepthRange=t.OrthographicCamera=t.PerspectiveCamera=t.DEFAULT_PERSPECTIVE_FOV=t.Camera=void 0;const s=i(264292),n=i(912057),r=i(873896),a=i(114924),o=i(613199);class c{constructor(){this.viewport=s.vec4.fromValues(0,0,4,4),this.tileViewport=null,this.viewportDiagonal=0,this.canvasHeight=0,this.canvasWidth=0,this.sceneBounds=null,this.PROJECT_VEC_4=s.vec4.create(),this.TEMP_VEC4_0=s.vec4.create(),this.TEMP_VEC4_1=s.vec4.create(),this.TEMP_VEC4_2=s.vec4.create(),this.TEMP_VEC3_0=s.vec3.create(),this.TEMP_VEC3_1=s.vec3.create(),this.updateViewportDiagonal(),this.viewMatrix=s.mat4.create(),this.viewMatrixInverse=s.mat4.create(),this.projectionMatrix=s.mat4.create(),this.projectionMatrixInverse=s.mat4.create(),this.viewFrustum=new a.ViewFrustum(this.viewMatrix,this.projectionMatrix)}integrityCheck(e){this.checkProperty("viewport",e),this.checkProperty("viewportDiagonal",e),this.checkProperty("canvasHeight",e),this.checkProperty("canvasWidth",e),this.checkProperty("viewMatrix",e),this.checkProperty("viewMatrixInverse",e),this.checkProperty("projectionMatrix",e),this.checkProperty("projectionMatrixInverse",e),this.checkProperty("eye",e),this.checkProperty("up",e),this.checkProperty("direction",e),this.checkProperty("near",e),this.checkProperty("far",e)}checkProperty(e,t){const i=this[e];(0,a.isFinite)(i)||n.log.warn(e+" was found to be non-finite in "+t+": "+i)}getViewFrustum(){return this.viewFrustum}toString(){return JSON.stringify(this,null,2)}isPerspective(){return!1}isOrthographic(){return!1}setViewportFromCanvasElement(e){const t=+e.attr("width"),i=+e.attr("height");this.setViewport([0,0,t,i]),this.setCanvasDimensions(t,i)}setCanvasDimensions(e,t){this.canvasWidth=e,this.canvasHeight=t}updateViewportDiagonal(){this.viewportDiagonal=o.vec2C.length([this.viewport[2],this.viewport[3]])}setViewport(e){this.viewport=e,this.updateViewportDiagonal(),this.updateMatrices()}getViewport(e){return this.tileViewport&&!e?s.vec4.fromValues(0,0,this.tileViewport[2],this.tileViewport[3]):this.viewport}getTileViewport(){return this.tileViewport}getViewportDiagonal(){return this.viewportDiagonal}getEye(){return this.eye}getFrame(){const e=s.mat4.create(),t=this.getRight();for(let i=0;i<3;i++)e[i]=t[i],e[i+4]=this.up[i],e[i+8]=-this.direction[i],e[i+12]=this.eye[i],e[4*i+3]=0;return e}setFrame(e){if(!e||16!==e.length)return void n.log.error("An attempt was made to update the camera with an invalid frame");const t=s.vec3.fromValues(e[12],e[13],e[14]),i=s.vec3.fromValues(-e[8],-e[9],-e[10]),r=s.vec3.fromValues(e[4],e[5],e[6]);this.setViewPositionAndOrientation(t,i,r)}setViewPositionAndOrientation(e,t,i){this.eye=e,this.direction=t,this.up=i,this.updateMatrices(),this.integrityCheck("setViewPositionAndOrientation")}getDirection(){return this.direction}getFieldOfView(){return 0}setFieldOfView(e){}focalPoint(){return this.sceneBounds?this.sceneBounds.center():s.vec3.create()}distanceToCenter(){const e=this.focalPoint();return Math.abs(s.vec3.dot(this.direction,o.vec3C.subtract(e,this.eye,s.vec3.create())))}setSceneBounds(e){e.isInitialized()&&!e.isInfinite()&&(this.sceneBounds=e,this.ensureCameraIsOutsideSceneBounds(),this.updateNearFar())}getSceneBounds(){return this.sceneBounds}getViewMatrix(){return s.mat4.clone(this.viewMatrix)}getViewMatrixInverse(){return s.mat4.clone(this.viewMatrixInverse)}setTileViewport(e){this.tileViewport=e}getProjectionMatrix(){return this.tileViewport?o.mat4C.multiply((0,a.createTileViewportMatrix)(this.tileViewport,this.viewport),this.projectionMatrix,s.mat4.create()):s.mat4.clone(this.projectionMatrix)}getMatrices(e,t){for(let i=0;i<16;++i)e[i]=this.viewMatrix[i],t[i]=this.projectionMatrix[i]}getProjectionMatrixInverse(){return s.mat4.clone(this.projectionMatrixInverse)}updateMatrixInverses(){let e=o.mat4C.inverse(this.viewMatrix,this.viewMatrixInverse);e=o.mat4C.inverse(this.projectionMatrix,this.projectionMatrixInverse)&&e,e||n.log.warn("Error updating camera matrix inverses")}updateNearFar(e){if(!e&&this.sceneBounds&&(e=this.sceneBounds.getCorners()),!e||!e.length)return;let t,i=-1/0,r=1/0;const a=s.vec3.create();for(t=0;t<e.length;t++){const n=s.vec3.dot(o.vec3C.subtract(e[t],this.eye,a),this.direction);i=Math.max(i,n),r=Math.min(r,n)}if(i>=r){let e=1;this.sceneBounds&&(e=this.sceneBounds.diameter());const t=.01,s=.1;this.near=Math.max(e*t,r-s*e),this.far=Math.max(e,i+s*e)}else n.log.warn("Trying to initialize the camera with a bounds that has no extension in the view direction"),this.near=.001,this.far=2;this.updateMatrices()}setNearFar(e,t){e>=t&&n.log.debug("Near set to a distance greater or equal to far"),this.near=e,this.far=t,this.updateMatrices()}zoom(e){}getNearDepth(){return this.near}getFarDepth(){return this.far}rotateAbout(e,t,i){i||(i=this.eye);const n=s.mat4.create();o.mat4C.rotate(n,e,t),o.mat4C.multiplyVec3(n,this.direction),o.mat4C.multiplyVec3(n,this.up);const r=o.vec3C.subtract(this.eye,i,s.vec3.create());o.mat4C.multiplyVec3(n,r),o.vec3C.add(i,r,this.eye),this.updateMatrices(),this.integrityCheck("rotateAbout")}pan(e){o.vec3C.subtract(this.eye,e),this.updateMatrices(),this.integrityCheck("pan")}ensureCameraIsOutsideSceneBounds(){}getRight(){return o.vec3C.normalize(o.vec3C.cross(this.direction,this.up,s.vec3.create()))}getUp(){return this.up}getForward(){return this.direction}projectWorldPointToViewport(e){return e=s.vec4.fromValues(e[0],e[1],e[2],1),this.projectViewPoint(o.mat4C.multiplyVec4(this.viewMatrix,e,s.vec4.create()))}projectWorldPointToCanvas(e){return this.viewportToCanvas(this.projectWorldPointToViewport(e))}viewportToCanvas(e){const t=s.vec3.create();t[0]=e[0]+this.getViewportLeft();const i=this.canvasHeight-(this.getViewportBottom()+this.getViewportHeight());return t[1]=i+(this.getViewportHeight()-e[1]),t[2]=e[2],t}viewNormalPlaneAtPoint(e){const t=this.getForward(),i=s.vec3.dot(t,e);return s.vec4.fromValues(t[0],t[1],t[2],-i)}projectViewPoint(e,t){t=t||s.vec3.create();const i=this.tileViewport?this.getProjectionMatrix():this.projectionMatrix,n=o.mat4C.multiplyVec4(i,e,this.PROJECT_VEC_4);n[3]=1/n[3],n[0]*=n[3],n[1]*=n[3],n[2]*=n[3];const r=this.tileViewport?this.tileViewport:this.viewport,a=r[2],c=r[3];return t[0]=0+a*(n[0]+1)/2,t[1]=0+c*(n[1]+1)/2,t[2]=(n[2]+1)/2,t}viewPointToWorld(e){return e=s.vec4.fromValues(e[0],e[1],e[2],1),o.mat4C.multiplyVec4(this.viewMatrixInverse,e,s.vec4.create())}getUnitSizeAtWorldPoint(e){const t=this.TEMP_VEC4_0;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1;const i=this.projectViewPoint(o.mat4C.multiplyVec4(this.viewMatrix,t,this.TEMP_VEC4_1),this.TEMP_VEC3_0);t[0]+=this.up[0],t[1]+=this.up[1],t[2]+=this.up[2];const s=this.projectViewPoint(o.mat4C.multiplyVec4(this.viewMatrix,t,this.TEMP_VEC4_2),this.TEMP_VEC3_1);return Math.abs(s[1]-i[1])}projectWorldDirectionToCanvas(e,t){const i=this.projectWorldPointToCanvas(e),n=o.vec3C.add(e,t,this.TEMP_VEC3_0),r=this.projectWorldPointToCanvas(n);return o.vec2C.subtract(r,i,s.vec2.create())}getPixelSizeAtWorldPoint(e){return 1/this.getUnitSizeAtWorldPoint(e)}isCanvasPointInView(e){return e[0]>=0&&e[0]<this.getViewportWidth()&&e[1]>=0&&e[1]<this.getViewportHeight()}getRay(e,t){t=this.canvasHeight-t;const i=o.vec3C.unproject([e+.5,t+.5,0],this.viewMatrix,this.projectionMatrix,this.viewport),n=o.vec3C.unproject([e+.5,t+.5,1],this.viewMatrix,this.projectionMatrix,this.viewport);return new a.Ray(i,o.vec3C.subtract(n,i,s.vec3.create()))}canvasToWorld(e){const t=s.vec3.fromValues(e[0],this.canvasHeight-e[1],e[2]);return o.vec3C.unproject(t,this.viewMatrix,this.projectionMatrix,this.viewport,s.vec3.create())}getCanvasWidth(){return this.canvasWidth}getCanvasHeight(){return this.canvasHeight}getViewportWidth(){return this.viewport[2]}getViewportHeight(){return this.viewport[3]}getViewportLeft(){return this.viewport[0]}getViewportBottom(){return this.viewport[1]}getClosestNormalView(e,t){if(!e)return null;const i=s.vec3.fromValues(e[0],e[1],e[2]),n=s.vec3.fromValues(e[4],e[5],e[6]),c=this.getFrame(),l=s.vec3.fromValues(c[0],c[1],c[2]),h=s.vec3.fromValues(c[4],c[5],c[6]),d=s.vec3.fromValues(c[12],c[13],c[14]);let u,g;const p=s.vec3.dot(l,i),m=s.vec3.dot(l,n);if(Math.abs(p)>Math.abs(m)-r.Tolerances.ZERO_LENGTH){u=o.vec3C.scale(i,p<0?-1:1,s.vec3.create());const e=s.vec3.dot(h,n);g=o.vec3C.scale(n,e<0?-1:1,s.vec3.create())}else{u=o.vec3C.scale(n,m<0?-1:1,s.vec3.create());const e=s.vec3.dot(h,i);g=o.vec3C.scale(i,e<0?-1:1,s.vec3.create())}const E=o.vec3C.cross(u,g,s.vec3.create()),I=d,T=s.mat4.create();for(let e=0;e<3;++e)T[0+e]=u[e],T[4+e]=g[e],T[8+e]=E[e],T[12+e]=I[e];if(t&&t.flipNormalIfIdentical&&(0,a.areMatricesEqual)(c,T))for(let e=0;e<3;++e)T[0+e]=-u[e],T[8+e]=-E[e],T[12+e]=-I[e];return T}getCameraRotatedToView(e,t){const i=this.clone();i.setFrame(this.getClosestNormalView(e,{flipNormalIfIdentical:!0}));const s=this.projectWorldPointToCanvas(t),n=i.canvasToWorld(s);return i.pan(o.vec3C.subtract(n,t)),i}getCameraRotatedToViewAndTranslated(e,t,i){const s=this.clone();s.setFrame(this.getClosestNormalView(e,{flipNormalIfIdentical:!0}));const n=this.projectWorldPointToCanvas(t),r=[i[0],i[1],n[2]],a=s.canvasToWorld(r);return s.pan(o.vec3C.subtract(a,t)),s}canBoundsFitInViewport(e,t){if(!e||!e.isFinite())return!1;const i=new a.BoundingBox2D,s=e.getCorners();for(let e=0;e<s.length;++e)i.addPoint(this.projectWorldPointToViewport(s[e]));const n=i.getDimensions();return n[0]<t[2]&&n[1]<t[3]}doBoundsFitInViewport(e,t,i){if(!e||!e.isFinite()||0===i)return!1;t=t||this.viewport;const s=i||1,n=new a.BoundingBox2D,r=e.getCorners();for(let e=0;e<r.length;++e)n.addPoint(this.projectWorldPointToViewport(r[e]));const o=[t[2]*(s-1)/2,t[3]*(s-1)/2];return n.min[0]>-o[0]&&n.min[1]>-o[1]&&n.max[0]<t[2]+o[0]&&n.max[1]<t[3]+o[1]}canvasToModelPoint(e){const t=this.projectWorldPointToCanvas(s.vec3.fromValues(0,0,0));return this.canvasToWorld(s.vec3.fromValues(e[0],e[1],t[2]))}getUnitSizeAtWorldPointFast(e){return this.getUnitSizeAtWorldPoint(e)}}t.Camera=c,t.DEFAULT_PERSPECTIVE_FOV=45;class l extends c{constructor(e){super(),this.MIN_SCALE=.05,this.MAX_SCALE=50,this.angle=t.DEFAULT_PERSPECTIVE_FOV,this.eye=s.vec3.fromValues(0,0,0),this.near=1,this.far=2,this.direction=s.vec3.fromValues(0,0,1),this.up=s.vec3.fromValues(0,1,0),Object.assign(this,l.defaults(),e||{}),this.updateMatrices()}static defaults(){return{eye:[0,0,0],direction:[0,0,1],up:[0,1,0],angle:45,near:1,far:2}}integrityCheck(e){super.integrityCheck(e),this.checkProperty("angle",e)}equals(e){return e instanceof l&&(this.angle===e.angle&&(0,a.areMatricesEqual)(this.eye,e.eye)&&(0,a.areMatricesEqual)(this.direction,e.direction)&&(0,a.areMatricesEqual)(this.up,e.up))}isPerspective(){return!0}getFieldOfView(){return this.angle}setFieldOfView(e){this.angle=e,this.updateMatrices()}updateMatrices(){const e=o.vec3C.add(this.direction,this.eye,s.vec3.create());o.mat4C.lookAt(this.eye,e,this.up,this.viewMatrix),o.mat4C.perspective(this.angle,this.viewport[2]/this.viewport[3],this.near,this.far,this.projectionMatrix),this.updateMatrixInverses(),this.viewFrustum.updateClippingPlanes(this.viewMatrix,this.projectionMatrix)}getDirectionToWorldPoint(e){return o.vec3C.normalize(o.vec3C.subtract(e,this.eye,s.vec3.create()))}getFrustum(){const e=Math.tan((0,a.toRadians)(.5*this.angle))*this.near,t=e*this.canvasWidth/this.canvasHeight;return[-t,t,-e,e,this.near,this.far]}copyTo(e){let t;for(t=0;t<3;++t)e.eye[t]=this.eye[t],e.direction[t]=this.direction[t],e.up[t]=this.up[t];for(e.angle=this.angle,e.near=this.near,e.far=this.far,e.sceneBounds=this.sceneBounds,e.setViewport(this.viewport),e.canvasWidth=this.canvasWidth,e.canvasHeight=this.canvasHeight,t=0;t<16;++t)e.viewMatrix[t]=this.viewMatrix[t],e.viewMatrixInverse[t]=this.viewMatrixInverse[t],e.projectionMatrix[t]=this.projectionMatrix[t]}copyFrom(e){e.isPerspective()?e.copyTo(this):e.getPerspectiveCamera().copyTo(this)}clone(){const e=new l;return this.copyTo(e),e}getPerspectiveCamera(){return this.clone()}getOrthographicCamera(){const e=new h;let t;for(t=0;t<3;++t)e.eye[t]=this.eye[t],e.direction[t]=this.direction[t],e.up[t]=this.up[t];e.setViewport(this.viewport),e.sceneBounds=this.sceneBounds,e.canvasWidth=this.canvasWidth,e.canvasHeight=this.canvasHeight,e.updateNearFar(),e.correctAspectRatio(),e.updateMatrices();const i=this.getSceneBounds().center(),s=this.getUnitSizeAtWorldPoint(i),n=e.getUnitSizeAtWorldPoint(i);return e.zoom(n/s),e}getFrame(){const e=s.mat4.create(),t=o.vec3C.cross(this.direction,this.up,s.vec3.create()),i=this.up,n=this.direction;let r;for(r=0;r<3;r++)e[r]=t[r],e[r+4]=i[r],e[r+8]=-n[r],e[r+12]=this.eye[r],e[4*r+3]=0;return e}getMinDistance(){return this.sceneBounds?this.sceneBounds.diameter()*this.MIN_SCALE:this.MIN_SCALE}getMaxDistance(){return this.sceneBounds?this.sceneBounds.diameter()*this.MAX_SCALE:this.MAX_SCALE}dollyAlong(e,t){if(!this.sceneBounds)return;const i=this.getMinDistance(),n=this.getMaxDistance(),r=this.distanceToCenter(),a=s.vec3.dot(this.direction,t);let c=a*e;r<i?c=Math.min(c,0):r-c<i?c=Math.max(i-r,0):r-c>n&&(c=Math.min(r-n,0)),o.vec3C.add(this.eye,o.vec3C.scale(t,c/a,s.vec3.create())),this.updateMatrices(),this.integrityCheck("dollyAlong")}dolly(e){this.dollyAlong(e,this.direction)}zoom(e){const t=this.distanceToCenter();this.dolly(t-t*e)}getZoomToFitEyeAndPlanes(e,t,i){const n=o.vec3C.cross(this.direction,this.up,s.vec3.create()),r=s.mat3.fromValues(n[0],n[1],n[2],this.up[0],this.up[1],this.up[2],-this.direction[0],-this.direction[1],-this.direction[2]),c=o.mat3C.transpose(r,s.mat3.create()),l=[0,0,0];let h,d=0;if(e((function(e){o.vec3C.add(l,e),d++})),d<=0)return null;o.vec3C.scale(l,1/d);const u=[1/0,1/0,1/0],g=[-1/0,-1/0,-1/0],p=s.vec3.create(),m=s.vec3.create();e((function(e){for(o.vec3C.subtract(e,l,p),o.mat3C.multiplyVec3(c,p,m),h=0;h<3;h++)u[h]=Math.min(u[h],m[h]),g[h]=Math.max(g[h],m[h])}));const E=o.vec3C.scale(o.vec3C.add(g,u,s.vec3.create()),.5);o.vec3C.subtract(g,E);const I=2*g[0]/(2*g[1]),T=t[2]/t[3];if(T<I&&(g[1]*=I/T),i)for(h=0;h<3;h++)g[h]*=i;const S=g[1]/Math.tan((0,a.toRadians)(.5*this.angle)),f=o.mat3C.multiplyVec3(r,E,s.vec3.create()),C=o.vec3C.add(l,f,s.vec3.create());return o.vec3C.add(C,o.vec3C.scale(this.direction,-(S+g[2]),s.vec3.create())),{eye:C,near:S,far:S+2*g[2]}}zoomToFit(e,t,i){let n;if(e instanceof Array)n=function(t){for(let i=0;i<e.length;i++)t(e[i])};else{if(!(e instanceof Function))return;n=e}const r=this.getZoomToFitEyeAndPlanes(n,this.viewport,t);if(r){if(this.eye=r.eye,this.near=r.near,this.far=r.far,i){const e=Math.tan((0,a.toRadians)(.5*this.angle))*this.near*2/i[3],t=(.5*this.viewport[2]-(i[0]+.5*i[2]))*e,n=(.5*this.viewport[3]-(i[1]+.5*i[3]))*e,r=o.vec3C.cross(this.direction,this.up,s.vec3.create());o.vec3C.add(this.eye,o.vec3C.scale(r,t,s.vec3.create())),o.vec3C.add(this.eye,o.vec3C.scale(this.up,n,s.vec3.create()));const c=this.near*(this.viewport[2]/i[2]-1),l=this.near*(this.viewport[3]/i[3]-1),h=Math.max(c,l);o.vec3C.subtract(this.eye,o.vec3C.scale(this.direction,h,s.vec3.create())),this.near+=h,this.far+=h}this.updateMatrices(),this.integrityCheck("zoomToFit")}}}t.PerspectiveCamera=l;class h extends c{constructor(e){super(),this.DEFAULT_EXTENT_RATIO=.1,this.cachedWorldToPixelSize=-1,this.left=-1,this.right=1,this.top=1,this.bottom=-1,this.near=-1,this.far=1,this.eye=s.vec3.create(),this.direction=s.vec3.fromValues(0,0,-1),this.up=s.vec3.fromValues(0,1,0),Object.assign(this,h.defaults(),e||{}),this.updateMatrices()}static defaults(){return{eye:[0,0,0],direction:[0,0,-1],up:[0,1,0],left:-1,right:1,top:1,bottom:-1,near:-1,far:1}}integrityCheck(e){super.integrityCheck(e),this.checkProperty("left",e),this.checkProperty("right",e),this.checkProperty("top",e),this.checkProperty("bottom",e)}equals(e){return e instanceof h&&(Math.abs(this.left-e.left)<r.Tolerances.ZERO_LENGTH&&Math.abs(this.right-e.right)<r.Tolerances.ZERO_LENGTH&&Math.abs(this.top-e.top)<r.Tolerances.ZERO_LENGTH&&Math.abs(this.bottom-e.bottom)<r.Tolerances.ZERO_LENGTH&&(0,a.areMatricesEqual)(this.eye,e.eye)&&(0,a.areMatricesEqual)(this.direction,e.direction)&&(0,a.areMatricesEqual)(this.up,e.up))}isOrthographic(){return!0}getUnitSizeAtWorldPointFast(e){return this.cachedWorldToPixelSize<0&&(this.cachedWorldToPixelSize=super.getUnitSizeAtWorldPoint(e)),this.cachedWorldToPixelSize}updateMatrices(){const e=o.vec3C.add(this.direction,this.eye,s.vec3.create());o.mat4C.lookAt(this.eye,e,this.up,this.viewMatrix),o.mat4C.ortho(this.left,this.right,this.bottom,this.top,this.near,this.far,this.projectionMatrix),this.updateMatrixInverses(),this.viewFrustum.updateClippingPlanes(this.viewMatrix,this.projectionMatrix),this.cachedWorldToPixelSize=-1}copyTo(e){let t;for(t=0;t<3;++t)e.eye[t]=this.eye[t],e.direction[t]=this.direction[t],e.up[t]=this.up[t];for(e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e.sceneBounds=this.sceneBounds,e.setViewport(this.viewport),e.canvasWidth=this.canvasWidth,e.canvasHeight=this.canvasHeight,t=0;t<16;++t)e.viewMatrix[t]=this.viewMatrix[t],e.viewMatrixInverse[t]=this.viewMatrixInverse[t],e.projectionMatrix[t]=this.projectionMatrix[t]}copyFrom(e){e.isOrthographic()?e.copyTo(this):e.getOrthographicCamera().copyTo(this)}clone(){const e=new h;return this.copyTo(e),e}getOrthographicCamera(){return this.clone()}getPerspectiveCamera(){const e=new l;let t;for(t=0;t<3;++t)e.eye[t]=this.eye[t],e.direction[t]=this.direction[t],e.up[t]=this.up[t];e.setViewport(this.viewport),e.sceneBounds=this.sceneBounds,e.canvasWidth=this.canvasWidth,e.canvasHeight=this.canvasHeight,e.updateNearFar();const i=this.getSceneBounds().center(),s=this.getUnitSizeAtWorldPoint(i),n=e.getUnitSizeAtWorldPoint(i),r=e.distanceToCenter(),a=n/s*r;return e.dolly(r-a),e.updateNearFar(),e}getDirectionToWorldPoint(e){return this.direction}setViewport(e){this.viewport=e.slice(0),this.updateViewportDiagonal(),this.correctAspectRatio(),this.updateMatrices()}correctAspectRatio(){const e=this.right-this.left,t=this.top-this.bottom,i=this.getViewportWidth(),s=this.getViewportHeight();if(0===i||0===s)return;let n,r;i<s?(n=e<t?1:t/e,r=n*e*s/(t*i)):(r=e<t?e/t:1,n=r*t*i/(e*s)),this.left*=n,this.right*=n,this.top*=r,this.bottom*=r}zoom(e){const t=this.right-this.left,i=this.top-this.bottom;this.left=-t*e*.5,this.right=t*e*.5,this.top=i*e*.5,this.bottom=-i*e*.5,this.updateMatrices()}getExtents(){return[this.left,this.bottom,-this.far,this.right,this.top,-this.near]}setExtents(e){this.left=e[0],this.right=e[3],this.bottom=e[1],this.top=e[4],this.updateMatrices()}setExtentsByComponent(e,t,i,s){this.left=e,this.right=t,this.bottom=i,this.top=s,this.updateMatrices()}zoomPoint(e,t,i,n){const r=o.vec3C.subtract(e,this.eye,s.vec3.create()),a=this.getRight(),c=s.vec3.dot(r,a),l=s.vec3.dot(r,this.up);o.vec3C.add(this.eye,o.vec3C.scale(a,-c*(i-1),s.vec3.create()),this.eye),o.vec3C.add(this.eye,o.vec3C.scale(this.up,-l*(i-1),s.vec3.create()),this.eye);const h=this.right-this.left,d=this.top-this.bottom;this.left=-h*i*.5,this.right=h*i*.5,this.top=d*i*.5,this.bottom=-d*i*.5,this.updateMatrices(),this.integrityCheck("zoomPoint")}ensureCameraIsOutsideSceneBounds(){if(!this.sceneBounds)return;const e=s.vec3.dot(this.direction,this.sceneBounds.center())-s.vec3.dot(this.direction,this.eye);o.vec3C.add(this.eye,o.vec3C.scale(this.direction,-(.6*this.sceneBounds.diameter()-e),s.vec3.create()),this.eye),this.integrityCheck("ensureCameraIsOutsideSceneBounds")}zoomToFit(e,t,i){let n;if(e instanceof Array)n=function(t){for(let i=0;i<e.length;i++)t(e[i])};else{if(!(e instanceof Function))return;n=e}t=t||1;const r=this.getRight(),a=this.getUp(),c=[1/0,1/0],l=[-1/0,-1/0],h=[0,0];if(n((function(e){h[0]=s.vec3.dot(r,e),h[1]=s.vec3.dot(a,e);for(let e=0;e<2;++e)h[e]<c[e]&&(c[e]=h[e]),h[e]>l[e]&&(l[e]=h[e])})),l[0]<c[0]||l[1]<c[1])return;let d=l[0]-c[0],u=l[1]-c[1];if(0===d&&0===u)return;0===d?d=u*this.DEFAULT_EXTENT_RATIO:0===u&&(u=d*this.DEFAULT_EXTENT_RATIO),this.eye=o.vec3C.add(o.vec3C.scale(r,.5*(c[0]+l[0]),s.vec3.create()),o.vec3C.scale(a,.5*(c[1]+l[1]),s.vec3.create())),this.ensureCameraIsOutsideSceneBounds(),this.right=.5*d*t,this.top=.5*u*t;let g=this.viewport[2]/this.viewport[3];i&&(g=i[2]/i[3]);const p=this.right/this.top/g;if(p>1?this.top*=p:this.right/=p,i){const e=2*this.right/i[2],t=(.5*this.viewport[2]-(i[0]+.5*i[2]))*e,n=(.5*this.viewport[3]-(i[1]+.5*i[3]))*e;o.vec3C.add(this.eye,o.vec3C.scale(r,t,s.vec3.create())),o.vec3C.add(this.eye,o.vec3C.scale(a,n,s.vec3.create())),this.right*=this.viewport[2]/i[2],this.top*=this.viewport[3]/i[3]}this.left=-this.right,this.bottom=-this.top,this.updateMatrices(),this.integrityCheck("zoomToFit")}}t.OrthographicCamera=h,t.getHudLayerDepthRange=function(e){const t=Math.min(e[2],e[3]);return[-.5*t,.5*t]};t.XrCamera=class extends l{constructor(){super(),this.viewMatrix=s.mat4.create()}setTransforms(e,t,i){s.mat4.multiply(this.viewMatrix,t,e),this.projectionMatrix=i,this.updateMatrixInverses(),s.vec3.set(this.TEMP_VEC3_0,0,0,0),o.mat4C.multiplyVec3(this.viewMatrixInverse,this.TEMP_VEC3_0,this.eye),s.vec4.set(this.TEMP_VEC4_0,0,0,-1,0),o.mat4C.multiplyVec4(this.viewMatrixInverse,this.TEMP_VEC4_0,this.TEMP_VEC4_1),s.vec3.copy(this.direction,this.TEMP_VEC4_1),s.vec4.set(this.TEMP_VEC4_0,0,1,0,0),o.mat4C.multiplyVec4(this.viewMatrixInverse,this.TEMP_VEC4_0,this.TEMP_VEC4_1),s.vec3.copy(this.up,this.TEMP_VEC4_1)}updateMatrices(){}}},972072:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.recordWebClientCapabilities=void 0;const s=i(114924),n=i(912057);t.recordWebClientCapabilities=function(e){const t={angleInstancedArrays:"ANGLE_instanced_arrays",extTextureFilterAnisotropic:"EXT_texture_filter_anisotropic",oesElementIndexUint:"OES_element_index_uint",oesStandardDerivatives:"OES_standard_derivatives",oesTextureFloat:"OES_texture_float",oesTextureFloatLinear:"OES_texture_float_linear",oesTextureHalfFloat:"OES_texture_half_float",oesTextureHalfFloatLinear:"OES_texture_half_float_linear",oesVertexArrayObject:"OES_vertex_array_object",compressedTextureS3tc:"WEBGL_compressed_texture_s3tc",depthTexture:"WEBGL_depth_texture",drawBuffers:"WEBGL_draw_buffers"};let i,r={};if(e){const n=(0,s.getRendererInfo)(e);for(i in r=n?{vendor:n.glVendor,renderer:n.glRenderer}:{vendor:"unavailable",renderer:"unavailable"},t){const s=t[i];r[i]=!!e.getExtension(s)}}else for(i in n.log.warn("No gl context was available when attempting to get renderer information"),r={vendor:"unsupported",renderer:"unsupported"},t)r[i]=!1;if(r.has3dMouse=(0,s.hasSpaceballConnected)(),r.screenWidth=window.screen.width,r.screenHeight=window.screen.height,r.devicePixelRatio=window.devicePixelRatio?window.devicePixelRatio:-1,window.localStorage)try{window.localStorage.setItem("webClientCapabilities",JSON.stringify(r))}catch(e){n.log.warn("Error writing client capabilities to local storage: "+e)}}},467155:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ConstructionPlaneDisplay=t.OutlineMeshId=t.PlaneMeshId=t.doesNodeContainPlaneEntities=t.PlaneProperties=t.ResizeManipulatorIds=t.compareOutlineNodeProperties=t.outlineNodeProperties=void 0;const s=i(114924),n=i(545348),r=i(550122),a=i(193786),o=i(873896),c=i(606544),l=i(264292),h=i(613199),d=n.default.getManager();t.outlineNodeProperties=new s.NodeProperties({isPickable:!0,isTwoSided:!0,isStencilWritten:!1,primitivesHaveTransparency:!0,primitiveType:s.PrimitiveType.LINES,material:s.UNLIT_COLOR_FROM_ATTRIBUTE,includedInBlend:!0}),t.compareOutlineNodeProperties=new s.NodeProperties({isPickable:!0,isTwoSided:!0,isTintedByCompare:!0,primitiveType:s.PrimitiveType.LINES,includedInBlend:!0});const u=l.vec3.create(),g=l.vec3.create(),p=l.vec3.create();var m;!function(e){e.TOP_LEFT="TOP_LEFT",e.TOP_RIGHT="TOP_RIGHT",e.BOTTOM_LEFT="BOTTOM_LEFT",e.BOTTOM_RIGHT="BOTTOM_RIGHT"}(m||(t.ResizeManipulatorIds=m={})),t.PlaneProperties=new s.NodeProperties({isPickable:!0,primitiveType:s.PrimitiveType.TRIANGLES,primitivesHaveTransparency:!0,material:s.UNLIT_COLOR_FROM_ATTRIBUTE,isTwoSided:!0,includedInBlend:!0,isTintedByCompare:!0,zOffset:n.default.getManager().getNumber("CPLANE_Z_OFFSET")}),t.doesNodeContainPlaneEntities=function(e){const i=e.getProperties().id;return i===t.PlaneProperties.id||i===t.compareOutlineNodeProperties.id||i===t.outlineNodeProperties.id},t.PlaneMeshId="quadFace",t.OutlineMeshId="outline";class E extends s.UIElement{constructor(e,t,i,n,r){super(r,i),this.textColorName=e,this.entityId=t,this.planeId=n,this.name="",this.center=l.vec3.create(),this.centerOffset=l.vec3.create(),this.xAxis=l.vec3.fromValues(1,0,0),this.yAxis=l.vec3.fromValues(0,1,0),this.lastSetAppearance=void 0,this.node=null,this.width=0,this.height=0,this.initialWidth=0,this.initialHeight=0,this.increments={},this.lastTextScale=-1,this.textTexture=null,this.resizeManipulators={},this.usage=i===s.PREVIEW_SCENEGRAPH_ID?s.BTGraphicsUsage.PREVIEW:s.BTGraphicsUsage.BASE,this.textMaterial=(0,s.createTextureMaterial)(),this.textNodeProperties=new s.NodeProperties({isPickable:!1,isTwoSided:!0,primitiveType:s.PrimitiveType.TRIANGLES,material:this.textMaterial,includedInBlend:!0}),this.occurrenceData.setCanIsolateChange(!0),this.occurrenceData.setIsolated(!1)}getDebugId(){return"ConstructionPlaneDisplay"}onDevicePixelRatioChanged(e){this.destroyText()}remove(){this.destroyText(),this.textMaterial&&(this.textMaterial.destroy(),this.textMaterial=null),this.removeResizeManipulators(),super.remove()}destroyText(){this.textTexture&&(this.textTexture.destroy(),this.textTexture=null)}setName(e){e=(0,r.truncate)(e,32),this.name!==e&&(this.destroyText(),(0,s.requestDraw)()),this.name=e}updateAppearance(e){if(e&&e instanceof c.BTFeaturePlaneAppearance){if(this.lastSetAppearance&&this.lastSetAppearance.equals(e))return;this.lastSetAppearance=e.clone(),this.width=e.width,this.height=e.height}else{if(null===this.lastSetAppearance)return;this.lastSetAppearance=null,this.width=this.initialWidth,this.height=this.initialHeight,this.centerOffset=[0,0,0]}this.updateDefinition(this.name,this.center,this.xAxis,this.yAxis,!0,!0),(0,s.requestDraw)()}updateDefinition(e,t,i,n,r,a){if(this.name===e&&l.vec3.equals(t,this.center)&&l.vec3.equals(i,this.xAxis)&&l.vec3.equals(n,this.yAxis)||(this.destroyText(),(0,s.requestDraw)()),a&&(0!==this.initialWidth||0!==this.initialHeight||l.vec3.equals(i,this.xAxis)||l.vec3.equals(n,this.yAxis))||(this.initialWidth=2*h.vec3C.length(i),this.initialHeight=2*h.vec3C.length(n)),this.width>0&&this.height>0&&(i=h.vec3C.scale(h.vec3C.normalize(i,l.vec3.create()),this.width/2,l.vec3.create()),n=h.vec3C.scale(h.vec3C.normalize(n,l.vec3.create()),this.height/2,l.vec3.create())),this.setName(e),this.center=t,this.xAxis=i,this.yAxis=n,(0,s.isUsageBase)()?r&&this.updateResizeManipulators(!1):this.removeResizeManipulators(),this.lastSetAppearance&&(!r||a)){const e=h.vec3C.normalize(h.vec3C.cross(this.xAxis,this.yAxis,l.vec3.create()),l.vec3.create());this.centerOffset=h.vec3C.subtract((0,s.planeToWorld)([this.lastSetAppearance.xOffset,this.lastSetAppearance.yOffset],this.center,e,h.vec3C.normalize(this.xAxis,l.vec3.create())),this.center,l.vec3.create())}this.updatePlaneGraphics(),this.isHidden&&this.hideIncrements()}updateResizeManipulators(e){const t=this,i=function(i,n,r){const a=h.vec3C.add(t.center,t.centerOffset,l.vec3.create()),o=h.vec3C.normalize(h.vec3C.cross(t.xAxis,t.yAxis,l.vec3.create())),c=h.vec3C.scale(t.xAxis,n,l.vec3.create()),d=h.vec3C.scale(t.yAxis,r,l.vec3.create()),u=h.vec3C.add(h.vec3C.add(a,c,l.vec3.create()),d,l.vec3.create());t.resizeManipulators[i]?t.resizeManipulators[i].updateDefinition(u,o,c,d):e&&(t.resizeManipulators[i]=new s.ResizeManipulator(i,u,o,t,c,d,t.viewer))};i(m.TOP_LEFT,-1,1),i(m.TOP_RIGHT,1,1),i(m.BOTTOM_LEFT,-1,-1),i(m.BOTTOM_RIGHT,1,-1)}removeResizeManipulators(){for(const e in this.resizeManipulators){const t=this.resizeManipulators[e];t&&(t.cleanup(),t.remove()),this.resizeManipulators[e]=null}}updateText(e){const t=this.getTextTexture(),i=h.vec3C.add(this.center,this.centerOffset,l.vec3.create()),n=h.vec3C.add(i,h.vec3C.scale(this.xAxis,-1,l.vec3.create()),l.vec3.create());h.vec3C.add(n,this.yAxis);const r=e.getPixelSizeAtWorldPoint(this.transformPoint(n));let a=r*t.filledWidthPx,c=r*t.filledHeightPx,d=Math.min(h.vec3C.length(this.xAxis)/a,h.vec3C.length(this.yAxis)/c);if(d<0&&(d=0),d<1&&(a*=d,c*=d),Math.abs(this.lastTextScale-d)<=o.Tolerances.ZERO_LENGTH)return;this.lastTextScale=d;const u=h.vec3C.normalize(this.xAxis,l.vec3.create()),g=h.vec3C.normalize(this.yAxis,l.vec3.create()),p=h.vec3C.add(n,h.vec3C.scale(g,-c,l.vec3.create()),l.vec3.create()),m=h.vec3C.add(p,h.vec3C.scale(u,a,l.vec3.create()),l.vec3.create()),E=h.vec3C.add(p,h.vec3C.scale(g,c,l.vec3.create()),l.vec3.create());this.updateMeshIncrement("quad",s.NO_SELECTION_ID,(0,s.createQuad)(p,m,E,void 0,[t.leftCoordinate,t.bottomCoordinate],[t.rightCoordinate,t.topCoordinate]),this.textNodeProperties),this.textMaterial.ambientTexture=t}updatePlaneGraphics(){const e=h.vec3C.add(this.center,this.centerOffset,l.vec3.create()),i=n.default.getManager(),r=i.getColor("CONSTRUCTION_PLANE_OUTLINE_COLOR"),a=i.getNumber("CONSTRUCTION_PLANE_OUTLINE_WIDTH"),o=(0,s.createQuadOutline)(e,this.xAxis,this.yAxis,r,a),c=(0,s.isUsageCompare)()?t.compareOutlineNodeProperties:t.outlineNodeProperties;this.updateMeshIncrement(t.OutlineMeshId,t.OutlineMeshId,o,c),this.increments[t.OutlineMeshId]=o;const d=h.vec3C.add(h.vec3C.add(e,h.vec3C.scale(this.xAxis,-1,l.vec3.create()),l.vec3.create()),this.yAxis,l.vec3.create()),u=h.vec3C.add(h.vec3C.add(e,h.vec3C.scale(this.xAxis,-1,l.vec3.create()),l.vec3.create()),h.vec3C.scale(this.yAxis,-1,l.vec3.create()),l.vec3.create()),g=h.vec3C.add(h.vec3C.add(e,this.xAxis,l.vec3.create()),h.vec3C.scale(this.yAxis,-1,l.vec3.create()),l.vec3.create()),p=(0,s.createQuad)(u,g,d);let m;if((0,s.isUsageCompare)()){const e=h.vec3C.cross(this.xAxis,this.yAxis,l.vec3.create()),t=(0,s.getBitForPlaneEquation)(this.center,e);(0,s.addPackedIntegerToIncrement)(t,p)}else{m=i.getColor("CONSTRUCTION_PLANE_AMBIENT_COLOR").slice(0),m[3]=i.getNumber("CONSTRUCTION_PLANE_OPACITY"),(0,s.addColorToIncrement)(m,p)}this.increments[t.PlaneMeshId]=p,this.updateMeshIncrement(t.PlaneMeshId,t.PlaneMeshId,p,t.PlaneProperties),this.invalidateTextGraphics()}getIncrement(e){return e&&this.increments[e]?this.increments[e].clone():this.increments[t.PlaneMeshId]?this.increments[t.PlaneMeshId].clone():null}getBounds(){const e=new s.BoundingBox,t=h.vec3C.add(this.center,this.centerOffset,u);for(let i=-1;i<=1;i+=2)for(let s=-1;s<=1;s+=2){const n=h.vec3C.add(h.vec3C.add(h.vec3C.scale(this.xAxis,i,g),h.vec3C.scale(this.yAxis,s,p)),t);e.addPoint(n)}return e}invalidateTextGraphics(){this.lastTextScale=-1}getTextTexture(){return this.textTexture||(this.textTexture=(0,s.createTextureFromText)(this.viewer,this.name,{color:d.getColor(this.textColorName),font:d.getString("PLANE_TEXT_FONT"),size:d.getNumber("PLANE_TEXT_HEIGHT_PX"),paddingWithinBorder:d.getNumber("PLANE_TEXT_BACKGROUND_PADDING")}),this.invalidateTextGraphics()),this.textTexture}onViewWillDraw(e,t){this.isHidden||this.name&&this.updateText(e)}canPickThrough(){return!0}getModelSelection(e){const i=e.uiElement.getUsage(),s=(0,a.createSelectionFromDeterministicId)(this.entityId,null,i);return s&&(s.sourcePick=e.sourcePick,s.secondarySelectionData={isFromPlaneEdge:e.selectionId===t.OutlineMeshId}),s}getPickPriority(e){return e.selectionId===t.OutlineMeshId?s.PickPriority.CONSTRUCTION_PLANE_EDGE:s.PickPriority.CONSTRUCTION_PLANE}getUsage(){return this.usage}addHighlight(e){this.addHighlightToIncrement(t.OutlineMeshId,e),this.addHighlightToIncrement(t.PlaneMeshId,e),e.type!==s.HighlightType.ENTITY&&e.type!==s.HighlightType.FEATURE||!(0,s.isUsageBase)()||this.isHidden||this.updateResizeManipulators(!0),(0,s.requestDraw)()}removeHighlight(e){return this.removeHighlightFromIncrement(t.OutlineMeshId,e),this.removeHighlightFromIncrement(t.PlaneMeshId,e),e.type!==s.HighlightType.ENTITY&&e.type!==s.HighlightType.FEATURE||this.removeResizeManipulators(),(0,s.requestDraw)(),!0}cloneForPreview(e){const t=(0,s.isUsageCompare)()?"CONSTRUCTION_PLANE_COMPARE_TEXT_COLOR":"CONSTRUCTION_PLANE_TEXT_COLOR",i=new E(t,this.entityId,s.PREVIEW_SCENEGRAPH_ID,e,this.viewer);return i.width=this.width,i.height=this.height,i.centerOffset=this.centerOffset,i.setName(this.name),i.updatePlaneGraphics(),i}isInteractionEnabled(){return!1}getCenter(){return l.vec3.fromValues(this.center[0],this.center[1],this.center[2])}getXAxis(){return l.vec3.fromValues(this.xAxis[0],this.xAxis[1],this.xAxis[2])}getYAxis(){return l.vec3.fromValues(this.yAxis[0],this.yAxis[1],this.yAxis[2])}getName(){return this.name}onAppearanceConstantsUpdated(){this.destroyText(),this.updatePlaneGraphics()}}t.ConstructionPlaneDisplay=E},778828:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.CursorAppendage=void 0;const n=i(142885),r=i(402198),a=i(32620),o=i(114924);class c extends n.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.mouseMoveTextCallback=t,this.APPENDAGE_ID="cursor-appendage-user",this.addListeners()}addListeners(){const e=this.viewer.getEventDispatcher();this.listenTo(e,o.CANVAS_MOUSEMOVE,this.onMouseMove),this.listenTo(e,o.CANVAS_MOUSELEAVE,this.onMouseLeave)}destroy(){this.removeContainer(),this.stopListening()}onMouseMove(e){const t=this.viewer.getCanvasCoordinateFromEvent(e);this.updatePosition([...t])}updatePosition(e){const t=this.mouseMoveTextCallback(e[0],e[1]);if(t){const i=(0,a.getDevicePixelRatio)(),s=[e[0]/i,e[1]/i],n=this.getContainer();n.text(t),n.css({left:s[0]+25+"px",top:s[1]+"px"})}else this.removeContainer()}onMouseLeave(e){this.removeContainer()}getContainer(){let e=s("#"+this.APPENDAGE_ID);return 0===e.length&&(e=s("<div></div>").appendTo((0,r.getDialogDragContainerElement)()),e.attr("class",c.CONTAINER_CLASS),e.attr("id",this.APPENDAGE_ID)),e}removeContainer(){s("#"+this.APPENDAGE_ID).remove()}}t.CursorAppendage=c,c.CONTAINER_CLASS="cursor-appendage"},246753:function(e,t,i){i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.collectGraphicsDataForHeapDump=t.TrackedGraphicsComponents=t.checkError=t.getGpuMemoryUsage=t.timeRendering=t.lastFrameTimeRendering=t.snapshotScenegraph=t.debugToPostOnLoad=t.isSceneDebuggerWindowLoaded=t.sceneDebuggerWindow=t.visualizePicks=t.visualizeCoordinateSystem=t.visualizeLine=t.visualizeDebugBox=t.visualizeDebugPoint=t.visualizeVisiblePicks=t.WEBGL_ERROR_LOG_TAG=void 0;const s=i(114924),n=i(545348),r=i(912057),a=i(997687),o=i(264292),c=i(613199);t.WEBGL_ERROR_LOG_TAG="WebGL Error: ";t.visualizeVisiblePicks=function(e){const t=e.getCamera(),i=e.retrieveVisiblePicks(0,0,t.getViewportWidth(),t.getViewportHeight());E(e,i)};const l=new s.NodeProperties({primitiveType:s.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,isPickable:!1}),h=new s.NodeProperties({primitiveType:s.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,isPickable:!1}),d=new Map;function u(e){let t=d.get(e);return t||(t=new s.UIElement(e),d.set(e,t)),t}let g=0;function p(e,t,i,r,a,o){const c=u(e),h=n.default.getManager(),d=(0,s.createPoint)(i,"p"+g++);(0,s.addColorToIncrement)(r||h.getColor("DEBUG_POINT_DEFAULT_COLOR"),d),(0,s.addSizeToIncrement)(a||h.getNumber("DEBUG_POINT_DEFAULT_SIZE"),d),(0,s.addStyleToIncrement)(o||h.getPointFont("DEBUG_POINT_DEFAULT_POINT_FONT"),d),c.updateMeshIncrement(t,s.NO_SELECTION_ID,d,l),e.requestDraw()}function m(e,t,i,n,r){const a=(0,s.createLine)(i,n,t,r);u(e).updateMeshIncrement(t,s.NO_SELECTION_ID,a,h),e.requestDraw()}function E(e,t){const i=n.default.getManager(),s=u(e),r=e.getCamera();s.removeMeshIncrements();const a=function(t,i,s,n,a){const o=r.canvasToWorld([i[0],i[1],.5]);p(e,t,o,s,n,a)};for(let e=0;e<t.length;++e){const s=t[e];let n=[1,1,1];const r=s.getEntityMetaData();r&&r.isVertex()?n=i.getColor("DEBUG_PICK_VERTEX_COLOR"):r&&r.isEdge()?n=i.getColor("DEBUG_PICK_EDGE_COLOR"):r&&r.isFace()&&(n=i.getColor("DEBUG_PICK_FACE_COLOR"));const l=c.vec3C.add(n,[.2,.2,.2],o.vec3.create());for(let t=0;t<s.locationSamples.length;++t)a(e+"."+t,s.locationSamples[t],l,i.getNumber("DEBUG_PICK_SAMPLE_SIZE"));a(e+".average",c.vec2C.scale(s.locationSum,1/s.locationCount,o.vec2.create()),c.vec3C.scale(n,.6,o.vec3.create()),i.getNumber("DEBUG_PICK_AVERAGE_SIZE"),i.getPointFont("DEBUG_PICK_POINT_AVERAGE_FONT")),a(e+".location",s.location,n,i.getNumber("DEBUG_PICK_SIZE"),i.getPointFont("DEBUG_PICK_POINT_FONT"))}e.requestDraw()}t.visualizeDebugPoint=p,t.visualizeDebugBox=function(e,t,i,r){const a=u(e),o=n.default.getManager(),c=(0,s.createWireBox)(i.getMin(),i.getMax());(0,s.addColorToIncrement)(r||o.getColor("DEBUG_BOUNDINGBOX_DEFAULT_COLOR"),c),a.updateMeshIncrement(t,s.NO_SELECTION_ID,c,h),e.requestDraw()},t.visualizeLine=m,t.visualizeCoordinateSystem=function(e,t,i){const s=n.default.getManager(),r=i.origin.getVec3(),a=100*e.getCamera().getPixelSizeAtWorldPoint(r);m(e,t+".xAxis",r,o.vec3.scaleAndAdd(o.vec3.create(),r,i.xAxis.getVec3(),a),s.getColor("DEBUG_X_AXIS_COLOR")),m(e,t+".yAxis",r,o.vec3.scaleAndAdd(o.vec3.create(),r,i.yAxis.getVec3(),a),s.getColor("DEBUG_Y_AXIS_COLOR")),m(e,t+".zAxis",r,o.vec3.scaleAndAdd(o.vec3.create(),r,i.zAxis.getVec3(),a),s.getColor("DEBUG_Z_AXIS_COLOR"))},t.visualizePicks=E,t.sceneDebuggerWindow=null,t.isSceneDebuggerWindowLoaded=!1,t.debugToPostOnLoad=null;let I=null;t.snapshotScenegraph=function(e){if(t.sceneDebuggerWindow&&t.sceneDebuggerWindow.closed&&(t.sceneDebuggerWindow=null,t.isSceneDebuggerWindowLoaded=!1),!t.sceneDebuggerWindow){t.sceneDebuggerWindow=window.open("/debugwindows/scenedebug.html");let e=0;const i=setInterval((function(){t.sceneDebuggerWindow.document&&"complete"===t.sceneDebuggerWindow.document.readyState&&(t.isSceneDebuggerWindowLoaded=!0,I&&(I(),I=null)),(t.isSceneDebuggerWindowLoaded||e++>200)&&clearInterval(i)}),200)}const i=(0,s.getViewerForDebugOrTestPurposes)(e&&e.useSheetMetalViewer),n=i.getSceneGraphs().getMainSceneGraph().makeSceneDebugObject(),r=i.getSceneGraphs().getPreviewSceneGraph().makeSceneDebugObject(),a=i.getSceneGraphs().getHudSceneGraph().makeSceneDebugObject(),o=i.getOccurrenceDataManager().makeSceneDebugObject(),c=location.protocol+"//"+location.hostname+(location.port?":"+location.port:""),l=function(){t.sceneDebuggerWindow.postMessage([o,n,r,a],c)};t.isSceneDebuggerWindowLoaded?l():I=l},t.lastFrameTimeRendering=0,t.timeRendering=function(e){e=e||{},t.lastFrameTimeRendering=0;let i=0,n=0;const o=e.numFrames?e.numFrames:720;let c=null;const l=(0,s.getViewerForDebugOrTestPurposes)(e.flat);l.draw(),l.setSuppressMouseMovePick(!0),l.completeTasks(),e.forceLowDetail&&l.detailManager.forceLowestDetailSettings();let h=0,d=[],u=[];const g=l.getGlContext();let p=[];if(e.timeShadersPrograms){const e=g.getProgramFlags().length;u=[],p=[],d=[];for(let t=0;t<e;t++)if(t in g.programNames){const i=new Array(e);for(let s=0;s<e;s++)i[s]=s===t;u.push(i),p.push(t)}let t,i=new Array(e);for(t=0;t<e;t++)i[t]=!1;for(u.push(i),i=new Array(e),t=0;t<e;t++)i[t]=!0;u.push(i),console.dir(u),h=0,g.setProgramFlags(u[0])}const m={performFrameTiming:!1},E=function(){const I=window.performance.now();if(c&&(i+=(I-c)/1e3,++n),c=I,n<o){const e=l.getPrimaryViewController();e.rotateAbout(.0698131701,[0,1,0],e.camera.focalPoint()),l.setUserIsAdjustingCamera(),l.forceRequestDraw(m)}else if(e.timeShadersPrograms&&h<u.length)d[h]=i/n*1e3,h++,h<u.length&&g.setProgramFlags(u[h]),i=0,n=0,c=null;else{l.getEventDispatcher().off(s.VIEW_DID_DRAW,E);const o=(n/i).toFixed(2);i=i.toFixed(2),t.lastFrameTimeRendering=1e3*i/n;const c="Rendered "+n+" frames in "+i+" seconds at "+o+" fps "+t.lastFrameTimeRendering.toFixed(2)+" ms frametime";if(a.btInjector.MessageBubbleService.showMessage(c),r.log.debug(c),l.setSuppressMouseMovePick(!1),e.timeShadersPrograms){for(let e=0;e<d.length-2;e++)p[e]in g.programNames&&r.log.debug("program "+e+" "+g.programNames[p[e]]+" "+d[e]+" ms");r.log.debug("no programs  "+d[d.length-2]+" ms"),r.log.debug("all programs "+d[d.length-1]+" ms")}e.browserProfile&&console.profile&&console.profileEnd()}};l.getEventDispatcher().on(s.VIEW_DID_DRAW,E),e.browserProfile&&console.profile&&console.profile(e.browserProfileName||"timeRendering"),E()},t.getGpuMemoryUsage=function(){const e=(0,s.getActiveViewer)();return e?(e.completeTasks(),e.getMemoryGauge().getUsageDetails()):null},t.checkError=function(e){const t=e.getError();if(t!==e.NO_ERROR){let i="Unknown: 0x"+t.toString(16);switch(t){case e.INVALID_ENUM:i="GL_INVALID_ENUM";break;case e.INVALID_VALUE:i="GL_INVALID_VALUE";break;case e.INVALID_OPERATION:i="GL_INVALID_OPERATION";break;case e.INVALID_FRAMEBUFFER_OPERATION:i="GL_INVALID_FRAMEBUFFER_OPERATION";break;case e.OUT_OF_MEMORY:i="GL_OUT_OF_MEMORY"}return r.log.warn("GL error: "+i),!0}return!1};class T{constructor(){this.meshIncrements=[],this.silhouetteIncrements=[],this.entityData=[],this.incrementDetails=[]}removeCrossReferences(){for(const e of this.entityData)e.setMeshIncrement(null),e.setBodyMetaData(null);for(const e of this.incrementDetails)e.increment=null}}t.TrackedGraphicsComponents=T,t.collectGraphicsDataForHeapDump=function(){const e=new T;(0,s.getActiveViewer)().getModelViewManagers().getManager().collectComponentsForHeapDump(e),e.removeCrossReferences(),window.trackedGraphicsComponents=e;let t=0;for(let i=0;i<e.meshIncrements.length;++i)t+=e.meshIncrements[i].getTriangleCount();r.log.info("Graphics triangle count: "+t+"\nGraphics body entity count: "+e.entityData.length)}},960233:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DetailManager=t.Settings=t.setupDatabase=t.database=t.getSettingsKey=t.ViewerUsage=t.log=t.logToInfo=void 0;const s=i(225072),n=i(736234),r=i(268154),a=i(607109),o=i(912057),c=i(723617),l=i(545348),h=i(114924),d=i(997687),u=i(805261),g=i(606544),p=i(649962);function m(e){t.logToInfo?o.log.info&&o.log.info(e):o.log.trace&&o.log.trace(e)}var E;function I(e,t,i,s){return e+"."+t+"."+i+"."+s}function T(){if((0,r.supportsIndexedDb)(window))try{let e=new a.default("GraphicsDetailSettings");e.version(1).stores({settings:"[viewerUsage+workspaceOrVersionId+elementId+modelUsage], enableSSAOFilter, enableEdgeSilhouettes, enableSSAO, enableBackfaceSilhouettes, enableLowestLodSwitching, enableSectionPlaneEdgeDetection"}),e.version(2).stores({settings:"[viewerUsage+workspaceOrVersionId+elementId+modelUsage], enableSSAOFilter, enableEdgeSilhouettes, enableSSAO, enableBackfaceSilhouettes, enableLowestLodSwitching, enableSectionPlaneEdgeDetection, lowLevelBodyProportion"}).upgrade((function(e){e.settings.toCollection().modify((function(e){e.lowLevelBodyProportion=0}))})),e.version(3).stores({settings:"[viewerUsage+workspaceOrVersionId+elementId+modelUsage], enableSSAOFilter, enableEdgeSilhouettes, enableSSAO, enableBackfaceSilhouettes, enableSectionPlaneEdgeDetection, lowLevelBodyProportion"}).upgrade((function(e){e.settings.toCollection().modify((function(e){delete e.enableLowestLodSwitching}))})),e.open().then((function(){m("Opened graphics detail database")})).catch((function(t){e=null,o.log.warn("Failed to open graphics detail database: "+t)})),t.database=e}catch(e){t.database=null,o.log.warn("Exception while creating settings database: "+e)}}t.logToInfo=!1,t.log=m,function(e){e.NORMAL="NORMAL",e.FLATTENED="FLATTENED"}(E||(t.ViewerUsage=E={})),t.getSettingsKey=I,t.database=null,t.setupDatabase=T,T();const S=l.default.getManager().getNumber("MAX_LOW_LEVEL_BODY_PROPORTION"),f=l.default.getManager().getNumber("LOW_LEVEL_BODY_PROPORTION_STEP");class C{constructor(e,t,i,s){this.CLONING_PROPERTIES_TO_SKIP={viewerUsage:!0,workspaceOrVersionId:!0,elementId:!0,modelUsage:!0,enableSSAOFilter:!0},this.enableSSAOFilter=!1,this.enableEdgeSilhouettes=!0,this.enableSSAO=!0,this.enableBackfaceSilhouettes=!0,this.lowLevelBodyProportion=0,this.enableSectionPlaneEdgeDetection=!0,this.viewerUsage=e||E.NORMAL,this.workspaceOrVersionId=t||"",this.elementId=i||"",this.modelUsage=s||g.GBTDisplayDataUsage.BASE}getKeyPath(){return[this.viewerUsage,this.workspaceOrVersionId,this.elementId,this.modelUsage]}getKeyString(){return I(this.viewerUsage,this.workspaceOrVersionId,this.elementId,this.modelUsage)}persistSettings(){t.database?(m("Saving detail settings for "+this.getKeyString()),t.database.settings.put(this).catch((function(e){m("Save failed: "+e)}))):m("Database not available for persisting settings "+this.getKeyString())}updateFromDatabase(e){const i=s.defer();return t.database?t.database.settings.get(this.getKeyPath()).then((t=>{t?(m("Got saved details settings for "+this.getKeyString()+": "+JSON.stringify(t)),(0,c.overwriteMatchingProperties)(this,t)):(e?(m("No saved details settings for "+this.getKeyString()+" - initializing from "+e.getKeyString()),(0,c.overwriteMatchingProperties)(this,e,this.CLONING_PROPERTIES_TO_SKIP)):m("No saved details settings for "+this.getKeyString()+" - creating new settings"),this.persistSettings())})).catch((function(e){o.log.info("Failed to retrieve graphics detail settings: "+e)})).finally((function(){i.resolve()})):(m("Settings database not available for updating settings"),i.resolve()),i.promise}decreaseDetail(){let e=!1;return this.enableEdgeSilhouettes||this.enableSectionPlaneEdgeDetection?(this.enableEdgeSilhouettes=!1,this.enableSectionPlaneEdgeDetection=!1,e=!0,m("Decreasing graphics detail: dropped edge-based silhouettes and section plane edges")):this.enableSSAO?(this.enableSSAO=!1,e=!0,m("Decreasing graphics detail: dropped ambient occlusion")):this.enableBackfaceSilhouettes?(this.enableBackfaceSilhouettes=!1,e=!0,m("Decreasing graphics detail: dropped image-based silhouettes")):this.lowLevelBodyProportion<S&&(this.lowLevelBodyProportion=Math.min(this.lowLevelBodyProportion+f,S),m("Decreasing graphics detail: Increased lowest LOD proportion to: "+this.lowLevelBodyProportion),e=!0),e&&this.persistSettings(),e}increaseDetail(e,t){let i=!1;this.lowLevelBodyProportion>0?(this.lowLevelBodyProportion=Math.max(0,this.lowLevelBodyProportion-f),m("Increasing graphics detail: decreased lowest LOD proportion to: "+this.lowLevelBodyProportion),i=!0):!this.enableBackfaceSilhouettes&&t?(this.enableBackfaceSilhouettes=!0,i=!0,m("Increasing graphics detail: adding image-based silhouettes")):!this.enableSSAO&&e?(this.enableSSAO=!0,i=!0,m("Increasing graphics detail: enabled ambient occlusion")):!this.enableEdgeSilhouettes&&t?(this.enableEdgeSilhouettes=!0,i=!0,m("Increasing graphics detail: enabled edge based silhouette edges")):this.enableSectionPlaneEdgeDetection||(this.enableSectionPlaneEdgeDetection=!0,i=!0,m("Increasing graphics detail: enabled section plane edges")),i&&this.persistSettings()}}t.Settings=C;t.DetailManager=class{constructor(e,t,i){this.AnalyticsService=e,this.viewer=t,this.frameTimer=i,this.REDUCTION_THRESHOLD_MS=1e3/l.default.getManager().getNumber("DETAIL_REDUCTION_THRESHOLD_FPS"),this.ENHANCEMENT_THRESHOLD_MS=1e3/l.default.getManager().getNumber("DETAIL_ENHANCEMENT_THRESHOLD_FPS"),this.FULL_DETAIL_OCCURRENCE_REDUCTION_THRESHOLD=l.default.getManager().getNumber("FULL_DETAIL_OCCURRENCE_REDUCTION_THRESHOLD"),this.RENDER_PERFORMANCE_WARNING_TIMEOUT_SECONDS=l.default.getManager().getNumber("RENDER_PERFORMANCE_WARNING_TIMEOUT_SECONDS"),this.RENDER_PERFORMANCE_CLEAR_WARNING_TIMEOUT_SECONDS=l.default.getManager().getNumber("RENDER_PERFORMANCE_CLEAR_WARNING_TIMEOUT_SECONDS"),this.detailSettings={},this.activeInteractiveKey="",this.lastInteractiveTimingActedOn=-1,this.overrideSettings=null,this.disableInterativeUpdates=!1,this.renderingPerformanceMessageEnabled=!0,this.renderingPerformanceMessageTimeout=null,this.clearRenderingPerformanceMessageTimeout=null,this.clientVersion=null,this.viewerUsage=t.getIsForFlattenedDisplay()?E.FLATTENED:E.NORMAL,this.detailSettings[p.FrameType.FULL]=new C(this.viewerUsage),this.detailSettings[p.FrameType.FULL].enableSSAOFilter=!0}onSettingStateChange(){const e=d.btInjector.StateParameterService.workspaceId()||d.btInjector.StateParameterService.versionId()||"",t=d.btInjector.StateParameterService.elementId()||"",i=(0,h.getLatestDisplayDataUsage)(),s=I(this.viewerUsage,e,t,i);s!==this.activeInteractiveKey&&(m("Switching to detail settings for "+s),this.activeInteractiveKey=s,this.lastInteractiveTimingActedOn=-1)}ensureInteractiveSettingsExist(){if(this.detailSettings[this.activeInteractiveKey]){const e=s.defer();return e.resolve(),e.promise}{const e=d.btInjector.StateParameterService.workspaceId()||d.btInjector.StateParameterService.versionId()||"",t=d.btInjector.StateParameterService.elementId()||"",i=(0,h.getLatestDisplayDataUsage)();m("Initializing detail settings for "+this.activeInteractiveKey);const s=I(this.viewerUsage,e,t,g.GBTDisplayDataUsage.BASE),n=this.detailSettings[s]||this.detailSettings[p.FrameType.FULL],r=new C(this.viewerUsage,e,t,i);return this.detailSettings[this.activeInteractiveKey]=r,r.updateFromDatabase(n).then((()=>{r.enableSSAO&&!this.isInteractiveSsaoEnabled()&&(m("Ambient occlusion disabled for interactive frames due to performance issues"),r.enableSSAO=!1),!r.enableBackfaceSilhouettes&&!r.enableEdgeSilhouettes||this.areInteractiveSilhouettesEnabled()||(m("Silhouette Edges disabled for interactive frames due to performance issues"),r.enableBackfaceSilhouettes=!1,r.enableEdgeSilhouettes=!1)}))}}forceLowestDetailSettings(e){this.ensureInteractiveSettingsExist();const t=this.detailSettings[this.activeInteractiveKey];t.enableSSAOFilter=!1,t.enableEdgeSilhouettes=!1,t.enableSSAO=!1,t.enableBackfaceSilhouettes=!1,t.enableSectionPlaneEdgeDetection=!1,t.lowLevelBodyProportion=S,e&&t.persistSettings()}increaseDetail(){this.disableInterativeUpdates=!0,this.detailSettings[this.activeInteractiveKey].increaseDetail(this.isInteractiveSsaoEnabled(),this.areInteractiveSilhouettesEnabled())}decreaseDetail(){this.disableInterativeUpdates=!0,this.detailSettings[this.activeInteractiveKey].decreaseDetail()}getDetailSettings(){if(this.overrideSettings)return this.overrideSettings;let e=p.FrameType.FULL;return this.frameTimer.userIsInteracting()?(this.updateInteractiveSettings(),e=this.activeInteractiveKey):this.frameTimer.userIsManipulating()&&(e=this.activeInteractiveKey),this.detailSettings[e]?this.detailSettings[e]:(o.log.warn("Could not find detail settings for key: "+e),this.detailSettings[p.FrameType.FULL])}getInteractiveSettings(){return this.ensureInteractiveSettingsExist(),this.detailSettings[this.activeInteractiveKey]}updateInteractiveSettings(){if(this.disableInterativeUpdates)return;this.ensureInteractiveSettingsExist();const e=this.frameTimer.getDrawLoopDetails(p.FrameType.INTERACTIVE),t=this.frameTimer.getTimingDetails(p.FrameType.INTERACTIVE);if(this.lastInteractiveTimingActedOn<0)return void(this.lastInteractiveTimingActedOn=t.timingCount);const i=t.timingCount-this.lastInteractiveTimingActedOn;if(e.averageTime>this.REDUCTION_THRESHOLD_MS)this.detailSettings[this.activeInteractiveKey].decreaseDetail(),e.reset();else if(i>=2)if(t.averageTime>this.REDUCTION_THRESHOLD_MS){const e=this.detailSettings[this.activeInteractiveKey].decreaseDetail();this.lastInteractiveTimingActedOn=t.timingCount,e&&!(0,h.isRunningIntelGpu)(this.viewer.getGlContext())||this.startRenderingPerformanceMessageTimeout()}else t.averageTime<this.ENHANCEMENT_THRESHOLD_MS?(this.detailSettings[this.activeInteractiveKey].increaseDetail(this.isInteractiveSsaoEnabled(),this.areInteractiveSilhouettesEnabled()),this.lastInteractiveTimingActedOn=t.timingCount,this.startClearRenderingPerformanceMessageTimeout()):this.startClearRenderingPerformanceMessageTimeout()}isInteractiveFramerateBelowThreshold(){const e=this.frameTimer.getDrawLoopDetails(p.FrameType.INTERACTIVE),t=this.frameTimer.getTimingDetails(p.FrameType.INTERACTIVE);return e.timingCount>0&&e.averageTime>this.REDUCTION_THRESHOLD_MS||t.timingCount>0&&t.averageTime>this.REDUCTION_THRESHOLD_MS}isInteractiveSsaoEnabled(){if((0,r.isPlatformMetaQuest)())return!1;const e=this.viewer.getRendererInfo();if(!e)return!0;const t=/AMD/gi.test(e.glRenderer)||(0,r.isBrowserFirefox)()&&/Radeon/gi.test(e.glRenderer)&&/ATI Technologies/gi.test(e.glVendor),i=/Apple GPU/gi.test(e.glRenderer);return!((0,r.isPlatformMac)()&&(t||i&&(0,r.isBrowserSafari)()))}areInteractiveSilhouettesEnabled(){return!(0,r.isBrowserSafari)()||15!==(0,r.getSafariVersion)()}setOverrideSettings(e){this.overrideSettings=e}updateFromLoadedScene(){const e=this.viewer.getModelViewManagers().getManager().getModelStatistics(!1),t=e.partOccurrences+e.surfaceOccurrences+e.curveOccurrences,i=this.detailSettings[p.FrameType.FULL],s=!i.enableEdgeSilhouettes;t>=this.FULL_DETAIL_OCCURRENCE_REDUCTION_THRESHOLD?(s||m("Reducing full detail rendering settings due to large occurrence count: "+t),i.enableEdgeSilhouettes=!1,i.enableSSAO=!1,i.enableBackfaceSilhouettes=!1,i.enableSectionPlaneEdgeDetection=!1,this.viewer.getSilhouetteTask().clearPendingRequests()):(s&&m("Increasing full detail rendering settings due to smaller occurrence count: "+t),i.enableEdgeSilhouettes=!0,i.enableSSAO=!0,i.enableBackfaceSilhouettes=!0,i.enableSectionPlaneEdgeDetection=!0)}areFullDetailEdgeSilhouettesEnabled(){return this.detailSettings[p.FrameType.FULL].enableEdgeSilhouettes}getClientVersion(){if(!this.clientVersion){const e=d.btInjector.ClientVersionService.getRunningVersion(),t=e.match(new RegExp("(\\d+\\.\\d+)","i"));t&&t.length>0?this.clientVersion=t[0]:this.clientVersion=e}return this.clientVersion}setRenderingPerformanceMessageEnabled(e){this.renderingPerformanceMessageEnabled=e}startRenderingPerformanceMessageTimeout(){if((0,n.isNumber)(this.clearRenderingPerformanceMessageTimeout)&&(window.clearTimeout(this.clearRenderingPerformanceMessageTimeout),this.clearRenderingPerformanceMessageTimeout=null),!this.renderingPerformanceMessageEnabled||(0,n.isNumber)(this.renderingPerformanceMessageTimeout)||this.viewer.hasPendingBodiesToLoad()||this.viewer.getIsForFlattenedDisplay())return;const e=""+(0,r.getBrowserMajorVersion)(),t=this.getClientVersion();window.localStorage.getItem("osRenderPerformanceMessageBrowserVersion")===e&&window.localStorage.getItem("osRenderPerformanceMessageClientVersion")===t||(m("Starting render performance message timeout"),this.renderingPerformanceMessageTimeout=window.setTimeout((()=>{window.localStorage.setItem("osRenderPerformanceMessageBrowserVersion",e),window.localStorage.setItem("osRenderPerformanceMessageClientVersion",t);const i=d.btInjector.MessageBubbleService.createMessageBubble();i.showMessage(i18n("Reduced rendering performance detected."),null,i18n("Check system compatibility in a new tab")).then((()=>{this.AnalyticsService.trackEventForDocumentId("PERFORMANCE_MESSAGE","render_performance_action_click",(0,u.getModelId)());const e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/check";window.open(e),i.dismissMessage()})),this.AnalyticsService.trackEventForDocumentId("PERFORMANCE_MESSAGE","render_performance_warning",(0,u.getModelId)()),this.renderingPerformanceMessageTimeout=null}),1e3*this.RENDER_PERFORMANCE_WARNING_TIMEOUT_SECONDS))}startClearRenderingPerformanceMessageTimeout(e){!e&&(0,h.isRunningIntelGpu)(this.viewer.getGlContext())||(0,n.isNumber)(this.clearRenderingPerformanceMessageTimeout)||!(0,n.isNumber)(this.renderingPerformanceMessageTimeout)||(m("Starting clear render performance message timeout"),this.clearRenderingPerformanceMessageTimeout=window.setTimeout((()=>{(0,n.isNumber)(this.renderingPerformanceMessageTimeout)&&(window.clearTimeout(this.renderingPerformanceMessageTimeout),this.renderingPerformanceMessageTimeout=null,m("Cleared performance message timeout")),this.clearRenderingPerformanceMessageTimeout=null}),1e3*this.RENDER_PERFORMANCE_CLEAR_WARNING_TIMEOUT_SECONDS))}}},952180:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createDimensionForDisplayData=t.CountDimension=t.CurveLengthDimension=t.RhoDimension=t.PointDimension=t.ArcLengthDimension=t.AngularDimension=t.RadialDimension=t.PolarDimension=t.EllipseDiameterDimension=t.CenterlineDimension=t.LinearDimension=t.Arc=t.Dimension=t.setShowDimensionsMode=t.setDimensionToolActive=t.setInteractionEnabled=void 0;const s=i(736234),n=i(545348),r=i(955516),a=i(997687),o=i(845556),c=i(606544),l=i(573879),h=i(223456),d=i(32620),u=i(873896),g=i(973008),p=i(114924),m=i(264292),E=i(613199),I=i(550122),T=i(912057),S="value",f="expression",C="icon",P="line";let v=!1,D=!1,M=!1;t.setInteractionEnabled=function(e){v=e},t.setDimensionToolActive=function(e){D=e},t.setShowDimensionsMode=function(e){M=e};const y={isVisible:!0,isTwoSided:!0,priority:p.RenderOrderPriority.HIGHER,primitiveType:p.PrimitiveType.TRIANGLES},O=[Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!0},y),Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!1},y)],_="value",A="expression",R="icon",N="arc_length",w={isVisible:!0,isTwoSided:!0,priority:p.RenderOrderPriority.LOWER,primitiveType:p.PrimitiveType.LINES},b=[new p.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!0},w)),new p.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1,isPickable:!1},w))],L="arrows",B={isVisible:!0,isPickable:!1,isTwoSided:!0,priority:p.RenderOrderPriority.LOWER,material:p.UNLIT_COLOR_FROM_ATTRIBUTE,primitiveType:p.PrimitiveType.TRIANGLES},F=[new p.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1},B)),new p.NodeProperties(Object.assign({isShowThrough:!0,isDepthTested:!1},B))],x="witness0",U="witness1",G="dimensionLine0",V=1.25*u.Tolerances.MAX_MODEL_SIZE,H=/[\+\-\*\/\^\(\)]/;var k;!function(e){e[e.VALUE_ONLY=0]="VALUE_ONLY",e[e.WITH_VARIABLES=1]="WITH_VARIABLES",e[e.WITHOUT_VARIABLES=2]="WITHOUT_VARIABLES"}(k||(k={}));const W=n.default.getManager();function z(e,t){return e===k.VALUE_ONLY?"":"expression-"+(e===k.WITH_VARIABLES?"external":"internal")+(t?":bad":":normal")}function j(e){const t=(e,t)=>{const i=new p.ImageData;return i.id=z(e,t),i.imageName=function(e,t){if(e===k.VALUE_ONLY)return"";let i=e===k.WITH_VARIABLES?"dimension-expression":"function";return t&&(i+="-error"),i+=".svg",i}(e,t),i},i=[t(k.WITH_VARIABLES,!1),t(k.WITHOUT_VARIABLES,!1),t(k.WITH_VARIABLES,!0),t(k.WITHOUT_VARIABLES,!0)];return(0,p.createAtlasFromResources)(e,W.getNumber("DIMENSION_ICON_SIZE_PIXELS"),i,{sourcesHaveTransparency:!0})}const X=[];function q(e,t){const i=e.getResources(),s=(0,d.getDevicePixelRatio)();if(null!=i.dimensionAtlas&&i.dimensionAtlasCurrentPixelRatio===s||X.push(t),i.dimensionAtlasTargetPixelRatio===s)return;i.dimensionAtlasTargetPixelRatio=s;e.getTextureAtlasFactory().getAtlas("DIMENSION_ATLAS",j.bind(void 0,e)).then((e=>{var t;i.dimensionAtlasTargetPixelRatio===s&&(i.dimensionAtlasCurrentPixelRatio=s,null===(t=i.dimensionAtlas)||void 0===t||t.texture.destroy(),i.dimensionAtlas=e,i.dimensionMaterial.ambientTexture=e.texture,X.forEach((e=>e())),X.length=0)}),(e=>T.log.error(e)))}class Y extends p.UIElement{constructor(e,t,i){super(e),this.displayData=null,this.updateOnNextDraw=!0,this.lastPixelSizeWorld=0,this.lastFlips=[],this.isBad=!1,this.isDriven=!1,this.value=0,this.expression="",this.expressionType=k.VALUE_ONLY,this.hovered=!1,this.isConfigured=!1,this.lastValueProperties=null,this.lastExpressionProperties=null,this.valueTexture=null,this.expressionTexture=null,this.textDragging=!1,this.textDragOffset=m.vec2.create(),this.preferences=null,this.selected=!1,this.pushedMoveCursor=!1,this.forPreview=null!=t&&t,this.listenTo(this,p.UiEvents.MOUSE_ENTER+P,this.onMouseEnterLines),this.listenTo(this,p.UiEvents.MOUSE_LEAVE+P,this.onMouseLeaveLines),this.listenTo(this,p.UiEvents.CLICK+P,this.onClick),this.listenTo(this,p.UiEvents.SELECT+P,this.onSelect),this.listenTo(this,p.UiEvents.DESELECT+P,this.onDeselect),this.listenTo(this,p.UiEvents.MOUSE_ENTER+S,this.onMouseEnterText),this.listenTo(this,p.UiEvents.MOUSE_ENTER+f,this.onMouseEnterText),this.listenTo(this,p.UiEvents.MOUSE_ENTER+C,this.onMouseEnterText),this.listenTo(this,p.UiEvents.MOUSE_LEAVE+S,this.onMouseLeaveText),this.listenTo(this,p.UiEvents.MOUSE_LEAVE+f,this.onMouseLeaveText),this.listenTo(this,p.UiEvents.MOUSE_LEAVE+C,this.onMouseLeaveText),this.listenTo(this,p.UiEvents.CLICK+S,this.onClick),this.listenTo(this,p.UiEvents.CLICK+f,this.onClick),this.listenTo(this,p.UiEvents.CLICK+C,this.onClick),this.listenTo(this,p.UiEvents.SELECT+S,this.onSelect),this.listenTo(this,p.UiEvents.SELECT+f,this.onSelect),this.listenTo(this,p.UiEvents.SELECT+C,this.onSelect),this.listenTo(this,p.UiEvents.DESELECT+S,this.onDeselect),this.listenTo(this,p.UiEvents.DESELECT+f,this.onDeselect),this.listenTo(this,p.UiEvents.DESELECT+C,this.onDeselect),this.listenTo(this,p.UiEvents.DOUBLE_CLICK+P,this.onDoubleClick),this.listenTo(this,p.UiEvents.DOUBLE_CLICK+S,this.onDoubleClick),this.listenTo(this,p.UiEvents.DOUBLE_CLICK+f,this.onDoubleClick),this.listenTo(this,p.UiEvents.DOUBLE_CLICK+C,this.onDoubleClick),this.listenTo(this,p.UiEvents.DRAG_START+S,this.onDragStartText),this.listenTo(this,p.UiEvents.DRAG_START+f,this.onDragStartText),this.listenTo(this,p.UiEvents.DRAG_START+C,this.onDragStartText),this.listenTo(this,p.UiEvents.DRAG+S,this.onDragText),this.listenTo(this,p.UiEvents.DRAG+f,this.onDragText),this.listenTo(this,p.UiEvents.DRAG+C,this.onDragText),this.listenTo(this,p.UiEvents.DRAG_STOP+S,this.onDragStopText),this.listenTo(this,p.UiEvents.DRAG_STOP+f,this.onDragStopText),this.listenTo(this,p.UiEvents.DRAG_STOP+C,this.onDragStopText),this.listenTo(this.viewer.getEventDispatcher(),p.DIMENSION_EDIT_CLOSED,this.onDimensionEditClosed),this.listenTo(this.viewer.getEventDispatcher(),p.SHOW_DIMENSION_EXPRESSIONS_CHANGED,this.onShowExpressionsChanged),this.elementId=null!=i?i:"",this.valueMaterial=(0,p.createTextureMaterial)(),this.expressionMaterial=(0,p.createTextureMaterial)(),this.dimensionMatrix=m.mat4.create(),this.planeMatrix=m.mat4.create(),this.computedInverse=m.mat4.create(),this.appliedTransform=m.mat4.create();const n=(0,s.clone)(O[0]),r=(0,s.clone)(O[1]);t&&(n.priority=p.RenderOrderPriority.HIGHEST,r.priority=p.RenderOrderPriority.HIGHEST),this.valueNodeProperties=[new p.NodeProperties(Object.assign({material:this.valueMaterial},n)),new p.NodeProperties(Object.assign({material:this.valueMaterial},r))],this.expressionNodeProperties=[new p.NodeProperties(Object.assign({material:this.expressionMaterial},n)),new p.NodeProperties(Object.assign({material:this.expressionMaterial},r))],q(this.viewer,this.onTextureAtlasChanged)}isDimension(){return!0}hide(){super.hide(),this.hovered=!1,this.selected=!1,this.textDragging=!1}setAppliedTransform(e){this.appliedTransform=e,E.mat4C.inverse(this.getPlaneMatrix(),this.computedInverse)}getPlaneMatrix(){return E.mat4C.multiply(this.appliedTransform,this.planeMatrix,m.mat4.create())}getPlaneMatrixInverse(){return this.computedInverse}onDevicePixelRatioChanged(e){this.lastValueProperties&&(this.valueTexture=null,this.updateRawValueTexture(this.lastValueProperties.textRendered)),this.lastExpressionProperties&&(this.expressionTexture=null,this.updateRawExpressionTexture(this.lastExpressionProperties.textRendered)),q(this.viewer,this.onTextureAtlasChanged)}remove(){this.hovered&&!M&&this.viewer.popCursor(),this.pushedMoveCursor&&this.removeMoveCursor(),this.destroyValueTexture(),this.valueMaterial&&(this.valueMaterial.destroy(),this.valueMaterial=null),this.destroyExpressionTexture(),this.expressionMaterial&&(this.expressionMaterial.destroy(),this.expressionMaterial=null),super.remove()}hasValueChanged(e){return null==this.valueTexture||null==this.lastValueProperties||this.lastValueProperties.textRendered!==e||this.lastValueProperties.isBad!==this.isBad||this.lastValueProperties.hoveredOrTextDragging!==(this.hovered||this.textDragging)||this.lastValueProperties.isDriven!==this.isDriven||this.lastValueProperties.isConfigured!==this.isConfigured}hasExpressionChanged(e){return null==this.expressionTexture||null==this.lastExpressionProperties||this.lastExpressionProperties.textRendered!==e||this.lastExpressionProperties.isBad!==this.isBad||this.lastExpressionProperties.hoveredOrTextDragging!==(this.hovered||this.textDragging)||this.lastExpressionProperties.selected!==this.selected}getPickPriority(e){return D?p.PickPriority.REDUCED_DIMENSION_PRIORITY:p.PickPriority.DIMENSION}updateDimensionMatrices(){this.displayData&&(this.updateOnNextDraw=!0,this.dimensionMatrix=this.displayData.coordinateSystem.getGlMatrix(),this.planeMatrix=this.displayData.planeMatrix.getGlMatrix(),E.mat4C.inverse(this.getPlaneMatrix(),this.computedInverse),this.value=this.displayData.value)}getFeatureId(){return this.displayData?this.displayData.featureId:""}getElementId(){return this.elementId}getDimensionId(){return this.displayData?this.displayData.id:""}getParameterId(){return this.displayData?this.displayData.parameterId:""}canPickThrough(){return!this.isInteractionEnabled()||D}isInteractionEnabled(){return!this.forPreview&&v}isForPreview(){return this.forPreview}isSelected(){return this.selected}destroyAllTextures(){this.destroyValueTexture(),this.destroyExpressionTexture()}destroyValueTexture(){this.valueTexture&&(this.valueTexture.destroy(),this.valueTexture=null,this.updateOnNextDraw=!0)}destroyExpressionTexture(){this.expressionTexture&&(this.expressionTexture.destroy(),this.expressionTexture=null,this.updateOnNextDraw=!0)}onDefaultUnitsChanged(){this.destroyAllTextures(),this.viewer.requestDraw()}onTextureAtlasChanged(){this.expressionType!==k.VALUE_ONLY&&(this.updateOnNextDraw=!0,this.viewer.requestDraw())}onViewWillDraw(e,t){if(this.isHidden||!this.displayData)return;const i=this.getPosition(),s=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(i[0],i[1]))),n=(0,p.orientText)(e,this.getVisualRightVector(),this.getVisualUpVector(),this.transform),r=this.preferences&&this.preferences.displayLimitRangeTicks;(this.updateOnNextDraw||Math.abs(this.lastPixelSizeWorld-s)>u.Tolerances.ZERO_LENGTH||!(0,l.arraysEqual)(this.lastFlips,n)||r)&&(this.update(e,t),this.updateOnNextDraw=!1,this.lastPixelSizeWorld=s,this.lastFlips=n)}textIsReadOnly(){var e,t;return null!==(t=null===(e=this.preferences)||void 0===e?void 0:e.textReadOnly)&&void 0!==t&&t}onMouseEnterText(e,t){this.textIsReadOnly()||(this.hovered=!0,this.destroyAllTextures(),this.pushMoveCursor(),(0,p.requestDraw)())}onMouseLeaveText(e,t){this.textIsReadOnly()||(this.hovered=!1,this.destroyAllTextures(),this.removeMoveCursor(),(0,p.requestDraw)())}pushMoveCursor(){M||this.pushedMoveCursor||(this.viewer.pushCursor(p.Cursor.MOVE),this.pushedMoveCursor=!0)}removeMoveCursor(){this.pushedMoveCursor&&(this.viewer.removeTopOccurrenceOfCursor(p.Cursor.MOVE),this.pushedMoveCursor=!1)}onDoubleClick(e,t){if(a.btInjector.FeatureConfigurationService.getIsInConfigureFeatureMode())return;if(this.isConfigured)return void a.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("Configured dimensions can be edited in the configuration table"));if(this.textIsReadOnly())return;const i=this.getLabelCanvasCoordinates();this.viewer.getEventDispatcher().trigger(p.DIMENSION_TEXT_DOUBLE_CLICKED,{featureId:this.getFeatureId(),dimensionId:this.getDimensionId(),parameterId:this.getParameterId(),positionX:i[0],positionY:i[1],dimension:this}),(0,p.requestDraw)()}onDragStartText(e,t,i){if(M)return;const s=this.mouseToDimensionCoordinates(t.mouseX,t.mouseY,t.camera);s?m.vec2.subtract(this.textDragOffset,s,this.getPosition()):m.vec2.zero(this.textDragOffset),this.textDragging=!0,this.destroyAllTextures(),i.requestDrag=!0}onDragText(e,t){if(M)return;const i=this.mouseToDimensionCoordinates(t.mouseX,t.mouseY,t.camera);i&&(m.vec2.subtract(i,i,this.textDragOffset),this.setPosition(i),this.updateOnNextDraw=!0,(0,p.requestDraw)())}onMouseEnterLines(e,t){this.textIsReadOnly()||(this.hovered=!0,this.destroyAllTextures(),M||this.viewer.pushCursor(p.Cursor.DEFAULT),(0,p.requestDraw)())}onMouseLeaveLines(e,t){this.textIsReadOnly()||(this.hovered=!1,this.destroyAllTextures(),M||this.viewer.removeTopOccurrenceOfCursor(p.Cursor.DEFAULT),(0,p.requestDraw)())}onClick(e,t,i){M||(i.requestSelectedStatus=!0);const s=this.getLabelCanvasCoordinates();this.viewer.getEventDispatcher().trigger(p.DIMENSION_TEXT_SINGLE_CLICKED,{featureId:this.getFeatureId(),dimensionId:this.getDimensionId(),parameterId:this.getParameterId(),positionX:s[0],positionY:s[1],dimension:this})}onSelect(e,t){a.btInjector.CapabilitiesService.checkConstraintManagerCurrentlyEnabled()&&(0,p.getActiveViewerEventDispatcher)().trigger(p.PICK_CONSTRAINT_SELECTED,e.sourcePick),this.selected=!0,this.destroyAllTextures(),(0,p.requestDraw)()}onDeselect(e,t){this.selected=!1,this.destroyAllTextures(),(0,p.requestDraw)()}onDragStopText(e,t){const i=r.BTMessageConnection.getConnection(r.MainConnectionName);if(!i)return;if(M)return;if(""===this.getElementId())return;const s=this.getLabelPositionInPlane(),n=new c.BTUiSketchPositionDimensionCall;n.entityId=this.getDimensionId(),n.elementId=this.getElementId(),n.labelX=s[0],n.labelY=s[1],n.parameterName=this.getParameterId(),n.editDescription=n.constructEditMessage("Drag","dimension"),i.send(n),this.textDragging=!1,m.vec2.zero(this.textDragOffset),this.destroyAllTextures()}onDimensionEditClosed(e){!this.textIsReadOnly()&&this.hovered&&!M&&this.pushedMoveCursor&&(this.viewer.removeTopOccurrenceOfCursor(p.Cursor.MOVE),this.viewer.pushCursor(p.Cursor.MOVE),(0,p.requestDraw)())}addPointToBounds(e,t){for(let t=0;t<3;++t)if(e[t]>V||e[t]<-V)return;t.addPoint(e)}isDrivenDimension(){return this.isDriven}setIsDriven(e){this.isDriven=e,this.viewer.requestDraw()}canBeDrivenDimension(){return!0}isConfiguredDimension(){return this.isConfigured}setIsConfigured(e){this.isConfigured!==e&&(this.isConfigured=e,this.updateOnNextDraw=!0,this.viewer.requestDraw())}setExpression(e){this.expression!==e&&(this.expression=e,this.expressionType=function(e){return e.includes("#")?k.WITH_VARIABLES:e.match(H)?k.WITHOUT_VARIABLES:k.VALUE_ONLY}(e),this.updateOnNextDraw=!0,this.viewer.requestDraw())}onShowExpressionsChanged(e){this.updateOnNextDraw=!0,this.viewer.requestDraw()}isOverDefined(){return this.isBad}getLabelPositionInPlane(){return[0,0]}getPlaneOrigin(){return E.mat4C.multiplyVec3(this.getPlaneMatrix(),[0,0,0],m.vec3.create())}getVisualUpVector(){const e=this.getPlaneOrigin();return E.vec3C.normalize(E.vec3C.subtract(E.mat4C.multiplyVec3(this.getPlaneMatrix(),[0,1,0],m.vec3.create()),e,m.vec3.create()))}getVisualRightVector(){const e=this.getPlaneOrigin();return E.vec3C.normalize(E.vec3C.subtract(E.mat4C.multiplyVec3(this.getPlaneMatrix(),[1,0,0],m.vec3.create()),e,m.vec3.create()))}getModelPoint(e,t){const i=E.mat3C.multiplyVec2(this.dimensionMatrix,[e,t],m.mat3.create());return E.mat4C.multiplyVec3(this.getPlaneMatrix(),[i[0],i[1],0],m.vec3.create())}getUiSelectionForText(){return new p.UISelection(this,S,"")}planeToDimensionCoordinates(e,t){const i=m.mat2.fromValues(this.dimensionMatrix[0],this.dimensionMatrix[3],this.dimensionMatrix[1],this.dimensionMatrix[4]),s=m.vec2.fromValues(this.dimensionMatrix[6],this.dimensionMatrix[7]);return m.vec2.subtract(s,m.vec2.fromValues(e,t),s),m.vec2.transformMat2(s,s,i)}mouseToDimensionCoordinates(e,t,i){const s=i.getRay(e,t),n=(0,p.intersectRayPlaneMatrix)(s,this.getPlaneMatrix()),r=E.mat4C.multiplyVec3(this.getPlaneMatrixInverse(),n,m.vec3.create());return r?this.planeToDimensionCoordinates(r[0],r[1]):null}getLabelCanvasCoordinates(){const e=this.getLabelPositionInPlane(),t=E.mat4C.multiplyVec3(this.getPlaneMatrix(),[e[0],e[1],0]),i=this.viewer.getPrimaryViewController().camera.projectWorldPointToCanvas(t),s=(0,d.getDevicePixelRatio)();return i[0]/=s,i[1]/=s,i}onAppearanceConstantsUpdated(){this.destroyAllTextures(),this.updateOnNextDraw=!0}updateExpressionDimensionComponent(e,t,i,s,n){var r;if(!(null===(r=this.viewer.getSketch())||void 0===r?void 0:r.showDimensionExpressions)||this.expressionType===k.VALUE_ONLY)return void this.removeDimensionComponent(A);const a=this.updateExpressionTexture(),o=e*a.filledWidthPx,c=e*a.filledHeightPx,l=m.vec3.scale(m.vec3.create(),i,.5*o),h=m.vec3.scale(m.vec3.create(),s,n[1]?-c:c),d=m.vec3.subtract(m.vec3.create(),t,l),u=m.vec3.add(m.vec3.create(),t,l),g=m.vec3.add(m.vec3.create(),d,h);this.updateDimensionComponent(A,f,(0,p.createQuad)(d,u,g,void 0,[n[0]?a.rightCoordinate:a.leftCoordinate,a.bottomCoordinate],[n[0]?a.leftCoordinate:a.rightCoordinate,a.topCoordinate]),this.expressionNodeProperties)}updateIconDimensionComponent(e,t,i,s,n){if(null==this.viewer.getResources().dimensionAtlas)return 0;if(this.expressionType===k.VALUE_ONLY)return this.removeDimensionComponent(R),0;const r=this.viewer.getResources().dimensionAtlas.getTextureCoords(z(this.expressionType,this.isBad));if(!r)return 0;const a=e*W.getNumber("DIMENSION_ICON_SIZE_PIXELS"),o=m.vec3.scale(m.vec3.create(),i,n[0]?-a:a),c=m.vec3.scale(m.vec3.create(),s,.5*a),l=m.vec3.scale(m.vec3.create(),s,a),h=m.vec3.subtract(m.vec3.create(),t,c),d=m.vec3.subtract(m.vec3.create(),h,o),u=m.vec3.add(m.vec3.create(),d,l),g=(0,p.createQuad)(d,h,u,void 0,[r.lowS,n[1]?r.lowT:r.highT],[r.highS,n[1]?r.highT:r.lowT]);return this.updateDimensionComponent(R,C,g,this.viewer.getResources().dimensionNodeProperties),a}updateValueTexture(e,t,i,s){const n=null!=i?i:"";let r=null!=s?s:"";if(!this.preferences||this.preferences&&this.preferences.displayLimitRangeText){if(this.displayData.hasMinimumLimit){const e=(0,o.convertFromBase)(this.displayData.minimumLimit,this.getDimensionUnits(t));r+=", "+i18n("Min")+": "+this.getRoundedDimensionValueForTextDisplay(e,t),s&&(r+=s)}if(this.displayData.hasMaximumLimit){const e=(0,o.convertFromBase)(this.displayData.maximumLimit,this.getDimensionUnits(t));r+=", "+i18n("Max")+": "+this.getRoundedDimensionValueForTextDisplay(e,t),s&&(r+=s)}}const a=this.getRoundedDimensionValueForTextDisplay(e,t),c=n+g.ValueAndUnitsFormatter.convertToCommaFormatIfNeeded(a+"")+r;return this.updateRawValueTexture(c)}updateRawValueTexture(e){if(!this.hasValueChanged(e))return this.valueTexture;this.destroyValueTexture(),this.lastValueProperties={textRendered:e,isBad:this.isBad,hoveredOrTextDragging:this.hovered||this.textDragging,selected:this.selected,isDriven:this.isDriven,isConfigured:this.isConfigured};const{borderColor:t,borderThickness:i}=this.getValueBorderProperties();return this.valueTexture=(0,p.createTextureFromText)(this.viewer,e,{color:this.getValueTextColor(),font:W.getString("DIMENSION_VALUE_FONT"),size:W.getNumber("DIMENSION_VALUE_HEIGHT_PIXELS"),paddingWithinBorder:W.getNumber("DIMENSION_VALUE_BACKGROUND_PADDING"),backgroundColor:this.getValueBackgroundColor(),backgroundOpacity:W.getNumber("DIMENSION_VALUE_BACKGROUND_OPACITY"),backgroundRadius:W.getNumber("DIMENSION_VALUE_BACKGROUND_BORDER_RADIUS"),borderColor:t,borderThickness:i,dashLength:W.getNumber("DIMENSION_CONFIGURED_DASH_LENGTH"),dashGapLength:W.getNumber("DIMENSION_CONFIGURED_DASH_GAP_LENGTH")}),this.valueMaterial.ambientTexture=this.valueTexture,this.valueTexture}updateExpressionTexture(){const e=(0,I.truncate)(this.expression,70);return this.updateRawExpressionTexture(e)}updateRawExpressionTexture(e){if(!this.hasExpressionChanged(e))return this.expressionTexture;this.destroyExpressionTexture(),this.lastExpressionProperties={textRendered:e,isBad:this.isBad,hoveredOrTextDragging:this.hovered||this.textDragging,selected:this.selected};const{borderColor:t,borderThickness:i}=this.getExpressionBorderProperties();let s=W.getNumber("DIMENSION_EXPRESSION_BACKGROUND_PADDING");return i&&(s-=i),this.expressionTexture=(0,p.createTextureFromText)(this.viewer,e,{color:this.getExpressionTextColor(),font:W.getString("DIMENSION_EXPRESSION_FONT"),size:W.getNumber("DIMENSION_EXPRESSION_HEIGHT_PIXELS"),paddingWithinBorder:s,backgroundColor:this.getExpressionBackgroundColor(),backgroundOpacity:W.getNumber("DIMENSION_EXPRESSION_BACKGROUND_OPACITY"),backgroundRadius:W.getNumber("DIMENSION_EXPRESSION_BACKGROUND_BORDER_RADIUS"),borderColor:t,borderThickness:i}),this.expressionMaterial.ambientTexture=this.expressionTexture,this.expressionTexture}getValueTextColor(){var e;let t;return t=(null===(e=this.preferences)||void 0===e?void 0:e.colorName)?this.preferences.colorName:this.isBad?"OVERCONSTRAINED_LINE_POINT_COLOR":this.isDriven?"DIMENSION_DRIVEN_LINE_POINT_COLOR":"DIMENSION_VALUE_TEXT_COLOR",W.getColor(t)}getValueBackgroundColor(){return this.selected?W.getColor("DIMENSION_VALUE_SELECTED_BACKGROUND_COLOR"):this.hovered||this.textDragging?W.getColor("DIMENSION_VALUE_HOVERED_BACKGROUND_COLOR"):null}getValueBorderProperties(){return this.isConfigured?{borderColor:W.getColor("DIMENSION_CONFIGURED_COLOR"),borderThickness:W.getNumber("DIMENSION_CONFIGURED_BORDER_THICKNESS")}:{}}getExpressionTextColor(){let e;return e=this.isBad?this.selected?"DIMENSION_EXPRESSION_BAD_SELECTED_TEXT_COLOR":this.hovered||this.textDragging?"DIMENSION_EXPRESSION_BAD_HOVERED_TEXT_COLOR":"DIMENSION_EXPRESSION_BAD_TEXT_COLOR":"DIMENSION_EXPRESSION_TEXT_COLOR",W.getColor(e)}getExpressionBackgroundColor(){let e;return e=this.isBad?this.selected?"DIMENSION_EXPRESSION_BAD_SELECTED_BACKGROUND_COLOR":this.hovered||this.textDragging?"DIMENSION_EXPRESSION_BAD_HOVERED_BACKGROUND_COLOR":"DIMENSION_EXPRESSION_BAD_BACKGROUND_COLOR":this.expressionType===k.WITH_VARIABLES?this.selected?"DIMENSION_EXPRESSION_WITH_VARIABLES_SELECTED_BACKGROUND_COLOR":this.hovered||this.textDragging?"DIMENSION_EXPRESSION_WITH_VARIABLES_HOVERED_BACKGROUND_COLOR":"DIMENSION_EXPRESSION_WITH_VARIABLES_BACKGROUND_COLOR":this.selected?"DIMENSION_EXPRESSION_WITHOUT_VARIABLES_SELECTED_BACKGROUND_COLOR":this.hovered||this.textDragging?"DIMENSION_EXPRESSION_WITHOUT_VARIABLES_HOVERED_BACKGROUND_COLOR":"DIMENSION_EXPRESSION_WITHOUT_VARIABLES_BACKGROUND_COLOR",W.getColor(e)}getExpressionBorderProperties(){return this.expressionType!==k.WITHOUT_VARIABLES||this.isBad||this.selected||this.hovered||this.textDragging?{}:{borderColor:W.getColor("DIMENSION_EXPRESSION_WITHOUT_VARIABLES_BACKGROUND_BORDER_COLOR"),borderThickness:W.getNumber("DIMENSION_EXPRESSION_BACKGROUND_BORDER_THICKNESS")}}getScreenSpaceParameters(e,t){const i={gap:W.getNumber("DIMENSION_WITNESS_MODEL_GAP"),extension:W.getNumber("DIMENSION_WITNESS_EXTENSION")};return this.preferences&&this.preferences.ignoreSpaceParameters?(i.gap=0,i.extension=0):t&&(i.gap*=t,i.extension*=t),i}getArrowColor(){return this.preferences&&this.preferences.colorName?W.getColor(this.preferences.colorName):this.selected?W.getColor("DIMENSION_SELECTED_LINE_ARROW_COLOR"):this.hovered?W.getColor("DIMENSION_HOVERED_LINE_ARROW_COLOR"):this.isBad?W.getColor("OVERCONSTRAINED_LINE_POINT_COLOR"):this.isDriven?W.getColor("DIMENSION_DRIVEN_LINE_POINT_COLOR"):W.getColor("DIMENSION_LINE_ARROW_COLOR")}getLineColor(){return this.getArrowColor()}getLineWidth(){return this.selected||this.hovered?W.getNumber("DIMENSION_SELECTED_LINE_WIDTH"):W.getNumber("DIMENSION_LINE_WIDTH")}getLineStyle(){return this.preferences?this.preferences.lineStyle:null}getTextGap(e,t,i,s){let n=i,r=(0,h.acos)(m.vec3.dot(e,t),u.Tolerances.ZERO_LENGTH);r>Math.PI/2&&(r=(0,h.acos)(m.vec3.dot(E.vec3C.scale(e,-1,m.vec3.create()),t),u.Tolerances.ZERO_LENGTH));const a=s/2/(i/2);return n=Math.tan(r)>a?s/Math.sin(r):i/Math.cos(r),n}getValueGapWithIcon(e,t,i,s,n,r){const a=i+2*(n+r);return this.getTextGap(e,t,a,s)}getIconPadding(e){return W.getNumber("DIMENSION_VALUE_BACKGROUND_PADDING")*e}createComponentLine(e,t){return(0,p.createLine)(e,t,void 0,this.getLineColor(),this.getLineWidth(),this.getLineStyle())}updateDimensionComponent(e,t,i,s){const n=this.forPreview?1:0;this.updateMeshIncrement("st."+e,t,i.clone(),s[n])}removeDimensionComponent(e){this.removeMeshIncrement("st."+e)}updateDimensionLineComponent(e,t,i){this.updateDimensionComponent(e,P,this.createComponentLine(t,i),b)}makeThreePointArc(e,t,i,s){const n=(0,p.createArcPolyline)(e.slice(),t.slice(),i.slice(),[],!0);if(n){const e=n.linePoints,t=new Array(3*e.length),i=new Array(2*(e.length-1)),r=s.getIndexOffset();i[0]=r;for(let t=1;t<e.length-1;t++)i[2*t-1]=t+r,i[2*t]=t+r;for(let i=0;i<e.length;i++){const s=e[i],n=this.getModelPoint(s[0],s[1]);for(let e=0;e<3;++e)t[3*i+e]=n[e]}i[i.length-1]=i.length-1+r,s.concat(t,i)}}getValuePrefix(e){var t,i;return null!==(i=null===(t=this.preferences)||void 0===t?void 0:t.textPrefix)&&void 0!==i?i:""}isOfType(e){return this.constructor===e}setPreferences(e){this.preferences=e}getDisplayData(){return this.displayData}}t.Dimension=Y;class Z{constructor(){this.points=[],this.indices=[]}concat(e,t){this.points=this.points.concat(e),this.indices=this.indices.concat(t)}getIndexOffset(){return this.points.length/3}}t.Arc=Z;class K extends Y{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="LinearDimension"}updateFromDisplayData(e){this.displayData=e,this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()}setPosition(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]}getPosition(){return m.vec2.fromValues(this.displayData.positionX,this.displayData.positionY)}getRoundedDimensionValueForTextDisplay(e,t){return(0,h.roundTo)(e,t.getLengthUnitsDisplayPrecision())}getDimensionUnits(e){return e.getLengthUnits()}update(e,t){if(!this.displayData)return;let i;const s=[this.displayData.witnessEndPoint0X,this.displayData.witnessEndPoint0Y],n=[this.displayData.witnessEndPoint1X,this.displayData.witnessEndPoint1Y],r=this.getPosition(),a=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(r[0],r[1]))),c=this.getModelPoint(s[0],s[1]),l=this.getModelPoint(n[0],s[1]),h=this.getModelPoint(s[0],s[1]+n[0]-s[0]);let d=E.vec3C.normalize(E.vec3C.subtract(l,c)),g=E.vec3C.normalize(E.vec3C.subtract(h,c));(m.vec3.dot(d,d)<u.Tolerances.ZERO_LENGTH_SQUARED||m.vec3.dot(g,g)<u.Tolerances.ZERO_LENGTH_SQUARED)&&(d=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(1,0),c)),g=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(0,1),c)));const I=this.getVisualRightVector(),T=this.getVisualUpVector(),f=Math.abs(this.displayData.value);let C=W.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*a,v=W.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*a;const D=v;v>f*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION")&&(i=f*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION")/v,C*=i,v*=i);const M=[],y=this;function O(e,t,i,s){const n=y.getModelPoint(i,s);return E.vec3C.add(n,E.vec3C.add(E.vec3C.scale(d,e,m.vec3.create()),E.vec3C.scale(g,t,m.vec3.create())))}function A(e,t,i,s){const n=O(e,t,i,s);for(let e=0;e<3;++e)M.push(n[e])}A(0,0,s[0],r[1]),A(v,.5*-C,s[0],r[1]),A(v,.5*C,s[0],r[1]),A(0,0,n[0],r[1]),A(-v,.5*-C,n[0],r[1]),A(-v,.5*C,n[0],r[1]),this.updateDimensionComponent(L,"",(0,p.createTriangles)(M,[0,1,2,3,4,5],void 0,this.getArrowColor()),F);const R=(0,o.convertFromBase)(this.displayData.value,t.getLengthUnits()),N=this.updateValueTexture(R,t,this.getValuePrefix(t)),w=a*N.filledWidthPx,B=a*N.filledHeightPx,V=m.vec3.scale(m.vec3.create(),T,.5*B),H=this.getModelPoint(r[0],r[1]);m.vec3.subtract(H,H,V);const k=m.vec3.scale(m.vec3.create(),T,B),z=m.vec3.scale(m.vec3.create(),I,.5*w),j=m.vec3.subtract(m.vec3.create(),H,z),X=m.vec3.add(m.vec3.create(),H,z),q=m.vec3.add(m.vec3.create(),j,k),Y=(0,p.orientText)(e,I,T,this.transform),Z=m.vec3.add(m.vec3.create(),Y[0]?X:j,V),K=this.updateIconDimensionComponent(a,Z,I,T,Y),Q=this.getTextGap(d,I,w,B),$=K>0?this.getValueGapWithIcon(d,I,w,B,K,this.getIconPadding(a)):Q,J=this.getScreenSpaceParameters(t,a);let ee=J.extension;Q>f&&(ee=0);const te=s[1]+(r[1]>s[1]?J.gap:-J.gap),ie=n[1]+(r[1]>n[1]?J.gap:-J.gap),se=r[1]+(r[1]>0?ee:-ee);this.updateDimensionLineComponent(x,this.getModelPoint(s[0],te),this.getModelPoint(s[0],se)),this.updateDimensionLineComponent(U,this.getModelPoint(n[0],ie),this.getModelPoint(n[0],se));let ne=s[0],re=n[0];s[0]>n[0]&&(ne=n[0],re=s[0]);const{leftGapLength:ae,rightGapLength:oe}=this.getLeftAndRightGapLengthInDimensionCoordinates(Q,$,m.vec2.fromValues(ne,r[1]),m.vec2.fromValues(re,r[1]),Y[0]);let ce=r[0]+oe/2>re+v/2,le=r[0]-ae/2<ne-v/2,he=[];const de=[];function ue(e,t,i,s,n){const r=O(e,t,i,s);n.push(r)}if(ce||le?(this.updateDimensionLineComponent(G,this.getModelPoint(s[0],r[1]),this.getModelPoint(n[0],r[1])),ce?this.updateDimensionLineComponent(G,this.getModelPoint(ne,r[1]),this.getModelPoint(r[0]-ae/2,r[1])):le&&this.updateDimensionLineComponent(G,this.getModelPoint(re,r[1]),this.getModelPoint(r[0]+oe/2,r[1]))):(ce=r[0]+oe/2>re-v/2,le=r[0]-ae/2<ne+v/2,ce?(he.push(this.getModelPoint(ne,r[1])),he.push(this.getModelPoint(r[0]-ae/2,r[1]))):le?(he.push(this.getModelPoint(r[0]+oe/2,r[1])),he.push(this.getModelPoint(re,r[1]))):he=[this.getModelPoint(ne,r[1]),this.getModelPoint(r[0]-ae/2,r[1]),this.getModelPoint(r[0]+oe/2,r[1]),this.getModelPoint(re,r[1])]),this.preferences&&this.preferences.displayLimitRangeTicks){const e=this.displayData.value<0?-1:1;if(this.displayData.hasMinimumLimit){if(this.displayData.minimumLimit<0){const t=e<0?n:s;ue(0,0,t[0],t[1],he),ue(e*this.displayData.minimumLimit,0,s[0],s[1],he)}ue(e*this.displayData.minimumLimit,-D,s[0],s[1],de),ue(e*this.displayData.minimumLimit,D,s[0],s[1],de)}if(this.displayData.hasMaximumLimit){if(this.displayData.maximumLimit>0){const t=e<0?s:n;ue(0,0,t[0],t[1],he),ue(e*this.displayData.maximumLimit,0,s[0],r[1],he)}ue(e*this.displayData.maximumLimit,-D,s[0],s[1],de),ue(e*this.displayData.maximumLimit,D,s[0],s[1],de)}}he.length>0&&this.updateDimensionComponent(G,P,(0,p.createLines)(he,void 0,this.getLineColor(),this.getLineWidth(),this.getLineStyle()),b);const ge=G+"_TICK";de.length>0?this.updateDimensionComponent(ge,P,(0,p.createLines)(de,void 0,this.getLineColor(),this.getLineWidth()),b):this.removeDimensionComponent(ge),this.updateDimensionComponent(_,S,(0,p.createQuad)(j,X,q,void 0,[Y[0]?N.rightCoordinate:N.leftCoordinate,Y[1]?N.topCoordinate:N.bottomCoordinate],[Y[0]?N.leftCoordinate:N.rightCoordinate,Y[1]?N.bottomCoordinate:N.topCoordinate]),this.valueNodeProperties);const pe=Y[1]?H:m.vec3.add(m.vec3.create(),H,k);this.updateExpressionDimensionComponent(a,pe,I,T,Y)}getLeftAndRightGapLengthInDimensionCoordinates(e,t,i,s,n){if(e===t)return{leftGapLength:e,rightGapLength:e};let r=t,a=e;n&&(r=e,a=t);const o=m.vec2.transformMat3(m.vec2.create(),i,this.dimensionMatrix),c=m.vec2.transformMat3(m.vec2.create(),s,this.dimensionMatrix);return o[0]>c[0]?{leftGapLength:a,rightGapLength:r}:{leftGapLength:r,rightGapLength:a}}getLabelPositionInPlane(){return E.mat3C.multiplyVec2(this.dimensionMatrix,[this.displayData.positionX,this.displayData.positionY],m.mat3.create())}getFitBounds(){const e=new p.BoundingBox;return this.addPointToBounds(this.getModelPoint(this.displayData.positionX,this.displayData.positionY),e),this.addPointToBounds(this.getModelPoint(this.displayData.witnessEndPoint0X,this.displayData.witnessEndPoint0Y),e),this.addPointToBounds(this.getModelPoint(this.displayData.witnessEndPoint1X,this.displayData.witnessEndPoint1X),e),e}}t.LinearDimension=K;class Q extends K{constructor(e,t,i){super(e,t,i),this.id="CenterlineDimension"}getValuePrefix(e){return"Ø"}}t.CenterlineDimension=Q;class $ extends K{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="EllipseDiameterDimension"}}t.EllipseDiameterDimension=$;const J=function(e,t){return m.vec2.fromValues(Math.cos(e)*t,Math.sin(e)*t)};class ee extends Y{constructor(e,t,i){super(e,t,i),this.displayData=null}setPosition(e){this.displayData.positionR=Math.sqrt(e[0]*e[0]+e[1]*e[1]),this.displayData.positionT=Math.atan2(e[1],e[0])}getLabelPositionInPlane(){const e=J(this.displayData.positionT,this.displayData.positionR);return E.mat3C.multiplyVec2(this.dimensionMatrix,[e[0],e[1]],m.mat3.create())}getModelPointFromPolar(e,t){return this.getModelPoint(t*Math.cos(e),t*Math.sin(e))}}t.PolarDimension=ee;const te=function(e){return e-2*(0,p.floorTowardsZero)(e/(2*Math.PI))*Math.PI},ie=function(e,t,i){const s=(e+t)/2,n=(0,p.closestAngle)(i,s),r=Math.abs(t-e);let a=0,o=0,c=0;if(2*Math.abs(n-s)>r){c=i;const s=(0,p.closestAngle)(e,c),n=(0,p.closestAngle)(t,c);a=Math.abs(s-c)<Math.abs(n-c)?s:n,o=Math.floor(1+(W.getNumber("DIMENSION_ARC_WITNESS_SEGMENTS")-1)*Math.abs(c-a)/(2*Math.PI))}return{firstAngle:a,secondAngle:c,segments:o}};class se extends ee{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="RadialDimension"}updateFromDisplayData(e){this.displayData=e,this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()}getPosition(){return m.vec2.clone(J(this.displayData.positionT,this.displayData.positionR))}getRoundedDimensionValueForTextDisplay(e,t){return(0,h.roundTo)(e,t.getLengthUnitsDisplayPrecision())}getDimensionUnits(e){return e.getLengthUnits()}update(e,t){if(!this.displayData)return;const i=this.displayData.value,s=this.getPosition(),n=J(this.displayData.positionT,1),r=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(s[0],s[1]))),a=this.getModelPoint(0,0),l=J(this.displayData.positionT+Math.PI/2,1),h=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(n[0],n[1]),a)),d=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(l[0],l[1]),a)),u=this.getVisualRightVector(),g=this.getVisualUpVector();let I=W.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*r,T=W.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*r;if(T>i*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION")){const e=i*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION")/T;I*=e,T*=e}const f=[],C=this,v=function(e,t,i,s){const n=C.getModelPoint(i,s),r=E.vec3C.add(n,E.vec3C.add(E.vec3C.scale(h,e,m.vec3.create()),E.vec3C.scale(d,t,m.vec3.create())));for(let e=0;e<3;++e)f.push(r[e])};let D=(0,o.convertFromBase)(i,t.getLengthUnits()),M=i;const y=this.displayData.radiusDisplay===c.GBTRadiusDisplay.DIAMETRAL,O=y&&!this.displayData.realDiameter;let A="R";y&&(A="Ø",O?D*=2:M/=2);const R=this.updateValueTexture(D,t,A),N=r*R.filledWidthPx,w=r*R.filledHeightPx,B=m.vec3.scale(m.vec3.create(),g,.5*w),G=this.getModelPoint(s[0],s[1]);m.vec3.subtract(G,G,B);const V=m.vec3.scale(m.vec3.create(),u,.5*N),H=m.vec3.scale(m.vec3.create(),g,w),k=m.vec3.subtract(m.vec3.create(),G,V),z=m.vec3.add(m.vec3.create(),G,V),j=m.vec3.add(m.vec3.create(),k,H),X=(0,p.orientText)(e,u,g,this.transform),q=m.vec3.add(m.vec3.create(),X[0]?z:k,B),Y=this.updateIconDimensionComponent(r,q,u,g,X);let Z,K;const Q=this.getTextGap(h,u,N,w),$=Y>0?this.getValueGapWithIcon(h,u,N,w,Y,this.getIconPadding(r)):Q,ee=X[0]?Q:$,te=X[0]?$:Q,se=n[0]>0?ee:te,ne=n[0]>0?te:ee;if(this.displayData.positionR-se/2>M)Z=J(this.displayData.positionT,M),K=J(this.displayData.positionT,this.displayData.positionR-se/2),v(0,0,Z[0],Z[1]),v(T,.5*-I,Z[0],Z[1]),v(T,.5*I,Z[0],Z[1]),this.updateDimensionComponent(L,"",(0,p.createTriangles)(f,[0,1,2],void 0,this.getArrowColor()),F),this.updateDimensionLineComponent(x,this.getModelPoint(Z[0],Z[1]),this.getModelPoint(K[0],K[1]));else{Z=[0,0],y&&(Z=J(Math.PI+this.displayData.positionT,M)),K=J(this.displayData.positionT,M),v(0,0,Z[0],Z[1]),v(T,.5*-I,Z[0],Z[1]),v(T,.5*I,Z[0],Z[1]),v(0,0,K[0],K[1]),v(-T,.5*-I,K[0],K[1]),v(-T,.5*I,K[0],K[1]),this.updateDimensionComponent(L,"",(0,p.createTriangles)(f,[0,1,2,3,4,5],void 0,this.getArrowColor()),F);const e=J(this.displayData.positionT,this.displayData.positionR-se/2),t=J(this.displayData.positionT,this.displayData.positionR+ne/2),i=[],s=this.getModelPoint(Z[0],Z[1]),n=this.getModelPoint(K[0],K[1]),r=this.getModelPoint(e[0],e[1]),a=this.getModelPoint(t[0],t[1]);(!y&&this.displayData.positionR-se/2>0||y)&&(i.push(s),i.push(r)),this.displayData.positionR+ne/2<M&&(i.push(a),i.push(n)),this.updateDimensionComponent(x,P,(0,p.createLines)(i,void 0,this.getLineColor(),this.getLineWidth(),this.getLineStyle()),b)}if(!y){const e=ie(this.displayData.witnessEndPoint0t,this.displayData.witnessEndPoint1t,this.displayData.positionT),t=(0,p.createArc)(a,this.displayData.witnessEndPoint1r,E.mat4C.multiplyVec4(this.getPlaneMatrix(),[0,0,1,0],m.vec4.create()),u,e.firstAngle,e.secondAngle,e.segments);(0,p.addColorToIncrement)(this.getLineColor(),t),this.getLineStyle()&&(0,p.addStyleToIncrement)(this.getLineStyle(),t),this.updateDimensionComponent(U,P,t,b)}this.updateDimensionComponent(_,S,(0,p.createQuad)(k,z,j,void 0,[X[0]?R.rightCoordinate:R.leftCoordinate,X[1]?R.topCoordinate:R.bottomCoordinate],[X[0]?R.leftCoordinate:R.rightCoordinate,X[1]?R.bottomCoordinate:R.topCoordinate]),this.valueNodeProperties);const re=X[1]?G:m.vec3.add(m.vec3.create(),G,H);this.updateExpressionDimensionComponent(r,re,u,g,X)}getFitBounds(){const e=new p.BoundingBox;return this.addPointToBounds(this.getModelPointFromPolar(this.displayData.positionT,this.displayData.positionR),e),e}}t.RadialDimension=se;class ne extends ee{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="AngularDimension"}updateFromDisplayData(e){this.displayData=e,this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()}getDisplayValue(e,t){return(0,o.convertFromBase)(e,t.getAngleUnits())}getValueSuffix(e){var t;let i=e.getAngleUnits();const s=null!==(t=null==i?void 0:i.toLowerCase())&&void 0!==t?t:"";return"degree"===s?i="°":"radian"===s&&(i=" radian"),i}addArcLengthAnnotation(e,t,i,s,n,r,a,o){return 0}isArcLengthDimension(){return!1}getPosition(){return J(this.displayData.positionT,this.displayData.positionR)}getRoundedDimensionValueForTextDisplay(e,t){return this.isArcLengthDimension()?(0,h.roundTo)(e,t.getLengthUnitsDisplayPrecision()):(0,h.roundTo)(e,t.getAngleUnitsDisplayPrecision())}getDimensionUnits(e){return e.getAngleUnits()}update(e,t){if(!this.displayData)return;const i=this.displayData.value,s=this.getPosition(),n=te(this.displayData.witnessEndPoint0t),r=te(this.displayData.witnessEndPoint1t),a=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(s[0],s[1]))),o=this.getValuePrefix(t),c=this.getValueSuffix(t),l=this.getDisplayValue(i,t),h=this.updateValueTexture(l,t,o,c),d=a*h.filledWidthPx,u=a*h.filledHeightPx;let g=W.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*a,I=W.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*a;const T=r-n,f=Math.abs(T*this.displayData.positionR)*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION");if(I>f){const e=f/I;g*=e,I*=e}let C=1;n>r&&(C=-1);const v=[],D=this,M=function(e,t,i,s){let n=J(i,s);const r=[Math.cos(i),Math.sin(i)],a=[-r[1]*C,r[0]*C];n=E.vec2C.add(n,E.vec2C.add(E.vec2C.scale(r,t,m.vec2.create()),E.vec2C.scale(a,e,m.vec2.create())));const o=D.getModelPoint(n[0],n[1]);for(let e=0;e<3;++e)v.push(o[e])},y=I/this.displayData.positionR;M(0,0,n,this.displayData.positionR),M(0,.5*-g,n+y*C,this.displayData.positionR),M(0,.5*g,n+y*C,this.displayData.positionR),M(0,0,r,this.displayData.positionR),M(0,.5*-g,r-y*C,this.displayData.positionR),M(0,.5*g,r-y*C,this.displayData.positionR),this.updateDimensionComponent(L,"",(0,p.createTriangles)(v,[0,1,2,3,4,5],void 0,this.getArrowColor()),F);const O=this.getScreenSpaceParameters(t,a),A=this.displayData.positionR+(this.displayData.witnessEndPoint0r<this.displayData.positionR?O.extension:-O.extension),R=this.displayData.positionR+(this.displayData.witnessEndPoint1r<this.displayData.positionR?O.extension:-O.extension);let N,w;if(this.isArcLengthDimension())N=this.displayData.witnessEndPoint0r+(this.displayData.witnessEndPoint0r>this.displayData.positionR?-O.gap:O.gap),w=this.displayData.witnessEndPoint1r+(this.displayData.witnessEndPoint1r>this.displayData.positionR?-O.gap:O.gap);else{const e=this.displayData.witnessMaxPoint0r+O.gap,t=this.displayData.witnessMinPoint0r-O.gap,i=this.displayData.witnessMaxPoint1r+O.gap,s=this.displayData.witnessMinPoint1r-O.gap;N=this.displayData.positionR>e?e:this.displayData.positionR<t?t:A,w=this.displayData.positionR>i?i:this.displayData.positionR<s?s:R}const B=(e,t,i,s)=>{this.updateDimensionLineComponent(e,this.getModelPointFromPolar(t,i),this.getModelPointFromPolar(t,s))};B(x,n,N,A),B(U,r,w,R);const G=this.getModelPointFromPolar(this.displayData.positionT,this.displayData.positionR),V=-Math.sin(this.displayData.positionT),H=Math.cos(this.displayData.positionT),k=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(s[0]+V,s[1]+H),G)),z=this.getVisualRightVector(),j=this.getVisualUpVector(),X=new Z,q=this.displayData.positionR,Y=(0,p.orientText)(e,z,j,this.transform),K=this.addArcLengthAnnotation(Y[1],-this.displayData.coordinateSystem.m00,-this.displayData.coordinateSystem.m01,d,u,this.displayData.positionT,q,this.displayData.clockwise),Q=m.vec3.scale(m.vec3.create(),j,.5*u),$=m.vec3.subtract(m.vec3.create(),G,Q),ee=m.vec3.scale(m.vec3.create(),z,.5*d),se=m.vec3.subtract(m.vec3.create(),$,ee),ne=m.vec3.add(m.vec3.create(),$,ee),re=m.vec3.scale(m.vec3.create(),j,u),ae=m.vec3.add(m.vec3.create(),se,re),oe=m.vec3.add(m.vec3.create(),Y[0]?ne:se,Q),ce=this.updateIconDimensionComponent(a,oe,z,j,Y),le=(this.getValueGapWithIcon(k,z,d,u,.5*ce,0)+K)/2/this.displayData.positionR;let he=Math.abs(2*Math.asin(le));isNaN(he)&&(he=0);let de=this.displayData.positionT;if(C>0)for(;de+he/2<0;)de+=2*Math.PI;else for(;de-he/2>0;)de-=2*Math.PI;const ue=de+he/2,ge=de-he/2;if(Math.abs(le)>1||C>0&&ue<n||C>0&&ge>r||C<0&&ge>n||C<0&&ue<r){const e=ie(te(this.displayData.witnessEndPoint0t),te(this.displayData.witnessEndPoint1t),de);0!==e.secondAngle&&(e.secondAngle+=e.firstAngle>e.secondAngle?he/2:-he/2),this.makeArc(e.firstAngle,e.secondAngle,X),this.makeArc(n,r,X)}else(C>0&&de-he/2>n||C<0&&de+he/2<n)&&this.makeArc(n,de-C*he/2,X),(C>0&&de+he/2<r||C<0&&de-he/2>r)&&this.makeArc(de+C*he/2,r,X);const pe=new p.MeshIncrement(p.PrimitiveType.LINES,X.points,X.indices);(0,p.addColorToIncrement)(this.getLineColor(),pe),(0,p.addSizeToIncrement)(this.getLineWidth(),pe),this.getLineStyle()&&(0,p.addStyleToIncrement)(this.getLineStyle(),pe),this.updateDimensionComponent("arc",P,pe,b),this.updateDimensionComponent(_,S,(0,p.createQuad)(se,ne,ae,void 0,[Y[0]?h.rightCoordinate:h.leftCoordinate,Y[1]?h.topCoordinate:h.bottomCoordinate],[Y[0]?h.leftCoordinate:h.rightCoordinate,Y[1]?h.bottomCoordinate:h.topCoordinate]),this.valueNodeProperties);const me=Y[1]?$:m.vec3.add(m.vec3.create(),$,re);this.updateExpressionDimensionComponent(a,me,z,j,Y)}getFitBounds(){const e=new p.BoundingBox;return this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint0t,this.displayData.witnessEndPoint0r),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint1t,this.displayData.witnessEndPoint1r),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint0t,this.displayData.positionR),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.witnessEndPoint1t,this.displayData.positionR),e),this.addPointToBounds(this.getModelPointFromPolar(this.displayData.positionT,this.displayData.positionR),e),e}makeArc(e,t,i){const s=i.getIndexOffset();let n=e,r=Math.max(Math.floor(u.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE*Math.abs(t-e)/(2*Math.PI)+1),0);isNaN(r)&&(r=0);const a=new Array(3*(r+1)),o=(t-e)/r;for(let e=0;e<r+1;++e){const t=this.getModelPointFromPolar(n,this.displayData.positionR);for(let i=0;i<3;++i)a[3*e+i]=t[i];n+=o}const c=new Array(2*r);let l;for(c[0]=s,l=1;l<r;l++)c[2*l-1]=l+s,c[2*l]=l+s;c[c.length-1]=l+s,i.concat(a,c)}}t.AngularDimension=ne;class re extends ne{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="ArcLengthDimension"}getDisplayValue(e,t){return(0,o.convertFromBase)(e,t.getLengthUnits())}getValueSuffix(e){return""}isArcLengthDimension(){return!0}getDimensionUnits(e){return e.getLengthUnits()}addArcLengthAnnotation(e,t,i,s,n,r,a,o){const c=new Z,l=m.vec2.fromValues(t,i),h=m.vec2.fromValues(i,-t),d=W.getNumber("DIMENSION_ARC_LENGTH_SCALE"),u=J(this.displayData.positionT,a);o&&(E.vec2C.scale(l,-1),E.vec2C.scale(h,-1)),e&&(E.vec2C.scale(l,-1),E.vec2C.scale(h,-1));const g=m.vec2.create();E.vec2C.add(u,E.vec2C.scale(l,d*s/2,m.vec2.create()),g),E.vec2C.add(g,E.vec2C.scale(h,n/2,m.vec2.create()),g);const I=m.vec2.create();E.vec2C.add(u,E.vec2C.scale(l,-d*s/2,m.vec2.create()),I),E.vec2C.add(I,E.vec2C.scale(h,n/2,m.vec2.create()),I),E.vec2C.add(u,E.vec2C.scale(h,n*d,m.vec2.create()),u),this.makeThreePointArc(g,u,I,c);const T=new p.MeshIncrement(p.PrimitiveType.LINES,c.points,c.indices);return(0,p.addColorToIncrement)(this.getLineColor(),T),(0,p.addSizeToIncrement)(this.getLineWidth(),T),this.updateDimensionComponent(N,S,T,b),n*(d-.5+W.getNumber("DIMENSION_TEXT_GAP"))}}t.ArcLengthDimension=re;class ae extends Y{constructor(e,t,i){super(e,t,i),this.id="PointDimension"}updateFromDisplayData(e){this.isBad=e.isOverDefined,this.isDriven=e.isDriven,this.updateDimensionMatrices(),this.viewer.requestDraw()}isLengthDimension(){return!0}update(e,t){const i=this.getDisplayData();if(!i)return;let s;const n=this.getPosition(),r=e.getPixelSizeAtWorldPoint(this.transformPoint(this.getModelPoint(n[0],n[1]))),a=i.value;let o=W.getNumber("DIMENSION_ARROW_HEIGHT_PIXELS")*r,c=W.getNumber("DIMENSION_ARROW_WIDTH_PIXELS")*r;c>a*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION")&&this.isLengthDimension()&&(s=a*W.getNumber("DIMENSION_ARROW_MAX_PROPORTION")/c,o*=s,c*=s);const l=this.getModelPoint(0,0),h=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(1,0),l)),d=E.vec3C.normalize(E.vec3C.subtract(this.getModelPoint(0,1),l)),u=this.getTextureInfoForLabel(a,t),g=r*u.filledWidthPx,I=r*u.filledHeightPx,T=(0,p.orientText)(e,h,d,this.transform),f=this.wantArcLengthSymbol()?this.addArcLengthSymbol(n,g,I,T[1]):.5*I,C=this.getModelPoint(n[0],n[1]),v=m.vec3.scale(m.vec3.create(),h,.5*g),D=m.vec3.scale(m.vec3.create(),d,.5*I),M=m.vec3.subtract(m.vec3.create(),C,v),y=m.vec3.add(m.vec3.create(),C,v),O=m.vec3.subtract(m.vec3.create(),M,D),A=m.vec3.subtract(m.vec3.create(),y,D),R=m.vec3.add(m.vec3.create(),M,D),N=this.getModelPoint(0,0),w=m.vec3.scale(m.vec3.create(),d,f),B=this.updateIconDimensionComponent(r,T[0]?y:M,h,d,T),U=B>0?m.vec3.scale(m.vec3.create(),h,.5*g+B+this.getIconPadding(r)):v,G=[m.vec3.subtract(m.vec3.create(),C,T[0]?v:U),m.vec3.add(m.vec3.create(),C,T[0]?U:v),m.vec3.subtract(m.vec3.create(),C,T[1]?w:D),m.vec3.add(m.vec3.create(),C,T[1]?D:w)];let V,H;for(const e of G){const t=m.vec3.squaredLength(m.vec3.subtract(m.vec3.create(),e,N));(!V||t<V)&&(V=t,H=e)}const k=[],z=m.vec3.normalize(m.vec3.create(),m.vec3.subtract(m.vec3.create(),H,N)),j=m.vec3.transformMat4(m.vec3.create(),[0,0,1],this.getPlaneMatrix()),X=m.vec3.normalize(m.vec3.create(),m.vec3.cross(m.vec3.create(),z,j)),q=this,Y=function(e,t,i,s){const n=q.getModelPoint(i,s),r=m.vec3.add(m.vec3.create(),n,m.vec3.add(m.vec3.create(),m.vec3.scale(m.vec3.create(),z,e),m.vec3.scale(m.vec3.create(),X,t)));for(let e=0;e<3;++e)k.push(r[e])};Y(0,0,0,0),Y(c,.5*-o,0,0),Y(c,.5*o,0,0),this.updateDimensionComponent(L,"",(0,p.createTriangles)(k,[0,1,2],void 0,this.getArrowColor()),F),this.updateDimensionComponent(x,P,this.createComponentLine(N,H),b),this.updateDimensionComponent(_,S,(0,p.createQuad)(O,A,R,void 0,[T[0]?u.rightCoordinate:u.leftCoordinate,T[1]?u.topCoordinate:u.bottomCoordinate],[T[0]?u.leftCoordinate:u.rightCoordinate,T[1]?u.bottomCoordinate:u.topCoordinate]),this.valueNodeProperties);const Z=T[1]?m.vec3.subtract(m.vec3.create(),C,w):m.vec3.add(m.vec3.create(),C,w);this.updateExpressionDimensionComponent(r,Z,h,d,T)}getTextureInfoForLabel(e,t){const i=(0,o.convertFromBase)(e,t.getLengthUnits());return this.updateValueTexture(i,t)}getFitBounds(){const e=new p.BoundingBox;this.addPointToBounds(this.getModelPoint(0,0),e);const t=this.getPosition();return this.addPointToBounds(this.getModelPoint(t[0],t[1]),e),e}wantArcLengthSymbol(){return!1}getDisplayData(){return null}addArcLengthSymbol(e,t,i,s){const n=W.getNumber("DIMENSION_ARC_LENGTH_SCALE"),r=n*t/2,a=s?-i:i,o=m.vec2.fromValues(e[0]-r,e[1]+a/2),c=m.vec2.fromValues(e[0],e[1]+n*a),l=m.vec2.fromValues(e[0]+r,o[1]),h=new Z;this.makeThreePointArc(o,c,l,h);const d=new p.MeshIncrement(p.PrimitiveType.LINES,h.points,h.indices);return(0,p.addColorToIncrement)(this.getLineColor(),d),(0,p.addSizeToIncrement)(this.getLineWidth(),d),this.updateDimensionComponent(N,S,d,b),i*(n+W.getNumber("DIMENSION_TEXT_GAP"))}getLabelPositionInPlane(){return E.mat3C.multiplyVec2(this.dimensionMatrix,this.getPosition(),m.mat3.create())}}t.PointDimension=ae;class oe extends ae{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="RhoDimension"}isLengthDimension(){return!1}updateFromDisplayData(e){this.displayData=e,super.updateFromDisplayData(e)}getDisplayData(){return this.displayData}getPosition(){return m.vec2.fromValues(this.displayData.positionX,this.displayData.positionY)}setPosition(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]}getRoundedDimensionValueForTextDisplay(e,t){return(0,h.roundTo)(e,t.getLengthUnitsDisplayPrecision())}getDimensionUnits(e){return""}getTextureInfoForLabel(e,t){return this.updateValueTexture(e,t,"Rho ")}}t.RhoDimension=oe;class ce extends ae{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="CurveLengthDimension"}wantArcLengthSymbol(){return!this.isForPreview()}isLengthDimension(){return!0}getRoundedDimensionValueForTextDisplay(e,t){return(0,h.roundTo)(e,t.getLengthUnitsDisplayPrecision())}getDimensionUnits(e){return e.getLengthUnits()}getTextureInfoForLabel(e,t){if(this.isForPreview())return this.updateRawValueTexture("⌒");{const i=(0,o.convertFromBase)(e,t.getLengthUnits());return this.updateValueTexture(i,t)}}updateFromDisplayData(e){this.displayData=e,super.updateFromDisplayData(e)}getDisplayData(){return this.displayData}getPosition(){return m.vec2.fromValues(this.displayData.positionX,this.displayData.positionY)}setPosition(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]}}t.CurveLengthDimension=ce;class le extends ae{constructor(e,t,i){super(e,t,i),this.displayData=null,this.id="CountDimension"}getTextureInfoForLabel(e,t){return this.updateValueTexture(e,t,void 0,"x")}getRoundedDimensionValueForTextDisplay(e,t){return(0,h.roundTo)(e,0)}getDimensionUnits(e){return""}updateFromDisplayData(e){this.displayData=e,super.updateFromDisplayData(e)}getDisplayData(){return this.displayData}getPosition(){return m.vec2.fromValues(this.displayData.positionX,this.displayData.positionY)}setPosition(e){this.displayData.positionX=e[0],this.displayData.positionY=e[1]}canBeDrivenDimension(){return!1}}t.CountDimension=le,t.createDimensionForDisplayData=function(e,t,i,s){s||(s={forPreview:void 0,isMateValue:void 0});let n=null;return e instanceof c.BTArcLengthDimensionDisplayData?n=new re(i,!!s.forPreview,t):e instanceof c.BTCenterlineDimensionDisplayData?n=new Q(i,!!s.forPreview,t):e instanceof c.BTEllipseDiameterDimensionDisplayData?n=new $(i,!!s.forPreview,t):e instanceof c.BTLinearDimensionDisplayData?n=new K(i,!!s.forPreview,t):e instanceof c.BTAngularDimensionDisplayData?n=new ne(i,!!s.forPreview,t):e instanceof c.BTRadialDimensionDisplayData?n=new se(i,!!s.forPreview,t):e instanceof c.BTCurveLengthDimensionDisplayData?n=new ce(i,!!s.forPreview,t):e instanceof c.BTCountDimensionDisplayData?n=new le(i,!!s.forPreview,t):e instanceof c.BTRhoDimensionDisplayData&&(n=new oe(i,!!s.forPreview,t)),s.isMateValue&&(n.getClearModelSelectionsOnPrehilite=function(){return!1}),n}},496916:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectionVisualizationManager=void 0;const s=i(545348),n=i(719347),r=i(912057),a=i(606544),o=i(114924),c="SIMULATION_BONDED";let l=!1;const h=255;class d{constructor(e,t,i){this.AnalyticsService=e,this.modelViewManager=t,this.simulationManager=i,this.meshOwnerId=(0,o.getNewOwnerId)(),this.elementIdToResponseData=new Map,this.contactTractionThreshold=.1,this.visualizedOccurrencePaths=[],this.connectionTypes=[],this.useIsolateEffect=!0,this.occurrencesMarkedAsSimulated=[],this.contactBehavior=a.GBTSimulationContactBehavior.FUSE_IN_CONTACT_AND_USE_MATES,this.prepareScenegraph()}setVisible(e){this.isVisible!==e&&(this.isVisible=e,!this.isVisible&&this.useIsolateEffect?(this.useIsolateEffect&&this.viewer.getIsolatedOccurrenceManager().clearAllIsolateNoAnimation(),this.clearGraphics()):this.updateGraphics())}setContactBehavior(e){this.contactBehavior!==e&&(this.contactBehavior=e,this.updateGraphics())}getVisible(){return this.isVisible}getUseIsolateEffect(){return this.useIsolateEffect}updateContactAnalysis(e){const t=new n.Timer("ConnectionVisualizationManager.updateContactAnalysis",{setTraceId:!0});let i=!1;if(e.runStatus===a.GBTUiSimulationRunStatus.JUST_STARTED||e.runStatus===a.GBTUiSimulationRunStatus.INVALID_ASSEMBLY)return this.clearGraphics(),void(e.runStatus===a.GBTUiSimulationRunStatus.JUST_STARTED&&this.elementIdToResponseData.delete(e.sourceElementId));if(e.hasResponse)this.elementIdToResponseData.set(e.sourceElementId,e.response),i=!0;else{const t=this.modelViewManager.getDisplayedAssembly();t&&e.runStatus===a.GBTUiSimulationRunStatus.TRANSMITTED&&this.elementIdToResponseData.has(t.elementId)&&(i=!0)}i&&this.updateGraphics(),t.report()}onAssemblyChanged(){this.updateIfVisible()}onSectionSetChanged(){this.updateIfVisible()}updateIfVisible(){this.isVisible&&this.updateGraphics()}updateGraphics(){const e=new n.Timer("ConnectionVisualizationManager.updateGraphics",{setTraceId:!0});if(this.clearGraphics(),!this.isVisible)return;const t=this.modelViewManager.getDisplayedAssembly();if(!t||t.isHidden)return;if(this.viewer.getRenderingMode()!==a.GBTGraphicsRenderMode.SIMULATION_RESULTS)return;const i=this.elementIdToResponseData.get(t.elementId);if(!i||!i.resultData)return void r.log.debug("No data set to display");this.useIsolateEffect=!!s.default.getManager().getNumber("USE_ISOLATE_EFFECT_FOR_CONNECTION_VISUALIZATION");const c=this.viewer.getOccurrenceIdManager(),l=this.viewer.getOccurrenceDataManager(),h=i.resultData,d=new Set;this.updateConnectionTexture(i,t,d);let u=!1;const g=[];for(const e in h.occurrenceIdToOccurrenceResult){const s=h.occurrenceIdToOccurrenceResult[e],n=a.BTOccurrence.getOccurrenceFromPathString(e),p=c.getIdForName(e);if(p===o.INVALID_OCCURRENCE_ID){r.log.warn("No occurrence id for "+e);continue}const m=l.getOccurrenceData(p);m||r.log.warn("No occurrence data for "+e);const E=t.getOccurrenceDisplayData(n);if(!E){r.log.warn("No occurrence display data for "+e);continue}const I=this.modelViewManager.getPartStudioDataFromOccurrence(n);if(!I){r.log.debug("No part studio for occurrence "+e);continue}if(!this.simulationManager.getTessellationForOccurrenceResult(s)){r.log.debug("No simulation tessellation for "+e),u=!0;break}const T=this.getMeshIncrementForOccurrence(i,s,E,d);if(!T)continue;const S=e+".CP";let f,C;this.useIsolateEffect||(I.getBodyComponent().setScalarVisualizationOccurrence(p),this.occurrencesMarkedAsSimulated.push(e)),this.useIsolateEffect?(f=c.getOrCreateIdForName(S),C=l.getOrCreateOccurrenceData(f),C.setTransform(m.getTransform()),C.setIsolated(!0),C.setVisibility(m.getVisibility()),C.setIsClippedBySectionPlanes(m.getIsClippedBySectionPlanes())):(f=p,C=m),g.push(f),T.id=e;const P=this.meshManager.addMeshIncrement(T,this.meshOwnerId),v=new o.IncrementRanges("Contact "+S);v.onIncrementAdded(P);const D=I.retrieveBodyMetaData(E.partIds[0]),M=new o.Style;D&&M.setAttribute(o.Attributes.COLOR,D.getColor()),this.rootNode.addOccurrenceGeometryToNode(this.meshNodeProperties,C,M,v),this.rootNode.addOccurrenceGeometryToNode(this.fadeMeshNodeProperties,C,M,v),this.visualizedOccurrencePaths.push(S)}u?this.clearGraphics():(this.viewer.getEventDispatcher().trigger(o.SIMULATION_CONNECTIONS_DISPLAYED,d),this.viewer.requestDraw(),this.useIsolateEffect&&(this.viewer.getIsolatedOccurrenceManager().clearAllIsolateNoAnimation(),(0,o.setTransparencyTransition)(1),this.viewer.getIsolatedOccurrenceManager().addIdsToIsolate(g,!0)),e.report())}setContactTractionThreshold(e){this.contactTractionThreshold=e,this.updateMaterialUniforms(),this.viewer.requestDraw()}isNodeForBodyVisualization(e){return this.rootNode===e}updateMaterialUniforms(){this.material.setCustomFloatUniform("uMultipleConnectionsCoordinate",this.multipleConnectionCoordinate),this.fadeMaterial.setCustomFloatUniform("uMultipleConnectionsCoordinate",this.multipleConnectionCoordinate),this.material.setCustomFloatUniform("uTractionContactThreshold",Math.floor(this.contactTractionThreshold*h-1)),this.fadeMaterial.setCustomFloatUniform("uTractionContactThreshold",Math.floor(this.contactTractionThreshold*h-1))}get viewer(){return this.modelViewManager.getViewer()}prepareScenegraph(){const e="ContactAnalysis",t=this.modelViewManager.getSharedBodyNode();this.rootNode=t.getChildById(e),this.rootNode||(this.rootNode=new o.Node(e),t.addChild(this.rootNode)),this.material=(0,o.createTextureMaterial)(null),this.material.shaderId="contact",this.fadeMaterial=(0,o.createTextureMaterial)(null),this.fadeMaterial.shaderId="contact",this.material.setCustomFloatUniform("uOcclusionFactor",0),this.material.setCustomFloatUniform("uBlendTransparent",0),this.fadeMaterial.setCustomFloatUniform("uOcclusionFactor",0),this.fadeMaterial.setCustomFloatUniform("uBlendTransparent",1),this.meshNodeProperties=new o.NodeProperties({material:this.material,zOffset:s.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:o.PrimitiveType.TRIANGLES,includedInBlend:!0,addsToSectionMask:!1,clippedBySectionPlanes:!0,isPickable:!1,isTwoSided:!0}),this.fadeMeshNodeProperties=new o.NodeProperties({material:this.fadeMaterial,zOffset:s.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:o.PrimitiveType.TRIANGLES,includedInBlend:!0,addsToSectionMask:!1,clippedBySectionPlanes:!0,isPickable:!1,isTwoSided:!0,primitivesHaveTransparency:!0})}clearGraphics(){const e=this.viewer.getOccurrenceIdManager(),t=this.viewer.getOccurrenceDataManager();for(let i=0;i<this.visualizedOccurrencePaths.length;++i){const s=this.visualizedOccurrencePaths[i],n=e.getIdForName(s);if(n===o.INVALID_OCCURRENCE_ID)continue;t.getOccurrenceData(n)&&(this.rootNode.removeOccurrence(n),t.destroyOccurrenceData(n),e.removeName(s))}this.meshManager&&this.meshManager.destroy(),this.meshManager=new o.MeshManager(this.viewer,{bufferAllocationPolicy:o.BufferAllocationPolicy.MAXIMUM}),this.simulationManager.clearOccurrencesSimulatedStatus(this.occurrencesMarkedAsSimulated),this.occurrencesMarkedAsSimulated=[]}updateConnectionTexture(e,t,i){const n=e.contactPairList.length+2,l=new Uint8Array(4*n*1),h={},d=a.KeyOfGBTSimulationConnectionType.slice(0,a.KeyOfGBTSimulationConnectionType.length-1);for(let e=0;e<d.length;++e)h[d[e]]=(0,o.convertRGBAToRGBA255)(s.default.getManager().getColor("CONTACT_COLOR_"+d[e]));const u=this.getNonMatedContactType(),g=a.GBTSimulationConnectionType[u],p=this.contactBehavior===a.GBTSimulationContactBehavior.FUSE_IN_CONTACT,m={};let E=0;function I(e){const t=e.firstOccurrence.getPathAsString(),i=e.secondOccurrence.getPathAsString();let s;if(s=t<i?t+"-"+i:i+"-"+t,m.hasOwnProperty(s))return m[s];{const e=E++;return m[s]=e,e}}const T=[];this.connectionTypes=[];for(let i=0;i<e.contactPairList.length;++i){const s=e.contactPairList[i];let n;s.occurrencePairId=I(s);let o=g;if(s.mateId&&!p){const e=t.getMateIndicatorData(s.mateId);let i=u;e?i=e.getSimulationConnectionType():r.log.debug("Failed to find mate for connection visualization: "+s.mateId),o=a.GBTSimulationConnectionType[i],n=h[i]?h[i]:h[u]}else n=h[u];this.connectionTypes.push(o),T.push({contactPairIndex:i,contactPair:s,connectionType:o});const c=4*i*1;l.set(n,c)}this.sortContactFields(T);let S=-1;for(let e=0;e<T.length;++e){const t=T[e];let s=!0;(p&&t.contactPair.hasSimulationConnections||S===t.contactPair.occurrencePairId&&t.connectionType===g)&&(s=!1),t.connectionType!==g&&(S=t.contactPair.occurrencePairId),s&&i.add(t.connectionType)}const f=4*(n-1)*1;l.set(h.MULTIPLE,f);const C=4*(n-2)*1;l.set(h[c],C);const P=new o.TextureDefinition(this.viewer.getGlContext());P.bytes=l,P.width=1,P.height=n,this.material.ambientTexture&&this.material.ambientTexture.destroy(),this.material.ambientTexture=new o.Texture(this.viewer,P),this.material.ambientTexture.setHasTransparency(!1),this.fadeMaterial.ambientTexture=this.material.ambientTexture,this.textureInfo={textureEntryCount:n,texelHeight:1/n,texelWidth:1},this.updateMaterialUniforms()}getNonMatedContactType(){return this.contactBehavior===a.GBTSimulationContactBehavior.MATES_ONLY?"UNCONSTRAINED":c}getMeshIncrementForOccurrence(e,t,i,s){const n=this.simulationManager.getTessellationForOccurrenceResult(t);if(!n)return null;const r=this.simulationManager.getSampleMesh(n,t),a=new o.MeshIncrement(o.PrimitiveType.TRIANGLES,r.points,r.getAnyIndices()),c=this.getContactAttributesForResult(e,t,s);if(!c)return null;a.contactTraction=c.contactTraction,a.contactPairCoordinate=c.contactPairCoordinate;const l=this.modelViewManager.getPartStudio(t.sourcePartReference);if(l){const e=l.getBodyBounds(n.deterministicId,i.occurrenceData.occurrence);e&&(a.boundingBox=e)}return a}sortContactFields(e){const t=a.GBTSimulationConnectionType[this.getNonMatedContactType()];e.sort(((e,i)=>e.contactPair.occurrencePairId===i.contactPair.occurrencePairId?e.connectionType===i.connectionType?e.contactPairIndex-i.contactPairIndex:e.connectionType===t?1:i.connectionType===t?-1:e.connectionType-i.connectionType:e.contactPair.occurrencePairId<i.contactPair.occurrencePairId?-1:1))}getContactAttributesForResult(e,t,i){if(0===t.fields.length)return r.log.debug("Found occurrence result with no fields"),null;const s=[];let n=0;for(let i=0;i<t.fields.length;++i){const n=t.fields[i];for(let t=0;t<n.contactPairIndices.length;++t){const i=n.contactPairIndices[t],r=this.connectionTypes[i],a=e.contactPairList[i];s.push({contactPairIndex:i,connectionType:r,contactPair:a,field:n,visible:!1})}}const o=a.GBTSimulationConnectionType[this.getNonMatedContactType()];this.sortContactFields(s);const c=this.contactBehavior===a.GBTSimulationContactBehavior.FUSE_IN_CONTACT,d=[];let u=-1;for(let t=0;t<s.length;++t){const i=s[t];let r=!this.simulationManager.getVisualizationState().connectionTypeToHidden[i.connectionType];const a=e.contactPairList[i.contactPairIndex];(c&&a.hasSimulationConnections||u===i.contactPair.occurrencePairId&&i.connectionType===o)&&(r=!1),i.connectionType!==o&&(u=i.contactPair.occurrencePairId),i.visible=r,r&&(++n,d.push(i))}if(0===n)return null;const g=s[0].field.values.length,p=new Uint8Array(16*g),m=new Float32Array(16*g);let E=!1,I=0,T=0;const S=[];for(let e=0;e<d.length;++e)S.push(this.getTextureCoordinate(d[e].contactPairIndex));if(n>16){l||(this.AnalyticsService.trackEvent("SIMULATION","high-connection-count"),l=!0);const e=this.multipleConnectionCoordinate;c||(E=!0);for(let t=0;t<g;++t){let i=d[0].field.values[t];for(let e=1;e<d.length;++e){const s=d[e].field.values[t];s>i&&(i=s)}p[I++]=Math.min(255,h*i),m[T++]=e;for(let e=1;e<16;++e)I++,T++}}else for(let e=0;e<g;++e){let t=0;for(let i=0;i<16;++i)if(i<d.length){const s=d[i].field.values[e];s>=this.contactTractionThreshold&&++t,p[I++]=Math.min(255,h*s),m[T++]=S[i]}else I++,T++;E=t>1&&!c||E}return E&&i.add(a.GBTSimulationConnectionType.MULTIPLE),{contactTraction:p,contactPairCoordinate:m}}getTextureCoordinate(e){return.5*this.textureInfo.texelHeight+e*this.textureInfo.texelHeight}get multipleConnectionCoordinate(){return this.contactBehavior===a.GBTSimulationContactBehavior.FUSE_IN_CONTACT?this.getTextureCoordinate(this.textureInfo.textureEntryCount-2):this.getTextureCoordinate(this.textureInfo.textureEntryCount-1)}}t.ConnectionVisualizationManager=d,d.$inject=["AnalyticsService"]},107117:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CurvatureAnalysisLegend=void 0;const s=i(545348),n=i(402198),r=i(136675),a=i(683067),o=i(114924);class c extends r.ScalarVisualizationLegend{constructor(e){super(e),this.manager=e,this.LEGEND_MAXIMUM_CLICKED=a.CURVATURE_ANALYSIS_LEGEND_MAXIMUM_CLICKED,this.LEGEND_MINIMUM_CLICKED=a.CURVATURE_ANALYSIS_LEGEND_MINIMUM_CLICKED,this.LEGEND_RANGE_CHANGED=a.CURVATURE_ANALYSIS_RANGE_CHANGED,this.CANVAS_CONTROLS_PANEL_ID=a.CURVATURE_ANALYSIS_CANVAS_CONTROLS_PANEL_ID,this.supportsInContextMode=!0}get SNAPPING_MARGIN_TOP(){return s.default.getManager().getNumber("CURVATURE_ANALYSIS_TOP_TOOLBAR_HEIGHT_PX")+(0,n.getCanvasControlShiftDistance)(a.CURVATURE_ANALYSIS_CANVAS_CONTROLS_PANEL_ID)}getInputRangeValueString(e){return this.manager.getInputRangeBoundaryString(e)}isInputMaximumChanged(e){const t=this.manager.getRangeInData();return!!(t&&t.max>o.INFINITE_CURVATURE_CUTOFF)||super.isInputMaximumChanged(e)}getInputRangeInDisplayUnits(){return this.manager.getRangeInDisplayUnits(this.manager.getRangeInData())}getDefaultDisplayRangeInDisplayUnits(){return this.manager.getRangeInDisplayUnits(this.manager.getDefaultDisplayRange())}}t.CurvatureAnalysisLegend=c},379168:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CurvatureAnalysisManager=t.COLOR_MAP_TESSELLATION_SETTING_INDEX=t.CURVATURE_VISUALIZATION_MANAGER_NODE_ID=t.INFINITE_CURVATURE_CUTOFF=void 0;const s=i(606544),n=i(845029),r=i(114924),a=i(197134),o=i(845556),c=i(845033),l=i(972968),h=i(997687),d=i(684556),u=i(973008),g=i(196207),p=i(683067),m=i(32620),E=i(762776),I=i(873896),T="meter";t.INFINITE_CURVATURE_CUTOFF=1e4,t.CURVATURE_VISUALIZATION_MANAGER_NODE_ID="CurvatureAnalysisManager",t.COLOR_MAP_TESSELLATION_SETTING_INDEX=s.BTTessellationSetting.getTessellationSettingIndexFromEnum(s.GBTTessellationSettingEnum.CURVATURE_VISUALIZATION);class S extends r.ScalarVisualizationManager{constructor(e){super(e.getModelViewManagers().getManager()),this.viewer=e,this.COLOR_MAP_STORAGE_KEY=n.CURVATURE_COLOR_MAP_STORAGE_KEY,this.LEGEND_OPENED=p.CURVATURE_ANALYSIS_LEGEND_OPENED,this.LEGEND_CLOSED=p.CURVATURE_ANALYSIS_LEGEND_CLOSED,this.VISUALIZATION_MANAGER_NODE_ID=t.CURVATURE_VISUALIZATION_MANAGER_NODE_ID,this.graphicsRenderMode=s.GBTGraphicsRenderMode.SHADED_CURVATURE_VISUALIZATION,this.DEFAULT_COLOR_MAPPING=d.DEFAULT_CURVATURE_ANALYSIS_COLOR_MAPPING,this.messageBubble=h.btInjector.MessageBubbleService.createMessageBubbleWithAutoDismiss("warning"),this.visualizedRangeCache=new Map,this.curvatureTypeCache=new Map,this.displayedScalarRangeSpecification={rangeInData:null,defaultDisplayRange:null},this.visualizationState=new s.BTCurvatureVisualizationState,this.mainScenegraphManager=new r.CurvatureAnalysisScenegraphManager(this.modelViewManager,"CurvatureAnalysis",this.scalarVisualizationMaterials),this.resetMeshes(),this.setColorMapping(this.getStoredColorMapping()),(0,r.getObservableFromActiveViewerForEvent)(r.DEFAULT_UNITS_CHANGED).subscribe((()=>{this.updateVisualizedScalarRange()}))}getViewer(){return this.viewer}isVisualizing(){var e;return this.mainScenegraphManager.isVisualizing()||!!(null===(e=this.previewScenegraphManager)||void 0===e?void 0:e.isVisualizing())}resetScenegraphNodes(){var e;super.resetScenegraphNodes(),this.mainScenegraphManager.resetScenegraphNodes(),null===(e=this.previewScenegraphManager)||void 0===e||e.resetScenegraphNodes()}hideMapping(e){var t;this.mainScenegraphManager.hideMapping(e),null===(t=this.previewScenegraphManager)||void 0===t||t.hideMapping(e),super.hideMapping(e)}showMapping(e){var t;this.mainScenegraphManager.showMapping(e),null===(t=this.previewScenegraphManager)||void 0===t||t.showMapping(e),super.showMapping(e)}updateGraphics(){if(this.viewerIsInScalarVisualizationRenderMode()){if(this.cursorAppendage||(this.cursorAppendage=new r.CursorAppendage(this.getViewer(),((e,t)=>this.getCursorText(e,t)))),this.followModeCursorAppendage||(this.followModeCursorAppendage=new r.CursorAppendageLeader(this.getViewer(),((e,t)=>this.getCursorText(e,t)))),this.readyToShowLegend()){const e=this.getRangeInData(),t=this.getDefaultDisplayRange();this.legend.setInputRange({rangeInData:e,defaultDisplayRange:t})}this.showMapping(this.displayedColorMap),this.updateVisualizedScalarRange()}}getValueInBaseUnits(e){const t=(0,a.getCurrentDocumentSettingsModel)().getLengthUnits();if(!t)return null;const i=this.getCurvatureTypeUnitPower(),s={[t]:i},n={[T]:i};return(0,o.convertBetweenCompoundUnits)(e,s,n)}getRangeInDisplayUnits(e){const t=(0,a.getCurrentDocumentSettingsModel)().getLengthUnits();return e&&t?(0,o.convertRangeToCompoundUnits)(e,t,this.getCurvatureTypeUnitPower()):null}getRangeInBaseUnits(e){return(0,o.convertRangeToCompoundUnits)(e,T,this.getCurvatureTypeUnitPower())}getRangeInData(){var e,t,i,s;let n;return n=(0,r.isUsagePreview)()?null!==(t=null===(e=this.previewScenegraphManager)||void 0===e?void 0:e.getRangeInData())&&void 0!==t?t:this.mainScenegraphManager.getRangeInData():null!==(i=this.mainScenegraphManager.getRangeInData())&&void 0!==i?i:null===(s=this.previewScenegraphManager)||void 0===s?void 0:s.getRangeInData(),null==n?void 0:n.addUnits(T,this.getCurvatureTypeUnitPower())}getClampedRangeInData(){var e,t,i,s;let n;return n=(0,r.isUsagePreview)()?null!==(t=null===(e=this.previewScenegraphManager)||void 0===e?void 0:e.getClampedRangeInData())&&void 0!==t?t:this.mainScenegraphManager.getClampedRangeInData():null!==(i=this.mainScenegraphManager.getClampedRangeInData())&&void 0!==i?i:null===(s=this.previewScenegraphManager)||void 0===s?void 0:s.getClampedRangeInData(),null==n?void 0:n.addUnits(T,this.getCurvatureTypeUnitPower())}setRangeInData(e){var t;this.mainScenegraphManager.setRangeInData(e),null===(t=this.previewScenegraphManager)||void 0===t||t.setRangeInData(e)}setClampedRangeInData(e){var t;this.mainScenegraphManager.setClampedRangeInData(e),null===(t=this.previewScenegraphManager)||void 0===t||t.setClampedRangeInData(e)}readyToShowLegend(){return this.viewerIsInScalarVisualizationRenderMode()&&!!this.legend}prepareResources(){var e;super.prepareResources(),this.legend||(this.legend=new r.CurvatureAnalysisLegend(this)),this.mainScenegraphManager.prepareResources(),null===(e=this.previewScenegraphManager)||void 0===e||e.prepareResources()}clearAndUpdateCurvatures(){var e,t;this.clearGraphics(),this.requestMissingCurvatureTessellations(),this.mainScenegraphManager.updateNodesWithCurvatureData(),null===(e=this.getOrCreatePreviewScenegraphManager())||void 0===e||e.updateNodesWithCurvatureData(),this.updateScalarRangeFromCurvatureData(),null===this.getRangeInData()&&(null===(t=this.legend)||void 0===t||t.clearRanges()),this.showLegend(),this.updateGraphics()}onRenderingModeChanged(){var e;super.onRenderingModeChanged(),this.viewerIsInScalarVisualizationRenderMode()&&this.modelViewManager.displayingPartStudio()?(this.getViewer().getUserEnabledAggressiveRefinement()&&this.getViewer().setUserEnabledAggressiveRefinement(!1),this.clearAndUpdateCurvatures()):((this.isVisualizing()||this.mainScenegraphManager.getDisplayedPartStudioHasPendingTessellationRequests()||(null===(e=this.previewScenegraphManager)||void 0===e?void 0:e.getDisplayedPartStudioHasPendingTessellationRequests()))&&this.getViewer().getEventDispatcher().trigger(r.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES),this.clearScalarVisualizationForVisualizedBodies())}onDocumentDestroyed(){this.mainScenegraphManager.clearPendingTessellationRequests(),this.destroyPreviewScenegraphManager(),this.curvatureTypeCache=new Map}onDocumentReconnect(){var e;this.mainScenegraphManager.clearPendingTessellationRequests(),null===(e=this.previewScenegraphManager)||void 0===e||e.clearPendingTessellationRequests()}onPreviewDestroyed(){this.destroyPreviewScenegraphManager(),this.readyToShowLegend()||this.hideLegend()}onEstimatedMemoryLimitExceeded(e=!1){e&&this.viewer.setRenderingMode(s.GBTGraphicsRenderMode.SHADED_WITH_EDGES),this.messageBubble.showMessage(i18n("Color map may exceed browser memory limits. Try hiding unnecessary parts or surfaces.")),h.btInjector.AngularEventService.ensureDigest()}destroyPreviewScenegraphManager(){var e;null===(e=this.previewScenegraphManager)||void 0===e||e.resetMeshes(),this.previewScenegraphManager=null}preventChangeToRenderMode(e){var i,s,n;if(this.graphicsRenderMode!==e)return!1;if((0,r.isUsageCompare)())return this.messageBubble.showMessage(i18n("Curvature color map is not currently supported while comparing.")),h.btInjector.AngularEventService.ensureDigest(),!0;if(g.DocumentController.getOpenDocumentController().isInterferenceDetectionActive())return this.messageBubble.showMessage(i18n("Curvature color map is not currently supported during interference detection.")),h.btInjector.AngularEventService.ensureDigest(),!0;const a=null!==(i=this.mainScenegraphManager.getBodiesToVisualize())&&void 0!==i?i:new Set,o=null!==(n=null===(s=this.previewScenegraphManager)||void 0===s?void 0:s.getBodiesToVisualize())&&void 0!==n?n:new Set;return!this.getViewer().getBodyManager().checkBodiesUnderMemoryLimit(t.COLOR_MAP_TESSELLATION_SETTING_INDEX,new Set([...a,...o]))&&(this.onEstimatedMemoryLimitExceeded(),!0)}onCheckInterferences(){this.graphicsRenderMode===this.getViewer().getRenderingMode()&&(h.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("Curvature color map is not currently supported during interference detection."),"warning"),h.btInjector.AngularEventService.ensureDigest(),this.getViewer().setRenderingMode(s.GBTGraphicsRenderMode.SHADED_WITH_EDGES))}userCanEnableColorMap(){const e=g.DocumentController.getOpenDocumentController().isInterferenceDetectionActive(),t=(0,r.isUsageCompare)();return!e&&!t}onPartStudioDisplayed(){this.viewerIsInScalarVisualizationRenderMode()&&this.setCurvatureType(this.getCachedCurvatureTypeForElement())}onPartStudioDisplayDataChanged(e,t){if(!e.isNoop&&this.viewerIsInScalarVisualizationRenderMode()){if(e.hasCurvatureTessellation())this.clearAndUpdateCurvatures();else{this.requestMissingCurvatureTessellations()||this.clearAndUpdateCurvatures()}this.updateFollowModeCache()}}getCachedCurvatureTypeForElement(){const e=this.getViewer().getActiveElementId(),t=this.curvatureTypeCache.get(e);return t&&t!==s.GBTCurvatureType.UNKNOWN?t:s.GBTCurvatureType.GAUSSIAN}onChangeActiveElement(){this.clearGraphics()}clearGraphics(){var e,t;this.clearScalarVisualizationForVisualizedBodies(),this.messageBubble.dismissMessage(),null===(e=this.legend)||void 0===e||e.clearRanges(),this.setRangeInData(null),this.setClampedRangeInData(null),this.setDefaultDisplayRange(null),this.resetMeshes(),null===(t=this.followModeCursorAppendage)||void 0===t||t.destroy(),this.followModeCursorAppendage=null,super.clearGraphics()}resetMeshes(){var e,t;null===(e=this.mainScenegraphManager)||void 0===e||e.resetMeshes(),null===(t=this.previewScenegraphManager)||void 0===t||t.resetMeshes()}requestMissingCurvatureTessellations(){var e,t,i,s;const n=null!==(e=this.mainScenegraphManager.getBodiesThatNeedCurvatureTessellations())&&void 0!==e?e:[],r=null!==(i=null===(t=this.getOrCreatePreviewScenegraphManager())||void 0===t?void 0:t.getBodiesThatNeedCurvatureTessellations())&&void 0!==i?i:[],a=new Set(n.concat(r));if(0===a.size)return!1;return this.requestCurvatureData(a)?(this.onEstimatedMemoryLimitExceeded(!0),!1):(this.mainScenegraphManager.didRequestCurvatureDataForBodies(n),null===(s=this.getOrCreatePreviewScenegraphManager())||void 0===s||s.didRequestCurvatureDataForBodies(r),!0)}getOrCreatePreviewScenegraphManager(){if(!this.previewScenegraphManager){const e=this.getViewer().getModelViewManagers().getPreviewManager();if(!(null==e?void 0:e.getDisplayedPartStudio()))return null;this.previewScenegraphManager=new r.CurvatureAnalysisScenegraphManager(e,"CurvatureAnalysisPreview",this.scalarVisualizationMaterials),this.previewScenegraphManager.prepareResources(),this.previewScenegraphManager.setCurvatureType(this.getCurvatureType())}return this.previewScenegraphManager}clearScalarVisualizationForVisualizedBodies(){var e,t,i;null===(e=this.mainScenegraphManager.getBodyComponent())||void 0===e||e.clearAllScalarVisualizationOccurrences(),null===(i=null===(t=this.previewScenegraphManager)||void 0===t?void 0:t.getBodyComponent())||void 0===i||i.clearAllScalarVisualizationOccurrences()}requestCurvatureData(e){if(!e||0===e.size)return!1;const i=[];if(!this.viewer.getBodyManager().checkBodiesUnderMemoryLimit(t.COLOR_MAP_TESSELLATION_SETTING_INDEX,e))return!0;for(const n of e){const e=new s.BTUiOccurrenceDisplayDataRequest;e.bodyDeterministicId=n,e.tessellationSetting=t.COLOR_MAP_TESSELLATION_SETTING_INDEX,i.push(e)}return this.getViewer().getEventDispatcher().trigger(r.ADD_TEMPORARY_TESSELLATION_OVERRIDES,i),!1}setVisualizedScaleComponent(e,t){super.setVisualizedScaleComponent(e,t),this.updateVisualizedRangeCache()}getCurvatureTypeUnitPower(){switch(this.getCurvatureType()){case s.GBTCurvatureType.GAUSSIAN:return-2;case s.GBTCurvatureType.MEAN:return-1;case s.GBTCurvatureType.MAX_RADIUS:case s.GBTCurvatureType.MIN_RADIUS:default:return 1}}getBaseUnitsRange(e,t){return s.BTRange.fromMinMax(e,t,T,this.getCurvatureTypeUnitPower())}updateScalarRangeFromCurvatureData(){const e=this.getCachedRange(),i=this.getClampedRangeInData();this.updateDefaultDisplayRange(i);const s=this.getRangeInData(),n=this.getValueInBaseUnits(1);if(s&&0===s.magnitude){let e;e=this.isInCurvatureRadiusMode()&&s.mean>t.INFINITE_CURVATURE_CUTOFF?this.getBaseUnitsRange(0,n):this.isInCurvatureRadiusMode()&&s.mean<n?this.getBaseUnitsRange(0,2*s.mean):this.getBaseUnitsRange(s.mean-n,s.mean+n),this.updateDefaultDisplayRange(e)}e?this.setVisualizedRange(e):this.setVisualizedRange(this.getDefaultDisplayRange())}resetScalarRange(e){const i=this.getDefaultDisplayRange(),s=this.visualizedScalarRange.clone();switch(e){case l.RangeComponent.MAX:const e=this.isInCurvatureRadiusMode()?Math.min(i.max,t.INFINITE_CURVATURE_CUTOFF):i.max;s.max=e;break;case l.RangeComponent.MIN:s.min=i.min}this.setVisualizedRange(s),this.updateVisualizedRangeCache()}setCurvatureType(e){if(this.getCurvatureType()===e)return;const t=this.getVisualizationState().clone();t.curvatureType=e,this.setVisualizationState(t)}updateCurvatureType(e){var t;this.mainScenegraphManager.setCurvatureType(e),null===(t=this.previewScenegraphManager)||void 0===t||t.setCurvatureType(e),this.clearAndUpdateCurvatures();const i=this.getViewer().getActiveElementId();this.curvatureTypeCache.set(i,e)}getCurvatureType(){return this.visualizationState.curvatureType}moveLegendTo(e,t){var i;if(!e||e.some((e=>!isFinite(e)))||!this.legend)return;(null===(i=this.legend.colorMapCorners)||void 0===i?void 0:i.bottomLeft)||this.legend.setupCorners();const n=(0,m.getDevicePixelRatio)(),r=e.map((e=>e*n));this.legend.setIsVertical(t);const a=this.legend.colorMapCorners.topRight.y-this.getViewer().getCamera().getCanvasHeight()+r[1],o=this.legend.colorMapCorners.bottomLeft.x-r[0],c=s.BTVector2d.fromXY(o,a);c.isZeroVector()||this.legend.moveLegend(c,void 0,!0)}getLegend(){return this.legend}getLegendMovedObservable(){return this.prepareResources(),this.legend.getLegendMovedObservable()}isInCurvatureRadiusMode(){return this.getCurvatureType()===s.GBTCurvatureType.MAX_RADIUS||this.getCurvatureType()===s.GBTCurvatureType.MIN_RADIUS}onReceiveFollowModeMessage(e){if(!e||!e.visualizationState||!this.followViewDataMessageCache)return;this.setCurvatureType(e.visualizationState.curvatureType);const t=e.legendTopLeftCoordinates.slice(),i=E.FollowView.convertCanvasCoordinateLeaderToFollower(t,this.followViewDataMessageCache);this.moveLegendTo(i,e.legendIsVertical),this.shouldUpdateVisualizationStateFromMessage(e)?this.updateVisualizationStateFromMessage(e):this.followModeMessageCache=e}onReceiveFollowViewDataMessage(e){this.followViewDataMessageCache=e}shouldUpdateVisualizationStateFromMessage(e){var t;return e&&(null===(t=this.getRangeInData())||void 0===t?void 0:t.equals(e.rangeInData,I.Tolerances.ZERO_LENGTH))}updateVisualizationStateFromMessage(e){var t;const i=e.visualizationState;(null===(t=i.visualizedRange)||void 0===t?void 0:t.noRange)||(this.setVisualizationState(i),this.updateVisualizedRangeCache())}updateFollowModeCache(){this.followModeMessageCache&&((0,r.isInFollowMode)()?this.shouldUpdateVisualizationStateFromMessage(this.followModeMessageCache)&&(this.updateVisualizationStateFromMessage(this.followModeMessageCache),this.followModeMessageCache=null):this.followModeMessageCache=null)}setVisualizationState(e){const t=this.getCurvatureType()!==e.curvatureType;super.setVisualizationState(e),t&&this.updateCurvatureType(e.curvatureType)}getCursorText(e,i){var s;if((null===(s=this.legend)||void 0===s?void 0:s.isBeingDragged)||!this.getRangeInData())return null;{const s=this.getCursorValue(e,i);if(!(0,c.isNumber)(s))return;if(this.isInCurvatureRadiusMode()&&this.getValueInBaseUnits(s)>t.INFINITE_CURVATURE_CUTOFF)return"♾️";const n=(0,a.getCurrentDocumentSettingsModel)().getLengthUnitsDisplayPrecision(),r=u.PrecisionType.UserWorkspace,o=1/Math.pow(10,n);return u.ValueAndUnitsFormatter.getNumberString(s,n,r,o)}}getInputRangeBoundaryString(e){const i=this.getRangeInData(),s=i.getValueFromRangeComponent(e);if(this.isInCurvatureRadiusMode()&&s>t.INFINITE_CURVATURE_CUTOFF)return"♾️";const n=this.getRangeInDisplayUnits(i).getValueFromRangeComponent(e);return this.getValueString(n)}updateVisualizedRangeCache(){const e=this.getViewer().getActiveElementId();if(!this.visualizedScalarRange||0===e.length)return;let t,i=this.visualizedRangeCache.get(e);i||(i=new Map),t=this.visualizedScalarRange.equals(this.getDefaultDisplayRange())?null:this.visualizedScalarRange,i.set(this.getCurvatureType(),t),this.visualizedRangeCache.set(e,i)}getCachedRange(){var e;const t=this.getViewer().getActiveElementId(),i=this.visualizedRangeCache.get(t);return i&&null!==(e=i.get(this.getCurvatureType()))&&void 0!==e?e:null}}t.CurvatureAnalysisManager=S},754175:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CurvatureAnalysisScenegraphManager=void 0;const s=i(912057),n=i(606544),r=i(114924),a=i(845033),o=i(719347),c=i(545348),l=new Float32Array(2);t.CurvatureAnalysisScenegraphManager=class{constructor(e,t,i){this.modelViewManager=e,this.parentNodeId=t,this.scalarVisualizationMaterials=i,this.nodes=[],this.VISUALIZATION_MANAGER_NODE_ID=r.CURVATURE_VISUALIZATION_MANAGER_NODE_ID,this.meshOwnerId=(0,r.getNewOwnerId)(),this.bodyIdsWithPendingTessellationRequest=new Map,this.resetMeshes()}isVisualizing(){var e;return!!(null===(e=this.getBodyComponent())||void 0===e?void 0:e.isVisualizingOccurrences())}getViewer(){return this.modelViewManager.getViewer()}getBodyComponent(){var e;return null===(e=this.getDisplayedPartStudio())||void 0===e?void 0:e.getBodyComponent()}getDisplayedPartStudio(){return this.modelViewManager.getDisplayedPartStudio()}setCurvatureType(e){this.curvatureType=e}getCurvatureType(){return this.curvatureType}setBodyHasPendingTessellationRequest(e,t){var i;if(!t)return;const s=null!==(i=this.bodyIdsWithPendingTessellationRequest.get(t))&&void 0!==i?i:new Set;s.add(e),this.bodyIdsWithPendingTessellationRequest.set(t,s)}unsetBodyHasPendingTessellationRequest(e,t){const i=this.bodyIdsWithPendingTessellationRequest.get(t);i&&(i.delete(e),this.bodyIdsWithPendingTessellationRequest.set(t,i))}getBodyHasPendingTessellationRequest(e,t){const i=this.bodyIdsWithPendingTessellationRequest.get(t);return i&&i.has(e)}getDisplayedPartStudioHasPendingTessellationRequests(){var e;const t=null===(e=this.getDisplayedPartStudio())||void 0===e?void 0:e.getElementId();if(!t)return!1;const i=this.bodyIdsWithPendingTessellationRequest.get(t);return i&&i.size>0}clearPendingTessellationRequests(){this.bodyIdsWithPendingTessellationRequest=new Map}prepareResources(){if(!this.rootNode){const e=this.modelViewManager.getSharedBodyNode();this.rootNode=e.getChildById(this.VISUALIZATION_MANAGER_NODE_ID),this.rootNode||(this.rootNode=new r.Node(this.VISUALIZATION_MANAGER_NODE_ID),e.addChild(this.rootNode))}if(this.resetScenegraphNodes(),!this.nodePropertiesSolids||0===this.nodePropertiesSolids.length||!this.nodePropertiesSurfaces||0===this.nodePropertiesSurfaces.length){this.nodePropertiesSolids=[],this.nodePropertiesSurfaces=[];for(let e=0;e<r.CurvatureAnalysisManager.imageMaps.length;++e){const t=this.scalarVisualizationMaterials[e];t.ambientTextureFactor=0;const i=new r.NodeProperties({material:t,zOffset:c.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:r.PrimitiveType.TRIANGLES,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1,isTwoSided:!1});this.nodePropertiesSolids.push(i);const s={zOffset:c.default.getManager().getNumber("SURFACE_Z_OFFSET"),isTwoSided:!0},n=i.cloneAndModify(s);this.nodePropertiesSurfaces.push(n)}}}resetScenegraphNodes(){if(this.rootNode){for(let e=0;e<this.nodes.length;++e)this.nodes[e].remove();this.nodes=[];for(let e=0;e<r.ScalarVisualizationManager.imageMaps.length;++e){const t=new r.Node(this.VISUALIZATION_MANAGER_NODE_ID+"."+e,{isPickable:!1,clippedBySectionPlanes:!0});t.setVisible(!1),this.nodes.push(t),this.rootNode.addChild(t)}}}hideMapping(e){const t=r.ScalarVisualizationManager.getMapIndex(e),i=this.nodes[t];i&&i.setVisible(!1)}showMapping(e){const t=r.ScalarVisualizationManager.getMapIndex(e),i=this.nodes[t];i&&i.setVisible(!0)}resetMeshes(){this.meshManager&&this.meshManager.destroy(),this.meshManager=new r.MeshManager(this.getViewer(),{bufferAllocationPolicy:r.BufferAllocationPolicy.MAXIMUM})}updateNodesWithCurvatureData(){const e=this.getBodyComponent();if(!e)return;const t=new o.Timer(`CurvatureAnalysisManager.updateNodesWithCurvatureData - Usage: ${this.modelViewManager.usage}`);this.resetMeshes();const i=this.getDisplayedPartStudio().getElementId();for(const t of this.getBodiesWithCurvatureTessellations()){const s=e.bodyMetaData[t],n=e.getBodyOccurrenceData(t);if(!this.shouldVisualizeBody(s,n))continue;const a=s.isClosedCompositeConstituent?s.closedCompositeParentId:t;this.unsetBodyHasPendingTessellationRequest(a,i);const o=new r.IncrementRanges(this.parentNodeId+" "+n.getOccurrenceId()),c=this.getPartStudioFaceEntityIdsForBody(s);for(const e of c){const t=this.getMeshIncrementWithScalars(e),i=this.meshManager.addMeshIncrement(t,this.meshOwnerId);o.onIncrementAdded(i)}const l=new r.Style;l.setAttribute(r.Attributes.COLOR,s.getColor());const h=s.containsOnlySheetBodies()?this.nodePropertiesSurfaces:this.nodePropertiesSolids;for(let e=0;e<h.length&&e<this.nodes.length;++e)this.nodes[e].addOccurrenceGeometryToNode(h[e],n,l,o);e.setScalarVisualizationOccurrence(n.getOccurrenceId(),s.getId())}t.report()}getBodiesThatNeedCurvatureTessellations(){const e=this.getBodyComponent();if(!e)return;const t=new Set;for(const i of this.getBodiesToVisualize()){const s=e.retrieveBodyMetaData(i),n=e=>e===r.COLOR_MAP_TESSELLATION_SETTING_INDEX;if(!s||s.tessellationSettings.findIndex(n)>-1)continue;const a=s.isClosedCompositeConstituent?s.closedCompositeParentId:i,o=this.getDisplayedPartStudio().getElementId();this.getBodyHasPendingTessellationRequest(a,o)||t.add(a)}return[...t]}shouldVisualizeBody(e,t){return((null==e?void 0:e.isSolidBody())||(null==e?void 0:e.isSheetBody())||(null==e?void 0:e.isClosedComposite)&&!(null==e?void 0:e.containsOnlyWireBodies()))&&(null==t?void 0:t.getVisibility())===r.Visibility.VISIBLE}getBodiesToVisualize(){const e=this.getBodyComponent();if(!e)return;const t=new Set;for(const i of e.getBodyIds()){const s=e.retrieveBodyMetaData(i),n=e.getBodyOccurrenceData(i);this.shouldVisualizeBody(s,n)&&t.add(i)}return t}getBodiesWithCurvatureTessellations(){var e,t;const i=e=>e===r.COLOR_MAP_TESSELLATION_SETTING_INDEX;return null!==(t=null===(e=this.getBodyComponent())||void 0===e?void 0:e.getBodyIds((e=>e.tessellationSettings.findIndex(i)>-1)))&&void 0!==t?t:[]}getPartStudioFaceEntityIdsForBody(e){const t=this.getDisplayedPartStudio();if(!t)return[];const i=e.isClosedComposite?e.constituentBodyIds:[e.getId()],s=[];for(const e of i){const i=t.getEntitiesForBody(e,(e=>e.isFace()));s.push(...i)}return s}getFaceEntityMetadata(e){var t;const i=null===(t=this.getDisplayedPartStudio())||void 0===t?void 0:t.retrieveEntityMetaData(e);return i&&i.isFace()?i:null}getMeshIncrementWithScalars(e){const t=this.getFaceEntityMetadata(e),i=t.getGeometry();if(!i)return s.log.debug(`Tried to get mesh increment with curvature data for entityId="${e}" but entity was not a BTEntityFace`),null;const n=t.getMeshIncrement().clone();if(i.hasValidCurvatureData()&&!i.isPlanarFace()){const e=this.getIncrementCurvatures(i.maxPrincipleCurvatureMagnitudes,i.minPrincipleCurvatureMagnitudes);n.packScalarsIntoTextureCoordinates(e),this.updateRanges(e)}else i.isPlanarFace()&&n.replicateTextureCoordinate(l);return n}updateRanges(e){const t=n.BTRange.fromMinMax(1/0,-1/0),i=n.BTRange.fromMinMax(1/0,-1/0);for(const s of e){s<t.min&&(t.min=s),s>t.max&&(t.max=s);const e=Math.min(s,r.INFINITE_CURVATURE_CUTOFF);e<i.min&&(i.min=e),e>i.max&&(i.max=e)}const s=n.BTRange.combine(this.getRangeInData(),t);this.setRangeInData(s);const a=n.BTRange.combine(this.getClampedRangeInData(),i);this.setClampedRangeInData(a)}setRangeInData(e){this.rangeInData=e}setClampedRangeInData(e){this.clampedRangeInData=e}getRangeInData(){return this.rangeInData}getClampedRangeInData(){return this.clampedRangeInData}getIncrementCurvatures(e,t){if(!e||!t)return void s.log.warn("The passed arrays of principle curvatures were not defined");const i=e=>(0,a.clamp)(1/e,-1/0,r.INFINITE_CURVATURE_CUTOFF+1);switch(this.getCurvatureType()){case n.GBTCurvatureType.MIN_RADIUS:{const s=(e,t)=>Math.max(Math.abs(e),Math.abs(t)),n=(e,t)=>i(s(e,t));return(0,a.zipWith)(e,t,n)}case n.GBTCurvatureType.MAX_RADIUS:{const s=(e,t)=>Math.min(Math.abs(e),Math.abs(t)),n=(e,t)=>i(s(e,t));return(0,a.zipWith)(e,t,n)}case n.GBTCurvatureType.MEAN:{const i=(e,t)=>(e+t)/2;return(0,a.zipWith)(e,t,i)}case n.GBTCurvatureType.GAUSSIAN:default:const s=(e,t)=>e*t;return(0,a.zipWith)(e,t,s)}}didRequestCurvatureDataForBodies(e){var t;for(const i of e)this.setBodyHasPendingTessellationRequest(i,null===(t=this.getDisplayedPartStudio())||void 0===t?void 0:t.getElementId())}}},156398:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Decal=t.isNodeForDecal=void 0;const s=i(545348),n=i(148734),r=i(912057),a=i(606544),o=i(114924),c="uDecalProjection",l="uCylinderRadius",h="decals";t.isNodeForDecal=function(e){var t;return(null===(t=e.getMaterial())||void 0===t?void 0:t.getExtendedShaderId())===h};class d{constructor(e,t,i){this.decalId=e,this.bodyComponent=t,this.partStudio=i,this.bodyToInstantiationDetails=new Map,this.bodyToOccurrenceId=new Map,this.occurrenceIdToInstantiatedNodeProperties=new Map,this.relatedClosedCompositeDeterminsticIds=new Set,this.mappingResources=[]}destroy(){this.removeGraphics();for(let e=0;e<this.mappingResources.length;++e)this.mappingResources[e].material.destroy()}clone(e,t){const i=new d(this.decalId,e,t);return i.btDecal=this.btDecal,i}removeOccurrences(){for(const[e,t]of this.bodyToOccurrenceId)for(const i of t)this.removeOccurrence(i,e)}removeGraphics(){this.removeOccurrences(),this.bodyToInstantiationDetails.clear()}addOrUpdateOccurrence(e,t){t=+t;const i=this.bodyComponent.retrieveBodyMetaData(e);if(!i)return;let s;s=i.isClosedComposite?i.constituentBodyIds:[e];let n=!1;for(let i=0;i<s.length;++i){const r=s[i],a=this.bodyToInstantiationDetails.get(r);if(a)for(const[i,s]of a){const i=new o.Style,r=this.viewer.getOccurrenceDataManager().getOccurrenceData(t);for(let e=0;e<s.nodeProperties.length;++e){this.node.addOccurrenceGeometryToNode(s.nodeProperties[e],r,i,s.incrementRanges);let a=this.occurrenceIdToInstantiatedNodeProperties.get(t);a||(a=new Set,this.occurrenceIdToInstantiatedNodeProperties.set(t,a),n=!0),a.add(s.nodeProperties[e])}let a=this.bodyToOccurrenceId.get(e);a||(a=new Set,this.bodyToOccurrenceId.set(e,a)),a.add(t)}}n&&(i.isClosedComposite?this.relatedClosedCompositeDeterminsticIds.add(e):i.isClosedCompositeConstituent&&this.relatedClosedCompositeDeterminsticIds.add(i.closedCompositeParentId))}removeOccurrence(e,t){e=+e;const i=this.bodyToOccurrenceId.get(t);if(i&&i.has(e)){const s=this.occurrenceIdToInstantiatedNodeProperties.get(e);if(s){for(const t of s)this.node.removeOccurrenceFromNode(t,e);this.occurrenceIdToInstantiatedNodeProperties.delete(e)}i.delete(e),0===i.size&&this.bodyToOccurrenceId.delete(t)}}update(e){return(!this.btDecal||!this.btDecal.deepEquals(e))&&(this.btDecal=e,this.updateGraphics(),!0)}debugCoordinateSystem(){for(let e=0;e<this.btDecal.mappings.length;++e){const t=this.btDecal.mappings[e];let i;t instanceof a.BTPlanarImageMapping?i=t.planeSystem:t instanceof a.BTCylindricalImageMapping&&(i=t.cylinderSystem),i&&(0,o.visualizeCoordinateSystem)(this.viewer,this.decalId+"."+e,i)}}onPartStudioChange(e){(this.didReferencedFaceChange(e)||this.didBodyStatusChange(e))&&this.updateGraphics()}updateGraphics(){this.btDecal&&(this.removeGraphics(),this.updateMappingResources(),this.updateIncrementRanges(),this.refreshOccurrences())}refreshOccurrences(){this.bodyComponent.getBodyToOccurrenceId().eachNested(((e,t,i)=>{this.addOrUpdateOccurrence(t,i)}))}doesReferenceEntity(e){for(const t of this.btDecal.mappings)if(t.deterministicIds.indexOf(e)>=0)return!0;return!1}didReferencedFaceChange(e){if(!this.btDecal)return!1;for(const t of this.btDecal.mappings)for(const i of t.deterministicIds)if(e.deterministicIdToEntity.hasOwnProperty(i))return!0;return!1}didBodyStatusChange(e){for(const[e,t]of this.bodyToOccurrenceId){const t=this.bodyComponent.retrieveBodyMetaData(e);if(!t||t.canBeGroupedWithOtherConstituents)return!0}let t=!1;for(const i of this.relatedClosedCompositeDeterminsticIds)e.deterministicPartIdToData[i]&&(this.relatedClosedCompositeDeterminsticIds.delete(i),t=!0);return t}updateMappingResources(){for(let e=0;e<this.btDecal.mappings.length;++e){const t=this.btDecal.mappings[e];let i=this.mappingResources[e];if(!i){const e=new o.Material({diffuseFactor:0,ambientFactor:1,specularColor:[0,0,0]});e.shaderId=h,i={material:e,nodeProperties:null,transparentNodeProperties:null},this.mappingResources.push(i)}if(t instanceof a.BTPlanarImageMapping)i.material.setCustomMatrixUniform(c,t.planeSystem.fromWorld()),i.material.setCustomFloatUniform(l,0);else{if(!(t instanceof a.BTCylindricalImageMapping))return void r.log.debug("Unsupported decal mapping: "+t.getMessageName());i.material.setCustomMatrixUniform(c,t.cylinderSystem.getGlMatrix()),i.material.setCustomFloatUniform(l,t.radius)}i.material.setCustomMatrixUniform("uUvTransform",t.uvTransform.getGlMatrix());const d=(0,n.updateUriWithWorkspaceId)(this.btDecal.imageSourceId);i.material.setTexture(this.viewer.getResources().getImageTexture(d)),i.nodeProperties=o.SHEET_FACE_NODE_PROPERTIES.cloneAndModify({material:i.material,isPickable:!1,zOffset:s.default.getManager().getNumber("DECALS_Z_OFFSET")}),i.transparentNodeProperties=o.SHEET_FACE_NODE_PROPERTIES_TRANSPARENT.cloneAndModify({material:i.material,isPickable:!1,zOffset:s.default.getManager().getNumber("DECALS_Z_OFFSET")})}}updateIncrementRanges(){for(let e=0;e<this.btDecal.mappings.length;++e){const t=this.btDecal.mappings[e];if(0===t.deterministicIds.length)continue;const i=this.mappingResources[e];if(i)for(const s of t.deterministicIds){const t=this.bodyComponent.getEntityMetaData(s);if(!t)continue;const n=t.getBodyId();if(!this.bodyComponent.isBodyLoaded(n))continue;const a=this.getIncrementMeshDetails(s);if(!a){r.log.debug("Did not find increment details for "+s);continue}let c=this.bodyToInstantiationDetails.get(n);c||(c=new Map,this.bodyToInstantiationDetails.set(n,c));let l=c.get(e);l||(l={incrementRanges:new o.IncrementRanges("Decal-"+this.decalId+"-Mapping-"+e+"-Body-"+n),nodeProperties:[i.nodeProperties,i.transparentNodeProperties]},c.set(e,l)),l.incrementRanges.onIncrementAdded(a)}else r.log.warn("Did not have image mapping resources for decal mapping "+e)}}getIncrementMeshDetails(e){const t=this.partStudio.getMeshManager().getIncrementDetails(e,this.partStudio.getMeshOwnerId());if(t)return t;const i=this.partStudio.getSharedBaseMeshManager();return i?i.getIncrementDetails(e,this.partStudio.getMeshOwnerId()):null}get node(){return this.partStudio.getModelViewManager().getSharedBodyNode()}get viewer(){return this.partStudio.viewer}}t.Decal=d},814692:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DecalComponent=void 0;const s=i(114924);class n{constructor(e,t){this.bodyComponent=e,this.partStudio=t,this.decals=new Map}destroy(){for(const[e,t]of this.decals)t.destroy()}cloneForPreview(e,t){const i=new n(e,t);return this.copyToClone(i),i}copyToClone(e){for(const[t,i]of this.decals){const s=i.clone(e.bodyComponent,e.partStudio);e.decals.set(t,s),s.updateGraphics()}}removeFromScene(){for(const[e,t]of this.decals)t.removeOccurrences()}update(e){if(this.partStudio.viewer.getIsForFlattenedDisplay())return;const t=new Set;for(const i in e.decalIdToDecal){const n=e.decalIdToDecal[i];let r=this.decals.get(i);n.isDeletion?r&&(r.destroy(),this.decals.delete(i)):(r||(r=new s.Decal(i,this.bodyComponent,this.partStudio),this.decals.set(i,r)),r.update(n)&&t.add(i))}for(const[i,s]of this.decals)t.has(i)||s.onPartStudioChange(e)}onBodyLoaded(){for(const[e,t]of this.decals)t.updateGraphics()}addOrUpdateOccurrence(e,t){for(const[i,s]of this.decals)s.addOrUpdateOccurrence(e,t)}removeOccurrence(e,t){for(const[i,s]of this.decals)s.removeOccurrence(e,t)}getDecalIdsAffectingEntity(e){const t=[];for(const[i,s]of this.decals)s.doesReferenceEntity(e)&&t.push(i);return t}}t.DecalComponent=n},954325:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GenerativeDesignManager=void 0;const s=i(545348),n=i(955516),r=i(912057),a=i(606544),o=i(461989),c=i(14715),l=i(223456),h=i(683067),d=i(114924),u=i(997687),g=i(35308),p=new d.NodeProperties({material:new d.Material,zOffset:s.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:d.PrimitiveType.TRIANGLES,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1,primitivesHaveTransparency:!0});p.material.setCustomFloatUniform("uOcclusionFactor",0);const m=p.cloneAndModify({primitivesHaveTransparency:!1});class E{constructor(e){this.modelViewManager=e,this.meshOwnerId=(0,d.getNewOwnerId)(),this.runningMultiPart=null,this.previewCache=new Map,this.getViewer().getEventDispatcher().on(h.DISPLAYED_ASSEMBLY,(()=>this.onAssemblyDisplayed()))}onChangeActiveElement(){this.clearGraphics()}getCachedResponseForElementId(e){return this.previewCache.get(e)}cacheResponse(e){if(!e.hasResults()){const t=this.getCachedResponseForElementId(e.elementId);(null==t?void 0:t.hasResults())&&(e.generativeFeatureIdToResult=t.generativeFeatureIdToResult)}this.previewCache.set(e.elementId,e)}resetCache(e){const t=new a.BTGenerativeDesignResponse;t.completionPercentage=0,this.previewCache.set(e,t)}restorePreviewForActiveElement(){const e=this.getCachedResponseForElementId(this.getViewer().getActiveElementId());e&&this.displayGenerativeResponse(e)}onAssemblyDisplayed(){this.restorePreviewForActiveElement()}getViewer(){return this.modelViewManager.getViewer()}runGenerative(e){if(0===e.size)return u.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("There are no generative features."),"warning"),void u.btInjector.AngularEventService.ensureDigest();this.generativeRunStart=new Date;const t=new a.BTUiStartGenerative;t.generativeFeatureIds=[...e],t.elementId=this.getViewer().getActiveElementId(),t.editDescription="Starting generative run",this.runningMultiPart=t.generativeFeatureIds.length>1,this.updateGraphics(),this.resetCache(t.elementId),this.updateBeeper(0),n.BTMessageConnection.getConnection(n.MainConnectionName).send(t)}updateGraphics(){this.clearGraphics()}displayGenerativeResponse(e){var t;if(Object.values(e.generativeFeatureIdToResult).length>0&&this.drawPreview(e),e.isRunComplete)return null===(t=this.beeper)||void 0===t||t.stopBeeper(),void(this.beeper=null);this.updateBeeper(e.completionPercentage)}onFgsErrorInfo(e){this.clearGraphics();const t=i18n("Generative returned an error: __errorText__",{errorText:e.errorText});u.btInjector.MessageBubbleService.showMessageWithAutoDismiss(t,"warning"),u.btInjector.AngularEventService.ensureDigest(),r.log.warn(t),this.generativeRunStart&&(r.log.debug(`generative.onFgsErrorInfo: Generative run finished exceptionally. Client-side timing information: ${g.BTOperationTimeLog.withStartTime(this.generativeRunStart)}`),this.generativeRunStart=null)}onGenerativeResponse(e){this.getViewer().getActiveElementId()===e.elementId&&this.displayGenerativeResponse(e),this.cacheResponse(e),e.isRunComplete&&this.generativeRunStart&&(r.log.debug(`generative.onGenerativeResponse: Generative run completed. Client-side timing information: ${g.BTOperationTimeLog.withStartTime(this.generativeRunStart)}`),this.generativeRunStart=null)}updateBeeper(e){let t;if(e){const i=(0,l.roundTo)(e,2);t=this.runningMultiPart?i18n("Generating designs (__roundedPercentage__%)",{roundedPercentage:i}):i18n("Generating design (__roundedPercentage__%)",{roundedPercentage:i})}else t=this.runningMultiPart?i18n("Generating designs"):i18n("Generating design");if(this.beeper)this.beeper.setExplanation(t);else{const e=new c.TaskFeedbackOptions("generativeDesign").setImportant(t);this.beeper=(0,o.TaskBeeperManagerGetSingleton)().startTaskBeeper(this.getViewer().getActiveElementId(),e)}}resetMeshes(){var e;null===(e=this.meshManager)||void 0===e||e.destroy(),this.meshManager=new d.MeshManager(this.getViewer(),{bufferAllocationPolicy:d.BufferAllocationPolicy.MAXIMUM})}clearGraphics(){var e;this.resetScenegraphNode(),this.resetMeshes(),null===(e=this.beeper)||void 0===e||e.stopBeeper(),this.beeper=null,this.getViewer().requestDraw()}resetScenegraphNode(){var e;null===(e=this.previewNode)||void 0===e||e.remove(),this.previewNode=new d.Node(E.PREVIEW_NODE_ID,p),this.previewNode.setVisible(!1),this.modelViewManager.getSharedBodyNode().addChild(this.previewNode)}drawPreview(e){const t=this.getViewer().getOccurrenceIdManager(),i=this.getViewer().getOccurrenceDataManager(),s=this.modelViewManager.getDisplayedAssembly();if(s&&s.elementId===e.elementId){for(const n of Object.values(e.generativeFeatureIdToResult)){const a=n.preview.sampleMesh,o=new d.MeshIncrement(d.PrimitiveType.TRIANGLES,a.points,a.getAnyIndices());(0,d.addTriangleNormals)(o),o.replicateTextureCoordinate([0,0]);for(const a of n.relatedOccurrences){this.modelViewManager.setOccurrenceAlphaModifier(a,h.PART_INSTANCE_ALPHA);const n=a.getPathAsString(),c=t.getIdForName(n);if(c===d.INVALID_OCCURRENCE_ID){r.log.warn("No occurrence id for "+n);continue}const l=i.getOccurrenceData(c);l||r.log.warn("No occurrence data for "+n);const u=s.getOccurrenceDisplayData(a);if(!u){r.log.warn("No occurrence display data for "+n);continue}const g=this.modelViewManager.getPartStudioDataFromOccurrence(a);if(!g){r.log.debug("No part studio for occurrence "+n);continue}o.id=n;const E=this.meshManager.addMeshIncrement(o,this.meshOwnerId),I=new d.IncrementRanges("Generated "+n);I.onIncrementAdded(E);const T=g.retrieveBodyMetaData(u.partIds[0]),S=new d.Style;T&&S.setAttribute(d.Attributes.COLOR,T.getColor());const f=e.isRunComplete?m:p;if(this.previewNode.addOccurrenceGeometryToNode(f,l,S,I),this.debugMeshEdges){const e=(0,d.createEdgesFromTriangles)(o,o.id+".edges"),t=this.meshManager.addMeshIncrement(e,this.meshOwnerId),i=new d.IncrementRanges("Generated "+n+" edges");i.onIncrementAdded(t),this.previewNode.addOccurrenceGeometryToNode(d.MESH_EDGE_NODE_PROPERTIES,l,null,i)}}}this.previewNode.setVisible(!0),this.getViewer().requestDraw()}else r.log.debug("Tried to display generative response in the wrong element")}}t.GenerativeDesignManager=E,E.PREVIEW_NODE_ID="GenerativeDesignPreview"},772430:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DirectionalScreenFacingSpaceQuadGlyphComponent=t.ScreenFacingSpaceQuadGlyphComponent=t.ScreenSpaceQuadGlyphComponent=t.GlyphComponent=t.GLYPH_SELECTION_ID=void 0;const s=i(264292),n=i(32620),r=i(873896),a=i(613199),o=i(114924);t.GLYPH_SELECTION_ID="GLYPH";class c extends o.UIElement{constructor(e,t,i,s,n,r,a,o){super(e),this.glyphResources=t,this.textureId=i,this.glyphStateId=s,this.pixelSize=n,this.renderPriority=r,this.worldOrigin=a,this.parent=o}getModelSelection(e){return this.parent?this.parent.getModelSelection(e):null}addHighlight(e){super.addHighlight(e),this.resetGraphics()}removeHighlight(e){return!!super.removeHighlight(e)&&(this.resetGraphics(),!0)}onViewWillDraw(e){this.isHidden||this.hasBeenRemoved||(this.updateGraphics(),this.adjustTransform(e))}setWorldOrigin(e){a.vec3C.distanceSquared(this.worldOrigin,e)>r.Tolerances.ZERO_LENGTH_SQUARED&&(this.worldOrigin=e,this.resetGraphics())}onDevicePixelRatioChanged(e){this.isHidden||this.resetGraphics()}get highlightStateId(){const e=this.getHighlight();return e&&e.type===o.HighlightType.PRE?o.GlyphHighlightStates.PRE_HIGHLIGHT:e?o.GlyphHighlightStates.HIGHLIGHT:o.GlyphHighlightStates.NO_HIGHLIGHT}resetGraphics(){this.removeMeshIncrements(),this.updateGraphics()}updateGraphics(){!this.hasMeshIncrements()&&this.glyphResources.atlasReady&&this.instantiateMeshIncrements()}}t.GlyphComponent=c;t.ScreenSpaceQuadGlyphComponent=class extends c{constructor(e,t,i,s,n,r,a,o,c,l){super(e,t,i,s,n,r,a,l),this.worldXAxis=o,this.worldYAxis=c}instantiateMeshIncrements(){const e=this.glyphResources.getTextureCoordsOffset(this.textureId,this.glyphStateId,this.highlightStateId,0),i="glyphQuad",s=[e.lowS,e.highT],n=[e.highS,e.lowT],r=(0,o.createQuad)([-.5,0,-.5],[.5,0,-.5],[-.5,0,.5],i,s,n),a=this.glyphResources.getNodeProperties(this.highlightStateId,this.glyphStateId,this.renderPriority);this.updateMeshIncrement(i,t.GLYPH_SELECTION_ID,r,a)}adjustTransform(e){const t=e.getPixelSizeAtWorldPoint(this.worldOrigin)*this.pixelSize*(0,n.getDevicePixelRatio)(),i=a.vec3C.scale(this.worldYAxis,t,s.vec3.create()),r=a.vec3C.scale(this.worldXAxis,t,s.vec3.create()),o=a.vec3C.scale(a.vec3C.normalize(a.vec3C.cross(i,r,s.vec3.create())),t),c=s.mat4.fromValues(r[0],r[1],r[2],0,o[0],o[1],o[2],0,i[0],i[1],i[2],0,this.worldOrigin[0],this.worldOrigin[1],this.worldOrigin[2],1);this.setTransform(c)}};class l extends c{constructor(e,t,i,s,n,r,a,o,c){super(e,t,i,s,n,r,a,c),this.originInGlyph=o}instantiateMeshIncrements(){const e=this.glyphResources.getTextureCoordsOffset(this.textureId,this.glyphStateId,this.highlightStateId,0),i=[-this.originInGlyph[0],0,-this.originInGlyph[1]],s=[1-this.originInGlyph[0],0,-this.originInGlyph[1]],n=[-this.originInGlyph[0],0,1-this.originInGlyph[1]],r="quad",a=[e.lowS,e.highT],c=[e.highS,e.lowT],l=(0,o.createQuad)(i,s,n,r,a,c);this.updateMeshIncrement(r,t.GLYPH_SELECTION_ID,l,this.glyphResources.getNodeProperties(this.highlightStateId,this.glyphStateId,this.renderPriority))}adjustTransformToAlignUp(e,t){const i=e.getPixelSizeAtWorldPoint(this.worldOrigin)*this.pixelSize*(0,n.getDevicePixelRatio)(),r=a.vec3C.scale(t,i,s.vec3.create()),o=a.vec3C.scale(a.vec3C.normalize(a.vec3C.cross(e.getForward(),r,s.vec3.create())),i),c=a.vec3C.scale(a.vec3C.normalize(a.vec3C.cross(r,o,s.vec3.create())),i),l=s.mat4.fromValues(o[0],o[1],o[2],0,c[0],c[1],c[2],0,r[0],r[1],r[2],0,this.worldOrigin[0],this.worldOrigin[1],this.worldOrigin[2],1);this.setTransform(l)}adjustTransform(e){this.adjustTransformToAlignUp(e,e.getUp())}}t.ScreenFacingSpaceQuadGlyphComponent=l;t.DirectionalScreenFacingSpaceQuadGlyphComponent=class extends l{constructor(e,t,i,s,n,r,a,o,c,l){super(e,t,i,s,n,r,a,c,l),this.worldDirection=o}adjustTransform(e){this.adjustTransformToAlignUp(e,this.worldDirection)}}},388129:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GlyphResources=t.GlyphHighlightStates=t.GlyphStateTextureSuffixes=t.GlyphStates=void 0;const s=i(869363),n=i(545348),r=i(912057),a=i(32620),o=i(550122),c=i(315931),l=i(921131),h=i(837454),d=i(431008);var u,g;!function(e){e.NORMAL="NORMAL",e.ERROR="ERROR",e.SUPPRESSED="SUPPRESSED"}(u||(t.GlyphStates=u={})),t.GlyphStateTextureSuffixes={NORMAL:"",ERROR:"_Error",SUPPRESSED:"_Suppressed"},function(e){e.NO_HIGHLIGHT="NO_HIGHLIGHT",e.PRE_HIGHLIGHT="PRE_HIGHLIGHT",e.HIGHLIGHT="HIGHLIGHT"}(g||(t.GlyphHighlightStates=g={}));const p={NO_HIGHLIGHT_NORMAL:8,NO_HIGHLIGHT_SUPPRESSED:7,NO_HIGHLIGHT_ERROR:6,HIGHLIGHT_NORMAL:5,HIGHLIGHT_SUPPRESSED:4,HIGHLIGHT_ERROR:3,PRE_HIGHLIGHT_NORMAL:2,PRE_HIGHLIGHT_SUPPRESSED:1,PRE_HIGHLIGHT_ERROR:0};t.GlyphResources=class{constructor(e,t,i,s,n,r,a){this.atlasId=e,this.viewer=t,this.textures=i,this.pixelSize_=s,this.textureResolutionScales=n,this.textureAtlasOptions=r,this.isDarkModeThemed=a,this.material=(0,l.createTextureMaterial)(),this.nodeProperties={},this.initializeTextureAtlas(),this.initializeNodeProperties()}onDevicePixelRatioChanged(){this.textureResolutionScales&&this.getTextureResolutionScale(this.lastUsedDevicePixelRatio)!==this.getTextureResolutionScale((0,a.getDevicePixelRatio)())&&this.reinitialize()}reinitialize(){this.viewer.getTextureAtlasFactory().clearAtlas(this.atlasId),this.textureAtlas&&(this.textureAtlas.destroy(),this.textureAtlas=null),this.material.ambientTexture=null,this.initializeTextureAtlas(),this.initializeNodeProperties()}destroy(){this.material&&(this.material.destroy(),this.material=null)}get pixelSize(){return this.pixelSize_}get atlasReady(){return!!this.textureAtlas}getNodeProperties(e,t,i){return this.nodeProperties[this.getNodePropertyKey(e,t,i)]}getTextureCoordsOffset(e,t,i,s){return this.textureAtlas.getTextureCoordsOffset(this.getAtlasKey(e,t,i),s)}initializeNodeProperties(){for(const e in g)for(const t in u)for(let i=h.RenderOrderPriority.LOWER;i<=h.RenderOrderPriority.DEFAULT;++i){const s=this.getNodePropertyKey(e,t,i),n=this.getZOffsetKey(e,t);this.nodeProperties[s]=new h.NodeProperties({primitiveType:c.PrimitiveType.TRIANGLES,isShowThrough:!0,isDepthTested:!0,isTwoSided:!0,priority:i,primitivesHaveTransparency:!0,material:this.material,zOffset:p[n]})}}initializeTextureAtlas(){this.viewer.getTextureAtlasFactory().getAtlas(this.atlasId,(()=>{const e=[];for(const t in this.textures)for(const i in u)for(const s in g)e.push(this.createAtlasItem(t,i,s));const t=this.textureAtlasOptions?this.textureAtlasOptions:{};t.sourcesHaveTransparency=!0;let i=this.pixelSize;const s=this.getTextureResolutionScale((0,a.getDevicePixelRatio)());return s&&(i*=s),(0,d.createAtlasFromResources)(this.viewer,i,e,t)})).then((e=>{this.textureAtlas=e,this.material.ambientTexture=e.texture,this.viewer.requestDraw()})).catch((e=>{r.log.error(e)}))}getNodePropertyKey(e,t,i){return e+"_"+t+"_"+i}getZOffsetKey(e,t){return e+"_"+t}getAtlasKey(e,t,i){return e+o.ID_SEPARATOR+t+o.ID_SEPARATOR+i}getAtlasBackgroundColor(e,t){return n.default.getManager().getColorString("GLYPH_"+e+"_"+t+"_BACKGROUND")}getAtlasTextureName(e,i,s){return this.textures[e]+t.GlyphStateTextureSuffixes[i]+this.getSystemStateSuffix()+".png"}getTextureResolutionScale(e){let t=null;if(!this.textureResolutionScales)return t;for(let i=0;i<this.textureResolutionScales.length&&(t=this.textureResolutionScales[i],!(t>=e));++i);return t}getSystemStateSuffix(){let e="";if(this.isDarkModeThemed&&(e+="_"+s.ThemeTokens.getCurrentTheme()),this.textureResolutionScales){const t=(0,a.getDevicePixelRatio)(),i=this.getTextureResolutionScale(t);this.lastUsedDevicePixelRatio=t,e+="_"+i+"x"}return e}createAtlasItem(e,t,i){const s=new d.ImageData;return s.id=this.getAtlasKey(e,t,i),s.imageName=this.getAtlasTextureName(e,t,i),s.backgroundColor=this.getAtlasBackgroundColor(t,i),s}}},136675:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ScalarVisualizationLegend=void 0;const s=i(545348),n=i(825853),r=i(606544),a=i(853933),o=i(972968),c=i(573879),l=i(32620),h=i(873896),d=i(114924),u=i(322012),g=i(402198),p=new d.NodeProperties({primitiveType:d.PrimitiveType.LINES,isPickable:!1}),m=new d.NodeProperties({primitiveType:d.PrimitiveType.LINES,isVisible:!1}),E=new d.NodeProperties({primitiveType:d.PrimitiveType.TRIANGLES,isPickable:!1,material:d.UNLIT_COLOR_FROM_ATTRIBUTE,primitivesHaveTransparency:!1}),I=new d.NodeProperties({primitiveType:d.PrimitiveType.TRIANGLES,isVisible:!1}),T="legend",S="legendMinTick",f="legendMaxTick",C="legendColorMap",P="legendAboveMax",v="legendBelowMin",D="legendBackground",M="legendDragRegion",y=.1,O=.3,_=.4,A=d.Cursor.GRAB,R=d.Cursor.CROSSHAIR,N=d.Cursor.GRABBING,w=d.Cursor.POINTER,b=d.Cursor.EW_RESIZE,L=d.Cursor.NS_RESIZE;class B extends d.UIElement{get SNAPPING_MARGIN_TOP(){return 0}constructor(e){super(e.getViewer(),d.HUD_SCENEGRAPH_ID),this.manager=e,this.supportsInContextMode=!1,this.valueTextElements=[],this.textCache=[],this.isVertical=!0,this.isDamaged=!1,this.colorMapDimensions={width:0,height:0},this.colorMapPadding={left:0,right:0,top:0,bottom:0},this.userHasMovedLegend=!1,this.legendMovedSubject=new u.Subject,this.legendDragPoint=new r.BTVector2d,this.isBeingDragged=!1,this.tickBeingDragged=null,this.removeSubject=new u.Subject,this.colorMapMaterial=(0,d.createTextureMaterial)(),this.colorMapNodeProperties=new d.NodeProperties({primitiveType:d.PrimitiveType.TRIANGLES,material:this.colorMapMaterial}),this.setActiveColorMapping(a.DEFAULT_SCALAR_VISUALIZATION_COLOR_MAPPING),this.listenTo(this,d.UiEvents.MOUSE_ENTER+T,this.onMouseEnterLegend),this.listenTo(this,d.UiEvents.MOUSE_ENTER+C,this.onMouseEnterColorMap),this.listenTo(this,d.UiEvents.DRAG_START+T,this.onDragStartLegend),this.listenTo(this,d.UiEvents.DRAG+T,this.onDragLegend),this.listenTo(this,d.UiEvents.DRAG_STOP+T,this.onDragStopLegend),this.listenTo(this,d.UiEvents.DRAG_START+C,this.onDragStartLegend),this.listenTo(this,d.UiEvents.DRAG+C,this.onDragLegend),this.listenTo(this,d.UiEvents.DRAG_STOP+C,this.onDragStopLegend),this.listenTo(this,d.UiEvents.MOUSE_LEAVE+C,(()=>this.onMouseLeavePopCursor(R))),this.listenTo(this,d.UiEvents.MOUSE_LEAVE+T,(()=>this.onMouseLeavePopCursor(A))),this.listenTo(this,d.UiEvents.MOUSE_ENTER+f,this.onMouseEnterTick),this.listenTo(this,d.UiEvents.DRAG_START+f,this.onDragStartTickMax),this.listenTo(this,d.UiEvents.DRAG+f,this.onDragTickMax),this.listenTo(this,d.UiEvents.DRAG_STOP+f,this.onDragStopTick),this.listenTo(this,d.UiEvents.MOUSE_LEAVE+f,this.onMouseLeaveTick),this.listenTo(this,d.UiEvents.MOUSE_ENTER+S,this.onMouseEnterTick),this.listenTo(this,d.UiEvents.DRAG_START+S,this.onDragStartTickMin),this.listenTo(this,d.UiEvents.DRAG+S,this.onDragTickMin),this.listenTo(this,d.UiEvents.DRAG_STOP+S,this.onDragStopTick),this.listenTo(this,d.UiEvents.MOUSE_LEAVE+S,this.onMouseLeaveTick),this.supportsInContextMode&&(0,g.getPanelLayoutManager)().getPanelOpenCloseObservable().pipe((0,u.takeUntil)(this.getRemoveObservable())).subscribe((e=>this.panelWasAdded(e))),this.changeLegendOrientation(),this.updateConstants()}updateConstants(){const e=s.default.getManager(),t=e.getNumber("LEGEND_TICK_TEXT_UNDERLINE_WIDTH_PX");this.backgroundColor=e.getColor("LEGEND_BACKGROUND_COLOR"),this.defaultFontOptions={color:e.getColor("LEGEND_TICK_TEXT_COLOR"),size:e.getNumber("LEGEND_TICK_TEXT_HEIGHT_PX"),font:e.getString("LEGEND_TICK_TEXT_FONT")},this.clickableFontOptions={color:e.getColor("LEGEND_TICK_CLICKABLE_TEXT_COLOR"),size:e.getNumber("LEGEND_TICK_TEXT_HEIGHT_PX"),font:e.getString("LEGEND_TICK_TEXT_FONT"),underlineWidth:t},this.hoverFontOptions={color:e.getColor("LEGEND_TICK_TEXT_COLOR"),size:e.getNumber("LEGEND_TICK_TEXT_HEIGHT_PX"),font:e.getString("LEGEND_TICK_TEXT_FONT"),fontWeight:e.getString("LEGEND_TICK_TEXT_HOVER_WEIGHT"),underlineWidth:t}}panelWasAdded(e){var t,i;if((null==e?void 0:e.panelId)!==this.CANVAS_CONTROLS_PANEL_ID||this.userHasMovedLegend)return;const s=this.colorMapCorners;this.colorMapCorners=this.calculateInitialLegendPosition(),(null==s?void 0:s.bottomLeft.equals(null===(t=this.colorMapCorners)||void 0===t?void 0:t.bottomLeft))&&(null==s?void 0:s.topRight.equals(null===(i=this.colorMapCorners)||void 0===i?void 0:i.topRight))||this.updateGraphics()}setIsVertical(e){this.isVertical!==e&&this.changeLegendOrientation()}getIsVertical(){return this.isVertical}areCoordinatesOverLegend(e){return!!this.colorMapCorners&&(this.colorMapCorners.bottomLeft.x<e.x&&e.x<this.colorMapCorners.topRight.x&&this.colorMapCorners.bottomLeft.y<e.y&&e.y<this.colorMapCorners.topRight.y)}onMouseLeavePopCursor(e){this.viewer.removeTopOccurrenceOfCursor(e)}onMouseLeaveTick(){const e=this.isVertical?L:b;this.onMouseLeavePopCursor(e)}onMouseEnterLegend(){this.viewer.pushCursor(A)}onMouseEnterColorMap(){this.viewer.pushCursor(R)}onDragStartLegend(e,t,i){this.viewer.pushCursor(N),i.requestDrag=!0,this.legendDragPoint.updateFromArray([t.mouseX,t.mouseY]),this.userHasMovedLegend=!0}onMouseEnterTick(){this.isVertical?this.viewer.pushCursor(L):this.viewer.pushCursor(b)}get isTickBeingDragged(){return null!==this.tickBeingDragged}onDragStartTick(e,t,i){this.isBeingDragged=!0,i.requestDrag=!0,this.currentScaleRange=this.visualizedScalarRange.clone()}onDragStartTickMax(e,t,i){return this.tickBeingDragged=o.RangeComponent.MAX,this.onDragStartTick(e,t,i)}onDragStartTickMin(e,t,i){return this.tickBeingDragged=o.RangeComponent.MIN,this.onDragStartTick(e,t,i)}onDragStopTick(){this.isBeingDragged=!1,this.tickBeingDragged=null,this.currentScaleRange=this.visualizedScalarRange.clone(),this.isDamaged=!0}onDragLegend(e,t){const i=r.BTVector2d.fromArray([this.legendDragPoint.x-t.mouseX,t.mouseY-this.legendDragPoint.y]);this.moveLegend(i)}onDragStopLegend(){this.viewer.removeTopOccurrenceOfCursor(N),this.isBeingDragged=!1,this.legendDragPoint=new r.BTVector2d}onDragTickMin(e,t){const{topRight:i}=this.getViewportCoordinates();let s=this.getClampedValueFromCoordinatesInRange(r.BTVector2d.fromArray([t.mouseX,i.y-t.mouseY]),this.currentScaleRange);this.isInverted?s<this.visualizedScalarRange.max+h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE&&(s=Math.min(this.visualizedScalarRange.max+h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE,this.visualizedScalarRange.min)):s>this.visualizedScalarRange.max-h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE&&(s=Math.max(this.visualizedScalarRange.max-h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE,this.visualizedScalarRange.min)),s!==this.visualizedScalarRange.min&&this.viewer.getEventDispatcher().trigger(this.LEGEND_RANGE_CHANGED,s,o.RangeComponent.MIN)}onDragTickMax(e,t){const{topRight:i}=this.getViewportCoordinates();let s=this.getClampedValueFromCoordinatesInRange(r.BTVector2d.fromArray([t.mouseX,i.y-t.mouseY]),this.currentScaleRange);this.isInverted?s>this.visualizedScalarRange.min-h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE&&(s=Math.max(this.visualizedScalarRange.min-h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE,this.visualizedScalarRange.max)):s<this.visualizedScalarRange.min+h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE&&(s=Math.min(this.visualizedScalarRange.min+h.Tolerances.MIN_LEGEND_MIN_MAX_DIFFERENCE,this.visualizedScalarRange.max)),s!==this.visualizedScalarRange.max&&this.viewer.getEventDispatcher().trigger(this.LEGEND_RANGE_CHANGED,s,o.RangeComponent.MAX)}getValueFromCoordinatesInRange(e,t){const i=this.isVertical?e.y:e.x,s=this.calculateLongSideCoordinate(t.max,this.currentScaleRange),n=this.calculateLongSideCoordinate(t.min,this.currentScaleRange);return(i-n)/(s-n)*t.magnitude+t.min}getValueFromCoordinatesInVisualizedRange(e){const t=this.isVertical?e.y:e.x,i=this.calculateLongSideCoordinate(this.visualizedScalarRange.max,this.currentScaleRange),s=this.calculateLongSideCoordinate(this.visualizedScalarRange.min,this.currentScaleRange);return(t-s)/(i-s)*this.visualizedScalarRange.magnitude+this.visualizedScalarRange.min}getClampedValueFromCoordinatesInRange(e,t){const i=this.getValueFromCoordinatesInRange(e,t);return i>t.highValue?t.highValue:i<t.lowValue?t.lowValue:i}getViewportCoordinates(){const e=this.viewer.getCamera().getViewport(!0).slice();return this.lastRenderedViewport||(this.lastRenderedViewport=e.slice()),this.getCornerCoordinatesFromViewportVector(e)}getCornerCoordinatesFromViewportVector(e){return{bottomLeft:r.BTVector2d.fromXY(e[0],e[1]),topRight:r.BTVector2d.fromXY(e[0]+e[2],e[1]+e[3])}}changeLegendOrientation(e){this.isVertical=!this.isVertical;const t=s.default.getManager();this.isVertical?(this.colorMapDimensions.width=t.getNumber("LEGEND_COLOR_MAP_VERTICAL_WIDTH_PX"),this.colorMapDimensions.height=t.getNumber("LEGEND_COLOR_MAP_VERTICAL_HEIGHT_PX"),this.colorMapPadding.left=t.getNumber("LEGEND_VERTICAL_LEFT_MARGIN_PX"),this.colorMapPadding.bottom=t.getNumber("LEGEND_VERTICAL_BOTTOM_MARGIN_PX"),this.colorMapPadding.right=t.getNumber("LEGEND_VERTICAL_RIGHT_MARGIN_PX"),this.colorMapPadding.top=t.getNumber("LEGEND_VERTICAL_TOP_MARGIN_PX")):(this.colorMapDimensions.width=t.getNumber("LEGEND_COLOR_MAP_HORIZONTAL_WIDTH_PX"),this.colorMapDimensions.height=t.getNumber("LEGEND_COLOR_MAP_HORIZONTAL_HEIGHT_PX"),this.colorMapPadding.left=t.getNumber("LEGEND_HORIZONTAL_LEFT_MARGIN_PX"),this.colorMapPadding.bottom=t.getNumber("LEGEND_HORIZONTAL_BOTTOM_MARGIN_PX"),this.colorMapPadding.right=t.getNumber("LEGEND_HORIZONTAL_RIGHT_MARGIN_PX"),this.colorMapPadding.top=t.getNumber("LEGEND_HORIZONTAL_TOP_MARGIN_PX")),this.colorMapCorners&&(this.colorMapCorners.bottomLeft.x=this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.height/2-this.colorMapDimensions.width/2,this.colorMapCorners.bottomLeft.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.width/2-this.colorMapDimensions.height/2,this.colorMapCorners.topRight.x=this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width,this.colorMapCorners.topRight.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height),e&&(this.colorMapCorners.bottomLeft.x-this.colorMapPadding.left<e.left?(this.colorMapCorners.bottomLeft.x=e.left+this.colorMapPadding.left,this.colorMapCorners.topRight.x=this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width):this.colorMapCorners.topRight.x+this.colorMapPadding.right>e.right&&(this.colorMapCorners.topRight.x=e.right-this.colorMapPadding.right,this.colorMapCorners.bottomLeft.x=this.colorMapCorners.topRight.x-this.colorMapDimensions.width),this.colorMapCorners.bottomLeft.y-this.colorMapPadding.bottom<e.bottom?(this.colorMapCorners.bottomLeft.y=e.bottom+this.colorMapPadding.bottom,this.colorMapCorners.topRight.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height):this.colorMapCorners.topRight.y+this.colorMapPadding.top>e.top&&(this.colorMapCorners.topRight.y=e.top-this.colorMapPadding.top,this.colorMapCorners.bottomLeft.y=this.colorMapCorners.topRight.y-this.colorMapDimensions.height))}onDevicePixelRatioChanged(e){if(this.isHidden)return void this.changeLegendOrientation();const t=(0,l.getDevicePixelRatio)();if(!this.lastUsedDevicePixelRatio||t===this.lastUsedDevicePixelRatio)return;const i=this.lastRenderedViewport,s=e.getViewport(!0).slice(),n=t/this.lastUsedDevicePixelRatio;if(this.colorMapPadding.left*=n,this.colorMapPadding.top*=n,this.colorMapPadding.right*=n,this.colorMapPadding.bottom*=n,this.colorMapDimensions.width*=n,this.colorMapDimensions.height*=n,this.isVertical){const e=(.5*i[3]-this.colorMapCorners.bottomLeft.y)*n;this.colorMapCorners.bottomLeft.y=.5*s[3]-e;if(this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width/2>=i[2]/2){const e=(i[2]-this.colorMapCorners.bottomLeft.x)*n;this.colorMapCorners.bottomLeft.x=s[2]-e}else this.colorMapCorners.bottomLeft.x*=n}else{const e=(.5*i[2]-this.colorMapCorners.bottomLeft.x)*n;this.colorMapCorners.bottomLeft.x=.5*s[2]-e;if(this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height/2>=i[3]/2){const e=(i[3]-this.colorMapCorners.bottomLeft.y)*n;this.colorMapCorners.bottomLeft.y=s[3]-e}else this.colorMapCorners.bottomLeft.y*=n}this.colorMapCorners.topRight.x=this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width,this.colorMapCorners.topRight.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height,this.lastRenderedViewport=s,this.updateGraphics()}onAppearanceConstantsUpdated(){this.updateConstants(),this.updateGraphics()}onResize(e,t){const i=t[2]-e[2],s=t[3]-e[3];if(0===i&&0===s)return;const n=this.getCornerCoordinatesFromViewportVector(e),{shouldSnapTo:a}=this.getShouldSnapTo(n),o=this.getCornerCoordinatesFromViewportVector(t);let c=0,l=0;if(this.isVertical)if(l=s/2,a.left())this.snapToLeft(o);else{this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width/2>=e[2]/2&&(c=i)}else if(c=i/2,a.top())this.snapToTop(o);else{this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height/2>=e[3]/2&&(l=s)}this.moveLegend(r.BTVector2d.fromXY(-c,-l),o,!0)}moveLegend(e,t=this.getViewportCoordinates(),i=!1){const{shouldSnapTo:s,snappableBounds:n}=this.getShouldSnapTo(t,e);let r=!1;s.top()?(!this.isVertical||i||r||this.changeLegendOrientation(n),this.snapToTop(t),r=!0):s.bottom()?(!this.isVertical||i||r||this.changeLegendOrientation(n),this.snapToBottom(t),r=!0):(this.colorMapCorners.bottomLeft.y-=e.y,this.colorMapCorners.topRight.y-=e.y,this.isBeingDragged&&(this.legendDragPoint.y=this.legendDragPoint.y+e.y)),s.left()?(this.isVertical||i||r||this.changeLegendOrientation(n),this.snapToLeft(t),r=!0):s.right()?(this.isVertical||i||r||this.changeLegendOrientation(n),this.snapToRight(t),r=!0):(this.colorMapCorners.topRight.x-=e.x,this.colorMapCorners.bottomLeft.x-=e.x,this.isBeingDragged&&(this.legendDragPoint.x=this.legendDragPoint.x-e.x)),(0,d.isInFollowMode)()&&(this.userHasMovedLegend=!0),this.legendMovedSubject.next(),this.isDamaged=!0}getLegendMovedObservable(){return this.legendMovedSubject.asObservable()}getShouldSnapTo(e,t=new r.BTVector2d){const i=s.default.getManager(),n=i.getNumber("LEGEND_SIDE_SNAP_DEADZONE_PX"),a=i.getNumber("LEGEND_SIDE_SNAP_THRESHOLD_PX"),o=i.getNumber("LEGEND_VERTICAL_SNAP_THRESHOLD_PX"),c={right:e.topRight.x-n-a,left:e.bottomLeft.x+n+a,top:e.topRight.y-this.SNAPPING_MARGIN_TOP-o,bottom:e.bottomLeft.y+o};return{shouldSnapTo:{right:()=>this.colorMapCorners.topRight.x-t.x+this.colorMapPadding.right>c.right,left:()=>this.colorMapCorners.bottomLeft.x-t.x-this.colorMapPadding.left<c.left,top:()=>this.colorMapCorners.topRight.y-t.y+this.colorMapPadding.top>c.top,bottom:()=>this.colorMapCorners.bottomLeft.y-t.y-this.colorMapPadding.bottom<c.bottom},snappableBounds:c}}snapToTop(e){this.colorMapCorners.topRight.y=e.topRight.y-this.colorMapPadding.top-this.SNAPPING_MARGIN_TOP,this.colorMapCorners.bottomLeft.y=this.colorMapCorners.topRight.y-this.colorMapDimensions.height}snapToBottom(e){this.colorMapCorners.bottomLeft.y=e.bottomLeft.y+this.colorMapPadding.bottom,this.colorMapCorners.topRight.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height}snapToRight(e){const t=s.default.getManager().getNumber("LEGEND_SIDE_SNAP_DEADZONE_PX");this.colorMapCorners.topRight.x=e.topRight.x-this.colorMapPadding.right-t,this.colorMapCorners.bottomLeft.x=this.colorMapCorners.topRight.x-this.colorMapDimensions.width}snapToLeft(e){const t=s.default.getManager().getNumber("LEGEND_SIDE_SNAP_DEADZONE_PX");this.colorMapCorners.bottomLeft.x=e.bottomLeft.x+this.colorMapPadding.left+t,this.colorMapCorners.topRight.x=this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width}remove(){super.remove(),this.colorMapMaterial.destroy(),this.clearText(),this.removeSubject.next()}getRemoveObservable(){return this.removeSubject.asObservable()}setActiveColorMapping(e){this.colorMapMaterial.ambientTexture=this.viewer.getResources().scalarVisualizationTextures.get(e)}setInputRange(e){this.rangeInData=e.rangeInData,e.defaultDisplayRange?this.defaultDisplayRange=e.defaultDisplayRange:this.defaultDisplayRange=e.rangeInData,this.visualizedScalarRange||this.setVisualizedScalarRange(this.defaultDisplayRange)}setVisualizedScalarRange(e){this.visualizedScalarRange=e,!this.isTickBeingDragged&&e&&(this.currentScaleRange=e.clone()),this.isDamaged=!0}clearRanges(){this.rangeInData=null,this.visualizedScalarRange=null,this.isDamaged=!0}hide(){this.clearText(),this.isDamaged=!0,super.hide()}onViewWillDraw(e){if(this.isHidden)return;const t=e.getViewport(!0);this.lastRenderedViewport?(0,c.arraysEqual)(this.lastRenderedViewport,t)||(this.onResize(this.lastRenderedViewport,t),this.lastRenderedViewport=t.slice()):(this.lastRenderedViewport=t.slice(),this.isDamaged=!0),this.isDamaged&&this.updateGraphics()}getInputRangeInDisplayUnits(){if(this.rangeInData){const e=(0,n.convertRangeToDisplayUnitsForField)(this.rangeInData,this.visualizedFieldType);return this.isInverted&&!e.isInverted?e.cloneInverted():e}return null}getDefaultDisplayRangeInDisplayUnits(){return this.defaultDisplayRange?(0,n.convertRangeToDisplayUnitsForField)(this.defaultDisplayRange,this.visualizedFieldType):null}calculateInitialLegendPosition(){const{topRight:e}=this.getViewportCoordinates(),t=r.BTVector2d.fromArray([(e.x-this.colorMapPadding.right-this.colorMapDimensions.width+this.colorMapPadding.left)/2,e.y-this.SNAPPING_MARGIN_TOP-this.colorMapDimensions.height-this.colorMapPadding.top]);return{bottomLeft:t,topRight:r.BTVector2d.fromArray([t.x+this.colorMapDimensions.width,t.y+this.colorMapDimensions.height])}}createRectangleUsingLegendBounds(e,t){const i=s.default.getManager().getNumber("LEGEND_BACKGROUND_CORNER_RADIUS_PX");return(0,d.createRoundedRectangle)([this.colorMapCorners.bottomLeft.x-this.colorMapPadding.left,this.colorMapCorners.bottomLeft.y-this.colorMapPadding.bottom,t],[this.colorMapCorners.topRight.x+this.colorMapPadding.right,this.colorMapCorners.bottomLeft.y-this.colorMapPadding.bottom,t],[this.colorMapCorners.bottomLeft.x-this.colorMapPadding.left,this.colorMapCorners.topRight.y+this.colorMapPadding.top,t],i,5,e)}setupCorners(){this.colorMapCorners=this.calculateInitialLegendPosition()}updateGraphics(){if(this.isHidden)return;this.removeMeshIncrements();this.clearText(!0),this.colorMapCorners||this.setupCorners(),this.lastUsedDevicePixelRatio=(0,l.getDevicePixelRatio)();const e=this.createRectangleUsingLegendBounds(D,0);(0,d.addColorToIncrement)(this.backgroundColor,e),(0,d.setIncrementOpacity)(e,this.backgroundColor[3]),this.updateMeshIncrement(D,d.NO_SELECTION_ID,e,E);const t=this.createRectangleUsingLegendBounds(M,.2);this.updateMeshIncrement(M,T,t,I);if(this.createColorMapQuads().forEach((e=>this.updateMeshIncrement(e.id,C,e,this.colorMapNodeProperties))),this.isDamaged=!1,!this.visualizedScalarRange||this.visualizedScalarRange.noRange)return void this.clearTextCache();const i=s.default.getManager(),n=this.isVertical?this.colorMapCorners.bottomLeft.x:this.colorMapCorners.bottomLeft.y,a=i.getNumber("LEGEND_TICK_LENGTH_PX"),c=n-a,h=i.getColor("LEGEND_TICK_SCALE_COLOR"),u=i.getNumber("LEGEND_TICK_TEXT_GAP_PX"),g=i.getNumber("LEGEND_TICK_WIDTH");for(let e=0;e<6;e++){const t=this.currentScaleRange.magnitude/5*e+this.currentScaleRange.min,i=this.calculateLongSideCoordinate(t,this.currentScaleRange),s="legendScaleTick"+e,a=this.createTick(i,n,c,y,s,h,g);let o;this.updateMeshIncrement(s,d.NO_SELECTION_ID,a,p);let l=this.manager.getValueString(t),m=y;if(0===e?(m=.4,o=this.LEGEND_MINIMUM_CLICKED,this.isDisplayMinimumChanged(this.currentScaleRange)&&(l+="*")):5===e&&(m=.4,o=this.LEGEND_MAXIMUM_CLICKED,this.isDisplayMaximumChanged(this.currentScaleRange)&&(l+="*")),this.isVertical){const e=r.BTVector3d.fromArray([c-u,i,m]);this.placeText(l,e,d.BoundingSpot.HIGH,d.BoundingSpot.MID,s,o)}else{const e=r.BTVector3d.fromArray([i,c-u,m]);this.placeText(l,e,d.BoundingSpot.MID,d.BoundingSpot.HIGH,s,o)}}this.createMinMaxTick(o.RangeComponent.MIN),this.createMinMaxTick(o.RangeComponent.MAX),this.createMinMaxInputRangeText(a),this.clearTextCache()}createMinMaxInputRangeText(e){if(this.isInputMaximumChanged()){const t=this.getInputRangeValueString(o.RangeComponent.MAX),i=new r.BTVector3d;i.z=y,this.isVertical?(i.x=this.colorMapCorners.topRight.x-this.colorMapDimensions.width/2,i.y=this.colorMapCorners.topRight.y+e):(i.x=this.colorMapCorners.topRight.x+e,i.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height/2);const s=this.isVertical?d.BoundingSpot.MID:d.BoundingSpot.LOW,n=this.isVertical?d.BoundingSpot.LOW:d.BoundingSpot.MID;this.placeText(t,i,s,n)}if(this.isInputMinimumChanged()){const t=this.getInputRangeValueString(o.RangeComponent.MIN),i=new r.BTVector3d;i.z=y,this.isVertical?(i.x=this.colorMapCorners.topRight.x-this.colorMapDimensions.width/2,i.y=this.colorMapCorners.bottomLeft.y-e):(i.x=this.colorMapCorners.bottomLeft.x-e,i.y=this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height/2);const s=this.isVertical?d.BoundingSpot.MID:d.BoundingSpot.HIGH,n=this.isVertical?d.BoundingSpot.HIGH:d.BoundingSpot.MID;this.placeText(t,i,s,n)}}getInputRangeValueString(e){const t=this.getInputRangeInDisplayUnits(),i=e===o.RangeComponent.MAX?t.max:t.min;return this.manager.getValueString(i)}createColorMapQuad(e,t,i,s){const n=s?s[0]:void 0,r=s?s[1]:void 0,a=this.isVertical?[t.x,t.y,O]:[t.x,i.y,O],o=this.isVertical?[i.x,t.y,O]:[t.x,t.y,O],c=this.isVertical?[t.x,i.y,O]:[i.x,i.y,O];return(0,d.createQuad)(a,o,c,e,n,r)}createColorMapQuads(){const e=[],t=[[1,1],[1,1]],i=[[0,1],[1,0]],n=s.default.getManager().getNumber("LEGEND_OVERFLOW_DISPLAY_OFFSET_PX");if(this.isVertical){let s=this.colorMapCorners.topRight.y,a=this.colorMapCorners.bottomLeft.y;if(this.isInputMaximumChanged()){s=this.calculateLongSideCoordinate(this.visualizedScalarRange.max,this.currentScaleRange);const t=r.BTVector2d.fromArray([this.colorMapCorners.bottomLeft.x,s]),i=r.BTVector2d.fromArray([this.colorMapCorners.topRight.x,this.colorMapCorners.topRight.y+n]),a=this.createColorMapQuad(P,t,i);e.push(a)}if(this.isInputMinimumChanged()){a=this.calculateLongSideCoordinate(this.visualizedScalarRange.min,this.currentScaleRange);const i=r.BTVector2d.fromArray([this.colorMapCorners.topRight.x,a]),s=r.BTVector2d.fromArray([this.colorMapCorners.bottomLeft.x,this.colorMapCorners.bottomLeft.y-n]),o=this.createColorMapQuad(v,s,i,t);e.push(o)}const o=r.BTVector2d.fromArray([this.colorMapCorners.bottomLeft.x,a]),c=r.BTVector2d.fromArray([this.colorMapCorners.topRight.x,s]),l=this.createColorMapQuad(C,o,c,i);e.push(l)}else{let s=this.colorMapCorners.topRight.x,a=this.colorMapCorners.bottomLeft.x;if(this.isInputMaximumChanged()){s=this.calculateLongSideCoordinate(this.visualizedScalarRange.max,this.currentScaleRange);const t=r.BTVector2d.fromArray([s,this.colorMapCorners.bottomLeft.y]),i=r.BTVector2d.fromArray([this.colorMapCorners.topRight.x+n,this.colorMapCorners.topRight.y]),a=this.createColorMapQuad(P,t,i);e.push(a)}if(this.isInputMinimumChanged()){a=this.calculateLongSideCoordinate(this.visualizedScalarRange.min,this.currentScaleRange);const i=r.BTVector2d.fromArray([this.colorMapCorners.bottomLeft.x-n,this.colorMapCorners.bottomLeft.y]),s=r.BTVector2d.fromArray([a,this.colorMapCorners.topRight.y]),o=this.createColorMapQuad(v,i,s,t);e.push(o)}const o=r.BTVector2d.fromArray([a,this.colorMapCorners.bottomLeft.y]),c=r.BTVector2d.fromArray([s,this.colorMapCorners.topRight.y]),l=this.createColorMapQuad(C,o,c,i);e.push(l)}return e}clearText(e=!1){this.clearTextCache();for(let t=0;t<this.valueTextElements.length;++t){const i=this.valueTextElements[t].text;e?(i.viewer.uiSelectionManager.removeSelectionForUiElement(i),this.textCache.push(i)):i.remove(),this.stopListening(i)}this.valueTextElements=[]}getOrCreateText(e,t){for(let i=0;i<this.textCache.length;++i){const s=this.textCache[i];if(s.hasEqualTextAndOptions(e,t))return this.textCache.splice(i,1),s.show(),s}return new d.Text2D(this.viewer,e,t)}clearTextCache(){for(let e=0;e<this.textCache.length;++e)this.textCache[e].remove();this.textCache=[]}get isInverted(){return this.visualizedScalarRange&&this.visualizedScalarRange.isInverted}isInputMinimumChanged(e){return r.BTRange.isMinChanged(this.getInputRangeInDisplayUnits(),e||this.visualizedScalarRange,h.Tolerances.ZERO_LENGTH)}isInputMaximumChanged(e){return r.BTRange.isMaxChanged(this.getInputRangeInDisplayUnits(),e||this.visualizedScalarRange,h.Tolerances.ZERO_LENGTH)}isDisplayMinimumChanged(e){return r.BTRange.isMinChanged(this.getDefaultDisplayRangeInDisplayUnits(),e||this.visualizedScalarRange,h.Tolerances.ZERO_LENGTH)}isDisplayMaximumChanged(e){return r.BTRange.isMaxChanged(this.getDefaultDisplayRangeInDisplayUnits(),e||this.visualizedScalarRange,h.Tolerances.ZERO_LENGTH)}calculateLongSideCoordinate(e,t){let i;i=this.isVertical?this.colorMapCorners.bottomLeft.y+this.colorMapDimensions.height*(e-t.min)/t.magnitude:this.colorMapCorners.bottomLeft.x+this.colorMapDimensions.width*(e-t.min)/t.magnitude;const s=(0,l.getDevicePixelRatio)()/2;return Math.round(i+s)-s}createMinMaxTick(e){const t=e===o.RangeComponent.MAX,i=t?f:S,n=t?this.visualizedScalarRange.max:this.visualizedScalarRange.min,a=this.calculateLongSideCoordinate(n,this.currentScaleRange),c=s.default.getManager(),l=c.getNumber("LEGEND_TICK_LENGTH_PX"),h=c.getColor("LEGEND_TICK_MIN_MAX_COLOR"),u=c.getNumber("LEGEND_TICK_WIDTH"),g=u+2*c.getNumber("LEGEND_TICK_MIN_MAX_OUTLINE_WIDTH"),E=c.getColor("LEGEND_TICK_MIN_MAX_OUTLINE_COLOR"),I=c.getNumber("LEGEND_TICK_CLICK_TARGET_WIDTH_PX"),T=c.getNumber("LEGEND_TICK_TEXT_GAP_PX"),C=this.isVertical?this.colorMapCorners.topRight.x:this.colorMapCorners.topRight.y,P=this.isVertical?this.colorMapCorners.bottomLeft.x-l:this.colorMapCorners.bottomLeft.y-l,v=this.createTick(a,C,P,_-.05,i,E,g);this.updateMeshIncrement(i+"outline",i,v,p);const D=this.createTick(a,C,P,_,i,h,u);this.updateMeshIncrement(i,i,D,p);const M=this.createTick(a,C,P,_,i,h,I);if(this.updateMeshIncrement(i+"target",i,M,m),t&&this.tickBeingDragged===o.RangeComponent.MAX||!t&&this.tickBeingDragged===o.RangeComponent.MIN){const e=this.manager.getValueString(n),t=null,s=!0;if(this.isVertical){const n=r.BTVector3d.fromArray([P-T,a,_]);this.placeText(e,n,d.BoundingSpot.HIGH,d.BoundingSpot.MID,t,i,s)}else{const n=r.BTVector3d.fromArray([a,P-T,_]);this.placeText(e,n,d.BoundingSpot.MID,d.BoundingSpot.HIGH,t,i,s)}}}createTick(e,t,i,s,n,r,a){let o;return o=this.isVertical?(0,d.createLine)([i,e,s],[t,e,s],n,r):(0,d.createLine)([e,i,s],[e,t,s],n,r),(0,d.addSizeToIncrement)(a,o),o}placeText(e,t,i,n,r,a,o){const c={...a?this.clickableFontOptions:this.defaultFontOptions};c.size=Math.floor(s.default.getManager().getNumber("LEGEND_TICK_TEXT_HEIGHT_PX"));const l=this.getOrCreateText(e,c);if(l.positionRelativeTo([t.x,t.y,t.z],i,n),a){this.listenTo(l,d.UiEvents.MOUSE_ENTER+d.Text2D.SELECTION_ID,(()=>{this.viewer.pushCursor(w),l.updateWithOptions(this.hoverFontOptions)})),this.listenTo(l,d.UiEvents.MOUSE_LEAVE+d.Text2D.SELECTION_ID,(()=>{this.onMouseLeavePopCursor(w),l.updateWithOptions(this.clickableFontOptions)}));const e=this.getInputRangeInDisplayUnits();this.listenTo(l,d.UiEvents.CLICK+d.Text2D.SELECTION_ID,((t,i)=>{this.viewer.getEventDispatcher().trigger(a,i.sourceEvent,e,l.getTextCenterInCanvas())}))}if(o){const e=l.getTransformedBounds().getXyBounds();for(let t=0;t<this.valueTextElements.length;++t){const i=this.valueTextElements[t];e.overlapsWith(i.text.getTransformedBounds().getXyBounds())&&(i.text.hide(),i.associatedTickId&&this.hideIncrement(i.associatedTickId))}}this.valueTextElements.push({text:l,associatedTickId:r})}getColorMapCorners(){return this.colorMapCorners}}t.ScalarVisualizationLegend=B},854727:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ScalarVisualizationManager=void 0;const s=i(912057),n=i(606544),r=i(114924),a=i(873896),o=i(973008),c=i(197134),l=i(972968),h=i(322012);class d{constructor(e){this.modelViewManager=e,this.nodes=[],this.visualizationStateSubject=new h.Subject,this.DEFAULT_COLOR_MAPPING=n.GBTScalarVisualizationColorMapping.VIRIDIS,this.scalarVisualizationMaterials=[],this.keepLegendHiddenAndAllowControls=!1,this.webAssemblyUtils=r.GraphicsWebAssemblyUtils.module}cloneVisualizationState(e){return e.clone()}static getMapIndex(e){return d.imageMaps.findIndex((t=>t.type===e))}viewerIsInScalarVisualizationRenderMode(){return this.getViewer().getRenderingMode()===this.graphicsRenderMode}usesGraphicsRenderMode(e){return e===this.graphicsRenderMode}getRangeInData(){return this.displayedScalarRangeSpecification?this.displayedScalarRangeSpecification.rangeInData:null}setRangeInData(e){this.displayedScalarRangeSpecification?(this.displayedScalarRangeSpecification.rangeInData=e,this.getDefaultDisplayRange()||this.setVisualizedRange(e)):s.log.debug("Tried to set rangeInData but displayedScalarRangeSpecification was null")}getDefaultDisplayRange(){return this.displayedScalarRangeSpecification?this.displayedScalarRangeSpecification.defaultDisplayRange:null}updateDefaultDisplayRange(e){this.displayedScalarRangeSpecification?this.displayedScalarRangeSpecification.defaultDisplayRange=e:s.log.debug("Tried to set defaultDisplayRange but displayedScalarRangeSpecification was null")}setDefaultDisplayRange(e){this.updateDefaultDisplayRange(e),this.setVisualizedRange(e)}updateScalarRangeUniforms(){const e=this.getRangeInData();if(!e||!this.visualizedScalarRange)return;const t=e.max,i=e.magnitude;let n=1/i;i<=a.Tolerances.ZERO_LENGTH?(n=0,i<0&&s.log.debug("Invalid scalar input range")):i>16777216&&s.log.info(`Scalar range had a magnitude greater than 1.67e+7: ${i} for ${this.VISUALIZATION_MANAGER_NODE_ID}`);const r=this.getRangeInBaseUnits(this.visualizedScalarRange),o=r.max,c=1/r.magnitude;for(const e of this.scalarVisualizationMaterials)e.setCustomFloatUniform(d.SCALAR_INPUT_MAXIMUM_UNIFORM,t),e.setCustomFloatUniform(d.SCALAR_INPUT_MAGNITUDE_INVERSE_UNIFORM,n),e.setCustomFloatUniform(d.SCALAR_OUTPUT_MAXIMUM_UNIFORM,o),e.setCustomFloatUniform(d.SCALAR_OUTPUT_MAGNITUDE_INVERSE_UNIFORM,c)}getVisualizationState(){return this.visualizationState}getVisualizationStateObservable(){return this.visualizationStateSubject.asObservable()}getRangeInDisplayUnits(e){return e}getRangeInBaseUnits(e){return e}getValueInBaseUnits(e){return e}setVisualizationState(e){const t=this.visualizationState?this.displayedColorMap:null,i=null===t||t!==e.colorMapping,s=!this.visualizationState||!this.visualizationState.visualizedRange||!this.visualizationState.visualizedRange.equals(e.visualizedRange);this.visualizationState=e,this.visualizationStateSubject.next(e),this.updateGraphics(),i&&this.updateColorMapping(t,this.visualizationState.colorMapping),s&&this.updateVisualizedScalarRange(),this.readyToShowLegend()||this.hideLegend()}setVisualizedRange(e){const t=this.cloneVisualizationState(this.getVisualizationState());t.visualizedRange=e,this.setVisualizationState(t)}setVisualizedScaleComponent(e,t){const i=this.getValueInBaseUnits(e),s=this.visualizedScalarRange.clone();switch(t){case l.RangeComponent.MAX:s.max=i;break;case l.RangeComponent.MIN:s.min=i}this.setVisualizedRange(s)}setColorMapping(e){if(e===this.displayedColorMap)return;localStorage.setItem(this.COLOR_MAP_STORAGE_KEY,""+e);const t=this.getVisualizationState().clone();t.colorMapping=e,this.setVisualizationState(t)}onRenderingModeChanged(){this.prepareResources(),this.viewerIsInScalarVisualizationRenderMode()?this.showLegend():(this.clearGraphics(),this.hideLegend())}clearGraphics(){this.resetScenegraphNodes(),this.cursorAppendage&&(this.cursorAppendage.destroy(),this.cursorAppendage=null),this.hideLegend(),this.getViewer().requestDraw()}updateVisualizedScalarRange(){if(this.updateScalarRangeUniforms(),this.legend&&this.visualizedScalarRange){const e=this.getRangeInDisplayUnits(this.visualizedScalarRange);this.legend.setVisualizedScalarRange(e)}this.getViewer().requestDraw()}updateColorMapping(e,t){this.hideMapping(e),this.showMapping(t),this.updateVisualizedScalarRange()}get displayedColorMap(){return this.visualizationState?this.visualizationState.colorMapping:(s.log.warn("No visualization state set"),n.GBTScalarVisualizationColorMapping.UNKNOWN)}hideMapping(e){const t=d.getMapIndex(e),i=this.nodes[t];i&&i.setVisible(!1)}showMapping(e){const t=d.getMapIndex(e),i=this.nodes[t];i&&i.setVisible(!0),this.legend&&this.legend.setActiveColorMapping(e),this.showLegend()}showLegend(){this.legend&&this.readyToShowLegend()&&this.legend.isHidden&&(this.keepLegendHiddenAndAllowControls||this.legend.show(),this.getViewer().getEventDispatcher().trigger(this.LEGEND_OPENED,this.displayedColorMap))}hideLegend(){this.legend&&(this.legend.hide(),this.getViewer().getEventDispatcher().trigger(this.LEGEND_CLOSED))}setKeepLegendHiddenAndAllowControls(e){this.keepLegendHiddenAndAllowControls=e,this.keepLegendHiddenAndAllowControls&&this.legend&&this.legend.hide()}get visualizedScalarRange(){return this.visualizationState?this.visualizationState.visualizedRange:(s.log.debug("Visualization state undefined when trying to get visualized range"),null)}resetScenegraphNodes(){if(this.rootNode){for(let e=0;e<this.nodes.length;++e)this.nodes[e].remove();this.nodes=[];for(let e=0;e<d.imageMaps.length;++e){const t=new r.Node(this.VISUALIZATION_MANAGER_NODE_ID+"."+e,{isPickable:!1,clippedBySectionPlanes:!0});t.setVisible(!1),this.nodes.push(t),this.rootNode.addChild(t)}}}getViewer(){return this.modelViewManager.getViewer()}readyToShowLegend(){return!1}createMaterialForTexture(e){const t=new r.Material({ambientTexture:e});return t.shaderId="scalarVisualization",t}prepareResources(){if(0===this.scalarVisualizationMaterials.length&&this.getViewer().getGlContext())for(let e=0;e<d.imageMaps.length;++e){const t=new r.TextureDefinition(this.getViewer().getGlContext());t.imageSource=d.imageMaps[e].source;const i=new r.Texture(this.getViewer(),t);i.setHasTransparency(!1),this.getViewer().getResources().scalarVisualizationTextures.set(d.imageMaps[e].type,i);const s=this.createMaterialForTexture(i);s.setCustomFloatUniform("uOffsetFactor",0),s.setCustomIntUniform("uMakeUnsigned",0),this.scalarVisualizationMaterials.push(s)}if(!this.rootNode){const e=this.modelViewManager.getSharedBodyNode();this.rootNode=e.getChildById(this.VISUALIZATION_MANAGER_NODE_ID),this.rootNode||(this.rootNode=new r.Node(this.VISUALIZATION_MANAGER_NODE_ID),e.addChild(this.rootNode))}}getCursorValue(e,t){var i;const s=n.BTVector2d.fromArray([e,this.getViewer().getCamera().getViewportHeight()-t]);return(null===(i=this.legend)||void 0===i?void 0:i.isBeingDragged)||!this.getRangeInData()?null:this.legend&&this.legend.areCoordinatesOverLegend(s)&&this.visualizedScalarRange?this.legend.getValueFromCoordinatesInVisualizedRange(s):this.findScalarVisualizationScalar(e,t)}getCursorText(e,t){var i;if((null===(i=this.legend)||void 0===i?void 0:i.isBeingDragged)||!this.getRangeInData())return null;{const i=this.getCursorValue(e,t);if(!i)return;return this.getValueString(i)}}findScalarVisualizationScalar(e,t){const i=this.getViewer().findScalarVisualizationScalar(this.VISUALIZATION_MANAGER_NODE_ID,this.getRangeInDisplayUnits(this.getRangeInData()),e,t);return 0===i.length?null:i[0].scalar}getValueString(e){const t=(0,c.getCurrentDocumentSettingsModel)().getLengthUnitsDisplayPrecision(),i=o.PrecisionType.ScalarVisualization,s=1/Math.pow(10,a.Tolerances.SCALAR_VISUALIZATION_MAX_DECIMAL_PRECISION);return o.ValueAndUnitsFormatter.getNumberString(e,t,i,s)}isNodeForBodyVisualization(e){return 0===e.getId().indexOf(this.VISUALIZATION_MANAGER_NODE_ID)}getStoredColorMapping(){const e=localStorage.getItem(this.COLOR_MAP_STORAGE_KEY);return e?+e:this.DEFAULT_COLOR_MAPPING}getSampleMesh(e,t){return t.refinementHistory.history.length>0?this.webAssemblyUtils&&this.webAssemblyUtils.isReady?this.webAssemblyUtils.replaySampleMeshRefinementRoutine(e.sampleMesh,t.refinementHistory):(s.log.debug("Received refinement history for simulation data, but sampling utils module was not available"),e.sampleMesh):e.sampleMesh}}t.ScalarVisualizationManager=d,d.SCALAR_INPUT_MAXIMUM_UNIFORM="uScalarInputMax",d.SCALAR_INPUT_MAGNITUDE_INVERSE_UNIFORM="uScalarInputMagnitudeInverse",d.SCALAR_OUTPUT_MAXIMUM_UNIFORM="uScalarOutputMax",d.SCALAR_OUTPUT_MAGNITUDE_INVERSE_UNIFORM="uScalarOutputMagnitudeInverse",d.imageMaps=[{type:n.GBTScalarVisualizationColorMapping.VIRIDIS,source:"/images/scalar-visualization-gradient-viridis.png"},{type:n.GBTScalarVisualizationColorMapping.BLUE_RED,source:"/images/scalar-visualization-gradient.png"},{type:n.GBTScalarVisualizationColorMapping.RAINBOW,source:"/images/scalar-visualization-gradient-rainbow.png"},{type:n.GBTScalarVisualizationColorMapping.PLASMA,source:"/images/scalar-visualization-gradient-plasma.png"}]},688683:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLegend=t.SIMULATION_LEGEND_CANVAS_CONTROLS_PANEL_ID=t.DEFAULT_SIMULATION_COLOR_MAPPING=void 0;const s=i(545348),n=i(606544),r=i(114924);t.DEFAULT_SIMULATION_COLOR_MAPPING=n.GBTScalarVisualizationColorMapping.VIRIDIS,t.SIMULATION_LEGEND_CANVAS_CONTROLS_PANEL_ID="simulation-legend-canvas-controls";class a extends r.ScalarVisualizationLegend{constructor(){super(...arguments),this.LEGEND_MAXIMUM_CLICKED=r.SIMULATION_MAXIMUM_CLICKED,this.LEGEND_MINIMUM_CLICKED=r.SIMULATION_MINIMUM_CLICKED,this.LEGEND_RANGE_CHANGED=r.SIMULATION_RANGE_CHANGED,this.CANVAS_CONTROLS_PANEL_ID=t.SIMULATION_LEGEND_CANVAS_CONTROLS_PANEL_ID}updateGraphics(){void 0!==this.visualizedFieldType&&super.updateGraphics()}get SNAPPING_MARGIN_TOP(){return s.default.getManager().getNumber("SIMULATION_TOP_TOOLBAR_HEIGHT_PX")}}t.SimulationLegend=a},665184:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadDisplay=t.LoadTextures=void 0;const s=i(545348),n=i(264292),r=i(997687),a=i(912057),o=i(193786),c=i(606544),l=i(573879),h=i(223456),d=i(32620),u=i(873896),g=i(613199),p=i(114924),m=n.vec3.fromValues(1,0,0),E=n.vec3.fromValues(0,1,0),I=n.vec3.fromValues(0,0,1),T=n.vec3.fromValues(0,1,0);var S;!function(e){e.ACCELERATION_ARROW="ACCELERATION_ARROW",e.ACCELERATION_BEHIND="ACCELERATION_BEHIND",e.BEARING_ARROWS="BEARING_ARROWS",e.FORCE_ARROW="FORCE_ARROW",e.MOMENT_BASE="MOMENT_BASE",e.PRESSURE="PRESSURE",e.PRESSURE_FLIPPED="PRESSURE_FLIPPED",e.ROUND_BASE="ROUND_BASE"}(S||(S={})),t.LoadTextures={},t.LoadTextures[S.ACCELERATION_ARROW]="simulation/acceleration-arrow",t.LoadTextures[S.ACCELERATION_BEHIND]="simulation/acceleration-behind",t.LoadTextures[S.BEARING_ARROWS]="simulation/bearing-arrows",t.LoadTextures[S.FORCE_ARROW]="simulation/force-arrow",t.LoadTextures[S.MOMENT_BASE]="simulation/moment-base",t.LoadTextures[S.PRESSURE]="simulation/pressure",t.LoadTextures[S.PRESSURE_FLIPPED]="simulation/pressure-flipped",t.LoadTextures[S.ROUND_BASE]="simulation/base";const f=s.default.getManager().getNumber("SIMULATION_LOAD_LEADER_OFFSET_RATIO"),C=new p.NodeProperties({primitiveType:p.PrimitiveType.LINES,isShowThrough:!1,isDepthTested:!0,isPickable:!1}),P=C.cloneAndModify({isShowThrough:!0,isDepthTested:!1,isStencilTested:!0}),v="obliqueBaseLine",D=Math.cos((0,p.toRadians)(90-s.default.getManager().getNumber("SIMULATION_LOAD_OBLIQUE_BASE_LINE_ANGLE_THRESHOLD_DEGREES"))),M=s.default.getManager().getColor("SIMULATION_LOAD_BASE_COLOR"),y=s.default.getManager().getColor("SIMULATION_PRE_HIGHLIGHT_COLOR"),O=s.default.getManager().getColor("SIMULATION_HIGHLIGHT_COLOR"),_=C.cloneAndModify({primitiveType:p.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,isPickable:!0}),A="loadComponent",R="lineAxis",N=s.default.getManager().getStipple("SIMULATION_LINE_AXIS_STIPPLE"),w=n.vec3.create(),b=n.vec3.create(),L=(n.vec3.create(),n.vec3.create(),s.default.getManager().getNumber("SIMULATION_LOAD_GLYPH_SIZE"));class B{constructor(e,t,i){this.leftPoint=e,this.rightPoint=t,this.color=i}equals(e){return!!e&&(n.vec3.equals(this.leftPoint,e.leftPoint)&&n.vec3.equals(this.rightPoint,e.rightPoint)&&(0,l.arraysEqual)(this.color,e.color))}}class F extends p.UIElement{constructor(e,t,i,s){super(t),this.loadDisplayManager=e,this.loadDisplayData=i,this.hideLoad=s,this.worldAnchorPoint=null,this.worldOrigin_=null,this.worldXAxis=null,this.worldYAxis=null,this.worldZAxis=null,this.adjustedWorldOrigin=n.vec3.create(),this.leaderRay=null,this.occupiedScreenBounds=new p.BoundingBox2D,this.glyphComponents=[],this.targetId_="",this.offsetInLeaderDirection_=0,this.hideLeader=!1,this.isBeingEdited=!1}setHideLoads(e){this.hideLoad!==e&&(this.hideLoad=e,this.updateHideState(),this.updateGraphics(this.loadDisplayData))}setEditState(e){this.isBeingEdited=e,this.updateHideState(),this.updateGraphics(this.loadDisplayData)}updateHideState(){!this.hideLoad||this.isHighlighted()||this.isBeingEdited?(this.show(),this.updateGraphics(this.loadDisplayData)):this.hide()}hide(){super.hide(),this.glyphComponents.forEach((e=>{e.hide()}))}show(){super.show(),this.glyphComponents.forEach((e=>{e.show()}))}remove(){this.clearComponents(),super.remove()}update(e){const t=e||this.loadDisplayData;t&&(this.hideLoad=this.shouldBeHidden(t),this.updateHideState(),this.updateGraphics(t))}shouldBeHidden(e){return!r.btInjector.SimulationService.getCanAccessSimulations()||(!!e.hidden||(!(!this.loadDisplayManager||!this.loadDisplayManager.getExplodeViewActive())||!!this.occurrenceIsHidden(e.occurrence)))}removeMeshIncrements(){super.removeMeshIncrements(),this.lastObliqueBaseLineDisplayed=null,this.lastLineAxisDisplayed=null}updateGraphics(e){if(this.viewer.requestDraw(),this.loadDisplayData=e,this.isHidden)return void this.removeMeshIncrements();switch(this.clearComponents(),this.clearPositionalData(),e.loadType){case c.GBTLoadType.ACCELERATION:case c.GBTLoadType.BEARING_LOAD:case c.GBTLoadType.FORCE:case c.GBTLoadType.MOMENT:if(n.vec3.squaredLength(this.loadDisplayData.componentValues.getVec3())<u.Tolerances.ZERO_LENGTH_SQUARED)return}if(this.computePositionalData(),!this.isValid)return;const t=e.status===c.GBTAssemblyFeatureDisplayStatus.SUPPRESSED?p.GlyphStates.SUPPRESSED:p.GlyphStates.NORMAL;switch(e.loadType){case c.GBTLoadType.ACCELERATION:this.addBaseGlyph(S.ROUND_BASE,t),this.addDirectionGlyph(S.ACCELERATION_ARROW,t),this.addDirectionGlyph(S.ACCELERATION_BEHIND,t,!0);break;case c.GBTLoadType.BEARING_LOAD:this.addBaseGlyph(S.ROUND_BASE,t),this.addDirectionGlyph(S.BEARING_ARROWS,t);break;case c.GBTLoadType.FORCE:this.addBaseGlyph(S.ROUND_BASE,t),this.addDirectionGlyph(S.FORCE_ARROW,t);break;case c.GBTLoadType.MOMENT:this.addBaseGlyph(S.MOMENT_BASE,t);break;case c.GBTLoadType.PRESSURE:this.addPressureGlyph(t,e.isDirectionFlipped)}const i=this.getHighlight();i&&this.addHighlightToComponents(i),this.updateTargetId()}get scaledGlyphSize(){return L*(0,d.getDevicePixelRatio)()}updateViewDependentGraphics(e){if(!this.isValid||this.isHidden)return void this.removeMeshIncrements();if(!this.viewer.getResources().loadGlyphResources.atlasReady)return;const t=s.default.getManager(),i=e.getPixelSizeAtWorldPoint(this.worldOrigin_),r=this.scaledGlyphSize;for(let e=0;e<this.glyphComponents.length;++e)this.glyphComponents[e].setWorldOrigin(this.adjustedWorldOrigin);const a=this.getDistanceFromOriginToGlyphEdge(!0)+t.getNumber("SIMULATION_LOAD_LEADER_GAP_PX"),o=this.leaderWorldDistance+this.offsetInLeaderDirection_-i*a;if(this.hideLeader||o<0)this.removeMeshIncrement("leader"),this.removeMeshIncrement("leader-st");else{const e=(0,p.createLine)(this.worldAnchorPoint,this.leaderRay.evaluate(o));(0,p.addColorToIncrement)(t.getColor("SIMULATION_LOAD_LEADER_LINE_COLOR"),e),this.updateMeshIncrement("leader",p.NO_SELECTION_ID,e,C);const i=e.clone();(0,p.addColorToIncrement)(t.getColor("SIMULATION_LOAD_LEADER_HIDDEN_LINE_COLOR"),i),this.updateMeshIncrement("leader-st",p.NO_SELECTION_ID,i,P)}const c=Math.abs(n.vec3.dot(e.getDirectionToWorldPoint(this.adjustedWorldOrigin),this.worldZAxis));if(c<D&&this.usesBaseGlyph){const t=g.vec3C.normalize(g.vec3C.cross(e.getForward(),this.worldZAxis,w)),s=i*r*.5,a=this.getColorWithHighlight(M).slice();a[3]=1-c/D;const o=new B(n.vec3.subtract(n.vec3.create(),this.adjustedWorldOrigin,n.vec3.scale(b,t,-s)),n.vec3.subtract(n.vec3.create(),this.adjustedWorldOrigin,n.vec3.scale(b,t,s)),a);if(!o.equals(this.lastObliqueBaseLineDisplayed)){const e=(0,p.createLine)(o.leftPoint,o.rightPoint);(0,p.addColorToIncrement)(a,e),this.updateMeshIncrement(v,A,e,_),this.lastObliqueBaseLineDisplayed=o}}else this.removeMeshIncrement(v),this.lastObliqueBaseLineDisplayed=null;if(this.showLineAxis){const e=i*r*.25,t=new B(n.vec3.subtract(n.vec3.create(),this.adjustedWorldOrigin,n.vec3.scale(b,this.worldZAxis,-e)),n.vec3.subtract(n.vec3.create(),this.adjustedWorldOrigin,n.vec3.scale(b,this.worldZAxis,e)),this.getColorWithHighlight(s.default.getManager().getColor("SIMULATION_LINE_AXIS_COLOR")));if(!t.equals(this.lastLineAxisDisplayed)){const e=(0,p.createLine)(t.leftPoint,t.rightPoint);(0,p.addColorToIncrement)(t.color,e),(0,p.addStyleToIncrement)(N,e),this.updateMeshIncrement(R,A,e,_),this.lastLineAxisDisplayed=t}}else this.removeMeshIncrement(R),this.lastLineAxisDisplayed=null}getModelSelection(e){const t=new o.Selection(c.GBTUiSelectionType.OCCURRENCE,this.loadDisplayData.occurrence);return new o.Selection(c.GBTUiSelectionType.SIMULATION_LOAD,this.loadDisplayData.nodeId,this.loadDisplayData.ownerOccurrence,{childSelections:[t]})}addHighlight(e){super.addHighlight(e),this.updateHideState(),this.addHighlightToComponents(e)}addHighlightToComponents(e){for(let t=0;t<this.glyphComponents.length;t++)this.glyphComponents[t].addHighlight(e)}removeHighlight(e){const t=super.removeHighlight(e);for(let t=0;t<this.glyphComponents.length;t++)this.glyphComponents[t].removeHighlight(e);return this.updateHideState(),t}get leaderDirection(){return this.leaderRay.direction}set offsetInLeaderDirection(e){this.offsetInLeaderDirection_=e;const t=this.leaderWorldDistance+this.offsetInLeaderDirection_;this.leaderRay.evaluate(t,this.adjustedWorldOrigin)}get offsetInLeaderDirection(){return this.offsetInLeaderDirection_}get worldOrigin(){return this.worldOrigin_}get targetId(){return this.targetId_}updateTargetId(){const e=this.loadDisplayData.faceLoadDeterministicIds.slice();e.sort(),this.targetId_=this.loadDisplayData.occurrence.toString()+"-"+e}getDistanceFromOriginToGlyphEdge(e){const t=this.scaledGlyphSize,i=e?-1:1,s=Math.max(0,this.getDirectionGlyphLength()*i*n.vec3.dot(this.worldZAxis,this.leaderRay.direction)),r=n.vec3.dot(this.worldZAxis,this.leaderRay.direction);return(this.usesBaseGlyph?Math.sqrt(1-r*r)*t*.5:.5*t)+s}getOccupiedScreenBounds(e,t){if(this.isHidden)return this.occupiedScreenBounds.reset(),this.occupiedScreenBounds;const i=this.scaledGlyphSize;if(this.usesBaseGlyph){this.occupiedScreenBounds.reset();for(let s=-.5;s<=.5;s+=1){for(let n=-.5;n<=.5;n+=1){let n=g.vec3C.add(this.adjustedWorldOrigin,g.vec3C.scale(this.worldXAxis,s*t*i,b),w);n=g.vec3C.add(n,g.vec3C.scale(this.worldYAxis,s*t*i,b),w),this.occupiedScreenBounds.addPoint(e.projectWorldPointToCanvas(n))}const n=g.vec3C.add(this.adjustedWorldOrigin,g.vec3C.scale(this.worldZAxis,t*this.getDirectionGlyphLength(),b),w);this.occupiedScreenBounds.addPoint(e.projectWorldPointToCanvas(n))}}else this.occupiedScreenBounds.makeCenteredBoxOnPoint(e.projectWorldPointToCanvas(this.adjustedWorldOrigin),i*t);return this.occupiedScreenBounds}clearComponents(){for(let e=0;e<this.glyphComponents.length;++e)this.glyphComponents[e].remove();this.glyphComponents=[],this.removeMeshIncrements()}get assembly(){return this.viewer.getModelViewManagers().getManager().getDisplayedAssembly()}clearPositionalData(){this.worldAnchorPoint=null,this.worldOrigin_=null,this.worldXAxis=null,this.worldYAxis=null,this.worldZAxis=null,this.leaderRay=null}get isValid(){return!!(this.worldAnchorPoint&&this.worldOrigin_&&this.worldXAxis&&this.worldYAxis&&this.worldZAxis)}updateWorldZAxisWithPartStudioMateConnector(){const e=c.BTOccurrence.getOccurrenceFromPathString(this.loadDisplayData.directionMateConnectorId),t=e.getOccurrenceWithoutTail().getPathAsString(),i=this.assembly.getOccurrences()[t];if(i){const t=i.fullElementId.toString(),s=this.assembly.elementAccessor.getPartStudio(t);if(s){const t=i.occurrenceData,n=t.transform.getGlMatrix(),r=s.getMateConnectorData(t.occurrence,e.getTailNodeId());if(r){const e=r.location.getGlMatrix();this.updateWorldZAxisInternal(n,e)}else a.log.warn("Unable to find mate connector display data")}else a.log.warn("Unable to find part studio element")}else a.log.warn("Unable to find part studio display data")}updateWorldZAxisInternal(e,t){if(e&&t){const i=g.mat4C.multiply(e,t,n.mat4.create());this.worldZAxis=g.vec3C.normalize(g.mat4C.multiplyVec4(i,(0,p.vec4FromVec3)(this.loadDisplayData.componentValues.getVec3(),0)))}else a.log.warn("Unable to identify load direction.")}updateWorldZAxis(){if(this.worldZAxis=n.vec3.clone(E),this.loadDisplayData){if(this.loadDisplayData.directionMateConnectorId){const e=this.assembly.mateConnectorData[this.loadDisplayData.directionMateConnectorId];if(e){const t=e.location.getGlMatrix(),i=this.assembly.getOccurrences()[e.occurrence.getPathAsString()].occurrenceData.transform.getGlMatrix();this.updateWorldZAxisInternal(i,t)}else this.updateWorldZAxisWithPartStudioMateConnector()}this.loadDisplayData.isDirectionFlipped&&(this.worldZAxis=g.vec3C.negate(this.worldZAxis))}}computePositionalData(){const e=n.vec3.clone(m),t=this.getBounds();if(!t||!t.isFinite())return;const i=t.center(),s=this.viewer.getModelBounds();if(n.vec3.dot(e,g.vec3C.subtract(i,s.center(),n.vec3.create()))<-u.Tolerances.ZERO_LENGTH&&g.vec3C.negate(e),this.updateAnchorPoint(g.vec3C.add(i,g.vec3C.scale(e,t.diameter()/2,n.vec3.create()),n.vec3.create())),!this.worldAnchorPoint)return;let r=0;const a=s.getCorners();if(!a)return;const o=n.vec3.dot(this.worldAnchorPoint,e);for(let t=0;t<a.length;++t){const i=n.vec3.dot(a[t],e)-o;i>r&&(r=i)}this.worldOrigin_=g.vec3C.add(this.worldAnchorPoint,g.vec3C.scale(e,r+f*s.diameter(),n.vec3.create()),n.vec3.create()),this.updateWorldZAxis(),(0,h.areUnitVectorsParallel)(I,this.worldZAxis)?this.worldXAxis=g.vec3C.normalize(g.vec3C.cross(T,this.worldZAxis,n.vec3.create())):this.worldXAxis=g.vec3C.normalize(g.vec3C.cross(I,this.worldZAxis,n.vec3.create())),this.worldYAxis=g.vec3C.normalize(g.vec3C.cross(this.worldZAxis,this.worldXAxis,n.vec3.create()));const c=g.vec3C.subtract(this.worldOrigin_,this.worldAnchorPoint,n.vec3.create());this.leaderWorldDistance=g.vec3C.length(c),this.leaderRay=new p.Ray(this.worldAnchorPoint,c)}updateAnchorPoint(e){this.worldAnchorPoint=null;const t=this.viewer.getModelViewManagers().getManager();let i;const s=this.loadDisplayData.occurrence;if(this.loadDisplayData.faceLoadDeterministicIds.length>0)i=this.loadDisplayData.faceLoadDeterministicIds;else{const e=t.getOccurrenceDisplayData(s);if(!e)return void a.log.debug("Failed to find occurrence display data for load");const n=t.getPartStudioDataFromOccurrence(s);if(!n)return void a.log.debug("Failed to find part studio display data for load");i=[];for(const t of e.displayedPartIds)i=i.concat(n.getEntitiesForBody(t))}if(!i||0===i.length)return void a.log.debug("No deterministic ids to use for load anchor point");const r=t.getOccurrenceTransform(s);if(!r)return void a.log.debug("Failed to find occurrence transform for load");const o=g.mat4C.multiplyVec3(g.mat4C.inverse(r,n.mat4.create()),e,n.vec3.create());let c=null;for(let e=0;e<i.length;++e){const n=t.extractMeshIncrement(i[e],s);if(n){const e=n.getPositionNearPoint(o);e.position&&(!c||e.distance<c.distance)&&(c=e)}}c?this.worldAnchorPoint=g.mat4C.multiplyVec3(r,c.position):a.log.debug("Failed to find anchor point for load display")}getBounds(){if(this.loadDisplayData.faceLoadDeterministicIds.length>0){const e=new p.BoundingBox;for(let t=0;t<this.loadDisplayData.faceLoadDeterministicIds.length;++t)e.addBox(this.viewer.getModelViewManagers().getManager().getEntityBounds(this.loadDisplayData.faceLoadDeterministicIds[t],this.loadDisplayData.occurrence));return e}return this.assembly.getOccurrenceBounds(this.loadDisplayData.occurrence)}addBaseGlyph(e,t){const i=new p.ScreenSpaceQuadGlyphComponent(this.viewer,this.viewer.getResources().loadGlyphResources,e,t,L,p.RenderOrderPriority.DEFAULT,this.worldOrigin_,this.worldXAxis,this.worldYAxis,this);this.glyphComponents.push(i)}addDirectionGlyph(e,t,i){const s=i?g.vec3C.scale(this.worldZAxis,-1,n.vec3.create()):this.worldZAxis,r=new p.DirectionalScreenFacingSpaceQuadGlyphComponent(this.viewer,this.viewer.getResources().loadGlyphResources,e,t,L,p.RenderOrderPriority.DEFAULT,this.worldOrigin_,s,[.5,0],this);this.glyphComponents.push(r)}addPressureGlyph(e,t){const i=t?S.PRESSURE_FLIPPED:S.PRESSURE,s=new p.ScreenFacingSpaceQuadGlyphComponent(this.viewer,this.viewer.getResources().loadGlyphResources,i,e,L,p.RenderOrderPriority.DEFAULT,this.worldOrigin_,[.5,.5],this);this.glyphComponents.push(s)}get usesBaseGlyph(){return this.loadDisplayData.loadType!==c.GBTLoadType.PRESSURE}get showLineAxis(){return this.loadDisplayData.loadType===c.GBTLoadType.MOMENT}getColorWithHighlight(e){const t=this.getHighlight();return t?t.type===p.HighlightType.PRE?y:O:e}getDirectionGlyphLength(){switch(this.loadDisplayData.loadType){case c.GBTLoadType.ACCELERATION:case c.GBTLoadType.BEARING_LOAD:case c.GBTLoadType.FORCE:return this.scaledGlyphSize;case c.GBTLoadType.MOMENT:return.25*this.scaledGlyphSize}return 0}occurrenceIsHidden(e){const t=this.assembly.getDisplayDataForOccurrence(e);return!!t&&t.isHidden}}t.SimulationLoadDisplay=F},116595:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadDisplayGroup=void 0;const s=i(545348),n=i(264292),r=i(613199),a=i(114924),o=n.vec3.create();t.SimulationLoadDisplayGroup=class{constructor(){this.loadDisplays=[],this.occupiedScreenBounds=new a.BoundingBox2D}addDisplay(e){this.loadDisplays.push(e)}arrangeAndUpdateForView(e,t){if(0===this.loadDisplays.length||!this.loadDisplays[0].isValid)return;const i=this.loadDisplays[0].worldOrigin,n=this.loadDisplays[0].leaderDirection,a=this.loadDisplays[0].scaledGlyphSize,c=e.getPixelSizeAtWorldPoint(i),l=s.default.getManager().getNumber("SIMULATION_INTER_LOAD_GAP_PX");let h=0,d=!1;for(let e=0;e<this.loadDisplays.length;++e){const t=this.loadDisplays[e];t.isHidden||(0!==e&&(h+=c*t.getDistanceFromOriginToGlyphEdge(!0)),t.hideLeader=d,d=!0,t.offsetInLeaderDirection=h,h+=c*Math.max(t.getDistanceFromOriginToGlyphEdge(!1),l))}this.occupiedScreenBounds.reset();for(let t=0;t<this.loadDisplays.length;++t)this.occupiedScreenBounds.addBox(this.loadDisplays[t].getOccupiedScreenBounds(e,c));const u=e.projectWorldDirectionToCanvas(i,r.vec3C.scale(n,c*a,o));r.vec2C.normalize(u);let g=t.getUnoccupiedOffsetAlongDirection(this.occupiedScreenBounds,u);if(g>0){g+=l;const e=g*c;for(let t=0;t<this.loadDisplays.length;++t){const i=this.loadDisplays[t];i.offsetInLeaderDirection=i.offsetInLeaderDirection+e}this.occupiedScreenBounds.translate(r.vec2C.scale(u,g))}t.addOccupiedRegion(this.occupiedScreenBounds);for(let t=0;t<this.loadDisplays.length;++t)this.loadDisplays[t].updateViewDependentGraphics(e)}}},557068:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadDisplayManager=void 0;const s=i(997687),n=i(114924);class r extends n.UIElement{constructor(e){super(e),this.loadDisplayData=new Map,this.loadDisplays=new Map,this.groupedLoadDisplays=new Map,this.loadDisplayOccupancyMap=new n.ScreenOccupancyMap,this.explodeViewActive=!1,this.mateConnectorIdToLoads=new Map,this.loadResources(),s.btInjector.SimulationService.getCanAccessSimulationsObservable().subscribe((e=>{for(const t of this.loadDisplays.values())t.setHideLoads(!e),this.show()}))}setEditState(e,t){const i=this.loadDisplays.get(e);i&&i.setEditState(t)}reset(){this.clearLoadDisplays(),this.loadDisplayData.clear(),this.mateConnectorIdToLoads.clear()}hide(){this.isHidden=!0,this.clearLoadDisplays()}show(){this.isHidden=!1,this.updateLoadDisplays(this.loadDisplayData.values(),!0)}onAppearanceConstantsUpdated(){this.isHidden||(this.clearLoadDisplays(),this.updateLoadDisplays(this.loadDisplayData.values(),!0))}setExplodeViewActive(e){if(this.explodeViewActive!==e)if(this.explodeViewActive=e,e)this.clearLoadDisplays();else{const e=!0;this.updateLoadDisplays(this.loadDisplayData.values(),e)}}getExplodeViewActive(){return this.explodeViewActive}static getMateConnectorPath(e){return e.ownerOccurrence.createOccurrenceWithTailAppended(e.nodeId).getPathAsString()}processUpdates(e,t){if(!this.assembly)return;if(e.isCollapsible)return void this.hide();t&&this.isHidden&&!this.explodeViewActive&&this.show();for(const t of e.deletedLoads){const e=this.loadDisplays.get(t);e&&(e.remove(),this.loadDisplays.delete(t));const i=this.loadDisplayData.get(t);if(i){const e=i.directionMateConnectorId;if(e){const i=this.mateConnectorIdToLoads.get(e);i&&(i.delete(t),0===i.size&&this.mateConnectorIdToLoads.delete(e))}}this.loadDisplayData.delete(t)}const i=new Set(e.mateConnectors.map((e=>r.getMateConnectorPath(e))));for(const t of e.occurrences){const e=this.assembly.getMateConnectorsForOccurrence(t.occurrenceData.occurrence);for(let t=0;t<e.length;t++)i.add(r.getMateConnectorPath(e[t]))}this.updateLoadDisplays(e.loads.values(),t,Array.from(i))}processDeletedMateConnector(e){this.mateConnectorIdToLoads.delete(e)}getUiElementsForSelection(e){if(!e.isSimulationLoad())return[];const t=this.loadDisplays.get(e.getIdString());return t?[t]:[]}getDisplayDataForSelection(e){return e.isSimulationLoad()?this.loadDisplayData.get(e.getIdString()):null}onViewWillDraw(e){this.loadDisplayOccupancyMap.clearOccupiedRegions();for(const[t,i]of this.groupedLoadDisplays)i.arrangeAndUpdateForView(e,this.loadDisplayOccupancyMap)}updateDirectionMateConnectorToLoad(e){const t=e.nodeId,i=e.directionMateConnectorId,s=this.loadDisplayData.get(t);if(s){const e=s.directionMateConnectorId;if(e&&e!==i){const i=this.mateConnectorIdToLoads.get(e);i&&i.delete(t)}}if(i){const e=this.mateConnectorIdToLoads.get(i);e?e.add(t):this.mateConnectorIdToLoads.set(i,new Set([t]))}}updateLoadDisplays(e,t,i){for(const i of e){const e=i.nodeId;if(this.updateDirectionMateConnectorToLoad(i),this.loadDisplayData.set(e,i),t){let t=this.loadDisplays.get(e);if(!t){const r=i.hidden||!s.btInjector.SimulationService.getCanAccessSimulations();t=new n.SimulationLoadDisplay(this,this.viewer,i,r),this.loadDisplays.set(e,t)}t.update(i)}}if(i)for(let e=0;e<i.length;e++)this.processMateConnectorChange(i[e]);this.setupAssemblyListeners(),this.groupedLoadDisplays.clear();for(const[e,t]of this.loadDisplays){if(!t.isValid)continue;let e=this.groupedLoadDisplays.get(t.targetId);e||(e=new n.SimulationLoadDisplayGroup,this.groupedLoadDisplays.set(t.targetId,e)),e.addDisplay(t)}}processMateConnectorChange(e){const t=this.mateConnectorIdToLoads.get(e);t&&t.forEach((e=>{const t=this.loadDisplays.get(e);t&&t.update()}))}setupAssemblyListeners(){this.stopListening(this.assembly);const e=new Set;for(const t of this.loadDisplays.keys()){const i=this.loadDisplayData.get(t).occurrence.getPathAsString();e.add(i)}for(const t of e)this.listenTo(this.assembly,"OCCURRENCE_DATA_CHANGE."+t,this.show)}clearLoadDisplays(){for(const[e,t]of this.loadDisplays)t.remove();this.loadDisplays.clear(),this.groupedLoadDisplays.clear(),this.stopListening()}loadResources(){if(!this.viewer.getResources().loadGlyphResources){const e="LOAD_GLYPHS",t=48,i=[1,2],s=!0;this.viewer.getResources().loadGlyphResources=new n.SimulationLoadGlyphResources(e,this.viewer,n.LoadTextures,t,i,{clearColorOverride:[255,255,255,0],useMipMappingAndAnisotropicFiltering:!0},s)}}get assembly(){return this.viewer.getModelViewManagers().getManager().getDisplayedAssembly()}}t.SimulationLoadDisplayManager=r},449428:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationLoadGlyphResources=void 0;const s=i(114924);class n extends s.GlyphResources{getAtlasBackgroundColor(e,t){return"rgba(0, 0, 0, 0.0)"}getAtlasTextureName(e,t,i){let n="";return i!==s.GlyphHighlightStates.NO_HIGHLIGHT?n="_"+i:t===s.GlyphStates.SUPPRESSED&&(n+=s.GlyphStateTextureSuffixes[t]),this.textures[e]+n+this.getSystemStateSuffix()+".png"}initializeNodeProperties(){for(const e in s.GlyphHighlightStates)for(const t in s.GlyphStates){const i=this.getNodePropertyKey(e,t,s.RenderOrderPriority.DEFAULT);this.nodeProperties[i]=new s.NodeProperties({primitiveType:s.PrimitiveType.TRIANGLES,isShowThrough:!1,isDepthTested:!1,isTwoSided:!0,priority:s.RenderOrderPriority.DEFAULT,primitivesHaveTransparency:!0,material:this.material})}}}t.SimulationLoadGlyphResources=n},751794:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Assembly=t.CachedOccurrenceState=t.CONSTANTS=void 0;const s=i(736234),n=i(545348),r=i(719347),a=i(912057),o=i(193786),c=i(997687),l=i(955650),h=i(606544),d=i(85655),u=i(315689),g=i(723617),p=i(772687),m=i(114924),E=i(378695);t.CONSTANTS=n.default.getManager();class I{constructor(){this.boundingSphere=null,this.lod=null,this.cullingState=null}}t.CachedOccurrenceState=I;class T extends m.Element{constructor(e,t,i){super(i),this.elementId=e,this.elementAccessor=t,this.occurrences={},this.occurrencePrefixToLeaves={},this.mateConnectorData={},this.mateConnectorGraphics={},this.mateIndicatorData=new Map,this.mateIndicatorGraphics={},this.occurrenceMateIndicators={},this.originDisplayData=null,this.originGraphics=null,this.isHidden_=!0,this.isForInContext=!1,this.cachedOccurrenceState={},this.fullElementIdToOccurrence=new u.TemplatedNestedMap,this.ownerToInstanceMateIndicatorIds=new Map,this.mateIndicatorOwnerInstanceIds=new Map,this.mateConnectorMateIndicatorIds=new Map,this.mateIndicatorMateConnectorIds=new Map,this.occurrenceMateConnectors=new u.TemplatedNestedMap,this.ensureRootOccurrenceDisplayData(),(0,m.ensureMateIndicatorResources)(i),this.loadDisplayManager=new m.SimulationLoadDisplayManager(i)}onDeletion(){this.reset(),this.loadDisplayManager.remove()}getUsedPartStudioIds(e){e.addAll(this.fullElementIdToOccurrence.getKeys())}populateClientCacheStateDisplayInformation(e){if(this.microversionIdAndConfiguration){const t=e.getOrCreateElementDataList(this.elementId,h.BTUiDocumentClientCacheState.DISPLAY_DATA);this.checkDuplicatedMicroversionIdAndConfiguration(t,this.microversionIdAndConfiguration)?t.push(this.microversionIdAndConfiguration):a.log.warn("Found duplicated assembly microversion id and configuration "+this.microversionIdAndConfiguration)}}getIdOccurrenceNodeId(e,t){return(0,d.createOccurrenceNodeId)(e,t)}getMateConnectorGraphicsForSelection(e){let t=[];if(e.isMateConnector()){const i=this.getMateConnectorGraphics(e.getOccurrence(),e.getIdString());i&&t.push(i)}else if(e.childSelections)for(let i=0;i<e.childSelections.length;i++){const s=e.childSelections[i];s.isMateConnector()&&(t=t.concat(this.getMateConnectorGraphicsForSelection(s)))}return t}getMateIndicatorGraphics(e,t){let i=this.mateIndicatorGraphics[e];if(!i){const s=this.mateIndicatorData.get(e);s&&(i=this.updateMateIndicatorGraphicsAndOccurrences(s,t))}return i}getMateIndicatorForSelection(e){const t=[];if(e.isMate()){const i=!0,s=this.getIdOccurrenceNodeId(e.getOccurrence(),e.getIdString()),n=this.getMateIndicatorGraphics(s,i);n&&t.push(n)}return t}getEntitiesForNonInstanceSelection(e){let t=[];const i=function(e,i){for(let s=0;s<i.length;++s)if(i[s]===h.BTAssemblyDefaultFeatures.ORIGIN_ID&&e.isRoot()){const i=(0,E.createSelectionForAssemblyOrigin)(e);t.push(i)}else t.push(new o.Selection(h.GBTUiSelectionType.ENTITY,i[s],e))};if(e.isMateConnector()){const t=this.getIdOccurrenceNodeId(e.getOccurrence(),e.getIdString()),s=this.mateConnectorData[t];s&&i(s.occurrence,s.entityIds)}else if(e.isSimulationLoad()){const t=this.loadDisplayManager.getDisplayDataForSelection(e);t&&i(t.occurrence,t.faceLoadDeterministicIds)}else if(e.isGeometryMate()){const t=this.getIdOccurrenceNodeId(e.getOccurrence(),e.getFeatureId()),s=(0,g.as)(h.BTGeometryMateDisplayData,this.mateIndicatorData.get(t));s&&(s.firstDeterministicId&&i(s.firstOccurrence,[s.firstDeterministicId]),s.secondDeterministicId&&i(s.secondOccurrence,[s.secondDeterministicId]))}else e.isMate()?t=this.callOnChildSelections(this.getEntitiesForNonInstanceSelection,e):e.isEntity()&&t.push(e);return t}getMateConnectorGraphics(e,t,i){const s=this.getIdOccurrenceNodeId(e,t),n=this.mateConnectorData[s];let r=null;if(n){if(r=this.mateConnectorGraphics[s],!r){const e=this.occurrences[n.occurrence.getPathAsString()];e&&(r=this.updateMateConnectorOccurrence(n,e,!i))}}else this.fullElementIdToOccurrence.each((function(i,s){const n=this.elementAccessor.getPartStudio(s);if(n&&(r=n.getMateConnectorGraphics(e,t),r))return!0}),this);return r}getMateConnectorData(e,t){const i=this.getIdOccurrenceNodeId(e,t);let s=this.mateConnectorData[i];return s||this.fullElementIdToOccurrence.each((function(i,n){const r=this.elementAccessor.getPartStudio(n);if(r&&(s=r.getMateConnectorData(e,t),s))return!0}),this),s}getUIElementsForSelection(e){let i=[];if(e.isMateConnector())i=this.getMateConnectorGraphicsForSelection(e);else if(e.isSimulationLoad())i=this.loadDisplayManager.getUiElementsForSelection(e);else if(e.isMate())i=this.getMateIndicatorForSelection(e),0===i.length&&(i=this.callOnChildSelections(this.getUIElementsForSelection,e));else if(e.isMateRelation())i=this.callOnChildSelections(this.getUIElementsForSelection,e);else if(e.isFeature()&&e.getIdString()===h.BTAssemblyDefaultFeatures.ORIGIN_ID&&this.originGraphics&&i.push(this.originGraphics),e.getOccurrence()&&(e.isFromSketch()||e.isFromBody()||e.isOccurrence()||e.isAssemblyOrigin())){const s=l.CommandtoolbarModel.getCommandToolbarModel(),n=!!s&&s.inShowMatesOnSelectionMode;c.btInjector.ExplodedViewsService.inExplodedViewMode()||!n&&1!==t.CONSTANTS.getNumber("OCCURRENCE_MATE_HIGHLIGHT")&&!c.btInjector.NamedPositionPaneService.getIsInNamedPositionEditMode()||i.push.apply(i,this.getMateIndicatorsForOccurrence(e.getOccurrence()))}return i}getEntityIdsForSelection(e){let t=[];const i=e.getOccurrence();if(i){const s=this.occurrences[i.getPathAsString()];if(s){const i=this.elementAccessor.getPartStudio(s.fullElementId);i&&(t=i.getEntityIdsForSelection(e))}}return t}getOccurrenceEntityIdsForHighlight(e){let t=[];if(e){const i=this.occurrences[e.getPathAsString()];if(i){const s=this.elementAccessor.getPartStudio(i.fullElementId);s&&(t=t.concat(s.getOccurrenceEntityIdsForHighlight(e)))}}return t}getOccurrencesForSelection(e){let t=[];if(e.isMateConnector()){const i=this.getMateConnectorGraphicsForSelection(e);for(let e=0;e<i.length;++e)t.push(i[e].getOccurrence())}else if(e.isSimulationLoad()){const i=this.loadDisplayManager.getDisplayDataForSelection(e);i&&0===i.faceLoadDeterministicIds.length&&t.push(i.occurrence)}else e.isMate()||e.isMateRelation()||e.isNonGeometricItem()||e.isExplodeStep()||e.isFolder()?t=this.callOnChildSelections(this.getOccurrencesForSelection,e):e.getOccurrence()&&!e.isFeature()&&t.push(e.getOccurrence());return t}getDisplayDataForOccurrencePath(e){return this.occurrences[e]||null}hide(){if(this.isHidden_)return;const e=new r.Timer("bt.graphics.assembly.Assembly.prototype.hide");for(const e in this.mateConnectorGraphics)this.mateConnectorGraphics[e].remove();this.mateConnectorGraphics={},this.removeAllMateIndicators();for(const e in this.occurrences)this.removeOccurrenceFromPartStudio(this.occurrences[e],!1);this.removeOriginGraphics(),this.loadDisplayManager.hide(),this.isHidden_=!0,e.report()}show(e){if(!this.isHidden_)return;const t=new r.Timer("bt.graphics.assembly.Assembly.prototype.show",(0,m.getDisplayDataTimerLoggingOptions)());this.isHidden_=!1;let i=new r.Timer("Updating occurrences");for(const e in this.occurrences)this.addOrUpdateOccurrence(this.occurrences[e]);i.report(),i=new r.Timer("Updating mate indicators"),this.updateOriginMateConnectorVisibility();for(const e of this.mateIndicatorData.values())this.updateMateIndicatorGraphicsAndOccurrences(e);i.report(),this.createOriginGraphics(),this.loadDisplayManager.show(),e||this.viewer.setSuppressNonIsolatedPicks(!0),t.report()}get isHidden(){return this.isHidden_}getMateIndicatorData(e){return this.mateIndicatorData.get(e)}createOriginGraphics(){this.removeOriginGraphics(),this.isHidden_||!this.originDisplayData||this.isForInContext||(this.originGraphics=new m.OriginElement(this.originDisplayData,this.viewer))}removeOriginGraphics(){this.originGraphics&&(this.originGraphics.remove(),this.originGraphics=null)}reset(){let e;for(e in this.occurrences)this.removeOccurrenceFromPartStudio(this.occurrences[e],!1);this.occurrences={},this.fullElementIdToOccurrence.clear();for(const e in this.mateConnectorGraphics)this.mateConnectorGraphics[e].remove();for(const e in this.mateIndicatorGraphics)this.mateIndicatorGraphics[e].remove();this.mateConnectorGraphics={},this.mateConnectorData={},this.mateIndicatorData=new Map,this.mateIndicatorGraphics={},this.occurrenceMateIndicators={},this.occurrenceMateConnectors.clear(),this.cullableBodies=[],this.occurrencePrefixToLeaves={},this.removeOriginGraphics(),this.originDisplayData=null,this.ownerToInstanceMateIndicatorIds.clear(),this.mateIndicatorOwnerInstanceIds.clear(),this.mateConnectorMateIndicatorIds.clear(),this.mateIndicatorMateConnectorIds.clear(),this.ensureRootOccurrenceDisplayData(),this.loadDisplayManager.reset()}processSingleOccurrenceDeletion(e,t,i){if(e){let s=e;i&&e.fullElementId.equals(i.buildFullElementId(!0))&&(s=(0,g.shallowClone)(e),s.fullElementId=i.buildFullElementId(!1)),this.removeOccurrenceFromPartStudio(s,!0),this.removeOccurrenceElementAssociation(e),delete this.occurrences[t]}}processOccurrenceDeletions(e,t){let i;for(i=0;i<e.deletedOccurrences.length;++i)this.removeOccurrence(e.deletedOccurrences[i],t);if(!e.incremental){const e=Object.keys(this.occurrences);for(i=0;i<e.length;i++){const s=e[i],n=this.occurrences[s];this.processSingleOccurrenceDeletion(n,s,t)}}for(i=0;i<e.occurrences.length;++i){const s=e.occurrences[i];if(!s||!s.occurrenceData)continue;const n=s.occurrenceData.occurrence.toString(),r=this.occurrences[n];if(r){const i=e.getPartStudioDisplayDataForMicroversion(s.fullElementId),a=!t||e.partStudioDisplayData.length>0,o=i?i.buildFromFullElementId():s.fullElementId,c=!!i&&i.keepFromMicroversion,l=!r.fullElementId.equals(o)||c,h=r.partIds.some((function(e){return s.partIds.indexOf(e)<0}));(l||h)&&a?this.processSingleOccurrenceDeletion(r,n,t):this.removeOccurrenceElementAssociation(r)}}}updateOriginMateConnectorVisibility(){const e=this.occurrenceMateConnectors.get(""),t=new h.BTOccurrence;e&&e.each((function(e,i){const s=this.getMateConnectorGraphics(t,i,!0);return s&&s.updateOccurrenceVisibility(this.originDisplayData.hidden?m.Visibility.HIDDEN:m.Visibility.VISIBLE),!1}),this)}processDisplayData(e){const t=new r.Timer("Assembly.prototype.processDisplayData",(0,m.getDisplayDataTimerLoggingOptions)());if(this.elementId!==e.elementId)return void a.log.warn("Tried to update a graphics assembly with data corresponding to the wrong element id");let i,s;for(e.incremental||this.reset(),this.isForInContext=e.isForInContext,i=0;i<e.occurrences.length;++i)if(e.occurrences[i]){const t=e.occurrences[i],s=!0;this.addOrUpdateOccurrence(t,s)}for(i=0;i<e.mateConnectors.length;++i)if(e.mateConnectors[i]){const t=e.mateConnectors[i];this.updateMateConnector(t)}for(i=0;i<e.occurrences.length;++i)if(e.occurrences[i]){const t=e.occurrences[i];this.updateMateIndicators(t)}for(e.originDisplayData?this.originDisplayData=e.originDisplayData:e.incremental||a.log.warn("Null originDisplayData in non-incremental BTRootAssemblyDisplayData"),this.createOriginGraphics(),this.updateOriginMateConnectorVisibility(),i=0;i<e.mates.length;++i){const t=e.mates[i];t&&this.updateMateIndicator(t)}for(i=0;i<e.deletedMateIds.length;++i)s=e.deletedMateIds[i],this.removeMateWithId(s);for(i=0;i<e.deletedMateConnectorIds.length;++i)s=e.deletedMateConnectorIds[i],this.removeMateConnectorWithId(s);for(i=0;i<e.mateGroups.length;++i){const t=e.mateGroups[i];t&&this.updateMateIndicator(t)}for(i=0;i<e.deletedMateGroupIds.length;++i)s=e.deletedMateGroupIds[i],this.removeMateWithId(s);for(i=0;i<e.geometryMates.length;++i){const t=e.geometryMates[i];t&&this.updateMateIndicator(t)}for(i=0;i<e.deletedGeometryMateIds.length;++i)s=e.deletedGeometryMateIds[i],this.removeMateWithId(s);this.loadDisplayManager.processUpdates(e,!this.isHidden_),t.report()}ensureRootOccurrenceDisplayData(){const e=h.BTOccurrenceDisplayData.createRootOccurrenceDisplayData(this.elementId);this.addOrUpdateOccurrence(e)}addOrUpdateOccurrence(e,t){const i=e.getOccurrenceId(),s=this.occurrences[i];if(this.addOccurrenceElementAssociation(e),!this.isHidden){const t=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(i);this.viewer.getOccurrenceDataManager().setOccurrenceTransform(t,e.occurrenceData.transform.getGlMatrix());const n=this.elementAccessor.getPartStudio(e.fullElementId);n&&n.addOrUpdateOccurrence(t,e,!0),this.updateMateConnectorsForOccurrence(e),s&&s.isHidden===e.isHidden||this.trigger("OCCURRENCE_VISIBILITY_CHANGE."+i,e.isHidden?m.Visibility.HIDDEN:m.Visibility.VISIBLE)}this.addOccurrenceToPrefixMap(e.occurrenceData.occurrence),this.occurrences[i]=e,t||this.updateMateIndicators(e),this.trigger("OCCURRENCE_DATA_CHANGE."+i)}updateMateIndicators(e){const t=e.occurrenceData.occurrence.getPathAsString();this.updateOccurrenceMateIndicator(t)}updateUniqueMateIndicators(e){if(0===e.length)return;const t=[];e.forEach((function(e){const i=e.occurrenceData.occurrence.getPathAsString(),s=this.occurrenceMateIndicators[i];if(s)for(const e in s){if(t.includes(e))continue;t.push(e);const i=s[e].getDefinition();i&&this.updateMateIndicator(i)}}),this)}updateOccurrenceTransform(e,t){const i=[];i.push({pathId:e,transform:t}),this.batchUpdateOccurrenceTransforms(i)}batchUpdateOccurrenceTransforms(e){if(0===e.length)return!0;const t=[];if(!e.every((function(e){if(!this.occurrences)return a.log.warn("No occurrences property for this path transform pair."),!1;const i=this.occurrences[e.pathId],s=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(e.pathId);if(!i||s===m.INVALID_OCCURRENCE_ID)return a.log.warn('bad occurrence display data for pathId "'+e.pathId+'", graphics ID "'+s+'".'),!1;if(!this.isHidden_){const n=i.occurrenceData.transform.getGlMatrix();t.push({displayData:i,transform:n}),i.occurrenceData&&i.occurrenceData.transform&&i.occurrenceData.transform.updateFromGlMatrix(e.transform),e.transform&&this.viewer.getOccurrenceDataManager().setOccurrenceTransform(s,e.transform);const r=this.elementAccessor.getPartStudio(i.fullElementId);if(r){const e=!0;r.addOrUpdateOccurrence(s,i,e)}}return!0}),this))return!1;const i=t.map((function(e){return e.displayData}));return this.updateUniqueMateIndicators(i),i.forEach(T.prototype.updateMateConnectorsForOccurrence,this),t.forEach((function(e){e.displayData.occurrenceData.transform.updateFromGlMatrix(e.transform)})),!0}getOccurrenceDisplayData(e){return e&&this.occurrences[e.getPathAsString()]||null}addOccurrenceElementAssociation(e){this.fullElementIdToOccurrence.insertNested(e.fullElementId.toString(),e.getOccurrenceId(),!0)}removeOccurrenceElementAssociation(e){this.fullElementIdToOccurrence.removeNested(e.fullElementId.toString(),e.getOccurrenceId())}removeOccurrence(e,t){const i=e.getPathAsString(),s=this.occurrences[i];s&&(this.processSingleOccurrenceDeletion(s,i,t),this.removeMateConnectorsForOccurrence(s),this.removeOccurrenceFromPrefixMap(s.occurrenceData.occurrence),this.updateOccurrenceMateIndicator(i)),this.trigger("OCCURRENCE_DELETED."+i)}removeOccurrenceFromPartStudio(e,t){if(!e||this.isHidden_)return;const i=this.elementAccessor.getPartStudio(e.fullElementId),s=e.getOccurrenceId(),n=this.viewer.getOccurrenceIdManager().getIdForName(s);i&&n!==m.INVALID_OCCURRENCE_ID&&i.removeOccurrence(n,t),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(n),this.viewer.getOccurrenceIdManager().removeName(s)}getOccurrenceData(e){const t=this.occurrences[e];return t||null}getMateConnectorsForOccurrence(e){const t=[],i=this.occurrenceMateConnectors.get(e.getPathAsString());return i&&i.each((function(e,i){return t.push(e),!1}),this),t}getMateConnectorGraphicsForOccurrence(e,t){let i=[];const s=this.getMateConnectorsForOccurrence(e),n=this;for(let e=0;e<s.length;++e){const n=this.getMateConnectorGraphics(s[e].ownerOccurrence,s[e].nodeId,t);n&&(i=i.concat(n))}return this.fullElementIdToOccurrence.each((function(t,s){const r=n.elementAccessor.getPartStudio(s);return r&&function(t){i=i.concat(t.getAllMateConnectorGraphics(e))}(r),!1})),i}getMateConnectorIdsForOccurrence(e,t){const i=[];return Object.entries(this.mateConnectorData).forEach((function([s,n]){!(0,d.occurrencesEqual)(e,n.ownerOccurrence)||t&&n.implicit||i.push({Id:n.nodeId,isPartStudio:!1})})),i}getHideableSketchOccurrences(){const e=[];for(const t in this.occurrences){const i=this.occurrences[t];!i.isHidden&&i.displayedSketchEntityIds&&e.push(i.occurrenceData.occurrence)}return e}getSketchImagesForOccurrence(e){const t=this.getDisplayDataForOccurrence(e);if(!t)return[];const i=this.elementAccessor.getPartStudio(t.fullElementId);if(!i)return[];const s=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString());return i.getImageComponent().getDisplaysForOccurrence(s)}getInstanceMateIndicatorIdsFromOwner(e,t){const i=this.ownerToInstanceMateIndicatorIds.get(e);return i?i.get(t):void 0}getMateIndicatorsForOccurrence(e,t){const i=[],s=e.getTailNodeId();let n=e.getOccurrenceWithoutTail();!n.isRoot()&&h.BTParametricInstance.isOutputInstanceNodeId(s)&&(n=n.getOccurrenceWithoutTail());const r=this.getInstanceMateIndicatorIdsFromOwner(n.getPathAsString(),s);for(const e of new Set(r)){const s=this.getMateIndicatorGraphics(e,!t);s&&i.push(s)}return i}hasMateIndicatorForOccurrence(e){let t=e.getOccurrenceWithoutTail();const i=e.getTailNodeId();!t.isRoot()&&h.BTParametricInstance.isOutputInstanceNodeId(i)&&(t=t.getOccurrenceWithoutTail());const s=this.ownerToInstanceMateIndicatorIds.get(t.getPathAsString());if(s){const e=s.get(i);return!!e&&e.size>0}return!1}updateMateConnector(e){const t=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),i=this.mateConnectorData[t];i&&((0,d.occurrencesEqual)(i.occurrence,e.occurrence)||this.removeMateConnectorWithId(t)),this.mateConnectorData[t]=e;const s=e.occurrence.getPathAsString();this.occurrenceMateConnectors.insertNested(s,e.nodeId,e);const n=this.occurrences[s];this.updateMateConnectorOccurrence(e,n),this.updateMateConnectorMateIndicator(t)}updateMateConnectorMateIndicator(e){const t=this.mateConnectorMateIndicatorIds.get(e);if(t)for(const e of new Set(t).values()){const t=this.mateIndicatorData.get(e);t&&this.updateMateIndicator(t)}}updateOccurrenceMateIndicator(e){const t=this.occurrenceMateIndicators[e];if(t)for(const e in t)if(t[e]){const i=t[e].getDefinition();this.updateMateIndicator(i)}}shouldMateIndicatorBeRecreated(e){const t=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),i=this.mateIndicatorData.get(t);if(i&&e&&i.status===e.status&&i.getClassId()===e.getClassId()&&i.hidden===e.hidden&&(0,s.isEqual)(i.getMateConnectorIds(),e.getMateConnectorIds())&&(0,s.isEqual)(i.getOccurrenceIds(),e.getOccurrenceIds())){if(e instanceof h.BTMateDisplayData&&i instanceof h.BTMateDisplayData&&i.mateType!==e.mateType)return!0;const s=this.mateIndicatorGraphics[t];return!(!s||0!==s.mateIndicatorComponents.length)}return!0}updateMateIndicator(e){const t=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId);this.shouldMateIndicatorBeRecreated(e)&&this.removeMateWithId(t),this.mateIndicatorData.set(t,e),this.updateMateIndicatorGraphicsAndOccurrences(e)}separateOccurrenceAndFeatureId(e){const t=new h.BTOccurrence;let i=!1,s="";const n=e.split(h.BTOccurrence.OCCURRENCE_PATH_SEPARATOR);if(n.length>0)do{s=s?n.pop()+h.BTOccurrence.OCCURRENCE_PATH_SEPARATOR+s:n.pop(),t.path=n,i=this.occurrences.hasOwnProperty(t.getPathAsString())}while(!i&&n.length>0);return i?{occurrence:t,featureId:s}:null}updateMateIndicatorGraphicsAndOccurrences(e,t){if(this.isHidden_)return null;const i=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId),n=!!!this.mateIndicatorGraphics[i]&&!t&&e.hidden;let r=null,a=null;const o=[];let c=null;if(e instanceof h.BTMateDisplayData){const t=[],l=e.mateConnectorIds.length;c=e.mateConnectorIds;for(let i=0;i<l;++i){const s=this.separateOccurrenceAndFeatureId(e.mateConnectorIds[i]);if(!s)continue;const n=this.getMateConnectorData(s.occurrence,s.featureId);n&&(t.push(n),o.push(n.occurrence.getPathAsString()))}if(a=this.mateIndicatorGraphics[i],a){const e=a.getDefinitionOccurrenceIds(),n=(0,s.isEqual)(e,o);if(a.updateMateConnectorDisplayData(t),n)return a;this.removeOccurrenceMateIndicatorMapping(i,e),r=a}else n||(r=(0,m.createMateIndicator)(t,e,this.viewer))}else if(e instanceof h.BTMateGroupDisplayData){const t=[],c=e.occurrenceIds.length,l=[];for(let i=0;i<c;++i){o.push(e.occurrenceIds[i]);const s=this.occurrences[e.occurrenceIds[i]];s&&(t.push(s),l.push(e.occurrenceIds[i]))}if(a=this.mateIndicatorGraphics[i],a){const e=a.getDefinitionOccurrenceIds(),n=(0,s.isEqual)(e,o);if(a.updateOccurenceDisplayData(t),n)return a;this.removeOccurrenceMateIndicatorMapping(i,e),r=a}else n||(r=new m.MateGroupMateIndicator(t,e,this.viewer))}else if(e instanceof h.BTGeometryMateDisplayData)if(a=this.mateIndicatorGraphics[i],o.push(e.firstOccurrence.getPathAsString()),o.push(e.secondOccurrence.getPathAsString()),a){const t=a.getDefinitionOccurrenceIds(),n=(0,s.isEqual)(t,o);if(a.updateMateIndicatorDefinition(e),n)return a;this.removeOccurrenceMateIndicatorMapping(i,t),r=a}else n||(r=new m.Tangent(e,this.viewer));if(0===o.length)this.removeMateGraphicsWithId(i);else if(r){this.mateIndicatorGraphics[i]=r;const e=r.getDefinitionOccurrenceIds();for(let t=0;t<e.length;++t)this.addOccurrenceMateIndicator(e[t],i,r)}this.removeMappingsForMateIndicator(i);for(let t=0;t<o.length;++t){let s=e.ownerOccurrence;e.isDerivedFeature&&(s=s.getOccurrenceWithoutTail()),this.addOwnerOccurrenceMateIndicatorMapping(o[t],i,s)}if(c)for(let e=0;e<c.length;++e)this.addMateConnectorMateIndicatorMapping(c[e],i);return r}addOwnerOccurrenceMateIndicatorMapping(e,t,i){const s=e.split(h.BTOccurrence.OCCURRENCE_PATH_SEPARATOR).slice(i.path.length);let n="";s.length>0&&(n=s.length>1&&h.BTParametricInstance.isOutputInstanceNodeId(s[1])?s[1]:s[0]);const r=i.getPathAsString();let a=this.ownerToInstanceMateIndicatorIds.get(r);a||(a=new Map,this.ownerToInstanceMateIndicatorIds.set(r,a));let o=a.get(n);o||(o=new Set,a.set(n,o)),o.add(t);let c=this.mateIndicatorOwnerInstanceIds.get(t);c||(c=[],this.mateIndicatorOwnerInstanceIds.set(t,c)),c.push({owner:r,instance:n})}addMateConnectorMateIndicatorMapping(e,t){let i=this.mateConnectorMateIndicatorIds.get(e);i||(i=new Set,this.mateConnectorMateIndicatorIds.set(e,i)),i.add(t);let s=this.mateIndicatorMateConnectorIds.get(t);s||(s=new Set,this.mateIndicatorMateConnectorIds.set(t,s)),s.add(e)}removeMappingsForMateIndicator(e){const t=this.mateIndicatorOwnerInstanceIds.get(e);t&&t.forEach((t=>{const i=this.ownerToInstanceMateIndicatorIds.get(t.owner);if(i){const s=i.get(t.instance);s&&(s.delete(e),0===s.size&&i.delete(t.instance)),0===i.size&&this.ownerToInstanceMateIndicatorIds.delete(t.owner)}})),this.mateIndicatorOwnerInstanceIds.delete(e);const i=this.mateIndicatorMateConnectorIds.get(e);i&&i.forEach((t=>{const i=this.mateConnectorMateIndicatorIds.get(t);i&&(i.delete(e),0===i.size&&this.mateConnectorMateIndicatorIds.delete(t))})),this.mateIndicatorMateConnectorIds.delete(e)}updateMateConnectorsForOccurrence(e){const t=this.getMateConnectorsForOccurrence(e.occurrenceData.occurrence);for(let i=0;i<t.length;++i)this.updateMateConnectorOccurrence(t[i],e)}removeMateConnectorWithId(e){const t=this.mateConnectorData[e];t&&(delete this.mateConnectorData[e],this.occurrenceMateConnectors.removeNested(t.occurrence.getPathAsString(),t.nodeId),this.removeMateConnectorOccurrenceFromIds(t.nodeId,t.ownerOccurrence),this.updateMateConnectorMateIndicator(e),this.loadDisplayManager.processDeletedMateConnector(e))}removeOccurrenceMateIndicatorMapping(e,t){const i=this.mateIndicatorGraphics[e];if(i){t=t||i.getDefinitionOccurrenceIds();for(let i=0;i<t.length;++i)this.removeOccurrenceMateIndicator(t[i],e)}}removeMateGraphicsWithId(e){const t=this.mateIndicatorGraphics[e];t&&(this.removeOccurrenceMateIndicatorMapping(e),t.remove(),delete this.mateIndicatorGraphics[e])}removeMateWithId(e){this.removeMateGraphicsWithId(e),this.removeMappingsForMateIndicator(e),this.mateIndicatorData.delete(e)}removeMateConnectorsForOccurrence(e){const t=this.getMateConnectorsForOccurrence(e.occurrenceData.occurrence);for(let e=0;e<t.length;++e)this.removeMateConnectorOccurrenceFromIds(t[e].nodeId,t[e].ownerOccurrence)}updateMateConnectorOccurrence(e,t,i){if(this.isHidden_)return null;const s=this.getIdOccurrenceNodeId(e.ownerOccurrence,e.nodeId);let n=this.mateConnectorGraphics[s];return n||i||!(t&&t.isHidden||e.hidden)?(n?n.updateDefinition(e):this.mateConnectorGraphics[s]=n=new m.MateConnector(e,m.MAIN_SCENEGRAPH_ID,this.viewer),t?(n.setOccurrenceTransform(t.occurrenceData.transform.getGlMatrix()),n.updateOccurrenceVisibility(t.isHidden?m.Visibility.HIDDEN:m.Visibility.VISIBLE),n.setIsParentOccurrenceDataMissing(!1)):n.setIsParentOccurrenceDataMissing(!0),n):null}removeMateConnectorOccurrenceFromIds(e,t){const i=this.getIdOccurrenceNodeId(t,e),s=this.mateConnectorGraphics[i];s&&(s.remove(),delete this.mateConnectorGraphics[i])}removeAllMateIndicators(){for(const e in this.mateIndicatorGraphics)this.mateIndicatorGraphics[e].remove();this.occurrenceMateIndicators={},this.mateIndicatorGraphics={}}addOccurrenceMateIndicator(e,t,i){e in this.occurrenceMateIndicators||(this.occurrenceMateIndicators[e]={}),this.occurrenceMateIndicators[e][t]=i;const s=this.viewer.getIsolatedOccurrenceManager().getIsolatedOccurrences();if(s&&s.length>0)for(let t=0;t<s.length;t++)s[t].getPathAsString()===e&&i.getOccurrenceData().setIsolated(!0)}removeOccurrenceMateIndicator(e,t){e in this.occurrenceMateIndicators&&this.occurrenceMateIndicators[e][t]&&delete this.occurrenceMateIndicators[e][t]}getDisplayDataForOccurrence(e){return e&&this.occurrences[e.getPathAsString()]||null}getOccurrenceVisibility(e){const t=this.getDisplayDataForOccurrence(e);return!t||t.isHidden?m.Visibility.HIDDEN:m.Visibility.VISIBLE}addOrRemoveOccurrenceInPrefixMap(e,t){const i=e.getPathAsString();for(let s=0;s<e.path.length;s++){const n=e.path.slice(0,s+1).join(".");this.occurrencePrefixToLeaves[n]||(this.occurrencePrefixToLeaves[n]=new p.StringSet),t?this.occurrencePrefixToLeaves[n].add(i):this.occurrencePrefixToLeaves[n].remove(i)}}addOccurrenceToPrefixMap(e){this.addOrRemoveOccurrenceInPrefixMap(e,!0)}removeOccurrenceFromPrefixMap(e){this.addOrRemoveOccurrenceInPrefixMap(e,!1)}getLeafOccurrencesContainedWithinOccurrence(e){const t=[];if(e)if(e.isAssemblyRoot())(0,s.each)(this.occurrences,(e=>t.push(e.occurrenceData.occurrence)));else{const i=this.occurrencePrefixToLeaves[e.getPathAsString()];i&&i.each((e=>{const i=this.occurrences[e];i&&i.occurrenceData&&t.push(i.occurrenceData.occurrence)}))}return t}getOccurrenceBounds(e){const t=this.getLeafOccurrencesContainedWithinOccurrence(e);let i=null;return t.forEach((e=>{const t=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString()),s=this.getOccurrenceDisplayData(e);if(s&&t!==m.INVALID_OCCURRENCE_ID){const e=this.elementAccessor.getPartStudio(s.fullElementId);if(e){const s=e.getOccurrenceBounds(t);s&&s.isFinite()&&(i||(i=new m.BoundingBox),i.addBox(s))}}})),i}getBodyComponent(e){const t=this.getOccurrenceDisplayData(e);if(t){const e=this.elementAccessor.getPartStudio(t.fullElementId);if(e)return e.bodyComponent}return null}getBodyBounds(e,t){const i=this.getOccurrenceDisplayData(t);if(i){const s=this.elementAccessor.getPartStudio(i.fullElementId);if(s){const n=s.getBodyBounds(e,t);if(n)return n.createTransformedCopy(i.occurrenceData.transform.getGlMatrix())}}return null}getCachedOccurrenceState(e){let t=this.cachedOccurrenceState[e];return t||(this.cachedOccurrenceState[e]=t=new I),t}clearCachedOccurrenceState(){this.cachedOccurrenceState={}}getBoundsOutsideElementNode(){const e=new m.BoundingBox;if(this.originGraphics&&e.addBox(this.originGraphics.getBounds()),this.mateConnectorGraphics)for(const t in this.mateConnectorGraphics)this.mateConnectorGraphics[t].isHidden||e.addPoint(this.mateConnectorGraphics[t].worldSpacePosition);return this.fullElementIdToOccurrence.each((function(t,i){const s=this.elementAccessor.getPartStudio(i);return null!==s&&e.addBox(s.mateConnectorComponent.getVisibleMateConnectorBounds()),!1}),this),e.isInitialized()&&e.isFinite()?e:null}getMateIndicatorConnectivityMap(e){const t=new u.TemplatedNestedMap;for(const i of this.mateIndicatorData.values()){if(i.status===h.GBTAssemblyFeatureDisplayStatus.SUPPRESSED)continue;const s=i.getOccurrences(this);for(const i of s){const n=i.trimToTopLevel().getPathAsString(),r=i.getPathAsString();if(e.has(r))for(const e of s){const i=e.getPathAsString();n!==i&&t.insertNested(r,i,e)}}}return t}getElementType(){return h.GBTElementType.ASSEMBLY}setExplodeViewActive(e){this.loadDisplayManager.setExplodeViewActive(e)}setEditState(e,t){this.loadDisplayManager.setEditState(e,t)}getOccurrences(){return this.occurrences}setAreOccurrencesClippedBySectionPlaneExcept(e,t){for(const t in this.occurrences){const i=this.viewer.getOccurrenceIdManager().getIdForName(t),s=this.viewer.getOccurrenceDataManager().getOccurrenceData(i);s&&s.setIsClippedBySectionPlanes(e)}for(const i of t)this.setAllLeafOccurrencesClippedForOccurrence(h.BTOccurrence.getOccurrenceFromPathString(i),!e)}setAllLeafOccurrencesClippedForOccurrence(e,t){const i=this.getLeafOccurrencesContainedWithinOccurrence(e);if(i){for(const e of i){if(!this.occurrences[e.getPathAsString()]){a.log.debug("Did not find occurrence data for leaf occurrence "+e.getPathAsString()+" in assembly "+this.elementId);continue}const i=this.viewer.getIdForOccurrence(e),s=this.viewer.getOccurrenceDataManager().getOccurrenceData(i);s&&s.setIsClippedBySectionPlanes(t)}const e=this.viewer.getModelViewManagers().getManager().getSimulationManager();e&&e.onSectionSetChanged()}}enterMateHideMode(e){const t=new Set;e.forEach((e=>{const i=new h.BTOccurrence;i.path=e.path;const s=this.getIdOccurrenceNodeId(i,e.featureId);t.add(s)}));for(const e in this.mateIndicatorGraphics){this.mateIndicatorGraphics[e].updateHiddenMode(!t.has(e))}}exitMateHideMode(){for(const e in this.mateIndicatorGraphics){this.mateIndicatorGraphics[e].updateHiddenMode(!1)}}}t.Assembly=T},124664:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BodyComponent=t.isNodeForSurfaceBody=t.PART_EDGE_NODE_PROPERTIES=t.SHEET_FACE_NODE_PROPERTIES_TRANSPARENT=t.SHEET_FACE_NODE_PROPERTIES=t.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT=t.MESH_EDGE_NODE_PROPERTIES=t.SCALAR_VISUALIZATION_FACE_SURFACE_NODE_PROPERTIES=t.SCALAR_VISUALIZATION_FACE_SOLID_NODE_PROPERTIES=t.applySmoothEdgesRenderingStyleChanges=t.SOLID_FACE_NODE_PROPERTIES=t.BodyComponentId=void 0;const s=i(545348),n=i(912057),r=i(606544),a=i(759382),o=i(736234),c=i(573879),l=i(315689),h=i(772687),d=i(873896),u=i(870232),g=i(114924),p=i(264292),m=i(613199);var E,I;!function(e){e[e.ALL_OPAQUE=0]="ALL_OPAQUE",e[e.OPAQUE_BODY_TRANSPARENT_FACE=1]="OPAQUE_BODY_TRANSPARENT_FACE",e[e.TRANSPARENT_BODY_OPAQUE_FACE=2]="TRANSPARENT_BODY_OPAQUE_FACE",e[e.ALL_TRANSPARENT=3]="ALL_TRANSPARENT"}(E||(E={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT"}(I||(I={}));const T=s.default.getManager();t.BodyComponentId="body_component.";const S=new g.Material({}),f=new g.Material({color:T.getColor("LINE_POINT_COLOR")}),C=new g.Material({color:T.getColor("MESH_FACET_EDGE_COLOR"),lineWidth:T.getNumber("MESH_FACET_EDGE_LINE_WIDTH")}),P=new g.Material({shininess:T.getNumber("MESH_SHININESS"),specularColor:T.getColor("MESH_SPECULAR"),ambientFactor:T.getNumber("MESH_AMBIENT_FACTOR"),diffuseFactor:T.getNumber("MESH_DIFFUSE_FACTOR")});t.SOLID_FACE_NODE_PROPERTIES=new g.NodeProperties({material:S,zOffset:T.getNumber("PART_FACES_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0});const v=[0,0,0,0];let D=T.getStipple("DEFAULT_LINE_STIPPLE"),M=T.getColor("LINE_POINT_COLOR"),y=T.getNumber("DEFAULT_LINE_WIDTH");t.applySmoothEdgesRenderingStyleChanges=function(e){e===r.GBTSmoothEdgeStyle.PHANTOM?(D=T.getStipple("SMOOTH_EDGE_STIPPLE"),y=T.getNumber("SMOOTH_EDGE_LINE_WIDTH")):(D=T.getStipple("DEFAULT_LINE_STIPPLE"),y=T.getNumber("DEFAULT_LINE_WIDTH")),M=e===r.GBTSmoothEdgeStyle.HIDDEN?v:e===r.GBTSmoothEdgeStyle.PHANTOM?T.getColor("SMOOTH_EDGE_PHANTOM_COLOR"):T.getColor("LINE_POINT_COLOR")},t.SCALAR_VISUALIZATION_FACE_SOLID_NODE_PROPERTIES=new g.NodeProperties({material:S,zOffset:T.getNumber("PART_FACES_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0,isVisible:!1}),t.SCALAR_VISUALIZATION_FACE_SURFACE_NODE_PROPERTIES=t.SCALAR_VISUALIZATION_FACE_SOLID_NODE_PROPERTIES.cloneAndModify({zOffset:s.default.getManager().getNumber("SURFACE_Z_OFFSET"),isTwoSided:!0});const O=t.SOLID_FACE_NODE_PROPERTIES.cloneAndModify({isTwoSided:!0}),_=new g.NodeProperties({material:S,zOffset:T.getNumber("NON_MODIFIABLE_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0,addsToSectionMask:!1,primitivesHaveTransparency:!0,isTwoSided:!0}),A=new g.NodeProperties({material:S,zOffset:T.getNumber("NON_MODIFIABLE_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,includedInBlend:!0,clippedBySectionPlanes:!0,primitivesHaveTransparency:!0}),R=new g.NodeProperties({material:P,zOffset:T.getNumber("PART_FACES_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,includedInBlend:!0,clippedBySectionPlanes:!0});R.cloneAndModify({primitivesHaveTransparency:!0}),R.cloneAndModify({isTwoSided:!0}).cloneAndModify({primitivesHaveTransparency:!0});t.MESH_EDGE_NODE_PROPERTIES=new g.NodeProperties({material:C,zOffset:T.getNumber("PART_EDGES_Z_OFFSET"),primitiveType:g.PrimitiveType.LINES,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1}),t.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT=new g.NodeProperties({material:S,zOffset:T.getNumber("PART_FACES_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,primitivesHaveTransparency:!0,includedInBlend:!0,clippedBySectionPlanes:!0,isTwoSided:!0}),t.SHEET_FACE_NODE_PROPERTIES=new g.NodeProperties({material:S,zOffset:T.getNumber("SURFACE_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,includedInBlend:!0,clippedBySectionPlanes:!0}),t.SHEET_FACE_NODE_PROPERTIES_TRANSPARENT=new g.NodeProperties({material:S,zOffset:T.getNumber("SURFACE_Z_OFFSET"),primitiveType:g.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,includedInBlend:!0,clippedBySectionPlanes:!0,primitivesHaveTransparency:!0}),t.PART_EDGE_NODE_PROPERTIES=new g.NodeProperties({material:f,zOffset:T.getNumber("PART_EDGES_Z_OFFSET"),primitiveType:g.PrimitiveType.LINES,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0});const N=t.PART_EDGE_NODE_PROPERTIES.cloneAndModify({zOffset:T.getNumber("SURFACE_EDGES_Z_OFFSET")}),w=t.PART_EDGE_NODE_PROPERTIES.cloneAndModify({zOffset:T.getNumber("WIRE_EDGES_Z_OFFSET"),addsToBounds:!0}),b=t.PART_EDGE_NODE_PROPERTIES.cloneAndModify({zOffset:T.getNumber("NON_MODIFIABLE_Z_OFFSET_EDGE")}),L=N.cloneAndModify({zOffset:T.getNumber("NON_MODIFIABLE_Z_OFFSET_EDGE")}),B=w.cloneAndModify({zOffset:T.getNumber("NON_MODIFIABLE_Z_OFFSET_EDGE")}),F=new g.Material({color:T.getColor("LINE_POINT_COLOR")});F.lineStipple=T.getStipple("CENTER_LINE_STIPPLE");const x=w.cloneAndModify({material:F}),U=new g.NodeProperties({material:f,zOffset:T.getNumber("PART_POINTS_Z_OFFSET"),primitiveType:g.PrimitiveType.POINTS,isVisible:!1,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0}),G=U.cloneAndModify({zOffset:T.getNumber("SURFACE_POINTS_Z_OFFSET")}),V=U.cloneAndModify({zOffset:T.getNumber("WIRE_POINTS_Z_OFFSET")}),H=new g.NodeProperties({material:f,zOffset:T.getNumber("PART_EDGES_Z_OFFSET"),primitiveType:g.PrimitiveType.SILHOUETTES,addsToBounds:!1,includedInBlend:!0,clippedBySectionPlanes:!0});t.isNodeForSurfaceBody=function(e){return e.getZOffset()===t.SHEET_FACE_NODE_PROPERTIES.zOffset||e.getZOffset()===A.zOffset};const k={};function W(e,t){let i=k[e];if(!i){i=new g.Style;const s=[t.color[0]/255,t.color[1]/255,t.color[2]/255,t.opacity/255];i.setAttribute(g.Attributes.COLOR,s),k[e]=i}return i}function z(e){if(e){const t=e.getAttribute(g.Attributes.COLOR);if(t)return t[3]<1}return!1}const j=new g.IdManager;let X=!1,q=!1;class Y extends g.AssemblyEnabledPartStudioComponent{constructor(e,t,i,s){super(e,s,i),this.bodyLoadTasks=t,this.bodyMetaData={},this.lastSetBodyColor={},this.subBodyStyleOverrides=new l.TemplatedNestedMap,this.entityStyles={},this.cachedBodyTransparencyState={},this.partStudioBodyIdToOccurrenceId={},this.cullableBodies=null,this.instantiatedTriangleCount=-1,this.sheetMetalOrderIdToTransform={},this.previewClone=null,this.baseComponent=null,this.bodiesHiddenInBase=new Set,this.tessellationSettings={},this.partTriangleCounts={},this.bodiesWithUpdatedMeshReferences=new Set,this.scalarVisualizationOccurrences=new Set,this.node=e.getModelViewManager().getSharedBodyNode(),this.collectionId=j.getId(),this.knownBodyIds=new Set,this.occurrenceAlphaModifiers=new Map,this.bodyVisibility=new l.TemplatedNestedMap,this.bodyToOccurrenceId=new l.TemplatedNestedMap,this.unavailableBodyOccurrences=new l.TemplatedNestedMap,this.silhouetteCallback=(e,t)=>{this.onSilhouetteCreated(e,t)},this.decalComponent=new g.DecalComponent(this,e)}getCollectionId(){return this.collectionId}getNode(){return this.node}getDecalComponent(){return this.decalComponent}getBodyIds(e=(()=>!0)){const t=[];for(const i of Object.keys(this.bodyMetaData))e(this.bodyMetaData[i])&&t.push(i);return t}getEntityIds(e){const t=[];for(const i in this.idToMetaData)e(this.idToMetaData[i])&&t.push(i);return t}getCorrectedBodyOccurrenceId(e,t){return t&&t!==g.PART_STUDIO_ELEMENT_ID||(t=this.partStudioBodyIdToOccurrenceId[e]),t}getBodyToOccurrenceId(){return this.bodyToOccurrenceId}copyBodyDataToClone(e){let t;for(t in e.bodyLoadTasks=this.bodyLoadTasks,this.bodyMetaData)e.bodyMetaData[t]=this.bodyMetaData[t].clone();for(t in e.knownBodyIds=new Set(this.knownBodyIds),this.lastSetBodyColor)e.lastSetBodyColor[t]=this.lastSetBodyColor[t].slice(0);this.subBodyStyleOverrides.eachNested(((t,i,s)=>{e.subBodyStyleOverrides.insertNested(i,s,t.clone())})),e.tessellationSettings=(0,o.clone)(this.tessellationSettings),e.partTriangleCounts=(0,o.clone)(this.partTriangleCounts),e.entityStyles=(0,o.clone)(this.entityStyles)}clone(e){this.bodyLoadTasks.completeTasks();const t=new Y(e,this.bodyLoadTasks,this.usage,this.viewer);return this.copyBodyDataToClone(t),this.copyToClone(t),this.decalComponent.copyToClone(t.decalComponent),t}cloneForPreview(e){const t=new Y(e,this.bodyLoadTasks,g.BTGraphicsUsage.PREVIEW,this.viewer);this.copyToPreview(t),this.copyBodyDataToClone(t),Object.entries(this.occurrences).forEach((([e,i])=>{!i&&(t.occurrences[e]=i)})),this.bodyToOccurrenceId.eachNested(((e,i,s)=>{t.occurrences.hasOwnProperty(s)&&t.bodyToOccurrenceId.insertNested(i,s,e)})),this.unavailableBodyOccurrences.eachNested(((e,i,s)=>{t.occurrences.hasOwnProperty(s)&&t.unavailableBodyOccurrences.insertNested(i,s,e)}));for(const e in this.bodyMetaData)t.refreshBodyOccurrences(e);return this.previewClone=t,t.baseComponent=this,t.decalComponent=this.decalComponent.cloneForPreview(t,e),t}onPreviewDestroyed(){this.previewClone=null}copyVisibility(e){e.bodyVisibility.eachNested(((e,t,i)=>(this.hideShowBody(i,e,+t),!1)))}getBodyLoadTasks(){return this.bodyLoadTasks}getTessellationSettings(){return this.tessellationSettings}getPartTriangleCounts(){return this.partTriangleCounts}damageInstantiatedTriangleCount(){this.instantiatedTriangleCount=-1}getInstantiatedTriangleCount(){if(this.instantiatedTriangleCount<0){this.instantiatedTriangleCount=0;const e=this.getMeshManager(),t=this.getMeshOwnerId();this.bodyToOccurrenceId.each((function(i,s){if(i&&!i.isEmpty()){const n=e.getGroupRangesForGroupTypeAndLod(s,t,g.PrimitiveType.TRIANGLE_STRIP,g.Lod.DEFAULT);n&&(this.instantiatedTriangleCount+=i.size()*n.getPrimitiveCount())}return!1}),this)}return this.instantiatedTriangleCount}hasDisplayedEdgesWithOutdatedSmoothnessInfo(){let e=!1;return this.bodyToOccurrenceId.each(((t,i)=>{const s=this.bodyToEntity.get(i);return s&&s.each(((t,i)=>{const s=this.idToMetaData[i];return s&&s.isEdge()&&(s.getEdgeSmoothnessStatus()===r.GBTEntityEdgeSmoothnessStatus.UNKNOWN||s.getEdgeSmoothnessStatus()===r.GBTEntityEdgeSmoothnessStatus.SMOOTH)&&(e=!0),e})),e})),e}getEstimatedMemoryUsage(){let e=0;for(const t in this.bodyMetaData){this.bodyMetaData[t].isClosedCompositeConstituent||(e+=this.bodyMetaData[t].getEstimatedMemoryUsage())}return e}retrieveBodyMetaData(e){return this.bodyMetaData[e]||null}getBodyDiameter(e){const t=this.bodyMetaData[e];return t?t.getBounds().diameter():0}isBodyIsolated(e,t){const i=this.getOccurrenceDataForBody(e,t);return!!i&&i.getIsolated()}isBodyVisible(e,t){const i=this.getOccurrenceDataForBody(e,t);return!!i&&i.getVisibility()!==g.Visibility.HIDDEN}getOccurrenceDataForBody(e,t){let i=this.bodyMetaData[t];if(i&&i.isClosedComposite&&!i.isGroupableCompositeBody){let e=null;for(let t=0;t<i.constituentBodyIds.length&&!e;++t)e=this.bodyMetaData[i.constituentBodyIds[t]];i=e}return this.getBodyOccurrenceData(i.meshGroupId,e)}isBodyInstantiated(e){const t=this.bodyMetaData[e];if(!t)return!1;if(!t.isNonGroupingCompositeBody)return this.bodyToOccurrenceId.has(t.meshGroupId);for(let e=0;e<t.constituentBodyIds.length;++e)if(this.bodyToOccurrenceId.has(t.constituentBodyIds[e]))return!0}getNonInstantiatedBodies(){const e=[];for(const t in this.bodyMetaData){this.bodyMetaData[t].isClosedCompositeConstituent||(this.isBodyInstantiated(t)||e.push(this.bodyMetaData[t]))}return e}getComponentId(){return t.BodyComponentId}reset(){this.bodyToOccurrenceId.eachNested((function(e,t,i){return this.removeBodyOccurrence(i,t),!1}),this),this.unavailableBodyOccurrences.clear(),this.bodyLoadTasks.clearAllBodiesForComponent(this),this.bodyMetaData={},this.tessellationSettings={},this.knownBodyIds.clear(),this.lastSetBodyColor={},this.partStudioBodyIdToOccurrenceId={},this.sheetMetalOrderIdToTransform={},this.entityStyles={},this.subBodyStyleOverrides.clear(),this.decalComponent.destroy(),this.decalComponent=new g.DecalComponent(this,this.parent),this.damageInstantiatedTriangleCount(),super.reset()}updateBodyDisplayData(e,t){var i;const s=new h.StringSet;for(const t in e.deterministicPartIdToData){const s=e.deterministicPartIdToData[t];if(s.isDeletion)null===(i=this.parent.bodyIdsThatAreInsertableBuffers)||void 0===i||i.delete(t),delete this.tessellationSettings[t],delete this.partTriangleCounts[t];else{this.tessellationSettings[t]=s.tessellationSettings;const e=new r.BTPartTriangleCounts;e.coarsePlanarFaceTriangleCount=s.coarsePlanarFaceTriangleCount,e.coarseTriangleCount=s.coarseTriangleCount,e.totalEntityCount=s.totalEntityCount,this.partTriangleCounts[t]=e}}this.knownBodyIds=new Set;for(let i=0;i<e.partDisplayData.length;++i){const r=e.partDisplayData[i].id;this.knownBodyIds.add(r);const a=e.deterministicPartIdToData[r];if(a){if(this.viewer.getIsForFlattenedDisplay()!==a.isForFlattenedView()){if(this.viewer.getIsForFlattenedDisplay())continue;r in this.partStudioBodyIdToOccurrenceId&&this.removeBodyOccurrence(g.PART_STUDIO_ELEMENT_ID,r)}}else if(!this.bodyMetaData.hasOwnProperty(r))continue;if(s.add(r),!t||e.deterministicPartIdToData.hasOwnProperty(r)){let s=-1;t&&(0,g.isRetrievalDebuggingEnabled)()&&this.bodyMetaData[r]&&null!==this.bodyMetaData[r].getFinestTessellationSettingOnClient()&&(s=this.bodyMetaData[r].getFinestTessellationSettingOnClient());const a=e.deterministicPartIdToData[r],o=e.partDisplayData[i];if(o||n.log.warn("Missing expected BTPartDisplayData"),this.updateBodyMetaData(e,r,o,a),t&&(0,g.isRetrievalDebuggingEnabled)()){const e=this.bodyMetaData[r],t=(e.getEstimatedMemoryUsage()-e.getEstimatedMemoryUsage([s]))/1024/1024;t>T.getNumber("SINGLE_BODY_MEMORY_CHANGE_INFO_THRESHOLD_MB")&&n.log.info("Memory change for "+r+" to go to "+e.getFinestTessellationSettingOnClient()+": "+t+"MB")}}const o=this.bodyMetaData[r];if(o.isClosedComposite)for(let e=0;e<o.constituentBodyIds.length;++e)this.knownBodyIds.add(o.constituentBodyIds[e]),s.add(o.constituentBodyIds[e])}let a=null;for(const e in this.bodyMetaData)s.contains(e)||(this.removeBodyOccurrence(g.PART_STUDIO_ELEMENT_ID,e),this.bodyMetaData[e].removeOpenCompositeBodyReferences(this.bodyMetaData),delete this.bodyMetaData[e],delete this.lastSetBodyColor[e],this.subBodyStyleOverrides.remove(e),a||(a=new h.StringSet),a.add(e));a&&this.bodyLoadTasks.clearBodiesForComponent(this,a)}processDeletions(e){let t,i;for(const s in e.deterministicPartIdToData){const n=e.deterministicPartIdToData[s];for(let s=0;s<n.entityDIds.length;++s)i=n.entityDIds[s],t=e.deterministicIdToEntity[i],t&&!this.handlesEntity(t,n)&&this.removeEntity(i)}for(i in e.deterministicIdToEntity)t=e.deterministicIdToEntity[i],t.isDeletion()&&(delete this.entityStyles[i],this.removeEntity(i))}updatePSOI(e){for(const t in e.detIdToPSOIIncrement)this.bodyMetaData[t]&&(this.bodyMetaData[t].partIdentity=e.detIdToPSOIIncrement[t])}unloadBody(e){const t=this.bodyMetaData[e];if(!t)return;t.setIsTessellationLoaded(!1),t.tessellationSettings=[];const i=this.bodyToEntity.get(e);if(i&&i.each((function(e,t){return this.removeEntity(t),!1}),this),this.tessellationSettings[e]=[r.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING],this.damageInstantiatedTriangleCount(),t.isClosedComposite)for(let e=0;e<t.constituentBodyIds.length;++e)this.unloadBody(t.constituentBodyIds[e])}removeBaseIncrement(e){if(this.baseComponent){const t=this.baseComponent.idToMetaData[e];if(t){const i=this.baseComponent.getEntityBodyGroupId(t),s=this.baseComponent.bodyToOccurrenceId.get(i);s&&s.each((function(t,i){return this.removeBaseIncrementFromOccurrence(e,i),!1}),this)}}}onBaseSilhouetteAdded(e,t,i){const s=this.bodyToOccurrenceId.get(i);s&&s.each((function(i,s){return this.wasIncrementRemovedFromBase(e,s)&&this.hideBaseIncrement(t,s),!1}),this)}processAdditionsAndChanges(e,t,i){let s;for(s in this.updateBodyDisplayData(e,i),this.updateEntityAppearanceOverrides(e),this.processPrecompiledGraphicsBuffers(e.partIdAndTessellationSettingToBuffers),e.deterministicPartIdToData){const t=e.deterministicPartIdToData[s],i=this.bodyMetaData[s];if(!i)continue;const n=i.getIsTessellationLoaded(),r=i.canEntitiesBeLoaded();if(this.viewer.areOptimizedBuffersEnabled){if(!e.partIdAndTessellationSettingToBuffers[s])continue;this.refreshBodyOccurrences(s)}else for(let a=0;a<t.entityDIds.length;++a){const o=t.entityDIds[a],c=e.deterministicIdToEntity[o];if(!c||this.handlesEntity(c,t))if(c){const e=(0,g.getMeshIncrementForEntityData)(c,o,this.getEntityIdManager().getOrCreateIdForName(o));if(!e)continue;e.groupId=i.meshGroupId,c.setBodyMetaData(i),c.setMeshIncrement(e),this.removeOldEntityGraphics(o,c),this.addIdMappings(o,c,s),n&&this.updateEntityGraphics(o,e,c),this.viewer.getIsForFlattenedDisplay()===t.isForFlattenedView()&&c.removeGeometry()}else r&&this.changeEntityOwner(o,s)}n||i.isClosedCompositeConstituent||!i.canEntitiesBeLoaded()||this.bodyLoadTasks.postBodyToLoad(this,s)}this.updateBodiesWithChangedMeshReferences(),this.decalComponent.update(e),this.deterministicIdToAssociatedFeatureIds=e.deterministicIdToAssociatedFeatureIds,this.featureIdToAssociatedDeterministicIds={};for(const[e,t]of Object.entries(this.deterministicIdToAssociatedFeatureIds))for(const i of t){let t=this.featureIdToAssociatedDeterministicIds[i];t||(t=[],this.featureIdToAssociatedDeterministicIds[i]=t),t.push(e)}t&&this.addPartStudioOccurrences()}getBodyType(e){const t=this.bodyMetaData[e];if(t)return t.type;const i=this.parent.getEntitiesForBody(e);for(let e=0;i&&e<i.length;e++){const t=this.parent.retrieveEntityMetaData(i[e]);if(t&&t instanceof r.BTPointEntity)return r.GBTBodyType.POINT}return null}accumulateSketchIdsFromBodyId(e,t){this.parent.sketchComponent.accumulateSketchIdsFromBodyId(e,t)}updateCompositeConstituentCounts(e){for(let t=0;t<e.partDisplayData.length;t++){const i=e.partDisplayData[t].id,s=this.bodyMetaData[i];s&&s.isComposite&&s.updateConstituentTypeCounts(this)}}handlesEntity(e,t){const i=t&&this.viewer.getIsForFlattenedDisplay()&&!t.isForFlattenedView();return!e.hasTessellationError()&&e.isFromBody()&&!i}updateEntityAppearanceOverrides(e){for(const t in e.appearanceIdToAppearanceOverride){const i=e.appearanceIdToAppearanceOverride[t],s=t===r.BTGraphicsAppearance.RESET_APPEARANCE_ID?null:W(t,i.appearance);for(let e=0;e<i.entityDeterministicIds.length;++e){const t=i.entityDeterministicIds[e];if(s?this.entityStyles[t]=s:delete this.entityStyles[t],this.containsEntity(t)){const e=this.getMeshIncrementDetails(t)||this.getBaseMeshIncrementDetails(t);e&&(this.removeEntityAppearanceOverride(e),s&&this.incorporateEntityAppearanceOverride(e))}}}}getNodePropertiesForFace(e,i,s){const n=s===I.TRANSPARENT;return e.containsOnlySheetBodies()?e.isModifiableBody()?n?t.SHEET_FACE_NODE_PROPERTIES_TRANSPARENT:t.SHEET_FACE_NODE_PROPERTIES:A:e.isModifiableBody()?n?t.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT:i!==E.ALL_OPAQUE?O:t.SOLID_FACE_NODE_PROPERTIES:_}getNodePropertiesForEdge(e){return e.getIsBendCenterLineBody()?x:e.containsOnlyWireBodies()?e.isModifiableBody()?w:B:e.containsOnlySheetBodies()?e.isModifiableBody()?N:L:e.isModifiableBody()?t.PART_EDGE_NODE_PROPERTIES:b}getNodePropertiesForPoint(e){return e.containsOnlyWireBodies()?V:e.containsOnlySheetBodies()?G:U}getGroupBoundsForEntity(e){const t=this.getEntityBodyGroupId(e),i=this.bodyMetaData[t];if(!i){const i=e.getEntityType();return n.log.info(`Could not find bodyMetaData for entityType ${i} and entityBodyGroupId ${t} while fetching group bounds for entity`),null}return i.getBounds()}addMeshIncrementAndSilhouettes(e,t){const i=this.getGroupBoundsForEntity(t),s=super.addMeshIncrement(e,i);this.incorporateEntityAppearanceOverride(s),this.addMeshTriangleEdges(e,t);e.primitiveType===g.PrimitiveType.TRIANGLE_STRIP&&!t.isPlanar()&&this.viewer.getSilhouetteTask().postSilhouetteRequest(e,this.usage,this.silhouetteCallback),this.damageInstantiatedTriangleCount()}addMeshTriangleEdges(e,t){if(t.isFace()&&(X||t.getSurfaceType()===r.GBTSurfaceType.MESH)){const i=Y.getMeshEdgeId(e.id),s=(0,g.createEdgesFromTriangleStrip)(e,i);if(s){s.groupId=Y.getMeshEdgeId(this.getEntityBodyGroupId(t));const e=this.getGroupBoundsForEntity(t);this.getMeshManager().addMeshIncrement(s,this.getMeshOwnerId(),e)}}}onSilhouetteCreated(e,t){const i=e.id,s=this.idToMetaData[i];s&&s.getIncrementGloballyUniqueId()===e.getGloballyUniqueId()&&t&&(t.groupId=e.groupId,this.getMeshManager().addMeshIncrement(t,this.getMeshOwnerId()),this.previewClone&&this.previewClone.onBaseSilhouetteAdded(i,t.id,e.groupId),this.viewer.requestDraw())}static getMeshEdgeId(e){return-1!==e.indexOf(Y.MESH_EDGE_GROUP_SUFFIX,e.length-Y.MESH_EDGE_GROUP_SUFFIX.length)?e:e+Y.MESH_EDGE_GROUP_SUFFIX}static getPotentialMeshGroupIdsForBody(e){return[e,e+Y.MESH_EDGE_GROUP_SUFFIX]}callBaseVisibilityMethodForIncrementAndDerivations(e,t,i){const s=e.call(this,t,i);e.call(this,(0,g.getSilhouettesId)(t),i);const n=Y.getMeshEdgeId(t);return n!==t&&e.call(this,n,i),s}showMeshIncrement(e,t){this.callBaseVisibilityMethodForIncrementAndDerivations(g.PartStudioComponent.prototype.showMeshIncrement,e,t)}hideMeshIncrement(e,t){this.callBaseVisibilityMethodForIncrementAndDerivations(g.PartStudioComponent.prototype.hideMeshIncrement,e,t)}hideBaseIncrement(e,t){return this.callBaseVisibilityMethodForIncrementAndDerivations(g.PartStudioComponent.prototype.hideBaseIncrement,e,t)}showBaseIncrement(e,t){this.callBaseVisibilityMethodForIncrementAndDerivations(g.PartStudioComponent.prototype.showBaseIncrement,e,t)}refreshEntityGraphics(e,t){let i=this.idToMetaData[e];i&&(this.removeMeshIncrement(e),this.removeBaseIncrement(e),i=i.cloneForNewBody(t),this.idToMetaData[e]=i,this.updateEntityGraphics(e,i.getMeshIncrement(),i))}removeMeshIncrement(e){const t=g.PartStudioComponent.prototype.removeMeshIncrement.apply(this,arguments);super.removeMeshIncrement((0,g.getSilhouettesId)(e)),t&&(this.viewer.getSilhouetteTask().removePendingRequest(t.increment,this.usage),this.removeEntityAppearanceOverride(t));const i=Y.getMeshEdgeId(e);return i!==e&&g.PartStudioComponent.prototype.removeMeshIncrement.call(this,i),this.damageInstantiatedTriangleCount(),t}incorporateEntityAppearanceOverride(e){let t=!1;const i=e.increment.groupId,s=this.entityStyles[e.increment.id];if(s){const n=z(s)?I.TRANSPARENT:I.OPAQUE;let r=this.subBodyStyleOverrides.getNested(i,n);r||(r=new g.IncrementRanges(i+" "+(n===I.OPAQUE?"opaque":"transparent")+" entity style overrides",i),this.subBodyStyleOverrides.insertNested(i,n,r),t=!0),r.onIncrementAdded(e,s)}t&&this.bodiesWithUpdatedMeshReferences.add(i)}removeEntityAppearanceOverride(e){let t=!1;const i=e.increment.groupId,s=this.subBodyStyleOverrides.get(i);s&&s.each(((s,n)=>{s.onIncrementRemoved(e)&&s.isEmpty()&&(s.destroy(),this.subBodyStyleOverrides.removeNested(i,n),t=!0)})),t&&this.bodiesWithUpdatedMeshReferences.add(i)}damageComputedBodyTransparency(e){delete this.cachedBodyTransparencyState[e]}getComputeBodyTransparency(e){if(this.cachedBodyTransparencyState.hasOwnProperty(e))return this.cachedBodyTransparencyState[e];const t=this.getBodyColor(e)[3]<1,i=this.bodyMetaData[e];let s=[e];i&&i.isClosedComposite&&(s=i.constituentBodyIds);let n=0,r=0;for(let e=0;e<s.length;++e){const t=this.bodyToEntity.get(s[e]);t&&t.each(((e,t)=>{const i=this.entityStyles[t];return i&&(z(i)?++n:++r),n>0&&r>0}))}let a=E.ALL_OPAQUE;return t&&r>0?a=E.TRANSPARENT_BODY_OPAQUE_FACE:!t&&n>0?a=E.OPAQUE_BODY_TRANSPARENT_FACE:t&&(a=E.ALL_TRANSPARENT),this.cachedBodyTransparencyState[e]=a,a}getHideableFeatureIds(){return[]}hideShowFeature(e,t,i){this.featureVisibility[e]=t;const s=this.getEntitiesForFeature(e);if(!s)return;const n=new h.StringSet;for(let e=0;e<s.length;++e){const t=this.idToMetaData[s[e]];let r=t?t.getBodyMetaData():void 0;r.isClosedCompositeConstituent&&(r=r.consumingClosedCompositeData),r&&!r.isModifiableBody()&&i&&n.add(r.id)}n.each((function(e){this.hideShowBody(e,t,g.PART_STUDIO_ELEMENT_ID)}),this)}updateEdgeSmoothness(e){let t=0;for(const i in this.idToMetaData){const s=this.idToMetaData[i];if(s.isEdge()&&(s.isFromSolidBody()||s.isFromSheetBody())){e.hasOwnProperty(i)||++t;const n=s.getGeometry();e[i]&&!s.isFromWireBody()?n.edgeSmoothnessStatus=r.GBTEntityEdgeSmoothnessStatus.SMOOTH_V2:n.edgeSmoothnessStatus=r.GBTEntityEdgeSmoothnessStatus.NOT_SMOOTH}}t>0&&n.log.warn("Did not find edge smoothness data for "+t+" edges")}updateEntityGraphics(e,t,i){t.pickId=this.getEntityIdManager().getOrCreateIdForName(e);const s=i.getEdgeSmoothnessStatus();s!==r.GBTEntityEdgeSmoothnessStatus.SMOOTH&&s!==r.GBTEntityEdgeSmoothnessStatus.SMOOTH_V2||((0,g.addStyleToIncrement)(D,t),(0,g.addColorToIncrement)(M,t),(0,g.addSizeToIncrement)(y,t)),!this.parent.getIsMissingTangencyInformationMessageShown()&&this.viewer.getSmoothEdgesRenderStyle()!==r.GBTSmoothEdgeStyle.VISIBLE&&i.isEdge()&&i.getEdgeSmoothnessStatus()===r.GBTEntityEdgeSmoothnessStatus.UNKNOWN&&(this.parent===this.parent.getModelViewManager().getDisplayedPartStudio()?this.parent.getModelViewManager().updateSmoothEdgesForDisplayedPartStudio():(this.viewer.showTangencyInformationMissingMessage(),this.parent.setIsMissingTangencyInformationMessageShown(!0),setTimeout((()=>{this.viewer.setSmoothEdgesRenderStyle(r.GBTSmoothEdgeStyle.VISIBLE)}),0))),t.groupId=this.getEntityBodyGroupId(i),this.addMeshIncrementAndSilhouettes(t,i)}instantiateForPartStudio(e){g.PartStudioComponent.prototype.instantiateForPartStudio.apply(this,arguments),this.addPartStudioOccurrences()}removePartStudioInstantiation(e){this.usage===g.BTGraphicsUsage.PREVIEW&&g.PartStudioComponent.prototype.removePartStudioInstantiation.apply(this,arguments),this.removeOccurrence(g.PART_STUDIO_ELEMENT_ID,!1)}isBodyLoaded(e){const t=this.bodyMetaData[e];return!!t&&t.getIsTessellationLoaded()}processBodyAddition(e,t){const i=this.bodyMetaData[e];if(i&&i.isClosedComposite){for(let e=0;e<i.constituentBodyIds.length;++e)this.isBodyLoaded(i.constituentBodyIds[e])||this.processBodyAddition(i.constituentBodyIds[e],t);return i.setIsTessellationLoaded(!0),this.decalComponent.onBodyLoaded(),!0}if(this.isBodyLoaded(e)&&n.log.warn("The same body occurrence was loaded twice"),!this.viewer.areOptimizedBuffersEnabled){const i=this.bodyToEntity.get(e);if(!i)return!0;i.each((function(e,i){const s=this.idToMetaData[i];if(!s||!s.meshIncrement)return!1;t&&t.addVertexCost(s.meshIncrement.vertexCount()),this.updateEntityGraphics(i,s.meshIncrement,s)}),this)}if(i&&i.setIsTessellationLoaded(!0),this.damageInstantiatedTriangleCount(),this.getBodyManager().damageUnloadedBodyBounds(),this.partStudioBodyIdToOccurrenceId.hasOwnProperty(e)){const t=this.viewer.getOccurrenceDataManager().getOccurrenceData(this.partStudioBodyIdToOccurrenceId[e]);t&&t.clearAllOccurrenceLevelHighlights()}return this.updateBodiesWithChangedMeshReferences(),this.decalComponent.onBodyLoaded(),!0}addBodyOccurrence(e,t,i,s){if(this.bodyToOccurrenceId.hasNested(t,e)&&!i)return;const r=this.bodyMetaData[t];if(!r)return void(s||this.unavailableBodyOccurrences.insertNested(t,e,!0));this.bodyToOccurrenceId.insertNested(t,e,!0);const a=this.getBodyOccurrenceData(t,e);if(!a)return void n.log.warn("Tried to add occurrence without occurrence data");const o=this.getBodyColor(t,e),c=new g.Style;r.containsOnlyWireBodies()&&c.setAttribute(g.Attributes.COLOR,o),this.addBodyOccurrenceFromMeshManager(this.getMeshManager(),e,a,t,r,o,c),this.getSharedBaseMeshManager()&&!this.bodiesHiddenInBase.has(t)&&this.addBodyOccurrenceFromMeshManager(this.getSharedBaseMeshManager(),e,a,t,r,o,c),this.scalarVisualizationOccurrences.has(a.getOccurrenceId())||this.decalComponent.addOrUpdateOccurrence(t,e),i||this.damageInstantiatedTriangleCount()}addBodyOccurrenceFromMeshManager(e,i,s,n,r,a,o){if(r.hasFaces()){const t=new g.Style;t.setAttribute(g.Attributes.COLOR,a);const c=r.getChordalTolerance();null!==c?t.setFloatUniform("uChordalTolerance",c):t.setFloatUniform("uChordalTolerance",d.Tolerances.MAX_MODEL_SIZE);const l=this.occurrenceAlphaModifiers.has(i)?E.ALL_TRANSPARENT:this.getComputeBodyTransparency(n);switch(l){case E.ALL_OPAQUE:this.addFaceRangesToOccurrenceNode(e,r,s,t,l,I.OPAQUE);break;case E.ALL_TRANSPARENT:this.addFaceRangesToOccurrenceNode(e,r,s,t,l,I.TRANSPARENT);break;default:this.addFaceRangesToOccurrenceNode(e,r,s,t,l,I.OPAQUE),this.addFaceRangesToOccurrenceNode(e,r,s,t,l,I.TRANSPARENT)}const h=e.getOrCreateGroupRangesForGroupTypeAndLod(n,this.getMeshOwnerId(),g.PrimitiveType.SILHOUETTES,g.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(H,s,o,h)}if((X||r.containsMesh())&&!this.scalarVisualizationOccurrences.has(s.getOccurrenceId())){const i=Y.getMeshEdgeId(r.id),n=e.getOrCreateGroupRangesForGroupTypeAndLod(i,this.getMeshOwnerId(),g.PrimitiveType.LINES,g.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(t.MESH_EDGE_NODE_PROPERTIES,s,o,n)}if(r.hasEdges())if(this.viewer.areOptimizedBuffersEnabled)this.addOrUpdateBodyOccurrenceBufferSetToNode(this.node,e,n,s,o,this.getNodePropertiesForEdge(r));else{const t=e.getOrCreateGroupRangesForGroupTypeAndLod(n,this.getMeshOwnerId(),g.PrimitiveType.LINES,g.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(this.getNodePropertiesForEdge(r),s,o,t)}if(r.hasPoints()){const t=e.getOrCreateGroupRangesForGroupTypeAndLod(n,this.getMeshOwnerId(),g.PrimitiveType.POINTS,g.Lod.DEFAULT);this.node.addOccurrenceGeometryToNode(this.getNodePropertiesForPoint(r),s,o,t)}}addFaceRangesToOccurrenceNode(e,i,s,n,r,a){const o=i.id;let c;if(c=this.scalarVisualizationOccurrences.has(s.getOccurrenceId())?i.containsOnlySheetBodies()?t.SCALAR_VISUALIZATION_FACE_SURFACE_NODE_PROPERTIES:t.SCALAR_VISUALIZATION_FACE_SOLID_NODE_PROPERTIES:this.getNodePropertiesForFace(i,r,a),this.viewer.areOptimizedBuffersEnabled)this.addOrUpdateBodyOccurrenceBufferSetToNode(this.node,e,o,s,n,c);else{const t=e.getOrCreateGroupRangesForGroupTypeAndLod(o,this.getMeshOwnerId(),g.PrimitiveType.TRIANGLE_STRIP,g.Lod.DEFAULT);let i,l=null,h=this.getSubBodyStyleOverrides(o,s.getOccurrenceId(),a);r===E.ALL_OPAQUE||r===E.ALL_TRANSPARENT?i=t:r===E.OPAQUE_BODY_TRANSPARENT_FACE?a===I.OPAQUE?(i=t,l=this.subBodyStyleOverrides.getNested(o,I.TRANSPARENT)):(i=this.subBodyStyleOverrides.getNested(o,I.TRANSPARENT),h=null):r===E.TRANSPARENT_BODY_OPAQUE_FACE&&(a===I.TRANSPARENT?(i=t,l=this.subBodyStyleOverrides.getNested(o,I.OPAQUE)):(i=this.subBodyStyleOverrides.getNested(o,I.OPAQUE),h=null)),i&&this.node.addOccurrenceGeometryToNode(c,s,n,i,h,l)}}getSubBodyStyleOverrides(e,t,i){if(this.occurrenceAlphaModifiers.has(t)){const i=this.subBodyStyleOverrides.getNested(e,I.OPAQUE),s=this.subBodyStyleOverrides.getNested(e,I.TRANSPARENT);let n;if(i&&s){const e=new g.StyleUnionOperator;e.setOperandA(i),e.setOperand(s),n=e}else i?n=i:s&&(n=s);if(n){const e=this.occurrenceAlphaModifiers.get(t),i=new g.StyleModificationOperator((0,g.getAlphaModifierFunction)(e));return i.setOperand(n),i}return null}return this.subBodyStyleOverrides.getNested(e,i)}getPartStudioBodyOccurrenceName(e){return Y.PART_STUDIO_BODY_OCCURRENCE_PREFIX+"."+this.getMeshOwnerId()+"."+e}removeBodyOccurrence(e,t,i){e=this.getCorrectedBodyOccurrenceId(t,e);const s=Y.getPotentialMeshGroupIdsForBody(t);for(let t=0;t<s.length;++t)this.node.removeMeshGroupFromOccurrence(s[t],e);if(this.decalComponent.removeOccurrence(e,t),!i){if(e===this.partStudioBodyIdToOccurrenceId[t]){let i=!1;const s=this.baseComponent||this.previewClone;s&&(i=s.partStudioBodyIdToOccurrenceId.hasOwnProperty(t)),i||(this.viewer.getOccurrenceDataManager().destroyOccurrenceData(e),this.viewer.getOccurrenceIdManager().removeName(this.getPartStudioBodyOccurrenceName(t))),delete this.partStudioBodyIdToOccurrenceId[t]}this.bodyToOccurrenceId.removeNested(t,e),this.unavailableBodyOccurrences.removeNested(t,e),this.damageInstantiatedTriangleCount(),this.contributesToBodyManager()&&this.getBodyManager().removeOccurrence(e,t)}}refreshAllBodyOccurrences(){this.bodyToOccurrenceId.eachNested((function(e,t,i){return this.refreshBodyOccurrence(+i,t),!1}),this)}refreshBodyOccurrence(e,t){this.removeBodyOccurrence(e,t,!0),this.addBodyOccurrence(e,t,!0)}refreshBodyOccurrenceForBodyId(e){this.refreshBodyOccurrence(this.partStudioBodyIdToOccurrenceId[e],e)}refreshBodyOccurrences(e,t){if(t){const t=this.partStudioBodyIdToOccurrenceId[e];t&&this.refreshBodyOccurrence(t,e)}else{const t=this.bodyToOccurrenceId.get(e);t&&t.each((function(t,i){return this.refreshBodyOccurrence(i,e),!1}),this)}}refreshOccurrence(e){const t=this.occurrences[e];t&&t.displayedPartIds.forEach((t=>{this.refreshBodyOccurrence(e,t)}))}updateBodiesWithChangedMeshReferences(){for(const e of this.bodiesWithUpdatedMeshReferences)this.damageComputedBodyTransparency(e),this.refreshBodyOccurrences(e);this.bodiesWithUpdatedMeshReferences.clear()}getInstantiableConstituentIds(e){if(e.isGroupableCompositeBody)throw new Error("Cannot instantiate constituents of grouped composites");if(e.isClosedComposite)return e.constituentBodyIds;const t=new Set;for(let i=0;i<e.constituentBodyIds.length;++i){const s=e.constituentBodyIds[i],n=this.bodyMetaData[s];n&&n.isClosedCompositeConstituent&&n.consumingClosedCompositeData.isGroupableCompositeBody?t.add(n.consumingClosedCompositeData.id):t.add(s)}return Array.from(t)}addOrUpdateOccurrence(e,t){if(!t)return;const i=new Set;for(let e=0;e<t.partIds.length;++e){const s=t.partIds[e],n=this.bodyMetaData[s];if(n&&n.isNonGroupingCompositeBody){const e=this.getInstantiableConstituentIds(n);for(let t=0;t<e.length;++t){const s=e[t];this.knownBodyIds.has(s)&&i.add(s)}}else this.knownBodyIds.has(s)&&i.add(s)}t.displayedPartIds=i;const s=this.occurrences[e]?this.occurrences[e].displayedPartIds:new Set,n=(0,g.setSubtract)(i,s),r=(0,g.setSubtract)(s,i);if((n.size>0||this.occurrences[e])&&super.addOrUpdateOccurrence(e,t),this.updateOccurrenceParts(e,t,n,r),i.size>0&&this.contributesToBodyManager()){const t=this.getBodyManager();i.forEach((s=>{const n=this.bodyMetaData[s],r=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(e);n&&t.addOrUpdateOccurrence(e,r,n,i.size)}))}}addPartStudioOccurrences(){for(const e in this.bodyMetaData)this.addPartStudioOccurrenceForBodyId(e);this.updateFlattenedBodyLayout()}addPartStudioOccurrenceForBodyId(e){const t=this.getBodyManager(),i=this.bodyMetaData[e];let s=this.partStudioBodyIdToOccurrenceId[e];if(i.isForFlattenedView()!==this.viewer.getIsForFlattenedDisplay()||i.isNonGroupingCompositeBody||i.canBeGroupedWithOtherConstituents)s&&(this.removeBodyOccurrence(s,e),delete this.partStudioBodyIdToOccurrenceId[e]);else{if(!s){s=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.getPartStudioBodyOccurrenceName(e));const n=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(s);if(this.partStudioBodyIdToOccurrenceId[e]=s,this.addBodyOccurrence(s,e),this.contributesToBodyManager()){const e=1;t.addOrUpdateOccurrence(s,n,i,e)}this.hideShowBody(e,i.partStudioVisibility,g.PART_STUDIO_ELEMENT_ID)}super.addOrUpdateOccurrence(this.partStudioBodyIdToOccurrenceId[e],null)}}updateOccurrenceParts(e,t,i,s,n){s.forEach((t=>{this.removeBodyOccurrence(e,t),this.damageInstantiatedTriangleCount()})),i.forEach((t=>{this.addBodyOccurrence(e,t,!1,n),this.damageInstantiatedTriangleCount()})),t.displayedPartIds.forEach((i=>{this.hideShowBody(i,t.isHidden?g.Visibility.HIDDEN:g.Visibility.VISIBLE,e)}))}reloadOccurrences(){const e=new Set;let t;for(t in this.occurrences){if(t=+t,g.PART_STUDIO_ELEMENT_ID===t){n.log.warn("The part studio occurrence should not be reloaded");continue}const i=this.occurrences[t];if(i){const s=!0;this.updateOccurrenceParts(t,i,i.displayedPartIds,e,s)}}}removeOccurrence(e,t){const i=this.occurrences[e];if(i||e===g.PART_STUDIO_ELEMENT_ID){if(i)i.displayedPartIds.forEach((t=>this.removeBodyOccurrence(e,t)));else for(const e in this.partStudioBodyIdToOccurrenceId)this.removeBodyOccurrence(this.partStudioBodyIdToOccurrenceId[e],e);super.removeOccurrence(e,t)}}changeEntityOwner(e,t){const i=this.idToMetaData[e];if(!i)return void(q||(n.log.error("Metadata for entity "+e+" owner "+t+" that is trying to switch between bodies was not found"),q=!0));if(!i.isFromBody())return void n.log.error("Trying to switch entity to a part that did not belong to a part in the first place");if(i.getBodyId()===t)return;this.removeMeshIncrement(e),this.removeIdMappings(e);const s=this.bodyMetaData[t];if(!s)return void n.log.error("Failed to find body metadata for body: "+t);const r=i.cloneForNewBody(s);r.getMeshIncrement()?(this.addIdMappings(e,r,t),this.updateEntityGraphics(e,r.getMeshIncrement(),r)):n.log.error("Failed to find mesh increment for a body entity")}refreshSmoothEdges(){for(const e in this.idToMetaData){const t=this.idToMetaData[e],i=t.getEdgeSmoothnessStatus();i!==r.GBTEntityEdgeSmoothnessStatus.SMOOTH&&i!==r.GBTEntityEdgeSmoothnessStatus.SMOOTH_V2||this.refreshEntityGraphics(e,t.getBodyMetaData())}}getBodyIdsWithConstituentsInScenegraph(e){const t=new Set(e);for(const i of e){const e=this.bodyMetaData[i];if(e&&e.isNonGroupingCompositeBody&&e.constituentBodyIds)for(const i of e.constituentBodyIds)t.add(i)}return t}setIsBodyClippedBySectionPlane(e,t,i,s){if(i){const i=this.getBodyOccurrenceData(e,this.partStudioBodyIdToOccurrenceId[e]);return void(i&&i.setIsClippedBySectionPlanes(t))}const n=this.getBodyIdsWithConstituentsInScenegraph(new Set([e])),r=s?this.getBodyIdsWithConstituentsInScenegraph(s):null;for(const e of n)r&&r.has(e)||this.setIsBodyClippedBySectionPlane(e,t,!0)}setAreOccurrencesClippedBySectionPlaneExcept(e,t){for(const t in this.bodyMetaData)this.setIsBodyClippedBySectionPlane(t,e);for(const i of t)this.setIsBodyClippedBySectionPlane(i,!e)}updateBodyMetaData(e,t,i,s,a,o,c){let l,h=this.bodyMetaData[t],d=!1,u=!1,p=null;h?l=h.consumingClosedCompositeData?h.consumingClosedCompositeData.id:"":(h=new g.BodyMetaData(t),this.bodyMetaData[t]=h);let m=!1;if(void 0!==l){m=l!==(o?o.id:"")}const E=h.type,I=h.meshState,T=h.isGroupableCompositeBody;if(h.setColorCycle(this.parent.getPartColorCycle()),i){h.name=i.name,h.meshState=i.meshState;let e=r.GBTBodyType.SOLID;i.isSheet?e=r.GBTBodyType.SHEET:i.isWire&&(e=r.GBTBodyType.WIRE),h.type=e,h.isModifiable!==i.isModifiable&&this.bodyVisibility.removeNested(this.partStudioBodyIdToOccurrenceId[t],t),h.isModifiable=i.isModifiable,h.setAppearanceFromDisplayData(i),h.isActiveSheetMetal=i.isActiveSheetMetal;const s=i.customProperties.properties[r.BTPartCustomProperties.TESSELLATION_SETTING_PROPERTY_ID];s&&(h.tessellationSettingOverride=+s),h.consumingClosedCompositeData&&(m=!0),h.consumingClosedCompositeData=null,p=new g.BoundingBox(i.lowBoxCorner.getVec3(),i.highBoxCorner.getVec3())}else h.setAppearanceFromDisplayData(a),h.consumingClosedCompositeData=o,s&&(h.type=s.closedConstituentPartData.bodyType,h.isActiveSheetMetal=s.closedConstituentPartData.isActiveSheetMetal,h.meshState=s.closedConstituentPartData.meshState,p=new g.BoundingBox(s.lowBoxCorner.getVec3(),s.highBoxCorner.getVec3()));if(s){const i=h.getFinestTessellationSettingOnClient();h.sheetMetalModelId=s.sheetMetalModelId,h.isFlattenedSheetMetalBody=s.isFlattenedSheetMetalBody,h.isBendCenterLineBody=s.isBendCenterLineBody,h.ownerFlattenedBodyId=s.ownerFlattenedBodyId,h.tessellationSettings=e.getPartTessellationSettings(t),h.sheetMetalOrderId=s.sheetMetalOrderId,s.hasTessellationComplexityInformation&&(h.coarseTriangleCount=s.coarseTriangleCount,h.coarsePlanarFaceTriangleCount=s.coarsePlanarFaceTriangleCount),h.isAssociatedWithFlat=s.isAssociatedWithFlat,h.totalEntityCount=s.totalEntityCount,h.bestAvailableTessellationSetting=s.bestAvailableTessellationSetting,null!==i&&h.getFinestTessellationSettingOnClient()!==i&&(u=!0),h.isComposite=s.isComposite,h.isClosedComposite=s.isClosedComposite,h.updateConstituentBodyIds(s.constituentBodyDeterministicIds,this.bodyMetaData)}if(h&&h.isComposite&&!this.viewer.areOptimizedBuffersEnabled&&h.updateDataDerivedFromConstituents(this.bodyMetaData,e.deterministicPartIdToData),p&&!p.equals(h.bounds)&&(h.bounds=p,h.resetMeshIncrement(),d=!0),h&&h.isClosedComposite){i||n.log.warn("Expected to have display data for parent composite, but none was present");const t=null;for(let s=0;s<h.constituentBodyIds.length;++s){const n=h.constituentBodyIds[s],r=e.deterministicPartIdToData[n];this.updateBodyMetaData(e,n,t,r,i,h,T)}}if(m=m||"boolean"==typeof c&&c!==h.canBeGroupedWithOtherConstituents,m){this.baseComponent&&this.bodiesHiddenInBase.add(h.meshGroupId);const e=this.bodyToEntity.get(t);e&&(e.each(((e,t)=>{this.refreshEntityGraphics(t,h)})),h.setIsTessellationLoaded(h.canEntitiesBeLoaded()))}(E!==h.type||u||I!==h.meshState)&&this.refreshBodyOccurrences(t),this.updateBodyColor(t),d&&this.updateBodyManagerReferencesForBody(t);const S=this.unavailableBodyOccurrences.get(t);S&&(S.each(((e,i)=>(this.addBodyOccurrence(+i,t),!1))),this.unavailableBodyOccurrences.remove(t))}getBodyColor(e,t){const i=this.bodyMetaData[e],s=i?i.getColor():(0,g.convertRGBA255ToRGBA)(a.LATEST_COLOR_CYCLE[0]);return this.occurrenceAlphaModifiers.has(t)&&(s[3]*=this.occurrenceAlphaModifiers.get(t)),s}getFaceColor(e,t){const i=this.idToMetaData[e];if(!i)return null;const s=this.entityStyles[e];if(s){let e=s.getAttribute(g.Attributes.COLOR);return this.occurrenceAlphaModifiers.has(t)&&(e=e.slice(),e[3]*=this.occurrenceAlphaModifiers.get(t)),e}return this.getBodyColor(i.getBodyId(),t)}setBodyOpacity(e,t,i){const s=this.bodyMetaData[e];s&&(s.appearance||(s.appearance=new r.BTGraphicsAppearance),s.appearance.color&&(s.appearance.opacity=t,this.updateBodyColor(e,i)))}setBodyColor(e,t,i){const s=this.bodyMetaData[e];if(s&&(s.appearance||(s.appearance=new r.BTGraphicsAppearance),s.appearance.color&&(s.appearance.color=t,this.updateBodyColor(e,i)),s.isComposite&&s.constituentBodyIds))for(let e=0;e<s.constituentBodyIds.length;++e)this.setBodyColor(s.constituentBodyIds[e],t,i)}updateBodyColor(e,t){const i=this.getBodyColor(e);(0,c.arraysEqual)(this.lastSetBodyColor[e],i)||(this.lastSetBodyColor[e]=i,this.damageComputedBodyTransparency(e),this.refreshBodyOccurrences(e,t))}getOccurrenceColor(e){const t=this.viewer.getOccurrenceIdManager().getIdForName(e.toString());if(t===g.INVALID_OCCURRENCE_ID)return null;const i=this.occurrences[t];if(!i)return null;for(const e of i.displayedPartIds){const i=this.getBodyColor(e,t);if(i)return i.slice(0)}return null}setOccurrenceAlphaModifier(e,t){if(t<0||t>=1)return void n.log.warn("Only alpha modifiers in the range [0, 1) are accepted");const i=this.viewer.getOccurrenceIdManager().getIdForName(e.toString());i!==g.INVALID_OCCURRENCE_ID&&(this.occurrenceAlphaModifiers.set(i,t),this.refreshOccurrence(i))}clearOccurrenceAlphaModifier(e){const t=this.viewer.getOccurrenceIdManager().getIdForName(e.toString());t!==g.INVALID_OCCURRENCE_ID&&this.occurrenceAlphaModifiers.delete(t)&&this.refreshOccurrence(t)}getEntityColor(e){const t=this.entityStyles[e];if(t){const e=t.getAttribute(g.Attributes.COLOR);if(e)return e.slice()}const i=this.idToMetaData[e];return i?this.getBodyColor(i.getBodyId()):null}getOccurrenceBounds(e){const t=new g.BoundingBox,i=this.occurrences[e];return i&&i.displayedPartIds.forEach((i=>{t.addBox(this.getBodyManager().getOccurrenceBounds(e,i))})),t}getEntityBodyGroupId(e){const t=e.getBodyId(),i=this.bodyMetaData[t];return i?i.meshGroupId:t}setScalarVisualizationOccurrence(e,t){this.scalarVisualizationOccurrences.add(e),t?this.refreshBodyOccurrence(e,t):this.refreshOccurrence(e)}clearScalarVisualizationOccurrence(e,t){this.scalarVisualizationOccurrences.delete(e),t&&e?this.refreshBodyOccurrence(e,t):e&&this.refreshOccurrence(e)}clearAllScalarVisualizationOccurrences(){this.scalarVisualizationOccurrences=new Set,this.refreshAllBodyOccurrences()}isVisualizingOccurrences(){return this.scalarVisualizationOccurrences.size>0}updateEntityHighlight(e,t,i,s){const n=this.idToMetaData[i];if(!n)return!1;const r=this.getEntityBodyGroupId(n);if((s=this.getCorrectedBodyOccurrenceId(r,s))===g.INVALID_OCCURRENCE_ID||!s)return!1;const a=this.bodyMetaData[n.getBodyId()];if(a&&a.isForFlattenedView()){if(!(a.sheetMetalModelId===this.viewer.getModelViewManagers().getManager().getSelectedSheetmetalModelId())&&!this.isOccurrenceIdForAssembly(s))return!1}return g.PartStudioComponent.prototype.updateEntityHighlight.call(this,e,t,i,s)}getBodyOccurrenceData(e,t){return(t=this.getCorrectedBodyOccurrenceId(e,t))!==g.INVALID_OCCURRENCE_ID&&t&&this.bodyToOccurrenceId.hasNested(e,t)?this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(t):null}hideShowBody(e,t,i){var s,n;let r=!1;const a=this.bodyMetaData[e];if(a&&a.isClosedComposite&&!a.isGroupableCompositeBody)for(let e=0;e<a.constituentBodyIds.length;++e)r=this.hideShowBody(a.constituentBodyIds[e],t,i)||r;!i&&a&&(a.partStudioVisibility=t);const o=this.getBodyOccurrenceData(e,i);return o&&o.getVisibility()!==t&&(o.setVisibility(t),this.viewer.requestDraw(),r=!0),r&&(null===(n=null===(s=(0,u.getActiveSketchCreationController)())||void 0===s?void 0:s.getInferenceSetController())||void 0===n||n.updateInferencingOnPartVisibilityChange(e,t)),r}setBodyCullingState(e,t,i,s){const n=this.getBodyOccurrenceData(i,e);if(n&&n.getMeshGroupCullingState(i)!==t){const r=Y.getPotentialMeshGroupIdsForBody(i);for(let e=0;e<r.length;++e)n.setCullingState(t,r[e]);t!==g.CullingState.CULLED&&s?this.decalComponent.addOrUpdateOccurrence(i,e):this.decalComponent.removeOccurrence(e,i),this.viewer.requestDraw()}}isEntityHidden(e,t){const i=this.getBodyOccurrenceData(this.getEntityBodyGroupId(e),t);return!!i&&i.getVisibility()===g.Visibility.HIDDEN}getBodyDisplay(e){const t=this.bodyMetaData[e];return t?t.meshIncrement?t.meshIncrement:t.isSolidBody()||t.isSheetBody()?(t.meshIncrement=(0,g.createBox)(t.getBounds().getMin(),t.getBounds().getMax()),t.meshIncrement.id=e,t.meshIncrement.groupId=e,t.meshIncrement.lod=g.Lod.LOWEST,t.meshIncrement.pickId=this.getEntityIdManager().getOrCreateIdForName(e),t.meshIncrement):null:null}getOccurrenceIdForEntity(e){let t;if(this.idToMetaData[e]&&this.idToMetaData[e]instanceof r.BTBodyEntity){const i=this.idToMetaData[e];i.bodyMetaData&&(t=this.partStudioBodyIdToOccurrenceId[i.bodyMetaData.id])}return t}getStatistics(e,t=!1){const i={faces:0,triangles:0,edges:0,lines:0,vertices:0,silhouettes:0,settingCounts:{},uniqueParts:0,uniqueSurfaces:0,uniqueCurves:0,uniqueOpenComposites:0,uniqueClosedComposites:0,partOccurrences:0,surfaceOccurrences:0,curveOccurrences:0,openCompositeOccurrences:0,openCompositeConstituentOccurrences:0,closedCompositeOccurrences:0,closedCompositeConstituentOccurrences:0,bodiesPendingRetrieval:0,veryFineParts:new Map,veryFineOccurrences:[]},s=this.getMeshManager(),n=this.getMeshOwnerId(),a=new Set,o=new Set,c=new Map,l=[],h=(d,u,p)=>{if(e){const e=this.bodyToEntity.get(d);e&&e.each(((e,t)=>{const s=this.idToMetaData[t];if(s)return s.isFace()?(i.faces+=1,i.triangles+=s.getMeshIncrement().getTriangleCount()):s.isLine()?(i.edges+=1,i.lines+=s.getMeshIncrement().getLineCount()):s.isVertex()&&(i.vertices+=1),!1}));const t=s.getGroupRangesForGroupTypeAndLod(d,n,g.PrimitiveType.SILHOUETTES,g.Lod.DEFAULT);t&&(i.silhouettes+=t.getPrimitiveCount())}const m=this.bodyMetaData[d],E=this.occurrences[u],I=r.BTTessellationSetting.getTessellationSettingIndexFromEnum(r.GBTTessellationSettingEnum.VERY_FINE);if(m&&m.tessellationSettings){if(!m.isClosedCompositeConstituent)for(let e=0;e<m.tessellationSettings.length;++e){const s=m.tessellationSettings[e],n=i.settingCounts[s]||0;i.settingCounts[s]=n+1,t&&s===I&&(E?l.push(E.occurrenceData.occurrence):m&&(c.has(d)||c.set(d,m)))}if(m.isClosedComposite&&!o.has(m)&&(i.uniqueClosedComposites++,o.add(m)),p&&(m.isClosedComposite?i.closedCompositeOccurrences++:m.isSolidBody()?i.partOccurrences++:m.isSheetBody()?i.surfaceOccurrences++:m.isWireBody()&&i.curveOccurrences++),m.isClosedComposite&&p)for(let e=0;e<m.constituentBodyIds.length;++e)h(m.constituentBodyIds[e],u,!1);if(m.isClosedCompositeConstituent&&p){i.closedCompositeConstituentOccurrences++;const e=E?u:m.consumingClosedCompositeData.id;a.has(e)||(h(m.consumingClosedCompositeData.id,u,!1),a.add(u))}else if(m.hasReferencingOpenCompositeBody&&E){const e=this.bodyMetaData[E.partIds[0]];e.isOpenCompositeBody&&(i.openCompositeConstituentOccurrences++,a.has(u)||(i.openCompositeOccurrences++,a.add(u)),o.has(e)||(i.uniqueOpenComposites++,o.add(e)))}}};return this.bodyToOccurrenceId.each((function(e,t){const s=this.bodyMetaData[t];return s&&(s.isComposite||s.isClosedCompositeConstituent||(s.isSolidBody()?i.uniqueParts++:s.isSheetBody()?i.uniqueSurfaces++:s.isWireBody()&&i.uniqueCurves++,s.canEntitiesBeLoaded()||i.bodiesPendingRetrieval++)),e.each((function(e,i){return h(t,i,!0),!1})),!1}),this),t&&(i.veryFineParts=c,i.veryFineOccurrences=l),i}getPartStudioBodyOccurrenceIds(){const e=[];for(const t in this.partStudioBodyIdToOccurrenceId)e.push(this.partStudioBodyIdToOccurrenceId[t]);return e}showPartsWithSheetmetalModelIdOnly(e){for(const t in this.partStudioBodyIdToOccurrenceId)if(t in this.bodyMetaData){this.bodyMetaData[t].sheetMetalModelId===e?this.hideShowBody(t,g.Visibility.VISIBLE,g.PART_STUDIO_ELEMENT_ID):this.hideShowBody(t,g.Visibility.HIDDEN,g.PART_STUDIO_ELEMENT_ID)}}needsDisplayData(e){let t=!1;for(let i=0;i<e.partDisplayData.length;i++){const s=e.partDisplayData[i];t=t||s.id in this.bodyMetaData&&this.bodyMetaData[s.id].isForFlattenedView()}return t}isBodyActiveInView(e,t){const i=this.bodyMetaData[e];if(i&&i.isComposite&&!t)return!0;const s=this.getCorrectedBodyOccurrenceId(e,this.viewer.getIdForOccurrence(t)),n=this.occurrences[s];return n?n.containsPart(e)||n.displayedPartIds.has(e):!!this.bodyToOccurrenceId.hasNested(e,s)&&(!this.viewer.getIsForFlattenedDisplay()||this.isBodyVisible(s,e))}getTransformFromSheetMetalBodyMetaData(e){const t=e.sheetMetalOrderId.split(" "),i=e.sheetMetalOrder;if(0===i||i>t.length)return p.mat4.create();const s=t.slice(0,i).join(" ");return this.sheetMetalOrderIdToTransform[s]}isEntityMeasurable(e,t){const i=this.getEntityMetaData(e);return!!i&&this.isBodyActiveInView(this.getEntityBodyGroupId(i),t)}updateFlattenedBodyLayout(){if(!this.viewer.getIsForFlattenedDisplay())return;if((0,g.isMapEmpty)(this.partStudioBodyIdToOccurrenceId))return;this.sheetMetalOrderIdToTransform={};const e=10*Math.max.apply(Math,Object.values(this.bodyMetaData||{}).map((function(e){return e.bounds.max[2]-e.bounds.min[2]}))),t={},i=Object.keys(this.bodyMetaData||{}),s=this;i.sort((function(e,t){const i=s.bodyMetaData[e],n=s.bodyMetaData[t];return!i.isSubsidiaryBody()&&n.isSubsidiaryBody()?-1:i.isSubsidiaryBody()&&!n.isSubsidiaryBody()?1:i.sheetMetalOrderId<n.sheetMetalOrderId?-1:i.sheetMetalOrderId>n.sheetMetalOrderId?1:0}));const a={},o=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),c=this.usage!==r.GBTDisplayDataUsage.BASE,l=c?2:1;for(let s=0;s<l;s++){const r=s===l-1;let h="";for(let s=0;s<i.length;s++){const l=i[s],d=this.bodyMetaData[l];let u=t[d.sheetMetalModelId];u||(u=new g.BoundingBox,t[d.sheetMetalModelId]=u);const E=d.sheetMetalOrderId.split(" ");let I=E[0],T=1;for(;T<E.length&&!(h<I);T++)I+=" "+E[T];d.sheetMetalOrder=T,h=I;const S=d.bounds;let f,C;u.isInitialized()?(f=u.max[0]+e-S.min[0],C=u.max[1]-S.max[1]):(f=0,C=0);const P=-S.max[2],v=this.partStudioBodyIdToOccurrenceId[l];v||n.log.warn("No occurrence for flattened body "+l);let D=p.mat4.create();m.mat4C.translate(D,[f,C,P]);let M=!0;if(d.isSubsidiaryBody()){if(r){const e=a[d.getOwnerBodyId()];e&&(D=e)}}else if(c&&o){const e=o.bodyComponent.sheetMetalOrderIdToTransform[I];e&&(D=e,M=!1)}c&&M!==r||(this.viewer.getOccurrenceDataManager().setOccurrenceTransform(v,D),this.updateBodyManagerReferencesForBody(l),u.addBox(S,D),a[l]=D,this.sheetMetalOrderIdToTransform[I]=D)}}}hasBody(e){return this.bodyMetaData.hasOwnProperty(e)}hasBodyOccurrence(e,t){const i=this.getCorrectedBodyOccurrenceId(e,this.viewer.getIdForOccurrence(t));return this.bodyToOccurrenceId.hasNested(e,i)}contributesToBodyManager(){return this.isForBase()}updateBodyManagerReferencesForBody(e){const t=this.bodyMetaData[e];if(!t||!this.contributesToBodyManager())return;const i=this.getBodyManager(),s=this.bodyToOccurrenceId.get(e);s&&s.each((function(s,n){n=+n;let r=1;const a=this.occurrences[n];return a&&(r=a.displayedPartIds.length),i.addOrUpdateOccurrence(n,this.getBodyOccurrenceData(e,n),t,r),!1}),this)}setDebugFaceTriangles(e){if(X=e,X)for(const e in this.idToMetaData){const t=this.idToMetaData[e],i=t.getMeshIncrement();i&&this.addMeshTriangleEdges(i,t)}this.refreshAllBodyOccurrences()}integrityCheck(){const e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio()===this.parent;for(const t in this.bodyMetaData){if(null!==this.bodyMetaData[t].getFinestTessellationSettingOnClient()){const e=this.bodyToEntity.get(t);e&&!e.isEmpty()||n.log.info("Body "+t+" is missing entity data in "+this.parent.getFullElementId())}else e&&n.log.info("Body "+t+" has no tessellation available, but it is in the active part studio: "+this.parent.getFullElementId())}}collectComponentsForHeapDump(e){for(const t in this.idToMetaData){const i=this.idToMetaData[t],s=i.getMeshIncrement();e.meshIncrements.push(s),e.entityData.push(i),i.isFace()&&!i.isPlanarFace()&&e.silhouetteIncrements.push((0,g.getSilhouetteIncrement)(s));const n=this.getMeshIncrementDetails(t);n?e.incrementDetails.push(n):console.warn("Did not find increment details for "+t)}this.reset()}}t.BodyComponent=Y,Y.PART_STUDIO_BODY_OCCURRENCE_PREFIX="body",Y.MESH_EDGE_GROUP_SUFFIX="_meshEdges"},568668:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BodyLoadTasks=t.BodyLoader=t.BodyToProcess=t.getCollectionId=void 0;const s=i(225072),n=i(545348),r=i(550122),a=i(114924),o=i(719347),c=n.default.getManager();var l;function h(e,t){return e+r.ID_SEPARATOR+t.getCollectionId()}!function(e){e[e.UNLOAD=0]="UNLOAD",e[e.LOAD=1]="LOAD"}(l||(l={})),t.getCollectionId=h;class d{constructor(e,t){this.bodyComponent=e,this.bodyId=t}getCollectionId(){return h(this.bodyId,this.bodyComponent)}}t.BodyToProcess=d;class u{constructor(e,t){this.viewer=e,this.action=t,this.bodiesToProcess=[],this.bodiesNeedSort=!1,this.taskFinishedDeferred=null,this.iterationsSinceStart=0,this.bodiesProcessedSinceStart=0,(0,a.viewerCheck)(e),this.bodiesToProcessMap=new Map,this.initialLoadBudget=new a.Budget(c.getNumber("GRAPHICS_TASK_INITIAL_TIME_BUDGET"),c.getNumber("GRAPHICS_TASK_INITIAL_VERTEX_BUDGET"))}addBodyToProcess(e,t){const i=new d(e,t),s=i.getCollectionId();this.bodiesToProcessMap.get(s)||(this.bodiesToProcess.push(i),this.bodiesToProcessMap.set(s,i),this.setBodiesNeedSort())}performInitialLoad(){const e=new o.Timer("BodyLoader.prototype.performInitialLoad");this.initialLoadBudget.reset(),this.process(this.initialLoadBudget),e.report()}indexOfBody(e,t){for(let i=0;i<this.bodiesToProcess.length;++i){const s=this.bodiesToProcess[i];if(s.bodyComponent===e&&s.bodyId===t)return i}return-1}stopBodyFromProcessing(e,t){if(this.bodiesToProcessMap.has(h(t,e))){const i=this.indexOfBody(e,t);i>=0&&(this.bodiesToProcessMap.delete(this.bodiesToProcess[i].getCollectionId()),this.bodiesToProcess.splice(i,1))}}clearBodiesForComponent(e,t){const i=[];for(let s=0;s<this.bodiesToProcess.length;++s){const n=this.bodiesToProcess[s];n.bodyComponent===e&&t.contains(n.bodyId)&&((0,a.insertRange)([s,s+1],i),this.bodiesToProcessMap.delete(n.getCollectionId()))}(0,a.spliceRangesFromArray)(this.bodiesToProcess,i)}clearAllBodiesForComponent(e){const t=[];for(let i=0;i<this.bodiesToProcess.length;++i)this.bodiesToProcess[i].bodyComponent===e&&((0,a.insertRange)([i,i+1],t),this.bodiesToProcessMap.delete(this.bodiesToProcess[i].getCollectionId()));(0,a.spliceRangesFromArray)(this.bodiesToProcess,t)}setBodiesNeedSort(){this.bodiesNeedSort=!0}clearAllBodies(){this.bodiesToProcess=[],this.bodiesToProcessMap.clear(),this.bodiesNeedSort=!1}hasPendingWork(){return this.bodiesToProcess.length>0}sortBodies(){this.bodiesNeedSort&&(this.bodiesToProcess.sort((function(e,t){const i=e.bodyComponent.isBodyInstantiated(e.bodyId);if(i!==t.bodyComponent.isBodyInstantiated(t.bodyId))return i?-1:1;const s=e.bodyComponent.getBodyDiameter(e.bodyId),n=t.bodyComponent.getBodyDiameter(t.bodyId);return s>n?-1:s<n?1:0})),this.bodiesNeedSort=!1)}process(e){this.sortBodies();const t=[];let i=0;for(let s=0;s<this.bodiesToProcess.length;++s){const n=this.bodiesToProcess[s];let r=!1;if(this.action===l.UNLOAD?(n.bodyComponent.unloadBody(n.bodyId),++i,r=!0):n.bodyComponent.processBodyAddition(n.bodyId,e)&&(++i,r=!0),r&&((0,a.insertRange)([s,s+1],t),this.bodiesToProcessMap.delete(n.getCollectionId())),e&&e.budgetExceeded())break}(0,a.spliceRangesFromArray)(this.bodiesToProcess,t),i>0&&this.action===l.LOAD&&this.viewer.getEventDispatcher().trigger(a.BODIES_LOADED),i>0&&(this.bodiesProcessedSinceStart+=i,++this.iterationsSinceStart),this.hasPendingWork()||(this.taskFinishedDeferred&&(this.taskFinishedDeferred.resolve({bodiesProcessedSinceStart:this.bodiesProcessedSinceStart,iterationsSinceStart:this.iterationsSinceStart}),this.taskFinishedDeferred=null),this.iterationsSinceStart=0,this.bodiesProcessedSinceStart=0)}getTaskFinishedPromise(){return this.taskFinishedDeferred?this.taskFinishedDeferred.promise:this.hasPendingWork()?(this.taskFinishedDeferred=s.defer(),this.taskFinishedDeferred.promise):null}}t.BodyLoader=u;t.BodyLoadTasks=class{constructor(e){this.loadTask=new u(e,l.LOAD),this.unloadTask=new u(e,l.UNLOAD)}getLoadTask(){return this.loadTask}getUnloadTask(){return this.unloadTask}postBodyToLoad(e,t){this.loadTask.addBodyToProcess(e,t),this.unloadTask.stopBodyFromProcessing(e,t)}postBodyToUnload(e,t){this.unloadTask.addBodyToProcess(e,t),this.loadTask.stopBodyFromProcessing(e,t)}completeTasks(){this.loadTask.process(null),this.unloadTask.process(null)}stopBodyFromProcessing(e,t){this.loadTask.stopBodyFromProcessing(e,t),this.unloadTask.stopBodyFromProcessing(e,t)}clearBodiesForComponent(e,t){this.loadTask.clearBodiesForComponent(e,t),this.unloadTask.clearBodiesForComponent(e,t)}clearAllBodiesForComponent(e){this.loadTask.clearAllBodiesForComponent(e),this.unloadTask.clearAllBodiesForComponent(e)}clearAllBodies(){this.loadTask.clearAllBodies(),this.unloadTask.clearAllBodies()}hasPendingUnloads(){return this.unloadTask.hasPendingWork()}}},494461:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.occurrenceSortFunction=t.BodyManager=t.getUnitBoxIncrement=t.unitBoxIncrement=t.BodyOccurrence=t.NonInstantiatedBody=t.LOADED_TESSELLATION_SETTING=t.byteToMbString=t.isRetrievalDebuggingEnabled=t.UNLOADED_BODY_OPACITY_FACTOR=t.RetrievalRequestSource=t.NO_RETRIEVAL_SENT_FOR_OCCURRENCE=t.setRefinementMode=t.RefinementMode=t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID=t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID=t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID=void 0;const s=i(142885),n=i(545348),r=i(719347),a=i(997687),o=i(912057),c=i(193786),l=i(606544),h=i(736234),d=i(114924),u=i(322012),g=i(264292),p=i(613199);t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID="pbm",t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID="tbm",t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID="nbm";class m{constructor(e,t,i,s,n,r){this.bodyOccurrence=e,this.requestSource=t,this.occurrence=i,this.tessellationSettingDesired=s,this.tessellationSettingRequested=n,this.viewportError=r}}var E;!function(e){e[e.DISABLED=0]="DISABLED",e[e.CONDITIONAL=1]="CONDITIONAL",e[e.ALWAYS=2]="ALWAYS"}(E||(t.RefinementMode=E={}));let I=E.CONDITIONAL;var T;function S(){return!!localStorage.getItem("osBodyRetrievalDebuggingEnabled")}function f(e){return(e/1024/1024).toFixed(0)+" MB"}t.setRefinementMode=function(e){I=e},t.NO_RETRIEVAL_SENT_FOR_OCCURRENCE=-1,function(e){e[e.SELECTION=0]="SELECTION",e[e.HOVER=1]="HOVER",e[e.VIEWING=2]="VIEWING"}(T||(t.RetrievalRequestSource=T={})),t.UNLOADED_BODY_OPACITY_FACTOR=n.default.getManager().getNumber("UNLOADED_BODY_OPACITY_FACTOR"),t.isRetrievalDebuggingEnabled=S,t.byteToMbString=f,t.LOADED_TESSELLATION_SETTING=[0];class C{constructor(e,t){this.partStudio=e,this.bodyMetaData=t,this.radius=this.getBodyMetaDataForRetrieval().getBounds().diameter()/2}getBodyMetaDataForRetrieval(){return this.bodyMetaData.isClosedCompositeConstituent?this.bodyMetaData.consumingClosedCompositeData:this.bodyMetaData}getBenefitToUnload(){return this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage()/(this.radius*this.radius)}isBodyDataPresent(){return this.getBodyMetaDataForRetrieval().hasTessellationSettings()}isInstantiated(){return!1}getLastViewTime(){return 0}getLastViewportOccupancy(){return 0}getUnloadedChordalTolerance(){return this.getBodyMetaDataForRetrieval().getBounds().diameter()}getCenter(){return null}}t.NonInstantiatedBody=C;const P=g.vec3.create(),v=g.vec4.create(),D=g.mat4.create();class M{constructor(e,i,s){this.occurrenceData=e,this.bodyMetaData=i,this.pickId=s,this.center=[0,0,0],this.radius=0,this.lod=null,this.displayDamaged=!0,this.incrementDetails=null,this.highlightApplied=null,this.retrievalRequestState=t.NO_RETRIEVAL_SENT_FOR_OCCURRENCE,this.update(e,i)}update(e,t){this.occurrenceData=e,this.bodyMetaData=t;const i=v;t.getBounds().center(i),i[3]=1,p.mat4C.multiplyVec4(e.getTransform(),i),this.center[0]=i[0],this.center[1]=i[1],this.center[2]=i[2],this.radius=t.getBounds().diameter()/2,this.displayDamaged=!0}getBodyMetaData(){return this.bodyMetaData}getBodyMetaDataForRetrieval(){return this.bodyMetaData.isClosedCompositeConstituent?this.bodyMetaData.consumingClosedCompositeData:this.bodyMetaData}getOccurrenceData(){return this.occurrenceData}getOccurrenceId(){return this.occurrenceData.getOccurrenceId()}getCenter(){return this.center}getRadius(){return this.radius}getUnloadedChordalTolerance(){return 2*this.radius}getBenefitToCull(){return this.bodyMetaData.coarseTriangleCount/(this.radius*this.radius)}getBenefitToUnload(){return this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage()/(this.radius*this.radius)}getBenefitToLoad(){return this.isBodyDataPresent()?0:this.radius*this.radius/this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage(t.LOADED_TESSELLATION_SETTING)}getBenefitToRefine(e,t){return t/this.getBodyMetaDataForRetrieval().getEstimatedMemoryUsage([e])}isInstantiated(){return!0}setCullingState(e){if(this.numberOfBodiesInOccurrence>1){const t=d.BodyComponent.getPotentialMeshGroupIdsForBody(this.bodyMetaData.meshGroupId);for(let i=0;i<t.length;++i)this.occurrenceData.setCullingState(e,t[i])}else this.occurrenceData.setCullingState(e)}isEntityTessellationLoaded(){return this.getBodyMetaDataForRetrieval().getIsTessellationLoaded()}canBeRefinedFurther(e){const t=this.getBodyMetaDataForRetrieval().getFinestTessellationSettingOnClient();return null===t||t<this.getBodyMetaDataForRetrieval().getBestAvailableTessellationSettingIndex(e)}setLod(e){this.isEntityTessellationLoaded()||(e=d.Lod.LOWEST),this.occurrenceData.setLod(e)}outsideFrustum(e){return e.viewFrustum.getSphereFrustumIntersection(this.center,this.radius)===d.IntersectionType.OUTSIDE}intersectsFrustum(e){return!!e&&e.getSphereFrustumIntersection(this.center,this.radius)!==d.IntersectionType.OUTSIDE}isVisible(){return this.occurrenceData.getVisibility()===d.Visibility.VISIBLE}mustShowLowestLod(e){return!this.isEntityTessellationLoaded()&&(this.isVisible()||this.occurrenceData.hasHighlight()||e&&e.getIsPickingHiddenOccurrences())}lodIsUpToDate(){return this.mustShowLowestLod()?!this.displayDamaged&&this.lod===d.Lod.LOWEST:this.lod!==d.Lod.LOWEST}isBodyDataPresent(){return this.getBodyMetaDataForRetrieval().hasTessellationSettings()}resetRetrievalRequestState(){this.retrievalRequestState=t.NO_RETRIEVAL_SENT_FOR_OCCURRENCE}setBodyRetrievalStarted(e){this.retrievalRequestState=e}isRetrievalRequestDataPresent(){if(!this.getBodyRetrievalStarted())return!1;const e=this.getBodyMetaDataForRetrieval();return e.hasTessellationSettings()&&e.getFinestTessellationSettingOnClient()>=this.retrievalRequestState}getBodyRetrievalStarted(){return this.retrievalRequestState>=0}canCullBody(e){return this.occurrenceData.getVisibility()===d.Visibility.VISIBLE&&!this.occurrenceData.getIsolated()&&!this.intersectsFrustum(e)}getDisplayId(){return this.occurrenceData.getOccurrenceId()+"."+this.bodyMetaData.id}addBounds(e){e.addBox(this.bodyMetaData.getBounds(),this.occurrenceData.getTransform())}updateViewHistory(e,t){const i=this.getBodyMetaDataForRetrieval();i.getLastViewTime()!==e?(i.setLastViewTime(e),i.setLastViewportOccupancy(t)):i.setLastViewportOccupancy(t+i.getLastViewportOccupancy())}getLastViewTime(){return this.getBodyMetaDataForRetrieval().getLastViewTime()}getLastViewportOccupancy(){return this.getBodyMetaDataForRetrieval().getLastViewportOccupancy()}getDisplayIncrement(){const e=this.bodyMetaData.getBounds(),i=e.diagonalVector(P),s=p.mat4C.scale(g.mat4.identity(D),i),n=e.center(P);s[12]+=n[0],s[13]+=n[1],s[14]+=n[2],p.mat4C.multiply(this.occurrenceData.getTransform(),s,s);const r=y().createTransformed(s);r.id=this.getDisplayId(),r.pickId=this.pickId,r.lod=d.Lod.LOWEST;let a=this.bodyMetaData.getColor();return!this.occurrenceData.getIsolated()&&(0,d.getActiveViewer)().getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode()?(a=[a[0],a[1],a[2],1],r.groupId=t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID):(this.isBodyDataPresent()||(a=[a[0],a[1],a[2],a[3]*t.UNLOADED_BODY_OPACITY_FACTOR]),r.groupId=a[3]<1?t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID:t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID),(0,d.addColorToIncrement)(a,r),r}}function y(){return t.unitBoxIncrement||(t.unitBoxIncrement=(0,d.createBox)([-.5,-.5,-.5],[.5,.5,.5])),t.unitBoxIncrement}t.BodyOccurrence=M,t.unitBoxIncrement=null,t.getUnitBoxIncrement=y;class O extends s.BackboneEventsBaseClass{constructor(e,i){super(),this.viewer=e,this.bodyUnloadTask=i,this.DISPLAY_OCCURRENCE_NAME="BodyManager",this.DISPLAY_NON_ISOLATED_OCCURRENCE_NAME="BodyManagerNonIsolated",this.DISPLAY_BOXES_WHEN_CULLING=n.default.getManager().getNumber("DISPLAY_BOXES_WHEN_CULLING"),this.previewOccurrences=new Map,this.sortedOccurrences=null,this.occurrencesNeedSort=!0,this.unloadedBodyBounds=null,this.MAXIMUM_BODY_CULL_DIAMETER_PROPORTION=n.default.getManager().getNumber("MAXIMUM_BODY_CULL_DIAMETER_PROPORTION"),this.occurrenceRetrievalTimeout=null,this.encounteredUnloadedOccurrenceInLastFrame=!1,this.bodyRetrievalCheckTimeout=null,this.shouldUpdateBodyOccurrenceLodForIsolate=!1,this.paused=!1,this.userEnabledAggressiveRefinement=!1,this.idManager=new d.NamedIdManager,this.graphicsRefinementModeSubject=new u.ReplaySubject(1),this.occurrences=new Map,this.node=new d.Node("bodyManager"),this.displayOccurrenceId=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.DISPLAY_OCCURRENCE_NAME),this.displayOccurrenceData=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(this.displayOccurrenceId),this.displayOccurrenceData.setLod(d.Lod.LOWEST),this.displayOccurrenceData.setIsolated(!0),this.displayOccurrenceData.setCanIsolateChange(!1),this.displayOccurrenceIdNonIsolated=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.DISPLAY_NON_ISOLATED_OCCURRENCE_NAME),this.displayOccurrenceDataNonIsolated=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(this.displayOccurrenceIdNonIsolated),this.displayOccurrenceDataNonIsolated.setLod(d.Lod.LOWEST),this.displayOccurrenceDataNonIsolated.setIsolated(!1),this.displayOccurrenceDataNonIsolated.setCanIsolateChange(!1),this.meshManager=new d.MeshManager(this.viewer,{bufferAllocationPolicy:d.BufferAllocationPolicy.MAXIMUM}),this.meshOwnerId=(0,d.getNewOwnerId)(),this.bodyOccurrenceToRetrievalRequest=new Map,this.occurrenceRetrievalRequests=[],this.pendingRetrievalInformation=new Map;this.viewer.getModelViewManagers().getManager().getSharedBodyNode().addChild(this.node);const s=new d.Style,r=this.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(t.BODY_MANAGER_OPAQUE_INCREMENT_GROUP_ID,this.meshOwnerId,d.PrimitiveType.TRIANGLE_STRIP,d.Lod.LOWEST);this.node.addOccurrenceGeometryToNode(d.SOLID_FACE_NODE_PROPERTIES,this.displayOccurrenceData,s,r);const o=this.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(t.BODY_MANAGER_TRANSPARENT_INCREMENT_GROUP_ID,this.meshOwnerId,d.PrimitiveType.TRIANGLE_STRIP,d.Lod.LOWEST);this.node.addOccurrenceGeometryToNode(d.SOLID_FACE_NODE_PROPERTIES_TRANSPARENT,this.displayOccurrenceData,s,o);const c=this.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(t.BODY_MANAGER_NONISOLATED_INCREMENT_GROUP_ID,this.meshOwnerId,d.PrimitiveType.TRIANGLE_STRIP,d.Lod.LOWEST);this.node.addOccurrenceGeometryToNode(d.SOLID_FACE_NODE_PROPERTIES,this.displayOccurrenceDataNonIsolated,s,c),a.btInjector.CapabilitiesService&&a.btInjector.CapabilitiesService.isMoreAggressiveCullingEnabled&&a.btInjector.CapabilitiesService.isMoreAggressiveCullingEnabled().then((e=>{this.MAXIMUM_BODY_CULL_DIAMETER_PROPORTION=!0===e?n.default.getManager().getNumber("MORE_AGGRESSIVE_MAXIMUM_BODY_CULL_DIAMETER_PROPORTION"):n.default.getManager().getNumber("MAXIMUM_BODY_CULL_DIAMETER_PROPORTION")})),this.refinementNodeFilter=e=>{const t=this.viewer.getModelViewManagers().getManager();if(t.isNodeForModel(e)){const i=e.getParent();return!e.isMeshNode()||e.isFaces()&&(t.isNodeForBody(i)||i===this.node)}return!1},this.subscribeToSelectionList()}destroy(){this.node.remove(),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(this.displayOccurrenceId),this.viewer.getOccurrenceIdManager().removeName(this.DISPLAY_OCCURRENCE_NAME),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(this.displayOccurrenceIdNonIsolated),this.viewer.getOccurrenceIdManager().removeName(this.DISPLAY_NON_ISOLATED_OCCURRENCE_NAME),this.meshManager.destroy(),this.resetOccurrenceRetrieval(),this.clearBodyRetrievalCheckTimeout(),this.stopListening()}resetSelectionListHandlers(){this.stopListening(),this.subscribeToSelectionList()}subscribeToSelectionList(){const e=(0,c.getSelectionList)();this.listenTo(e,"add",this.onSelectionChanged),this.listenTo(e,"reset",this.onSelectionChanged),this.listenTo(e,"remove",this.onSelectionChanged)}setVisible(e){this.node.setVisible(e)}resetOccurrenceRetrieval(){S()&&o.log.info("Reset occurence retriaval"),this.clearBodyRetrievalCheckTimeout(),this.clearRetrievalTimeout(),this.bodyOccurrenceToRetrievalRequest.clear(),this.occurrenceRetrievalRequests=[],this.pendingRetrievalInformation=new Map}clearPreviewOccurrences(){this.previewOccurrences.clear()}getGraphicsRefinementModeObservable(){return this.graphicsRefinementModeSubject.asObservable()}updateGraphicsRefinementMode(){this.userEnabledAggressiveRefinement?this.graphicsRefinementModeSubject.next(d.GraphicsRefinementMode.AGGRESSIVE_USER_CAUSED):this.graphicsRefinementModeSubject.next(d.GraphicsRefinementMode.NORMAL)}get aggressiveRefinementEnabled(){return this.userEnabledAggressiveRefinement}getUserEnabledAggressiveRefinement(){return this.userEnabledAggressiveRefinement}setUserEnabledAggressiveRefinement(e){this.userEnabledAggressiveRefinement!==e&&(this.userEnabledAggressiveRefinement=e,this.onAggressiveRefinementChanged())}onAggressiveRefinementChanged(){this.aggressiveRefinementEnabled?this.performUnloadedBodyAndRefinementCheck():this.viewer.getEventDispatcher().trigger(d.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES),this.updateGraphicsRefinementMode()}isBodyManagerOccurrence(e){return!!e&&e.path[0]===this.DISPLAY_OCCURRENCE_NAME}pickedOccurrenceId(e){this.viewer.isHidden()||this.initiateAutomaticRetrieval()}onSelectionChanged(){this.viewer.isHidden()||this.initiateAutomaticRetrieval()}getBtOccurrence(e){const t=this.viewer.getOccurrenceIdManager().getNameForId(e.getOccurrenceId());return!t||t.startsWith(d.BodyComponent.PART_STUDIO_BODY_OCCURRENCE_PREFIX)?null:l.BTOccurrence.getOccurrenceFromPathString(t)}checkBodiesUnderMemoryLimit(e,t){const i=this.viewer.getModelViewManagers().getManager().getBodyRefinementMemoryLimit();let s=0;for(const n of this.occurrences.values()){const r=n.getBodyMetaData();if(!t||t.has(r.id)?s+=r.getEstimatedMemoryUsage([e]):s+=r.getEstimatedMemoryUsage(),s>=i)return!1}return!0}clearRetrievalTimeout(){(0,h.isNumber)(this.occurrenceRetrievalTimeout)&&(window.clearTimeout(this.occurrenceRetrievalTimeout),this.occurrenceRetrievalTimeout=null)}startRetrievalTimeout(){this.clearRetrievalTimeout();const e=this.aggressiveRefinementEnabled?n.default.getManager().getNumber("AGGRESSIVE_OCCURRENCE_RETRIEVAL_INTERVAL_MS"):n.default.getManager().getNumber("OCCURRENCE_RETRIEVAL_INTERVAL_MS");this.occurrenceRetrievalTimeout=window.setTimeout((()=>this.onRetrievalTimeout()),e)}onRetrievalTimeout(){if(this.clearRetrievalTimeout(),this.paused)return void o.log.info("Skipped body retrieval timeout due to pause");const e=this.viewer.getModelViewManagers().getManager();if(!this.aggressiveRefinementEnabled&&this.viewer.getFrameTimer().userIsInteracting())return void this.startRetrievalTimeout();const t=[];let i=!1;const s=n.default.getManager(),r=1024*s.getNumber("BODY_REFINEMENT_BATCH_SIZE_MB")*1024,a=1024*s.getNumber("PENDING_BODY_REFINEMENT_SIZE_LIMIT_MB")*1024;let h=0;const u=S(),g=[],p=this.getEstimatedMemoryUsageOfPendingRetrievals();if(u){const t=e.getEstimatedMemoryUsageOfBodies();o.log.info("Estimated memory use of all bodies: "+f(t)+" pending:"+f(p))}for(const s of this.occurrenceRetrievalRequests){const n=s.bodyOccurrence.getBodyMetaDataForRetrieval();if(this.pendingRetrievalInformation.has(n)){i=!0;continue}let o=n.getFinestTessellationSettingOnClient();if(null===o&&(o=-1),o>=s.tessellationSettingRequested)continue;i=!0;let d=0,m=-1;if(this.aggressiveRefinementEnabled?(m=s.tessellationSettingRequested,d=n.getEstimatedMemoryUsage([m])):(i=!0,m=o+1,d=n.getEstimatedMemoryUsage([m])),(0===h||h+d<r)&&(0===this.pendingRetrievalInformation.size||p+h+d<a)){h+=d,this.pendingRetrievalInformation.set(n,{estimatedAdditionalMemoryUsage:d,tessellationSetting:m});const i=new l.BTUiOccurrenceDisplayDataRequest;if(i.bodyDeterministicId=n.getId(),s.occurrence){i.occurrence=s.occurrence;const t=e.getOccurrenceDisplayData(s.occurrence);t&&(i.elementId=t.elementId,i.microversionIdAndConfiguration=t.fullElementId.microversionIdAndConfiguration)}else i.occurrence=null;i.tessellationSetting=m,s.bodyOccurrence.setBodyRetrievalStarted(i.tessellationSetting),S()&&(s.occurrence?(0,c.getRetrievalSelectionList)().add(new c.Selection(l.GBTUiSelectionType.OCCURRENCE,s.occurrence,s.occurrence)):(0,c.getRetrievalSelectionList)().add(new c.Selection(l.GBTUiSelectionType.BODY,s.bodyOccurrence.getBodyMetaData().getId()))),t.push(i),u&&g.push(n.getId()+"-"+i.tessellationSetting)}}if(u&&g.length>0){g.sort(),o.log.info("Retrieving bodies: "+g);const e=this.viewer.getModelViewManagers().getManager().getEstimatedMemoryUsageOfBodies(),t=this.getEstimatedMemoryUsageOfPendingRetrievals();o.log.info("Estimated use of body memory at time of retrieval "+f(e+t)+", pending use: "+f(t))}t.length>0&&(this.aggressiveRefinementEnabled?this.viewer.getEventDispatcher().trigger(d.ADD_TEMPORARY_TESSELLATION_OVERRIDES,t):this.viewer.getEventDispatcher().trigger(d.RETRIEVE_OCCURRENCE_DISPLAY_DATA,t)),i&&this.startRetrievalTimeout()}resetRetrievalStateForOccurrence(e){e.resetRetrievalRequestState();const t=e.getBodyMetaDataForRetrieval();if(this.pendingRetrievalInformation.delete(t),S()){const i=this.getBtOccurrence(e);i?(0,c.getRetrievalSelectionList)().remove(new c.Selection(l.GBTUiSelectionType.OCCURRENCE,i,i)):(0,c.getRetrievalSelectionList)().remove(new c.Selection(l.GBTUiSelectionType.BODY,t.getId()))}}updateForFrame(e,t){let i;this.sortedOccurrences||(this.sortedOccurrences=new Array(this.occurrences.size),i=0,this.occurrences.forEach((function(e){this.sortedOccurrences[i++]=e}),this),this.occurrencesNeedSort=!0),this.occurrencesNeedSort&&(this.sortedOccurrences.sort(_),this.occurrencesNeedSort=!1),this.performAggressiveCulling(e,t)}performAggressiveCulling(e,t){if(this.viewer.getXrController().getIsXrRunning())return;const i=e.getActiveCamera(),s=e.getDetailSettings();let n=(0,d.isUsageBase)()?Math.floor(s.lowLevelBodyProportion*this.sortedOccurrences.length):0;const r=!t||this.DISPLAY_BOXES_WHEN_CULLING;let a=this.shouldUpdateBodyOccurrenceLodForIsolate||0!==n&&r||e.getIsPickingHiddenOccurrences();const o=e.getViewer().getFrustumToPreventCulling();t&&(this.encounteredUnloadedOccurrenceInLastFrame=!1);const c=this.MAXIMUM_BODY_CULL_DIAMETER_PROPORTION*i.getViewportDiagonal();let l=!1;for(let s=0;s<this.sortedOccurrences.length;++s){const r=this.sortedOccurrences[s];if(r.outsideFrustum(i))r.setCullingState(d.CullingState.CULLED),--n;else{r.lodIsUpToDate()||a||(a=!0,s=0);const h=i.getUnitSizeAtWorldPointFast(r.center)*r.radius*2;t&&!r.isBodyDataPresent()&&(this.encounteredUnloadedOccurrenceInLastFrame=!0),r.mustShowLowestLod(e)||s<n&&r.canCullBody(o)&&h<c?(l=!0,r.setCullingState(d.CullingState.CULLED),a&&this.setBodyOccurrenceLod(r,d.Lod.LOWEST,e)):(r.setCullingState(d.CullingState.VISIBLE),a&&this.setBodyOccurrenceLod(r,d.Lod.DEFAULT,e))}this.shouldUpdateBodyOccurrenceLodForIsolate=!1,r.isRetrievalRequestDataPresent()&&this.resetRetrievalStateForOccurrence(r)}l?(this.displayOccurrenceData.setCullingState(d.CullingState.VISIBLE),this.displayOccurrenceDataNonIsolated.setCullingState(d.CullingState.VISIBLE)):(this.displayOccurrenceData.setCullingState(d.CullingState.CULLED),this.displayOccurrenceDataNonIsolated.setCullingState(d.CullingState.CULLED))}setBodyOccurrenceLod(e,t,i){if(e.lod===t&&!e.displayDamaged)return void this.updateBodyHighlight(e);const s=e.occurrenceData.getIsolated()||!this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode();if(t===d.Lod.DEFAULT)e.incrementDetails&&(this.displayOccurrenceData.hideIncrement(e.incrementDetails,d.BTGraphicsUsage.BASE),this.displayOccurrenceDataNonIsolated.hideIncrement(e.incrementDetails,d.BTGraphicsUsage.BASE));else{const t=!e.isVisible()&&!i.getIsPickingHiddenOccurrences();if(e.displayDamaged||!e.incrementDetails){e.incrementDetails&&(this.meshManager.removeMeshIncrement(e.getDisplayId(),this.meshOwnerId),e.incrementDetails=null,e.highlightApplied=null);const t=e.getDisplayIncrement();e.incrementDetails=this.meshManager.addMeshIncrement(t,this.meshOwnerId),e.displayDamaged=!1}s&&!t?this.displayOccurrenceData.showIncrement(e.incrementDetails,d.BTGraphicsUsage.BASE):this.displayOccurrenceData.hideIncrement(e.incrementDetails,d.BTGraphicsUsage.BASE),s||t?this.displayOccurrenceDataNonIsolated.hideIncrement(e.incrementDetails,d.BTGraphicsUsage.BASE):this.displayOccurrenceDataNonIsolated.showIncrement(e.incrementDetails,d.BTGraphicsUsage.BASE)}e.lod=t,this.updateBodyHighlight(e)}updateBodyHighlight(e){if(e.incrementDetails)if(e.lod===d.Lod.DEFAULT)this.clearBodyHighlight(e);else{const t=e.occurrenceData.getBaseOccurrenceHighlight();t!==e.highlightApplied&&(this.clearBodyHighlight(e),t&&(this.displayOccurrenceData.updateEntityHighlight(d.Action.ADD,t,e.incrementDetails,d.BTGraphicsUsage.BASE),this.displayOccurrenceDataNonIsolated.updateEntityHighlight(d.Action.ADD,t,e.incrementDetails,d.BTGraphicsUsage.BASE),e.highlightApplied=t))}}clearBodyHighlight(e){e.highlightApplied&&e.incrementDetails&&(this.displayOccurrenceData.updateEntityHighlight(d.Action.REMOVE,e.highlightApplied,e.incrementDetails,d.BTGraphicsUsage.BASE),this.displayOccurrenceDataNonIsolated.updateEntityHighlight(d.Action.REMOVE,e.highlightApplied,e.incrementDetails,d.BTGraphicsUsage.BASE),e.highlightApplied=null)}getBodyOccurrenceId(e,t){return e+"."+t}addOrUpdateOccurrence(e,t,i,s){const n=this.getBodyOccurrenceId(e,i.id);let r=this.occurrences.get(n);r?r.update(t,i):(r=new M(t,i,this.idManager.getOrCreateIdForName(n)),this.occurrences.set(n,r),this.sortedOccurrences&&this.sortedOccurrences.push(r)),r.numberOfBodiesInOccurrence=s,this.occurrencesNeedSort=!0,this.damageUnloadedBodyBounds()}damageUnloadedBodyBounds(){this.unloadedBodyBounds=null}getUnloadedBodyBounds(){return this.unloadedBodyBounds||(this.unloadedBodyBounds=new d.BoundingBox,this.occurrences.forEach((e=>{!e.isVisible()||e.isBodyDataPresent()&&e.isEntityTessellationLoaded()||e.addBounds(this.unloadedBodyBounds)}))),this.unloadedBodyBounds}getBodyOccurrence(e,t){return this.occurrences.get(this.getBodyOccurrenceId(e,t))}removeOccurrence(e,t){const i=this.getBodyOccurrenceId(e,t),s=this.occurrences.get(i);s&&(s.incrementDetails&&this.meshManager.removeMeshIncrement(s.getDisplayId(),this.meshOwnerId),this.occurrences.delete(i),this.sortedOccurrences=null,this.occurrencesNeedSort=!0,this.damageUnloadedBodyBounds(),this.idManager.removeName(i))}getOccurrenceBounds(e,t){const i=new d.BoundingBox,s=this.occurrences.get(this.getBodyOccurrenceId(e,t));return s&&s.addBounds(i),i}onUserIsAdjustingCamera(){(this.viewer.getModelViewManagers().getManager().displayingAssembly()||this.viewer.getModelViewManagers().getManager().displayingPartStudio())&&this.initiateAutomaticRetrieval()}getEstimatedMemoryUsageOfPendingRetrievals(){let e=0;return this.pendingRetrievalInformation.forEach((function(t){e+=t.estimatedAdditionalMemoryUsage})),e}hasRefinementCeased(){return 0===this.pendingRetrievalInformation.size&&this.hasRefinementCompleted()}getDisplayDataRefinementState(){const e=[];return this.occurrences.forEach((function(t){const i=t.getBodyMetaDataForRetrieval(),s=i.getFinestTessellationSettingOnClient(),n=t.isVisible(),r=i.getBestAvailableTessellationSettingIndex(this.aggressiveRefinementEnabled);e.push(`${i.name}, ${i.getId()}, on client = ${s}, maximum = ${r}, isVisible = ${n}`)}),this),e.join("\n")}hasRefinementCompleted(){let e=!0;for(const t of this.occurrenceRetrievalRequests){const i=t.bodyOccurrence.getBodyMetaDataForRetrieval().getFinestTessellationSettingOnClient();if(null===i){e=!1;break}if(t.tessellationSettingRequested!==l.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING&&t.tessellationSettingRequested>i){e=!1;break}}return e}getPendingRetrievalSummary(){let e="Body manager retrieval summary:\n";return this.pendingRetrievalInformation.size>0&&(e+="pendingRetrievalInformation size: "+this.pendingRetrievalInformation.size+"\n",this.pendingRetrievalInformation.forEach(((t,i)=>{e+="  Body: "+i.getId()+", retrievalInfo: "+JSON.stringify(t)+"\n"}))),this.bodyOccurrenceToRetrievalRequest.size>0&&(e+="occurrenceRetrievalRequests size: "+this.bodyOccurrenceToRetrievalRequest.size+"\n",this.bodyOccurrenceToRetrievalRequest.forEach(((t,i)=>{e+="retrievalRequest: "+JSON.stringify(t,null,"  ")+"\n"}))),e}clearBodyRetrievalCheckTimeout(){(0,h.isNumber)(this.bodyRetrievalCheckTimeout)&&(window.clearTimeout(this.bodyRetrievalCheckTimeout),this.bodyRetrievalCheckTimeout=null)}initiateAutomaticRetrieval(){this.clearBodyRetrievalCheckTimeout();const e=this.aggressiveRefinementEnabled?n.default.getManager().getNumber("AGGRESSIVE_AUTOMATIC_BODY_RETRIEVAL_TIMEOUT_MS"):n.default.getManager().getNumber("AUTOMATIC_BODY_RETRIEVAL_TIMEOUT_MS");this.bodyRetrievalCheckTimeout=window.setTimeout((()=>this.performUnloadedBodyAndRefinementCheck()),e)}allowRefinementCheck(){if(I===E.ALWAYS||this.aggressiveRefinementEnabled)return!0;const e=this.viewer.getInteractiveFrameDetails(),t=S();let i=!1;return e&&e.hasTimings()&&(i=e.getAverageFramerate()<n.default.getManager().getNumber("BODY_REFINEMENT_FRAMERATE_THRESHOLD"),t&&i&&o.log.info("Skipped body refinement check because framerate is slow right now: "+e.getAverageFramerate()+" fps")),!i}getSelectionsForRetrieval(){const e=[];return(0,c.getSelectionList)().forEach((t=>{e.push({selection:t,requestSource:T.SELECTION})})),(0,c.getPreselectionList)().forEach((t=>{e.push({selection:t,requestSource:T.HOVER})})),e}getSelectionOccurrencesForRetieval(){const e=[],t=this.viewer.getModelViewManagers().getManager(),i=this.viewer.getOccurrenceIdManager(),s=this.viewer.getCamera(),r=this.aggressiveRefinementEnabled?n.default.getManager().getNumber("SELECTED_AGGRESSIVE_ERROR_REFINEMENT_THRESHOLD"):n.default.getManager().getNumber("FINER_BODY_SCREENSPACE_ERROR_REFINEMENT_THRESHOLD");for(const{selection:n,requestSource:a}of this.getSelectionsForRetrieval()){const o=n.getOccurrence();if(!o)continue;const c=i.getIdForName(o.getPathAsString());if(c===d.INVALID_OCCURRENCE_ID)continue;const h=t.getOccurrenceDisplayData(o);if(h&&h.displayedPartIds)for(const t of h.displayedPartIds){const i=this.getBodyOccurrenceId(c,t),n=this.occurrences.get(i);if(!n)continue;const o=s.getUnitSizeAtWorldPoint(n.getCenter()),h=this.getTessellationIndexToGoUnderThreshold(n,r,o,this.aggressiveRefinementEnabled),d=this.getBtOccurrence(n);e.push(new m(n,a,d,h,l.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING,Number.MAX_VALUE))}}return e}getVisibleOccurrencesForRetrieval(){const e=[],t=this.viewer.getCamera(),i=this.viewer.getModelViewManagers().getManager();let s;s=this.aggressiveRefinementEnabled?i.displayingAssembly()?n.default.getManager().getNumber("VIEWING_ASSEMBLY_AGGRESSIVE_ERROR_REFINEMENT_THRESHOLD"):n.default.getManager().getNumber("VIEWING_PART_STUDIO_AGGRESSIVE_ERROR_REFINEMENT_THRESHOLD"):n.default.getManager().getNumber("BODY_SCREENSPACE_ERROR_REFINEMENT_THRESHOLD");const r=(0,d.getTimeInMilliseconds)();return this.collectBodyOccurrencesInViewport().forEach(((i,n)=>{n.updateViewHistory(r,i.viewportOccupancyRatio);const a=n.getBodyMetaData(),o=n.getUnloadedChordalTolerance(),c=t.getUnitSizeAtWorldPoint(n.getCenter()),h=c*o;if(h>=s){let t=null;if(t=this.shouldRetrieveHighestQualityTessellationForOccurrence(n)?a.getBestAvailableTessellationSettingIndex(this.aggressiveRefinementEnabled):this.getTessellationIndexToGoUnderThreshold(n,s,c,this.aggressiveRefinementEnabled),null===t)return;const r=this.getBtOccurrence(n);e.push(new m(n,T.VIEWING,r,t,l.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING,i.viewportOccupancyRatio*h))}})),e}findMaximumRefinementForOccurrences(){const e=[],t=new Map;for(const i of[...this.getSelectionOccurrencesForRetieval(),...this.getVisibleOccurrencesForRetrieval()]){const s=t.get(i.bodyOccurrence);s?(s.viewportError=Math.max(i.viewportError,s.viewportError),s.requestSource=Math.min(i.requestSource,s.requestSource)):(e.push(i),t.set(i.bodyOccurrence,i))}const i=this.viewer.getCamera();e.sort(((e,t)=>{const s=e.bodyOccurrence.outsideFrustum(i);if(s!==t.bodyOccurrence.outsideFrustum(i))return s?1:-1;if(e.requestSource<t.requestSource)return-1;if(e.requestSource>t.requestSource)return 1;if(e.bodyOccurrence.isEntityTessellationLoaded()!==t.bodyOccurrence.isEntityTessellationLoaded())return e.bodyOccurrence.isEntityTessellationLoaded()?1:-1;const n=!!this.getBtOccurrence(e.bodyOccurrence);if(n!==!!this.getBtOccurrence(t.bodyOccurrence))return n?-1:1;const r=e.bodyOccurrence.getBenefitToRefine(e.tessellationSettingDesired,e.viewportError),a=t.bodyOccurrence.getBenefitToRefine(t.tessellationSettingDesired,t.viewportError);return r>a?-1:r<a?1:0}));let s=0;const n=this.viewer.getModelViewManagers().getManager().getBodyRefinementMemoryLimit();let r=!0;for(;r;){r=!1;const t=new Map;for(const i of e){const e=i.bodyOccurrence.getBodyMetaDataForRetrieval(),a=t.get(e);if(a)i.tessellationSettingRequested=a.tessellationSettingRequested;else{if(i.tessellationSettingRequested<i.tessellationSettingDesired){const t=e.getEstimatedMemoryUsage([i.tessellationSettingRequested+1])-e.getEstimatedMemoryUsage([i.tessellationSettingRequested]);s+t<=n&&(i.tessellationSettingRequested+=1,s+=t,r=!0)}t.set(e,i)}}}if(S()){const i=this.getLoadedDisplayDataVolume(),r=this.getDesiredDisplayDataVolume(e),a=[];a.push(`Total display data in memory: ${f(i)}`),a.push(`Total desired memory usage: ${f(r)}`),a.push(`Maximum allowed memory usage: ${f(n)}`),a.push(`Total requested display memory after optimization: ${f(s)}`),e.forEach((function({bodyOccurrence:e}){const i=e.getBodyMetaDataForRetrieval(),s=i.getFinestTessellationSettingOnClient(),n=t.get(e),r=i.getBestAvailableTessellationSettingIndex(this.aggressiveRefinementEnabled);a.push(`${i.name}, ${i.getId()}, on client = ${s}, maximum = ${r}, desired = ${n.tessellationSettingDesired}, requested = ${n.tessellationSettingRequested}`)}),this),a.push(`Number of visible occurrences in frustum=${e.length}`),o.log.info(a.join("\n"))}return{occurrenceRetrievalRequests:e,bodyOccurrenceToRetrievalRequest:t}}getDesiredDisplayDataVolume(e){let t=0;const i=new Set;for(const s of e){const e=s.bodyOccurrence.getBodyMetaDataForRetrieval();i.has(e)||(i.add(e),s.tessellationSettingDesired>=0&&(t+=e.getEstimatedMemoryUsage([s.tessellationSettingDesired])))}return t}getLoadedDisplayDataVolume(){let e=0;const t=new Set;return this.occurrences.forEach((function(i){const s=i.getBodyMetaDataForRetrieval();t.has(s)||(t.add(s),e+=s.getEstimatedMemoryUsage())}),this),e}performUnloadedBodyAndRefinementCheck(){if(this.paused)return void o.log.info("Skipped body refinement check due to pause");if(I===E.DISABLED)return;if(!this.encounteredUnloadedOccurrenceInLastFrame&&!this.allowRefinementCheck())return;const e=S(),t=new r.Timer("BodyManager.performUnloadedBodyAndRefinementCheck",{logResult:e}),{occurrenceRetrievalRequests:i,bodyOccurrenceToRetrievalRequest:s}=this.findMaximumRefinementForOccurrences();this.occurrenceRetrievalRequests=i,this.bodyOccurrenceToRetrievalRequest=s,this.startRetrievalTimeout(),t.report()}collectBodyOccurrencesInViewport(){const e=new r.Timer("BodyManager.collectBodyOccurrencesInViewport"),t=[];let i=[];const s=this.viewer.getCamera();if(s){const e=s.viewportToCanvas([0,s.getViewportHeight(),0]),r=this.aggressiveRefinementEnabled&&(0,d.isUsagePreview)();i=this.viewer.pickInRect(e[0],e[1],s.getViewportWidth(),s.getViewportHeight(),{bodyPicks:t,nodeFilterOverride:this.refinementNodeFilter,sampleLimit:n.default.getManager().getNumber("OFFSCREEN_BODY_ERROR_SAMPLE_SIZE"),doNotAffectFrustumCulling:!0,forcePreviewPick:r})}const a=new Map;for(let e=0;e<t.length;++e){const i=t[e],s=i.primitiveId;if(s.length<1)continue;s.length>1&&o.log.warn("Picked body manager occurrence id with multiple entries");const n=this.idManager.getNameForId(s),r=this.occurrences.get(n);r&&this.collectBodyOccurrenceForOccurrencePick(a,r,i)}for(let e=0;e<i.length;++e)this.collectBodyOccurrenceForEntityPick(a,i[e]);return e.report(),a}updatePickData(e){let t=!1;const i=e.primitiveId;if(i.length<1)return t;i.length>1&&o.log.warn("Picked body manager occurrence id with multiple entries");const s=this.idManager.getNameForId(i),n=this.occurrences.get(s);if(n)if(e.bodyMetaData=n.getBodyMetaDataForRetrieval(),e.occurrence=this.getBtOccurrence(n),e.occurrence)e.occurrenceId=this.viewer.getOccurrenceIdManager().getIdForName(e.occurrence.toString()),t=!0;else{const i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();i&&(e.occurrenceId=i.getBodyComponent().getCorrectedBodyOccurrenceId(e.bodyMetaData.id),t=!0)}return t}hideBodyFromPick(e){const t=this.occurrences.get(this.getBodyOccurrenceId(e.occurrenceId,e.bodyMetaData.id));(null==t?void 0:t.incrementDetails)&&(this.displayOccurrenceData.hideIncrementFromPick(t.incrementDetails,d.BTGraphicsUsage.BASE),this.displayOccurrenceDataNonIsolated.hideIncrement(t.incrementDetails,d.BTGraphicsUsage.BASE))}shouldRetrieveHighestQualityTessellationForOccurrence(e){if(e.getBodyMetaData().getTessellationSettingOverride()!==l.GBTTessellationSettingEnum.AUTO)return!0;let t=this.getBtOccurrence(e);for(;t;){const e=this.viewer.getModelViewManagers().getManager().getOccurrenceDisplayData(t);if(e&&e.occurrenceData.forceHighestQualityTessellation)return!0;t.path.length>0?t.path.splice(t.path.length-1,1):t=null}return!1}collectBodyOccurrenceForEntityPick(e,t){if(t.isUIPick())return;const i=t.getOccurrence();let s,n,r=t.getBodyId();if(!r)return;const a=this.viewer.getModelViewManagers().getManagerForUsage(t.usage);if(i)s=this.viewer.getOccurrenceIdManager().getIdForName(i.toString()),n=a.retrieveBodyMetaData(i,r),n&&n.canBeGroupedWithOtherConstituents&&(r=n.consumingClosedCompositeData.getId());else{const e=a.getDisplayedPartStudio();if(!e)return;n=e.retrieveBodyMetaData(r),n&&n.canBeGroupedWithOtherConstituents&&(r=n.consumingClosedCompositeData.getId()),s=e.getBodyComponent().getCorrectedBodyOccurrenceId(r)}let o=this.occurrences.get(this.getBodyOccurrenceId(s,r));if(!o&&t.usage===d.BTGraphicsUsage.PREVIEW&&(o=this.previewOccurrences.get(r),!o)){const e=this.viewer.getOccurrenceDataManager().getOccurrenceData(s);e&&n&&(o=new M(e,n),this.previewOccurrences.set(r,o))}o&&this.collectBodyOccurrenceForOccurrencePick(e,o,t)}collectBodyOccurrenceForOccurrencePick(e,t,i){const s=e.get(t);s?s.viewportOccupancyRatio+=i.coverage:e.set(t,{viewportOccupancyRatio:i.coverage})}getBodiesInFrustum(){const e=new Set,t=this.viewer.getCamera();return this.occurrences.forEach((function(i){i.outsideFrustum(t)||e.add(i.getBodyMetaData())}),this),e}getBodiesInvolvedInSelection(){const e=new Set,t=(0,c.getAllSelectionLists)();for(let i=0;i<t.length;++i){t[i].forEach((t=>{let i=t.getBodyMetaData();!i&&t.getEntityMetaData()&&(i=t.getEntityMetaData().getBodyMetaData()),i&&e.add(i)}))}return e}refreshReducedDetailBoxes(){this.sortedOccurrences&&(this.sortedOccurrences.forEach((e=>{e.displayDamaged=!0})),this.shouldUpdateBodyOccurrenceLodForIsolate=!0)}onOccurrencesHighlighted(e,t){if(e===d.Action.ADD){const e=this.viewer.getModelViewManagers().getManager(),i=this.viewer.getOccurrenceIdManager();for(let s=0;s<t.length;++s){const n=e.getOccurrenceDisplayData(t[s]);if(!(null==n?void 0:n.displayedPartIds))continue;const r=i.getIdForName(t[s].toString());for(const e of n.displayedPartIds){const t=this.occurrences.get(this.getBodyOccurrenceId(r,e));(null==t?void 0:t.mustShowLowestLod())&&(t.displayDamaged=!0)}}}}getPartStudio(e){const t=this.viewer.getModelViewManagers().getManager(),i=this.getBtOccurrence(e);return i?t.getPartStudioDataFromOccurrence(i):t.getDisplayedPartStudio()}getTessellationIndexToGoUnderThreshold(e,t,i,s){let n=0;const r=e.getBodyMetaData();if(r.isWireBody()&&!r.hasTessellationSettings())return null;if(r.isClosedComposite&&r.containsOnlyWireBodies()){const t=this.getPartStudio(e);if(t)for(let e=0;e<r.constituentBodyIds.length;++e){const i=t.retrieveBodyMetaData(r.constituentBodyIds[e]);if(i&&!i.hasTessellationSettings())return null}}if(this.viewer.getRenderingMode()===l.GBTGraphicsRenderMode.SHADED_CURVATURE_VISUALIZATION)return l.BTTessellationSetting.getTessellationSettingIndexFromEnum(l.GBTTessellationSettingEnum.CURVATURE_VISUALIZATION);const a=r.getBestAvailableTessellationSettingIndex(s);if(null===a)return null;for(;n<a;){if(!(i*r.getChordalToleranceForSetting(n)>=t))break;n++}return n}cleanupPendingRefinementRequests(){if(0===this.pendingRetrievalInformation.size)return;const e=new Set;for(const[t,i]of this.pendingRetrievalInformation){t.getFinestTessellationSettingOnClient()>=i.tessellationSetting&&(e.add(t),this.pendingRetrievalInformation.delete(t))}const t=new Set;this.occurrences.forEach((function(i){const s=i.getBodyMetaDataForRetrieval();t.add(s),e.has(s)&&this.resetRetrievalStateForOccurrence(i)}),this);for(const[e,i]of this.pendingRetrievalInformation)t.has(e)||this.pendingRetrievalInformation.delete(e);S()&&o.log.info(`Number of refined pending requests: ${e.size} remaining: ${this.pendingRetrievalInformation.size}`)}unloadBodies(e,t){if(S()&&o.log.info(`Unload bodies ${f(e)}`),this.paused)return void o.log.info("Skipped body unloading due to pause");const i=Array.from(this.occurrences.values()),s=this.getBodiesInFrustum(),n=this.getBodiesInvolvedInSelection(),r=new Map;for(const e of this.occurrenceRetrievalRequests){const t=e.bodyOccurrence.getBodyMetaDataForRetrieval();r.has(t)||r.set(t,e)}const a=t.getDisplayedPartStudio(),c=t.getPartStudios();for(let e=0;e<c.length;++e){const t=c[e];if(t===a)continue;const s=t.getBodyComponent().getNonInstantiatedBodies();for(let e=0;e<s.length;++e){const n=s[e];n.hasTessellationSettings()&&i.push(new C(t,n))}}i.sort((function(e,t){if(e.isInstantiated()!==t.isInstantiated())return e.isInstantiated()?1:-1;const i=e.isBodyDataPresent(),r=t.isBodyDataPresent();if(!i&&!r)return 0;if(!i)return 1;if(!r)return-1;const a=e.getBodyMetaDataForRetrieval(),o=t.getBodyMetaDataForRetrieval(),c=n.has(a);if(c!==n.has(o))return c?1:-1;const l=s.has(a);if(l!==s.has(o))return l?1:-1;const h=e.getLastViewTime(),d=t.getLastViewTime();if(h!==d)return h>d?1:-1;const u=e.getLastViewportOccupancy(),g=t.getLastViewportOccupancy();if(u!==g)return u>g?1:-1;const p=e.getBenefitToUnload(),m=t.getBenefitToUnload();return p>m?-1:m>p?1:0}));const h=new Set;let d=0;for(let t=0;t<i.length&&d<e;++t){const e=i[t],s=e.getBodyMetaDataForRetrieval();if(s.isWireBody())continue;if(!e.isBodyDataPresent()||h.has(s)||n.has(s))continue;if(r.has(s)){const e=r.get(s);if(e.tessellationSettingRequested!==l.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING&&e.tessellationSettingRequested===s.getFinestTessellationSettingOnClient())continue}let a;a=e instanceof M?this.getPartStudio(e):e.partStudio,a&&(d+=s.getEstimatedMemoryUsage(),this.bodyUnloadTask.addBodyToProcess(a.getBodyComponent(),s.getId()),h.add(s))}if(S()){const t=[];h.forEach((function(e){t.push(e.getId()+"-"+e.getFinestTessellationSettingOnClient())})),t.sort(),o.log.info("Unloading "+f(d)+" of bodies to satisfy request of "+f(e)+". Body ids:\n"+t)}return this.occurrences.forEach((function(e){h.has(e.getBodyMetaDataForRetrieval())&&this.resetRetrievalStateForOccurrence(e)}),this),this.bodyUnloadTask.getTaskFinishedPromise()}unloadSelectionBody(e){var t;const i=e.getBodyMetaData()||(null===(t=e.getEntityMetaData())||void 0===t?void 0:t.getBodyMetaData());if(!i)return;const s=this.viewer.getModelViewManagers().getManager().getPartStudioDataFromOccurrence(e.getOccurrence());s&&this.bodyUnloadTask.addBodyToProcess(s.getBodyComponent(),i.id),this.viewer.requestDraw()}}function _(e,t){const i=e.getBenefitToCull(),s=t.getBenefitToCull();return i===s?e.getOccurrenceId()===t.getOccurrenceId()?0:e.getOccurrenceId()<t.getOccurrenceId()?-1:1:i>s?-1:1}t.BodyManager=O,t.occurrenceSortFunction=_},866435:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultNameForBody=t.BodyMetaData=t.estimateTriangleCountAtSettingIndexUsingTriangleCounts=t.constituentTypeToString=t.ConstituentType=void 0;const s=i(27050),n=i(545348),r=i(912057),a=i(606544),o=i(694393),c=i(474394),l=i(759382),h=i(723617),d=i(114924),u=[a.BTTessellationSetting.ANGULAR_TOLERANCE_COARSE,a.BTTessellationSetting.ANGULAR_TOLERANCE_MEDIUM,a.BTTessellationSetting.ANGULAR_TOLERANCE_FINE,a.BTTessellationSetting.ANGULAR_TOLERANCE_VERY_FINE,a.BTTessellationSetting.ANGULAR_TOLERANCE_CURVATURE_ANALYSIS],g=[a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_COARSE,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_MEDIUM,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_FINE,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_VERY_FINE,a.BTTessellationSetting.CHORDAL_TOLERANCE_RATIO_CURVATURE_ANALYSIS];var p;function m(e){const t=1/e;return a.BTTessellationSetting.ESTIMATION_COEFFICIENT_0+a.BTTessellationSetting.ESTIMATION_COEFFICIENT_1*t+a.BTTessellationSetting.ESTIMATION_COEFFICIENT_2*t*t}!function(e){e[e.PART=0]="PART",e[e.SURFACE=1]="SURFACE",e[e.MESH=2]="MESH",e[e.CURVE=3]="CURVE",e[e.POINT=4]="POINT",e[e.SKETCH=5]="SKETCH",e[e.NUMBER_OF_TYPES=6]="NUMBER_OF_TYPES"}(p||(t.ConstituentType=p={})),t.constituentTypeToString=function(e,t){switch(e){case p.PART:return t?i18n("parts"):i18n("part");case p.SURFACE:return t?i18n("surfaces"):i18n("surface");case p.MESH:return t?i18n("meshes"):i18n("mesh");case p.CURVE:return t?i18n("curves"):i18n("curve");case p.POINT:return t?i18n("points"):i18n("point");case p.SKETCH:return t?i18n("sketches"):i18n("sketch");default:return""}};const E=m(a.BTTessellationSetting.ANGULAR_TOLERANCE_COARSE);function I(e,t,i){const s=m(u[i]);return t/E*s+e}t.estimateTriangleCountAtSettingIndexUsingTriangleCounts=I;class T{constructor(e){this.id=e,this.name="",this.meshState=a.GBTMeshState.NO_MESH,this.constituentsContainMesh=!1,this.isModifiable=!0,this.foundInPreview=!1,this.appearance=null,this.defaultColorHash="",this.meshIncrement=null,this.tessellationSettings=null,this.isFlattenedSheetMetalBody=!1,this.isBendCenterLineBody=!1,this.ownerFlattenedBodyId="",this.sheetMetalModelId="",this.isActiveSheetMetal=!1,this.sheetMetalOrderId="",this.sheetMetalOrder=0,this.isTessellationLoaded=!1,this.coarseTriangleCount=0,this.coarsePlanarFaceTriangleCount=0,this.isAssociatedWithFlat=!1,this.colorCycle=null,this.totalEntityCount=0,this.lastViewTime=0,this.lastViewportOccupancy=0,this.partStudioVisibility=d.Visibility.VISIBLE,this.isComposite=!1,this.isClosedComposite=!1,this.constituentBodyIds_=null,this.consumingClosedCompositeData=null,this.referencingOpenCompositeData_=null,this.isSketchBody=!1,this.type=a.GBTBodyType.UNKNOWN,this.bounds=new d.BoundingBox,this.bestAvailableTessellationSetting=a.GBTTessellationSettingEnum.UNKNOWN,this.tessellationSettingOverride=a.GBTTessellationSettingEnum.AUTO,this.constituentTypeCounts=new Array(p.NUMBER_OF_TYPES).fill(0)}getId(){return this.id}setAppearanceFromDisplayData(e){e?(e.appearance&&e.appearance.color&&(this.appearance=(0,h.shallowClone)(e.appearance),this.appearance.color=new Uint8Array(e.appearance.color)),this.defaultColorHash=e.defaultColorHash):r.log.warn("setAppearanceFromDisplayData called without valid display data")}setColorCycle(e){this.colorCycle=e}getColorCycle(){return this.colorCycle}getColor(){var e,t,i,a;const o=n.default.getManager();if(this.containsOnlyWireBodies()){if(!this.isModifiableBody())return o.getColor("REFERENCE_GEOMETRY_COLOR");if(!(0,s.isCurveAppearanceEnabled)())return o.getColor("LINE_POINT_COLOR");if(3!==(null===(t=null===(e=this.appearance)||void 0===e?void 0:e.color)||void 0===t?void 0:t.length))return o.getColor("LINE_POINT_COLOR")}if(3===(null===(a=null===(i=this.appearance)||void 0===i?void 0:i.color)||void 0===a?void 0:a.length)){const e=this.appearance.color;return[e[0]/255,e[1]/255,e[2]/255,this.appearance.opacity/255]}{if(!this.isModifiableBody())return o.getColor("REFERENCE_GEOMETRY_COLOR");const e=(0,l.getPartCycleColor)(this.defaultColorHash,this.colorCycle);return this.appearance?this.appearance.color=new Uint8Array(e.slice(0,3)):r.log.warn("No appearance object associated with BodyMetaData"),(0,d.convertRGBA255ToRGBA)(e)}}isTranslucent(){return null!==this.appearance&&this.appearance.opacity<255}clone(){const e=new T(this.id);return(0,h.overwriteMatchingProperties)(e,this),e.bounds=new d.BoundingBox(this.bounds.getMin(),this.bounds.getMax()),this.referencingOpenCompositeData_&&(e.referencingOpenCompositeData_=new Map(this.referencingOpenCompositeData_)),e}setIsTessellationLoaded(e){this.isTessellationLoaded=e}getIsTessellationLoaded(){return this.consumingClosedCompositeData?this.consumingClosedCompositeData.getIsTessellationLoaded():this.isTessellationLoaded}setLastViewTime(e){this.lastViewTime=e}getLastViewTime(){return this.lastViewTime}setLastViewportOccupancy(e){this.lastViewportOccupancy=e}getLastViewportOccupancy(){return this.lastViewportOccupancy}getType(){return this.type}isSolidBody(){return!this.isComposite&&this.containsOnlySolidBodies()}containsOnlySolidBodies(){return this.type===a.GBTBodyType.SOLID}isSheetBody(){return!this.isComposite&&this.containsOnlySheetBodies()}containsOnlySheetBodies(){return this.type===a.GBTBodyType.SHEET}isWireBody(){return!this.isComposite&&this.containsOnlyWireBodies()}containsOnlyWireBodies(){return this.type===a.GBTBodyType.WIRE}isPointBody(){return!this.isComposite&&this.containsOnlyPointBodies()}containsOnlyPointBodies(){return this.type===a.GBTBodyType.POINT}containsMesh(){return this.constituentsContainMesh||a.BTPartData.containsMesh(this.meshState)}getMeshState(){return this.meshState}getMeshIncrement(){return this.meshIncrement}isModifiableBody(){return this.isModifiable}getBounds(){return this.bounds}resetMeshIncrement(){this.meshIncrement=null}getIsFlattenedSheetMetalBody(){return this.isFlattenedSheetMetalBody}getIsActiveSheetMetal(){return this.isActiveSheetMetal}getIsBendCenterLineBody(){return this.isBendCenterLineBody}isForFlattenedView(){return this.isFlattenedSheetMetalBody||this.isBendCenterLineBody||this.isAssociatedWithFlat}isSubsidiaryBody(){return this.isBendCenterLineBody}getOwnerBodyId(){return this.ownerFlattenedBodyId}get isOpenCompositeBody(){return this.isComposite&&!this.isClosedComposite}get constituentBodyIds(){return this.constituentBodyIds_}removeOpenCompositeBodyReferences(e){if(this.constituentBodyIds_)for(let t=0;t<this.constituentBodyIds_.length;++t){const i=e[this.constituentBodyIds_[t]];i&&i.removeReferencingOpenCompositeBody(this.id)}}updateConstituentBodyIds(e,t){if(this.removeOpenCompositeBodyReferences(t),this.constituentBodyIds_=e,this.constituentBodyIds_&&this.isOpenCompositeBody)for(let e=0;e<this.constituentBodyIds_.length;++e){const i=t[this.constituentBodyIds_[e]];i&&i.addReferencingOpenCompositeBody(this)}}get referencingOpenCompositeData(){return this.referencingOpenCompositeData_}addReferencingOpenCompositeBody(e){this.referencingOpenCompositeData_||(this.referencingOpenCompositeData_=new Map),this.referencingOpenCompositeData_.set(e.id,e)}removeReferencingOpenCompositeBody(e){this.referencingOpenCompositeData_&&this.referencingOpenCompositeData_.delete(e)}get isCompositeConstituent(){return this.isClosedCompositeConstituent||this.hasReferencingOpenCompositeBody}get hasReferencingOpenCompositeBody(){return!!this.referencingOpenCompositeData_&&this.referencingOpenCompositeData_.size>0}get isClosedCompositeConstituent(){return!!this.consumingClosedCompositeData}get closedCompositeParentId(){return this.consumingClosedCompositeData?this.consumingClosedCompositeData.id:null}get isGroupableCompositeBody(){return this.isClosedComposite&&this.type!==a.GBTBodyType.UNKNOWN}get isNonGroupingCompositeBody(){return!!this.isComposite&&(!this.isClosedComposite||!this.isGroupableCompositeBody)}get canBeGroupedWithOtherConstituents(){return!!this.consumingClosedCompositeData&&this.consumingClosedCompositeData.isGroupableCompositeBody}get meshGroupId(){return this.canBeGroupedWithOtherConstituents?this.consumingClosedCompositeData.id:this.id}hasFaces(){return this.containsOnlySolidBodies()||this.containsOnlySheetBodies()}hasEdges(){return this.hasFaces()||this.containsOnlyWireBodies()}hasPoints(){return this.hasEdges()||this.containsOnlyPointBodies()}hasTessellationSettings(){return null!==this.getFinestTessellationSettingOnClient()}canEntitiesBeLoaded(){return this.hasTessellationSettings()||this.isWireBody()||this.isClosedComposite&&this.containsOnlyWireBodies()}getFinestTessellationSettingOnClient(){let e=null;for(let t=0;this.tessellationSettings&&t<this.tessellationSettings.length;++t)this.tessellationSettings[t]!==a.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING&&(null===e||this.tessellationSettings[t]>e)&&(e=this.tessellationSettings[t]);return e}getBestAvailableTessellationSettingIndex(e){return e?a.BTTessellationSetting.getTessellationSettingIndexFromEnum(a.GBTTessellationSettingEnum.VERY_FINE):this.bestAvailableTessellationSetting===a.GBTTessellationSettingEnum.AUTO||this.bestAvailableTessellationSetting===a.GBTTessellationSettingEnum.UNKNOWN?null:this.bestAvailableTessellationSetting-1}getTessellationSettingOverride(){return this.tessellationSettingOverride}getChordalTolerance(){const e=this.getFinestTessellationSettingOnClient();return null===e?null:this.getChordalToleranceForSetting(e)}getChordalToleranceForSetting(e){return e<0||e>=g.length?(r.log.warn("Attempt to retrieve chordal tolerance for invalid tessellation setting"),0):this.getBounds().diameter()/2*g[e]}estimateTriangleCountAtSettingIndex(e){return I(this.coarsePlanarFaceTriangleCount,this.coarseTriangleCount,e)}getEstimatedMemoryUsage(e){if(!e&&this.hasTessellationSettings()&&(e=this.tessellationSettings),!e||0===e.length)return 0;let t=0,i=!1;for(let s=0;s<e.length;++s)e[s]!==a.BTTessellationSetting.CLIENT_UNLOADED_TESSELLATION_SETTING&&(t+=this.estimateTriangleCountAtSettingIndex(e[s])*a.BTTessellationSetting.BYTES_PER_TRIANGLE,i=!0);return t+(i?this.totalEntityCount*a.BTTessellationSetting.BYTES_PER_ENTITY:0)}shouldProduceLocalThumbnail(){const e=!this.isOpenCompositeBody;return this.isModifiable&&!this.isClosedCompositeConstituent&&!this.isForFlattenedView()&&(!e||this.hasTessellationSettings())}updateConstituentTypeCounts(e){if(!this.isComposite)return;this.constituentTypeCounts.fill(0);const t=new Set;for(let i=0;i<this.constituentBodyIds_.length;i++){const s=this.constituentBodyIds_[i],n=e.getBodyType(s);n===a.GBTBodyType.SOLID?this.constituentTypeCounts[p.PART]++:n===a.GBTBodyType.SHEET?this.constituentTypeCounts[p.SURFACE]++:n===a.GBTBodyType.WIRE?this.constituentTypeCounts[p.CURVE]++:n===a.GBTBodyType.POINT?this.constituentTypeCounts[p.POINT]++:null===n&&e.accumulateSketchIdsFromBodyId(s,t)}this.constituentTypeCounts[p.SKETCH]=t.size}updateDataDerivedFromConstituents(e,t){if(!this.isComposite)return;this.constituentsContainMesh=!1,this.type=null;const i=e=>{null===this.type?this.type=e:this.type!==e&&(this.type=a.GBTBodyType.UNKNOWN)};for(let s=0;s<this.constituentBodyIds_.length;++s){const n=this.constituentBodyIds_[s],r=t[n];if(r){this.constituentsContainMesh=this.constituentsContainMesh||a.BTPartData.containsMesh(r.closedConstituentPartData.meshState),i(r.closedConstituentPartData.bodyType);continue}const o=e[n];o&&(this.constituentsContainMesh=this.constituentsContainMesh||a.BTPartData.containsMesh(o.meshState),i(o.type))}null===this.type&&(this.type=a.GBTBodyType.UNKNOWN)}getConstituentsContainMesh(){return this.constituentsContainMesh}getName(){return this.name}getIsFromSketch(){return this.isSketchBody}}t.BodyMetaData=T,(0,o.setBodyMetaDataCreator)((function(e,t){const i=t.getBodyId(),s=t.getMeshIncrement();if(!i||!s)return null;const n=new T(i);return n.type=e,n.bounds=s.getBounds(),n})),t.getDefaultNameForBody=function(e){return(0,c.getDefaultNameForBodyType)(e?e.type:a.GBTBodyType.UNKNOWN)}},523676:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CenterOfMassIndicator=void 0;const s=i(114924),n=i(32620),r=i(264292);class a extends s.UIElement{constructor(e,t){super(t,s.HUD_SCENEGRAPH_ID),this.elementModel=e,this.centerOfMass=null}updateCenterOfMass(e){this.centerOfMass=e}updateGraphics(){this.ensureMaterialIsCreated();const e=20*(0,n.getDevicePixelRatio)(),t=(0,s.createQuad)([0,0,0],[e,0,0],[0,e,0],void 0,[0,0],[1,1]);this.updateMeshIncrement("QUAD","",t,this.viewer.getResources().centerOfMassIndicatorNodeProperties)}ensureMaterialIsCreated(){if(null===this.viewer.getResources().centerOfMassIndicatorNodeProperties){const e=(0,s.getNextPowerOfTwo)(20);if(e>(0,s.getMaximumTextureSize)())throw new Error("Center of mass texture size exceeds limit");const t=new s.Texture(this.viewer,(function(t){const i=new s.TextureDefinition(t);return i.width=e,i.height=e,i.magnificationFilter=t.LINEAR,i.minificationFilter=t.LINEAR,i.useMipmaps=!1,i.imageSource="/images/center-of-mass.png",i}));t.setHasTransparency(!0),this.viewer.getResources().centerOfMassIndicatorNodeProperties=new s.NodeProperties({primitiveType:s.PrimitiveType.TRIANGLES,material:(0,s.createTextureMaterial)(t),isPickable:!1})}}onViewWillDraw(e){if(null===this.centerOfMass||this.isHidden)return;const t=e.projectWorldPointToViewport(this.centerOfMass),i=r.mat4.create(),s=20*(0,n.getDevicePixelRatio)()/2;i[12]=Math.floor(t[0]-s),i[13]=Math.floor(t[1]-s),this.setTransform(i),this.hasMeshIncrements()||this.updateGraphics()}onDevicePixelRatioChanged(e){this.updateGraphics()}}t.CenterOfMassIndicator=a},870704:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CommentIndicator=void 0;const s=i(545348),n=i(264292),r=i(997687),a=i(845033),o=i(912057),c=i(606544),l=i(32620),h=i(613199),d=i(114924),u="commentindicator",g=s.default.getManager(),p=20,m=20,E="n",I="h";function T(e){const t=new d.ImageData;t.id=E,t.backgroundColor=g.getString("COMMENT_INDICATOR_BACKGROUND_COLOR"),t.imageName="comment-indicator.png";const i=new d.ImageData;return i.id=I,i.backgroundColor=g.getString("COMMENT_INDICATOR_HOVER_BACKGROUND_COLOR"),i.imageName="comment-indicator.png",(0,d.createAtlasFromResources)(e,Math.max(p,m),[t,i],{sourcesHaveTransparency:!0})}function S(e){if(e.getResources().commentIndicatorAtlasCreationInitiated)return;e.getResources().commentIndicatorAtlasCreationInitiated=!0;e.getTextureAtlasFactory().getAtlas("COMMENT_INDICATOR_ATLAS",T.bind(void 0,e)).then((function(t){e.getResources().commentIndicatorAtlas=t,e.getResources().commentIndicatorMaterial.ambientTexture=t.texture,(0,d.requestDraw)()}),(function(e){o.log.error(e)}))}class f extends d.UIElement{constructor(e,t,i){super(i,d.HUD_SCENEGRAPH_ID),this.occurrence=null,this.associatedComments=[],this.worldSpacePosition=null,this.hovered=!1,this.elementBeingListenedTo=null,this.parentHidden=!1,this.allCommentsHidden=!1,this.parentSheetMetalModelId=null,t&&(this.occurrence=c.BTOccurrence.getOccurrenceFromPathString(t)),(0,a.isString)(e)?this.entityDeterministicId=e:this.commentCoordinates=e,this.updateWorldPosition(),this.listenTo(this.viewer.getEventDispatcher(),d.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,this.updateWorldPosition),this.listenTo(this.viewer.getEventDispatcher(),d.BODIES_LOADED,this.updateWorldPosition),this.listenTo(this.viewer.getEventDispatcher(),d.ASSEMBLY_DATA_PROCESSED,this.updateMissingWorldPosition),this.listenTo(i.getEventDispatcher(),d.ACTIVE_SHEETMETAL_MODEL_CHANGED,this.onActiveSheetMetalModelChanged),this.listenTo(this,d.UiEvents.CLICK+u,this.onClick),this.listenTo(this,d.UiEvents.MOUSE_ENTER+u,this.onMouseEnter),this.listenTo(this,d.UiEvents.MOUSE_LEAVE+u,this.onMouseLeave)}setCommentCoordinates(e){if(this.entityDeterministicId)throw new Error("A comment should have coordinates or entity id, but not both");this.commentCoordinates=e,this.updateWorldPosition()}addComment(e){this.associatedComments.indexOf(e)<0&&this.associatedComments.push(e);!this.entityDeterministicId&&this.updateElementListener()}removeComment(e){const t=this.associatedComments.indexOf(e);t>=0&&this.associatedComments.splice(t,1),this.entityDeterministicId||this.updateElementListener()}hasComments(){return this.associatedComments.length>0}onDevicePixelRatioChanged(e){this.updateGraphics()}updateGraphics(){if(!this.viewer.getResources().commentIndicatorAtlas)return;const e=this.viewer.getResources().commentIndicatorAtlas.getTextureCoords(this.hovered?I:E);if(!e)return;const t=(0,l.getDevicePixelRatio)(),i=(0,d.createQuad)([0,0,0],[p*t,0,0],[0,m*t,0],void 0,[e.lowS,e.highT],[e.highS,e.lowT]);this.updateMeshIncrement("QUAD",u,i,this.viewer.getResources().commentIndicatorNodeProperties)}updateWorldPosition(){this.worldSpacePosition=null;const e=this.viewer.getModelViewManagers().getManager();if(this.entityDeterministicId){let t=null;if(this.occurrence&&!e.isEntityOnOccurrence(this.entityDeterministicId,this.occurrence)||(t=e.extractMeshIncrement(this.entityDeterministicId,this.occurrence)),!t)return void this.removeMeshIncrements();if(this.worldSpacePosition=this.getStickingPosition(t),this.viewer.getIsForFlattenedDisplay()){const t=e.getFlattenedEntityOwnerBodyDetails(this.entityDeterministicId,this.occurrence);if(!t||!t.transform)return this.worldSpacePosition=null,void this.removeMeshIncrements();h.mat4C.multiplyVec3(t.transform,this.worldSpacePosition),this.parentSheetMetalModelId=t.bodyMetaData.sheetMetalModelId,this.updateHideState()}}else this.worldSpacePosition=[this.commentCoordinates.x,this.commentCoordinates.y,this.commentCoordinates.z];if(this.occurrence){const t=e.getOccurrenceTransform(this.occurrence);if(!t)return this.worldSpacePosition=null,void this.removeMeshIncrements();h.mat4C.multiplyVec3(t,this.worldSpacePosition)}this.updateElementListener()}updateMissingWorldPosition(){this.worldSpacePosition||this.updateWorldPosition()}stopListeningToElement(){this.elementBeingListenedTo&&(this.stopListening(this.elementBeingListenedTo),this.elementBeingListenedTo=null)}updateElementListener(){if(this.stopListeningToElement(),this.hasBeenRemoved)return;const e=this.viewer.getModelViewManagers().getManager();if(this.occurrence){const t=e.getDisplayedAssembly();if(t){const e=this.occurrence.getPathAsString();this.onParentVisibilityChange(t.getOccurrenceVisibility(this.occurrence)),this.listenTo(t,"OCCURRENCE_VISIBILITY_CHANGE."+e,this.onParentVisibilityChange),this.listenTo(t,"OCCURRENCE_DATA_CHANGE."+e,this.updateWorldPosition),this.listenTo(t,"OCCURRENCE_DELETED."+e,this.updateWorldPosition),this.elementBeingListenedTo=t}}else this.entityDeterministicId?this.addEntityListeners(this.entityDeterministicId):this.addCommentListenersForAssociatedComments()}addCommentListenersForAssociatedComments(){const e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(e)for(const t of this.associatedComments)if(t.deterministicIds)for(const i of t.deterministicIds){if(e.retrieveBodyMetaData(i))this.listenToBodyVisibility(i,e);else{e.retrieveEntityMetaData(i)&&this.addEntityListeners(i)}}}addEntityListeners(e){const t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),i=null==t?void 0:t.retrieveEntityMetaData(e);t&&i&&(i.isFromBody()?this.listenToBodyVisibility(i.getBodyId(),t):this.listenToFeatureVisibility(i.getLastFeatureId(),t))}listenToBodyVisibility(e,t){this.onParentVisibilityChange(t.getBodyVisibility(e)),this.listenTo(t,"BODY_VISIBILITY_CHANGE."+e,this.onParentVisibilityChange),this.elementBeingListenedTo=t}listenToFeatureVisibility(e,t){this.onParentVisibilityChange(t.getFeatureVisibility(e)),this.listenTo(t,"FEATURE_VISIBILITY_CHANGE."+e,this.onParentVisibilityChange),this.elementBeingListenedTo=t}onParentVisibilityChange(e){this.parentHidden=e===d.Visibility.HIDDEN,this.updateHideState()}setAllCommentsHidden(e){this.allCommentsHidden=e,this.updateHideState()}updateHideState(){let e=!1;this.parentSheetMetalModelId&&this.parentSheetMetalModelId!==this.viewer.getModelViewManagers().getManager().getSelectedSheetmetalModelId()&&(e=!0),this.allCommentsHidden||this.parentHidden||e?this.hide():this.show()}getStickingPosition(e){return e.getPositionNearCenter()}onViewWillDraw(e){if(S(this.viewer),this.isHidden||!this.worldSpacePosition||!this.viewer.getResources().commentIndicatorAtlas)return;this.viewer.getResources().commentIndicatorMaterial.ambientTexture=this.viewer.getResources().commentIndicatorAtlas.texture;const t=e.projectWorldPointToViewport(this.worldSpacePosition),i=n.mat4.create();i[12]=Math.floor(t[0]-p/2),i[13]=Math.floor(t[1]-m/2),this.setTransform(i),this.hasMeshIncrements()||this.updateGraphics()}onClick(e,t){t.skipCommentClearHighlight=!0,r.btInjector.CommentService.highlightComments(this.associatedComments)}onMouseEnter(){this.hovered=!0,this.removeMeshIncrements(),(0,d.requestDraw)()}onMouseLeave(){this.hovered=!1,this.removeMeshIncrements(),(0,d.requestDraw)()}onActiveSheetMetalModelChanged(e){this.parentSheetMetalModelId&&this.updateHideState()}}t.CommentIndicator=f},465528:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlPointGridDisplay=void 0;const s=i(545348),n=i(13596),r=i(114924),a=i(264292),o=s.default.getManager(),c=o.getNumber("CONTROL_POINT_GRID_LINE_WIDTH"),l="controlPointGrid",h=new r.NodeProperties({primitiveType:r.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isTwoSided:!1,isShowThrough:!1,isDepthTested:!0}),d=new r.NodeProperties({primitiveType:r.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isShowThrough:!0,isTwoSided:!0,isDepthTested:!1,isStencilTested:!0}),u=o.getStipple("CURVATURE_UV_TOOTH_STIPPLE");class g extends r.UIElement{constructor(e,t,i,s){super(s),this.edgeId=e,this.controlPointData=t,this.checkboxStates=i,this.id=l+"."+e,this.update()}onAppearanceConstantsUpdated(){this.update()}update(){if(this.isHidden)return;const e=[];if(this.checkboxStates[n.EdgeCurvatureCheckboxNames.CPT_GRIDS]){const t=this.controlPointData.controlPoints;if(t.length){const i=t.length,s=t[0].length/3;for(let n=0;n<i;n++){const i=t[n];for(let t=1;t<s;t++)for(let s=t-1;s<=t;s++){const t=a.vec3.fromValues(i[3*s],i[3*s+1],i[3*s+2]);e.push(t)}}for(let n=0;n<s;n++)for(let s=1;s<i;s++)for(let i=s-1;i<=s;i++){const s=a.vec3.fromValues(t[i][3*n],t[i][3*n+1],t[i][3*n+2]);e.push(s)}}}const t=o.getColor("CONTROL_POINT_GRID_COLOR"),i=(0,r.createLines)(e,void 0,t,c);this.updateMeshIncrement(l+".grid",r.NO_SELECTION_ID,i,h);const s=(0,r.createLines)(e,void 0,t,c,u);this.updateMeshIncrement(l+".stippled",r.NO_SELECTION_ID,s,d)}onCheckboxStatesUpdate(e){this.checkboxStates=e,this.update()}pointToVec3(e){return a.vec3.fromValues(e.x,e.y,e.z)}}t.ControlPointGridDisplay=g},539431:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.InferenceDisplayWithoutHover=t.InferenceDisplay=void 0;const s=i(545348),n=i(264292),r=i(433542),a=i(873896),o=i(613199),c=i(114924),l=s.default.getManager();class h extends c.UIElement{constructor(e,t,i){super(t),this.inferenceData=e,this.hovered=!1,this.selected=!1,this.lastScale=-1,this.lastPickScale=-1;const s=this.inferenceData.isInContextEntity?n.mat4.create():this.getOccurrenceTransform(this.inferenceData.occurrence,i);this.worldSpaceTransform=o.mat4C.multiply(s,this.inferenceData.coordinateSystem.getGlMatrix()),this.worldSpacePosition=[this.worldSpaceTransform[12],this.worldSpaceTransform[13],this.worldSpaceTransform[14]],this.inferenceId=c.INVALID_ID,(0,c.requestDraw)()}setInferenceId(e){this.inferenceId=e}getInferenceId(){return this.inferenceId}onDevicePixelRatioChanged(e){this.updateGraphics()}setHovered(e){e!==this.hovered&&(this.hovered=e,this.updateGraphics())}getOccurrenceTransform(e,t){return t?t(e.getPathAsString()):this.viewer.getModelViewManagers().getManager().getOccurrenceTransform(e)}onViewWillDraw(e,t){this.updateTransform(e)}updateTransform(e){const t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(Math.abs(this.lastScale-t)<a.Tolerances.ZERO_LENGTH)return;this.lastScale=t;const i=n.mat4.create();i[0]=t,i[5]=t,i[10]=t,this.setTransform(o.mat4C.multiply(this.worldSpaceTransform,i,n.mat4.create())),this.hasMeshIncrements()||this.updateGraphics()}isAxialInference(e){return e===r.GBTEntityInferenceType.TOP_AXIS_POINT||e===r.GBTEntityInferenceType.MID_AXIS_POINT||e===r.GBTEntityInferenceType.BOTTOM_AXIS_POINT||e===r.GBTEntityInferenceType.LOOP_CENTER||e===r.GBTEntityInferenceType.CENTER}updateGraphicsNoHover(e){this.isAxialInference(this.inferenceData.inferenceType)?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTER_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTER_LINES].clone(),c.INFERENCE_LINE_PROPERTIES)):this.inferenceData.inferenceType===r.GBTEntityInferenceType.MID_POINT?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_MID_POINT_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_MID_POINT_LINES].clone(),c.INFERENCE_LINE_PROPERTIES)):this.inferenceData.inferenceType===r.GBTEntityInferenceType.CENTROID?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTROID_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_CENTROID_LINES].clone(),c.INFERENCE_LINE_PROPERTIES)):this.isOriginAxisInference()?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES,e[c.IncrementId.INFERENCE_POINT_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES,e[c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES].clone(),c.INFERENCE_LINE_PROPERTIES),this.removeMeshIncrement(c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED)):(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_POINT_TRIANGLES].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.INFERENCE_POINT_LINES].clone(),c.INFERENCE_LINE_PROPERTIES))}isOriginAxisInference(){return this.inferenceData&&(this.inferenceData.inferenceType===r.GBTEntityInferenceType.ORIGIN_X||this.inferenceData.inferenceType===r.GBTEntityInferenceType.ORIGIN_Y||this.inferenceData.inferenceType===r.GBTEntityInferenceType.ORIGIN_Z)}updateGraphics(){const e=(0,c.getStaticIncrements)();this.hovered?(this.updateMeshIncrement(c.IncrementId.TRIANGLES,c.NO_SELECTION_ID,e[c.IncrementId.TRIANGLES_PRESELECTED].clone(),c.INFERENCE_TRIANGLE_PROPERTIES),this.updateMeshIncrement(c.IncrementId.LINES,c.NO_SELECTION_ID,e[c.IncrementId.LINES].clone(),c.INFERENCE_LINE_PROPERTIES),this.isOriginAxisInference()&&this.updateMeshIncrement(c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED,c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED,e[c.IncrementId.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED].clone(),c.INFERENCE_LINE_PROPERTIES)):this.updateGraphicsNoHover(e)}updateOccurrenceTransform(e){if(this.inferenceData){this.worldSpaceTransform=o.mat4C.multiply(e,this.inferenceData.coordinateSystem.getGlMatrix()),this.worldSpacePosition=[this.worldSpaceTransform[12],this.worldSpaceTransform[13],this.worldSpaceTransform[14]];const t=n.mat4.create();t[0]=this.lastScale,t[5]=this.lastScale,t[10]=this.lastScale,this.setTransform(o.mat4C.multiply(this.worldSpaceTransform,t,n.mat4.create())),this.hasMeshIncrements()||this.updateGraphics(),(0,c.requestDraw)()}}getUpdatedPickIncrement(e,t){let i=null;if(this.isOriginAxisInference()){const s=t.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(Math.abs(s-this.lastPickScale)>a.Tolerances.ZERO_LENGTH){const t=n.mat4.create();t[0]=s,t[5]=s,t[10]=s;const r=5*l.getNumber("MATE_CONNECTOR_AXIS_LINE_LENGTH_PX"),a=3*l.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_WIDTH"),h=[0,0,r*s],d=o.mat4C.multiplyVec3(this.worldSpaceTransform,h,n.vec3.create());i=(0,c.createLine)([0,0,0],d,e.toString(),void 0,a),i.id=e.toString(),this.lastPickScale=s}}else 1!==this.lastPickScale&&(i=(0,c.createPoint)(this.worldSpacePosition,e.toString()),this.lastPickScale=1);return i&&(i.pickId=e),i}}t.InferenceDisplay=h;t.InferenceDisplayWithoutHover=class extends h{constructor(e,t){super(e,t)}updateGraphics(){const e=(0,c.getStaticIncrements)();this.updateGraphicsNoHover(e)}}},37123:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DihedralCombDisplay=void 0;const s=i(545348),n=i(264292),r=i(845033),a=i(114924),o=i(98357),c=i(837454),l=s.default.getManager(),h="dihedralComb",d=h+".low",u=h+".mid",g=h+".high",p=h+".zeropoint",m=l.getNumber("DIHEDRAL_TOOTH_LINE_WIDTH"),E=l.getNumber("DIHEDRAL_ZERO_POINT_SIZE"),I=l.getStipple("DIHEDRAL_TOOTH_STIPPLE"),T=new a.NodeProperties({primitiveType:a.PrimitiveType.POINTS,isPickable:!1,isHighlightable:!1,isTwoSided:!0,isShowThrough:!0,priority:c.RenderOrderPriority.HIGHEST}),S=new a.NodeProperties({primitiveType:a.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isTwoSided:!1,isShowThrough:!1,isDepthTested:!0}),f=new a.NodeProperties({primitiveType:a.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isShowThrough:!0,isTwoSided:!0,isDepthTested:!1,isStencilTested:!0});class C extends a.UIElement{constructor(e,t,i,s,n,r,a,o){super(o),this.edgeId=e,this.dihedralData=t,this.scale=i,this.coefficient=s,this.lowRadians=n,this.highRadians=r,this.useThresholdDisplay=a,this.id=h+"."+e,this.update()}onAppearanceConstantsUpdated(){this.update()}update(){if(this.isHidden)return;const e=l.getColor("DIHEDRAL_HIGH_THRESHOLD_COLOR"),t=l.getColor("DIHEDRAL_MID_THRESHOLD_COLOR"),i=l.getColor("DIHEDRAL_LOW_THRESHOLD_COLOR"),s=this.createAndSortLineData();this.updateLines(s.lowLines,i,this.id+d),this.updateLines(s.midLines,t,this.id+u),this.updateLines(s.highLines,e,this.id+g),this.updatePoints(s.points)}updatePoints(e){const t=l.getColor("DIHEDRAL_HIGH_THRESHOLD_COLOR"),i=l.getColor("DIHEDRAL_MID_THRESHOLD_COLOR"),s=l.getColor("DIHEDRAL_LOW_THRESHOLD_COLOR"),n=new Float32Array(3*e.length),r=new Int32Array(e.length);for(let t=0;t<e.length;++t){r[t]=t;const i=e[t];for(let e=0;e<3;e++)n[3*t+e]=i[e]}let c=i;this.useThresholdDisplay&&(0<=this.lowRadians?c=s:0>=this.highRadians&&(c=t));const h=new a.MeshIncrement(a.PrimitiveType.POINTS,n,r,void 0);(0,o.addColorToIncrement)(c,h),(0,o.addSizeToIncrement)(E,h),this.updateMeshIncrement(this.id+p,a.NO_SELECTION_ID,h,T)}updateLines(e,t,i){const s=(0,a.createLines)(e,void 0,t,m);this.updateMeshIncrement(i,a.NO_SELECTION_ID,s,S);const n=(0,a.createLines)(e,void 0,t,m,I);this.updateMeshIncrement(i+".stipple",a.NO_SELECTION_ID,n,f)}getFitBounds(){const e=this.getInstantiatedMeshIncrement(this.id+d).meshIncrement.getBounds(),t=this.getInstantiatedMeshIncrement(this.id+u).meshIncrement.getBounds(),i=this.getInstantiatedMeshIncrement(this.id+g).meshIncrement.getBounds();return e.addBox(t),e.addBox(i),e}setScale(e){this.scale=e}setCoefficient(e){this.coefficient=e}setThresholdValues(e,t){this.lowRadians=e,this.highRadians=t}setUseThresholdDisplay(e){this.useThresholdDisplay=e}static getComb(e,t,i){const s=e.position.getVec3(),a=e.direction.getVec3(),o=(0,r.round)(e.magnitudeRadians,5),c=t*i*o;return[s,n.vec3.scaleAndAdd(n.vec3.create(),s,a,c),o]}createAndSortLineData(){const e=[],t=[],i=[],s=[],n=this.dihedralData.dihedrals;for(let r=0;r<n.length;r++){const[a,o,c]=C.getComb(n[r],this.scale,this.coefficient);Math.abs(c)<C.NEAR_ZERO_RADIAN_THRESHOLD?s.push(a):this.sortCombToArrays(c,a,o,t,e,i)}return{lowLines:t,midLines:e,highLines:i,points:s}}sortCombToArrays(e,t,i,s,n,r){this.useThresholdDisplay?Math.abs(e)<Math.abs(this.lowRadians)?s.push(t,i):Math.abs(e)>Math.abs(this.highRadians)?r.push(t,i):n.push(t,i):n.push(t,i)}}t.DihedralCombDisplay=C,C.NEAR_ZERO_RADIAN_THRESHOLD=Math.PI/180*.05},717495:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DihedralExtremaDisplay=void 0;const s=i(545348),n=i(996408),r=i(114924),a=s.default.getManager();class o extends r.UIElement{constructor(e,t,i,s,n,r){super(r),this.id="dihedralExtrema."+e,this.dihedral=t,this.scale=i,this.coefficient=s,this.text=n,this.textHeightPx=a.getNumber("DIMENSION_VALUE_HEIGHT_PIXELS"),this.font=a.getString("DIMENSION_VALUE_FONT"),this.color=a.getColor("DIMENSION_VALUE_TEXT_COLOR"),this.needsUpdating=!0,this.update()}update(){var e;if(this.isHidden||!this.needsUpdating)return;null===(e=this.textDisplay)||void 0===e||e.remove();const[t,i,s]=r.DihedralCombDisplay.getComb(this.dihedral,this.scale,this.coefficient),a=Math.abs(s)<r.DihedralCombDisplay.NEAR_ZERO_RADIAN_THRESHOLD?t:i;this.textDisplay=new n.Text({origin:a,heightPx:this.textHeightPx,color:this.color,font:this.font,orientToScreen:!0,offsetRight:r.BoundingSpot.MID,offsetUp:r.BoundingSpot.LOW},this.viewer),this.textDisplay.setText(this.text),this.needsUpdating=!1}remove(){super.remove(),this.textDisplay.remove()}setScaleAndCoefficient(e,t){this.scale=e,this.coefficient=t,this.needsUpdating=!0}setString(e){this.text=e,this.needsUpdating=!0}}t.DihedralExtremaDisplay=o},935037:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DimensionComponent=void 0;const s=i(114924),n=i(772687),r=i(316641),a=i(606544),o=i(997687);class c{constructor(e,t,i){this.usage=e,this.elementId=t,this.viewer=i,this.dimensionData={},this.dimensionDisplays={},this.visibleDimensionBounds=null,(0,s.viewerCheck)(i),this.activeSketchIds=new n.StringSet}processDisplayData(e){if(this.usage!==s.BTGraphicsUsage.PREVIEW){this.dimensionData={};for(let t=0;t<e.dimensions.length;++t){const i=e.dimensions[t];i&&i.isAssociatedWithFlat===this.viewer.getIsForFlattenedDisplay()&&(this.dimensionData[i.getFullyQualifiedId()]=i)}}}reset(){this.remove(),this.dimensionData={},this.activeSketchIds.clear()}remove(){Object.values(this.dimensionDisplays).forEach((function(e){e.remove()})),this.dimensionDisplays={}}isDimensionForDisplayedSheetMetalModel(e,t){if(!this.viewer.getIsForFlattenedDisplay())return!0;const i=this.viewer.getModelViewManagers().getManager(),s=t||i.getSelectedSheetmetalModelId(),n=this.dimensionData[e];if(n){return s===i.getDisplayedPartStudio().getSketchComponent().getSMModelIdForSketch(n.featureId)}return!0}showDimensionsWithSheetmetalModelIdOnly(e,t){for(const t in this.dimensionDisplays){const i=this.isDimensionForDisplayedSheetMetalModel(t,e),s=this.dimensionDisplays[t],n=this.dimensionData[t];i&&n&&this.activeSketchIds.contains(n.featureId)?s&&(s.show(),this.resetVisibleDimensionBounds()):s.hide()}}updateDisplays(){let e,t;const i=[];for(e in this.dimensionDisplays)this.dimensionData.hasOwnProperty(e)||i.push(e);for(let s=0;s<i.length;++s)e=i[s],t=this.dimensionDisplays[e],t.remove(),delete this.dimensionDisplays[e];Object.entries(this.dimensionData).forEach((function([e,i]){if(t=this.dimensionDisplays[e],!t){if(t=(0,s.createDimensionForDisplayData)(i,this.elementId,this.viewer),!t)return;this.dimensionDisplays[e]=t,this.activeSketchIds.contains(i.featureId)&&this.isDimensionForDisplayedSheetMetalModel(e)?(t.show(),this.resetVisibleDimensionBounds()):t.hide()}if(this.viewer.getIsForFlattenedDisplay()){const e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),s=e.getSketchComponent().getOwnerFlattenedBodyIdForSketch(i.featureId);if(s){const i=e.retrieveBodyMetaData(s);if(i){const s=e.getBodyComponent().getTransformFromSheetMetalBodyMetaData(i);t.setAppliedTransform(s)}}}t.updateFromDisplayData(i)}),this),this.updateDimensionsToLatestFromModel()}displaySketchAsActive(e,t){this.activeSketchIds.contains(e)!==t&&(Object.entries(this.dimensionDisplays).forEach((function([i,s]){s.getFeatureId()===e&&(t&&this.isDimensionForDisplayedSheetMetalModel(i)?s.show():s.hide())}),this),t?this.activeSketchIds.add(e):this.activeSketchIds.remove(e),this.resetVisibleDimensionBounds(),this.updateDimensionsToLatestFromModel())}updateDimensionsToLatestFromModel(){const e=r.DocumentClientCache.getSingleton().getModelTreeState(this.elementId);e&&this.updateDimensionsFromModel(e.getModelTree())}getDimensionId(e,t,i){let s="";return i&&c.parameterIdsIncludedInDisplayData.includes(i)&&(s=i),a.BTDimensionDisplayData.createFullyQualifiedId(e,t,s)}updateDimensionsFromModel(e){const t=new Map,i=e.children;for(const e of i)if(e instanceof a.BTMSketch&&this.activeSketchIds.contains(e.featureId))for(const i of e.constraints)for(const s of i.parameters){if(s instanceof a.BTMParameterConfigured){const n=this.getDimensionId(e.featureId,i.entityId,s.parameterId),r=s.getParameterForCurrentConfiguration(o.btInjector.ConfigurationsService);t.set(n,{configured:!0,expression:h(r)?r.expression:void 0});break}if(h(s)){const n=this.getDimensionId(e.featureId,i.entityId,s.parameterId);t.set(n,{expression:s.expression})}}Object.entries(this.dimensionDisplays).forEach((([e,i])=>{var s,n;const r=t.get(e);i.setIsConfigured(null!==(s=null==r?void 0:r.configured)&&void 0!==s&&s),i.setExpression(null!==(n=null==r?void 0:r.expression)&&void 0!==n?n:"")}))}sketchHidden(e){this.activeSketchIds.contains(e)&&Object.values(this.dimensionDisplays).forEach((function(t){t.getFeatureId()===e&&(t.hide(),this.resetVisibleDimensionBounds())}),this)}sketchShown(e){this.activeSketchIds.contains(e)&&Object.entries(this.dimensionDisplays).forEach((function([t,i]){i.getFeatureId()===e&&this.isDimensionForDisplayedSheetMetalModel(t)&&(i.show(),this.resetVisibleDimensionBounds())}),this)}getDimensionGraphic(e,t,i){const s=this.getDimensionId(e,t,i);return this.dimensionDisplays[s]}getDimensionGraphicFromSketch(e){return Object.values(this.dimensionDisplays).filter((t=>t.getDisplayData().featureId===e))}getDimensionBoundsForFeature(e){if(!this.activeSketchIds.contains(e))return null;const t=new s.BoundingBox;return Object.values(this.dimensionDisplays).forEach((function(i){i.getFeatureId()===e&&t.addBox(i.getFitBounds())}),this),t}resetVisibleDimensionBounds(){this.visibleDimensionBounds=null}getVisibleDimensionBounds(){return this.activeSketchIds.isEmpty()?null:(this.visibleDimensionBounds||(this.visibleDimensionBounds=new s.BoundingBox,Object.values(this.dimensionDisplays).forEach((function(e){e.isVisibleToUser()&&this.visibleDimensionBounds.addBox(e.getFitBounds())}),this)),this.visibleDimensionBounds)}}t.DimensionComponent=c,c.parameterIdsIncludedInDisplayData=[a.BTMSketchConstraint.RHO_PARAMETER_NAME,a.BTMSketchConstraint.PATTERN_INSTANCE_COUNT1_PARAMETER_NAME,a.BTMSketchConstraint.PATTERN_INSTANCE_COUNT2_PARAMETER_NAME];const l=new Set([a.BTMSketchConstraint.LENGTH_PARAMETER_NAME,a.BTMSketchConstraint.ANGLE_PARAMETER_NAME,a.BTMSketchConstraint.RHO_PARAMETER_NAME,a.BTMSketchConstraint.PATTERN_INSTANCE_COUNT1_PARAMETER_NAME,a.BTMSketchConstraint.PATTERN_INSTANCE_COUNT2_PARAMETER_NAME]);function h(e){return e instanceof a.BTMParameterQuantity&&l.has(e.parameterId)}},313297:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeCurvatureDisplay=void 0;const s=i(545348),n=i(333102),r=i(589649),a=i(817254),o=i(873896),c=i(13596),l=i(114924),h=i(98357),d=i(837454),u=i(264292),g=i(613199),p=s.default.getManager(),m="edgeCurvature",E=new l.NodeProperties({primitiveType:l.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isTwoSided:!1,isShowThrough:!1,isDepthTested:!0}),I=new l.NodeProperties({primitiveType:l.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isShowThrough:!0,isTwoSided:!0,isDepthTested:!1,isStencilTested:!0}),T=new l.NodeProperties({primitiveType:l.PrimitiveType.POINTS,isPickable:!1,isHighlightable:!1,isTwoSided:!0,isShowThrough:!0,priority:d.RenderOrderPriority.HIGHEST}),S=new l.NodeProperties({primitiveType:l.PrimitiveType.TRIANGLES,isPickable:!1,isHighlightable:!1,isTwoSided:!0,isShowThrough:!0,priority:d.RenderOrderPriority.HIGHEST}),f=p.getStipple("CURVATURE_UV_TOOTH_STIPPLE"),C=p.getNumber("CURVATURE_TOOTH_LINE_WIDTH"),P=p.getNumber("CURVATURE_UV_TOOTH_LINE_WIDTH"),v=p.getNumber("CURVATURE_UV_ROOF_LINE_WIDTH"),D=p.getNumber("CURVATURE_ROOF_LINE_WIDTH"),M=p.getStipple("CURVATURE_UV_ROOF_STIPPLE"),y=Math.pow(o.Tolerances.MAX_MODEL_SIZE,2),O=p.getNumber("INFLECTION_POINT_SIZE"),_=p.getNumber("INFLECTION_TRIANGLE_HEIGHT_PX"),A=p.getNumber("INFLECTION_TRIANGLE_WIDTH_PX");class R extends l.UIElement{constructor(e,t,i,s,n,r,a){super(r),this.edgeId=e,this.curvatureData=t,this.curvatureSize=i,this.checkboxStates=s,this.entityCurvatureWrapper=a,this.curvaturePower=n,this.id=m+"."+e,this.listenTo(r.getEventDispatcher(),l.ACTIVE_SHEETMETAL_MODEL_CHANGED,this.onActiveSheetMetalModelChanged),this.update()}onAppearanceConstantsUpdated(){this.update()}update(){if(this.isHidden)return;const e=p.getColor("CURVATURE_TOOTH_COLOR"),t=p.getColor("CURVATURE_U_TOOTH_COLOR"),i=p.getColor("CURVATURE_V_TOOTH_COLOR"),s=p.getColor("CURVATURE_U_ROOF_COLOR"),n=p.getColor("CURVATURE_V_ROOF_COLOR"),a=p.getColor("CURVATURE_ROOF_COLOR"),o=[],h=[];let d;if(this.curvatureData&&this.checkboxStates[c.EdgeCurvatureCheckboxNames.CURVATURE_COMBS]){const e=this.curvatureData.curvatures.length;for(let t=0;t<e;t++){const i=this.curvatureData.curvatures[t],s=this.curvatureData.positions[t],n=u.vec3.fromValues(s.x,s.y,s.z),a=this.curvatureData.normals[t],c=u.vec3.fromValues(a.x,a.y,a.z),l=this.curvatureSize*Math.pow(i,this.curvaturePower),p=g.vec3C.add(n,g.vec3C.scale(c,l,u.vec3.create()),u.vec3.create()),m=t%r.BTEdgeCurvatureData.OVERSAMPLING_SCALE!=0,E=t===e-1&&t>0&&o.length>1&&u.vec3.equals(o[0],n)&&u.vec3.equals(o[1],p);Math.max(u.vec3.squaredLength(n),u.vec3.squaredLength(p))<y?(m||E||o.push(n,p),d&&h.push(d,p),d=p):d=void 0}}let T=e,S=C,O=a,_=D;this.entityCurvatureWrapper.isFaceCurvature()&&(T=this.entityCurvatureWrapper.isFaceUCurve()?t:i,S=P,O=this.entityCurvatureWrapper.isFaceUCurve()?s:n,_=v);const A=(0,l.createLines)(o,void 0,T,S);this.updateMeshIncrement(m+".teeth",l.NO_SELECTION_ID,A,E);const R=(0,l.createLines)(o,void 0,T,S,f);this.updateMeshIncrement(m+".stippledTeeth",l.NO_SELECTION_ID,R,I);const N=(0,l.createLines)(h,void 0,O,_);this.updateMeshIncrement(m+".roof",l.NO_SELECTION_ID,N,E);const w=(0,l.createLines)(h,void 0,O,_,M);this.updateMeshIncrement(m+".stippledroof",l.NO_SELECTION_ID,w,I),this.updateInflectionPointIndicators(),this.updateMinimumRadiusOfCurvatureIndicator()}updateInflectionPointIndicators(){if(!this.curvatureData||!this.curvatureData.inflectionPointPositions)return;const e=[],t=this.curvatureData.inflectionPointPositions.length,i=new Float32Array(15*t),s=new Float32Array(15*t),n=new Int32Array(6*t);if(this.checkboxStates[c.EdgeCurvatureCheckboxNames.INFLECTION_POINTS]){if(this.curvatureData.inflectionPointPositions.length!==this.curvatureData.tangentsAtInflectionPoints.length)return;for(let r=0;r<t;r++){const t=this.curvatureData.inflectionPointPositions[r],a=u.vec3.fromValues(t.x,t.y,t.z);e.push(a);const c=this.curvatureData.tangentsAtInflectionPoints[r],l=u.vec3.fromValues(c.x,c.y,c.z),h=this.viewer.getCamera().getPixelSizeAtWorldPoint(a),d=this.viewer.getCamera().projectWorldPointToCanvas(a),p=this.viewer.getCamera().getRay(d[0],d[1]).direction,m=g.vec3C.cross(p,l,u.vec3.create());g.vec3C.length(m)>o.Tolerances.ZERO_LENGTH&&g.vec3C.normalize(m);const E=g.vec3C.cross(p,m,u.vec3.create()),I=g.vec3C.scale(m,h*_,u.vec3.create()),T=g.vec3C.scale(m,h*-_,u.vec3.create()),S=g.vec3C.scale(E,h*-A/2,u.vec3.create()),f=g.vec3C.scale(E,h*A/2,u.vec3.create()),C=[g.vec3C.add(a,g.vec3C.add(I,f,u.vec3.create()),u.vec3.create()),g.vec3C.add(a,g.vec3C.add(I,S,u.vec3.create()),u.vec3.create()),a,g.vec3C.add(a,g.vec3C.add(T,f,u.vec3.create()),u.vec3.create()),g.vec3C.add(a,g.vec3C.add(T,S,u.vec3.create()),u.vec3.create())],P=[0,1,2,3,4,2];for(let e=0;e<6;e++)5!==e&&(i.set(C[e],15*r+3*e),s.set(p,15*r+3*e)),n[6*r+e]=5*r+P[e]}}const r=new l.MeshIncrement(l.PrimitiveType.TRIANGLES,i,n);r.normals=s;const a=p.getColor("INFLECTION_POINT_COLOR");(0,h.addColorToIncrement)(a,r),(0,h.addSizeToIncrement)(O,r),this.updateMeshIncrement(m+".inflectionTriangles",l.NO_SELECTION_ID,r,S);const d=new Float32Array(3*e.length),E=new Int32Array(e.length);for(let t=0;t<e.length;++t){E[t]=t;for(let i=0;i<3;++i)d[3*t+i]=e[t][i]}const I=new l.MeshIncrement(l.PrimitiveType.POINTS,d,E,void 0);(0,h.addColorToIncrement)(a,I),(0,h.addSizeToIncrement)(O,I),this.updateMeshIncrement(m+".inflectionPoint",l.NO_SELECTION_ID,I,T)}updateMinimumRadiusOfCurvatureIndicator(){if(this.checkboxStates[c.EdgeCurvatureCheckboxNames.MINIMUM_RADIUS]&&this.curvatureData&&this.curvatureData.coordinateSystemOfCurvatureCircle){const e=this.curvatureData.coordinateSystemOfCurvatureCircle.getGlMatrix(),t=u.vec3.fromValues(e[12],e[13],e[14]),i=u.vec3.fromValues(e[8],e[9],e[10]),s=this.curvatureData.minimumRadiusOfCurvature,r=(0,l.createCircle)(t,this.curvatureData.minimumRadiusOfCurvature,i,100),o=p.getColor("RADIUS_OF_CURVATURE_CIRCLE_COLOR");(0,h.addColorToIncrement)(o,r),(0,h.addSizeToIncrement)(D,r),this.updateMeshIncrement(m+".radius",l.NO_SELECTION_ID,r,E);const c=new a.BTRadialDimensionDisplayData;c.id="fakeDimensionId",c.featureId="fakeSketchId",c.parameterId="length",c.value=this.curvatureData.minimumRadiusOfCurvature,c.coordinateSystem.m00=1,c.coordinateSystem.m01=0,c.coordinateSystem.m10=0,c.coordinateSystem.m11=1,c.coordinateSystem.m02=0,c.coordinateSystem.m12=0,c.coordinateSystem.m22=1;const d=-Math.PI,g=this.curvatureData.minimumRadiusOfCurvature/2,I=-Math.PI,T=I;c.positionR=g,c.positionT=d,c.witnessEndPoint0r=s,c.witnessEndPoint0t=I,c.witnessEndPoint1r=s,c.witnessEndPoint1t=T,c.planeMatrix=this.curvatureData.coordinateSystemOfCurvatureCircle,c.radiusDisplay=n.GBTRadiusDisplay.RADIAL,c.isDriven=!0,this.diameterGraphics||(this.diameterGraphics=new l.RadialDimension(this.viewer,!0)),this.diameterGraphics.updateFromDisplayData(c)}else this.removeMeshIncrement(m+".radius"),this.diameterGraphics&&(this.diameterGraphics.remove(),this.diameterGraphics=null)}updateSizeAndPower(e,t){this.curvatureSize===e&&this.curvaturePower===t||(this.curvatureSize=e,this.curvaturePower=t,this.update())}show(){super.show(),this.diameterGraphics&&this.diameterGraphics.show(),this.update()}hide(){super.hide(),this.diameterGraphics&&this.diameterGraphics.hide()}remove(){super.remove(),this.diameterGraphics&&this.diameterGraphics.remove()}getFitBounds(){return this.getInstantiatedMeshIncrement(m+".teeth").meshIncrement.getBounds()}onViewWillDraw(e,t){this.updateInflectionPointIndicators()}onActiveSheetMetalModelChanged(e){this.curvatureData.ownerBodySheetMetalModelId&&(this.curvatureData.ownerBodySheetMetalModelId!==e?this.hide():this.show())}onCheckboxStatesUpdate(e){this.checkboxStates=e,this.update()}}t.EdgeCurvatureDisplay=R},767843:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgePoint=void 0;const s=i(114924),n=i(193786),r=i(545348),a=i(606544),o=i(264292),c=i(613199),l=r.default.getManager(),h=new s.NodeProperties({primitiveType:s.PrimitiveType.POINTS,isPickable:!0,isShowThrough:!0,isDepthTested:!1});class d extends s.PointElement{constructor(e,t,i,s){super(d.getEdgePointLocation(s,t,i),e,l.getColor("POINT_BODY_COLOR"),l.getNumber("POINT_BODY_SIZE"),s,h),this.parameter=i,this.selectionId=t.selectionId;let n=d.getEdgePointLocation(s,t,i);const r=t.getEntityMetaData();if(this.entityMetaData=r.clone(),this.entityMetaData.setBodyMetaData(r.getBodyMetaData()),n){const e=new a.BTEntityPoint;e.point=new Float32Array(3);for(let t=0;t<3;++t)e.point[t]=n[t];this.entityMetaData.geometries=[e]}else if(1===r.geometries.length&&r.geometries[0]instanceof a.BTEntityPoint){const e=r.geometries[0];n=o.vec3.clone(e.point),this.entityMetaData.geometries=r.geometries}this.setStyle(l.getPointFont("POINT_BODY_FONT")),n&&this.show()}static getEdgePointLocation(e,t,i){let s=null;const n=t.getEntityMetaData();let r;if(e.getIsForPreviousVersionDisplay()?r=e.getModelViewManagers().getManager().extractMeshIncrement(t.getDeterministicId()):n&&(r=n.getMeshIncrement()),!r&&n.isFromSketch()&&(r=e.getModelViewManagers().getManager().extractMeshIncrement(t.getDeterministicId())),r){s=o.vec3.create();const a=r.getLinesLength(),l=r.getPositionAtDistanceAlongLines(a*i),h=e.getModelViewManagers().getManager().getDisplayedPartStudio();if(h){let i;i=n.isFromSketch()?h.getSketchComponent().getTransformForSketchEntity(t.getDeterministicId()):h.getBodyTransform(t.getBodyId(),e),c.mat4C.multiplyVec3(i,l,s)}}return s}getModelSelection(e){return new n.Selection(a.GBTUiSelectionType.EDGE_POINT,this.selectionId,null,{sourcePick:e.sourcePick,entityMetaData:this.entityMetaData})}getClearModelSelectionsOnPrehilite(){return!1}addHighlight(e){this.addHighlightToIncrement(s.PointElement.INCREMENT_ID,e),(0,s.requestDraw)()}removeHighlight(e){return this.removeHighlightFromIncrement(s.PointElement.INCREMENT_ID,e),(0,s.requestDraw)(),!0}}t.EdgePoint=d},195161:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Element=void 0;const s=i(114924),n=i(142885),r=i(606544);class a extends n.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.cullableBodies=[],this.microversionIdAndConfiguration=null,(0,s.viewerCheck)(e)}getViewer(){return this.viewer}getMicroversionIdAndConfiguration(){return this.microversionIdAndConfiguration}getUIElementsForSelection(e){return[]}getEntityIdsForSelection(e){return[]}getOccurrenceEntityIdsForHighlight(e){return[]}getInContextImportEntityIdsForSelection(e){return[]}getOccurrencesForSelection(e){return[]}callOnChildSelections(e,t){let i=[];if(t.childSelections)for(let s=0;s<t.childSelections.length;s++)i=i.concat(e.call(this,t.childSelections[s]));return i}getBoundsOutsideElementNode(){return null}getBodyBounds(e,t){return null}getBodyComponent(e){return null}populateClientCacheStateDisplayInformation(e){}checkDuplicatedMicroversionIdAndConfiguration(e,t){return!e.find((function(e){return e.equals(t)}))}getElementType(){return r.GBTElementType.UNKNOWN}}t.Element=a},399274:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ElementPreviewManager=t.ELEMENT_PREVIEW_NODE_ID=void 0;const s=i(114924),n=i(606544);t.ELEMENT_PREVIEW_NODE_ID="elementPreviewManager";t.ElementPreviewManager=class{constructor(e){this.viewer=e,this.DISPLAY_OCCURRENCE_NAME="ElementPreviewManager",this.GROUP_RANGE_GROUP_ID="elementPreviewGroup",this.nodeOccurrenceNames=[],this.nodeOccurenceIds=[],this.node=new s.Node(t.ELEMENT_PREVIEW_NODE_ID),this.meshManager=new s.MeshManager(this.viewer,{bufferAllocationPolicy:s.BufferAllocationPolicy.MAXIMUM}),this.displayOccurrenceId=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.DISPLAY_OCCURRENCE_NAME),this.displayOccurrenceData=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(this.displayOccurrenceId),this.displayOccurrenceData.setLod(s.Lod.DEFAULT),this.meshOwnerId=(0,s.getNewOwnerId)(),this.finalSceneBounds=new s.BoundingBox,this.viewer.getModelViewManagers().getManager().getElementPreviewRootNode();this.viewer.getModelViewManagers().getManager().getElementPreviewBodyNode().addChild(this.node)}destroy(){this.node.remove();const e=this.viewer.getOccurrenceDataManager();e.destroyOccurrenceData(this.displayOccurrenceId);for(let t=0;t<this.nodeOccurenceIds.length;++t)e.destroyOccurrenceData(this.nodeOccurenceIds[t]);const t=this.viewer.getOccurrenceIdManager();t.removeName(this.DISPLAY_OCCURRENCE_NAME);for(let e=0;e<this.nodeOccurrenceNames.length;++e)t.removeName(this.nodeOccurrenceNames[e]);this.meshManager.destroy(),this.finalSceneBounds.reset()}readFloat32Array(e){return e?new Float32Array(e.buffer):new Float32Array(0)}readUint32Array(e){return e?new Uint32Array(e.buffer):new Uint32Array(0)}readUint16Array(e){return e?new Uint16Array(e.buffer):new Uint16Array(0)}processGLDisplayData(e){if(!e)return;let t=1,i=1;const r=e.buffers,a=e.nodes;for(let o=0;o<a.length;++o){const c=new s.Style,l=s.SOLID_FACE_NODE_PROPERTIES.cloneAndModify({isPickable:!1,isHighlightable:!1}),h=a[o],d=h.drawables;if(!d||0===d.length)continue;const u=d[0],g=u.attributes,p=g.point>-1?r[e.bufferAccessors[g.point].bufferIndex].data:null;let m=new Array(0);g.point>-1&&(m=e.bufferAccessors[g.point].glDataType===n.BTGLBufferAccessor.UNSIGNED_SHORT?Array.from(this.readUint16Array(p)):this.readFloat32Array(p));const E=g.normal>-1?r[e.bufferAccessors[g.normal].bufferIndex].data:null,I=new Int8Array(E),T=new Float32Array(I.length);for(let e=0;e<T.length;++e)T[e]=I[e]/127;const S=u.indices>-1?r[e.bufferAccessors[u.indices].bufferIndex].data:null,f=this.readUint32Array(S),C=u.appearance.color,P=[C[0]/255,C[1]/255,C[2]/255,u.appearance.opacity/255],v=(0,s.createTriangleStrip)(m,f,T,P),D=this.GROUP_RANGE_GROUP_ID+t,M=this.meshManager.getOrCreateGroupRangesForGroupTypeAndLod(D,this.meshOwnerId,s.PrimitiveType.TRIANGLE_STRIP,s.Lod.DEFAULT);v.id="elementPreviewGraphics_"+t,v.groupId=D,v.lod=s.Lod.DEFAULT,this.meshManager.addMeshIncrement(v,this.meshOwnerId),t+=1;for(let e=0;e<h.transform.length;++e){const t=this.DISPLAY_OCCURRENCE_NAME+i;this.nodeOccurrenceNames.push(t);const n=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.DISPLAY_OCCURRENCE_NAME+i);this.nodeOccurenceIds.push(n);const r=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(n);r.setLod(s.Lod.DEFAULT),r.setTransform(h.transform[e].getGlMatrix()),this.node.addOccurrenceGeometryToNode(l,r,c,M),i+=1}}this.viewer.getModelViewManagers().getManager().getElementPreviewBodyNode().damageBounds()}processGLDisplayDataResponse(e){if(e&&e.hasGLDisplayData){const t=new n.BTBinaryInputStream(e.glDisplayDataBytes).readMessage();t.finalSceneBounds&&(this.finalSceneBounds.addPoint(t.finalSceneBounds.minCorner.getVec3()),this.finalSceneBounds.addPoint(t.finalSceneBounds.maxCorner.getVec3())),this.processGLDisplayData(t)}}getModelBounds(){if(this.finalSceneBounds&&this.finalSceneBounds.isInitialized()&&this.finalSceneBounds.isExtensive())return this.finalSceneBounds;{const e=new s.BoundingBox,t=this.viewer.getModelViewManagers().getManager().getElementPreviewBodyNode();return t&&e.addBox(t.getBoundingBox()),e}}}},196765:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorComponent=void 0;const s=i(114924);class n extends s.PartStudioComponent{constructor(e,t){super(e,t)}getComponentId(){return"error_component."}handlesEntity(e,t){return e.hasTessellationError()&&!this.viewer.getIsForFlattenedDisplay()}expectsTessellation(){return!1}removeBaseIncrement(e){}updateEntityGraphics(e,t,i){}getHideableFeatureIds(){return[]}}t.ErrorComponent=n},87794:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createManipulator=t.FullTriadFeatureManipulator=t.TriadFeatureManipulator=t.TogglePointsFeatureManipulator=t.PointsFeatureManipulator=t.Flip=t.AngularFeatureManipulator=t.Linear1d=t.FeatureManipulator=void 0;const s=i(717535),n=i(142885),r=i(545348),a=i(264292),o=i(912057),c=i(606544),l=i(223456),h=i(713289),d=i(499432),u=i(95517),g=i(613199),p=i(114924),m=r.default.getManager();let E=1;const I=a.vec3.fromValues(1,0,0),T=a.vec3.fromValues(0,1,0),S=a.vec3.fromValues(0,0,1);class f extends n.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.dragManipulator=null,this.lockedManipulator=null,this.sequenceId=0,(0,p.viewerCheck)(e)}remove(){this.stopListening(),this.removeGraphicsManipulator()}show(){var e,t;null===(e=this.lockedManipulator)||void 0===e||e.show(),null===(t=this.dragManipulator)||void 0===t||t.show()}hide(){var e,t;null===(e=this.lockedManipulator)||void 0===e||e.hide(),null===(t=this.dragManipulator)||void 0===t||t.hide()}removeGraphicsManipulator(){this.dragManipulator&&(this.dragManipulator.remove(),this.dragManipulator=null),this.lockedManipulator&&(this.lockedManipulator.remove(),this.lockedManipulator=null)}getManipulatorId(){return this.manipulatorData?this.manipulatorData.manipulatorId:""}removeGraphicsManipulatorIfCannotBeDisplayed(){return!(0,p.canPointBeDisplayed)(this.manipulatorData.getDisplayLocation())&&(this.removeGraphicsManipulator(),o.log.info("Did not display feature manipulator(s), likely because it was out of bounds."),!0)}setManipulatorData(e,t){this.manipulatorData=e,this.removeGraphicsManipulatorIfCannotBeDisplayed()||(this.dragManipulator&&this.dragManipulator.isBeingManipulated()?this.updateLockedManipulator():this.updateDragManipulator(t))}updateDragManipulator(e){}updateLockedManipulator(){}sendValue(e,t){this.manipulatorData&&this.trigger(h.FeatureManipulatorEvents.VALUE_CHANGED,this.manipulatorData.manipulatorId,e,this.sequenceId,!!t)}onManipulationStarted(){this.sequenceId=E++,this.trigger(h.FeatureManipulatorEvents.MANIPULATION_STARTED,this.manipulatorData.manipulatorId,this.sequenceId,this.manipulatorData.primaryParameterId)}onManipulationEnded(){this.lockedManipulator&&(this.lockedManipulator.remove(),this.lockedManipulator=null),this.trigger(h.FeatureManipulatorEvents.MANIPULATION_ENDED,this.manipulatorData.manipulatorId,this.sequenceId,this.manipulatorData.primaryParameterId)}sendValueWithNoDrag(e){this.onManipulationStarted(),this.sendValue(e,!0),this.onManipulationEnded()}computeCenterOfOccurrenceBounds(e,t){let i=0,s=a.vec3.create();return e.forEach((e=>{const n=c.BTOccurrence.getOccurrenceFromPathString(e),r=t.getOccurrenceBounds(n);let a=null;r&&r.isFinite()&&(a=r.center(),g.vec3C.add(a,s,s),++i)})),i<1?null:(i>1&&(s=g.vec3C.scale(s,1/i)),s)}}t.FeatureManipulator=f;class C extends f{constructor(e){super(e),this.dragManipulator=null,this.lockedManipulator=null,this.manipulatorData=null,this.cachedBaseOccurrenceTransform=null}isManipulatorInGlobalCoordinateSystem(e){return!e.useCenterOfBoundsOfSourceIds&&(null===e.baseOccurrencePath||0===e.baseOccurrencePath.length)}convertLocalToWorldManipulatorData(e){if(this.isManipulatorInGlobalCoordinateSystem(e))return e;const t=e.clone(),i=(0,p.getActiveViewer)();if(!i)return e;const s=i.getModelViewManagers().getManager();if(!s)return e;if(!c.BTOccurrence.getOccurrenceFromPathString(e.baseOccurrencePath))return e;if(0===e.sourceIds.length)return e;const n=i.getOccurrenceIdManager().getIdForName(e.baseOccurrencePath);if(n===u.INVALID_OCCURRENCE_ID)return e;const r=this.viewer.getOccurrenceDataManager().getOccurrenceTransform(n),o=new c.BTVector3d,l=g.mat4C.toMat3(r,a.mat3.create());let h=g.mat3C.multiplyVec3(l,e.direction.getVec3(),a.vec3.create());h=g.vec3C.normalize(h,a.vec3.create()),o.updateFromArray(h),t.direction=o;const d=new c.BTVector3d,m=this.computeCenterOfOccurrenceBounds(e.sourceIds,s);return m&&(d.updateFromArray(m),t.base=d),t}updateManipulatorFromDefinition(e){if(e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData))e.updateDefinition(this.manipulatorData.base.getVec3(),this.manipulatorData.direction.getVec3(),this.manipulatorData.getValue().offset);else{const t=this.cachedBaseOccurrenceTransform?this.cachedBaseOccurrenceTransform:this.convertLocalToWorldManipulatorData(this.manipulatorData);if(this.cachedBaseOccurrenceTransform)e.updateDefinition(t.base.getVec3(),t.direction.getVec3(),this.manipulatorData.getValue().offset);else{const i=this.manipulatorData.getValue().offset<0;e.updateDefinitionForLocalManipulatorAtRest(t.base.getVec3(),t.direction.getVec3(),i)}}e.updateLimits(this.manipulatorData.minValue,this.manipulatorData.maxValue)}setManipulatorData(e){this.manipulatorData=e,this.removeGraphicsManipulatorIfCannotBeDisplayed()||(!this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)&&this.dragManipulator||this.updateDragManipulator(),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)&&this.dragManipulator&&this.dragManipulator.isBeingManipulated()&&this.updateLockedManipulator())}onManipulationStarted(){super.onManipulationStarted(),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)||(this.cachedBaseOccurrenceTransform=this.convertLocalToWorldManipulatorData(this.manipulatorData))}onManipulationEnded(){super.onManipulationEnded(),this.cachedBaseOccurrenceTransform&&(this.cachedBaseOccurrenceTransform=null,this.updateManipulatorFromDefinition(this.dragManipulator))}getFlipDirectionWhenNegative(){return this.manipulatorData.style!==c.GBTManipulatorStyleEnum.SIMPLE}updateDragManipulator(){this.dragManipulator||(this.dragManipulator=new p.Linear(this.viewer),this.dragManipulator.setFlipDirectionWhenNegative(this.getFlipDirectionWhenNegative()),this.listenTo(this.dragManipulator,h.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged),this.listenTo(this.dragManipulator,h.ManipulatorEvents.VALUE_EDITED,this.onManipulatorValueEdited),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,h.ManipulatorEvents.CLICKED,this.onManipulatorFlipped)),this.updateManipulatorFromDefinition(this.dragManipulator)}updateLockedManipulator(){this.lockedManipulator||(this.lockedManipulator=new p.Linear(this.viewer),this.lockedManipulator.setFlipDirectionWhenNegative(this.getFlipDirectionWhenNegative()),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)}onManipulatorValueChanged(){if(!this.dragManipulator)return;const e=new c.BTManipulatorValueLinear1d;e.offset=this.dragManipulator.getOffset(),this.sendValue(e)}onManipulatorValueEdited(){if(!this.dragManipulator)return;const e=new c.BTManipulatorValueLinear1d;e.offset=this.dragManipulator.getEditOffset(),this.sendValueWithNoDrag(e)}onManipulatorFlipped(){if(!this.dragManipulator)return;const e=-this.manipulatorData.getValue().offset;if(e<this.manipulatorData.minValue||e>this.manipulatorData.maxValue||0===e)return;const t=new c.BTManipulatorValueLinear1d;t.offset=e,this.sendValueWithNoDrag(t);const i=this.manipulatorData.getValue();i.offset=-i.offset,this.manipulatorData.updateClientGraphicsOnFlip&&this.updateDragManipulator(),this.viewer.doPreHighlightPick()}}t.Linear1d=C;class P extends f{constructor(e){super(e),this.dragManipulator=null,this.lockedManipulator=null,this.manipulatorData=null,this.cachedManipulatorData=null}setManipulatorData(e){this.manipulatorData=e,this.removeGraphicsManipulatorIfCannotBeDisplayed()||(this.updateDragManipulator(),this.dragManipulator&&this.dragManipulator.isBeingManipulated()&&this.updateLockedManipulator())}isManipulatorInGlobalCoordinateSystem(e){return!e.useCenterOfBoundsOfSourceIds&&(null===e.baseOccurrencePath||0===e.baseOccurrencePath.length)}convertLocalToWorldManipulatorData(e){if(this.isManipulatorInGlobalCoordinateSystem(e))return e;const t=(0,p.getActiveViewer)();if(!t)return e;const i=t.getModelViewManagers().getManager();if(!i)return e;if(!c.BTOccurrence.getOccurrenceFromPathString(e.baseOccurrencePath))return e;if(0===e.sourceIds.length)return e;const s=t.getOccurrenceIdManager().getIdForName(e.baseOccurrencePath);if(s===u.INVALID_OCCURRENCE_ID)return e;const n=this.viewer.getOccurrenceDataManager().getOccurrenceTransform(s),r=g.mat4C.toMat3(n,a.mat3.create()),o=e.axisDirection.getVec3(),h=g.mat3C.multiplyVec3(r,o,a.vec3.create());g.vec3C.normalize(h);const d=e.clone();d.axisDirection.updateFromArray(h);const m=this.computeCenterOfOccurrenceBounds(e.sourceIds,i);if(!m)return e;let E=null,I=g.mat4C.multiplyVec3(n,e.axisOrigin.getVec3(),a.vec3.create());const T=g.vec3C.subtract(m,I,a.vec3.create()),S=(0,l.areUnitVectorsParallel)(g.vec3C.normalize(T,a.vec3.create()),h);if((0,l.arePointsCoincident)(I,m)||S){E=this.getVectorNormalTo(o);const e=.01;g.vec3C.scale(E,e),E=g.mat3C.multiplyVec3(r,E,a.vec3.create()),d.axisOrigin.updateFromArray(m),I=m}else{const e=a.vec3.dot(T,h),t=g.vec3C.add(I,g.vec3C.scale(h,e,a.vec3.create()));d.axisOrigin.updateFromArray(t),E=g.vec3C.subtract(m,t,a.vec3.create())}if(E){const t=g.quat4C.toMat4(g.quat4C.fromAngleAxis(-e.getValue().angle,h),a.mat4.create());E=g.mat4C.multiplyVec3(t,E);const i=g.vec3C.add(E,I,a.vec3.create());d.rotationOrigin.updateFromArray(i)}return d}getVectorNormalTo(e){return(0,l.areUnitVectorsParallel)(I,e)?a.vec3.clone(T):(0,l.areUnitVectorsParallel)(T,e)?a.vec3.clone(S):(0,l.areUnitVectorsParallel)(S,e)?a.vec3.clone(I):g.vec3C.normalize(g.vec3C.getAPerpendicularVector(e))}updateManipulatorFromDefinition(e){if(this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)){const t=g.vec3C.subtract(this.manipulatorData.rotationOrigin.getVec3(),this.manipulatorData.axisOrigin.getVec3(),a.vec3.create()),i=g.vec3C.length(t);g.vec3C.normalize(t),e.setId(this.manipulatorData.manipulatorId),e.updateDefinition(this.manipulatorData.axisOrigin.getVec3(),this.manipulatorData.axisDirection.getVec3(),t,i,this.manipulatorData.getValue().angle),e.updateLimits(this.manipulatorData.minValue,this.manipulatorData.maxValue),e.setStyle(this.manipulatorData.style),e.setDisableMinimumOffset(this.manipulatorData.disableMinimumOffset)}else{const t=this.cachedManipulatorData?this.cachedManipulatorData:this.convertLocalToWorldManipulatorData(this.manipulatorData),i=g.vec3C.subtract(t.rotationOrigin.getVec3(),t.axisOrigin.getVec3(),a.vec3.create()),s=g.vec3C.length(i);g.vec3C.normalize(i),e.setId(t.manipulatorId),e.updateDefinition(t.axisOrigin.getVec3(),t.axisDirection.getVec3(),i,s,t.getValue().angle),e.updateLimits(t.minValue,t.maxValue),e.setStyle(t.style),e.setDisableMinimumOffset(t.disableMinimumOffset)}}createManipulator(){return this.manipulatorData.style===c.GBTManipulatorStyleEnum.SIMPLE?new p.Angular(this.viewer):new p.AngularWithArrow(this.viewer)}updateDragManipulator(){this.dragManipulator||(this.dragManipulator=this.createManipulator(),this.listenTo(this.dragManipulator,h.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged),this.listenTo(this.dragManipulator,h.ManipulatorEvents.VALUE_EDITED,this.onManipulatorValueEdited),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,h.ManipulatorEvents.CLICKED,this.onManipulatorFlipped)),this.updateManipulatorFromDefinition(this.dragManipulator)}updateLockedManipulator(){this.lockedManipulator||(this.lockedManipulator=this.createManipulator(),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)}onManipulationStarted(){super.onManipulationStarted(),this.isManipulatorInGlobalCoordinateSystem(this.manipulatorData)||(this.cachedManipulatorData=this.convertLocalToWorldManipulatorData(this.manipulatorData))}onManipulationEnded(){super.onManipulationEnded(),this.cachedManipulatorData&&(this.cachedManipulatorData=null,this.updateManipulatorFromDefinition(this.dragManipulator))}onManipulatorValueChanged(){if(!this.dragManipulator)return;const e=new c.BTManipulatorValueAngular;e.angle=this.dragManipulator.getAngle(),this.sendValue(e)}onManipulatorValueEdited(){if(!this.dragManipulator)return;const e=new c.BTManipulatorValueAngular;e.angle=this.dragManipulator.getAngle(),this.sendValueWithNoDrag(e)}onManipulatorFlipped(){if(!this.dragManipulator||this.manipulatorData.minValue*this.manipulatorData.maxValue>=0)return;const e=new c.BTManipulatorValueAngular;e.angle=-this.manipulatorData.getValue().angle,this.sendValueWithNoDrag(e);const t=this.manipulatorData.getValue();t.angle=-t.angle,this.manipulatorData.updateClientGraphicsOnFlip&&this.updateDragManipulator(),this.viewer.doPreHighlightPick()}}t.AngularFeatureManipulator=P;class v extends f{constructor(e){super(e),this.dragManipulator=null,this.lockedManipulator=null,this.manipulatorData=null}updateManipulatorFromDefinition(e){let t=this.manipulatorData.direction.getVec3();if(this.manipulatorData.getValue().flipped){const e=this.manipulatorData.otherDirection.getVec3();g.vec3C.length(e)>0?t=e:g.vec3C.scale(t,-1)}e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(this.manipulatorData.base.getVec3(),t,0)}updateDragManipulator(){this.dragManipulator||(this.dragManipulator=new p.Linear(this.viewer),this.dragManipulator.setShaftLength(m.getNumber("MANIPULATOR_FLIP_SHAFT_LENGTH_PX")),this.dragManipulator.setIsDraggable(!1),this.listenTo(this.dragManipulator,h.ManipulatorEvents.CLICKED,this.onManipulatorFlipped)),this.updateManipulatorFromDefinition(this.dragManipulator)}updateLockedManipulator(){this.lockedManipulator||(this.lockedManipulator=new p.Linear(this.viewer),this.lockedManipulator.setShaftLength(m.getNumber("MANIPULATOR_FLIP_SHAFT_LENGTH_PX")),this.dragManipulator.setIsDraggable(!1),this.lockedManipulator.setFlipDirectionWhenNegative(!0),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)}onManipulatorFlipped(){if(!this.dragManipulator)return;const e=new c.BTManipulatorValueFlip;e.flipped=!this.manipulatorData.getValue().flipped,this.sendValueWithNoDrag(e);const t=this.manipulatorData.getValue();t.flipped=!t.flipped,this.manipulatorData.updateClientGraphicsOnFlip&&this.updateDragManipulator(),this.viewer.doPreHighlightPick()}}t.Flip=v;class D extends f{constructor(e){super(e),this.manipulatorData=null,this.dragManipulator=null}updateManipulatorFromDefinition(e){const t=this.manipulatorData.points.map((e=>a.vec3.fromValues(e.x,e.y,e.z)));e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(t,new Set([this.manipulatorData.getValue().index]))}updateDragManipulator(){this.dragManipulator||(this.dragManipulator=new p.PointSelection(this.viewer,!1),this.listenTo(this.dragManipulator,h.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged)),this.updateManipulatorFromDefinition(this.dragManipulator)}onManipulatorValueChanged(e){const t=new c.BTManipulatorValuePoints;t.index=e.findIndex((e=>e)),this.sendValueWithNoDrag(t)}}t.PointsFeatureManipulator=D;class M extends f{constructor(e){super(e),this.manipulatorData=null,this.dragManipulator=null}updateManipulatorFromDefinition(e){const t=this.manipulatorData.points.map((e=>a.vec3.fromValues(e.x,e.y,e.z)));e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style);const i=this.manipulatorData.getValue();e.updateDefinition(t,new Set(i.selectedIndices),new Set(this.manipulatorData.suppressedIndices))}updateDragManipulator(e){this.dragManipulator||(this.dragManipulator=new p.PointSelection(this.viewer,!0,e),this.listenTo(this.dragManipulator,h.ManipulatorEvents.VALUE_CHANGED,this.onManipulatorValueChanged)),this.updateManipulatorFromDefinition(this.dragManipulator)}onManipulatorValueChanged(e){const t=new c.BTManipulatorValueTogglePoints;t.selectedIndices=e.reduce(((e,t,i)=>(t&&e.push(i),e)),[]),this.sendValueWithNoDrag(t)}}t.TogglePointsFeatureManipulator=M;class y extends f{constructor(e,t){super(t),this.dragManipulator=null,this.lockedManipulator=null,this.manipulatorData=null,this.dragStart=e.getValue().offset.getVec3()}updateManipulatorFromDefinition(e){const t=this.manipulatorData.base,i=this.manipulatorData.getValue().offset,s=a.mat4.create();s[12]=i.x+t.x,s[13]=i.y+t.y,s[14]=i.z+t.z,e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(s)}updateDragManipulator(){if(!this.dragManipulator){const e={displayEditView:!1};this.dragManipulator=new p.Triad(this.viewer,h.TriadManipulatorType.DRAG,e),this.dragManipulator.setDisableInactiveComponents(!0),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,d.TriadEvents.TRANSLATION_START,this.translationStart),this.listenTo(this.dragManipulator,d.TriadEvents.TRANSLATION_CHANGE,this.translationChange),this.listenTo(this.dragManipulator,d.TriadEvents.TRANSLATION_END,this.translationEnd)}this.dragStart=this.manipulatorData.getValue().offset.getVec3(),this.updateManipulatorFromDefinition(this.dragManipulator)}updateLockedManipulator(){this.lockedManipulator||(this.lockedManipulator=new p.Triad(this.viewer,h.TriadManipulatorType.DRAG),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)}translationStart(){this.dragManipulator.isDragging=!0}translationChange(e){if(!this.dragManipulator)return;const t=new c.BTManipulatorValueTriad;t.offset=new c.BTVector3d,t.offset.x=e[0]+this.dragStart[0],t.offset.y=e[1]+this.dragStart[1],t.offset.z=e[2]+this.dragStart[2],this.sendValue(t)}translationEnd(){this.dragManipulator.isDragging=!1}}t.TriadFeatureManipulator=y;class O extends f{constructor(e,t,i){super(t),this.dragManipulator=null,this.lockedManipulator=null,this.manipulatorData=null,this.inferenceController=null,this.baseTransform=null,this.valueTransform=null,this.rotationAxisIndex=null,this.preRepositionTransform=null,this.manipulatorData=e,this.valueTransform=a.mat4.clone(e.getValue().transform.getGlMatrix()),this.baseTransform=a.mat4.clone(e.base.getGlMatrix()),this.coordinateDisplayFactory=(e,t)=>t.createInferenceDisplay(e),this.inferenceController=new s.CoordinateSystemInferenceController(i,this.coordinateDisplayFactory,!0,!0,this.viewer,!0),this.listenTo(this.inferenceController,s.CoordinateSystemInferenceEvents.MOUSE_ENTER,this.onEnterInference),this.listenTo(this.inferenceController,s.CoordinateSystemInferenceEvents.MOUSE_LEAVE,this.onLeaveInference)}updateManipulatorFromDefinition(e){const t=this.manipulatorData.getValue().transform.getGlMatrix(),i=this.manipulatorData.base.getGlMatrix();e.setId(this.manipulatorData.manipulatorId),e.setStyle(this.manipulatorData.style),e.updateDefinition(a.mat4.multiply(a.mat4.create(),i,t))}updateDragManipulator(){if(!this.dragManipulator){const e={displayEditView:!1};this.dragManipulator=new p.Triad(this.viewer,h.TriadManipulatorType.FULL,e),this.dragManipulator.setDisableInactiveComponents(!0),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.dragManipulator,h.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.dragManipulator,d.TriadEvents.TRANSLATION_START,this.translationStart),this.listenTo(this.dragManipulator,d.TriadEvents.TRANSLATION_CHANGE,this.translationChange),this.listenTo(this.dragManipulator,d.TriadEvents.TRANSLATION_END,this.translationEnd),this.listenTo(this.dragManipulator,d.TriadEvents.ROTATION_START,this.rotationStart),this.listenTo(this.dragManipulator,d.TriadEvents.ROTATION_CHANGE,this.rotationChange),this.listenTo(this.dragManipulator,d.TriadEvents.ROTATION_END,this.rotationEnd),this.listenTo(this.dragManipulator,d.TriadEvents.REPOSITION_START,this.onTriadRepositionStarted),this.listenTo(this.dragManipulator,d.TriadEvents.REPOSITION_END,this.onTriadRepositionEnded)}this.updateManipulatorFromDefinition(this.dragManipulator),this.valueTransform=a.mat4.clone(this.manipulatorData.getValue().transform.getGlMatrix()),this.baseTransform=a.mat4.clone(this.manipulatorData.base.getGlMatrix())}updateLockedManipulator(){this.lockedManipulator||(this.lockedManipulator=new p.Triad(this.viewer,h.TriadManipulatorType.FULL),this.lockedManipulator.setIsEnabled(!1)),this.updateManipulatorFromDefinition(this.lockedManipulator)}translationStart(){this.dragManipulator.isDragging=!0}translationChange(e){if(!this.dragManipulator||this.dragManipulator.getIsLocked())return;const t=new c.BTManipulatorValueFullTriad;t.transform=new c.BTBSMatrix,t.transform.updateFromGlMatrix(this.valueTransform);const i=a.vec4.transformMat4(a.vec4.create(),e,a.mat4.transpose(a.mat4.create(),this.baseTransform));t.transform.m03+=i[0],t.transform.m13+=i[1],t.transform.m23+=i[2],this.sendValue(t)}translationEnd(){this.dragManipulator.isDragging=!1}rotationStart(e,t){this.dragManipulator.isDragging=!0;const i=a.vec3.create();i[0]=t[0],i[1]=t[1],i[2]=t[2];const s=a.mat4.mul(a.mat4.create(),this.baseTransform,this.valueTransform);for(let e=0;e<3;++e){const t=a.vec3.create();if(t[0]=s[4*e],t[1]=s[4*e+1],t[2]=s[4*e+2],a.vec3.equals(t,i)){this.rotationAxisIndex=e;break}}null===this.rotationAxisIndex&&(this.dragManipulator.isDragging=!1)}rotationChange(e){if(!this.dragManipulator.isDragging||this.dragManipulator.getIsLocked())return;let t=a.mat4.clone(this.valueTransform);switch(this.rotationAxisIndex){case 0:t=a.mat4.rotateX(a.mat4.create(),this.valueTransform,e);break;case 1:t=a.mat4.rotateY(a.mat4.create(),this.valueTransform,e);break;case 2:t=a.mat4.rotateZ(a.mat4.create(),this.valueTransform,e)}const i=new c.BTManipulatorValueFullTriad;i.transform=new c.BTBSMatrix,i.transform.updateFromGlMatrix(t),this.sendValue(i)}rotationEnd(e){this.dragManipulator.isDragging=!1,this.rotationAxisIndex=null}onTriadRepositionStarted(){this.inferenceController.startInferencing(),this.preRepositionTransform=a.mat4.clone(this.valueTransform)}sendRepositionStartTranform(){if(null===this.preRepositionTransform)return;const e=new c.BTManipulatorValueFullTriad;e.transform=new c.BTBSMatrix,e.transform.updateFromGlMatrix(this.preRepositionTransform),this.sendValue(e)}onTriadRepositionEnded(e){this.inferenceController.stopInferencing(),this.preRepositionTransform=null}onEnterInference(e){if(!e)return;const t=new c.BTManipulatorValueFullTriad;t.transform=new c.BTBSMatrix;const i=e.coordinateSystem.getGlMatrix();t.transform.updateFromGlMatrix(a.mat4.mul(a.mat4.create(),a.mat4.invert(a.mat4.create(),this.baseTransform),i)),this.sendValue(t),this.dragManipulator.setIsLocked(!0)}onLeaveInference(e){this.dragManipulator.setIsLocked(!1),this.sendRepositionStartTranform()}stopInferencing(){this.inferenceController.stopInferencing()}}t.FullTriadFeatureManipulator=O,t.createManipulator=function(e,t,i){return e instanceof c.BTManipulatorLinear1d?new C(t):e instanceof c.BTManipulatorAngular?new P(t):e instanceof c.BTManipulatorFlip?new v(t):e instanceof c.BTManipulatorTriad?new y(e,t):e instanceof c.BTManipulatorPoints?new D(t):e instanceof c.BTManipulatorTogglePoints?new M(t):e instanceof c.BTManipulatorFullTriad?new O(e,t,i):null}},553378:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ImageComponent=void 0;const s=i(264292),n=i(148734),r=i(315689),a=i(772687),o=i(114924);class c{constructor(e,t){this.viewer=t,(0,o.viewerCheck)(t),this.imageData=new r.TemplatedNestedMap,this.imageDisplays=new r.TemplatedNestedMap,this.imageDisplaysByOccurrence=new r.TemplatedCountedMap,this.activeSketchIds=new a.StringSet,this.hiddenSketchIds=new a.StringSet,this.usage=e||o.BTGraphicsUsage.BASE}processDisplayData(e){this.imageDisplays.eachNested((function(t,i,s){const r=this.imageDisplays.getNested(i,s);if(r){if(e.sketchImages.hasOwnProperty(i)&&e.sketchImages[i].hasOwnProperty(s)){const t=e.sketchImages[i][s];if((0,n.updateUriWithWorkspaceId)(t.sourceId)===r.url&&t.isOnFlat===r.isOnFlat)return}return r.remove(),this.imageDisplays.removeNested(i,s),!1}}),this),this.imageData.clear(),Object.entries(e.sketchImages).forEach((function([e,t]){Object.entries(t).forEach((function([t,i]){this.viewer.getIsForFlattenedDisplay()===i.isOnFlat&&this.imageData.insertNested(e,t,i)}),this)}),this)}reset(){this.remove(),this.imageData.clear()}remove(){this.imageDisplays.eachNested((function(e){return e.remove(),!1}),this),this.imageDisplays.clear(),this.imageDisplaysByOccurrence.each((e=>{e.eachNested((e=>{e.remove()}))})),this.imageDisplaysByOccurrence.clear()}removeOccurrence(e){const t=this.imageDisplaysByOccurrence.get(e);t&&(t.eachNested((e=>(e.remove(),!1))),t.clear()),this.imageDisplaysByOccurrence.remove(e)}showPartsWithSheetmetalModelIdOnly(e){const t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();this.imageData.eachNested((function(i,s,n){const r=this.imageDisplays.getNested(s,n);if(r){if(t&&i.isOnFlat){const s=t.getSketchComponent().getSMModelIdForSketch(i.featureId);e!==s||this.hiddenSketchIds.contains(i.featureId)?r.hide():(r.updateImage(i.sourceId,i.bottomLeftCorner.getVec3(),i.bottomRightCorner.getVec3(),i.topLeftCorner.getVec3()),r.show())}return!1}}),this)}getDisplaysForOccurrence(e){const t=[],i=this.imageDisplaysByOccurrence.get(e);return i?(i.eachNested((e=>{t.push(e)})),t):t}updateDisplaysByOccurrence(e,t,i){if(0===i.size)return;let s=this.imageDisplaysByOccurrence.get(e);s||(s=new r.TemplatedNestedMap,this.imageDisplaysByOccurrence.insert(e,s));const n=new r.TemplatedNestedMap;i.forEach((e=>{const t=this.imageData.get(e);t&&n.insert(e,t)}));const a=this.viewer.getOccurrenceDataManager().getOccurrenceData(e).getTransform();n.eachNested(((e,i,n)=>{var r;const c=s.getNested(i,n);let l="";if(e.isOnFlat&&(l=null===(r=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio())||void 0===r?void 0:r.getSketchComponent().getOwnerFlattenedBodyIdForSketch(e.featureId)),c)t.isHidden?c.hide():(c.show(),c.isOnFlat=e.isOnFlat,c.flattenedBodyId=l,c.transform=a,c.updateImage(e.sourceId,e.bottomLeftCorner.getVec3(),e.bottomRightCorner.getVec3(),e.topLeftCorner.getVec3()));else{const r=new o.ImageDisplay(n,e.sourceId,e.bottomLeftCorner.getVec3(),e.bottomRightCorner.getVec3(),e.topLeftCorner.getVec3(),null,this.usage,this.viewer,e.isOnFlat,l,a);r.setIsolated(!1),t.isHidden?r.hide():r.show(),s.insertNested(i,n,r)}return!1}))}updateDisplays(){const e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();this.imageData.eachNested((function(t,i,n){const r=this.imageDisplays.getNested(i,n);let a=s.mat4.create(),c="";if(e&&t.isOnFlat&&(c=e.getSketchComponent().getOwnerFlattenedBodyIdForSketch(t.featureId),c)){const t=e.retrieveBodyMetaData(c);t&&(a=e.getBodyComponent().getTransformFromSheetMetalBodyMetaData(t))}if(r)r.isHidden||(r.isOnFlat=t.isOnFlat,r.flattenedBodyId=c,r.transform=a,r.updateImage(t.sourceId,t.bottomLeftCorner.getVec3(),t.bottomRightCorner.getVec3(),t.topLeftCorner.getVec3()));else{const e=new o.ImageDisplay(n,t.sourceId,t.bottomLeftCorner.getVec3(),t.bottomRightCorner.getVec3(),t.topLeftCorner.getVec3(),null,this.usage,this.viewer,t.isOnFlat,c,a);this.activeSketchIds.contains(i)?e.activate():this.hiddenSketchIds.contains(i)&&e.hide(),this.imageDisplays.insertNested(i,n,e)}return!1}),this)}onSketchHidden(e){this.hiddenSketchIds.add(e),this.imageDisplays.eachNested((function(t,i){const s=i.split(".");return e===s[0]&&t.hide(),!1}),this)}onSketchShown(e){this.hiddenSketchIds.remove(e),this.imageDisplays.eachNested((function(t,i,s){const n=i.split(".");if(e===n[0]){let e=!0;if(t.isOnFlat){e=!1;const i=this.viewer.getModelViewManagers().getManager(),s=i.getSelectedSheetmetalModelId();if(s){const n=i.getDisplayedPartStudio();if(n){const i=n.retrieveBodyMetaData(t.flattenedBodyId);i&&(e=s===i.sheetMetalModelId)}}}if(e){const e=this.imageData.getNested(i,s);e&&(t.updateImage(e.sourceId,e.bottomLeftCorner.getVec3(),e.bottomRightCorner.getVec3(),e.topLeftCorner.getVec3()),t.show())}}return!1}),this)}onSketchActivated(e){this.activeSketchIds.contains(e)||(this.imageDisplays.has(e)&&this.imageDisplays.get(e).each((function(e,t){return e.activate(),!1}),this),this.activeSketchIds.add(e))}onSketchDeactivated(e){this.activeSketchIds.contains(e)&&(this.imageDisplays.has(e)&&this.imageDisplays.get(e).each((function(e,t){return e.deactivate(),!1}),this),this.activeSketchIds.remove(e))}cloneForUsage(e){const t=new c(e,this.viewer);return this.imageData.eachNested((function(e,i,s){return t.imageData.insertNested(i,s,e),!1}),this),e===o.BTGraphicsUsage.PREVIEW&&this.imageDisplays.eachNested((function(e,i,s){return t.imageDisplays.insertNested(i,s,e.cloneForPreview()),!1}),this),t}}t.ImageComponent=c},36516:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.updateMateConnectorSelectedColor=t.getStaticIncrements=t.MateConnector=t.IncrementId=t.HIGHLIGHTED_TRIANGLE_PROPERTIES=t.TRIANGLE_PROPERTIES=t.INFERENCE_TRIANGLE_PROPERTIES=t.HIGHLIGHTED_LINE_PROPERTIES=t.INFERENCE_LINE_PROPERTIES=t.LINE_PROPERTIES=void 0;const s=i(545348),n=i(264292),r=i(997687),a=i(193786),o=i(606544),c=i(85655),l=i(873896),h=i(613199),d=i(114924),u=s.default.getManager(),g=new d.NodeProperties({primitiveType:d.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,isPickable:!1});t.LINE_PROPERTIES=g.cloneAndModify({includedInBlend:!0}),t.INFERENCE_LINE_PROPERTIES=g.cloneAndModify({priority:d.RenderOrderPriority.HIGHER}),t.HIGHLIGHTED_LINE_PROPERTIES=g.cloneAndModify({priority:d.RenderOrderPriority.HIGHEST});const p=new d.NodeProperties({primitiveType:d.PrimitiveType.TRIANGLE_STRIP,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,isPickable:!1,zOffset:u.getNumber("MATE_CONNECTOR_TRIANGLE_Z_OFFSET"),primitivesHaveTransparency:!0,material:d.UNLIT_COLOR_FROM_ATTRIBUTE});t.INFERENCE_TRIANGLE_PROPERTIES=p.cloneAndModify({priority:d.RenderOrderPriority.HIGHER}),t.TRIANGLE_PROPERTIES=p.cloneAndModify({includedInBlend:!0}),t.HIGHLIGHTED_TRIANGLE_PROPERTIES=p.cloneAndModify({priority:d.RenderOrderPriority.HIGHEST});const m=new d.NodeProperties({primitiveType:d.PrimitiveType.TRIANGLES,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,isVisible:!1});var E;!function(e){e.LINES="lines",e.LINES_FADED="lines_faded",e.TRIANGLES="triangles",e.COMPARE_BASE_TRIANGLES="compare_base_triangles",e.COMPARE_TARGET_TRIANGLES="compare_target_triangles",e.TRIANGLES_PRESELECTED="triangles_preselected",e.TRIANGLES_SELECTED="triangles_selected",e.TRIANGLES_FADED="triangles_faded",e.PICK_DISC="pick_disc",e.INFERENCE_POINT_TRIANGLES="inference_point_triangles",e.INFERENCE_POINT_LINES="inference_point_lines",e.INFERENCE_CENTER_TRIANGLES="inference_center_triangles",e.INFERENCE_CENTER_LINES="inference_center_lines",e.INFERENCE_CENTROID_TRIANGLES="inference_centroid_triangles",e.INFERENCE_CENTROID_LINES="inference_centroid_lines",e.INFERENCE_MID_POINT_TRIANGLES="inference_mid_point_triangles",e.INFERENCE_MID_POINT_LINES="inference_mid_point_lines",e.INFERENCE_ORIGIN_AXIS_LINES="inference_origin_axis_lines",e.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED="inference_origin_axis_lines_preselected"}(E||(t.IncrementId=E={}));let I=null,T=!0;class S extends d.UIElement{constructor(e,t,i,s){super(i,t),this.definition=e,this.isBeingEdited=!1,this.lastScale=-1,this.worldSpacePosition=[0,0,0],this.activeMateConnectorScaled=!1,this.isForInContextAssembly=!1,this.isFromChildFeature=!1,this.isParentOccurrenceDataMissing=!1,this.partStudioFeatureId=s||"",this.isPartStudioMateConnector=!!this.partStudioFeatureId,this.occurrenceTransform=n.mat4.create(),this.parentOccurrenceVisibility=d.Visibility.VISIBLE,this.usage=t===d.PREVIEW_SCENEGRAPH_ID?d.BTGraphicsUsage.PREVIEW:d.BTGraphicsUsage.BASE,this.damageTransform(),this.updateHideState(),this.occurrenceData.setCanIsolateChange(!0),this.occurrenceData.setIsolated(!1),this.isForInContextAssembly=e&&e.occurrence&&this.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly()}cloneForPreview(){return new S(this.definition,d.PREVIEW_SCENEGRAPH_ID,this.viewer,this.partStudioFeatureId)}getUsage(){return this.usage}getWorldSpacePosition(){return this.worldSpacePosition}onDevicePixelRatioChanged(e){I=null,this.updateGraphics()}getIsPartStudioMateConnector(){return this.isPartStudioMateConnector}getId(){return(0,c.createOccurrenceNodeId)(this.definition.ownerOccurrence,this.definition.nodeId)}setOccurrenceTransform(e){this.occurrenceTransform=e,this.damageTransform()}setEditState(e){this.isBeingEdited=e,this.updateHideState(),this.updateGraphics()}getDefinition(){return this.definition?this.definition:null}getLineProperties(){return this.isForInContextAssembly?g:t.LINE_PROPERTIES}getTriangleProperties(){return this.isForInContextAssembly?g:t.TRIANGLE_PROPERTIES}updateDefinition(e){this.definition=e,this.updateHideState(),this.damageTransform()}damageTransform(){this.lastScale=-1,this.definition&&h.mat4C.multiplyVec3(this.occurrenceTransform,this.definition.location.origin.getVec3(),this.worldSpacePosition),this.viewer.requestDraw()}getWorldSpaceDefinition(){if(!this.definition)return null;const e=new o.BTCoordinateSystem,t=this.definition.location.xAxis.getVec3(),i=this.definition.location.yAxis.getVec3(),s=this.definition.location.zAxis.getVec3(),r=this.definition.location.origin.getVec3(),a=h.mat4C.toRotationMat(this.occurrenceTransform,n.mat4.create());return h.mat4C.multiplyVec3(this.occurrenceTransform,r),h.mat4C.multiplyVec3(a,t),h.mat4C.multiplyVec3(a,i),h.mat4C.multiplyVec3(a,s),e.xAxis.updateFromArray(t),e.yAxis.updateFromArray(i),e.zAxis.updateFromArray(s),e.origin.updateFromArray(r),e}canPickThrough(){return!0}getPickPriority(){return d.PickPriority.MATE_CONNECTOR}getModelSelection(e){return this.definition?new a.Selection(o.GBTUiSelectionType.MATE_CONNECTOR,this.definition.nodeId,this.definition.ownerOccurrence,{sourcePick:e.sourcePick,isPartStudioMateConnector:this.isPartStudioMateConnector,isDerivedFeature:this.definition.isDerivedFeature,isChildFeature:this.isFromChildFeature,featureId:this.partStudioFeatureId}):null}addHighlight(e){super.addHighlight(e),this.updateHideState(),this.updateGraphics()}removeHighlight(e){return!!super.removeHighlight(e)&&(this.updateHideState(),this.updateGraphics(),!0)}getUserVisibilitySetting(){return this.definition.hidden?d.Visibility.HIDDEN:d.Visibility.VISIBLE}updateOccurrenceVisibility(e){e!==this.parentOccurrenceVisibility&&(this.parentOccurrenceVisibility=e,this.updateHideState(),this.updateGraphics())}updateHideState(){!this.isParentOccurrenceDataMissing&&(this.isBeingEdited||this.isHighlighted()||this.getUserVisibilitySetting()!==d.Visibility.HIDDEN&&this.parentOccurrenceVisibility!==d.Visibility.HIDDEN)?(this.hasMeshIncrements()||this.updateGraphics(!0),this.show()):this.hide()}setOpacity(e){const t=f(),i=u.getColor("MATE_CONNECTOR_COLOR");i[3]=e,(0,d.addColorToIncrement)(i,t[E.TRIANGLES_FADED]),this.updateMeshIncrement(E.TRIANGLES,d.NO_SELECTION_ID,t[E.TRIANGLES_FADED].clone(),this.getTriangleProperties()),this.setLineOpacity(e)}onIsolateChanged(){this.updateGraphics()}updateIsolation(){if(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated()){let e=0;e=this.isForInContextAssembly?u.getNumber("ISOLATE_CONTEXT_UI_MATE_CONNECTOR_TRANSPARENCY"):u.getNumber("ISOLATE_CONTEXT_UI_TRANSPARENCY")*(0,d.getTransparencyTransition)()+(1-(0,d.getTransparencyTransition)()),this.setOpacity(e)}else{const e=f();this.updateBaseIncrements(e)}}updateBaseIncrements(e){let t=E.TRIANGLES;const i=(0,d.isUsageCompare)(),s=!!i&&(r.btInjector.PartStudioCompareService.isPartStudioComparisonReady()&&r.btInjector.PartStudioCompareService.doesFeatureHaveADifference(this.partStudioFeatureId));i&&s&&(t=this.sceneGraphId===d.MAIN_SCENEGRAPH_ID?E.COMPARE_BASE_TRIANGLES:E.COMPARE_TARGET_TRIANGLES),this.updateMeshIncrement(E.TRIANGLES,d.NO_SELECTION_ID,e[t].clone(),this.getTriangleProperties()),this.setLineOpacity(1),this.updateMeshIncrement(E.LINES,d.NO_SELECTION_ID,e[E.LINES].clone(),this.getLineProperties())}setLineOpacity(e){const t=f(),i=(0,d.setIncrementOpacity)(t[E.LINES_FADED],e);this.updateMeshIncrement(E.LINES,d.NO_SELECTION_ID,i.clone(),this.getLineProperties())}adjustTransform(e){if(!this.definition||this.isHidden)return;let t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);const i=this.getIsActiveMateConnector();if(this.activeMateConnectorScaled&&!i&&(this.activeMateConnectorScaled=!1,this.lastScale=-1),Math.abs(this.lastScale-t)<l.Tolerances.ZERO_LENGTH)return;this.lastScale=t,i&&(t*=u.getNumber("ACTIVE_MATE_CONNECTOR_SIZE_SCALE_PERCENT"),this.activeMateConnectorScaled=!0);const s=n.mat4.create();s[0]=t,s[5]=t,s[10]=t,this.setTransform(h.mat4C.multiply(h.mat4C.multiply(this.occurrenceTransform,this.definition.location.getGlMatrix(),n.mat4.create()),s)),this.hasMeshIncrements()||this.updateGraphics()}getIsActiveMateConnector(){const e=this.viewer.getMateConnectorManager();return!!e&&e.isMateConnectorActive(this.getId(),this)}onViewWillDraw(e){this.isHidden||this.hasBeenRemoved||(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&this.updateGraphics(),this.adjustTransform(e))}onHighlightColorUpdated(){this.isHighlighted()&&this.updateGraphics()}updateGraphics(e){if(!this.definition||this.isHidden&&!e)return void this.removeMeshIncrements();const i=f();this.updateMeshIncrement(E.PICK_DISC,"mateconnector",i[E.PICK_DISC].clone(),m);const s=this.getHighlight();s&&s.type===d.HighlightType.PRE?(this.updateMeshIncrement(E.TRIANGLES,d.NO_SELECTION_ID,i[E.TRIANGLES_PRESELECTED].clone(),t.HIGHLIGHTED_TRIANGLE_PROPERTIES),this.updateMeshIncrement(E.LINES,d.NO_SELECTION_ID,i[E.LINES].clone(),t.HIGHLIGHTED_LINE_PROPERTIES)):s?(this.updateMeshIncrement(E.TRIANGLES,d.NO_SELECTION_ID,i[E.TRIANGLES_SELECTED].clone(),t.HIGHLIGHTED_TRIANGLE_PROPERTIES),this.updateMeshIncrement(E.LINES,d.NO_SELECTION_ID,i[E.LINES].clone(),t.HIGHLIGHTED_LINE_PROPERTIES),this.muteIfActive()):(this.updateBaseIncrements(i),this.updateIsolation(),this.muteIfActive())}muteIfActive(){if(this.hasBeenRemoved)return;const e=this.getIsActiveMateConnector();if(e&&this.setOpacity(u.getNumber("ACTIVE_MATE_CONNECTOR_OPACITY")),this.activeMateConnectorScaled!==e){if(!e){const e=1;this.setOpacity(e)}this.damageTransform()}}static setInteractionEnabled(e){T=e}isInteractionEnabled(){return T&&!(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated())}getOccurrence(){return this.definition?this.definition.occurrence:null}setIsParentOccurrenceDataMissing(e){this.isParentOccurrenceDataMissing=e,this.updateHideState()}}function f(){if(I)return I;I={};const e=n.vec3.create(),t=n.vec3.fromValues(0,0,1),i=n.vec3.fromValues(1,0,0),s=Math.PI/2,r=.75*u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS"),a=.25*u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS");let o=u.getNumber("MATE_CONNECTOR_DIAMETER_PX")/2;const c=o-u.getNumber("MATE_CONNECTOR_RING_WIDTH_PX"),l=u.getColor("MATE_CONNECTOR_STROKE_COLOR");let h=u.getNumber("MATE_CONNECTOR_STROKE_WIDTH"),g=(0,d.createCircle)(e,o,t,u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS"));(0,d.addColorToIncrement)(l,g),(0,d.addSizeToIncrement)(h,g);const p=(0,d.createArc)(e,c,t,i,s,2*Math.PI,r);(0,d.addColorToIncrement)(l,p),(0,d.addSizeToIncrement)(h,p);let m=(0,d.createLine)(e,[c,0,0],void 0,l,h),T=(0,d.createLine)(e,[0,c,0],void 0,l,h);const S=u.getNumber("MATE_CONNECTOR_AXIS_LINE_GAP_PX"),f=u.getNumber("MATE_CONNECTOR_AXIS_LINE_LENGTH_PX"),C=u.getNumber("MATE_CONNECTOR_AXIS_LINE_WIDTH"),P=u.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_LENGTH_PX"),v=u.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_WIDTH"),D=(0,d.createLine)([o+S,0,0],[o+S+f,0,0],void 0,u.getColor("X_AXIS_COLOR"),C),M=(0,d.createLine)([0,o+S,0],[0,o+S+f,0],void 0,u.getColor("Y_AXIS_COLOR"),C),y=(0,d.createLine)([0,0,S],[0,0,S+P],void 0,u.getColor("Z_AXIS_COLOR"),v);let O=g.concatenate(p).concatenate(m).concatenate(T).concatenate(D).concatenate(M).concatenate(y);O&&(I[E.LINES]=O,I[E.LINES_FADED]=O.clone());const _=(0,d.createRing)(e,c,o,t,i,s,2*Math.PI,r),A=(0,d.createRing)(e,0,o,t,i,0,s,a),R=_.concatenate(A);R&&(I[E.TRIANGLES]=R,(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_COLOR"),I[E.TRIANGLES]),I[E.COMPARE_BASE_TRIANGLES]=R.clone(),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_COMPARE_BASE_COLOR"),I[E.COMPARE_BASE_TRIANGLES]),I[E.COMPARE_TARGET_TRIANGLES]=R.clone(),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_COMPARE_TARGET_COLOR"),I[E.COMPARE_TARGET_TRIANGLES]),I[E.TRIANGLES_PRESELECTED]=R.clone(),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_PRE_SELECTED_COLOR"),I[E.TRIANGLES_PRESELECTED]),I[E.TRIANGLES_SELECTED]=R.clone(),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_SELECTED_COLOR"),I[E.TRIANGLES_SELECTED]),I[E.TRIANGLES_FADED]=R.clone()),I[E.PICK_DISC]=(0,d.createDisc)(e,o,t,u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),o=u.getNumber("MATE_CONNECTOR_MINI_DIAMETER_PX")/2,h=u.getNumber("MATE_CONNECTOR_MINI_STROKE_WIDTH"),g=(0,d.createCircle)(e,o,t,u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),g),I[E.INFERENCE_POINT_LINES]=g,I[E.INFERENCE_POINT_TRIANGLES]=(0,d.createRing)(e,0,o,t,i,0,2*Math.PI,4*a),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),I[E.INFERENCE_POINT_TRIANGLES]),g=(0,d.createCircle)(e,o,t,u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),g),(0,d.addSizeToIncrement)(h,g),m=(0,d.createLine)([-o,0,0],[o,0,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),T=(0,d.createLine)([0,-o,0],[0,o,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),O=g.concatenate(m),O=O.concatenate(T),O&&(I[E.INFERENCE_CENTER_LINES]=O),I[E.INFERENCE_CENTER_TRIANGLES]=(0,d.createRing)(e,0,o,t,i,0,2*Math.PI,4*a),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),I[E.INFERENCE_CENTER_TRIANGLES]),g=(0,d.createCircle)(e,o,t,u.getNumber("MATE_CONNECTOR_RADIAL_SEGMENTS")),(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),g),(0,d.addSizeToIncrement)(h,g),m=(0,d.createLine)([-o,0,0],[o,0,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),T=(0,d.createLine)([0,-o,0],[0,o,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),O=g.concatenate(m).concatenate(T),O&&(I[E.INFERENCE_CENTROID_LINES]=O);const N=(0,d.createRing)(e,0,o,t,i,0,.5*Math.PI,a);(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),N);const w=(0,d.createRing)(e,0,o,t,i,.5*Math.PI,Math.PI,a);(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_DARK_FILL_COLOR"),w);const b=(0,d.createRing)(e,0,o,t,i,Math.PI,1.5*Math.PI,a);(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"),b);const L=(0,d.createRing)(e,0,o,t,i,1.5*Math.PI,2*Math.PI,a);(0,d.addColorToIncrement)(u.getColor("MATE_CONNECTOR_INFERENCE_DARK_FILL_COLOR"),L);const B=N.concatenate(w).concatenate(b).concatenate(L);I[E.INFERENCE_CENTROID_TRIANGLES]=B;const F=.7071*o,x=(0,d.createLine)([-F,-F,0],[F,-F,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),U=(0,d.createLine)([-F,F,0],[F,F,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),G=(0,d.createLine)([-F,-F,0],[-F,F,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h),V=(0,d.createLine)([F,-F,0],[F,F,0],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),h);O=x.concatenate(U).concatenate(G).concatenate(V),O&&(I[E.INFERENCE_MID_POINT_LINES]=O),I[E.INFERENCE_MID_POINT_TRIANGLES]=(0,d.createTriangleStrip)([-F,-F,0,F,-F,0,F,F,0,-F,F,0],[1,2,0,3],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FILL_COLOR"));const H=5*u.getNumber("MATE_CONNECTOR_AXIS_LINE_LENGTH_PX"),k=2*u.getNumber("MATE_CONNECTOR_Z_AXIS_LINE_WIDTH"),W=(0,d.createLine)([0,0,0],[0,0,H],void 0,u.getColor("MATE_CONNECTOR_INFERENCE_FRAME_COLOR"),k),z=(0,d.createLine)([0,0,S],[0,0,H],void 0,u.getColor("MATE_CONNECTOR_SELECTED_COLOR"),k);return I[E.INFERENCE_ORIGIN_AXIS_LINES]=W,I[E.INFERENCE_ORIGIN_AXIS_LINES_PRESELECTED]=z,Object.values(I).forEach((function(e){(0,d.fillInDefaultAttributes)(e)})),I}t.MateConnector=S,t.getStaticIncrements=f,t.updateMateConnectorSelectedColor=function(e){const t=u.getColor("MATE_CONNECTOR_SELECTED_COLOR");if(e)for(let i=0;i<3;i++)t[i]=e[i];const i=f();i&&(0,d.addColorToIncrement)(t,i[E.TRIANGLES_SELECTED])}},605381:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MateConnectorComponent=void 0;const s=i(912057),n=i(114924),r=i(85655),a=i(606544);class o extends n.AssemblyEnabledPartStudioComponent{constructor(e,t,i){super(e,i),this.usage=t,this.mateConnectorGraphics={}}clone(e){const t=new o(e,this.usage,this.viewer);return this.copyToClone(t),t}cloneForPreview(e){const t=new o(e,n.BTGraphicsUsage.PREVIEW,this.viewer);this.copyToPreview(t);for(const e in this.mateConnectorGraphics){const i=this.mateConnectorGraphics[e],s=t.mateConnectorGraphics[e]={};for(const e in i)s[e]=i[e].cloneForPreview()}return t}getVisibleMateConnectorBounds(){const e=new n.BoundingBox;for(const t in this.mateConnectorGraphics){const i=this.mateConnectorGraphics[t];for(const t in i)i[t].isHidden||e.addPoint(i[t].worldSpacePosition)}return e}getInstantiatedMateConnectorsForOccurrence(e){const t=[];for(const i in this.mateConnectorGraphics){const s=this.mateConnectorGraphics[i];for(const i in s){const n=s[i],a=n.getDefinition();a&&(0,r.occurrencesEqual)(e,n.getOccurrence())&&t.push({Id:a.nodeId,isPartStudio:n.getIsPartStudioMateConnector()})}}return t}getComponentId(){return"mateconnector_component."}handlesEntity(e,t){return!e.hasTessellationError()&&e.isMateConnector()&&!this.viewer.getIsForFlattenedDisplay()}expectsTessellation(){return!1}reset(){for(const e in this.mateConnectorGraphics){const t=this.mateConnectorGraphics[e];for(const e in t)t[e].remove()}this.mateConnectorGraphics={},n.PartStudioComponent.prototype.reset.apply(this,arguments)}isInstantiated(){return!0}instantiateForPartStudio(e){this.addOrUpdateOccurrence(n.PART_STUDIO_ELEMENT_ID,null),n.PartStudioComponent.prototype.instantiateForPartStudio.apply(this,arguments)}removePartStudioInstantiation(e){n.PartStudioComponent.prototype.removePartStudioInstantiation.apply(this,arguments),this.removeOccurrence(n.PART_STUDIO_ELEMENT_ID,!1)}addOrUpdateOccurrence(e,t){let i=!1;for(const s in this.idToMetaData)i=this.updateEntityMateConnector(s,this.idToMetaData[s],e,t)||i;const s=e===n.PART_STUDIO_ELEMENT_ID;(i||s||this.occurrences.hasOwnProperty(e))&&super.addOrUpdateOccurrence(e,t)}addManagedIdMappings(e,t){var i;super.addManagedIdMappings(e,t);const s=null===(i=this.bodyToEntity.get(t))||void 0===i?void 0:i.getKeys();if(s)for(const t of s){const i=Object.values(this.mateConnectorGraphics[t]);for(const t of i)t.partStudioFeatureId=e,t.isFromChildFeature=!0}}getConnectorHiddenState(e,t){const i=e.getFirstFeatureId();let s=!1;if(t){const e=t.occurrenceData.featureData[i];e?s=e.visibility===a.GBTBSFeatureVisibility.HIDDEN:t.isPatternDescendant&&(s=!0)}else s=e.getFeatureIds().reduce(((e,t)=>e||this.featureVisibility[t]===n.Visibility.HIDDEN),s);return s}occurrenceContainsBody(e,t){return this.viewer.getModelViewManagers().getManagerForUsage(this.usage).occurrenceContainsBody(e,t)}createMateConnectorDisplayData(e,t){if(t&&!this.occurrenceContainsBody(t,e.getMateConnectorPartId()))return null;const i=new a.BTMateConnectorDisplayData;return i.location=e.getMateConnectorCoordinateSystem(),i.partId=e.getMateConnectorPartId(),i.nodeId=e.getFirstFeatureId(),i.occurrence=t?t.occurrenceData.occurrence:null,i.ownerOccurrence=i.occurrence,i.implicit=!1,i.hidden=this.getConnectorHiddenState(e,t),i}updateEntityMateConnector(e,t,i,s,r){if(s&&!this.occurrenceContainsBody(s,t.getMateConnectorPartId()))return!1;const a=t.getLastFeatureId(),o=this.getConnectorHiddenState(t,s);let c=this.mateConnectorGraphics[e],l=c?c[i]:null;if(!r&&s&&o&&!l){return!0}c||(c={},this.mateConnectorGraphics[e]=c);const h=this.createMateConnectorDisplayData(t,s);return!!h&&(l?l.updateDefinition(h):(l=new n.MateConnector(h,(0,n.getSceneGraphIdForUsage)(this.usage),this.viewer,a),c[i]=l),s&&(l.setOccurrenceTransform(s.occurrenceData.transform.getGlMatrix()),l.updateOccurrenceVisibility(s.isHidden?n.Visibility.HIDDEN:n.Visibility.VISIBLE)),!0)}removeOccurrence(e,t){super.removeOccurrence(e,t);for(const t in this.mateConnectorGraphics){const i=this.mateConnectorGraphics[t];if(!i)continue;const s=i[e];s&&(s.remove(),delete i[e])}}updateEntityGraphics(e,t,i){let s;for(s in this.occurrences){const t=this.occurrences[s];s=+s,this.updateEntityMateConnector(e,i,s,t)}}static getFirstNonCompoundFeatureId(e){const t=e.getFeatureIds();if(null===t)return s.log.warn("Unable to retrieve feature ids for entity: "+e.getMessageName()),null;for(let e=0;e<t.length;++e)if(!(0,n.isFeatureIdCompound)(t[e]))return t[e]}getHideableFeatureIds(){const e=[];return this.featureToIds.each(((t,i)=>{if(this.childFeatureIds.has(i))return void e.push(i);if((0,n.isFeatureIdCompound)(i))return;const s=t.getKeys();for(let t=0;t<s.length;++t){const n=s[t],r=this.idToMetaData[n];if(r){const t=o.getFirstNonCompoundFeatureId(r);if(t&&t===i)return void e.push(i)}}})),e}removeEntity(e){const t=this.mateConnectorGraphics[e];for(const e in t)t[e].remove();delete this.mateConnectorGraphics[e],n.PartStudioComponent.prototype.removeEntity.apply(this,arguments)}hideShowEntity(e,t,i){if((i=i||n.PART_STUDIO_ELEMENT_ID)===n.INVALID_OCCURRENCE_ID)return;const s=this.mateConnectorGraphics[e];for(const e in s)if(+e===i){const e=s[i];e&&(t===n.Visibility.HIDDEN?e.definition.hidden=!0:e.definition.hidden=!1,e.updateHideState())}}hideShowFeatureEntities(e,t,i){const s=this.getEntitiesForFeature(e);if(!s)return;let n=i;for(let i=0;i<s.length;++i){const r=this.idToMetaData[s[i]];if(!n){const t=o.getFirstNonCompoundFeatureId(r);n=!!t&&t===e}if(r&&n){const e=this.getOccurrenceIdForEntity(s[i]);this.hideShowEntity(s[i],t,e)}}this.viewer.requestDraw()}getAllMateConnectorGraphics(e,t){const i=this.featureToIds.get(t),s=[];return i&&i.each((function(t,i){const n=this.getMateConnectorGraphicsFromEntityId(e,i);return n&&s.push(n),!1}),this),s}getMateConnectorGraphics(e,t){const i=this.featureToIds.get(t);let s;return i&&(s=i.firstKey()),s?this.getMateConnectorGraphicsFromEntityId(e,s):null}getMateConnectorData(e,t){const i=this.featureToIds.get(t);let s;if(i&&(s=i.firstKey()),s){const t=this.idToMetaData[s],i=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString()),n=this.occurrences[i];if(t&&n)return this.createMateConnectorDisplayData(t,n)}return null}getMateConnectorGraphicsFromEntityId(e,t){if(t){let i=this.mateConnectorGraphics[t];if(e){const s=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString()),n=i?i[s]:null;if(n)return n;const r=this.idToMetaData[t],a=this.occurrences[s];if(r&&a){const e=!0;return this.updateEntityMateConnector(t,r,s,a,e),i=this.mateConnectorGraphics[t],i?i[s]:null}}else for(const e in i){const t=i[e];if(!t.getOccurrence())return t}}return null}getUIElementsForSelection(e){const t=[];if(e.isMateConnector()||e.isFeature()){this.getAllMateConnectorGraphics(e.getOccurrence(),e.getIdString()).forEach((function(e){t.push(e)}))}return t}getEntityIdsForSelection(e){return[]}getOccurrencesForSelection(e){const t=[];if(e.isMateConnector()||e.isFeature()){const i=this.getMateConnectorGraphics(e.getOccurrence(),e.getIdString());i&&t.push(i.getOccurrence())}return t}}t.MateConnectorComponent=o},582214:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createMateIndicator=t.FixedMateIndicator=t.Tangent=t.MateGroupMateIndicator=t.Ball=t.PinSlot=t.Cylindrical=t.Slider=t.Parallel=t.PlanarMateIndicator=t.Revolute=t.Fastened=t.MateIndicator=void 0;const s=i(114924),n=i(193786),r=i(905898),a=i(7401),o=i(606544);class c extends s.UIElement{constructor(e,t,i){super(i),this.definition=e,this.mateConnectorDisplayData=t,this.mateIndicatorComponents=[],this.occurrenceData.setCanIsolateChange(!0),this.occurrenceData.setIsolated(!1)}onDevicePixelRatioChanged(e){this.updateGraphics()}getDefinition(){return this.definition?this.definition:null}remove(){for(let e=0;e<this.mateIndicatorComponents.length;e++)this.mateIndicatorComponents[e].remove();super.remove()}addHighlight(e){super.addHighlight(e);for(let t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].addHighlight(e)}removeHighlight(e){const t=super.removeHighlight(e);for(let t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].removeHighlight(e);return t}onIsolateChanged(){this.updateGraphics()}isInteractionEnabled(){return!(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated())}updateGraphics(){for(let e=0;e<this.mateIndicatorComponents.length;e++)this.mateIndicatorComponents[e].updateGraphics()}setIsolated(e){this.occurrenceData.setIsolated(e);for(let t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].getOccurrenceData().setIsolated(e)}getDefinitionMateConnectorIds(){return this.definition.getMateConnectorIds()}getDefinitionOccurrenceIds(){return this.mateIndicatorComponents.length>0?this.mateIndicatorComponents[0].getDefinitionOccurrenceIds():this.definition.getOccurrenceIds()}getModelSelection(e){return null}addMateIndicatorComponent(e){e.isValid()&&(e.updateHideState(),this.mateIndicatorComponents.push(e),this.listenTo(e,s.UiEvents.LONG_PRESS_START,this.onLongPressStart),this.listenTo(e,s.UiEvents.LONG_PRESS_END,this.onLongPressEnd))}onLongPressStart(){const e=[];this.getDefinitionOccurrenceIds().forEach((function(t){e.push(o.BTOccurrence.getOccurrenceFromPathString(t))})),this.viewer.getIsolatedOccurrenceManager().isolateOccurrences(e,s.IsolateFlag.INITIAL),(0,n.clearPreSelection)()}onLongPressEnd(){(0,r.getCommandDispatcher)().trigger(a.commands.EXIT_ISOLATE,this.viewer)}updateMateConnectorDisplayData(e){this.mateConnectorDisplayData=e;for(let e=0;e<this.mateIndicatorComponents.length;++e)this.mateIndicatorComponents[e].updateMateConnectorDisplayData(this.mateConnectorDisplayData)}updateHiddenMode(e){for(let t=0;t<this.mateIndicatorComponents.length;t++)this.mateIndicatorComponents[t].updateHiddenMode(e)&&this.mateIndicatorComponents[t].updateHideState()}}t.MateIndicator=c;class l extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"FASTENED",t,this.viewer,o.GBTMateType.FASTENED);this.addMateIndicatorComponent(n)}}t.Fastened=l;class h extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"REVOLUTE",t,this.viewer,o.GBTMateType.REVOLUTE);this.addMateIndicatorComponent(n)}}t.Revolute=h;class d extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"PLANAR_BASE",t,this.viewer,o.GBTMateType.PLANAR);this.addMateIndicatorComponent(n)}}t.PlanarMateIndicator=d;class u extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"PARALLEL_BASE",t,this.viewer,o.GBTMateType.PARALLEL);this.addMateIndicatorComponent(n)}}t.Parallel=u;class g extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"SLIDER_BASE",t,this.viewer,o.GBTMateType.SLIDER),r=new s.Arrow(this.mateConnectorDisplayData,t,-Math.PI/2,[0,1,0],this.viewer,o.GBTMateType.SLIDER);this.addMateIndicatorComponent(n),this.addMateIndicatorComponent(r)}}t.Slider=g;class p extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"CYLINDRICAL_BASE",t,this.viewer,o.GBTMateType.CYLINDRICAL),r=new s.Arrow(this.mateConnectorDisplayData,t,-Math.PI/2,[0,1,0],this.viewer,o.GBTMateType.CYLINDRICAL);this.addMateIndicatorComponent(n),this.addMateIndicatorComponent(r)}}t.Cylindrical=p;class m extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"PIN_SLOT_BASE",t,this.viewer,o.GBTMateType.PIN_SLOT);this.addMateIndicatorComponent(n)}}t.PinSlot=m;class E extends c{constructor(e,t,i){super(t,e,i);const n=new s.Base(this.mateConnectorDisplayData,"BALL",t,this.viewer,o.GBTMateType.BALL);this.addMateIndicatorComponent(n)}}t.Ball=E;t.MateGroupMateIndicator=class extends c{constructor(e,t,i){super(t,[],i);const n=new s.MateGroup(e,t,this.viewer);this.addMateIndicatorComponent(n)}updateOccurenceDisplayData(e){for(let t=0;t<this.mateIndicatorComponents.length;++t)this.mateIndicatorComponents[t].updateOccurenceDisplayData(e)}};t.Tangent=class extends c{constructor(e,t){super(e,null,t);const i=new s.GeometryMate(e,"TANGENT",this.viewer);this.addMateIndicatorComponent(i)}updateMateIndicatorDefinition(e){this.definition=e;for(let e=0;e<this.mateIndicatorComponents.length;++e)this.mateIndicatorComponents[e].updateDefinition(this.definition)}};t.FixedMateIndicator=class extends c{constructor(e,t,i){super(null,null,i);const n=new s.Fixed(e,t,this.viewer);this.addMateIndicatorComponent(n)}},t.createMateIndicator=function(e,t,i){let s=null;switch(t.mateType){case o.GBTMateType.FASTENED:s=new l(e,t,i);break;case o.GBTMateType.REVOLUTE:s=new h(e,t,i);break;case o.GBTMateType.SLIDER:s=new g(e,t,i);break;case o.GBTMateType.PLANAR:s=new d(e,t,i);break;case o.GBTMateType.PARALLEL:s=new u(e,t,i);break;case o.GBTMateType.CYLINDRICAL:s=new p(e,t,i);break;case o.GBTMateType.PIN_SLOT:s=new m(e,t,i);break;case o.GBTMateType.BALL:s=new E(e,t,i);break;default:s=null}return s}},919139:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Fixed=t.GeometryMate=t.MateGroup=t.Arrow=t.Base=t.MateIndicatorComponent=t.ensureMateIndicatorResources=void 0;const s=i(32620),n=i(114924),r=i(545348),a=i(193786),o=i(873896),c=i(606544),l=i(132549),h=i(264292),d=i(613199),u={FASTENED:"mateindicators/MateIndicatorAssets_Fastened",REVOLUTE:"mateindicators/MateIndicatorAssets_Revolute",SLIDER_BASE:"mateindicators/MateIndicatorAssets_Ball",PLANAR_BASE:"mateindicators/MateIndicatorAssets_PlanarCenter",CYLINDRICAL_BASE:"mateindicators/MateIndicatorAssets_Revolute",PIN_SLOT_BASE:"mateindicators/MateIndicatorAssets_PinSlot",PARALLEL_BASE:"mateindicators/MateIndicatorAssets_Parallel",BALL:"mateindicators/MateIndicatorAssets_Ball",ARROW:"mateindicators/MateIndicatorAssets_DirectionArrow",GROUP:"mateindicators/MateIndicatorAssets_Group",TANGENT:"mateindicators/MateIndicatorAssets_Tangent",FIXED:"mateindicators/MateIndicatorAssets_Fixed"},g=r.default.getManager(),p=g.getNumber("UNSCALED_MATE_SCREEN_SIZE"),m="MateIndicatorComponent";function E(e){e.getResources().mateIndicatorGlyphResources||(e.getResources().mateIndicatorGlyphResources=new n.GlyphResources(n.MATE_INDICATOR_ATLAS,e,u,p*(0,s.getDevicePixelRatio)()))}t.ensureMateIndicatorResources=E;class I extends n.UIElement{constructor(e,t,i,s,r){super(s),this.mateConnectorDisplayData=e,this.type=t,this.definition=i,this.occurrenceTransforms=[],this.connectorCoordinateSystems=[],this.worldSpacePositions=[],this.worldSpacePosition=[0,0,0],this.lastScale=-1,this.positionComputed=!1,this.inHiddenMode=!1,E(this.viewer),this.id=t,this.featureType=l.FeatureTypeName.MATE,this.mateType=r,this.listenTo(this,n.UiEvents.LONG_PRESS_START+m,this.onLongPressStart),this.listenTo(this,n.UiEvents.LONG_PRESS_END+m,this.onLongPressEnd),this.damageTransform(),this.occurrenceData.setCanIsolateChange(!0),this.occurrenceData.setIsolated(!1)}updateHiddenMode(e){return this.inHiddenMode!==e&&(this.inHiddenMode=e,!0)}updateHideState(){this.isHighlighted()||!this.definition.hidden&&!this.inHiddenMode?(this.hasMeshIncrements()||this.updateGraphics(!0),this.positionComputed||this.computePosition(),this.show()):this.hide()}onLongPressStart(){this.trigger(n.UiEvents.LONG_PRESS_START)}onLongPressEnd(){this.trigger(n.UiEvents.LONG_PRESS_END)}addHighlight(e){super.addHighlight(e),this.updateHideState(),this.updateGraphics()}removeHighlight(e){return!!super.removeHighlight(e)&&(this.updateHideState(),this.updateGraphics(),!0)}onViewWillDraw(e){this.isHidden||this.hasBeenRemoved||(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&this.updateGraphics(),this.adjustTransform(e))}updateIsolation(){let e=1;this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated()&&(e=g.getNumber("ISOLATE_CONTEXT_UI_TRANSPARENCY")*(0,n.getTransparencyTransition)()+(1-(0,n.getTransparencyTransition)()));let t=this.getIncrement();t&&(t=(0,n.setIncrementOpacity)(t,e),this.updateMeshIncrement(this.type,m,t,this.getNodeProperties()))}updateGraphics(e){if(!this.isValid())return;if(!this.definition||this.isHidden&&!e)return void this.removeMeshIncrements();if(!this.glyphResources.atlasReady)return;const t=this.getIncrement();t&&(this.updateMeshIncrement(this.type,m,t,this.getNodeProperties()),this.updateIsolation())}getIncrement(){return null}get glyphResources(){return this.viewer.getResources().mateIndicatorGlyphResources}getNodeProperties(){return this.glyphResources.getNodeProperties(this.getHighlightStateId(),this.getMateStateId(),this.getRenderOrderPriority())}getRenderOrderPriority(){return n.RenderOrderPriority.LOWER}getMateStateId(){return this.definition.status===c.GBTAssemblyFeatureDisplayStatus.ERROR?"ERROR":this.definition.status===c.GBTAssemblyFeatureDisplayStatus.SUPPRESSED?"SUPPRESSED":"NORMAL"}getHighlightStateId(){const e=this.getHighlight();return e&&e.type===n.HighlightType.PRE?"PRE_HIGHLIGHT":e?"HIGHLIGHT":"NO_HIGHLIGHT"}getTextureId(){return this.type}isValid(){return!!this.worldSpacePosition}computePosition(){for(let e=0;e<this.mateConnectorDisplayData.length;e++)this.occurrenceTransforms[e]=this.viewer.getModelViewManagers().getManager().getOccurrenceTransform(this.mateConnectorDisplayData[e].occurrence),this.connectorCoordinateSystems[e]=this.mateConnectorDisplayData[e].location,this.worldSpacePositions[e]=d.mat4C.multiplyVec3(this.occurrenceTransforms[e],this.connectorCoordinateSystems[e].origin.getVec3(),h.vec3.create());this.worldSpacePositions.length>0?this.worldSpacePosition=this.worldSpacePositions[0]:(this.worldSpacePosition=null,this.removeMeshIncrements()),this.positionComputed=!0}causePositionRecompute(){this.lastScale=-1,this.positionComputed=!1,this.isHidden||this.computePosition()}updateMateConnectorDisplayData(e){this.mateConnectorDisplayData=e,this.causePositionRecompute()}getDefinitionOccurrenceIds(){const e=[];for(let t=0;t<this.mateConnectorDisplayData.length;t++)e.push(this.mateConnectorDisplayData[t].occurrence.getPathAsString());return e}getRelatedOccurrences(){const e=[];for(let t=0;t<this.mateConnectorDisplayData.length;t++)e.push(this.mateConnectorDisplayData[t].occurrence);return e}getModelSelection(){if(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&!this.occurrenceData.getIsolated())return null;const e=this.getRelatedOccurrences(),t=[];for(let i=0;i<e.length;i++){const s=e[i],n=new a.Selection(c.GBTUiSelectionType.OCCURRENCE,s,s);t.push(n)}for(let e=0;e<this.mateConnectorDisplayData.length;e++){const i=this.mateConnectorDisplayData[e],s=new a.Selection(c.GBTUiSelectionType.MATE_CONNECTOR,i.nodeId,i.ownerOccurrence,{isDerivedFeature:i.isDerivedFeature});t.push(s)}return new a.Selection(c.GBTUiSelectionType.MATE,this.definition.nodeId,this.definition.ownerOccurrence,{featureType:this.featureType,mateType:this.mateType,childSelections:t,isDerivedFeature:this.definition.isDerivedFeature})}adjustTransform(e){if(this.positionComputed||this.computePosition(),!this.isValid())return;const t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition)*(0,s.getDevicePixelRatio)();if(Math.abs(this.lastScale-t)<o.Tolerances.ZERO_LENGTH&&this.hasMeshIncrements())return;this.lastScale=t;const i=h.mat4.create();i[0]=t,i[5]=t,i[10]=t,this.setTransform(d.mat4C.rotateX(d.mat4C.multiply(d.mat4C.multiply(this.occurrenceTransforms[0],this.connectorCoordinateSystems[0].getGlMatrix(),h.mat4.create()),i),-Math.PI/2)),this.hasMeshIncrements()||this.updateGraphics()}damageTransform(){this.lastScale=-1,this.connectorCoordinateSystems[0]&&d.mat4C.multiplyVec3(this.occurrenceTransforms[0],this.connectorCoordinateSystems[0].origin.getVec3(),this.worldSpacePosition),(0,n.requestDraw)()}}t.MateIndicatorComponent=I;class T extends I{constructor(e,t,i,s,n){super(e,t,i,s,n)}getIncrement(){const e=this.glyphResources.getTextureCoordsOffset(this.getTextureId(),this.getMateStateId(),this.getHighlightStateId(),.5);return(0,n.createQuad)([-p/2,0,-p/2],[p/2,0,-p/2],[-p/2,0,p/2],void 0,[e.lowS,e.highT],[e.highS,e.lowT])}}t.Base=T;t.Arrow=class extends I{constructor(e,t,i,s,n,r){super(e,"ARROW",t,n,r),this.rotationAngle=i,this.rotationAxis=s}getIncrement(){const e=this.glyphResources.getTextureCoordsOffset(this.getTextureId(),this.getMateStateId(),this.getHighlightStateId(),1);return(0,n.createQuad)([0,0,-p/4],[p,0,-p/4],[0,0,p/4],void 0,[e.lowS,e.highT],[e.highS,e.lowT])}adjustTransform(e){if(this.positionComputed||this.computePosition(),!this.isValid())return;const t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition)*(0,s.getDevicePixelRatio)();if(Math.abs(this.lastScale-t)<o.Tolerances.ZERO_LENGTH&&this.hasMeshIncrements())return;this.lastScale=t;const i=h.mat4.create();i[0]=t,i[5]=t,i[10]=t;const n=d.mat4C.multiply(d.mat4C.multiply(this.occurrenceTransforms[0],this.connectorCoordinateSystems[0].getGlMatrix(),h.mat4.create()),i),r=d.mat4C.rotate(n,this.rotationAngle,this.rotationAxis);this.setTransform(r),this.hasMeshIncrements()||this.updateGraphics()}getHighlightStateId(){return"NO_HIGHLIGHT"}getRenderOrderPriority(){return n.RenderOrderPriority.DEFAULT}};t.MateGroup=class extends T{constructor(e,t,i){super([],"GROUP",t,i),this.occurrenceDisplayData=e,this.featureType=l.FeatureTypeName.MATE_GROUP}getDefinitionOccurrenceIds(){return this.definition.getOccurrenceIds()}getRelatedOccurrences(){const e=[];for(let t=0;t<this.occurrenceDisplayData.length;t++)e.push(this.occurrenceDisplayData[t].occurrenceData.occurrence);return e}computePosition(){if(!this.occurrenceDisplayData)return;let e=null;const t=this.viewer.getModelViewManagers().getManager();for(let i=0;i<this.occurrenceDisplayData.length;i++){const s=this.occurrenceDisplayData[i].occurrenceData.occurrence;this.occurrenceTransforms[i]=t.getOccurrenceTransform(s),this.connectorCoordinateSystems[i]=c.BTCoordinateSystem.createValidDefault(),this.worldSpacePositions[i]=d.mat4C.multiplyVec3(this.occurrenceTransforms[i],this.connectorCoordinateSystems[i].origin.getVec3(),h.vec3.create());const r=t.getOccurrenceBounds(s);r&&r.isFinite()&&(e||(e=new n.BoundingBox),e.addBox(r))}if(this.worldSpacePositions.length>0&&e){const t=e.center();this.connectorCoordinateSystems[0].origin.updateFromArray(d.vec3C.subtract(t,this.worldSpacePositions[0])),this.worldSpacePosition=t}else this.worldSpacePosition=null,this.removeMeshIncrements();this.positionComputed=!0}updateOccurenceDisplayData(e){this.occurrenceDisplayData=e,this.causePositionRecompute()}};t.GeometryMate=class extends T{constructor(e,t,i){super([],t,e,i),this.featureType=l.FeatureTypeName.GEOMETRY_MATE}computePosition(){const e=this.definition;e&&e.location?this.worldSpacePosition=e.location.origin.getVec3():(this.worldSpacePosition=null,this.removeMeshIncrements()),this.positionComputed=!0}updateDefinition(e){this.definition=e,this.causePositionRecompute()}getDefinitionOccurrenceIds(){const e=this.getRelatedOccurrences(),t=[];return e.forEach((function(e){t.push(e.getPathAsString())})),t}getRelatedOccurrences(){const e=[],t=this.definition;return t&&(t.firstOccurrence&&e.push(t.firstOccurrence),t.secondOccurrence&&e.push(t.secondOccurrence)),e}adjustTransform(e){if(this.positionComputed||this.computePosition(),!this.isValid())return;const t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition)*(0,s.getDevicePixelRatio)();if(Math.abs(this.lastScale-t)<o.Tolerances.ZERO_LENGTH&&this.hasMeshIncrements())return;this.lastScale=t;const i=h.mat4.create();i[0]=t,i[5]=t,i[10]=t;const n=this.definition;this.setTransform(d.mat4C.rotateX(d.mat4C.multiply(n.location.getGlMatrix(),i),-Math.PI/2)),this.hasMeshIncrements()||this.updateGraphics()}};t.Fixed=class extends T{constructor(e,t,i){super([],"FIXED",new c.BTAssemblyFeatureDisplayData(!0),i),this.occurrenceDisplayData=[],this.connectorCoordinateSystems[0]=c.BTCoordinateSystem.createValidDefault();const s=this.viewer.retrieveCanvasLocationWorldPosition(t);if(s)this.worldSpacePosition=s,this.connectorCoordinateSystems[0].origin.updateFromArray(s);else{const t=this.viewer.getModelViewManagers().getManager().getOccurrenceBounds(e);if(t&&t.isFinite()){const e=new n.BoundingBox;e.addBox(t);const i=e.center();this.worldSpacePosition=i,this.connectorCoordinateSystems[0].origin.updateFromArray(i)}}this.occurrenceTransforms[0]=h.mat4.create()}computePosition(){this.positionComputed=!0}}},841407:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.OriginElement=void 0;const s=i(114924),n=i(545348),r=i(873896),a=i(193786),o=i(606544),c=i(132549),l=i(264292),h=i(613199),d=n.default.getManager(),u=new s.NodeProperties({zOffset:d.getNumber("ORIGIN_Z_OFFSET"),primitiveType:s.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1});var g;!function(e){e.POINT="point"}(g||(g={}));class p extends s.UIElement{constructor(e,t){super(t),this.definition=e,this.lastScale=-1,this.worldSpacePosition=[0,0,0],this.id="AssemblyOriginElement",this.occurrenceTransform=l.mat4.create(),this.updateHideState()}setOccurrenceTransform(e){this.occurrenceTransform=e,this.damageTransform()}updateDefinition(e){this.definition=e,this.updateHideState(),this.damageTransform()}damageTransform(){if(this.lastScale=-1,this.definition){const e=[0,0,0];h.mat4C.multiplyVec3(this.occurrenceTransform,e,this.worldSpacePosition)}(0,s.requestDraw)()}getUserVisibilitySetting(){return this.definition.hidden?s.Visibility.HIDDEN:s.Visibility.VISIBLE}updateHideState(){this.isHighlighted()||this.getUserVisibilitySetting()!==s.Visibility.HIDDEN?(this.hasMeshIncrements()||this.updateGraphics(!0),this.show()):this.hide()}getBounds(){if(this.isVisibleToUser()){const e=new s.BoundingBox;return e.addPoint(this.worldSpacePosition),e}return null}onViewWillDraw(e){this.adjustTransform(e)}adjustTransform(e){if(!this.definition||this.isHidden)return;const t=e.getPixelSizeAtWorldPoint(this.worldSpacePosition);if(Math.abs(this.lastScale-t)<r.Tolerances.ZERO_LENGTH)return;this.lastScale=t;const i=l.mat4.create();i[0]=t,i[5]=t,i[10]=t,this.setTransform(h.mat4C.multiply(this.occurrenceTransform,i,l.mat4.create())),this.hasMeshIncrements()||this.updateGraphics()}updateGraphics(e){if(!this.definition||this.isHidden&&!e)return void this.removeMeshIncrements();const t=function(){if(m)return m;m={};const e=(0,s.createPoint)([0,0,0],"point",d.getColor("ORIGIN_COLOR"),d.getNumber("ORIGIN_SIZE"));(0,s.addStyleToIncrement)(d.getPointFont("ORIGIN_FONT"),e),e&&(m[g.POINT]=e);return Object.values(m).forEach((function(e){(0,s.fillInDefaultAttributes)(e)})),m}();this.updateMeshIncrement(g.POINT,s.NO_SELECTION_ID,t[g.POINT].clone(),u)}getOccurrence(){return null}getModelSelection(e){if(!this.definition)return null;const t=new o.BTOccurrence,i=new a.Selection(o.GBTUiSelectionType.FEATURE,o.BTAssemblyDefaultFeatures.ORIGIN_ID,t,{sourcePick:e.sourcePick});return i.setFeatureType(c.FeatureTypeName.ASSEMBLY_ORIGIN),i}addHighlight(e){super.addHighlight(e),this.updateHideState(),this.addHighlightToIncrement(g.POINT,e)}removeHighlight(e){return this.removeHighlightFromIncrement(g.POINT,e),!!super.removeHighlight(e)&&(this.updateHideState(),!0)}}t.OriginElement=p;let m=null},539329:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudio=void 0;const s=i(719347),n=i(912057),r=i(606544),a=i(736234),o=i(114924),c=i(723617),l=i(264292),h=function(e){return e.isFace()||e.isFromSketch()&&e.isEdge()||e.isFromOrigin()||e.isSketchUserPoint()||e.isFromPointBody()||e.isFromWireBody()},d=function(e){return e.isFace()||e.isFromWireBody()&&e.isEdge()||e.isFromPointBody()};class u extends o.Element{constructor(e,t,i,s,n,r,a){super(r),this.id=e,this.microversionIdAndConfiguration=t,this.modelViewManager=i,this.usage=n,this.isExternal=!1,this.isForIncontextDisplay=!1,this.bodyIdsThatAreInsertableBuffers=null,this.hideableFeatureIds=[],this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.displayedContextTransform={},this.editedInContextOccurrences=[],this.partColorCycle=null,this.isCachedPartStudioPendingUse=!1,this.isMissingTangencyInformationMessageShown=!1,this.bodyIdToEntityAppearanceSettings={},this.meshOwnerId=a?a.meshOwnerId:(0,o.getNewOwnerId)(),this.sharedBaseMeshManager=i.getSharedBaseMeshManager(),this.entityIdManager=new o.NamedIdManager(o.IdSizes.ENTITY),this.bodyComponent=new o.BodyComponent(this,s,this.usage,this.viewer),this.sketchComponent=new o.SketchComponent(this,this.usage,this.viewer),this.planeComponent=new o.PlaneComponent(this,this.usage,this.viewer),this.pointBodyComponent=new o.PointBodyComponent(this,this.viewer),this.mateConnectorComponent=new o.MateConnectorComponent(this,this.usage,this.viewer),this.errorComponent=new o.ErrorComponent(this,this.viewer),this.dimensionComponent=new o.DimensionComponent(this.usage,this.id,this.viewer),this.imageComponent=new o.ImageComponent(this.usage,this.viewer),this.components=[this.bodyComponent,this.sketchComponent,this.planeComponent,this.pointBodyComponent,this.mateConnectorComponent,this.errorComponent]}clone(e){const t=new u(this.id,this.microversionIdAndConfiguration,this.modelViewManager,this.bodyComponent.getBodyLoadTasks(),this.usage,this.viewer);if(e){for(let e=0;e<t.components.length;++e)t.bodyComponent===t.components[e]?(t.bodyComponent=this.bodyComponent.clone(t),t.components[e]=t.bodyComponent):t.planeComponent===t.components[e]?(t.planeComponent=this.planeComponent.clone(t),t.components[e]=t.planeComponent):t.sketchComponent===t.components[e]?(t.sketchComponent=this.sketchComponent.clone(t),t.components[e]=t.sketchComponent):t.pointBodyComponent===t.components[e]?(t.pointBodyComponent=this.pointBodyComponent.clone(t),t.components[e]=t.pointBodyComponent):t.mateConnectorComponent===t.components[e]&&(t.mateConnectorComponent=this.mateConnectorComponent.clone(t),t.components[e]=t.mateConnectorComponent);t.imageComponent=this.imageComponent.cloneForUsage(this.usage),t.partColorCycle=this.partColorCycle,t.isCachedPartStudioPendingUse=this.isCachedPartStudioPendingUse,t.bodyIdToEntityAppearanceSettings=this.bodyIdToEntityAppearanceSettings}return t}cloneForPreview(e,t){const i=new u(this.id,null,e,this.bodyComponent.getBodyLoadTasks(),o.BTGraphicsUsage.PREVIEW,this.viewer,this);i.entityIdManager=this.entityIdManager.clone();for(let e=0;e<i.components.length;++e)i.bodyComponent===i.components[e]?(i.bodyComponent=this.bodyComponent.cloneForPreview(i),i.components[e]=i.bodyComponent):i.planeComponent===i.components[e]?t||(i.planeComponent=this.planeComponent.cloneForPreview(i),i.components[e]=i.planeComponent):i.sketchComponent===i.components[e]?(i.sketchComponent=this.sketchComponent.cloneForPreview(i),i.components[e]=i.sketchComponent):i.pointBodyComponent===i.components[e]?t||(i.pointBodyComponent=this.pointBodyComponent.cloneForPreview(i),i.components[e]=i.pointBodyComponent):i.mateConnectorComponent===i.components[e]&&(t||(i.mateConnectorComponent=this.mateConnectorComponent.cloneForPreview(i),i.components[e]=i.mateConnectorComponent));return i.imageComponent=this.imageComponent.cloneForUsage(o.BTGraphicsUsage.PREVIEW),i.partColorCycle=this.partColorCycle,i.bodyIdToEntityAppearanceSettings=this.bodyIdToEntityAppearanceSettings,i}isBodyContainedInInsertableDisplayBuffers(e){return this.bodyIdsThatAreInsertableBuffers&&this.bodyIdsThatAreInsertableBuffers.has(e)}onPreviewDestroyed(){this.bodyComponent.onPreviewDestroyed()}copyBodyVisibility(e){this.bodyComponent.copyVisibility(e.bodyComponent)}isBase(){return this.usage===o.BTGraphicsUsage.BASE}getElementId(){return this.id}getIsMissingTangencyInformationMessageShown(){return this.isMissingTangencyInformationMessageShown}setIsMissingTangencyInformationMessageShown(e){this.isMissingTangencyInformationMessageShown=e}getIsCachedPartStudioPendingUse(){return this.isCachedPartStudioPendingUse}getFullElementId(){return this.microversionIdAndConfiguration?r.BTFullElementId.getFullElementIdString(this.id,this.microversionIdAndConfiguration.getKey()):this.id}getBtFullElementId(){const e=new r.BTFullElementId;return e.elementId=this.id,this.microversionIdAndConfiguration&&(e.microversionId=this.microversionIdAndConfiguration.microversion,e.microversionIdAndConfiguration=this.microversionIdAndConfiguration),e}getModelViewManager(){return this.modelViewManager}getMeshManager(){return this.modelViewManager.getMeshManager()}getSharedBaseMeshManager(){return this.sharedBaseMeshManager||null}populateClientCacheStateDisplayInformation(e){if(this.microversionIdAndConfiguration){const t=e.getOrCreateElementDataList(this.id,r.BTUiDocumentClientCacheState.DISPLAY_DATA);this.checkDuplicatedMicroversionIdAndConfiguration(t,this.microversionIdAndConfiguration)?t.push(this.microversionIdAndConfiguration):n.log.warn("Found duplicated part studio microversion id and configuration "+this.microversionIdAndConfiguration),this.populateTessellationSetting(e),this.populateSketchFeatures(e)}}populateSketchFeatures(e){const t=this.getBtFullElementId(),i=this.sketchComponent.featureToIds.getKeys(),s=e.listFullElementIdToReferencedSketchFeatureIds,n=new r.BTFullElementIdToReferencedSketchFeatures;return n.fullElementId=t,n.referencedSketchFeatureIds=i,s.push(n),n}populateTessellationSetting(e){let t,i=e.tessellationWithConfigurationSettings[this.id];i||(e.tessellationWithConfigurationSettings[this.id]=i=[]);for(let e=0;e<i.length;e++)if(t=i[e],t.microversionIdAndConfiguration.equals(this.microversionIdAndConfiguration))return t.tessellationSettings=this.bodyComponent.getTessellationSettings(),t.partTriangleCounts=this.bodyComponent.getPartTriangleCounts(),t;return t=new r.BTMicroversionIdAndConfigurationTessellationSetting,t.microversionIdAndConfiguration=this.microversionIdAndConfiguration,t.tessellationSettings=this.bodyComponent.getTessellationSettings(),i.push(t),t}getSceneGraph(){return this.usage===o.BTGraphicsUsage.PREVIEW?this.viewer.getSceneGraphs().getPreviewSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()}getPartColorCycle(){return this.partColorCycle}reset(e){for(let t=0;t<this.components.length;++t)this.components[t].reset(e);this.dimensionComponent.reset(),this.imageComponent.reset(),this.entityIdManager.reset(),this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.editedInContextOccurrences=[],this.sharedBaseMeshManager=null}retrieveEntityMetaData(e){for(let t=0;t<this.components.length;++t){const i=this.components[t].getEntityMetaData(e);if(i)return i}return null}retrieveBodyMetaData(e){for(let t=0;t<this.components.length;++t){const i=this.components[t].retrieveBodyMetaData(e);if(i)return i}return null}retrieveAssociatedFeatureIds(e){const t=[];for(const i of this.components){const s=i.retrieveAssociatedFeatureIds(e);s&&s.length&&t.push(...s)}return t}retrieveBodyEntityData(e){const t=[],i=this.getBodyComponent().getEntityIds(e);for(const e of i){const i=this.retrieveEntityMetaData(e);i&&t.push(i)}return t}getEntityIdManager(){return this.entityIdManager}extractMeshIncrement(e){for(let t=0;t<this.components.length;++t){const i=this.components[t].extractMeshIncrement(e);if(i)return i}return null}getHideableMateConnectorFeatureIds(){return this.mateConnectorComponent.getHideableFeatureIds()}getHideableSketchFeatureIds(){return this.sketchComponent.getHideableFeatureIds()}getHideablePlaneFeatureIds(){return this.planeComponent.getHideableFeatureIds()}getHideableFeatureIds(){return this.hideableFeatureIds}addManagedIdMappings(e){for(const t of Object.values(e)){const e=t.managedData;if(e)for(const t of e)for(const e of t.bodyIds){const i=t.creationId;switch(t.type){case r.GBTManagedDataSetType.SKETCH:this.sketchComponent.addManagedIdMappings(i,e);break;case r.GBTManagedDataSetType.CONSTRUCTION_PLANE:this.planeComponent.addManagedIdMappings(i,e);break;case r.GBTManagedDataSetType.MATE_CONNECTOR:this.mateConnectorComponent.addManagedIdMappings(i,e);break;default:this.sketchComponent.addManagedIdMappings(i,e),this.planeComponent.addManagedIdMappings(i,e),this.mateConnectorComponent.addManagedIdMappings(i,e)}}}}fixPartAndDisplayDataForMessage(e){this.bodyIdsThatAreInsertableBuffers||(this.bodyIdsThatAreInsertableBuffers=new Set);for(const t of Object.values(e.partIdAndTessellationSettingToBuffers)){const i=Object.values(t);if(i.length>0&&i[0]instanceof r.BTInsertablePartDisplayData){const t=i[0],s=t.getId();e.deterministicPartIdToData[s]=t.partData,e.partDisplayData.push(t.partDisplayData),this.bodyIdsThatAreInsertableBuffers.add(s)}}for(const t of Object.values(e.sketchFeatureIdAndTessellationSettingToBuffers)){const i=Object.values(t);if(i.length>0&&i[0]instanceof r.BTInsertableSketchDisplayData){const t=i[0];t.getId();for(const[i,s]of Object.entries(t.bodyIdToPartData))e.deterministicPartIdToData[i]=s,this.bodyIdsThatAreInsertableBuffers.add(i)}}}processDisplayData(e,t,i,r,a){if((this.isBase()?e.buildFullElementId().toString():e.elementId)!==(this.isBase()?this.getFullElementId():this.id))return void n.log.warn("An attempt was made to update part studio graphics with display data that do not belong to it.");if(this.updateExternalState(e.isExternal,i),e.isNoop)return;e.fromDisplayCache&&(this.isCachedPartStudioPendingUse=!0),this.viewer.areOptimizedBuffersEnabled&&this.fixPartAndDisplayDataForMessage(e),this.partColorCycle||(this.partColorCycle=e.partColorCycle),this.hideableFeatureIds=[];let l,h,d,u=0;const g=new s.Timer("processDisplayData");if(e.incremental){const t=new s.Timer("Deleting entities");for(l=0;l<this.components.length;++l)this.components[l].processDeletions(e);t.report()}else this.reset();let p=!this.viewer.getIsForFlattenedDisplay()||!(0,c.isEmptyObjectOrArray)(e.appearanceIdToAppearanceOverride);if(!p)for(const t in e.deterministicPartIdToData)if(e.deterministicPartIdToData[t].isForFlattenedView()){p=!0;break}p||this.bodyComponent.updateBodyDisplayData(e,r);const m=new s.Timer("Updating entities");for(l=0;l<this.components.length;++l){this.viewer.getIsForFlattenedDisplay()&&!p||this.components[l].processAdditionsAndChanges(e,t,r);const i=this.components[l].getHideableFeatureIds();for(h=0;h<i.length;++h)this.hideableFeatureIds.push(i[h])}if(this.bodyComponent.updateCompositeConstituentCounts(e),m.report(),e.bodyIdToEntityAppearanceSettingsChanged&&(this.bodyIdToEntityAppearanceSettings=e.bodyIdToEntityAppearanceSettings),e.partDisplayData){const t=e.partDisplayData.length;for(d=0;d<t;d++){const t=e.partDisplayData[d].id;if(e.partDisplayData[d].baseAppearanceSettings=this.bodyIdToEntityAppearanceSettings[t],!e.partDisplayData[d].baseAppearanceSettings){const i=this.retrieveBodyMetaData(t);if(i&&i.isClosedComposite){const s=e.partDisplayData[d];let n=!1;const r=i.constituentBodyIds.length;for(u=0;u<r;u++){const e=i.constituentBodyIds[u];if(!this.bodyIdToEntityAppearanceSettings[e])continue;const r=this.bodyIdToEntityAppearanceSettings[e];if(n){if(s.baseAppearanceSettings&&r.colorIdToBaseEntityAppearanceEntry){const e=r.colorIdToBaseEntityAppearanceEntry;for(const t in e)if(t){const i=e[t];i&&(s.baseAppearanceSettings.colorIdToBaseEntityAppearanceEntry[t]?s.baseAppearanceSettings.colorIdToBaseEntityAppearanceEntry[t].affectedDeterministicIds=s.baseAppearanceSettings.colorIdToBaseEntityAppearanceEntry[t].affectedDeterministicIds.concat(i.affectedDeterministicIds):s.baseAppearanceSettings.colorIdToBaseEntityAppearanceEntry[t]=i)}}}else n=!0,s.baseAppearanceSettings=r,this.bodyIdToEntityAppearanceSettings[t]=s.baseAppearanceSettings}}}}}this.isForIncontextDisplay||this.viewer.getIsForFlattenedDisplay()||this.viewer.getEventDispatcher().trigger(o.NEW_PART_LIST,e.partDisplayData,e.buildFullElementId(),e.usage,this.bodyComponent.bodyMetaData,a),this.dimensionComponent.processDisplayData(e),this.imageComponent.processDisplayData(e),e.incremental||t||this.bodyComponent.reloadOccurrences(),t&&(this.dimensionComponent.updateDisplays(),this.imageComponent.updateDisplays()),this.processInContextData(e,t),this.viewer.getEventDispatcher().trigger(o.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,e,r),g.report()}processReceivedInsertableData(e){const t={},i={};i[e.getTessellationSetting()]=e,t[e.getId()]=i;const s=e.isSketchFeature()?this.getSketchComponent():this.getBodyComponent(),n=e.getId();s.processPrecompiledGraphicsBuffers(t),e.isSketchFeature()||s.refreshBodyOccurrenceForBodyId(n),this.viewer.requestDraw()}processInContextData(e,t){if(this.isBase()){let i,s=!1;if(e.assemblyReferenceDisplayData){const t=e.assemblyReferenceDisplayData.assemblyReferences;for(i=0;i<t.length;i++)t[i].visibility===r.GBTBSFeatureVisibility.VISIBLE&&(s=!0)}if(s){if(t)for(this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.editedInContextOccurrences=[],this.displayedContextTransform={},i=0;i<e.assemblyReferenceDisplayData.assemblyReferences.length;i++){const t=e.assemblyReferenceDisplayData.assemblyReferences[i],s=t.isTransient?"":t.referenceNodeId,n=t.assemblyDisplayData;t.occurrencesToExclude.forEach((function(e){this.editedInContextOccurrences.push({assemblyElementId:n.elementId,occurrence:e,contextId:s})}),this);const a=(0,o.getPartstudioElementIdFromContextId)(n.elementId);let c=n.elementId;a!==e.assemblyReferenceDisplayData.elementId&&(c=(0,o.getAssemblyInContextElementId)(n.elementId,e.assemblyReferenceDisplayData.elementId,t.referenceNodeId)),this.referencedInContextAssemblyIds.push(c),t.visibility===r.GBTBSFeatureVisibility.VISIBLE&&(this.visibleInContextAssembly=c),this.displayedContextTransform[s]=t.transform}}else t&&this.removeInContextAssemblies()}else if(this.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly()){const e=!0;(0,o.getActiveViewerEventDispatcher)().trigger(o.UPDATE_INCONTEXT_ISOLATION,e)}}updateExternalState(e,t){this.isExternal=e,this.isForIncontextDisplay=!!t}getReferencedInContextAssemblyIds(){return this.referencedInContextAssemblyIds}isDisplayingIncontextAssembly(){return!!this.visibleInContextAssembly}getVisibleInContextAssemblyId(){return this.visibleInContextAssembly}removeInContextAssemblies(){this.viewer.getModelViewManagers().getManager().resetAllIncontextGraphicsForPartstudio(this.getElementId()),this.referencedInContextAssemblyIds=[],this.visibleInContextAssembly="",this.editedInContextOccurrences=[]}getEditedOccurrenceForAssembly(e,t){const i=(0,a.find)(this.editedInContextOccurrences,{assemblyElementId:e,contextId:t});return i?i.occurrence:null}removeInstantiationForEditing(e){this.removeInContextAssemblies();for(let t=0;t<this.components.length;++t)this.components[t].removePartStudioInstantiation(e);this.dimensionComponent.remove(),this.imageComponent.remove()}instantiateForEditingInNode(e){this.isCachedPartStudioPendingUse=!1,this.bodyComponent.instantiateForPartStudio(e),this.sketchComponent.instantiateForPartStudio(e),this.mateConnectorComponent.instantiateForPartStudio(e),this.planeComponent.instantiateForPartStudio(e),this.pointBodyComponent.instantiateForPartStudio(e),this.dimensionComponent.updateDisplays()}getDimensionGraphic(e,t){return this.dimensionComponent.getDimensionGraphic(e,t)}addOrUpdateOccurrence(e,t,i){this.isCachedPartStudioPendingUse=!1,this.sketchComponent.addOrUpdateOccurrence(e,t),this.bodyComponent.addOrUpdateOccurrence(e,t),i&&this.mateConnectorComponent.addOrUpdateOccurrence(e,t)}removeOccurrence(e,t){this.sketchComponent.removeOccurrence(e,t),this.bodyComponent.removeOccurrence(e,t),this.mateConnectorComponent.removeOccurrence(e,t),this.imageComponent.removeOccurrence(e)}getChildNodesWithId(e,t){const i=[],s=t?[t]:this.getSceneGraph().getAllNodesWithId(o.ROOT_ELEMENT_NODE_ID),n=function(t){return t.getId()===e&&i.push(t),!1};for(let e=0;e<s.length;++e)s[e].walk(n);return i}hideSketch(e){this.sketchComponent.hideShowFeature(e,o.Visibility.HIDDEN),this.dimensionComponent.sketchHidden(e),this.imageComponent.onSketchHidden(e),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.HIDDEN)}showSketch(e){this.sketchComponent.hideShowFeature(e,o.Visibility.VISIBLE),this.dimensionComponent.sketchShown(e),this.imageComponent.onSketchShown(e),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.VISIBLE)}displaySketchAsActive(e,t){void 0===t&&(t=!0),this.sketchComponent.displaySketchAsActive(e,t),this.dimensionComponent.displaySketchAsActive(e,t),t?this.imageComponent.onSketchActivated(e):this.imageComponent.onSketchDeactivated(e)}displaySketchAsInactive(e){this.displaySketchAsActive(e,!1)}hasActiveSketch(){return this.sketchComponent.hasActiveSketch()}getPartNodes(e){return this.getChildNodesWithId(o.BodyComponentId,e)}setPlaneAppearance(e,t){this.planeComponent.updateFeatureAppearance(e,t)}getBoundsOutsideElementNode(){const e=new o.BoundingBox;return e.addBox(this.planeComponent.getVisiblePlaneBounds()),e.addBox(this.dimensionComponent.getVisibleDimensionBounds()),e.addBox(this.mateConnectorComponent.getVisibleMateConnectorBounds()),e}showPointBodies(e){this.pointBodyComponent.hideShowFeature(e,o.Visibility.VISIBLE),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.VISIBLE)}hidePointBodies(e){this.pointBodyComponent.hideShowFeature(e,o.Visibility.HIDDEN),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.HIDDEN)}hidePart(e){const t=this.bodyComponent.hideShowBody(e,o.Visibility.HIDDEN,o.PART_STUDIO_ELEMENT_ID);return t&&this.trigger("BODY_VISIBILITY_CHANGE."+e,o.Visibility.HIDDEN),t}showPart(e){const t=this.bodyComponent.hideShowBody(e,o.Visibility.VISIBLE,o.PART_STUDIO_ELEMENT_ID);return t&&this.trigger("BODY_VISIBILITY_CHANGE."+e,o.Visibility.VISIBLE),t}changePartColor(e,t,i){this.bodyComponent.setBodyColor(e,t,i)}changePartOpacity(e,t,i){this.bodyComponent.setBodyOpacity(e,t,i)}getPartColor(e){return this.bodyComponent.getBodyColor(e).slice(0)}getPartOpacity(e){return this.bodyComponent.getBodyColor(e)[3]}getEntityColor(e){return this.bodyComponent.getEntityColor(e)}hideConstructionPlane(e){this.planeComponent.hideShowFeature(e,o.Visibility.HIDDEN),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.HIDDEN)}showConstructionPlane(e){this.planeComponent.hideShowFeature(e,o.Visibility.VISIBLE),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.VISIBLE)}hideFeatureBodies(e,t){this.bodyComponent.hideShowFeature(e,o.Visibility.HIDDEN,t),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.HIDDEN)}showFeatureBodies(e,t){this.bodyComponent.hideShowFeature(e,o.Visibility.VISIBLE,t),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.VISIBLE)}hideMateConnector(e,t){this.mateConnectorComponent.hideShowFeature(e,o.Visibility.HIDDEN,null,t),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.HIDDEN)}showMateConnector(e,t){this.mateConnectorComponent.hideShowFeature(e,o.Visibility.VISIBLE,null,t),this.trigger("FEATURE_VISIBILITY_CHANGE."+e,o.Visibility.VISIBLE)}getEntitiesForFeature(e,t){let i=[];for(let s=0;s<this.components.length;++s){const n=this.components[s].getEntitiesForFeature(e,t);n&&(i=i.concat(n))}return i}getFilteredEntityIds(e){let t=[];for(let i=0;i<this.components.length;++i){const s=this.components[i].getEntitiesForFilterFunction(e);s&&(t=t.concat(s))}return t}getEntitiesForSketchGroup(e,t,i){return this.sketchComponent.getEntitiesForFeature(t,(function(t){let s=0===t.getSketchGroupId().indexOf(e);return t.isSketchTextEntity()&&(s=s&&["left","right","ascent","baseline"].some((function(e){return t.getSketchEntityId().indexOf(e)>0}))),i&&(s=s&&i(t)),s}))||[]}getEntitiesForBody(e,t){let i=[];for(let s=0;s<this.components.length;++s){const n=this.components[s].getEntitiesForBody(e,t);n&&(i=i.concat(n))}return i}retrieveSketchEntityDeterministicId(e,t){return this.sketchComponent.retrieveSketchEntityDeterministicId(e,t)}onDeletion(e){this.reset(e)}hasFeature(e){for(let t=0;t<this.components.length;++t)if(this.components[t].hasFeature(e))return!0;return!1}getFeatureVisibility(e){for(let t=0;t<this.components.length;++t)if(this.components[t].hasFeature(e))return this.components[t].getFeatureVisibility(e);return o.Visibility.HIDDEN}hasBody(e){for(let t=0;t<this.components.length;++t)if(this.components[t].hasBody(e))return!0;return!1}getBodyVisibility(e){return this.bodyComponent.isBodyVisible(o.PART_STUDIO_ELEMENT_ID,e)?o.Visibility.VISIBLE:o.Visibility.HIDDEN}getUIElementsForSelection(e){let t=[];return(e.isMateConnector()||e.isFeature())&&(t=this.mateConnectorComponent.getUIElementsForSelection(e)),(e.isEntity()||e.isFromConstructionGeometry()||e.isDerivedFeature())&&(t=t.concat(this.planeComponent.getUIElementsForSelection(e))),t}getInContextImportEntityIdsForSelection(e){let t=[];const i=e.getInContextImports();if(i&&i.length>0)for(let e=0;e<i.length;++e){const s=this.getEntitiesForFeature(i[e],h);t=t.concat(s)}return t||[]}getEntityIdsForSelection(e){let t=[];if(e.isMateConnector())t=this.mateConnectorComponent.getEntityIdsForSelection(e);else if(e.isProperty()){if(e.childSelections)for(let i=0;i<e.childSelections.length;++i)t=t.concat(this.getEntityIdsForSelection(e.childSelections[i]))}else if(e.isEntity())t.push(e.getIdString());else if(e.isFeature())t=this.getEntitiesForFeature(e.getIdString(),h);else if(e.isSketchGroup()){const i=e.getSketchGroupFeatureId();i?t=this.getEntitiesForSketchGroup(e.getIdString(),i,h):n.log.info("Sketch group selection did not have a valid sketch id")}else if(e.isBody()){const i=this.getEntityIdsForBodySelection(e.getIdString(),e.getOccurrence(),e.getBodyMetaData());i&&i.length&&(t=t.concat(i))}else if(e.isTableItem()){const i=e.getOccurrence();for(let s=0;s<e.deterministicIdList.length;++s){const n=e.deterministicIdList[s],r=this.getEntityIdsForBodySelection(n,i,this.retrieveBodyMetaData(n));r&&r.length?t=t.concat(r):t.push(n)}}return t||[]}getEntityIdsForBodySelection(e,t,i){let s=[];s=i&&i.isComposite?i.constituentBodyIds:[e];let n=[];for(let e=0;e<s.length;++e){const i=s[e],r=this.retrieveBodyMetaData(i);if(r&&this.bodyComponent.hasBodyOccurrence(r.meshGroupId,t))if(this.bodyComponent.isBodyLoaded(i)){const e=this.getEntitiesForBody(i,d);e&&e.length&&(n=n.concat(e))}else n.push(i);else{const e=this.retrieveBodyMetaData(i),t=(null==e?void 0:e.isPointBody())?null:h,s=this.sketchComponent.getEntitiesForBody(i,t);s&&(n=s)}}return n}getOccurrenceEntityIdsForHighlight(e){if(e){const t=this.viewer.getIdForOccurrence(e);return this.sketchComponent.getEntitiesForOccurrenceSelection(t)||[]}return[]}getOccurrencesForSelection(e){let t=[];if(e.isMateConnector())t=this.mateConnectorComponent.getOccurrencesForSelection(e);else if(e.isBody()){const i=this.bodyComponent.retrieveBodyMetaData(e.getBodyId());if(i&&!i.hasTessellationSettings()){const i=this.bodyComponent.getPartStudioBodyOccurrenceName(e.getBodyId());t.push(r.BTOccurrence.getOccurrenceFromPathString(i))}}return t}getOccurrenceBounds(e){const t=new o.BoundingBox;for(let i=0;i<this.components.length;i++){const s=this.components[i];t.addBox(s.getOccurrenceBounds(e))}return t}setPlaneName(e,t){this.planeComponent.setPlaneName(e,t)}getMateConnectorGraphics(e,t){return this.mateConnectorComponent.getMateConnectorGraphics(e,t)}getMateConnectorData(e,t){return this.mateConnectorComponent.getMateConnectorData(e,t)}getAllMateConnectorGraphics(e){const t=this;let i=[];return this.mateConnectorComponent.featureToIds.each((function(s,n){if(t.hasMateConnectorDefinition(e,n)){const s=t.getMateConnectorGraphics(e,n);s&&(i=i.concat(s))}return!1})),i}hasMateConnectorDefinition(e,t){return!!this.getMateConnectorGraphics(e,t)}getStatistics(e,t=!1){const i=this.bodyComponent.getStatistics(e,t),s=this.errorComponent.getEntityCount();return s>0&&(i.errorMessage=this.getFullElementId()+" has "+s+" entities with failed tessellation."),i}getBoundsForEntities(e){if(!e||0===e.length)return null;const t=new o.BoundingBox;for(let i=0;i<e.length;++i){const s=this.extractMeshIncrement(e[i]);s&&t.addBox(s.getBounds())}return t}getFeatureBounds(e){const t=this.getBoundsForEntities(this.getEntitiesForFeature(e,(function(e){return!e.isFromSketch()||e.isUserSketchEntity()})));return t&&t.addBox(this.dimensionComponent.getDimensionBoundsForFeature(e)),t}getEntityBounds(e,t){const i=this.retrieveEntityMetaData(e);if(!i)return null;if(i.isFromBody()&&!this.bodyComponent.isBodyActiveInView(this.bodyComponent.getEntityBodyGroupId(i),t))return null;return this.extractMeshIncrement(e).getBounds()}getBodyBounds(e,t){if(this.bodyComponent.isBodyActiveInView(e,t)){const t=this.retrieveBodyMetaData(e);if(t)return t.getBounds()}return null}getBodyComponent(e){return this.bodyComponent}getDimensionComponent(){return this.dimensionComponent}getPartStudioBodyOccurrenceIds(){return this.bodyComponent.getPartStudioBodyOccurrenceIds()}getPartStudioOccurrenceIds(){const e=this.bodyComponent.getPartStudioBodyOccurrenceIds(),t=[this.sketchComponent.sketchComponentElementId],i=this.planeComponent.getPartStudioPlaneOccurrenceIds();return e.concat(t,i)}getContextCameraData(e){return this.displayedContextTransform[e]?this.viewer.getCameraData(this.displayedContextTransform[e].getGlMatrix()):{camera:null,cameraExtents:null}}getInstantiatedTriangleCount(){return this.bodyComponent.getInstantiatedTriangleCount()}getSketchComponent(){return this.sketchComponent}getImageComponent(){return this.imageComponent}getMateConnectorComponent(){return this.mateConnectorComponent}getPlaneComponent(){return this.planeComponent}getIsInternal(){return!this.isExternal&&!this.isForIncontextDisplay}getEstimatedMemoryUsageOfBodies(){return this.bodyComponent.getEstimatedMemoryUsage()}unloadBody(e){this.bodyComponent.unloadBody(e)}getPartStudioOccurrenceIdForSelection(e){return e.getOccurrence()?o.INVALID_OCCURRENCE_ID:e.isFromBody()?this.bodyComponent.getCorrectedBodyOccurrenceId(e.getBodyId(),o.PART_STUDIO_ELEMENT_ID):e.isFromSketch()?this.sketchComponent.sketchComponentElementId:e.isConstructionPlane()?this.planeComponent.getSelectionOccurrenceId(e):o.PART_STUDIO_ELEMENT_ID}getBodyTransform(e,t){const i=this.bodyComponent;let s=i.partStudioBodyIdToOccurrenceId[e];if(!s){const n=t.getModelViewManagers().getManager().alternateEntityMapping.get(e);n&&(s=i.partStudioBodyIdToOccurrenceId[n])}return s?t.getOccurrenceDataManager().getOccurrenceTransform(s):l.mat4.create()}getMeshOwnerId(){return this.meshOwnerId}updateEntityHighlight(e,t,i,s){for(let n=0;n<this.components.length&&!this.components[n].updateEntityHighlight(e,t,i,s);++n);}getElementType(){return r.GBTElementType.PARTSTUDIO}collectComponentsForHeapDump(e){this.bodyComponent.collectComponentsForHeapDump(e)}updatePSOI(e){this.bodyComponent.updatePSOI(e)}getDecalIdsAffectingEntity(e){return this.bodyComponent.getDecalComponent().getDecalIdsAffectingEntity(e)}onAppearanceConstantsUpdated(){for(const e of this.components)e.onAppearanceConstantsUpdated()}}t.PartStudio=u},467919:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.AssemblyEnabledPartStudioComponent=t.PartStudioComponent=void 0;const s=i(114924),n=i(315689),r=i(723617),a=i(606544),o=i(961049);class c{constructor(e,t,i){this.parent=e,this.viewer=t,this.idToMetaData={},this.childFeatureIds=new Set,this.removedBaseIncrements=null,this.featureVisibility={},(0,s.viewerCheck)(t),this.usage=void 0===i?s.BTGraphicsUsage.BASE:i,this.featureToIds=new n.TemplatedNestedMap,this.bodyToEntity=new n.TemplatedNestedMap}copyToClone(e){e.featureToIds=this.featureToIds.cloneNested(),e.bodyToEntity=this.bodyToEntity.cloneNested();for(const t in this.idToMetaData){const i=this.idToMetaData[t],s=(0,r.shallowClone)(i);e.idToMetaData[t]=s,s.setBodyId(i.getBodyId());const n=e.retrieveBodyMetaData(s.getBodyId());n&&s.setBodyMetaData(n);const a=i.getMeshIncrement();a&&(s.setMeshIncrement(a.clone(e.getMeshOwnerId())),e.isInstantiated()&&e.updateEntityGraphics(t,s.getMeshIncrement(),s))}}copyToPreview(e){for(const t in this.idToMetaData)e.idToMetaData[t]=this.idToMetaData[t];e.featureToIds=this.featureToIds.cloneNested(),e.bodyToEntity=this.bodyToEntity.cloneNested();for(const t in this.featureVisibility)e.featureVisibility[t]=this.featureVisibility[t]}reset(e){if(this.removedBaseIncrements=null,this.featureToIds.clear(),this.bodyToEntity.clear(),!e)for(const e in this.idToMetaData)this.removeMeshIncrement(e);this.idToMetaData={}}isInstantiated(){return!0}isForBase(){return this.usage===s.BTGraphicsUsage.BASE}getEntityIdManager(){return this.parent.getEntityIdManager()}getMeshManager(){return this.parent.getMeshManager()}getSharedBaseMeshManager(){return this.parent.getSharedBaseMeshManager()}getMeshOwnerId(){return this.parent.getMeshOwnerId()}getBodyManager(){return this.viewer.getBodyManager()}processDeletions(e){for(const t in e.deterministicIdToEntity){const i=e.deterministicIdToEntity[t];i&&(!i.isDeletion()&&this.handlesEntity(i)||this.removeEntity(t))}}processAdditionsAndChanges(e,t,i){for(const t in e.deterministicPartIdToData){const i=e.deterministicPartIdToData[t],n=this.parent.isBodyContainedInInsertableDisplayBuffers(t);for(let r=0;r<i.entityDIds.length;++r){const a=i.entityDIds[r],o=e.deterministicIdToEntity[a];if(!o||o.isDeletion()||!this.handlesEntity(o,i))continue;let c=null;(n||(c=(0,s.getMeshIncrementForEntityData)(o,a,this.getEntityIdManager().getOrCreateIdForName(a)),c||!this.expectsTessellation()))&&(this.removeOldEntityGraphics(a,o),this.addIdMappings(a,o,t,e),n||(o.setMeshIncrement(c),this.isInstantiated()&&this.updateEntityGraphics(a,c,o)),this.viewer.getIsForFlattenedDisplay()===i.isForFlattenedView()&&o.removeGeometry())}}}addOrUpdateBodyOccurrenceBufferSetToNode(e,t,i,n,r,a){const o=t.getBufferSetForGroup(i,this.getMeshOwnerId(),a.primitiveType,s.Lod.DEFAULT);o&&e.addOccurrenceBufferSetToNode(a,n,r,o)}processPrecompiledGraphicsBuffers(e){if(this.viewer.areOptimizedBuffersEnabled)for(const[t,i]of Object.entries(e)){const e=Object.values(i);if(0===e.length)continue;const n=e[e.length-1];if(!(null==n?void 0:n.graphicsBuffers))continue;const r=this.retrieveBodyMetaData(t);if(r&&r.isForFlattenedView()!==this.viewer.getIsForFlattenedDisplay())continue;const c=n.graphicsBuffers,l=c[a.GBTGraphicsPrimitiveType.POINTS],h=c[a.GBTGraphicsPrimitiveType.LINES],d=c[a.GBTGraphicsPrimitiveType.TRIANGLE_STRIP];if(l){const e=l[a.GBTGraphicsBufferTarget.ARRAY_BUFFER];if(e){e.setPrimitiveType(s.PrimitiveType.POINTS);e.mapGraphicsAttributeToComponentCount[a.GBTGraphicsAttribute.POINT],e.bufferData}}if(h){const e=h[a.GBTGraphicsBufferTarget.ARRAY_BUFFER];if(e){const i=e.mapGraphicsAttributeToComponentCount[a.GBTGraphicsAttribute.POINT],r=e.bufferData,c=new Float32Array(r.buffer,0,i*s.Attributes.POINT.dimension),l=h[a.GBTGraphicsBufferTarget.ELEMENT_ARRAY_BUFFER];if(l){l.setPrimitiveType(s.PrimitiveType.LINES);const e=l.bufferData,r=l.mapGraphicsAttributeToComponentCount[a.GBTGraphicsAttribute.INDEX],h=new((0,s.getIndexBufferType)())(e.buffer,0,r),d=new o.SimpleBufferSet(null,i,r,c,h);d.setMeshGroupId(t),this.getMeshManager().addBufferSet(d,l,t,this.getMeshOwnerId(),n.getTessellationSetting())}}}if(d){const e=d[a.GBTGraphicsBufferTarget.ARRAY_BUFFER];if(e){const i=e.mapGraphicsAttributeToComponentCount[a.GBTGraphicsAttribute.POINT],r=e.bufferData,c=e.mapGraphicsAttributeToComponentCount[a.GBTGraphicsAttribute.NORMAL];let l=s.Attributes.POINT.dimension,h=!1;c&&c>0&&(h=!0,l+=s.Attributes.NORMAL.dimension);const u=new Float32Array(r.buffer,0,i*l),g=d[a.GBTGraphicsBufferTarget.ELEMENT_ARRAY_BUFFER];if(g){g.setPrimitiveType(s.PrimitiveType.TRIANGLE_STRIP);const e=g.bufferData,r=g.mapGraphicsAttributeToComponentCount[a.GBTGraphicsAttribute.INDEX],c=new((0,s.getIndexBufferType)())(e.buffer,0,r),l=new o.SimpleBufferSet(null,i,r,u,c,h);l.setMeshGroupId(t),this.getMeshManager().addBufferSet(l,g,t,this.getMeshOwnerId(),n.getTessellationSetting())}}}}}hasBody(e){return this.bodyToEntity.has(e)}retrieveBodyMetaData(e){const t=this.bodyToEntity.get(e);let i=null;return t&&t.each((function(e,t){const s=this.idToMetaData[t];return s&&(i=s.getBodyMetaData()),!!i}),this),i}retrieveAssociatedFeatureIds(e){return this.deterministicIdToAssociatedFeatureIds&&this.deterministicIdToAssociatedFeatureIds[e]||null}getEntitiesForBody(e,t){const i=this.bodyToEntity.get(e);return i?(0,s.filterEntitiesWithData)(i,this.idToMetaData,t):null}onAppearanceConstantsUpdated(){}getHideableFeatureIds(){throw"This method should be overridden by a subclass"}updateEntityGraphics(e,t,i){throw"This method should be overridden by a subclass"}handlesEntity(e,t){throw"This method should be overridden by a subclass"}expectsTessellation(){return!0}getEntityCount(){return Object.keys(this.idToMetaData).length}containsEntity(e){return this.idToMetaData.hasOwnProperty(e)}getEntityMetaData(e){const t=this.idToMetaData[e];return t||null}removeEntity(e){this.removeBaseIncrement(e);this.idToMetaData[e]&&(this.removeMeshIncrement(e),this.removeIdMappings(e),this.getEntityIdManager().removeName(e))}extractMeshIncrement(e){const t=this.idToMetaData[e];return t?t.getMeshIncrement():null}addMeshIncrement(e,t){return e.pickId=this.getEntityIdManager().getOrCreateIdForName(e.id),this.getMeshManager().addMeshIncrement(e,this.getMeshOwnerId(),t)}getOccurrenceData(e){return this.viewer.getOccurrenceDataManager().getOccurrenceData(e)}getMeshIncrementDetails(e){return this.getMeshManager().getIncrementDetails(e,this.getMeshOwnerId())}getBaseMeshIncrementDetails(e){const t=this.getSharedBaseMeshManager();return t?t.getIncrementDetails(e,this.getMeshOwnerId()):null}hideMeshIncrement(e,t){const i=this.getOccurrenceData(t),s=this.getMeshIncrementDetails(e);i&&s&&i.hideIncrement(s,this.usage),this.hideBaseIncrement(e,t)}showMeshIncrement(e,t){const i=this.getOccurrenceData(t),s=this.getMeshIncrementDetails(e);i&&s&&i.showIncrement(s,this.usage),this.showBaseIncrement(e,t)}removeMeshIncrement(e){return this.getMeshManager().removeMeshIncrement(e,this.getMeshOwnerId())}setMeshIncrementRemovedFromBase(e,t){this.removedBaseIncrements||(this.removedBaseIncrements=new n.TemplatedNestedMap),this.removedBaseIncrements.insertNested(t,e,!0)}wasIncrementRemovedFromBase(e,t){return!!this.removedBaseIncrements&&this.removedBaseIncrements.hasNested(t,e)}removeBaseIncrement(e){this.removeBaseIncrementFromOccurrence(e,s.PART_STUDIO_ELEMENT_ID)}removeBaseIncrementFromOccurrence(e,t){this.hideBaseIncrement(e,t)&&this.setMeshIncrementRemovedFromBase(e,t)}hideBaseIncrement(e,t){const i=this.getSharedBaseMeshManager();if(i){const s=this.getOccurrenceData(t);if(s){const t=i.getIncrementDetails(e,this.getMeshOwnerId());if(t)return s.hideIncrement(t,this.usage),!0}}return!1}showBaseIncrement(e,t){const i=this.getSharedBaseMeshManager();if(i&&!this.wasIncrementRemovedFromBase(e,t)){const s=this.getOccurrenceData(t),n=i.getIncrementDetails(e,this.getMeshOwnerId());s&&n&&s.showIncrement(n,this.usage)}}removeOldEntityGraphics(e,t){this.removeEntity(e)}addManagedIdMappings(e,t){const i=this.bodyToEntity.get(t);if(i)for(const t of i.getKeys()){const i=this.idToMetaData[t];if(!i.isDeletion()&&this.handlesEntity(i)){for(let t=i.featureIds.length-1;t>=0;t--)if(i.featureIds[t]===e)return;i.featureIds.push(e),this.featureToIds.insertNested(e,t,!0),this.childFeatureIds.add(e)}}}addIdMappings(e,t,i,s){this.getEntityIdManager().getOrCreateIdForName(e),this.idToMetaData[e]=t;const n=t.getFeatureIds();for(let t=0;n&&t<n.length;++t)this.featureToIds.insertNested(n[t],e,!0);t.setBodyId(i),i&&this.bodyToEntity.insertNested(i,e,!0)}removeIdMappings(e){const t=this.idToMetaData[e];if(delete this.idToMetaData[e],!t)return;const i=t.getFeatureIds();for(let t=0;t<i.length;++t)this.featureToIds.removeNested(i[t],e),this.childFeatureIds.delete(i[t]);this.bodyToEntity.removeNested(t.getBodyId(),e)}hasFeature(e){return this.featureToIds.has(e)}getEntitiesForFeature(e,t){if(this.featureIdToAssociatedDeterministicIds&&this.featureIdToAssociatedDeterministicIds.hasOwnProperty(e)){const i=new Set;for(const s of this.featureIdToAssociatedDeterministicIds[e])this.bodyToEntity.has(s)?this.bodyToEntity.get(s).each(((e,s)=>{let n=!0;if(t){const e=this.idToMetaData[s];e&&t(e)||(n=!1)}n&&i.add(s)})):i.add(s);return[...i]}{const i=this.featureToIds.get(e);return i?(0,s.filterEntitiesWithData)(i,this.idToMetaData,t):null}}getEntitiesForFilterFunction(e){const t=[];for(const i in this.idToMetaData)e(this.idToMetaData[i])&&t.push(i);return t}isEntityHidden(e,t){const i=e.getFeatureIds();for(let e=0;e<i.length;++e)if(this.featureVisibility[i[e]]===s.Visibility.HIDDEN)return!0;return!1}getVisibleFeatureIds(){const e=[];for(const t in this.featureVisibility)this.featureVisibility[t]!==s.Visibility.HIDDEN&&this.featureToIds.has(t)&&e.push(t);return e}hideShowFeatureEntities(e,t,i){const n=this.getEntitiesForFeature(e);if(n){for(let e=0;e<n.length;++e){const i=this.getOccurrenceIdForEntity(n[e]);this.hideShowEntity(n[e],t,i)}(0,s.requestDraw)()}}hideShowFeature(e,t,i,s){this.featureVisibility[e]=t,this.hideShowFeatureEntities(e,t,s)}getFeatureVisibility(e){return this.featureVisibility.hasOwnProperty(e)?this.featureVisibility[e]:s.Visibility.VISIBLE}hideShowEntity(e,t,i){(i=i||s.PART_STUDIO_ELEMENT_ID)!==s.INVALID_OCCURRENCE_ID&&(t===s.Visibility.HIDDEN?this.hideMeshIncrement(e,i):this.showMeshIncrement(e,i))}instantiateForPartStudio(e){}instantiateEntities(){for(const e in this.idToMetaData){const t=this.idToMetaData[e],i=t.getMeshIncrement();!i&&this.expectsTessellation()||this.updateEntityGraphics(e,i,t)}}removePartStudioInstantiation(e){}getNode(){return null}getOccurrenceIdForEntity(e){return null}getOccurrenceBounds(e){const t=new s.BoundingBox,i=this.getNode();return i&&i.getOccurrenceBounds(e,t),t}updateEntityHighlight(e,t,i,s){if(!this.idToMetaData.hasOwnProperty(i))return!1;const n=this.getOccurrenceData(s),r=this.getMeshIncrementDetails(i)||this.getBaseMeshIncrementDetails(i);return!(!n||!r)&&(n.updateEntityHighlight(e,t,r,this.usage),!0)}}t.PartStudioComponent=c;class l extends c{constructor(e,t,i){super(e,t,i),this.occurrences={}}addOrUpdateOccurrence(e,t){this.occurrences[e]=t}removeOccurrence(e,t){delete this.occurrences[e]}isOccurrenceIdForAssembly(e){return!!this.occurrences[e]}getComponentId(){return l.ComponentId}}t.AssemblyEnabledPartStudioComponent=l,l.ComponentId="ASSEMBLY_ENABLED_PARTSTUDIO_COMPONENT"},708256:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneComponent=t.PlaneComponentId=void 0;const s=i(736234),n=i(114924),r=i(545348),a=i(315689),o=i(606544),c=i(264292),l=i(613199);r.default.getManager();t.PlaneComponentId="plane_component.";class h{constructor(e,t,i,s){this.entityId=e,this.label="",this.center=null,this.xAxis=null,this.yAxis=null,this.update(t,i,s)}update(e,t,i){this.center=e,this.xAxis=t,this.yAxis=i}}class d extends n.PartStudioComponent{constructor(e,t,i){super(e,i),this.constructionPlanes={},this.planeNames={},this.planeUi=new a.TemplatedNestedMap,this.usage=void 0!==t?t:n.BTGraphicsUsage.BASE}clone(e){const t=new d(e,this.usage,this.viewer);return this.copyToClone(t),t}cloneForPreview(e){const t=new d(e,n.BTGraphicsUsage.PREVIEW,this.viewer);this.copyToPreview(t);for(const e in this.constructionPlanes)t.constructionPlanes[e]=(0,s.clone)(this.constructionPlanes[e]);return this.planeUi.eachNested((function(e,i,s){return t.planeUi.insertNested(i,s,e.cloneForPreview(i)),!1}),this),t}extractMeshIncrement(e){const t=super.extractMeshIncrement(e);if(t)return t;const i=this.planeUi.get(e);let s=null;return i&&i.each((function(e){return s=e.getIncrement(),!0}),this),s}getVisiblePlaneBounds(){const e=new n.BoundingBox;return this.planeUi.eachNested((function(t){return t.isHidden||e.addBox(t.getBounds()),!1}),this),e}reset(){this.planeUi.eachNested((function(e){return e.remove(),!1}),this),this.constructionPlanes={},this.planeUi.clear(),super.reset()}getComponentId(){return t.PlaneComponentId}handlesEntity(e,t){return!e.hasTessellationError()&&e.isFromConstructionPlane()&&e.isFace()&&!this.viewer.getIsForFlattenedDisplay()}processAdditionsAndChanges(e,t){super.processAdditionsAndChanges(e,t),t&&this.instantiateDefaultPlanes(n.PART_STUDIO_OCCURRENCE_ID,null)}updateEntityGraphics(e,t,i){t.pickId=this.getEntityIdManager().getOrCreateIdForName(e),this.updatePlaneDefinition(t,i)}getHideableFeatureIds(){return this.featureToIds.getKeys()}removeOldEntityGraphics(e,t){const i=this.idToMetaData[e];i&&i.getFirstFeatureId()!==t.getFirstFeatureId()&&this.removeEntity(e)}removeEntity(e){this.idToMetaData[e]&&(this.removePlaneUiForEntity(e),delete this.constructionPlanes[e]),super.removeEntity(e)}removePlaneUiForEntity(e){const t=this.planeUi.get(e);t&&(t.each((function(e){return e.remove(),!1})),this.planeUi.remove(e))}getUIElementsForSelection(e){const t=[],i=e.getOccurrence()?e.getOccurrence().toString():n.PART_STUDIO_OCCURRENCE_ID;let s;return e.isEntity()?(s=this.planeUi.getNested(e.getDeterministicId(),i),s&&t.push(s)):e.isFeature()&&this.iterateOverEntitiesForFeature(e.getFeatureId(),(function(e){s=this.planeUi.getNested(e,i),s&&t.push(s)})),t}updatePlaneDefinition(e,t){if(!t.isFace())return;const i=e.getBounds().center(),s=c.vec3.fromValues(e.points[0],e.points[1],e.points[2]),n=c.vec3.fromValues(e.points[3],e.points[4],e.points[5]),r=c.vec3.fromValues(e.points[6],e.points[7],e.points[8]),a=l.vec3C.add(s,r,c.vec3.create());l.vec3C.scale(a,.5),l.vec3C.subtract(a,i);const o=l.vec3C.add(s,n,c.vec3.create());l.vec3C.scale(o,.5),l.vec3C.subtract(o,i);const d=this.constructionPlanes[e.id];d?d.update(i,a,o):this.constructionPlanes[e.id]=new h(e.id,i,a,o)}iterateOverEntitiesForFeature(e,t){const i=this.getEntitiesForFeature(e);if(i)for(let e=0;e<i.length;++e)t.call(this,i[e])}getFeatureIdForEntity(e){const t=this.idToMetaData[e];return t?t.getFirstFeatureId():""}hideShowFeature(e,t,i){super.hideShowFeature(e,t,i),this.iterateOverEntitiesForFeature(e,(e=>{const i=this.planeUi.get(e);i&&i.each((function(e){t===n.Visibility.HIDDEN?e.hide():e.show()}))}))}updateFeatureAppearance(e,t){this.iterateOverEntitiesForFeature(e,(function(e){const i=this.planeUi.get(e);i&&i.each((function(e){e.updateAppearance(t)}))}))}instantiateForPartStudio(e){super.instantiateForPartStudio(e),this.instantiateDefaultPlanes(n.PART_STUDIO_OCCURRENCE_ID,null)}removePartStudioInstantiation(e){super.removePartStudioInstantiation(e),this.removeDefaultPlanesInstantiation(n.PART_STUDIO_OCCURRENCE_ID)}instantiateDefaultPlanes(e,t){const i=[];this.planeUi.each((function(e,t){return this.constructionPlanes.hasOwnProperty(t)||i.push(t),!1}),this);for(let e=0;e<i.length;++e)this.removePlaneUiForEntity(i[e]);const s=(0,n.isUsageCompare)()?"CONSTRUCTION_PLANE_COMPARE_TEXT_COLOR":"CONSTRUCTION_PLANE_TEXT_COLOR";for(const i in this.constructionPlanes){let r=this.planeUi.getNested(i,e);const a=this.constructionPlanes[i];r||(r=void 0!==this.usage&&this.usage===n.BTGraphicsUsage.PREVIEW?new n.ConstructionPlaneDisplay(s,a.entityId,n.PREVIEW_SCENEGRAPH_ID,this.getFeatureIdForEntity(i),this.viewer):new n.ConstructionPlaneDisplay(s,a.entityId,n.MAIN_SCENEGRAPH_ID,this.getFeatureIdForEntity(i),this.viewer),this.planeUi.insertNested(i,e,r)),r.setTransform(t),r.updateDefinition(a.label,a.center,a.xAxis,a.yAxis,!1);const c=this.idToMetaData[i];if(c instanceof o.BTFeatureEntity){const e=c.getLastFeatureId();this.featureVisibility[e]===n.Visibility.HIDDEN?r.hide():r.show()}}}getPartStudioPlaneOccurrenceIds(){const e=[];return this.planeUi.eachNested((function(t){return e.push(t.graphicsOccurrenceId),!1}),this),e}getSelectionOccurrenceId(e){const t=n.INVALID_OCCURRENCE_ID;return this.planeUi.eachNested((function(t,i,s){return e.getDeterministicId()===i&&t.graphicsOccurrenceId,!1}),this),t}removeDefaultPlanesInstantiation(e){const t=[];this.planeUi.eachNested((function(i,s,n){return e===n&&(t.push(s),i.remove()),!1}),this);for(let i=0;i<t.length;++i)this.planeUi.removeNested(t[i],e)}setPlaneName(e,t){this.planeNames[e]=t,this.iterateOverEntitiesForFeature(e,(e=>{const i=this.constructionPlanes[e];i&&(i.label=t);const s=this.planeUi.get(e);s&&s.each((function(e){e.setName(t)}))}))}}t.PlaneComponent=d},445632:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PointBodyComponent=void 0;const s=i(114924),n=i(545348).default.getManager(),r=new s.NodeProperties({zOffset:n.getNumber("ORIGIN_Z_OFFSET"),primitiveType:s.PrimitiveType.POINTS,isPickable:!1}),a=new s.NodeProperties({primitiveType:s.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,priority:s.RenderOrderPriority.LOWER}),o=new s.BitShiftId;class c extends s.PartStudioComponent{constructor(e,t,i){super(e,t,i),this.hasBeenInstantiated=!1,this.styledRanges={},this.node=new s.Node(this.getComponentId(),new s.NodeProperties,i),this.instantiateRanges()}reset(){super.reset(),this.node.removeOccurrence(s.PART_STUDIO_ELEMENT_ID),Object.values(this.styledRanges).forEach((function(e){e.getMeshRanges().destroy()}),this),this.styledRanges={},this.instantiateRanges()}getStyleId(e,t){return o.reset(),o.addBoolean(e),o.addBoolean(t),o.getId()}instantiateRanges(){for(let e=0;e<=1;++e)for(let t=0;t<=1;++t){const i=this.getStyleId(!!e,!!t),o=new s.IncrementRanges("PointBodyComponent."+i);this.usage===s.BTGraphicsUsage.PREVIEW&&o.setListenForDeletions(!0);const c=t?"ORIGIN":"POINT_BODY",l=new s.Style;l.setAttribute(s.Attributes.PRIMITIVE_SIZE,n.getNumber(c+"_SIZE")),l.setAttribute(s.Attributes.PRIMITIVE_STYLE,n.getPointFont(c+"_FONT")),e?l.setAttribute(s.Attributes.COLOR,n.getColor(c+"_COLOR")):l.setAttribute(s.Attributes.COLOR,n.getColor(c+"_SHOWTHROUGH_COLOR"));const h=e?a:r,d=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(s.PART_STUDIO_ELEMENT_ID),u=this.node.addOccurrenceGeometryToNode(h,d,l,o);this.styledRanges[i]=u}}getComponentId(){return"point_body_component."}clone(e){const t=new c(e,this.viewer,this.usage);return this.copyToClone(t),t}cloneForPreview(e){const t=new c(e,this.viewer,s.BTGraphicsUsage.PREVIEW);return this.copyToPreview(t),t.instantiateBaseEntities(),t}instantiateBaseEntities(){const e=this.getSharedBaseMeshManager();for(const t in this.idToMetaData){const i=this.idToMetaData[t],s=e.getIncrementDetails(t,this.getMeshOwnerId());i&&s&&this.updateEntityGraphicsFromIncrementDetails(s,t,i)}this.hasBeenInstantiated=!0}isInstantiated(){return this.hasBeenInstantiated}instantiateForPartStudio(e){this.node.getParent()!==e&&e.addChild(this.node),this.hasBeenInstantiated||(this.instantiateEntities(),this.hasBeenInstantiated=!0)}removePartStudioInstantiation(e){e.removeChild(this.node,!0)}handlesEntity(e,t){return!e.hasTessellationError()&&e.isPointEntity()&&!this.viewer.getIsForFlattenedDisplay()}getRanges(e,t){const i=this.getStyleId(t,e.isFromOrigin()),s=this.styledRanges[i];return s?s.getMeshRanges():null}updateEntityGraphics(e,t,i){if(!t)return;const s=this.addMeshIncrement(t);this.updateEntityGraphicsFromIncrementDetails(s,e,i)}updateEntityGraphicsFromIncrementDetails(e,t,i){if(!e)return;const n=this.getRanges(i,!1);n&&n.onIncrementAdded(e);const r=this.getRanges(i,!0);r&&r.onIncrementAdded(e),this.isEntityHidden(i,s.PART_STUDIO_ELEMENT_ID)&&this.hideMeshIncrement(t,s.PART_STUDIO_ELEMENT_ID)}removeMeshIncrement(e){const t=this.getMeshManager().removeMeshIncrement(e,this.getMeshOwnerId());if(!t)return null;const i=this.idToMetaData[e];if(!i)return null;const s=this.getRanges(i,!1);s&&s.onIncrementRemoved(t);const n=this.getRanges(i,!0);return n&&n.onIncrementRemoved(t),t}getHideableFeatureIds(){return this.featureToIds.getKeys()}}t.PointBodyComponent=c},789133:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimulationManager=void 0;const s=i(545348),n=i(719347),r=i(997687),a=i(736234),o=i(912057),c=i(197134),l=i(845556),h=i(606544),d=i(873896),u=i(973008),g=i(683067),p=i(967623),m=i(114924),E=[0,.125,.25,.375,.5,.625,.75,.875,.92,1,1,1,1,1,.9,.5,.2,0,-.1,-.11,-.05,0,.02,.02,.01,0,-.01,0,0,0,0,0];class I extends m.ScalarVisualizationManager{constructor(e){super(e),this.modelViewManager=e,this.COLOR_MAP_STORAGE_KEY=p.SIMULATION_COLOR_MAP_STORAGE_KEY,this.LEGEND_CLOSED=g.SIMULATION_LEGEND_CLOSED,this.LEGEND_OPENED=g.SIMULATION_LEGEND_OPENED,this.VISUALIZATION_MANAGER_NODE_ID="SimulationManager",this.graphicsRenderMode=h.GBTGraphicsRenderMode.SIMULATION_RESULTS,this.meshOwnerId=(0,m.getNewOwnerId)(),this.tessellationCache=new Map,this.occurrenceToMaterial=new Map,this.isAnimating=!1,this.elementIdToResponseData=new Map,this.occurrencePaths=[],this.simulationMass=0,r.btInjector.SimulationService&&r.btInjector.SimulationService.getIsAnimatingObservable().subscribe((e=>{e?this.startAnimation():this.stopAnimation()})),this.connectionVisualizationManager=new m.ConnectionVisualizationManager(r.btInjector.AnalyticsService,e,this)}prepareResources(){super.prepareResources(),this.legend||(this.legend=new m.SimulationLegend(this))}clearOccurrencesVisualizationStatus(){const e=this.getViewer().getOccurrenceIdManager();for(const t of this.occurrencePaths){const i=h.BTOccurrence.getOccurrenceFromPathString(t),s=e.getIdForName(t);if(s===m.INVALID_OCCURRENCE_ID){o.log.warn("No occurrence id for "+t);continue}const n=this.modelViewManager.getPartStudioDataFromOccurrence(i);n?n.getBodyComponent().clearScalarVisualizationOccurrence(s):o.log.debug("No part studio for occurrence "+t)}this.occurrencePaths=[]}get displayedSimulatedField(){return this.visualizationState?this.visualizationState.field:null}hasDisplayableFieldSet(){return!!this.displayedSimulatedField&&this.displayedSimulatedField.type!==h.GBTSimulatedFieldType.UNKNOWN}readyToShowLegend(){return this.viewerIsInScalarVisualizationRenderMode()&&this.hasDisplayableFieldSet()&&this.visualizationState&&!this.visualizationState.connectionVisualizationActive}setVisualizationState(e){const t=new n.Timer("SimulationManager.setVisualizationState",{setTraceId:!0}),i=!this.visualizationState||!(0,a.isEqual)(this.visualizationState.connectionTypeToHidden,e.connectionTypeToHidden),s=!this.visualizationState||this.visualizationState.restInDeformedState!==e.restInDeformedState,r=!this.visualizationState||this.visualizationState.deformationScale!==e.deformationScale;super.setVisualizationState(e),this.connectionVisualizationManager.setVisible(this.visualizationState.connectionVisualizationActive),i&&this.connectionVisualizationManager.updateGraphics(),this.hasDisplayableFieldSet()&&!this.visualizationState.connectionVisualizationActive||this.hideLegend(),!s&&!r||this.isAnimating||this.resetSimulationOffsetFactor(),t.report()}setContactBehavior(e){this.connectionVisualizationManager.setContactBehavior(e)}getSimulationBounds(){var e;if(!this.rootNode)return null;let t=this.rootNode.getBoundingBox();if(this.isAnimating||(null===(e=this.visualizationState)||void 0===e?void 0:e.restInDeformedState)){t=t.clone();const e=this.inputDisplacementRange.max>d.Tolerances.ZERO_LENGTH?.001*this.inputDisplacementRange.max:0,i=1e3;t.dilate(Math.min(e,i))}return t}hasSimulationResultsForElement(e){return this.elementIdToResponseData.has(e)}updateSimulation(e){const t=new n.Timer("SimulationManager.updateSimulation",{setTraceId:!0});this.prepareResources();for(const t of e.simulationTessellations)this.tessellationCache.set(this.getTessellationCacheKey(t.sourceElement,t.deterministicId),t);for(const t in e.occurrenceToMaterial)this.occurrenceToMaterial.set(t,e.occurrenceToMaterial[t]);let i,s=!1;if(e.activeSimulationUpdates.length>0){if(i=e.activeSimulationUpdates[0].runStatus,i===h.GBTUiSimulationRunStatus.JUST_STARTED||i===h.GBTUiSimulationRunStatus.INVALID_ASSEMBLY)return this.clearGraphics(),i===h.GBTUiSimulationRunStatus.JUST_STARTED&&this.elementIdToResponseData.delete(e.sourceElementId),void(this.legend&&(this.legend.clearRanges(),this.showLegend()))}const r=e.responses[0];if(r)this.elementIdToResponseData.set(e.sourceElementId,r),s=!0;else{const e=this.modelViewManager.getDisplayedAssembly();e&&i===h.GBTUiSimulationRunStatus.TRANSMITTED&&this.elementIdToResponseData.has(e.elementId)&&(s=!0)}s&&(this.prepareField(this.displayedSimulatedField),this.updateGraphics()),t.report()}updateContactAnalysis(e){this.connectionVisualizationManager.updateContactAnalysis(e)}getVisualizationState(){return this.visualizationState}isIsolateEffectActive(){return this.connectionVisualizationManager.getVisible()&&this.connectionVisualizationManager.getUseIsolateEffect()}onRenderingModeChanged(){super.onRenderingModeChanged();this.viewerIsInScalarVisualizationRenderMode()&&this.getViewer().setUserEnabledAggressiveRefinement(!1)}resetMeshes(){this.meshManager&&this.meshManager.destroy(),this.meshManager=new m.MeshManager(this.getViewer(),{bufferAllocationPolicy:m.BufferAllocationPolicy.MAXIMUM})}onAssemblyDisplayed(){this.updateGraphics(),this.connectionVisualizationManager.updateGraphics()}onAssemblyChanged(){this.connectionVisualizationManager.onAssemblyChanged()}onSectionSetChanged(){this.connectionVisualizationManager.onSectionSetChanged()}onDocumentChange(){this.tessellationCache.clear(),this.elementIdToResponseData.clear()}updateGraphics(){this.clearGraphics();const e=this.modelViewManager.getDisplayedAssembly();if(!e||e.isHidden||this.visualizationState&&this.visualizationState.connectionVisualizationActive)return;this.showLegend();const t=this.elementIdToResponseData.get(e.elementId);if(!t)return void(this.legend&&this.legend.clearRanges());const i=this.getViewer().getOccurrenceIdManager(),n=this.getViewer().getOccurrenceDataManager(),r=t.firstResultDataSet;if(!r)return void o.log.debug("No data set to display");if(!this.visualizationState||r.isModal!==this.visualizationState.field.isModal||!this.hasDisplayableFieldSet())return;if(!this.viewerIsInScalarVisualizationRenderMode())return;if(!r.canBeUsedToDisplay(this.displayedSimulatedField))return;this.displayedScalarRangeSpecification=r.getRangeSpecification(this.displayedSimulatedField),this.inputDisplacementRange=r.getRangeSpecification(this.displayedSimulatedField.displacementFieldSpecification).rangeInData;const a=[];for(let e=0;e<I.imageMaps.length;++e){const t=new m.NodeProperties({material:this.scalarVisualizationMaterials[e],zOffset:s.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:m.PrimitiveType.TRIANGLES,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1});a.push(t)}let c=!1;this.simulationMass=0;for(const t in r.occurrenceIdToOccurrenceResult){const s=r.occurrenceIdToOccurrenceResult[t],l=h.BTOccurrence.getOccurrenceFromPathString(t),d=i.getIdForName(t);if(d===m.INVALID_OCCURRENCE_ID){o.log.warn("No occurrence id for "+t);continue}const u=n.getOccurrenceData(d);u||o.log.warn("No occurrence data for "+t);const g=e.getOccurrenceDisplayData(l);if(!g){o.log.warn("No occurrence display data for "+t);continue}const p=this.modelViewManager.getPartStudioDataFromOccurrence(l);if(!p){o.log.debug("No part studio for occurrence "+t);continue}const E=this.getMeshIncrementForOccurrence(s,g);if(!E){o.log.debug("No simulation tessellation for "+t),c=!0;break}this.updateMass(s),p.getBodyComponent().setScalarVisualizationOccurrence(d),E.id=t;const I=this.meshManager.addMeshIncrement(E,this.meshOwnerId),T=new m.IncrementRanges("Simulated "+t);T.onIncrementAdded(I);const S=p.retrieveBodyMetaData(g.partIds[0]),f=new m.Style;S&&f.setAttribute(m.Attributes.COLOR,S.getColor());for(let e=0;e<a.length;++e)this.nodes[e].addOccurrenceGeometryToNode(a[e],u,f,T);if(this.debugMeshEdges){const e=(0,m.createEdgesFromTriangles)(E,E.id+".edges"),i=this.meshManager.addMeshIncrement(e,this.meshOwnerId),s=new m.IncrementRanges("Simulated "+t+" edges");s.onIncrementAdded(i);for(let e=0;e<a.length;++e)this.nodes[e].addOccurrenceGeometryToNode(m.MESH_EDGE_NODE_PROPERTIES,u,f,s)}this.occurrencePaths.push(t)}if(c)return this.clearGraphics(),void(r.isModal&&this.getViewer().getEventDispatcher().trigger(g.SIMULATION_RESULTS_DISPLAYED,!1,r));this.cursorAppendage=new m.CursorAppendage(this.getViewer(),((e,t)=>this.getCursorText(e,t))),this.legend.setInputRange(this.displayedScalarRangeSpecification),this.visualizedScalarRange&&this.legend.setVisualizedScalarRange(this.visualizedScalarRange),this.updateColorMapping(null,this.displayedColorMap),this.updateMakeUnsignedUniform(),this.getViewer().getEventDispatcher().trigger(g.SIMULATION_RESULTS_DISPLAYED,!0,r),this.getViewer().requestDraw()}updateMass(e){const t=this.getTessellationForOccurrenceResult(e).massProperties;t&&t.hasMass&&(this.simulationMass+=t.mass[0])}clearGraphics(){this.getViewer().getEventDispatcher().trigger(g.SIMULATION_RESULTS_DISPLAYED,!1),this.resetMeshes(),this.clearOccurrencesVisualizationStatus(),super.clearGraphics()}clearSimulationAndConnectionGraphics(){this.clearGraphics(),this.connectionVisualizationManager.clearGraphics()}clearOccurrencesSimulatedStatus(e){const t=this.getViewer().getOccurrenceIdManager();for(const i of e){const e=h.BTOccurrence.getOccurrenceFromPathString(i),s=t.getIdForName(i);if(s===m.INVALID_OCCURRENCE_ID){o.log.warn("No occurrence id for "+i);continue}const n=this.modelViewManager.getPartStudioDataFromOccurrence(e);n?n.getBodyComponent().clearScalarVisualizationOccurrence(s):o.log.debug("No part studio for occurrence "+i)}}prepareField(e){const t=this.getDisplayedResults();t&&e&&e.type===h.GBTSimulatedFieldType.SAFETY_FACTOR&&t.prepareSafetyFactor(((e,t)=>{let i=this.occurrenceToMaterial.get(e);if(!i){const e=this.getTessellationForOccurrenceResult(t);e&&(i=e.material)}return i}))}startAnimation(){if(this.isAnimating)return;this.isAnimating=!0;const e=s.default.getManager().getNumber("SIMULATION_DISPLACEMENT_ANIMATION_CYCLE_PERIOD_SEC");let t=-1,i=0;this.getViewer().getAnimationController().startAnimation((s=>{if(!this.isAnimating)return g.AnimationCallbackStatus.COMPLETE;if(t>0){i+=(s-t)/1e3/e;const n=this.displayedSimulatedField.isModal?this.getModalOffsetFactor(i):this.getDisplacementOffsetFactor(i);this.setSimulationOffsetFactor(n)}return t=s,g.AnimationCallbackStatus.ONGOING}))}updateVisualizedScalarRange(){this.legend&&(this.legend.visualizedFieldType=this.visualizationState.field.type),super.updateVisualizedScalarRange()}stopAnimation(){this.isAnimating&&(this.isAnimating=!1,this.resetSimulationOffsetFactor(),this.getViewer().requestDraw())}resetSimulationOffsetFactor(){var e;(null===(e=this.visualizationState)||void 0===e?void 0:e.restInDeformedState)?this.setSimulationOffsetFactor(1):this.setSimulationOffsetFactor(0),this.getViewer().requestDraw()}setSimulationOffsetFactor(e){for(const t of this.scalarVisualizationMaterials)t.setCustomFloatUniform("uOffsetFactor",e*this.visualizationState.deformationScale*.001)}getRangeInBaseUnits(e){return e?this.displayedSimulatedField.hasUnits?this.displayedSimulatedField.isStress?(0,l.convertRangeToUnits)(e,h.BTSimulatedStressField.BASE_UNITS):(0,l.convertRangeToUnits)(e,h.BTSimulatedVectorField.BASE_UNITS):e:null}updateMakeUnsignedUniform(){let e=m.FALSE_INT_UNIFORM;if(this.visualizationState.field.type===h.GBTSimulatedFieldType.UNSIGNED_VON_MISES_STRESS){const t=this.getDisplayedResults();if(!t)return;const i=t.getAvailableFields();i.has(h.GBTSimulatedFieldType.SIGNED_VON_MISES_STRESS)&&!i.has(h.GBTSimulatedFieldType.UNSIGNED_VON_MISES_STRESS)&&(e=m.TRUE_INT_UNIFORM)}for(const t of this.scalarVisualizationMaterials)t.setCustomIntUniform("uMakeUnsigned",e)}getDisplayedResults(){const e=this.modelViewManager.getDisplayedAssembly();if(!e)return;const t=this.elementIdToResponseData.get(e.elementId);return t?t.firstResultDataSet:void 0}setDebugMeshEdges(e){this.debugMeshEdges=e}getTessellationForOccurrenceResult(e){return this.tessellationCache.get(this.getTessellationCacheKey(e.sourcePartReference,e.sourcePartReference.partId))}getMeshIncrementForOccurrence(e,t){const i=this.getTessellationForOccurrenceResult(e);if(!i)return null;let s=e.getFieldForDisplay(this.displayedSimulatedField);if(!s)return null;let n=e.getFieldForDisplay(this.displayedSimulatedField.displacementFieldSpecification);if(!n)return null;if(s instanceof h.BTSimulatedModalField){const e=1e3*this.visualizationState.field.directDeformationInMeters,t=s.getScaledCopy(e);s=t,n=t}const r=this.getSampleMesh(i,e),a=new m.MeshIncrement(m.PrimitiveType.TRIANGLES,r.points,r.getAnyIndices());a.packScalarsIntoTextureCoordinates(s.values);const c=this.modelViewManager.getPartStudio(e.sourcePartReference);if(c){const e=c.getBodyBounds(i.deterministicId,t.occurrenceData.occurrence);e&&(a.boundingBox=e)}return n instanceof h.BTSimulatedVectorField?a.offsetVectors=(0,m.packedNormalsToFloatArray)(n.packedOffsetDirections,n.values):o.log.warn("Unexpected displacement field type"),a}findScalarVisualizationScalar(e,t){const i=super.findScalarVisualizationScalar(e,t);if(this.displayedSimulatedField.hasUnits){const e=(0,c.getCurrentDocumentSettingsModel)().getUnitForSimulatedField(this.displayedSimulatedField.type);return(0,l.convertBetweenUnits)(i,this.getRangeInData().units,e)}return i}getTessellationCacheKey(e,t){return e.toString()+"."+t}getModalOffsetFactor(e){const t=e*Math.PI*2;return Math.sin(t)}getDisplacementOffsetFactor(e){return(0,m.interpolateInArray)(E,e)}getValueString(e){return u.ValueAndUnitsFormatter.getSimulationValueString(e)}getMass(){return this.simulationMass}}t.SimulationManager=I},885658:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.TemporarySketchComponent=t.SketchComponent=t.SketchComponentId=void 0;const s=i(545348),n=i(912057),r=i(606544),a=i(736234),o=i(315689),c=i(723617),l=i(114924),h=i(723617),d=i(264292),u=i(870232),g=s.default.getManager(),p=new l.BitShiftId;let m=0;Object.values(r.GBTMGeomStatus).forEach((function(e){(0,a.isNumber)(e)&&(m=Math.max(e,m))}));const E=Math.ceil(Math.log(m)/Math.log(2));t.SketchComponentId="sketch_component.";class I extends l.AssemblyEnabledPartStudioComponent{constructor(e,t,i){super(e,i,t),this.activeSketches={},this.hasBeenInstantiated=!1,this.entityColors=new Map,this.sketchToSMModelIdMapping={},this.idToPartData={},this.sketchToSketchEntityMapping=new o.TemplatedNestedMap,this.styledRanges=new o.TemplatedNestedMap,this.node=e?e.getModelViewManager().getSharedSketchNode():null,this.sketchComponentElementId=this.viewer.getOccurrenceIdManager().getOrCreateIdForName("PART_STUDIO_SKETCHES")}getNode(){return this.node}isEntityInActiveSketch(e){return this.activeSketches.hasOwnProperty(e.getSketchFeatureId())}isSketchInContext(e){return e!==this.sketchComponentElementId&&this.viewer.getModelViewManagers().getManager().displayingPartStudio()}updateMissingEntityGraphicsForSketch(e,t){const i=this.sketchToSketchEntityMapping.get(e);for(const e in i){if(t.deterministicIdToEntity[e])continue;const s=i[e],n=this.idToMetaData[s];if(!n)continue;const r=n.getMeshIncrement();r&&(this.removeMeshIncrement(r.id),this.updateEntityGraphics(s,r,n))}}processAdditionsAndChanges(e,t){const i={};for(const t in e.deterministicPartIdToData){const s=e.deterministicPartIdToData[t];for(let t=0;t<s.entityDIds.length;++t){const n=s.entityDIds[t],r=e.deterministicIdToEntity[n];r&&!r.isDeletion()&&this.handlesEntity(r,s)&&(r.isAssociatedWithFlat=s.isAssociatedWithFlat,r.isAssociatedWithFlat&&(i[r.getFirstFeatureId()]=s.ownerFlattenedBodyId),this.idToPartData[n]=s)}}for(const t of Object.keys(e.sketchFeatureIdAndTessellationSettingToBuffers))this.featureToIds.insertKeyOnly(t);this.processPrecompiledGraphicsBuffers(e.sketchFeatureIdAndTessellationSettingToBuffers);for(const t in this.sketchToSMModelIdMapping)i[t]||this.updateMissingEntityGraphicsForSketch(t,e);this.updateEntityAppearanceOverrides(e),super.processAdditionsAndChanges(e,t)}getEntityColor(e){const t=this.entityColors.get(e);return t?t.color:null}getEntityOverrideId(e){const t=this.entityColors.get(e);return t?t.overrideId:""}getOverrideColor(e){return[e.color[0]/255,e.color[1]/255,e.color[2]/255,e.opacity/255]}updateEntityAppearanceOverrides(e){const t=new Set;for(const i in e.appearanceIdToAppearanceOverride){const s=e.appearanceIdToAppearanceOverride[i],n=i===r.BTGraphicsAppearance.RESET_APPEARANCE_ID?null:this.getOverrideColor(s.appearance);for(let r=0;r<s.entityDeterministicIds.length;++r){const a=s.entityDeterministicIds[r],o=e.deterministicIdToEntity[a]||this.idToMetaData[a];if(!o||!this.handlesEntity(o))continue;const c=o.getLastFeatureId();if(!t.has(c)){t.add(c);for(const e in this.occurrences)this.clearSketchGraphics(c,+e)}if(n){const e={overrideId:i,color:n};this.entityColors.set(a,e)}else this.entityColors.delete(a)}}for(const e of t)for(const t in this.occurrences)this.instantiateSketchGraphics(e,+t)}getColorForSketch(e){const t=this.featureToIds.get(e);let i=null;return t&&t.each(((e,t)=>(i=this.getEntityColor(t),!!i))),i}processDeletions(e){for(const t in e.deterministicIdToEntity){const i=e.deterministicIdToEntity[t];i&&this.handlesEntity(i)&&this.removeEntity(t)}super.processDeletions(e);for(const t in e.deterministicIdToEntity){const i=e.deterministicIdToEntity[t];i&&this.handlesEntity(i)||this.entityColors.delete(t)}}reset(){for(const e in this.idToMetaData)this.removeMeshIncrement(e);this.clearGraphics(),this.entityColors.clear(),this.sketchToSketchEntityMapping.clear(),this.sketchToSMModelIdMapping={},this.idToPartData={},super.reset()}clearGraphics(){for(const e in this.occurrences)this.node.removeOccurrence(+e);this.styledRanges.eachNested((function(e){return e.getMeshRanges().destroy(),!1})),this.styledRanges.clear()}addIdMappings(e,t,i,s){super.addIdMappings(e,t,i,s);const n=t.getSketchFeatureId();this.sketchToSketchEntityMapping.insertNested(n,t.getSketchEntityId(),e);const r=s&&s.incremental,a=this.idToPartData[e],o=!!a&&!a.isAssociatedWithFlat;r&&o&&(0,l.setSketchNeedsThumbnail)(n)}getSMModelIdForSketch(e){return this.sketchToSMModelIdMapping[e]}removeIdMappings(e){const t=this.idToMetaData[e];if(!t)return;const i=t.getSketchFeatureId();this.sketchToSketchEntityMapping.removeNested(i,t.getSketchEntityId()),delete this.idToPartData[e],delete this.sketchToSMModelIdMapping[i],super.removeIdMappings(e)}retrieveBodyMetaData(e){const t=this.bodyToEntity.get(e);if(t&&t.size()>0){const i=new l.BodyMetaData(e);let s=!1,n=!1,a=!1;return t.each(((e,t)=>{const i=this.idToMetaData[t];i&&(i.isVertex()?s=!0:i.isEdge()?n=!0:i.isFace()&&(a=!0))})),a?i.type=r.GBTBodyType.SHEET:n?i.type=r.GBTBodyType.WIRE:s&&(i.type=r.GBTBodyType.POINT),i.isSketchBody=!0,i}return null}getNodeProperties(e,t,i,s){let n=g.getNumber("DEFAULT_Z_OFFSET");e.isFace()?n=g.getNumber("SKETCH_FACES_Z_OFFSET"):e.isEdge()?n=g.getNumber("SKETCH_EDGES_Z_OFFSET"):e.isVertex()?n=g.getNumber("SKETCH_POINTS_Z_OFFSET"):e.isDegenerateEdge()&&(n=g.getNumber("DEGENERATE_Z_OFFSET"));let r=l.RenderOrderPriority.DEFAULT;return e.isSketchConstructionEntity()&&e.isEdge()&&((0,l.isUsageCompare)()?t=!1:this.isEntityInActiveSketch(e)||(r=l.RenderOrderPriority.LOWER)),t&&this.isSketchInContext(i)&&(r=l.RenderOrderPriority.LOWER),new l.NodeProperties({primitiveType:s,isTwoSided:e.isFace(),primitivesHaveTransparency:e.isFace(),material:l.UNLIT_COLOR_FROM_ATTRIBUTE,isPickable:!(t&&e.isFace()),isShowThrough:t,isDepthTested:!t,isStencilTested:t,isHighlightable:!t||e.isSketchConstructionEntity(),zOffset:n,addsToBounds:!e.isVertex()||e.isSketchUserPoint(),priority:r,includedInBlend:!0,isTintedByCompare:!0})}getStyle(e,t,i,s){let n=null,a=null,o=null;if(e.isFace())n=i?g.getColor("SKETCH_FACE_SHOW_THROUGH_COLOR"):g.getColor("SKETCH_FACE_COLOR");else{if(t){const t=e.getSketchSolveStatus();n=e.isEdge()&&(e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon())?g.getColor("SPLINE_HANDLE_COLOR"):e.isPreviewEntity?g.getColor("SKETCH_PREVIEW_COLOR"):t&&t!==r.GBTMGeomStatus.UNKNOWN?t===r.GBTMGeomStatus.UNDER_DEFINED?i?g.getColor("UNDERCONSTRAINED_SHOW_THROUGH_LINE_POINT_COLOR"):g.getColor("UNDERCONSTRAINED_LINE_POINT_COLOR"):t===r.GBTMGeomStatus.FIXED||t===r.GBTMGeomStatus.WELL_DEFINED?i?g.getColor("CONSTRAINED_SHOW_THROUGH_LINE_POINT_COLOR"):g.getColor("CONSTRAINED_LINE_POINT_COLOR"):i?g.getColor("OVERCONSTRAINED_SHOW_THROUGH_LINE_POINT_COLOR"):g.getColor("OVERCONSTRAINED_LINE_POINT_COLOR"):i?g.getColor("SHOW_THROUGH_LINE_POINT_COLOR"):g.getColor("LINE_POINT_COLOR")}else n=g.getColor("INACTIVE_SKETCH_COLOR");e.isVertex()?(a=t?e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon()?g.getNumber("ACTIVE_SKETCH_SPLINE_HANDLE_SIZE"):e.isSketchUserPoint()?g.getNumber("ACTIVE_SKETCH_USER_POINT_SIZE"):g.getNumber("ACTIVE_SKETCH_POINT_SIZE"):e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon()?g.getNumber("INACTIVE_SKETCH_SPLINE_HANDLE_SIZE"):e.isSketchUserPoint()?g.getNumber("INACTIVE_SKETCH_USER_POINT_SIZE"):g.getNumber("INACTIVE_SKETCH_POINT_SIZE"),o=e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon()?g.getPointFont("SKETCH_SPLINE_HANDLE_POINT_FONT"):e.isSketchUserPoint()?g.getPointFont("SKETCH_USER_POINT_FONT"):g.getPointFont("SKETCH_POINT_FONT")):e.isEdge()?(a=t?i?g.getNumber("ACTIVE_SKETCH_SHOW_THROUGH_LINE_WIDTH"):e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon()?g.getNumber("SPLINE_HANDLE_LINE_WIDTH"):g.getNumber("ACTIVE_SKETCH_LINE_WIDTH"):i?g.getNumber("INACTIVE_SKETCH_SHOW_THROUGH_LINE_WIDTH"):e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon()?g.getNumber("INACTIVE_SKETCH_SPLINE_HANDLE_SIZE"):g.getNumber("INACTIVE_SKETCH_LINE_WIDTH"),o=!e.isSketchConstructionEntity()||e.isFromSketchSplineHandle()||e.isFromSketchSplineControlPolygon()?t?g.getStipple("DEFAULT_LINE_STIPPLE"):i?g.getStipple("DEFAULT_SHOW_THROUGH_LINE_STIPPLE"):g.getStipple("DEFAULT_LINE_STIPPLE"):g.getStipple("CONSTRUCTION_LINE_STIPPLE")):e.isDegenerateEdge()&&(a=t?g.getNumber("DEGENERATE_EDGE_ACTIVE_SIZE"):g.getNumber("DEGENERATE_EDGE_INACTIVE_SIZE"),o=t?g.getPointFont("SKETCH_DEGENERATE_EDGE_FONT"):g.getPointFont("SKETCH_POINT_FONT"))}if(e.isFace()&&(0,l.isUsageCompare)()&&e instanceof r.BTBaseEntityData&&(n=(0,l.getPlaneEquationColor)(this.getEntityPlaneId(e))),!t){const e=this.getEntityColor(s);e&&(n=e)}const c=new l.Style;return n&&c.setAttribute(l.Attributes.COLOR,n),null!==a&&c.setAttribute(l.Attributes.PRIMITIVE_SIZE,a),o&&c.setAttribute(l.Attributes.PRIMITIVE_STYLE,o),c}getEntityPlaneId(e){if(!e.isFace())return 0;const t=e.getMeshIncrement();if(!t)return 0;const i=t.points,s=t.normals;return(0,l.getPlaneEquationId)([i[0],i[1],i[2]],[s[0],s[1],s[2]])}handlesEntity(e,t){return!(t&&this.viewer.getIsForFlattenedDisplay()&&!t.isForFlattenedView())&&e.isFromSketch()&&(this.viewer.areOptimizedBuffersEnabled||!e.hasTessellationError())}getOwnerFlattenedBodyIdForSketch(e){const t=this.sketchToSketchEntityMapping.get(e);if(!t)return null;let i=null;return t.each((function(e,t){const s=this.idToPartData&&this.idToPartData[e];if(s)return s.isAssociatedWithFlat&&(i=s.ownerFlattenedBodyId),!0}),this),i}getOwnerFlattenedBodyId(e){const t=this.idToPartData[e];return t&&t.isAssociatedWithFlat?t.ownerFlattenedBodyId:null}getTransformForSketchEntity(e){const t=this.getOwnerFlattenedBodyId(e),i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(t&&i){const e=i.retrieveBodyMetaData(t);if(e)return i.getBodyComponent().getTransformFromSheetMetalBodyMetaData(e)}return d.mat4.create()}updateEntityGraphics(e,t,i){if(!t)return;if(this.viewer.getIsForFlattenedDisplay()){const s=this.getOwnerFlattenedBodyId(e);if(this.parent&&s){const e=this.parent.retrieveBodyMetaData(s);if(e){this.sketchToSMModelIdMapping[i.getSketchFeatureId()]=e.sheetMetalModelId;const s=this.parent.getBodyComponent().getTransformFromSheetMetalBodyMetaData(e);s&&(t=t.createTransformed(s))}}}let s;for(s in this.addMeshIncrement(t),this.occurrences)s=+s,this.isEntityForDisplay(e,s)&&this.updateEntityOccurrenceGraphics(e,s,i)}getOccurrenceIdForEntity(e){return this.sketchComponentElementId}getHideableFeatureIds(){return this.featureToIds.getKeys()}copySketchDataToClone(e){e.sketchToSketchEntityMapping=this.sketchToSketchEntityMapping.cloneNested(),e.idToPartData=(0,c.shallowClone)(this.idToPartData),e.sketchToSMModelIdMapping=(0,c.shallowClone)(this.sketchToSMModelIdMapping),e.entityColors=new Map(this.entityColors)}clone(e){const t=new I(e,this.usage,this.viewer);return this.copyToClone(t),this.copySketchDataToClone(t),t}cloneForPreview(e){const t=new I(e,l.BTGraphicsUsage.PREVIEW,this.viewer);this.copyToPreview(t),this.copySketchDataToClone(t);for(const e in this.activeSketches)t.activeSketches[e]=this.activeSketches[e];t.hasBeenInstantiated=!0;for(const e in this.occurrences)t.addOrUpdateOccurrence(+e,this.occurrences[e]);return t}removeMeshIncrement(e){const t=this.getMeshManager().removeMeshIncrement(e,this.getMeshOwnerId());if(!t)return null;let i;for(i in this.occurrences){const s=this.occurrences[i];i=+i,s&&!s.containsPart(e)||this.removeEntityFromOccurrence(e,i,t)}return t}onAppearanceConstantsUpdated(){this.clearGraphics();for(const e of this.featureToIds.getKeys())for(const t of Object.keys(this.occurrences))this.instantiateSketchGraphics(e,+t)}removeEntityFromOccurrence(e,t,i){const s=this.idToMetaData[e];if(!s)return;if(!i&&!(i=this.getMeshManager().getIncrementDetails(e,this.getMeshOwnerId())))return;const n=this.isSketchDisplayedAsActive(s.getSketchFeatureId(),t);this.getRanges(e,s,t,n,!1).onIncrementRemoved(i);this.getRanges(e,s,t,n,!0).onIncrementRemoved(i)}accumulateSketchIdsFromBodyId(e,t){const i=this.bodyToEntity.get(e);if(i)for(const e of i.getKeys()){const i=this.idToMetaData[e];if(i&&i.getFeatureIds())for(const e of i.getFeatureIds())t.add(e)}}displaySketchAsActive(e,t){this.activeSketches.hasOwnProperty(e)!==t&&(this.clearSketchGraphics(e),t?this.activeSketches[e]=!0:delete this.activeSketches[e],this.instantiateSketchGraphics(e),t&&this.hideShowFeature(e,l.Visibility.VISIBLE))}isSketchDisplayedAsActive(e,t){return t===this.sketchComponentElementId&&this.activeSketches.hasOwnProperty(e)}hasActiveSketch(){return!(0,h.isEmptyObjectOrArray)(this.activeSketches)}resetPrimitiveAttributes(e,t){this.clearSketchGraphics(e,t),this.instantiateSketchGraphics(e,t)}clearSketchGraphics(e,t){const i=this.featureToIds.get(e);if(!i)return;if(t=t||this.sketchComponentElementId,!this.occurrences.hasOwnProperty(t))return;const s=i.getKeys();for(let e=0;e<s.length;e++)this.removeEntityFromOccurrence(s[e],t)}isEntityForDisplay(e,t){const i=this.idToPartData[e],s=!i||i.isAssociatedWithFlat,n=this.occurrences[t];return!n&&s===this.viewer.getIsForFlattenedDisplay()||!!n&&n.containsPart(e)}instantiateSketchGraphics(e,t){const i=this.featureToIds.get(e);if(!i)return;if(t=t||this.sketchComponentElementId,!this.occurrences.hasOwnProperty(t))return;const s=i.getKeys();for(let e=0;e<s.length;e++){const i=s[e],n=this.idToMetaData[i];n&&(this.isEntityForDisplay(i,t)&&this.updateEntityOccurrenceGraphics(i,t,n))}}retrieveSketchEntityDeterministicId(e,t){const i=this.sketchToSketchEntityMapping.getNested(e,t);return i||null}isInstantiated(){return this.hasBeenInstantiated}instantiateForPartStudio(e){super.instantiateForPartStudio(e),this.addOrUpdateOccurrence(this.sketchComponentElementId,null)}removePartStudioInstantiation(e){this.usage===l.BTGraphicsUsage.PREVIEW&&super.removePartStudioInstantiation(e),this.removeOccurrence(this.sketchComponentElementId,!0)}addOrUpdateOccurrence(e,t){this.hasBeenInstantiated||(this.viewer.areOptimizedBuffersEnabled||this.instantiateEntities(),this.hasBeenInstantiated=!0);const i=this.addOrUpdateOccurrenceFromMeshManager(e,t,this.getMeshManager()),s=this.getSharedBaseMeshManager();s&&this.addOrUpdateOccurrenceFromMeshManager(e,t,s),t&&this.parent.imageComponent.updateDisplaysByOccurrence(e,t,this.getSketchFeatureIdsInstantiatedForOccurrence(t));const n=e===this.sketchComponentElementId;(i||n||this.occurrences.hasOwnProperty(e))&&super.addOrUpdateOccurrence(e,t)}getSketchFeatureIdsInstantiatedForOccurrence(e){const t=new Set;for(let i=0;i<e.partIds.length;++i){const s=this.idToMetaData[e.partIds[i]];if(s&&s.getFeatureIds()){const e=s.getFeatureIds();for(let i=0;i<e.length;++i)t.add(e[i])}}return t}addOrUpdateOccurrenceFromMeshManager(e,t,i){if(t){let s=null;const n=t.sketchFeatureId;if(this.viewer.areOptimizedBuffersEnabled&&n.length>0&&this.featureToIds.get(n))return this.addSketchFeatureToSceneGraph(n,i,e),!0;for(let e=0;e<t.partIds.length;++e){const i=t.partIds[e];if(this.idToMetaData.hasOwnProperty(i))s||(s=new Set),s.add(i);else{const e=this.parent.retrieveBodyMetaData(i);if(e&&e.isComposite&&e.constituentBodyIds)for(let t=0;t<e.constituentBodyIds.length;++t){const i=e.constituentBodyIds[t],n=this.bodyToEntity.get(i);n&&(s||(s=new Set),n.each(((e,t)=>{s.add(t)})))}}}if(!s||0===s.size)return!1;const r=this.occurrences[e]?this.occurrences[e].displayedSketchEntityIds:new Set,a=(0,l.setSubtract)(s,r);return t.displayedSketchEntityIds=s,this.updateEntitiesOccurrences(e,t,a,s,i),!0}if(!this.occurrences.hasOwnProperty(e)){const s=new Set;Object.entries(this.idToMetaData).forEach((([t,i])=>{this.isEntityForDisplay(t,e)&&s.add(t)})),this.updateEntitiesOccurrences(e,t,s,s,i)}return!0}addSketchFeatureToSceneGraph(e,t,i){const s=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(i),n=[l.PrimitiveType.LINES,l.PrimitiveType.TRIANGLE_STRIP],a=[!1,!0];for(const o of n){const n={isPreviewEntity:!1,getSketchFeatureId:()=>e,isFace:()=>o===l.PrimitiveType.TRIANGLE_STRIP,isEdge:()=>o===l.PrimitiveType.LINES,isVertex:()=>o===l.PrimitiveType.POINTS,getSketchSolveStatus:()=>r.GBTMGeomStatus.UNKNOWN,isFromSketchSplineHandle:()=>!1,isFromSketchSplineControlPolygon:()=>!1,isSketchConstructionEntity:()=>!1,isSketchUserPoint:()=>!1,isDegenerateEdge:()=>!1};for(const r of a){const a=this.getNodeProperties(n,r,i,o),c=this.getStyle(n,!1,r,null);this.addOrUpdateBodyOccurrenceBufferSetToNode(this.node,t,e,s,c,a)}}}updateEntitiesOccurrences(e,t,i,s,r){if(i)for(const t of i){const i=this.idToMetaData[t];i?this.updateEntityOccurrenceGraphics(t,e,i,r):n.log.warn("Could not find meta data for entity")}if(t){const i=t.isHidden?l.Visibility.HIDDEN:l.Visibility.VISIBLE;for(const t of s)this.hideShowEntity(t,i,e)}}getRanges(e,t,i,s,n){p.reset(),p.addBoolean(s),p.addBoolean(n),p.addBoolean(t.isPreviewEntity),p.addBoolean(t.isFace()),p.addBoolean(t.isEdge()),p.addBoolean(t.isVertex()),p.addBoolean(t.isDegenerateEdge()),p.addBoolean(t.isSketchConstructionEntity()),p.addBoolean(t.isSketchUserPoint()),p.addBoolean(t.isFromSketchSplineHandle()),p.addBoolean(t.isFromSketchSplineControlPolygon()),p.addNumber(t.getSketchSolveStatus(),E);let r=p.getId().toString();if((0,l.isUsageCompare)()&&(r=p.getIdWithIdAppended(this.getEntityPlaneId(t)).toString()),!s){if(null!==this.getEntityColor(e)){r+=this.getEntityOverrideId(e)}}let a=this.styledRanges.getNested(i,r);if(!a){const o=this.getNodeProperties(t,n,i,(0,l.getEntityPrimitiveType)(t)),c=this.getStyle(t,s,n,e),h=this.viewer.getOccurrenceDataManager().getOrCreateOccurrenceData(i),d=new l.IncrementRanges("SketchComponent."+i+"."+r);this.usage===l.BTGraphicsUsage.PREVIEW&&d.setListenForDeletions(!0),a=this.node.addOccurrenceGeometryToNode(o,h,c,d),this.styledRanges.insertNested(i,r,a)}return a.getMeshRanges()}updateEntityOccurrenceGraphics(e,t,i,s){const n=this.isSketchDisplayedAsActive(i.getSketchFeatureId(),t),r=(s=s||this.getMeshManager()).getIncrementDetails(e,this.getMeshOwnerId());if(!r)return;this.getRanges(e,i,t,n,!1).onIncrementAdded(r);this.getRanges(e,i,t,n,!0).onIncrementAdded(r),(this.isEntityHidden(i,t)||!n&&i&&(i.isFromSketchSplineHandle()||i.isFromSketchSplineControlPolygon()))&&this.hideMeshIncrement(e,t)}isEntityHidden(e,t){if(t===this.sketchComponentElementId)return super.isEntityHidden(e,t);{const e=this.occurrences[t];return!!e&&e.isHidden}}removeOccurrence(e,t){this.occurrences.hasOwnProperty(e)&&(this.styledRanges.remove(e),this.node.removeOccurrence(e),super.removeOccurrence(e,t))}getEntitiesForOccurrenceSelection(e){const t=this.occurrences[e];if(t&&t.displayedSketchEntityIds){const e=[];for(const i of t.displayedSketchEntityIds){const t=this.idToMetaData[i];!t||t.isFromSketchSplineHandle()||t.isFromSketchSplineControlPolygon()||e.push(i)}return e}return null}updateEntityHighlight(e,t,i,s){let n=s;const r=this.idToMetaData[i];return!(r&&s===l.PART_STUDIO_ELEMENT_ID&&(n=this.sketchComponentElementId,!this.isSketchDisplayedAsActive(r.getSketchFeatureId(),n)&&(r.isFromSketchSplineHandle()||r.isFromSketchSplineControlPolygon())))&&(!(this.viewer.getIsForFlattenedDisplay()&&(!r||this.sketchToSMModelIdMapping[r.getSketchFeatureId()]!==this.viewer.getModelViewManagers().getManager().getSelectedSheetmetalModelId()))&&super.updateEntityHighlight(e,t,i,n))}hideShowFeature(e,t,i){var s,n;const r=this.featureVisibility[e]!==t;this.featureVisibility[e]=t;const a=this.sketchToSMModelIdMapping[e],o=this.viewer.getModelViewManagers().getManager();a&&o.hasSelectedSheetmetalModelId()&&a!==o.selectedSheetmetalModelId||(r&&(null===(n=null===(s=(0,u.getActiveSketchCreationController)())||void 0===s?void 0:s.getInferenceSetController())||void 0===n||n.updateInferencingOnFeatureVisibilityChange(e,t)),this.hideShowFeatureEntities(e,t))}hideShowFeatureEntities(e,t){const i=this.getEntitiesForFeature(e);if(!i)return;const s=this.activeSketches.hasOwnProperty(e);for(let e=0;e<i.length;++e){const n=this.idToMetaData[i[e]];let r=t;!s&&n&&(n.isFromSketchSplineHandle()||n.isFromSketchSplineControlPolygon())&&(r=l.Visibility.HIDDEN);const a=this.getOccurrenceIdForEntity(i[e]);this.hideShowEntity(i[e],r,a)}this.viewer.requestDraw()}showPartsWithSheetmetalModelIdOnly(e){for(const t in this.sketchToSMModelIdMapping){this.sketchToSMModelIdMapping[t]===e?this.hideShowFeatureEntities(t,this.featureVisibility[t]):this.hideShowFeatureEntities(t,l.Visibility.HIDDEN)}}getFeatureIdForOccurrence(e){const t=this.occurrences[e];if(!t||!t.displayedSketchEntityIds)return null;for(const e of t.displayedSketchEntityIds){const t=this.idToMetaData[e];if(t)return t.getSketchFeatureId()}return null}getEntityTypesContainedWithinSketch(e){const t=new Set,i=this.featureToIds.get(e);return i?(i.each(((e,i)=>(t.add(this.idToMetaData[i].getEntityType()),t.has(r.GBTEntityType.VERTEX)&&t.has(r.GBTEntityType.EDGE)&&t.has(r.GBTEntityType.FACE))),this),t.size>0&&t.add(r.GBTEntityType.BODY),t):t}getComponentId(){return t.SketchComponentId}}t.SketchComponent=I;const T=new l.IdManager;t.TemporarySketchComponent=class extends I{constructor(e){super(null,l.BTGraphicsUsage.BASE,e),this.idManager=new l.IdManager,this.temporarySketchId=T.getId(),this.node=new l.Node(l.TEMPORARY_SKETCH_COMPONENT_NODE_ID+this.temporarySketchId),this.meshManager=new l.MeshManager(e,{bufferAllocationPolicy:l.BufferAllocationPolicy.MEDIUM}),this.entityIdManager=new l.NamedIdManager,this.viewer.getSceneGraphs().getMainSceneGraph().getRootNode().addChild(this.node),this.viewer.getModelViewManagers().getManager().addTemporarySketchComponent(this),this.instantiateForPartStudio(this.node)}remove(){this.viewer.getModelViewManagers().getManager().removeTemporarySketchComponent(this),this.node.remove(),T.freeId(this.temporarySketchId),this.temporarySketchId=l.INVALID_ID,this.reset()}getUniqueId(){return this.temporarySketchId}addTemporaryEntity(e,t){const i=this.idManager.getId().toString(),s=new r.BTPartData;s.isAssociatedWithFlat=this.viewer.getIsForFlattenedDisplay(),this.idToPartData[i]=s,e.id=i,this.idToMetaData[i]=t,this.featureToIds.insertNested(this.temporarySketchId.toString(),i,!0),this.updateEntityGraphics(i,e,t)}updateTemporaryEntity(e,t,i){this.removeEntity(e);const s=new r.BTPartData;s.isAssociatedWithFlat=this.viewer.getIsForFlattenedDisplay(),this.idToPartData[e]=s,t.id=e,this.idToMetaData[e]=i,this.featureToIds.insertNested(this.temporarySketchId.toString(),e,!0),this.updateEntityGraphics(e,t,i)}reset(){super.reset(),this.idManager.reset(),this.entityIdManager.reset()}isEntityInActiveSketch(e){return!0}isSketchDisplayedAsActive(e,t){return!0}getNodeProperties(e,t,i){const s=super.getNodeProperties(e,t,i,(0,l.getEntityPrimitiveType)(e));return s.isPickable=!1,s.includedInBlend=!1,s.updateId(),s}getEntityIdManager(){return this.entityIdManager}getMeshManager(){return this.meshManager}getSharedBaseMeshManager(){return null}getMeshOwnerId(){return"t"}updateEntityHighlight(e,t,i,s){return s===l.PART_STUDIO_ELEMENT_ID&&(s=this.sketchComponentElementId),l.PartStudioComponent.prototype.updateEntityHighlight.call(this,e,t,i,s)}}},446106:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SnapIndicator=void 0;const s=i(545348),n=i(114924),r=new n.NodeProperties({isShowThrough:!0,isDepthTested:!1,isPickable:!1,primitiveType:n.PrimitiveType.LINES}),a=s.default.getManager();class o extends n.UIElement{constructor(e){super(e)}updateLines(e){(0,n.addSizeToIncrement)(a.getNumber("INFERENCE_SNAP_LINE_WIDTH"),e),(0,n.addColorToIncrement)(a.getColor("INFERENCE_SNAP_LINE_COLOR"),e),this.updateMeshIncrement("lines",n.NO_SELECTION_ID,e,r)}}t.SnapIndicator=o},792141:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SplineHandle=void 0;const s=i(114924),n=i(545348),r=new s.NodeProperties({isShowThrough:!0,isDepthTested:!1,isStencilTested:!0,isPickable:!1,priority:s.RenderOrderPriority.LOWER,primitiveType:s.PrimitiveType.LINES}),a=new s.NodeProperties({isPickable:!1,primitiveType:s.PrimitiveType.LINES}),o=n.default.getManager();class c extends s.UIElement{constructor(e,t,i){if(super(e),this.handleRoot=null,this.handleHead=null,t){const e=t.geometry,s=e.interpolationPoints.length;i?(this.handleRoot=[e.interpolationPoints[0],e.interpolationPoints[1]],this.handleHead=[e.startHandleX,e.startHandleY]):(this.handleRoot=[e.interpolationPoints[s-2],e.interpolationPoints[s-1]],this.handleHead=[e.endHandleX,e.endHandleY])}this.updateLines()}updateEndpoints(e,t){this.handleRoot=t,this.handleHead=e,this.updateLines()}updateLines(){if(!this.handleRoot||!this.handleHead)return;const e=this.viewer.getSketch();if(!e)return;const t=[e.planeToWorld(this.handleRoot),e.planeToWorld(this.handleHead)],i=(0,s.createLines)(t);(0,s.addSizeToIncrement)(o.getNumber("SPLINE_HANDLE_LINE_WIDTH"),i),(0,s.addColorToIncrement)(o.getColor("SPLINE_HANDLE_COLOR"),i),this.updateMeshIncrement("lines",s.NO_SELECTION_ID,i,r),this.updateMeshIncrement("dp.lines",s.NO_SELECTION_ID,i.clone(),a)}}t.SplineHandle=c},437697:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ThicknessAnalysisLegend=void 0;const s=i(545348),n=i(683067),r=i(114924);class a extends r.ScalarVisualizationLegend{constructor(e){super(e),this.manager=e,this.LEGEND_MAXIMUM_CLICKED=r.THICKNESS_ANALYSIS_MAXIMUM_CLICKED,this.LEGEND_MINIMUM_CLICKED=r.THICKNESS_ANALYSIS_MINIMUM_CLICKED,this.LEGEND_RANGE_CHANGED=r.THICKNESS_ANALYSIS_RANGE_CHANGED,this.CANVAS_CONTROLS_PANEL_ID=n.THICKNESS_ANALYSIS_CANVAS_CONTROLS_PANEL_ID}updateGraphics(){void 0!==this.visualizedFieldType&&super.updateGraphics()}getInputRangeInDisplayUnits(){return this.manager.getRangeInDisplayUnits(this.manager.getRangeInData())}getDefaultDisplayRangeInDisplayUnits(){return this.manager.getRangeInDisplayUnits(this.manager.getDefaultDisplayRange())}get SNAPPING_MARGIN_TOP(){return s.default.getManager().getNumber("THICKNESS_ANALYSIS_TOP_TOOLBAR_HEIGHT_PX")}}t.ThicknessAnalysisLegend=a},904644:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ThicknessAnalysisManager=void 0;const s=i(114924),n=i(606544),r=i(275386),a=i(545348),o=i(683067),c=i(437697),l=i(972968),h=i(197134),d=i(845556),u=i(193786),g=i(997687);const p=1e-5;class m extends s.ScalarVisualizationManager{constructor(e){super(e),this.COLOR_MAP_STORAGE_KEY=r.THICKNESS_COLOR_MAP_STORAGE_KEY,this.LEGEND_CLOSED=s.THICKNESS_ANALYSIS_LEGEND_CLOSED,this.LEGEND_OPENED=s.THICKNESS_ANALYSIS_LEGEND_OPENED,this.VISUALIZATION_MANAGER_NODE_ID="ThicknessAnalysisManager",this.graphicsRenderMode=n.GBTGraphicsRenderMode.THICKNESS_ANALYSIS_VISUALIZATION,this.isEnabledInternal=!1,this.tessellationsCache=new Map,this.resultsCache=new Map,this.meshOwnerId=(0,s.getNewOwnerId)(),this.visualizedField=null,this.fieldTypeToVisualizationState=new Map,this.analyzedElementId=null,this.savedSelectedBodies=[],this.displayedScalarRangeSpecification={rangeInData:null,defaultDisplayRange:null},(0,o.getObservableFromActiveViewerForEvent)(o.DEFAULT_UNITS_CHANGED).subscribe((()=>this.updateVisualizedScalarRange()))}getVisualizationStateForField(e){var t;return null!==(t=this.fieldTypeToVisualizationState.get(e))&&void 0!==t?t:null}initializeFieldType(e){const t=new n.BTThicknessAnalysisVisualizationState,i=new n.BTRange;t.visualizedRange=i,t.displayedField=e,t.colorMapping=this.getStoredColorMapping();const s=this.computeDefaultFieldRange(e);this.fieldTypeToVisualizationState.set(e,{visualizationState:t,defaultRange:{rangeInData:s,defaultDisplayRange:s}})}initializeFieldTypes(){for(const e of m.ENABLED_FIELD_TYPES)this.initializeFieldType(e)}updateVisualizationState(){const e=this.getVisualizationStateForField(this.visualizedField);if(!e)return;const t=e.visualizationState;this.setVisualizationState(t)}setVisualizationState(e){var t;const i=this.getVisualizationStateForField(e.displayedField),{defaultRange:s}=i;this.displayedScalarRangeSpecification.rangeInData=s.rangeInData,this.displayedScalarRangeSpecification.defaultDisplayRange=s.defaultDisplayRange,null===(t=this.legend)||void 0===t||t.setInputRange(this.displayedScalarRangeSpecification),super.setVisualizationState(e)}resetMeshes(){var e;null===(e=this.meshManager)||void 0===e||e.destroy(),this.meshManager=new s.MeshManager(this.getViewer(),{bufferAllocationPolicy:s.BufferAllocationPolicy.MAXIMUM})}prepareResources(){super.prepareResources(),this.initializeFieldTypes(),null===this.visualizedField&&this.setVisualizedField(n.GBTSimulatedFieldType.ROLLING_BALL_THICKNESS),this.legend||(this.legend=new c.ThicknessAnalysisLegend(this))}setVisualizedField(e){e!==this.visualizedField&&(this.visualizedField=e,this.updateVisualizationState())}convertRadiiToDiameters(e){const t=e.clone();for(const e of t.result.fields){e.minValue*=2,e.maxValue*=2;for(let t=0;t<e.values.length;t+=1)e.values[t]*=2}return t}onUpdate(e){for(const t of e.tessellations)this.tessellationsCache.set(t.deterministicId,t);for(const t of e.results){const e=this.convertRadiiToDiameters(t);this.resultsCache.set(t.bodyDeterministicId,e)}this.updateFieldRanges(),e.bodiesCompleted===e.bodiesRequested&&this.updateVisualizationState()}resetState(){this.resetMeshes(),this.clearScalarVisualizationForVisualizedBodies(),this.tessellationsCache.clear(),this.resultsCache.clear(),this.updateGraphics()}enable(){this.isEnabledInternal||(this.isEnabledInternal=!0,this.resetState(),this.getViewer().setRenderingMode(this.graphicsRenderMode))}disable(){this.isEnabledInternal&&(this.isEnabledInternal=!1,this.analyzedElementId=null,this.savedSelectedBodies=[],this.resetState(),g.btInjector.UserSettingsService.getUserSettings().then((e=>{var t;null===(t=this.getViewer())||void 0===t||t.setRenderingMode(Number(e.graphicsRenderMode))})))}isEnabled(){return this.isEnabledInternal}getNodeProperties(){return m.imageMaps.map(((e,t)=>new s.NodeProperties({material:this.scalarVisualizationMaterials[t],zOffset:a.default.getManager().getNumber("PART_FACES_Z_OFFSET"),primitiveType:s.PrimitiveType.TRIANGLES,includedInBlend:!0,clippedBySectionPlanes:!0,isPickable:!1})))}getCurrentVisualizedField(e){return e.getFieldOfType(this.visualizationState.displayedField)}computeDefaultFieldRange(e){let t=n.BTRange.fromMinMax(Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const i of this.resultsCache.values()){const s=i.getFieldOfType(e);if(!s)continue;const r=n.BTRange.fromMinMax(s.minValue/1e3,s.maxValue/1e3);t=n.BTRange.combine(t,r)}return t.noRange&&(t.min-=p,t.max+=p),t}updateFieldRanges(){for(const e of m.ENABLED_FIELD_TYPES){const t=this.computeDefaultFieldRange(e),i=this.getVisualizationStateForField(e);i&&(i.defaultRange.rangeInData=t,i.defaultRange.defaultDisplayRange=t,i.visualizationState.visualizedRange=t)}const e=this.getRangeInData();this.setRangeInData(e),this.setDefaultDisplayRange(e),this.updateDefaultDisplayRange(e),this.legend.visualizedFieldType=this.visualizationState.displayedField,this.updateVisualizedScalarRange()}shouldVisualizeBody(e,t){return!!e&&(!!e.isSolidBody()&&t.getVisibility()===s.Visibility.VISIBLE)}getMeshIncrementForBody(e,t,i){const n=this.getCurrentVisualizedField(t),r=this.getSampleMesh(e,t.result),a=new s.MeshIncrement(s.PrimitiveType.TRIANGLES,r.points,r.getAnyIndices());return a.packScalarsIntoTextureCoordinates(n.values.map((e=>e/1e3))),a.id=i.getId(),a}getBodyComponent(){var e,t;return null===(t=null===(e=this.modelViewManager)||void 0===e?void 0:e.getDisplayedPartStudio())||void 0===t?void 0:t.getBodyComponent()}clearScalarVisualizationForVisualizedBodies(){const e=this.getBodyComponent();for(const t of this.resultsCache.values()){const i=t.bodyDeterministicId,s=e.getBodyOccurrenceData(i).getOccurrenceId(),n=e.retrieveBodyMetaData(i);e.clearScalarVisualizationOccurrence(s,n.getId())}}updateGraphicsForBody(e,t,i,n){const r=i.bodyDeterministicId,a=e.getBodyOccurrenceData(r);if(!a)return;const o=a.getOccurrenceId(),c=e.retrieveBodyMetaData(r);if(!this.shouldVisualizeBody(c,a))return;const l=this.getMeshIncrementForBody(n,i,c),h=this.meshManager.addMeshIncrement(l,this.meshOwnerId),d=new s.IncrementRanges(this.VISUALIZATION_MANAGER_NODE_ID+" "+o);d.onIncrementAdded(h);const u=new s.Style;c&&u.setAttribute(s.Attributes.COLOR,c.getColor());for(let e=0;e<t.length&&e<this.nodes.length;++e)this.nodes[e].addOccurrenceGeometryToNode(t[e],a,u,d);e.setScalarVisualizationOccurrence(o,c.getId())}updateGraphics(){if(this.clearGraphics(),!this.isEnabled())return;if(!this.viewerIsInScalarVisualizationRenderMode())return;if(this.getViewer().getActiveElementId()!==this.analyzedElementId)return;const e=this.getNodeProperties(),t=this.getBodyComponent();if(t){this.cursorAppendage||(this.cursorAppendage=new s.CursorAppendage(this.getViewer(),((e,t)=>this.getCursorText(e,t))));for(const[i,s]of this.tessellationsCache.entries()){const n=this.resultsCache.get(i);n&&(n.result.fields.length<1||this.updateGraphicsForBody(t,e,n,s))}this.updateColorMapping(null,this.displayedColorMap),this.getViewer().requestDraw()}}onPartStudioDisplayDataChanged(e){if(e.isNoop||!this.viewerIsInScalarVisualizationRenderMode())return;if(e.microversionInterval.from.equals(e.microversionInterval.to))return void this.updateGraphics();const t=this.savedSelectedBodies.map((e=>e.selectionId)).filter((e=>"string"==typeof e));this.resetState(),g.btInjector.ThicknessAnalysisService.updateVisualization(t)}readyToShowLegend(){return!!this.legend&&(!!this.viewerIsInScalarVisualizationRenderMode()&&(this.getViewer().getActiveElementId()===this.analyzedElementId&&0!==this.resultsCache.size))}getRangeInDisplayUnits(e){const t=(0,h.getCurrentDocumentSettingsModel)().getLengthUnits();if(!e||!t)return null;return(0,d.convertRangeToUnits)(e,t)}getValueInBaseUnits(e){const t=(0,h.getCurrentDocumentSettingsModel)().getLengthUnits();return(0,d.convertBetweenUnits)(e,t,"meter")}resetRangeComponent(e){const t=this.getRangeInData(),i=this.visualizationState.visualizedRange;e===l.RangeComponent.MIN?i.min=t.min:i.max=t.max,this.updateVisualizedScalarRange()}setAnalyzedElementId(e){this.analyzedElementId=e}saveSelectedBodies(e){if(!this.viewerIsInScalarVisualizationRenderMode())return;const t=(0,u.getSelectionList)().filter((({selectionId:t})=>"string"==typeof t&&e.includes(t)));this.savedSelectedBodies=t}getSavedSelectedBodies(){return this.savedSelectedBodies}}t.ThicknessAnalysisManager=m,m.ENABLED_FIELD_TYPES=[n.GBTSimulatedFieldType.ROLLING_BALL_THICKNESS,n.GBTSimulatedFieldType.RAY_THICKNESS]},164829:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.registerDragHelper=void 0,i(750664),t.registerDragHelper=function(){!function(e){let t=null;e(document).on("mouseup",(function(e){t=null})),e.widget("bti.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){const t=this;this.element.on("mousedown."+this.widgetName,(function(e){return t._mouseDown(e)})).on("click."+this.widgetName,(function(i){if(!0===e.data(i.target,t.widgetName+".preventClickEvent"))return e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1})),this.started=!1,this.buttonState={leftButton:!1,middleButton:!1,rightButton:!1}},_mouseDestroy:function(){if(this.element.off("."+this.widgetName),this._mouseMoveDelegate){e(document).off("mousemove."+this.widgetName,this._mouseMoveDelegate);for(let t=1;t<=3;++t)e(document).off("mouseup."+this.widgetName+t,this._mouseUpDelegate)}},_mouseDown:function(i){if(t&&t!==this)return;this._mouseDownEvent=i;const s=this;return!!("string"==typeof this.options.cancel&&i.target.nodeName&&e(i.target).closest(this.options.cancel).length||!this._mouseCapture(i))||(1===i.which?this.buttonState.leftButton=!0:2===i.which?this.buttonState.middleButton=!0:3===i.which&&(this.buttonState.rightButton=!0),this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout((function(){s.mouseDelayMet=!0}),this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=!1!==this._mouseStart(i),!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate||(this._mouseMoveDelegate=function(e){return s._mouseMove(e)},e(document).on("mousemove."+this.widgetName,this._mouseMoveDelegate)),this._mouseUpDelegate=function(e){return s._mouseUp(e)},e(document).on("mouseup."+this.widgetName+i.which,this._mouseUpDelegate),i.preventDefault(),t=this,!0))},_mouseMove:function(t){return e.ui.ie&&document.documentMode<9&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(i){e(document).off("mouseup."+this.widgetName+i.which,this._mouseUpDelegate),1===i.which?this.buttonState.leftButton=!1:2===i.which?this.buttonState.middleButton=!1:3===i.which&&(this.buttonState.rightButton=!1);const s=!this.buttonState.leftButton&&!this.buttonState.middleButton&&!this.buttonState.rightButton;return s&&(t=null,e(document).off("mousemove."+this.widgetName,this._mouseMoveDelegate),this._mouseMoveDelegate=null),this._mouseStarted&&s?(i.target===this._mouseDownEvent.target&&e.data(i.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(i),this._mouseStarted=!1):this._mouseStarted&&this._mouseDrag(i),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(e){return this.mouseDelayMet},_mouseStart:function(e){},_mouseDrag:function(e){},_mouseStop:function(e){},_mouseCapture:function(e){return!0}}),e.widget("bti.dragHelper",e.bti.mouse,{widgetEventPrefix:"dragHelper",options:{onStart:function(e){},onDrag:function(e){},onStop:function(e){}},_create:function(){this._mouseInit(),this._dragging=!1},destroy:function(){return this.element.off(".dragHelper"),this._mouseDestroy(),this},dragging:function(){return this._dragging},cancelDragging:function(t){return this.buttonState.leftButton=!1,this.buttonState.middleButton=!1,this.buttonState.rightButton=!1,e.bti.mouse.prototype._mouseUp.call(this,t)},_mouseStart:function(e,t){this._dragging=!0,this.lastX=e.pageX,this.lastY=e.pageY,this.options.onStart.call(this,e,t)},_mouseDrag:function(e){this.options.onDrag.call(this,e,e.pageX-this.lastX,e.pageY-this.lastY),this.lastX=e.pageX,this.lastY=e.pageY},_mouseStop:function(e){this._dragging=!1,this.options.onStop.call(this,e)}})}(s)}},324226:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DragTrimLine=void 0;const s=i(545348),n=i(114924),r=i(606544),a=s.default.getManager(),o=new n.NodeProperties({isPickable:!1,primitiveType:n.PrimitiveType.LINES});class c extends n.UIElement{constructor(e){super(e,n.HUD_SCENEGRAPH_ID),this.mousePositions=[],this.color=a.getColor("SKETCH_DRAG_TRIM_PATH_COLOR"),this.number=a.getNumber("SKETCH_DRAG_TRIM_PATH_WIDTH"),this.newLineSegment=!0}onAppearanceConstantsUpdated(){this.color=a.getColor("SKETCH_DRAG_TRIM_PATH_COLOR"),this.updateGraphics()}reset(){this.mousePositions=[],this.newLineSegment=!0,this.updateGraphics(),this.viewer.forceRequestDraw()}addPositionToDragTrimLine(e){const t=this.viewer.getCanvasCoordinateFromEvent(e);this.updateMousePositionsWithDragEvent(t),this.updateGraphics(),(0,n.requestDraw)()}makeNewLineSegment(){this.newLineSegment=!0}updateMousePositionsWithDragEvent(e){const t=new r.BTVector2d;t.updateFromArray(this.viewer.getCamera().viewportToCanvas(e)),this.newLineSegment||this.mousePositions.length%2!=0?(this.mousePositions.push(t),this.newLineSegment=!1):this.mousePositions[this.mousePositions.length-1].equals(t)||(this.mousePositions.push(this.mousePositions[this.mousePositions.length-1]),this.mousePositions.push(t))}updateGraphics(){if(this.mousePositions.length%2!=0)return;const e=(0,n.createLines)(this.mousePositions.map((e=>[e.x,e.y,0])),"dragTrimLine",this.color,this.number);this.updateMeshIncrement("lines",n.NO_SELECTION_ID,e,o)}}t.DragTrimLine=c},940417:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BlitFramebufferPass=t.BlitBufferedPass=t.BlitPass=t.BlitBlendMode=void 0;const s=i(114924);var n;!function(e){e[e.BLEND_ALL=0]="BLEND_ALL",e[e.BLEND_ALPHA=1]="BLEND_ALPHA",e[e.BLEND_OFF=2]="BLEND_OFF"}(n||(t.BlitBlendMode=n={}));class r extends s.DrawPass{constructor(e){super(e,null),this.blendMode=n.BLEND_ALL}usesShader(){return!0}preDraw(e){this.initializeShader(),e.getState().capture();const t=this.viewer.getGlContext();switch(this.blendMode){case n.BLEND_ALL:t.enable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case n.BLEND_ALPHA:t.enable(t.BLEND),t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case n.BLEND_OFF:t.disable(t.BLEND)}t.disable(t.DEPTH_TEST),e.getState().callGl("depthMask",!1),e.activateShader(this.shader);const i=this;return Object.entries(this.inputs).forEach((function([e,t]){i.shader.useTexture(e,t.getColorTexture())})),e.nodeFilter=function(e){return!0},!0}drawBlitNodes(e){this.viewer.getResources().getBlitNode().draw(e)}draw(e){this.enabled&&(e.setActivePass(this),this.preDraw(e)&&(this.justBeforeDraw(e),this.drawBlitNodes(e),this.justAfterDraw(e),this.postDraw(e)))}postDraw(e){const t=this.viewer.getGlContext();t.disable(t.BLEND),t.enable(t.DEPTH_TEST),e.getState().restore()}}t.BlitPass=r;t.BlitBufferedPass=class extends r{constructor(e,t,i){super(e),i=i||{},this.shaderTag=i.shaderTag?i.shaderTag:"drawTexture",this.inputs.uTexture=t,this.performDrawInputs=void 0!==i.performDrawInputs,this.viewport=i.viewport}drawInputs(e){}preDraw(e){return this.performDrawInputs&&super.drawInputs(e),this.viewport&&e.pushViewport(this.viewport),!!super.preDraw(e)||(this.viewport&&e.popViewport(),!1)}postDraw(e){this.viewport&&e.popViewport(),super.postDraw(e)}};t.BlitFramebufferPass=class extends r{constructor(e,t){super(e),this.frameBuffer=t,this.shaderTag="drawTexture"}preDraw(e){this.initializeShader(),e.getState().capture();const t=this.viewer.getGlContext();return t.disable(t.BLEND),e.getState().callGl("depthMask",!1),e.activateShader(this.shader),this.shader.useTexture("uTexture",this.frameBuffer.getTexture()),e.nodeFilter=function(){return!0},!0}}},374898:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BodyCheckPass=t.BodyCheckCustomPass=void 0;const s=i(681459),n=i(264292),r=i(912057),a=i(193786),o=i(606544),c=i(268154),l=i(772687),h=i(114924);class d extends h.SectionPlaneEndcapMaskDrawPass{constructor(e,t){super(e,t,null)}preDraw(e){this.initializeShader(),e.activateShader(this.shader),this.shader.uniform1f("uSectionPlaneCount",0);const t=this;return e.nodeFilter=function(e){return t.nodeFilter(e)},!0}}t.BodyCheckCustomPass=d;class u extends h.SectionPlaneEndcapMaskPass{constructor(e,t){super(e,null),this.reportedWarning=!1,this.reportedOnCracks=!1,this.childPasses=[],this.visualizedRays=[],this.forFullScreenVisualization=!!t,this.checkFrameId=!this.forFullScreenVisualization,this.camera=new h.OrthographicCamera,this.camera.setViewport([0,0,u.TEST_VIEWPORT_WIDTH,u.TEST_VIEWPORT_HEIGHT]),this.camera.setCanvasDimensions(u.TEST_VIEWPORT_WIDTH,u.TEST_VIEWPORT_HEIGHT),this.camera.setFrame(h.StandardViews.Isometric);const i=!(0,c.isBrowserSafari)();this.resultBuffer=i?new Float32Array(u.TEST_VIEWPORT_HEIGHT*u.TEST_VIEWPORT_HEIGHT*4):new Uint8Array(u.TEST_VIEWPORT_HEIGHT*u.TEST_VIEWPORT_HEIGHT*4),this.childPasses.push(new d(this.viewer,this)),this.clearColor=this.forFullScreenVisualization?[0,0,0,0]:[0,0,0,1]}shouldCheckSectionPlaneCount(){return!1}preDraw(e){if(this.reportedWarning)return!1;if(!this.forFullScreenVisualization){const e=this.viewer.getModelViewManagers().getManager().getModelBounds();if(!(e&&e.isInitialized()&&e.isFinite()&&e.isExtensive()))return!1;this.camera.setSceneBounds(e),this.camera.zoomToFit(e.getCorners()),this.camera.updateNearFar(),this.viewer.pushCameraState(this.camera)}const t=h.SectionPlaneEndcapMaskPass.prototype.preDraw.apply(this,arguments);return t||this.forFullScreenVisualization||this.viewer.popCameraState(),t}postDraw(e){this.forFullScreenVisualization||(this.viewer.popCameraState(),this.checkBuffer()),h.SectionPlaneEndcapMaskPass.prototype.postDraw.apply(this,arguments)}checkBuffer(){if(this.viewer.areOptimizedBuffersEnabled)return;const e=this.viewer.getGlContext();this.resultBuffer instanceof Float32Array?e.readPixels(0,0,u.TEST_VIEWPORT_WIDTH,u.TEST_VIEWPORT_HEIGHT,e.RGBA,e.FLOAT,this.resultBuffer):e.readPixels(0,0,u.TEST_VIEWPORT_WIDTH,u.TEST_VIEWPORT_HEIGHT,e.RGBA,e.UNSIGNED_BYTE,this.resultBuffer);const t=u.TEST_VIEWPORT_HEIGHT*u.TEST_VIEWPORT_HEIGHT;let i=0,n=0;for(let e=0;e<t;++e)this.checkPixel(n)||++i,n+=4;if(i>=4){const e=i/t*100,n="bad pixel count: "+i+", total pixel count: "+t+", percentage of bad pixels: "+e.toFixed(1)+"%, last element and microversion interval processed: "+this.viewer.getModelViewManagers().getManager().getDescriptionOfLastProcessedPartStudio();if(e>=3){const e=s.DocumentModel.getOpenDocumentModel().get("public");r.log.warn("Encountered body/bodies with significant display errors. "+n+"\nisPublic: "+e),this.findBadEntities(),this.reportedWarning=!0}else this.reportedOnCracks||(r.log.info("Encountered body/bodies with display errors.  The body may have cracks in it. "+n),this.reportedOnCracks=!0)}this.reportedWarning||window.localStorage.removeItem(this.getEntityCheckKey())}checkPixel(e){for(let t=0;t<3;++t)if(Math.abs(this.resultBuffer[e+t])>=.001)return!1;return!0}getEntityCheckKey(){let e="loggedBadEntities.";const t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();return t&&(e+=t.id),e}findBadEntities(){const e=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(!e)return;if(window.localStorage.getItem(this.getEntityCheckKey()))return;const t=e.bodyComponent;let i=0;const s=[],c=n.vec3.create(),d=function(e,t){return s.length=0,t&&t.isTriangles()&&(0,h.intersectRayBox)(e,t.getBounds(),c)?(t.iteratePrimitives((function(t,i,n){if(!i||!n)return;const r=(0,h.intersectRayTriangle)(e,t,i,n);void 0!==r&&s.push(r)})),s):s},g=(0,h.getTimeInMilliseconds)(),p=new l.StringSet;for(let e=0;e<u.TEST_VIEWPORT_HEIGHT;++e)for(let s=0;s<u.TEST_VIEWPORT_WIDTH;++s){if(!this.checkPixel(i)){const i=this.camera.getRay(s,u.TEST_VIEWPORT_HEIGHT-e);for(const e in t.bodyMetaData){const s=t.bodyMetaData[e];if(!s.isSolidBody()||s.meshState===o.GBTMeshState.ALL_MESH)continue;const n=t.bodyToEntity.get(e);if(!n)continue;if(!(0,h.intersectRayBox)(i,s.getBounds(),c))continue;const r={};n.each((function(e,s){const n=t.idToMetaData[s];if(!n)return;const a=d(i,n.getMeshIncrement());for(let e=0;e<a.length;++e){const t=(0,h.numberToFixedPointString)(a[e]);let i=r[t];i||(r[t]=i=new l.StringSet),i.add(s)}return!1}),this);for(const e in r){const t=r[e];t.size()>1&&p.addAll(t.getKeyArray())}}}i+=4}const m=(0,h.getTimeElapsed)(g);if(m>400&&window.localStorage.setItem(this.getEntityCheckKey(),"true"),p.size()>0){let e="Found overlapping entities ("+m.toFixed(0)+" ms):\n";p.each((function(i){const s=(0,a.createSelectionFromDeterministicId)(i),n=t.idToMetaData[i];let r=null;s&&(r=(0,a.getFeatureAssociatedWithSelection)(s)),e+="  entityId: "+i+", bodyId: "+n.getBodyId()+", featureIds: ["+n.getFeatureIds()+"]",e+=r?", featureName: "+r.getName()+", featureType: "+r.getFeatureType()+"\n":" (parent feature not found)\n"}),this),r.log.warn(e)}}toggleRayVisualization(){if(this.visualizedRays.length>0){for(let e=0;e<this.visualizedRays.length;++e)this.visualizedRays[e].remove();this.visualizedRays=[]}else{let e=0;for(let t=0;t<u.TEST_VIEWPORT_HEIGHT;++t)for(let i=0;i<u.TEST_VIEWPORT_WIDTH;++i){if(!this.checkPixel(e)){const e=this.camera.getRay(i,u.TEST_VIEWPORT_HEIGHT-t);this.visualizedRays.push(new h.RayVisualization(this.viewer,e))}e+=4}}}}t.BodyCheckPass=u,u.TEST_VIEWPORT_WIDTH=100,u.TEST_VIEWPORT_HEIGHT=100},527657:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.makeBufferedPass=t.BufferedPass=void 0;const s=i(114924);class n extends s.DrawPass{constructor(e,t){super(e,null),this.clearColor=[0,0,0,0],this.viewportScale=1,this.checkFrameId=!0,this.frameBuffer=null;let i=!0;t&&(this.id=t.id,i=!t.hasOwnProperty("makeFrameBuffer")||t.makeFrameBuffer),this.makeFrameBuffer=!!i;const n=this.viewer.getGlContext();i&&n&&this.initializeFrameBuffer(n),this.listenTo(this.viewer.getEventDispatcher(),s.GL_CONTEXT_RESTORED,this.onGlContextRestored),this.listenTo(this.viewer.getEventDispatcher(),s.SESSION_ENDED,this.onSessionEnded)}onGlContextRestored(e){!this.frameBuffer&&this.makeFrameBuffer&&this.initializeFrameBuffer(e),this.resetBuffer()}getColorTexture(){return this.colorTexture}getWidth(){return this.frameBuffer.getWidth()}getHeight(){return this.frameBuffer.getHeight()}initializeFrameBuffer(e){this.frameBuffer=this.viewer.getOrCreateFrameBuffer(this.textureType?this.textureType:e.UNSIGNED_BYTE,this.id,{storageType:this.storageType?this.storageType:e.DEPTH_STENCIL,attachmentType:this.attachmentType?this.attachmentType:e.DEPTH_STENCIL_ATTACHMENT})}resetBuffer(){this.frameBuffer.resetBuffer()}preDraw(e){if(!super.preDraw(e))return!1;if(1!==this.viewportScale){const t=e.getViewport().slice(0);t[2]=Math.max(1,Math.floor(t[2]*this.viewportScale)),t[3]=Math.max(1,Math.floor(t[3]*this.viewportScale)),e.pushViewport(t)}this.frameBuffer.update(e),this.colorTexture=this.frameBuffer.getTexture();const t=this.viewer.getGlContext();return this.oldBufferBinding=t.getParameter(t.FRAMEBUFFER_BINDING),this.frameBuffer.bindBuffer(),this.clearBuffer(e),!0}clearBuffer(e){const t=this.viewer.getGlContext();t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),t.clearStencil(0),t.stencilMask(255),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT)}postDraw(e){1!==this.viewportScale&&e.popViewport();const t=this.viewer.getGlContext();t.bindFramebuffer(t.FRAMEBUFFER,this.oldBufferBinding?this.oldBufferBinding:null)}getFrameBuffer(){return this.frameBuffer}setFrameBuffer(e){this.frameBuffer=e}}t.BufferedPass=n,t.makeBufferedPass=function(e,t,i,s){const r=new n(e,{id:s});return r.childPasses=[t],r.viewportScale=i,r}},401592:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.InferencePickPass=t.CombinedPickPass=void 0;const s=i(114924),n=i(545348),r=i(264292),a=i(613199),o=n.default.getManager();class c extends s.PickPass{constructor(e,t){super(e,t),this.primitivePickIds=[],this.occurrencePickIds=[],this.primitiveIdPool=[],this.currentPass=0,this.pickMask=null}setEmptyHitList(){this.hitlist=[];const e=this.pickRect[2]*this.pickRect[3],t=s.INVALID_ID.slice(0);for(let i=0;i<e;++i)this.primitivePickIds[i]=t,this.occurrencePickIds[i]=s.INVALID_OCCURRENCE_ID}getPickIteration(){return this.currentPass}justBeforeDraw(e){e.getActiveShader().uniform1f("uPickPassIteration",this.getPickIteration())}draw(e){if(this.primitiveIdPool=this.primitivePickIds,this.primitivePickIds=[],this.occurrencePickIds=[],!this.enabled)return void this.setEmptyHitList();e.setActivePass(this);const t=[];let i,n;for(i=this.viewer.getPickPassCount()-1;i>=0;--i)this.currentPass=i,super.draw(e),t.unshift(this.hitlist);if(t.length<1)return void this.setEmptyHitList();const r=t[0].length;for(i=0;i<r;++i){const e=this.primitiveIdPool.length>0?this.primitiveIdPool.pop():[];let r=0,a=-1;for(n=0;n<t.length;++n){const o=t[n][i],c=o&s.IdMasks.ENTITY;c!==s.INVALID_ID_ELEMENT&&(e[n]=c,a=n);r|=(o>>>s.IdSizes.ENTITY&s.IdMasks.OCCURRENCE_SLICE)<<n*s.IdSizes.OCCURRENCE_SLICE}e.length!==a+1&&(e.length=a+1),this.primitivePickIds.push((0,s.makeId)(e)),this.occurrencePickIds.push(r)}}gatherPicksFromPickPass(){const e={};let t,i,n;const o=this.getPickRect(),c=o[2],l=o[3],h=[o[0]+.5*c,o[1]+.5*l],d=this.getPickViewportWidthHeight(),u=2/Math.sqrt((c-1)*(c-1)+(l-1)*(l-1)),g=1/(d[0]*d[1]);for(let o=0;o<this.primitivePickIds.length;++o){if(null!==this.pickMask&&0!==this.pickMask[o])continue;const c=this.getPositionForPickHit(o);if(i=this.primitivePickIds[o],t=this.occurrencePickIds[o],(0,s.idIsValid)(i)&&t!==s.INVALID_OCCURRENCE_ID){n=e[t],n||(n={},e[t]=n);let o=n[i];o?o.incorporateLocation(c):(o=new s.Pick(i,t,c,this.getUsage()),n[i]=o),o.distance=Math.min(o.distance,a.vec2C.length(a.vec2C.subtract(c,h,r.vec2.create()))*u),o.coverage+=g}}for(t in e)for(i in n=e[t],n)n[i].determineBestLocation();return e}clearPickMask(){this.pickMask=null}updatePickMask(e,t,i){this.pickMask||(this.pickMask=new Uint8Array(this.primitivePickIds.length));let n,r=!1;for(n=0;n<this.primitivePickIds.length;++n){if(0!==this.pickMask[n])continue;const a=this.primitivePickIds[n],o=this.occurrencePickIds[n];if(!(0,s.idIsValid)(a)||o===s.INVALID_OCCURRENCE_ID)this.pickMask[n]=1;else for(let c=0;c<e.length;++c){const l=e[c];if((0,s.idsEqual)(a,l.primitiveId)&&o===l.pickedOccurrenceId){l.canPickThrough(t,this.viewer,i)?r=!0:this.pickMask[n]=1;break}}}return!r}}t.CombinedPickPass=c;t.InferencePickPass=class extends c{constructor(e){super(e,null),this.childPasses=[],this.sceneGraph=null;for(let e=0;e<s.RenderOrderPriority.COUNT;++e)this.childPasses.push(new s.FaceEdgePointPass(this.viewer,this,{visibility:s.DrawPassVisibility.SHOWTHROUGH,usePickAlternates:!0,disableDepthTest:!0,priority:e}))}getMaxHighResPickViewportSamples(){return o.getNumber("MAX_INFERENCE_PICKING_RECT_SAMPLES")}setSceneGraph(e){this.sceneGraph=e}getSceneGraph(){return this.sceneGraph}setPerformIsolationTest(e){}}},732122:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CompareBlendPass=void 0;const s=i(114924);class n extends s.BlitPass{constructor(e,t){super(e),this.shaderTag="compareBlend",this.inputs.uOverBufferPass=t}justBeforeDraw(e){super.justBeforeDraw(e),this.shader.uniform1f("uBlend",(0,s.getBlendAmount)())}}t.CompareBlendPass=n},272278:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.hidePartNodesThatDoNotAddToBoundsFilter=t.CustomPass=void 0;const s=i(545348),n=i(114924),r=i(723617),a=i(264292),o=s.default.getManager(),c=a.vec2.create(),l=a.vec3.create(),h=a.vec4.create();class d extends n.DrawPass{constructor(e,t,i){switch(super(e,t),this.stencilRefValue=null,this.extraShaderUniforms=[],this.disableColorWrites=!1,this.clipToSectionPlanes=!0,this.disableDepthTest=!1,this.performIsolationTest=!1,this.sceneGraph=null,this.shaderTag="points",this.forDepth=!1,this.shader=null,this.occlusionMapTextureUnit=0,this.applyTranslucentAlphaToAll=!1,this.nodeOccurrenceFilterFunction=null,this.primitiveType=n.Primitive.FACES,this.opacity=n.Opacity.OPAQUE,this.visibility=n.DrawPassVisibility.VISIBLE,this.stencilMode=n.StencilMode.WRITE_EDGES_AND_POINTS,this.priority=n.RenderOrderPriority.DEFAULT,this.facesShader=n.FacesShadeMode.OPAQUE,this.blendMode=n.BlendMode.OVER_WITH_SEPARATE_ALPHA,this.blendFilter=n.BlendFilter.ALL,this.depthTestMode=n.DepthTestMode.LESS,i&&(0,r.overwriteMatchingProperties)(this,i),this.primitiveType){case n.Primitive.POINTS:break;case n.Primitive.EDGES:this.shaderTag="edges";break;case n.Primitive.FACES:switch(this.facesShader){case n.FacesShadeMode.OPAQUE:this.shaderTag="faces";break;case n.FacesShadeMode.ZEBRA_STRIPES:this.shaderTag="zebraStripes";break;case n.FacesShadeMode.DRAFT:this.shaderTag="draftAnalysis";break;case n.FacesShadeMode.QUALITY_VISUALIZATION:this.shaderTag="qualityVisualization"}break;case n.Primitive.SILHOUETTES:this.shaderTag="silhouettes"}i.shaderTagSuffix&&(this.shaderTag=this.shaderTag+i.shaderTagSuffix)}setExtraMeshNodeFilter(e){this.extraMeshNodeFilter=e}setSceneGraph(e){this.sceneGraph=e}setBlendFilter(e){this.blendFilter=e}getPerformIsolationTest(){return this.performIsolationTest}setPerformIsolationTest(e){this.performIsolationTest=e}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}setEnableColorWrites(e){this.disableColorWrites=!e}setOpacity(e){this.opacity=e}setShaderUniform(e,t){for(const i of this.extraShaderUniforms)if(i.name===e)return void(i.value=t);this.extraShaderUniforms.push({name:e,value:t})}appliesTranslucentAlphaToAll(e){this.applyTranslucentAlphaToAll=e}isShowthroughPass(){return this.visibility===n.DrawPassVisibility.SHOWTHROUGH||!!this.parentPass&&this.parentPass.isShowthroughPass()}rendersPoints(){return this.primitiveType===n.Primitive.POINTS}rendersEdges(){return this.primitiveType===n.Primitive.EDGES||this.primitiveType===n.Primitive.SILHOUETTES}rendersFaces(){return this.primitiveType===n.Primitive.FACES}testIsolation(e){return this.performIsolationTest&&e.getHasIsolate()}usesShader(){return!0}setNodeOccurrenceFilterFunction(e){this.nodeOccurrenceFilterFunction=e}preDraw(e){if(!super.preDraw(e))return!1;const t=this.viewer.getGlContext();this.initializeShader(),e.activateShader(this.shader),this.isPickPass()||e.setMaterial();const i=this;switch(e.nodeFilter=function(e){return i.nodeFilter(e)},this.blendMode){case n.BlendMode.OVER_WITH_SEPARATE_ALPHA:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case n.BlendMode.ADD:t.blendFunc(t.ONE,t.ONE);break;default:throw"Unrecognized blend mode"}t.enable(t.BLEND),this.updateIsolationUniform(e,this.shader);const s=this.parentPass&&"depth"===this.parentPass.shaderTag,r=this.opacity===n.Opacity.TRANSPARENT&&!this.disableColorWrites,a=this.rendersPoints()||this.rendersEdges(),c=s||this.forDepth||!r&&!a;e.getState().callGl("depthMask",c),this.disableDepthTest?(t.disable(t.DEPTH_TEST),e.getState().callGl("depthMask",!1)):(t.enable(t.DEPTH_TEST),e.getState().callGl("depthMask",c),t.depthFunc(this.depthTestMode));const l=!this.isPickPass()&&!this.isHighlightPass(),h=(this.rendersEdges()||this.rendersPoints())&&l,d=this.rendersFaces()&&l;return h&&this.stencilMode===n.StencilMode.TEST_EDGES_AND_POINTS?(0,n.setupStencilForTestWithoutWrite)(t,this.getStencilRefValue(),this.getStencilRefMask()):h&&this.stencilMode===n.StencilMode.WRITE_EDGES_AND_POINTS?(0,n.setupStencilForWriteWithoutTest)(t,this.getStencilRefValue(),this.getStencilRefMask()):d&&this.stencilMode===n.StencilMode.WRITE_AND_TEST_FACES?(0,n.setupStencilForTestAndWrite)(t,this.getStencilRefValue(),this.getStencilRefMask()):t.disable(t.STENCIL_TEST),this.isPickPass()&&(e.getState().callGl("depthMask",!0),t.disable(t.BLEND)),this.disableColorWrites&&t.colorMask(!1,!1,!1,!1),this.rendersPoints()&&this.shader.uniform1f("uPointFilterWidth",o.getNumber("POINT_FILTER_WIDTH")),this.rendersEdges()&&(this.forDepth?this.shader.uniform1f("uLineFilterWidth",0):this.shader.uniform1f("uLineFilterWidth",o.getNumber("LINE_FILTER_WIDTH"))),this.nodeOccurrenceFilterFunction&&e.setNodeOccurrenceFilterFunction(this.nodeOccurrenceFilterFunction),!0}onShaderActivated(e,t){e.getDetailSettings().enableSSAO&&this.inputs.hasOwnProperty("uOcclusionMap")&&!e.getHasIsolate()?(t.useTexture("uOcclusionMap",this.inputs.uOcclusionMap.getColorTexture()),t.uniform1f("uOcclusionFactor",o.getNumber("AMBIENT_OCCLUSION_EFFECT_FACTOR"))):t.uniform1f("uOcclusionFactor",0),this.updateIsolationUniform(e,t);const i=this.viewer.getResources().getHighlightTexture();t.useTexture("uHighlightColorTexture",i),t.uniform1f("uHighlightColorTextureWidth",this.viewer.getReferenceHighlights().getHighlightTextureWidth()),(0,n.updateShaderClippingUniforms)(this.viewer,this.clipToSectionPlanes),this.rendersFaces()&&(t.uniform1f("uTintFactor",0),t.uniform3f("uTintColor",1,1,1),t.uniform1i("uApplyTranslucentAlphaToAll",this.applyTranslucentAlphaToAll?1:0)),this.applyExtraUniforms(t)}updateIsolationUniform(e,t){this.testIsolation(e)?t.uniform1i("uOutsideIsolation",this.forIsolate()?0:1):t.uniform1i("uOutsideIsolation",0)}getStencilRefValue(){return this.stencilRefValue?this.stencilRefValue:this.rendersEdges()?n.StencilRefValue.EDGES:this.rendersFaces()?n.StencilRefValue.FACES:n.StencilRefValue.POINTS}getStencilRefMask(){return this.rendersEdges()?n.StencilRefMask.EDGES:this.rendersFaces()?n.StencilRefMask.FACES:n.StencilRefMask.POINTS}justBeforeDraw(e){super.justBeforeDraw(e),this.shader.uniform1i("uHideSelectionInterior",this.hideSelectionInterior?1:0),this.applyExtraUniforms(this.shader)}applyExtraUniforms(e){for(const t of this.extraShaderUniforms)if(t.value)switch(t.value.length){case 4:e.uniform4fv(t.name,t.value);break;case 3:e.uniform3fv(t.name,t.value);break;case 2:e.uniform2fv(t.name,t.value);break;default:e.uniform1f(t.name,t.value)}}justAfterDraw(e){super.justAfterDraw(e);const t=e.getActiveShader();this.extraShaderUniforms.forEach((function(e){if(e.value)switch(e.value.length){case 4:t.uniform4fv(e.name,h);break;case 3:t.uniform3fv(e.name,l);break;case 2:t.uniform2fv(e.name,c);break;default:t.uniform1f(e.name,0)}}),this)}postDraw(e){const t=this.viewer.getGlContext();t.disable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.disable(t.BLEND),t.colorMask(!0,!0,!0,!0),this.nodeOccurrenceFilterFunction&&e.setNodeOccurrenceFilterFunction(null)}nodeFilter(e){if(!e.isMeshNode())return!1;if(this.blendFilter===n.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(this.blendFilter===n.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;if(this.extraMeshNodeFilter&&!this.extraMeshNodeFilter(e))return!1;if(this.disableDepthTest===e.getIsDepthTested())return!1;switch(this.primitiveType){case n.Primitive.POINTS:if(!e.isPoints())return!1;break;case n.Primitive.EDGES:if(!e.isEdges())return!1;break;case n.Primitive.FACES:if(!e.isFaces())return!1;break;case n.Primitive.SILHOUETTES:if(!e.isSilhouettes())return!1}switch(this.visibility){case n.DrawPassVisibility.VISIBLE:if(e.getIsShowThrough())return!1;switch(this.opacity){case n.Opacity.OPAQUE:if(e.hasTransparency())return!1;break;case n.Opacity.TRANSPARENT:if(!e.hasTransparency()&&!this.applyTranslucentAlphaToAll)return!1}break;case n.DrawPassVisibility.SHOWTHROUGH:if(!e.getIsShowThrough())return!1}const t=e.getIsStencilTested(),i=e.getIsStencilWritten();return!(this.stencilMode===n.StencilMode.TEST_EDGES_AND_POINTS&&!t)&&(!(this.stencilMode===n.StencilMode.WRITE_EDGES_AND_POINTS&&(!i||t))&&((this.stencilMode!==n.StencilMode.OFF||!t&&!i)&&(this.priority===e.getRenderOrderPriority()&&this.parentPass.nodeFilter(e))))}setNodeFilter(e){this.nodeFilter=e||d.prototype.nodeFilter}}t.CustomPass=d,t.hidePartNodesThatDoNotAddToBoundsFilter=function(e){const t=this.viewer.getModelViewManagers().getManager(),i=e.getParent();return!(i&&t.isNodeForBody(i)&&!e.getAddsToBounds())&&d.prototype.nodeFilter.call(this,e)}},569706:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DebugPickPass=void 0;const s=i(114924);class n extends s.BlitPass{constructor(e){super(e),this.shaderTag="debugPickPass",this.pickPass=null}setPickPass(e){this.pickPass=e,this.inputs.uPickBuffer=e}drawInputs(e){}preDraw(e){if(!this.pickPass)return!1;const t=this.pickPass.getPickViewportWidthHeight();let i=10;return t[0]>50&&(i=3),t[0]>200&&(i=1),e.pushViewport([0,0,t[0]*i,t[1]*i]),super.preDraw(e)}postDraw(e){super.postDraw(e),e.popViewport()}}t.DebugPickPass=n},989089:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.makeBufferedNormalDepthWithMaskPass=t.buildHudPass=t.DefaultPasses=t.DefaultPassUsage=void 0;const s=i(114924),n=i(545348),r=i(606544);var a;!function(e){e[e.RENDERING=0]="RENDERING",e[e.HUD=1]="HUD",e[e.ISOLATION=2]="ISOLATION",e[e.PICKING=3]="PICKING"}(a||(t.DefaultPassUsage=a={}));class o extends s.DrawPass{constructor(e,t,i,r,o){super(e,t),this.opaqueFaces=null,this.opaqueFacesZebraStripes=null,this.draftAnalysisFaces=null,this.qualityVisualization=null,this.opaqueEdges=null,this.silhouettes=null,this.opaquePoints=null,this.nonOitTransparentFaces=null,this.transparentFaces=null,this.transparentEdges=null,this.depthFaces=null,this.depthTransparentFaces=null,this.depthEdges=null,this.showThroughStencilTested=null,this.showThroughNotStencilTested=null,this.showThroughDepthTested=null,this.sectionPlaneEndcapEdge=null,this.sectionPlaneEndcapMask=null,this.sectionPlaneEndcap=null,this.sketchImageFaces=null,this.isolatePass=null,this.contextPass=null,this.compareTransparentFaces=null,this.compareTintedEdges=null,this.compareTintedPoints=null;const c=t.isPickPass(),l=new s.CustomPass(e,t,{performIsolationTest:!o}),h=new s.CustomPass(e,t,{performIsolationTest:!o,shaderTagSuffix:"-nosection"}),d=new s.SwitchPass(e,l,h,s.isSectionPlaneModeEnabled);d.setSceneGraph(i),this.opaqueFaces=d;const u=n.default.getManager(),g=new s.CustomPass(e,t,{facesShader:s.FacesShadeMode.ZEBRA_STRIPES,sceneGraph:i,performIsolationTest:!o,extraShaderUniforms:[{name:"uStripeCount",value:u.getNumber("ZEBRA_STRIPE_COUNT")},{name:"uStripeRotation",value:u.getNumber("ZEBRA_STRIPE_ROTATION")},{name:"uFilterWidth",value:u.getNumber("ZEBRA_STRIPE_FILTER_WIDTH")},{name:"uRespectOrthographic",value:u.getNumber("ZEBRA_STRIPE_RESPECT_ORTHOGRAPHIC")}]});this.opaqueFacesZebraStripes=g;const p=new s.DraftAnalysisDrawPass(e,t,!o,i);this.draftAnalysisFaces=p,this.qualityVisualization=new s.QualityVisualizationPass(e,t,!o,i);const m=new s.EdgeAndHiddenEdgePass(e,t,{primitiveType:s.Primitive.EDGES,performIsolationTest:!o,sceneGraph:i});if(this.opaqueEdges=m,!c){const n=new s.SilhouettePass(e,t,i,!1),r=new s.SilhouettePass(e,t,i,!0),a=new s.SwitchPass(e,n,r,s.isSectionPlaneModeEnabled);this.silhouettes=a}const E=new s.CustomPass(e,t,{primitiveType:s.Primitive.POINTS,performIsolationTest:!o});E.setSceneGraph(i),this.opaquePoints=E;const I=new s.CustomPass(e,t,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.TRANSPARENT,performIsolationTest:!o}),T=new s.CustomPass(e,t,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.TRANSPARENT,performIsolationTest:!o,shaderTagSuffix:s.NO_SECTION_SHADER_ID_SUFFIX}),S=new s.SwitchPass(e,I,T,s.isSectionPlaneModeEnabled);if(S.setSceneGraph(i),this.nonOitTransparentFaces=S,e.supportsOrderIndependentTranslucency()){const n=new s.TranslucentPass(e,t,i);n.setPerformIsolationTest(!o),S.performIsolationTest=!o,this.transparentFaces=new s.TransparencySwitchPass(e,n,S,s.isOrderIndependentTransparencyEnabled)}else this.transparentFaces=S;const f=new s.CustomPass(e,t,{primitiveType:s.Primitive.EDGES,opacity:s.Opacity.TRANSPARENT,stencilMode:s.StencilMode.OFF,clipToSectionPlanes:!1,performIsolationTest:!o});f.setSceneGraph(i),this.transparentEdges=f;const C=new s.CustomPass(e,t,{primitiveType:s.Primitive.FACES,disableColorWrites:!0});C.setSceneGraph(i),this.depthFaces=C,this.depthTransparentFaces=new s.TransparentFaceDepth(e,t,i,!o);const P=new s.CustomPass(e,t,{primitiveType:s.Primitive.EDGES,disableColorWrites:!0});P.setSceneGraph(i),this.depthEdges=P;const v=new s.DrawPass(e,t);for(let n=0;n<s.RenderOrderPriority.COUNT;++n){const r=new s.FaceEdgePointPass(e,t,{visibility:s.DrawPassVisibility.SHOWTHROUGH,disableDepthTest:!0,stencilMode:s.StencilMode.TEST_EDGES_AND_POINTS,priority:n,sceneGraph:i,usePickAlternates:c,performIsolationTest:!o});v.addChildPass(r)}this.showThroughStencilTested=v;const D=new s.DrawPass(e,t);for(let n=0;n<=s.RenderOrderPriority.HIGHEST;++n){const r=new s.FaceEdgePointPass(e,t,{disableDepthTest:!0,visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:n,sceneGraph:i,usePickAlternates:c});D.addChildPass(r)}this.showThroughNotStencilTested=D;const M=new s.DrawPass(e,t);for(let n=0;n<=s.RenderOrderPriority.HIGHEST;++n){const r=new s.FaceEdgePointPass(e,t,{visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:n,sceneGraph:i,usePickAlternates:c});M.addChildPass(r)}this.showThroughDepthTested=M;const y=new s.SectionPlaneEndcapMaskPass(e,i),O=new s.EdgeDetectAndBlurPass(e,y);this.sectionPlaneEndcapEdge=O,this.sectionPlaneEndcapMask=y,this.sectionPlaneEndcap=new s.SectionPlaneEndcapDrawPasses(e,t,y,O);const _=new s.CustomPass(e,t,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.TRANSPARENT,disableDepthTest:!0,sceneGraph:i,performIsolationTest:!o});this.sketchImageFaces=_,r===a.RENDERING&&(this.isolatePass=new s.GhostParentPass(e,t,!1,i),this.contextPass=new s.GhostParentPass(e,t,!0,i))}setBlendFilter(e){this.opaqueFaces.setBlendFilter(e),this.opaqueFacesZebraStripes.setBlendFilter(e),this.draftAnalysisFaces.setBlendFilter(e),this.qualityVisualization.setBlendFilter(e),this.sketchImageFaces.setBlendFilter(e),this.opaqueEdges.setBlendFilter(e),this.silhouettes.setBlendFilter(e),this.depthTransparentFaces.setBlendFilter(e),this.transparentFaces.setBlendFilter(e),this.transparentEdges.setBlendFilter(e),this.opaquePoints.setBlendFilter(e),this.isolatePass&&this.isolatePass.setBlendFilter(e),this.contextPass&&this.contextPass.setBlendFilter(e),this.showThroughStencilTested.setBlendFilter(e),this.showThroughNotStencilTested.setBlendFilter(e),this.showThroughDepthTested.setBlendFilter(e),this.depthFaces.setBlendFilter(e),this.depthEdges.setBlendFilter(e)}setHideSelectionInterior(e){this.opaqueFaces.setHideSelectionInterior(e),this.transparentFaces.setHideSelectionInterior(e),this.draftAnalysisFaces.setHideSelectionInterior(e),this.qualityVisualization.setHideSelectionInterior(e),this.isolatePass&&this.isolatePass.setHideSelectionInterior(e),this.contextPass&&this.contextPass.setHideSelectionInterior(e)}setRenderingMode(e){switch(this.isolatePass&&this.isolatePass.setRenderingMode(e),this.contextPass&&this.contextPass.setRenderingMode(e),e){case r.GBTGraphicsRenderMode.SHADED_WITH_EDGES:case r.GBTGraphicsRenderMode.SIMULATION_RESULTS:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,s.Opacity.OPAQUE,!0));break;case r.GBTGraphicsRenderMode.SHADED_WITHOUT_EDGES:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.OPAQUE),this.enableEdges(!1,!1,!1),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,s.Opacity.OPAQUE,!0));break;case r.GBTGraphicsRenderMode.SHADED_WITH_HIDDEN_EDGES:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!0,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,s.Opacity.OPAQUE,!0));break;case r.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED:this.enableOpaqueFaces(!0,!1,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),s.Opacity.ALL,!0));break;case r.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE:this.enableOpaqueFaces(!0,!1,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!0,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),s.Opacity.ALL,!0));break;case r.GBTGraphicsRenderMode.WIREFRAME:this.enableOpaqueFaces(!1,!1,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),s.Opacity.OPAQUE,!1));break;case r.GBTGraphicsRenderMode.TRANSLUCENT:this.enableOpaqueFaces(!1,!0,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!1),this.enableFullOpacity(!1),this.adjustTransparentFacePass(!0,null,s.Opacity.OPAQUE,!0);break;case r.GBTGraphicsRenderMode.SHADED_CURVATURE_VISUALIZATION:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.OPAQUE),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!1),this.adjustTransparentFacePass(!1,null,s.Opacity.OPAQUE,!0));break;case r.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.ZEBRA_STRIPES),this.enableEdges(this.viewer.getZebraStripeEdgesOn(),!1,!0),this.enableFullOpacity(!0),this.viewer.supportsOrderIndependentTranslucency()&&this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),s.Opacity.ALL,!0);break;case r.GBTGraphicsRenderMode.DRAFT_ANALYSIS:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.DRAFT),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),s.Opacity.ALL,!0));break;case r.GBTGraphicsRenderMode.DEBUG_QUALITY_VISUALIZATION:this.enableOpaqueFaces(!0,!0,s.FacesShadeMode.QUALITY_VISUALIZATION),this.enableEdges(!0,!1,!0),this.viewer.supportsOrderIndependentTranslucency()&&(this.enableFullOpacity(!0),this.adjustTransparentFacePass(!1,this.createExcludeForBodyFilter(),s.Opacity.ALL,!0))}}enableEdges(e,t,i){this.opaqueEdges.setDrawVisibleParts(e),this.silhouettes.setEnabled(e),this.opaqueEdges.setDrawHidden(t),this.silhouettes.setDrawHidden(t),this.silhouettes.setDrawBackFaceSilhouettes(i)}enableOpaqueFaces(e,t,i){let n;switch(i){case s.FacesShadeMode.OPAQUE:n=this.opaqueFaces;break;case s.FacesShadeMode.DRAFT:n=this.draftAnalysisFaces;break;case s.FacesShadeMode.QUALITY_VISUALIZATION:n=this.qualityVisualization;break;case s.FacesShadeMode.ZEBRA_STRIPES:n=this.opaqueFacesZebraStripes}const r=this.getFacePasses();for(let i=0;i<r.length;++i){const s=r[i];s===n?(s.setEnabled(e),s.setEnableColorWrites(t)):s.setEnabled(!1)}}enableFullOpacity(e){let t,i,n;e?(t=s.Opacity.ALL,i=this.createExcludeForNonBodyFilter(),n=this.createExcludeForNonBodyFilterNoDecals()):(t=s.Opacity.OPAQUE,i=null,n=null);const r=this.getFacePasses();for(let e=0;e<r.length;++e)r[e].setOpacity(t),r[e]===this.opaqueFaces?r[e].setExtraMeshNodeFilter(i):r[e].setExtraMeshNodeFilter(n)}adjustTransparentFacePass(e,t,i,n){this.transparentFaces.setExtraMeshNodeFilter(t),(this.transparentFaces instanceof s.TransparencySwitchPass||this.transparentFaces instanceof s.TranslucentPass)&&(this.transparentFaces.appliesTranslucentAlphaToAll(e),this.transparentFaces.setDepthOpacity(i),this.transparentFaces.setDepthPassEnabled(n))}enableTransparentDepth(e){this.depthTransparentFaces.setEnabled(e),e?this.depthTransparentFaces.setNodeFilter(this.createExcludeForNonBodyFilter()):this.depthTransparentFaces.setNodeFilter(null)}getFacePasses(){return[this.opaqueFaces,this.opaqueFacesZebraStripes,this.draftAnalysisFaces,this.qualityVisualization]}setZebraStripeCount(e){var t,i;this.opaqueFacesZebraStripes.setShaderUniform("uStripeCount",e),null===(t=this.contextPass)||void 0===t||t.setZebraStripeCount(e),null===(i=this.isolatePass)||void 0===i||i.setZebraStripeCount(e)}setZebraStripeRotation(e){var t,i;this.opaqueFacesZebraStripes.setShaderUniform("uStripeRotation",e),null===(t=this.contextPass)||void 0===t||t.setZebraStripeRotation(e),null===(i=this.isolatePass)||void 0===i||i.setZebraStripeRotation(e)}}t.DefaultPasses=o,t.buildHudPass=function(e,t){return new s.HudPass(e,t)},t.makeBufferedNormalDepthWithMaskPass=function(e,t,i,n){const r=(0,s.makeBufferedPass)(e,new s.NormalDepthWithMaskPass(e,t),i,n);return r.clearColor=s.normalDepthClearColor,r}},282309:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DepthRetrievalPass=void 0;const s=i(114924);class n extends s.PickPass{constructor(e){super(e,null),this.shaderTag="depth",this.points=[],this.includePlanes=!0,this.childPasses=[],this.previewPasses=[],this.clearColor=s.DEPTH_PASS_CLEAR_COLOR;for(let e=0;e<this.childPasses.length;++e)this.childPasses[e].destroy();this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.FACES,performIsolationTest:!0})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.TRANSPARENT,performIsolationTest:!0}));const t=function(e){return e.getParent().getId()===s.SketchComponentId},i=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,performIsolationTest:!0,extraShaderUniforms:[{name:"uUsePrimitiveSize",value:1}]});i.setExtraMeshNodeFilter(t),this.childPasses.push(i);const n=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.POINTS,performIsolationTest:!0,extraShaderUniforms:[{name:"uUsePrimitiveSize",value:1}]});n.setExtraMeshNodeFilter(t),this.childPasses.push(n);const r=new s.CustomPass(this.viewer,this,{performIsolationTest:!0});r.setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.childPasses.push(r),this.previewPasses.push(r);const a=new s.CustomPass(this.viewer,this,{opacity:s.Opacity.TRANSPARENT,performIsolationTest:!0});a.setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.childPasses.push(a),this.previewPasses.push(a)}setRetrieveFromPreview(e){for(let t=0;t<this.previewPasses.length;++t)this.previewPasses[t].setEnabled(e)}nodeFilter(e){if(e.isMeshNode()){if(!e.getIncludedInBlend())return!1;if((0,s.doesNodeContainPlaneEntities)(e))return this.includePlanes}return!0}draw(e){throw"Use DepthRetrievalPass retrieve method instead"}retrieve(e,t){this.includePlanes=t,super.draw(e)}postDraw(e){const t=this.pickRect[2]*this.pickRect[3]*4,i=new Uint8Array(t),n=this.viewer.getGlContext();n.readPixels(0,0,this.pickRect[2],this.pickRect[3],n.RGBA,n.UNSIGNED_BYTE,i),this.points=[];for(let e=0;e<t/4;e++){const t=4*e,n=(0,s.decodeDepth)([i[t],i[t+1],i[t+2],i[t+3]],this.viewer.isHighPrecisionSupportedInFragmentShader());this.points.push([this.pickRect[0]+e%this.pickRect[2],this.pickRect[1]+(this.pickRect[3]-Math.floor(e/this.pickRect[2])),n])}s.BufferedPass.prototype.postDraw.call(this,e),super.postDraw(e)}}t.DepthRetrievalPass=n},885298:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DepthSamplingPass=void 0;const s=i(545348),n=i(114924),r=s.default.getManager();class a extends n.BufferedPass{constructor(e){super(e),this.checkFrameId=!1,this.shaderTag="depth",this.useHighlightsOnly=!1,this.childPasses=[],this.points=[],this.numSamples=0,this.includePlanes=!0,this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.FACES,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.FACES,opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.EDGES,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.EDGES,performIsolationTest:!0,opacity:n.Opacity.TRANSPARENT,stencilMode:n.StencilMode.OFF,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.POINTS,performIsolationTest:!0,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.POINTS,performIsolationTest:!0,visibility:n.DrawPassVisibility.SHOWTHROUGH,extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.FACES,performIsolationTest:!0,sceneGraph:this.viewer.getSceneGraphs().getPreviewSceneGraph(),extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.FACES,performIsolationTest:!0,opacity:n.Opacity.TRANSPARENT,sceneGraph:this.viewer.getSceneGraphs().getPreviewSceneGraph(),extraShaderUniforms:[{name:"uUseHighlightsOnly",value:0}]})),this.clearColor=n.DEPTH_PASS_CLEAR_COLOR}setIncludePlanes(e){this.includePlanes=e}nodeFilter(e){return!!e.getIsVisible()&&(!e.isMeshNode()||!(0,n.doesNodeContainPlaneEntities)(e)||this.includePlanes)}needsAttribute(e){const t=e===n.AttributeNames.HIGHLIGHT_ID&&this.useHighlightsOnly;return this.parentPass?t||this.parentPass.needsAttribute(e):t}isHighlightPass(){return this.useHighlightsOnly}getActiveHighlightType(){return n.HighlightType.ENTITY}setUseHighlightsOnly(e){this.useHighlightsOnly=e;const t=e?1:0;for(let e=0;e<this.childPasses.length;e++)this.childPasses[e].setShaderUniform("uUseHighlightsOnly",t)}draw(e){throw"Use DepthSamplingPass retrieve method instead"}retrieve(e,t){t=t||{},this.numSamples=void 0===t.numSamples?r.getNumber("DEPTH_SAMPLES_PER_VIEWPORT"):t.numSamples,this.includePlanes=void 0===t.includePlanes||t.includePlanes,this.setPerformIsolationTest(void 0===t.performIsolationTest||t.performIsolationTest),this.setUseHighlightsOnly(void 0!==t.useHighlightsOnly&&t.useHighlightsOnly),super.draw(e)}preDraw(e){const t=e.getViewport(),i=Math.min(Math.sqrt(this.numSamples/(t[2]*t[3])),1);return this.horizontalScale=Math.ceil(t[2]*i)/t[2],this.verticalScale=Math.ceil(t[3]*i)/t[3],this.fullViewport=t,this.shrunkViewport=[0,0,Math.max(Math.round(this.horizontalScale*t[2]),1),Math.max(Math.round(this.verticalScale*t[3]),1)],e.pushViewport(this.shrunkViewport),super.preDraw(e)}postDraw(e){const t=this.shrunkViewport[2]*this.shrunkViewport[3]*4,i=new Uint8Array(t),s=this.viewer.getGlContext();s.readPixels(0,0,this.shrunkViewport[2],this.shrunkViewport[3],s.RGBA,s.UNSIGNED_BYTE,i),this.points=[];for(let e=0;e<t/4;e++){const t=4*e,s=(0,n.decodeDepth)([i[t],i[t+1],i[t+2],i[t+3]],this.viewer.isHighPrecisionSupportedInFragmentShader());if(s===n.UNKNOWN_DEPTH)continue;const r=e%this.shrunkViewport[2]+.5,a=this.shrunkViewport[3]-Math.floor(e/this.shrunkViewport[2])-.5,o=this.fullViewport[0]+r/this.horizontalScale,c=this.fullViewport[1]+a/this.verticalScale;this.points.push([o,c,s])}e.popViewport(),super.postDraw(e)}}t.DepthSamplingPass=a},817315:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DraftAnalysisDrawPass=t.DraftAnalysisShadowTestPasses=t.DraftAnalysisShadowTestPass=void 0;const s=i(114924),n=i(912057),r=i(545348),a=i(606544),o=i(264292),c=i(613199),l=o.vec4.fromValues(0,0,2048,2048),h=o.mat4.create();class d extends s.CustomPass{constructor(e,t,i,n){super(e,t,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.ALL}),this.parentPass=t,this.withDirection=i,this.setSceneGraph(n)}preDraw(e){if(this.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilter()),super.preDraw(e)){e.setOverrideFaceCullingMode(s.CullFace.NONE),e.setOverridePolygonOffset(0,0);const t=this.parentPass.draftAnalysisDrawPass;return e.pushModelViewMatrix(this.withDirection?t.viewMatrixWithDirection:t.viewMatrixAgainstDirection),e.pushProjectionMatrix(this.withDirection?t.projectionMatrixWithDirection:t.projectionMatrixAgainstDirection),(0,s.updateShaderClippingUniforms)(this.viewer,!0,!0),this.viewer.getGlContext().colorMask(this.withDirection,!this.withDirection,!1,!1),!0}return!1}postDraw(e){e.popModelViewMatrix(),e.popProjectionMatrix(),(0,s.updateShaderClippingUniforms)(this.viewer,!0,!0),e.clearOverrideFaceCullingMode(),e.clearOverridePolygonOffset(),super.postDraw(e)}}t.DraftAnalysisShadowTestPass=d;class u extends s.BufferedPass{constructor(e,t,i){super(e,{id:"draftAnalysisShadowTest"}),this.shaderTag="draftShadow",this.checkFrameId=!1,this.clearColor=[255,255,255,255],this.draftAnalysisDrawPass=t,this.childPasses=[new d(e,this,!0,i),new s.DepthClearPass(e,this),new d(e,this,!1,i)]}initializeFrameBuffer(e){this.textureType=e.FLOAT,super.initializeFrameBuffer(e)}preDraw(e){return e.pushViewport(l),!!super.preDraw(e)||(e.popViewport(),!1)}postDraw(e){e.popViewport(),super.postDraw(e)}}t.DraftAnalysisShadowTestPasses=u;class g extends s.CustomPass{constructor(e,t,i,n){super(e,t,{facesShader:s.FacesShadeMode.DRAFT,performIsolationTest:i}),this.pullDirection=null,this.showUndercut=!0,this.idToParts={},this.doDraftAnalysis=!0,this.setSceneGraph(n),this.angle=a.BTDraftAnalysis.DEFAULT_MINIMUM_ANGLE_RADIANS,this.viewMatrixWithDirection=this.projectionMatrixWithDirection=this.viewMatrixAgainstDirection=this.projectionMatrixAgainstDirection=h,this.inputs.uDraftShadowMap=new u(e,this,n),this.usage=n===this.viewer.getSceneGraphs().getMainSceneGraph()?s.BTGraphicsUsage.BASE:s.BTGraphicsUsage.PREVIEW}setPullDirection(e){this.pullDirection=e}setMinimumAngle(e){this.angle=e}setParts(e){e?(this.idsToParts={},e.forEach((function(e){Object.values(e.getDeterministicIds()).forEach((function(t){this.idsToParts[t]=e}),this)}),this)):n.log.error("Tried to set the draft analysis parts array to null.")}setShowUndercut(e){this.showUndercut=e}getIdsToParts(){return this.idsToParts}justBeforeDraw(e){let t;if(super.justBeforeDraw(e),this.shader.uniform1i("uDoDraftAnalysis",this.doDraftAnalysis&&this.pullDirection?1:0),this.pullDirection){const i=c.mat4C.multiplyVec4(e.getActiveCamera().getViewMatrix(),o.vec4.fromValues(this.pullDirection[0],this.pullDirection[1],this.pullDirection[2],0));t=c.vec3C.normalize(o.vec3.clone(i))}else t=o.vec3.create();this.shader.uniform3fv("uDraftAnalysisDirection",t),this.shader.uniform1f("uMinimumDraftAngle",this.angle);const i=r.default.getManager();this.shader.uniform4fv("uSteepDraftColor",i.getColor("DRAFT_ANALYSIS_STEEP_COLOR")),this.shader.uniform4fv("uUndercutColor",i.getColor("DRAFT_ANALYSIS_UNDERCUT_COLOR")),this.shader.uniform4fv("uWithDirectionColor",i.getColor("DRAFT_ANALYSIS_WITH_DIRECTION_COLOR")),this.shader.uniform4fv("uAgainstDirectionColor",i.getColor("DRAFT_ANALYSIS_AGAINST_DIRECTION_COLOR")),this.shader.uniform1i("uShowUndercut",this.showUndercut?1:0),this.shader.uniformMatrix4fv("uPMVMatrixWith",!1,c.mat4C.multiply(this.projectionMatrixWithDirection,this.viewMatrixWithDirection,o.mat4.create())),this.shader.uniformMatrix4fv("uPMVMatrixAgainst",!1,c.mat4C.multiply(this.projectionMatrixAgainstDirection,this.viewMatrixAgainstDirection,o.mat4.create())),this.shader.uniform1f("uDraftShadowMapPixelWidth",1/l[2]),this.shader.uniform1f("uDraftShadowMapPixelHeight",1/l[3]),this.shader.useTexture("uDraftShadowMap",this.inputs.uDraftShadowMap.getColorTexture())}createCamera(e,t,i){const n=new s.OrthographicCamera({direction:e,up:t});n.setViewport(o.vec4.clone(l));const r=i.getBounds();return n.setSceneBounds(r),n.zoomToFit(r.getCorners(),1,o.vec4.fromValues(1,1,l[2]-2,l[3]-2)),n}addToAnalyseIfApplicable(e,t,i,s){s||(s=t.retrieveBodyMetaData(e)),s&&(s.containsOnlySolidBodies()||s.containsOnlySheetBodies())&&i.set(e,s)}draw(e){if(!this.getEnabled())return;const t=this.viewer.getModelViewManagers().getManagerForUsage(this.usage).getDisplayedPartStudio();if(!t)return;let i=0,s=function(e){return e.occurrenceData.getOccurrenceId()===i};e.setNodeOccurrenceFilterFunction(s);const n=t.getBodyComponent(),r={};this.doDraftAnalysis=!0;for(const t in this.idsToParts){const s=n.retrieveBodyMetaData(t),a=new Map;if(s&&s.isOpenCompositeBody)for(const e of s.constituentBodyIds)this.addToAnalyseIfApplicable(e,n,a);else this.addToAnalyseIfApplicable(t,n,a,s);for(const[t,s]of a.entries())if(i=n.partStudioBodyIdToOccurrenceId[t],i){if(r[i]=!0,this.pullDirection){const e=c.vec3C.normalize(c.vec3C.getAPerpendicularVector(this.pullDirection),o.vec3.create());let t=this.createCamera(o.vec3.clone(this.pullDirection),e,s);this.viewMatrixWithDirection=t.getViewMatrix(),this.projectionMatrixWithDirection=t.getProjectionMatrix(),t=this.createCamera(c.vec3C.scale(this.pullDirection,-1,o.vec3.create()),e,s),this.viewMatrixAgainstDirection=t.getViewMatrix(),this.projectionMatrixAgainstDirection=c.mat4C.scale(t.getProjectionMatrix(),[-1,1,1])}else this.viewMatrixWithDirection=this.projectionMatrixWithDirection=this.viewMatrixAgainstDirection=this.projectionMatrixAgainstDirection=h;super.drawInputs(e),super.draw(e)}}s=function(e){return!r[e.occurrenceData.getOccurrenceId()]},e.setNodeOccurrenceFilterFunction(s),this.doDraftAnalysis=!1,super.draw(e),e.setNodeOccurrenceFilterFunction(null),this.postDraw(e)}postDraw(e){this.viewMatrixWithDirection=this.projectionMatrixWithDirection=this.viewMatrixAgainstDirection=this.projectionMatrixAgainstDirection=h}}t.DraftAnalysisDrawPass=g},394636:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DraftAngleRetrievalPass=void 0;const s=i(736234),n=i(114924),r=i(264292);class a extends n.PickPass{constructor(e){super(e,null),this.shaderTag="draftAngle",this.clearColor=[0,0,0,0],this.nodeOccurrenceFilterFunction=null,this.direction=null,this.points=[],this.childPasses=[],this.previewPasses=[],this.nodeFilterFunction=this.createExcludeForNonBodyFilter();for(let e=0;e<this.childPasses.length;++e)this.childPasses[e].destroy();const t=[{name:"uPullDirection",value:r.vec3.fromValues(0,0,0)}];this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.FACES,performIsolationTest:!0,extraShaderUniforms:t})),this.childPasses.push(new n.CustomPass(this.viewer,this,{primitiveType:n.Primitive.FACES,opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0,extraShaderUniforms:t}));const i=new n.CustomPass(this.viewer,this,{performIsolationTest:!0,extraShaderUniforms:t});i.setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.childPasses.push(i),this.previewPasses.push(i);const s=new n.CustomPass(this.viewer,this,{opacity:n.Opacity.TRANSPARENT,performIsolationTest:!0,extraShaderUniforms:t});s.setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.childPasses.push(s),this.previewPasses.push(s)}nodeFilter(e){return this.nodeFilterFunction(e)}setDirection(e){this.direction=e}setOccurrenceIds(e){const t={},i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(!i)return;const s=i.getBodyComponent();for(const i in e){const e=s.retrieveBodyMetaData(i);if(!e)continue;if(!e.isSolidBody()&&!e.isSheetBody())continue;const n=s.partStudioBodyIdToOccurrenceId[i];n&&(t[n]=!0)}this.nodeOccurrenceFilterFunction=e=>t[e.occurrenceData.getOccurrenceId()]}preDraw(e){return!!this.direction&&super.preDraw(e)}justBeforeDraw(e){super.justBeforeDraw(e);const t=e=>{e.setShaderUniform("uPullDirection",this.direction)};(0,s.each)(this.childPasses,t),this.previewPasses.forEach(t)}draw(e){throw"Use DraftAngleRetrievalPass retrieve method instead"}retrieve(e){e.setNodeOccurrenceFilterFunction(this.nodeOccurrenceFilterFunction),super.draw(e),e.setNodeOccurrenceFilterFunction(null)}postDraw(e){const t=this.pickRect[2]*this.pickRect[3]*4,i=new Uint8Array(t),s=this.viewer.getGlContext();s.readPixels(0,0,this.pickRect[2],this.pickRect[3],s.RGBA,s.UNSIGNED_BYTE,i),this.points=[];for(let e=0;e<t/4;e++){const t=4*e,s=(0,n.decodeAngle)([i[t],i[t+1],i[t+2],i[t+3]],this.viewer.isHighPrecisionSupportedInFragmentShader());this.points.push({canvasCoordinate:[this.pickRect[0]+e%this.pickRect[2],this.pickRect[1]+(this.pickRect[3]-Math.floor(e/this.pickRect[2]))],angle:s})}super.postDraw(e)}}t.DraftAngleRetrievalPass=a},131980:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SwitchPass=t.DrawPass=t.DepthTestMode=t.BlendMode=t.StencilRefMask=t.StencilRefValue=t.StencilMode=t.FacesShadeMode=t.DrawPassVisibility=t.Opacity=t.OITComponent=t.BlendFilter=t.Primitive=void 0;const s=i(142885),n=i(114924);var r,a,o,c,l,h,d,u,g,p,m;!function(e){e[e.POINTS=0]="POINTS",e[e.EDGES=1]="EDGES",e[e.FACES=2]="FACES",e[e.SILHOUETTES=3]="SILHOUETTES"}(r||(t.Primitive=r={})),function(e){e[e.BLEND_ONLY=0]="BLEND_ONLY",e[e.NON_BLEND_ONLY=1]="NON_BLEND_ONLY",e[e.ALL=2]="ALL"}(a||(t.BlendFilter=a={})),function(e){e.ACCUMULATION="Accumulation",e.REVEALAGE="Revealage"}(o||(t.OITComponent=o={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.TRANSPARENT=1]="TRANSPARENT",e[e.ALL=2]="ALL"}(c||(t.Opacity=c={})),function(e){e[e.VISIBLE=0]="VISIBLE",e[e.SHOWTHROUGH=1]="SHOWTHROUGH"}(l||(t.DrawPassVisibility=l={})),function(e){e[e.OPAQUE=0]="OPAQUE",e[e.ZEBRA_STRIPES=1]="ZEBRA_STRIPES",e[e.DRAFT=2]="DRAFT",e[e.QUALITY_VISUALIZATION=3]="QUALITY_VISUALIZATION"}(h||(t.FacesShadeMode=h={})),function(e){e[e.WRITE_EDGES_AND_POINTS=0]="WRITE_EDGES_AND_POINTS",e[e.TEST_EDGES_AND_POINTS=1]="TEST_EDGES_AND_POINTS",e[e.WRITE_AND_TEST_FACES=2]="WRITE_AND_TEST_FACES",e[e.OFF=3]="OFF"}(d||(t.StencilMode=d={})),function(e){e[e.LOW_PRIORITY_EDGES=1]="LOW_PRIORITY_EDGES",e[e.EDGES=2]="EDGES",e[e.POINTS=4]="POINTS",e[e.FACES=8]="FACES"}(u||(t.StencilRefValue=u={})),function(e){e[e.EDGES=3]="EDGES",e[e.POINTS=4]="POINTS",e[e.FACES=8]="FACES"}(g||(t.StencilRefMask=g={})),function(e){e[e.OVER_WITH_SEPARATE_ALPHA=0]="OVER_WITH_SEPARATE_ALPHA",e[e.ADD=1]="ADD"}(p||(t.BlendMode=p={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(m||(t.DepthTestMode=m={}));class E extends s.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.childPasses=null,this.shaderTag=null,this.inputs={},this.enabled=!0,this.checkFrameId=!1,this.hideSelectionInterior=!1,(0,n.viewerCheck)(e),this.parentPass=t,this.lastRenderedFrame=n.INVALID_FRAME_ID}reloadShaders(){if(this.shader&&this.viewer&&(this.shader=this.viewer.getShader(this.shader.getId())),this.childPasses)for(let e=0;e<this.childPasses.length;e++)this.childPasses[e].reloadShaders();Object.values(this.inputs).forEach((function(e){e.reloadShaders()}))}prepareShaders(){if(!this.shader&&this.getEnabled()&&this.viewer){if(this.usesShader()&&this.initializeShader(),this.childPasses)for(let e=0;e<this.childPasses.length;e++)this.childPasses[e].prepareShaders();Object.values(this.inputs).forEach((function(e){e.prepareShaders()}))}}usesShader(){return!1}initializeShader(){this.shader||(this.shader=this.viewer.getShader(this.getShaderId()))}setShaderUniform(e,t){if(this.childPasses)for(let i=0;i<this.childPasses.length;++i)this.childPasses[i].setShaderUniform(e,t)}onSessionEnded(){this.stopListening()}destroy(){if(this.onSessionEnded(),this.childPasses)for(let e=0;e<this.childPasses.length;++e)this.childPasses[e].destroy(),this.childPasses[e]=null;this.childPasses=null;for(const e in this.inputs)this.inputs[e].destroy(),this.inputs[e]=null;this.inputs=null,this.parentPass=null}setEnabled(e){this.enabled=e}getEnabled(){return this.enabled}setCheckFrameId(e){this.checkFrameId=e}getSceneGraph(){return this.parentPass?this.parentPass.getSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()}getLastRenderedFrame(){return this.lastRenderedFrame}setInput(e,t){this.inputs[e]=t}drawInputs(e){if(this.getEnabled()){if(this.childPasses)for(let t=0;t<this.childPasses.length;++t)this.childPasses[t].drawInputs(e);Object.values(this.inputs).forEach((function(t){t.drawInputs(e),t.draw(e)}))}}preDraw(e){return(0,n.viewerCheck)(this.viewer),(!this.checkFrameId||e.getFrameId()!==this.lastRenderedFrame)&&(this.lastRenderedFrame=e.getFrameId(),!0)}justBeforeDraw(e){this.parentPass&&this.parentPass.justBeforeDraw(e)}postDraw(e){}onShaderActivated(e,t){}justAfterDraw(e){this.parentPass&&this.parentPass.justAfterDraw(e)}draw(e){if(!this.getEnabled())return;const t=this;if(this.childPasses||this.getSceneGraph().passesNodeFilter((function(e){return t.nodeFilter(e)})))if(e.setActivePass(this),e.getState().capture(),this.preDraw(e)){if(this.childPasses)for(let t=0;t<this.childPasses.length;++t)this.childPasses[t].draw(e);else this.justBeforeDraw(e),this.getSceneGraph().draw(e),this.justAfterDraw(e);this.postDraw(e),e.getState().restore()}else e.getState().restore()}isPickPass(){return!!this.parentPass&&this.parentPass.isPickPass()}isHighlightPass(){return!!this.parentPass&&this.parentPass.isHighlightPass()}getActiveHighlightType(){return this.parentPass?this.parentPass.getActiveHighlightType():null}isShowthroughPass(){return!!this.parentPass&&this.parentPass.isShowthroughPass()}testIsolation(e){return!1}forIsolate(){return!this.parentPass||this.parentPass.forIsolate()}forSectionPlaneEndcapMask(){return!!this.parentPass&&this.parentPass.forSectionPlaneEndcapMask()}getShaderId(){let e="";return this.parentPass&&(e=this.parentPass.getShaderId()),this.shaderTag&&(e+="-"+this.shaderTag),e}needsAttribute(e){return!!this.parentPass&&this.parentPass.needsAttribute(e)}getPickIteration(){return this.parentPass?this.parentPass.getPickIteration():-1}nodeFilter(e){return!this.parentPass||this.parentPass.nodeFilter(e)}addChildPass(e){this.childPasses||(this.childPasses=[]),this.childPasses.push(e)}getChildPass(e){return this.childPasses&&e<this.childPasses.length?this.childPasses[e]:null}getChildPassCount(){return this.childPasses?this.childPasses.length:0}setBlendFilter(e){for(let t=0;this.childPasses&&t<this.childPasses.length;++t)this.childPasses[t].setBlendFilter(e)}getPerformIsolationTest(){for(let e=0;this.childPasses&&e<this.childPasses.length;++e)if(this.childPasses[e].getPerformIsolationTest())return!0;return!1}setPerformIsolationTest(e){for(let t=0;this.childPasses&&t<this.childPasses.length;++t)this.childPasses[t].setPerformIsolationTest(e)}setHideSelectionInterior(e){this.hideSelectionInterior=e}createExcludeForNonBodyFilter(e){const t=this.viewer.getModelViewManagers().getManager();return i=>i.getParent()&&t.isNodeForBody(i.getParent(),e)}createExcludeForNonBodyFilterNoDecals(e){const t=this.viewer.getModelViewManagers().getManager();return i=>i.getParent()&&t.isNodeForBody(i.getParent(),e)&&!(0,n.isNodeForDecal)(i)}createOnlyDecalsFilter(){const e=this.viewer.getModelViewManagers().getManager();return t=>t.getParent()&&e.isNodeForBody(t.getParent())&&(0,n.isNodeForDecal)(t)}createExcludeForBodyFilter(){const e=this.viewer.getModelViewManagers().getManager();return t=>t.getParent()&&!e.isNodeForBody(t.getParent())}needsFaceAppearances(){return!0}setNodeOccurrenceFilterFunction(e){if(this.childPasses)for(let t=0;t<this.childPasses.length;++t)this.childPasses[t].setNodeOccurrenceFilterFunction(e)}}t.DrawPass=E;t.SwitchPass=class extends E{constructor(e,t,i,s){super(e,null),this.pass1=t,this.pass2=i,this.predicate=s,this.childPasses=[this.pass1,this.pass2]}setInput(e,t){this.pass1.setInput(e,t),this.pass2.setInput(e,t)}prepareShaders(){this.predicate()?this.pass1.prepareShaders():this.pass2.prepareShaders()}drawInputs(e){this.predicate()?this.pass1.drawInputs(e):this.pass2.drawInputs(e)}preDraw(e){return this.predicate()?this.pass1.preDraw(e):this.pass2.preDraw(e)}justBeforeDraw(e){this.predicate()?this.pass1.justBeforeDraw(e):this.pass2.justBeforeDraw(e)}postDraw(e){this.predicate()?this.pass1.postDraw(e):this.pass2.postDraw(e)}justAfterDraw(e){this.predicate()?this.pass1.justAfterDraw(e):this.pass2.justAfterDraw(e)}draw(e){this.predicate()?this.pass1.draw(e):this.pass2.draw(e)}setEnabled(e){this.pass1.setEnabled(e),this.pass2.setEnabled(e)}destroy(){this.pass1.destroy(),this.pass2.destroy()}setCheckFrameId(e){this.pass1.setCheckFrameId(e),this.pass2.setCheckFrameId(e)}getSceneGraph(){return this.predicate()?this.pass1.getSceneGraph():this.pass2.getSceneGraph()}isPickPass(){return this.predicate()?this.pass1.isPickPass():this.pass2.isPickPass()}isHighlightPass(){return this.predicate()?this.pass1.isHighlightPass():this.pass2.isHighlightPass()}getActiveHighlightType(){return this.predicate()?this.pass1.getActiveHighlightType():this.pass2.getActiveHighlightType()}isShowthroughPass(){return this.predicate()?this.pass1.isShowthroughPass():this.pass2.isShowthroughPass()}forIsolate(){return this.predicate()?this.pass1.forIsolate():this.pass2.forIsolate()}getShaderId(){return this.predicate()?this.pass1.getShaderId():this.pass2.getShaderId()}needsAttribute(e){return this.predicate()?this.pass1.needsAttribute(e):this.pass2.needsAttribute(e)}getPickIteration(){return this.predicate()?this.pass1.getPickIteration():this.pass2.getPickIteration()}nodeFilter(e){return this.predicate()?this.pass1.nodeFilter(e):this.pass2.nodeFilter(e)}setNodeFilter(e){this.pass1.setNodeFilter(e),this.pass2.setNodeFilter(e)}setExtraMeshNodeFilter(e){this.pass1.setExtraMeshNodeFilter(e),this.pass2.setExtraMeshNodeFilter(e)}setBlendFilter(e){this.pass1.setBlendFilter(e),this.pass2.setBlendFilter(e)}setSceneGraph(e){this.pass1.setSceneGraph(e),this.pass2.setSceneGraph(e)}setEnableColorWrites(e){this.pass1.setEnableColorWrites(e),this.pass2.setEnableColorWrites(e)}setOpacity(e){this.pass1.setOpacity(e),this.pass2.setOpacity(e)}setDrawHidden(e){this.pass1.setDrawHidden(e),this.pass2.setDrawHidden(e)}setDrawBackFaceSilhouettes(e){this.pass1.setDrawBackFaceSilhouettes(e),this.pass2.setDrawBackFaceSilhouettes(e)}setMaskOpaqueFaces(e){this.pass1.setMaskOpaqueFaces(e),this.pass2.setMaskOpaqueFaces(e)}getLastRenderedFrame(){return this.predicate()?this.pass1.getLastRenderedFrame():this.pass2.getLastRenderedFrame()}setHideSelectionInterior(e){this.pass1.setHideSelectionInterior(e),this.pass2.setHideSelectionInterior(e)}getPerformIsolationTest(){return this.pass1.getPerformIsolationTest()||this.pass2.getPerformIsolationTest()}setPerformIsolationTest(e){this.pass1.setPerformIsolationTest(e),this.pass2.setPerformIsolationTest(e)}needsFaceAppearances(){return this.predicate()?this.pass1.needsFaceAppearances():this.pass2.needsFaceAppearances()}}},523252:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.clearStencilBufferBit=t.clearStencilBuffer=t.setupStencilForTestAndWrite=t.setupStencilForWriteWithoutTest=t.setupStencilForTestWithoutWrite=void 0,t.setupStencilForTestWithoutWrite=function(e,t,i){e.enable(e.STENCIL_TEST),e.stencilFunc(e.GREATER,t,i),e.stencilMask(0),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t.setupStencilForWriteWithoutTest=function(e,t,i){e.enable(e.STENCIL_TEST),e.stencilFunc(e.ALWAYS,t,255),e.stencilMask(i),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE)},t.setupStencilForTestAndWrite=function(e,t,i){e.enable(e.STENCIL_TEST),e.stencilFunc(e.GREATER,t,i),e.stencilMask(i),e.stencilOp(e.KEEP,e.KEEP,e.REPLACE)},t.clearStencilBuffer=function(e){e.clearStencil(0),e.stencilMask(255),e.clear(e.STENCIL_BUFFER_BIT)},t.clearStencilBufferBit=function(e,t){e.clearStencil(0),e.stencilMask(t),e.clear(e.STENCIL_BUFFER_BIT)}},389759:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeAndHiddenEdgePass=void 0;const s=i(736234),n=i(114924),r=i(545348),a=function(e){if(!e.isMeshNode())return!1;if(this.blendFilter===n.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(this.blendFilter===n.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;return!!e.getIsDepthTested()&&(!e.hasTransparency()&&(!(e.getIsStencilTested()||!e.getIsStencilWritten())&&(this.priority===e.getRenderOrderPriority()&&this.parentPass.nodeFilter(e))))},o=function(e){const t=this.viewer.getModelViewManagers().getManager(),i=e.getParent();return!!(e.isEdges()&&i&&t.isNodeForBody(i))&&a.call(this,e)},c=function(e){return!!e.isSilhouettes()&&a.call(this,e)};class l extends n.DrawPass{constructor(e,t,i){super(e,t),this.childPasses=[];const a=r.default.getManager(),l=(0,s.clone)(i);l.extraShaderUniforms=[{name:"uColorMixToWhite",value:0}];const h=(0,s.clone)(i);h.stencilMode=n.StencilMode.TEST_EDGES_AND_POINTS,h.stencilRefValue=n.StencilRefValue.LOW_PRIORITY_EDGES,h.visibility=n.DrawPassVisibility.SHOWTHROUGH,h.disableDepthTest=!0,h.extraShaderUniforms=[{name:"uColorMixToWhite",value:a.getNumber("HIDDEN_LINE_FADE_AMOUNT")}],this.visibleEdgePass1=new n.CustomPass(this.viewer,this,l),l.shaderTagSuffix=n.NO_SECTION_SHADER_ID_SUFFIX,this.visibleEdgePass2=new n.CustomPass(this.viewer,this,l),this.visibleEdgePass=new n.SwitchPass(this.viewer,this.visibleEdgePass1,this.visibleEdgePass2,n.isSectionPlaneModeEnabled),this.childPasses.push(this.visibleEdgePass),this.hiddenEdgePass=new n.CustomPass(this.viewer,this,h),i.primitiveType===n.Primitive.EDGES?this.hiddenEdgePass.setNodeFilter(o):this.hiddenEdgePass.setNodeFilter(c),this.hiddenEdgePass.setEnabled(!1),this.childPasses.push(this.hiddenEdgePass)}setDrawHidden(e){this.hiddenEdgePass.setEnabled(e)}setDrawVisibleParts(e){e?this.visibleEdgePass.setNodeFilter(null):this.visibleEdgePass.setNodeFilter(n.hidePartNodesThatDoNotAddToBoundsFilter)}setBlendFilter(e){this.visibleEdgePass.setBlendFilter(e),this.hiddenEdgePass.setBlendFilter(e)}setExtraMeshNodeFilter(e){this.visibleEdgePass.setExtraMeshNodeFilter(e),this.hiddenEdgePass.setExtraMeshNodeFilter(e)}set nodeOccurrenceFilterFunction(e){this.visibleEdgePass1.nodeOccurrenceFilterFunction=e,this.visibleEdgePass1.nodeOccurrenceFilterFunction=e,this.hiddenEdgePass.nodeOccurrenceFilterFunction=e}}t.EdgeAndHiddenEdgePass=l},170029:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FaceSingleHighlightDrawPass=void 0;const s=i(114924);class n extends s.BlitPass{constructor(e,t,i,n){super(e),this.highlightType=t,this.disableDuringPreview=n,this.shaderTag="highlightDraw",this.interiorHighlightOpacity=.5,this.inputs.uHighlightBuffer=new s.FaceHighlightBufferPass(this.viewer,t);const r=new s.FaceHighlightMaskPass(this.viewer,t,i),a=r.opaqueFacePass.nodeFilter;r.opaqueFacePass.setNodeFilter((function(e){this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()&&e.hasNonIsolatedOccurrences()&&this.viewer.getModelViewManagers().getManager().isNodeForModel(e)&&r.opaqueFacePass.setOpacity(s.Opacity.ALL);const t=a.call(r.opaqueFacePass,e);return r.opaqueFacePass.setOpacity(s.Opacity.OPAQUE),t})),r.opaqueFacePass.setNodeOccurrenceFilterFunction((e=>!(!this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()||e.occurrenceData.getIsolated())||!e.parentHasTransparency())),this.inputs.uHighlightMask=r,this.scenegraph=this.viewer.getSceneGraphs().getMainSceneGraph()}setMaskOpaqueFaces(e){this.inputs.uHighlightMask.opaqueFacePass.setEnabled(e)}setSceneGraph(e){this.scenegraph=e,this.inputs.uHighlightBuffer.setSceneGraph(e),this.inputs.uHighlightMask.setSceneGraph(e)}getSceneGraph(){return this.scenegraph}getEnabled(){return this.enabled&&(!this.disableDuringPreview||!(0,s.isUsagePreview)())}setInteriorHighlightOpacity(e){this.interiorHighlightOpacity=e}justBeforeDraw(e){super.justBeforeDraw(e);const t=this.viewer.getReferenceHighlights().highlights[this.highlightType];this.shader.uniform4fv("uHighlightColor1",t.color1),this.shader.uniform4fv("uHighlightColorBorder",t.colorBorder),this.shader.uniform1f("uInteriorHighlightOpacity",this.interiorHighlightOpacity),this.shader.uniform1i("uHideSelectionInterior",this.hideSelectionInterior?1:0),this.shader.uniform1i("uOutlineOverlappingInteriorRegions",t.outlineOverlappingInteriorRegions?1:0)}postDraw(e){super.postDraw(e)}}t.FaceSingleHighlightDrawPass=n},175381:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.buildFacesLinesPointsPasses=void 0;const s=i(114924);t.buildFacesLinesPointsPasses=function(e,t,i){const n=[],r=!!i.hasOwnProperty("usePickAlternates")&&i.usePickAlternates;return i.primitiveType=s.Primitive.FACES,n.push(new s.CustomPass(e,t,i)),r&&n.push(new s.PickAlternates(e,t,i)),i.primitiveType=s.Primitive.EDGES,n.push(new s.CustomPass(e,t,i)),r&&n.push(new s.PickAlternates(e,t,i)),i.primitiveType=s.Primitive.POINTS,n.push(new s.CustomPass(e,t,i)),n}},822251:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.LinePointAllHighlightsDrawPass=t.LinePointSingleHighlightDrawPass=t.FaceAllHighlightsDrawPass=void 0;const s=i(114924),n=i(545348);class r extends s.DrawPass{constructor(e,t,i,n,r){super(e,t),this.childPasses=[];const a=!!r;this.scenegraph=this.viewer.getSceneGraphs().getMainSceneGraph(),n===s.BTGraphicsUsage.PREVIEW&&(this.scenegraph=this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.usage=n||s.BTGraphicsUsage.BASE;const o=this.viewer.getReferenceHighlights().sortedHighlights;for(let e=0;e<o.length;++e){const t=o[e].type;if(r&&!r.has(t))continue;s.HighlightType.FILTERED_ENTITIES;const n=t===s.HighlightType.FILTERED_ENTITIES&&!a,c=new s.FaceSingleHighlightDrawPass(this.viewer,t,i,n);c.setSceneGraph(this.scenegraph),this.childPasses.push(c)}}setInteriorHighlightOpacity(e){for(let t=0;t<this.childPasses.length;++t)this.childPasses[t].setInteriorHighlightOpacity(e)}getSceneGraph(){return this.scenegraph}drawInputs(e){}draw(e){if(this.usage!==s.BTGraphicsUsage.BASE||e.getBaseHighlightsEnabled())for(let t=0;t<this.childPasses.length;++t)this.viewer.getHighlightManager(this.usage).highlightHasSelections(this.childPasses[t].highlightType)&&(this.childPasses[t].drawInputs(e),this.childPasses[t].draw(e))}setHideSelectionInterior(e){for(let t=0;t<this.childPasses.length;++t)this.childPasses[t].setHideSelectionInterior(!!e&&this.childPasses[t].highlightType!==s.HighlightType.PRE)}setMaskOpaqueFaces(e){for(let t=0;t<this.childPasses.length;t++)this.childPasses[t].setMaskOpaqueFaces(e)}}t.FaceAllHighlightsDrawPass=r;class a extends s.DrawPass{constructor(e,t,i,r,a,o,c){let l;super(e,i),this.highlightType=t,this.useDepthTest=r,this.stippleOverride=a,this.clipAgainstSectionPlane=o,this.disableDuringPreview=c,this.shaderTag="highlightDraw",this.childPasses=[],o||(l=s.NO_SECTION_SHADER_ID_SUFFIX);const h=n.default.getManager();for(let e=0;e<s.RenderOrderPriority.COUNT;++e)this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,visibility:s.DrawPassVisibility.SHOWTHROUGH,stencilMode:s.StencilMode.TEST_EDGES_AND_POINTS,disableDepthTest:!0,priority:e,shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.POINTS,visibility:s.DrawPassVisibility.SHOWTHROUGH,stencilMode:s.StencilMode.TEST_EDGES_AND_POINTS,disableDepthTest:!0,priority:e,shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,visibility:s.DrawPassVisibility.SHOWTHROUGH,disableDepthTest:!0,priority:e,shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.POINTS,visibility:s.DrawPassVisibility.SHOWTHROUGH,disableDepthTest:!0,priority:e,shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:e,shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.POINTS,visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:e,shaderTagSuffix:l}));this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,opacity:s.Opacity.TRANSPARENT,stencilMode:s.StencilMode.OFF,extraShaderUniforms:[{name:"uHighlightLineWidthMin",value:h.getNumber("HIGHLIGHT_LINE_WIDTH_TRANSPARENT_MIN")}],shaderTagSuffix:l})),this.childPasses.push(new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.POINTS,shaderTagSuffix:l}))}isHighlightPass(){return!0}getActiveHighlightType(){return this.highlightType}needsAttribute(e){const t=e===s.AttributeNames.HIGHLIGHT_ID;return this.parentPass?t||this.parentPass.needsAttribute(e):t}getHighlight(){return this.viewer.getReferenceHighlights().highlights[this.highlightType]}getEnabled(){return this.enabled&&(!this.disableDuringPreview||!(0,s.isUsagePreview)())}nodeFilter(e){return this.getHighlight().forOccurrences?e.getParent()&&!this.viewer.getModelViewManagers().getManager().isNodeForBody(e.getParent()):s.DrawPass.prototype.nodeFilter.apply(this,arguments)}justBeforeDraw(e){const t=n.default.getManager();super.justBeforeDraw(e);const i=e.getActiveShader(),r=this.getHighlight(),a=r.type===s.HighlightType.FILTERED_ENTITIES;i.uniform1f("uActiveHighlightIndex",r.index),i.uniform4fv("uHighlightColor",r.color1),i.uniform1f("uHighlightLineWidthMin",a?t.getNumber("HIGHLIGHT_LINE_WIDTH_REDUCED_PX"):t.getNumber("HIGHLIGHT_LINE_WIDTH_MIN_PX")),i.uniform1f("uHighlightPointSizeMin",t.getNumber("HIGHLIGHT_POINT_SIZE_MIN_PX")),this.stippleOverride?(i.uniform4fv("uHighlightLineStipple",this.stippleOverride),i.uniform1f("uUseHighlightLineStipple",1),e.setUseHiddenOpacityForEdgeHighlights(!0)):(i.uniform1f("uUseHighlightLineStipple",0),e.setUseHiddenOpacityForEdgeHighlights(!1)),i.uniform1i("uClippedBySectionPlanes",this.clipAgainstSectionPlane?1:0);const o=this.viewer.getGlContext();o.enable(o.BLEND),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA),this.useDepthTest?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),e.getState().callGl("depthMask",!1)}}t.LinePointSingleHighlightDrawPass=a;class o extends s.DrawPass{constructor(e,t,i,r){super(e,null),this.childPasses=[];const o=n.default.getManager();this.usage=t||s.BTGraphicsUsage.BASE,this.scenegraph=this.viewer.getSceneGraphs().getMainSceneGraph(),t===s.BTGraphicsUsage.PREVIEW&&(this.scenegraph=this.viewer.getSceneGraphs().getPreviewSceneGraph());const c=!!r;for(let e=0;e<this.viewer.getReferenceHighlights().sortedHighlights.length;++e){const t=this.viewer.getReferenceHighlights().sortedHighlights[e].type;if(r&&!r.has(t))continue;const n=t===s.HighlightType.FILTERED_ENTITIES,l=t===s.HighlightType.FILTERED_ENTITIES,h=t===s.HighlightType.FILTERED_ENTITIES&&!c;i?n&&this.childPasses.push(new a(this.viewer,t,this,!0,null,l,h)):n?this.childPasses.push(new a(this.viewer,t,this,!1,o.getStipple("HIGHLIGHT_HIDDEN_LINE_STIPPLE"),l,h)):this.childPasses.push(new a(this.viewer,t,this,!1,null,l,h))}}preDraw(e){return!(this.usage===s.BTGraphicsUsage.BASE&&!e.getBaseHighlightsEnabled())&&super.preDraw(e)}drawInputs(e){for(let e=0;e<this.childPasses.length;++e)this.childPasses[e].setEnabled(this.viewer.getHighlightManager(this.usage).highlightHasSelections(this.childPasses[e].highlightType));s.DrawPass.prototype.drawInputs.apply(this,arguments)}setSceneGraph(e){this.scenegraph=e}getSceneGraph(){return this.scenegraph}}t.LinePointAllHighlightsDrawPass=o},492658:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FaceHighlightMaskPass=t.FaceHighlightBufferPass=void 0;const s=i(114924);class n extends s.BufferedPass{constructor(e,t){super(e,{id:"highlightBuffer"}),this.highlightType=t,this.shaderTag="highlightBuffer",this.childPasses=[],this.clearColor=[0,0,0,0],this.childPasses.push(new s.CustomPass(this.viewer,this,{})),this.childPasses.push(new s.CustomPass(this.viewer,this,{opacity:s.Opacity.TRANSPARENT}));for(let e=0;e<s.RenderOrderPriority.COUNT;++e)this.childPasses.push(new s.CustomPass(this.viewer,this,{visibility:s.DrawPassVisibility.SHOWTHROUGH,priority:e}))}justBeforeDraw(e){super.justBeforeDraw(e);const t=this.viewer.getGlContext();t.enable(t.BLEND),t.blendFuncSeparate(t.ONE,t.ONE,t.ONE,t.ONE),t.disable(t.DEPTH_TEST),e.getState().callGl("depthMask",!1);const i=e.getActiveShader(),s=this.viewer.getReferenceHighlights().highlights[this.highlightType];i.uniform1f("uActiveHighlightIndex",s.index)}isHighlightPass(){return!0}getActiveHighlightType(){return this.highlightType}needsAttribute(e){const t=e===s.AttributeNames.HIGHLIGHT_ID;return this.parentPass?t||this.parentPass.needsAttribute(e):t}setSceneGraph(e){this.scenegraph=e}getSceneGraph(){return this.scenegraph}}t.FaceHighlightBufferPass=n;class r extends s.BufferedPass{constructor(e,t,i){super(e,{id:"highlightMask"}),this.highlightType=t,this.shaderTag="highlightMask",this.childPasses=[],this.clearColor=[255,255,255,255],this.opaqueFacePass=new s.CustomPass(this.viewer,this,{shaderTagSuffix:i?s.NO_SECTION_SHADER_ID_SUFFIX:""}),this.childPasses.push(this.opaqueFacePass)}justBeforeDraw(e){const t=e.getActiveShader(),i=this.viewer.getReferenceHighlights().highlights[this.highlightType];t.uniform1f("uActiveHighlightIndex",i.index)}setSceneGraph(e){for(let t=0;t<this.childPasses.length;t++)this.childPasses[t].setSceneGraph(e)}needsAttribute(e){const t=e===s.AttributeNames.HIGHLIGHT_ID;return this.parentPass?t||this.parentPass.needsAttribute(e):t}getActiveHighlightType(){return this.highlightType}}t.FaceHighlightMaskPass=r},690342:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.HudPass=t.HudModelPass=void 0;const s=i(114924);class n extends s.DrawPass{constructor(e,t){super(e,t),this.previousModelViewMatrix=null,this.previousProjectionMatrix=null;const i=new s.FaceEdgePointPass(this.viewer,this,{opacity:s.Opacity.ALL});this.childPasses=[i]}getSceneGraph(){return this.viewer.getSceneGraphs().getHudModelSceneGraph()}preDraw(e){return this.previousModelViewMatrix=e.getModelViewMatrix(),this.previousProjectionMatrix=e.getProjectionMatrix(),e.popProjectionMatrix(),e.popModelViewMatrix(),!0}postDraw(e){e.pushModelViewMatrix(this.previousModelViewMatrix),e.pushProjectionMatrix(this.previousProjectionMatrix)}}t.HudModelPass=n;class r extends s.DrawPass{constructor(e,t){let i;super(e,t);const r=new s.DefaultPasses(this.viewer,this,null,s.DefaultPassUsage.HUD,!0);for(this.childPasses=[],this.childPasses.push(r.opaqueFaces),this.childPasses.push(new n(this.viewer,this)),this.childPasses.push(r.nonOitTransparentFaces),this.childPasses.push(r.opaqueEdges),this.childPasses.push(r.opaquePoints),i=0;i<this.childPasses.length;++i){const e=this.childPasses[i];e instanceof s.CustomPass&&(e.clipToSectionPlanes=!1)}this.childPasses.push(r.showThroughStencilTested),this.childPasses.push(r.showThroughNotStencilTested)}getSceneGraph(){return this.viewer.getSceneGraphs().getHudSceneGraph()}preDraw(e){const t=this.viewer.getGlContext();t.clear(t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);const i=this.isPickPass()&&this.parentPass&&this.parentPass.oldViewport&&this.parentPass.pickRect;let n,r,a,o,c=i?this.parentPass.oldViewport:e.getViewport();const l=e.getActiveCamera(),h=l.getTileViewport();let d;i?d=this.parentPass.pickRect:h&&(d=h,c=l.getViewport(!0)),d?(n=d[0],r=d[0]+d[2],a=c[3]-(d[1]+d[3]),o=c[3]-d[1]):(n=c[0],r=c[0]+c[2],a=c[1],o=c[1]+c[3]);const u=(0,s.getHudLayerDepthRange)(c),g=new s.OrthographicCamera({eye:[0,0,0],direction:[0,0,-1],up:[0,1,0],left:n,right:r,bottom:a,top:o,near:u[0],far:u[1]});return e.pushModelViewMatrix(g.getViewMatrix()),e.pushProjectionMatrix(g.getProjectionMatrix()),!0}postDraw(e){e.popProjectionMatrix(),e.popModelViewMatrix()}}t.HudPass=r},538945:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GhostParentPass=t.IsolateContextPass=t.getTransparencyTransition=t.setTransparencyTransition=void 0;const s=i(114924),n=i(545348),r=i(606544),a=i(193786);let o=0;t.setTransparencyTransition=function(e){o=e},t.getTransparencyTransition=function(){return o};const c=n.default.getManager(),l="uIsolateContextOpacity",h=c.getNumber("ISOLATE_CONTEXT_FACE_TRANSPARENCY"),d=c.getNumber("ISOLATE_CONTEXT_EDGE_TRANSPARENCY");class u extends s.DefaultPasses{constructor(e,t,i,n){super(e,t,i,n,!1);const r=function(e){(0,s.clearStencilBufferBit)(e.viewer.getGlContext(),s.StencilRefMask.FACES),s.CustomPass.prototype.postDraw.apply(this,arguments)};this.depthFaces.postDraw=r,this.depthFaces.opacity=s.Opacity.ALL,this.depthEdges.forDepth=!0,this.depthEdges.postDraw=function(e){(0,s.clearStencilBufferBit)(e.viewer.getGlContext(),s.StencilRefMask.EDGES),s.CustomPass.prototype.postDraw.apply(this,arguments)},this.depthEdges.opacity=s.Opacity.ALL,this.sectionPlaneEndcap.childPasses.forEach((e=>{e.forDepthTesting=!0,e.shaderTag="endcap-depth"})),this.opaqueFaces=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.ALL,depthTestMode:s.DepthTestMode.LEQUAL,performIsolationTest:!0,stencilMode:s.StencilMode.WRITE_AND_TEST_FACES,sceneGraph:i}),this.opaqueFaces.postDraw=r,this.decalPass=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.ALL,depthTestMode:s.DepthTestMode.LEQUAL,performIsolationTest:!0,sceneGraph:i}),this.decalPass.setExtraMeshNodeFilter(this.createOnlyDecalsFilter()),this.opaqueFacesZebraStripes=new s.CustomPass(this.viewer,this,{facesShader:s.FacesShadeMode.ZEBRA_STRIPES,performIsolationTest:!0,opacity:s.Opacity.ALL,depthTestMode:s.DepthTestMode.LEQUAL,extraShaderUniforms:[{name:"uStripeCount",value:c.getNumber("ZEBRA_STRIPE_COUNT")},{name:"uStripeRotation",value:c.getNumber("ZEBRA_STRIPE_ROTATION")},{name:"uFilterWidth",value:c.getNumber("ZEBRA_STRIPE_FILTER_WIDTH")},{name:"uRespectOrthographic",value:c.getNumber("ZEBRA_STRIPE_RESPECT_ORTHOGRAPHIC")}]});const a=function(e){const t=this.viewer.getGlContext();t.disable(t.BLEND),s.CustomPass.prototype.justBeforeDraw.apply(this,arguments)};this.opaqueFaces.justBeforeDraw=a,this.opaqueFacesZebraStripes.justBeforeDraw=a,this.sketchImageFaces.justAfterDraw=a}setFilters(){const e=this.getNodeOccurrenceFilter();if(e){this.depthFaces.setNodeOccurrenceFilterFunction(e),this.opaqueFaces.setNodeOccurrenceFilterFunction(e),this.decalPass.setNodeOccurrenceFilterFunction(e),this.opaqueFacesZebraStripes.setNodeOccurrenceFilterFunction(e),this.sketchImageFaces.setNodeOccurrenceFilterFunction(e),this.opaqueEdges.setNodeOccurrenceFilterFunction(e),this.transparentEdges.setNodeOccurrenceFilterFunction(e),this.opaquePoints.setNodeOccurrenceFilterFunction(e);for(let t=s.RenderOrderPriority.LOWER;t<=s.RenderOrderPriority.HIGHEST;++t)this.showThroughStencilTested.getChildPass(t).setNodeOccurrenceFilterFunction(e)}this.depthEdges.setNodeOccurrenceFilterFunction((e=>e.occurrenceData.getIsolated()));this.depthFaces.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilterNoDecals(!0))}preDraw(e){if(0===this.getTransparencyMultiplier())return!1;const t=this.getTransparencyMultiplier(),i=t*h*o+(1-o),n=Math.min(1,3*i);let r=t*d*o+(1-o);r=Math.sqrt(r),this.opaqueFaces.setShaderUniform(l,i),this.decalPass.setShaderUniform(l,i),this.opaqueFacesZebraStripes.setShaderUniform(l,i),this.sketchImageFaces.setShaderUniform(l,n),this.opaqueEdges.setShaderUniform(l,r),this.transparentEdges.setShaderUniform(l,r),this.opaquePoints.setShaderUniform(l,r);for(let e=s.RenderOrderPriority.LOWER;e<=s.RenderOrderPriority.HIGHEST;++e)this.showThroughStencilTested.getChildPass(e).setShaderUniform(l,i);return super.preDraw(e)}setRenderingMode(e){super.setRenderingMode(e),this.opaqueFaces.setOpacity(s.Opacity.ALL),this.depthFaces.setOpacity(s.Opacity.ALL),this.depthEdges.setOpacity(s.Opacity.ALL);this.opaqueFaces.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilterNoDecals(!0));const t=e!==r.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED&&e!==r.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE;this.decalPass.setEnabled(t)}setZebraStripeCount(e){this.opaqueFacesZebraStripes.setShaderUniform("uStripeCount",e)}setZebraStripeRotation(e){this.opaqueFacesZebraStripes.setShaderUniform("uStripeRotation",e)}}class g extends u{constructor(e,t,i,s){super(e,t,i,s),this.setFilters()}getNodeOccurrenceFilter(){const e=this.viewer.getModelViewManagers().getManager();return t=>{const i=t.occurrenceData.getOccurrenceId();return!e.isOccurrenceIdForInContext(i)}}getTransparencyMultiplier(){return this.viewer.getIsolatedOccurrenceManager().getIsIsolateFullyTransparent()?0:1}preDraw(e){const t=this.viewer.getModelViewManagers().getManager().getSimulationManager();return!!(this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode()||t&&t.isIsolateEffectActive()||null!==this.viewer.getInterferenceCallId()&&""!==this.viewer.getInterferenceCallId())&&super.preDraw(e)}}class p extends u{constructor(e,t,i,s,n){super(e,t,i,s),this.filterForInContext=n,this.setFilters()}getNodeOccurrenceFilter(){const e=this.viewer.getModelViewManagers().getManager();if(this.filterForInContext){return t=>{if(!e.isDisplayingIncontextAssembly())return!1;const i=t.occurrenceData.getOccurrenceId();return e.isOccurrenceIdForInContext(i)}}return t=>{if(!this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode())return!0;const i=t.occurrenceData;return e.isOccurrenceIdForInContext(i.getOccurrenceId())||i.getIsolated()}}getTransparencyMultiplier(){return this.viewer.getIsolatedOccurrenceManager().getContextTransparencyMultiplier()}preDraw(e){return!!(0,a.getActiveInContextNodeId)()&&super.preDraw(e)}}class m extends s.DrawPass{constructor(e,t,i,n){if(super(e,t),this.ghostedChildrenPasses=[],n=n||this.viewer.getSceneGraphs().getMainSceneGraph(),i){this.ghostedChildrenPasses.push(new p(this.viewer,this,n,s.DefaultPassUsage.ISOLATION,!1));if(n.isForPreview()){const e=this.viewer.getSceneGraphs().getMainSceneGraph();this.ghostedChildrenPasses.push(new p(this.viewer,this,e,s.DefaultPassUsage.ISOLATION,!0))}}else this.ghostedChildrenPasses.push(new g(this.viewer,this,n,s.DefaultPassUsage.ISOLATION));this.childPasses=[],this.ghostedChildrenPasses.forEach((e=>{this.childPasses.push(e.depthFaces)})),this.ghostedChildrenPasses.forEach((e=>{this.childPasses.push(e.sectionPlaneEndcap)})),this.ghostedChildrenPasses.forEach((e=>{this.childPasses.push(e.depthEdges)})),this.ghostedChildrenPasses.forEach((e=>{this.addModelPasses(e)})),this.childPasses.push(new s.DepthClearPass(this.viewer,this)),this.ghostedChildrenPasses.forEach((e=>{this.addShowThroughPasses(e)})),this.setRenderingMode(r.GBTGraphicsRenderMode.SHADED_WITH_EDGES)}addModelPasses(e){this.childPasses.push(e.opaqueFaces),this.childPasses.push(e.decalPass),this.childPasses.push(e.opaqueFacesZebraStripes),this.childPasses.push(e.sketchImageFaces),this.childPasses.push(e.opaqueEdges),this.childPasses.push(e.transparentEdges),this.childPasses.push(e.opaquePoints)}addShowThroughPasses(e){for(let t=s.RenderOrderPriority.LOWER;t<=s.RenderOrderPriority.HIGHEST;++t)this.childPasses.push(e.showThroughStencilTested.getChildPass(t))}forIsolate(){return!1}preDraw(e){return!!this.ghostedChildrenPasses.reduce(((t,i)=>i.preDraw(e)||t),!1)&&super.preDraw(e)}setRenderingMode(e){e!==r.GBTGraphicsRenderMode.TRANSLUCENT&&e!==r.GBTGraphicsRenderMode.DRAFT_ANALYSIS||(e=r.GBTGraphicsRenderMode.SHADED_WITH_EDGES),this.ghostedChildrenPasses.forEach((t=>{t.setRenderingMode(e)}))}setHideSelectionInterior(e){this.ghostedChildrenPasses.forEach((t=>{t.setHideSelectionInterior(e)}))}setZebraStripeCount(e){this.ghostedChildrenPasses.forEach((t=>t.setZebraStripeCount(e)))}setZebraStripeRotation(e){this.ghostedChildrenPasses.forEach((t=>t.setZebraStripeRotation(e)))}}t.IsolateContextPass=m;class E extends s.DrawPass{constructor(e,t,i,n){super(e,t),this.isolateContextPass=new m(e,this,i,n);this.childBuffer=(0,s.makeBufferedPass)(this.viewer,this.isolateContextPass,1,"highlightBuffer"),this.childBuffer.clearColor=[1,1,1,0];const r=new s.BlitBufferedPass(this.viewer,this.childBuffer,{performDrawInputs:!0});this.childPasses=[r]}preDraw(e){return!!this.isolateContextPass.preDraw(e)&&super.preDraw(e)}setRenderingMode(e){this.isolateContextPass.setRenderingMode(e)}setHideSelectionInterior(e){this.isolateContextPass.setHideSelectionInterior(e)}setZebraStripeCount(e){this.isolateContextPass.setZebraStripeCount(e)}setZebraStripeRotation(e){this.isolateContextPass.setZebraStripeRotation(e)}}t.GhostParentPass=E},541067:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MainDrawPass=void 0;const s=i(545348),n=i(606544),r=i(114924),a=i(322012);class o extends r.DrawPass{constructor(e){super(e,null),this.shaderTag="draw",this.ssaoBufferPass=null,this.inferenceDisplayPasses=[],this.clearColor=[0,0,0,0],this.forceHideInteriorSelections=!1;const t=s.default.getManager();this.defaultPasses=new r.DefaultPasses(this.viewer,this,this.viewer.getSceneGraphs().getMainSceneGraph(),r.DefaultPassUsage.RENDERING),this.childPasses=[],this.childPasses.push(this.defaultPasses.opaqueFaces),this.childPasses.push(this.defaultPasses.opaqueFacesZebraStripes),this.childPasses.push(this.defaultPasses.draftAnalysisFaces),this.childPasses.push(this.defaultPasses.qualityVisualization),t.getNumber("AMBIENT_OCCLUSION_EFFECT_FACTOR")>0&&(0,r.isSSAOSupported)(e.getGlContext())&&(this.ssaoBufferPass=(0,r.makeSSAOPass)(this.viewer),this.defaultPasses.opaqueFaces.setInput("uOcclusionMap",this.ssaoBufferPass)),this.partPreviewPass=new r.PartPreviewPass(this.viewer,this),this.childPasses.push(this.partPreviewPass),this.partComparePass=new r.PartComparePass(this.viewer,this),this.childPasses.push(this.partComparePass),this.childPasses.push(this.defaultPasses.transparentFaces),this.defaultPasses.depthTransparentFaces.setEnabled(!1),this.childPasses.push(this.defaultPasses.depthTransparentFaces),this.childPasses.push(this.defaultPasses.sketchImageFaces),this.childPasses.push(this.defaultPasses.sectionPlaneEndcap),this.childPasses.push(this.defaultPasses.opaqueEdges),this.childPasses.push(this.defaultPasses.silhouettes);const i=new r.CustomPass(this.viewer,this,{primitiveType:r.Primitive.EDGES,stencilMode:r.StencilMode.OFF});this.childPasses.push(i),this.childPasses.push(this.defaultPasses.transparentEdges);const o=new r.LinePointAllHighlightsDrawPass(this.viewer,r.BTGraphicsUsage.BASE,!0);this.childPasses.push(o),this.childPasses.push(this.defaultPasses.isolatePass),this.defaultPasses.contextPass&&this.childPasses.push(this.defaultPasses.contextPass),this.childPasses.push(this.defaultPasses.opaquePoints);const c=new r.FaceAllHighlightsDrawPass(this.viewer,this,!1),l=new r.FaceAllHighlightsDrawPass(this.viewer,this,!0);this.faceHighlightDrawPass=new r.SwitchPass(this.viewer,c,l,r.isSectionPlaneModeEnabled),this.childPasses.push(this.faceHighlightDrawPass),this.childPasses.push(new r.DepthClearPass(this.viewer,this));for(let e=r.RenderOrderPriority.LOWER;e<=r.RenderOrderPriority.DEFAULT;++e)this.childPasses.push(this.defaultPasses.showThroughStencilTested.getChildPass(e)),this.childPasses.push(this.defaultPasses.showThroughNotStencilTested.getChildPass(e)),this.childPasses.push(this.defaultPasses.showThroughDepthTested.getChildPass(e));this.linePointAllHighlightsDrawPass=new r.LinePointAllHighlightsDrawPass(this.viewer,r.BTGraphicsUsage.BASE,!1),this.childPasses.push(this.linePointAllHighlightsDrawPass);for(let e=r.RenderOrderPriority.HIGHER;e<=r.RenderOrderPriority.HIGHEST;++e)this.childPasses.push(this.defaultPasses.showThroughStencilTested.getChildPass(e)),this.childPasses.push(this.defaultPasses.showThroughNotStencilTested.getChildPass(e)),this.childPasses.push(this.defaultPasses.showThroughDepthTested.getChildPass(e));if(this.childPasses.push(new r.HudPass(this.viewer,this)),this.visualizeBodyCheckPass=new r.BlitBufferedPass(this.viewer,this.viewer.bodyCheckPass,{viewport:[0,0,r.BodyCheckPass.TEST_VIEWPORT_WIDTH,r.BodyCheckPass.TEST_VIEWPORT_HEIGHT]}),this.visualizeBodyCheckPass.setEnabled(!1),this.childPasses.push(this.visualizeBodyCheckPass),this.visualizeFullScreenBodyCheckPass=new r.BlitBufferedPass(this.viewer,new r.BodyCheckPass(e,!0),{shaderTag:"blitBodyCheck",performDrawInputs:!0}),this.visualizeFullScreenBodyCheckPass.setEnabled(!1),this.childPasses.push(this.visualizeFullScreenBodyCheckPass),this.debugDrawPickPass=new r.DebugPickPass(this.viewer),this.debugDrawPickPass.setEnabled(!1),this.childPasses.push(this.debugDrawPickPass),0!==t.getNumber("DISPLAY_INFERENCE_BUFFER")){const e=new r.CustomPass(this.viewer,this,{primitiveType:r.Primitive.EDGES,visibility:r.DrawPassVisibility.SHOWTHROUGH,priority:r.RenderOrderPriority.LOWER,disableDepthTest:!0});e.setEnabled(!1);const t=new r.CustomPass(this.viewer,this,{primitiveType:r.Primitive.POINTS,visibility:r.DrawPassVisibility.SHOWTHROUGH,priority:r.RenderOrderPriority.DEFAULT,disableDepthTest:!0});t.setEnabled(!1);const i=new r.CustomPass(this.viewer,this,{primitiveType:r.Primitive.POINTS,visibility:r.DrawPassVisibility.SHOWTHROUGH,priority:r.RenderOrderPriority.HIGHER,disableDepthTest:!0});i.setEnabled(!1),this.childPasses.push(e),this.childPasses.push(t),this.childPasses.push(i),this.inferenceDisplayPasses.push(e),this.inferenceDisplayPasses.push(t),this.inferenceDisplayPasses.push(i)}this.setRenderingMode(n.GBTGraphicsRenderMode.SHADED_WITH_EDGES),this.previewStateChangeSubscription=(0,r.getEditState)().stateChangedObservable.pipe((0,a.filter)((e=>e===r.Events.PREVIEW_STATE_CHANGE))).subscribe((()=>this.onPreviewStateChange())),this.previewBlendChangeSubscription=(0,r.getEditState)().stateChangedObservable.pipe((0,a.filter)((e=>e===r.Events.PREVIEW_BLEND_CHANGE))).subscribe((()=>this.updateHideInteriorSelections())),this.onPreviewStateChange(),this.listenTo(this.viewer.getEventDispatcher(),r.SESSION_ENDED,this.onSessionEnded)}onSessionEnded(){this.previewStateChangeSubscription.unsubscribe(),this.previewBlendChangeSubscription.unsubscribe(),super.onSessionEnded()}setClearColor(e,t,i,s){this.clearColor=[e,t,i,s]}getClearColor(){return this.clearColor.slice()}onPreviewStateChange(){this.partPreviewPass.setEnabled((0,r.isUsagePreview)()),this.partComparePass.setEnabled((0,r.isUsageCompare)()),(0,r.isUsageCompare)()?(this.faceHighlightDrawPass.setEnabled(!1),this.linePointAllHighlightsDrawPass.setEnabled(!1)):(this.faceHighlightDrawPass.setEnabled(!0),this.linePointAllHighlightsDrawPass.setEnabled(!0)),!(0,r.isUsageBase)()&&this.viewer.getSupportsPreview()?(this.defaultPasses.setBlendFilter(r.BlendFilter.NON_BLEND_ONLY),(0,r.isUsagePreviewFinal)()&&this.defaultPasses.transparentFaces.setEnabled(!1),this.defaultPasses.sectionPlaneEndcap.setEnabled(!1),this.defaultPasses.isolatePass.setEnabled(!1),this.defaultPasses.contextPass&&this.defaultPasses.contextPass.setEnabled(!1)):(this.defaultPasses.setBlendFilter(r.BlendFilter.ALL),this.defaultPasses.transparentFaces.setEnabled(!0),this.defaultPasses.sectionPlaneEndcap.setEnabled(!0),this.defaultPasses.isolatePass.setEnabled(!0),this.defaultPasses.contextPass&&this.defaultPasses.contextPass.setEnabled(!0)),this.updateHideInteriorSelections(),this.viewer.requestDraw()}get sectionPlaneEndcapMaskPass(){return this.defaultPasses.sectionPlaneEndcapMask}get draftAnalysisPass(){return this.defaultPasses.draftAnalysisFaces}setForceHideInteriorSelections(e){this.forceHideInteriorSelections=e,this.updateHideInteriorSelections()}updateHideInteriorSelections(){const e=(0,r.isUsagePreviewAfter)();let t=s.default.getManager().getNumber("DEFAULT_INTERIOR_HIGHLIGHT_OVERLAY_OPACITY");this.forceHideInteriorSelections?this.setHideSelectionInterior(!0):e?(this.defaultPasses.setHideSelectionInterior(!0),this.faceHighlightDrawPass.setHideSelectionInterior(!1),this.partPreviewPass.setHideSelectionInterior(!0),t=s.default.getManager().getNumber("PREVIEW_INTERIOR_HIGHLIGHT_OVERLAY_OPACITY")):this.setHideSelectionInterior(!1),this.faceHighlightDrawPass.pass1.setInteriorHighlightOpacity(t),this.faceHighlightDrawPass.pass2.setInteriorHighlightOpacity(t)}setHideSelectionInterior(e){this.defaultPasses.setHideSelectionInterior(e),this.faceHighlightDrawPass.setHideSelectionInterior(e),this.partPreviewPass.setHideSelectionInterior(e)}visualizeInferenceSceneGraph(e){for(let t=0;t<this.inferenceDisplayPasses.length;++t)this.inferenceDisplayPasses[t].setEnabled(!!e),this.inferenceDisplayPasses[t].setSceneGraph(e)}setRenderingMode(e){this.defaultPasses.setRenderingMode(e),this.partPreviewPass.setRenderingMode(e),this.partComparePass.setRenderingMode(e)}drawInputs(e){this.ssaoBufferPass&&this.ssaoBufferPass.setEnabled(e.getDetailSettings().enableSSAO),super.drawInputs(e)}preDraw(e){if(this.viewer.getXrController().getIsXrRunning())return!0;const t=this.viewer.getGlContext();return t.stencilMask(255),t.clearStencil(0),t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[1],this.clearColor[2]),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),!0}nodeFilter(e){return e.isMeshNode()||e.getIsVisible()}setDraftAnalysisPullDirection(e){this.defaultPasses.draftAnalysisFaces.setPullDirection(e),this.partPreviewPass.setDraftAnalysisPullDirection(e)}setDraftAnalysisMinimumAngle(e){this.defaultPasses.draftAnalysisFaces.setMinimumAngle(e),this.partPreviewPass.setDraftAnalysisMinimumAngle(e)}setDraftAnalysisParts(e){this.defaultPasses.draftAnalysisFaces.setParts(e),this.partPreviewPass.setDraftAnalysisParts(e)}setDraftAnalysisShowUndercut(e){this.defaultPasses.draftAnalysisFaces.setShowUndercut(e),this.partPreviewPass.setDraftAnalysisShowUndercut(e)}getDebugDrawPickPass(){return this.debugDrawPickPass}setZebraStripeCount(e){this.defaultPasses.setZebraStripeCount(e),this.partComparePass.setZebraStripeCount(e),this.partPreviewPass.setZebraStripeCount(e)}setZebraStripeRotation(e){this.defaultPasses.setZebraStripeRotation(e),this.partComparePass.setZebraStripeRotation(e),this.partPreviewPass.setZebraStripeRotation(e)}getSectionEndcapMaskPassForPicking(e){return(0,r.isUsagePreview)()?e?this.partPreviewPass.getPreviewEndcapMaskPass():this.partPreviewPass.getBaseEndcapMaskPass():(0,r.isUsageCompare)()?e?this.partComparePass.getPreviewEndcapMaskPass():this.partComparePass.getBaseEndcapMaskPass():this.sectionPlaneEndcapMaskPass}}t.MainDrawPass=o},37763:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.NormalDepthWithMaskPass=void 0;const s=i(114924);class n extends s.NormalDepthPass{constructor(e,t){super(e),this.shaderTag="normalDepthWithMask",this.tintedEdges=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES}),this.tintedEdges.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),this.tintedPoints=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.POINTS}),this.tintedPoints.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),this.childPasses.push(this.tintedEdges),this.childPasses.push(this.tintedPoints),t&&(this.inputs.uMask=t)}justBeforeDraw(e){const t=e.getActiveShader();if(this.inputs.uMask){t.useTexture("uMask",this.inputs.uMask.getColorTexture());const i=e.getViewport();t.uniform2f("uMaskWidthHeight",i[2],i[3]),t.uniform1f("uUseMask",1)}else t.uniform1f("uUseMask",0),t.useBlankTexture("uMask");super.justBeforeDraw(e)}nodeFilter(e){return!!e.isMeshNode()&&e.getIsVisible()}}t.NormalDepthWithMaskPass=n},81593:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.makeSSAOPass=t.FilterOcclusionPass=t.CalculateOcclusionPass=t.NormalDepthFilter=void 0;const s=i(114924),n=i(545348),r=i(788465),a=i(264292),o=i(613199),c=64,l=function(e){const t=new r.MersenneTwister(0),i=new Uint8Array(4096);for(let e=0;e<4096;++e)i[e]=Math.floor(256*t.random());const n=new s.TextureDefinition(e);return n.internalFormat=e.LUMINANCE,n.format=e.LUMINANCE,n.bytes=i,n.width=c,n.height=c,n.minificationFilter=e.LINEAR,n.magnificationFilter=e.LINEAR,n.wrapS=e.REPEAT,n.wrapT=e.REPEAT,n};class h extends s.BlitPass{constructor(e,t){super(e),this.shaderTag="normalDepthFilter",this.blendMode=s.BlitBlendMode.BLEND_OFF,this.inputs.uNormalDepthTexture=t}}t.NormalDepthFilter=h;class d extends s.BlitPass{constructor(e,t,i){super(e),this.shaderTag="occlusion",this.inputs.uNormalDepthTexture=i||t,this.normalDepthPass=t,this.filteredNormalDepthPass=i,this.randomTexture=new s.Texture(this.viewer,l)}drawInputs(e){const t=e.getDetailSettings();this.filteredNormalDepthPass&&t.enableSSAOFilter?this.inputs.uNormalDepthTexture=this.filteredNormalDepthPass:this.inputs.uNormalDepthTexture=this.normalDepthPass,s.BlitPass.prototype.drawInputs.call(this,e)}justBeforeDraw(e){const t=n.default.getManager();super.justBeforeDraw(e),this.shader.useTexture("uRandomTexture",this.randomTexture);const i=e.getViewport(),s=i[2],r=i[3],l=Math.sqrt(s*s+r*r);this.shader.uniform2fv("uRandomTextureScale",[(s-1)/c,(r-1)/c]);const h=o.mat4C.inverse(e.getProjectionMatrix(),a.mat4.create());h&&this.shader.uniformMatrix4fv("uPMatrixInv_fs",!1,h),this.shader.uniform1f("uIntensity",t.getNumber("AMBIENT_OCCLUSION_INTENSITY")),this.shader.uniform1f("uBias",t.getNumber("AMBIENT_OCCLUSION_BIAS")),this.shader.uniform1f("uScale",t.getNumber("AMBIENT_OCCLUSION_SCALE")),this.shader.uniform1f("uRadiusNear",Math.max(t.getNumber("AMBIENT_OCCLUSION_RADIUS_NEAR")*l,2)),this.shader.uniform1f("uRadiusFar",Math.max(t.getNumber("AMBIENT_OCCLUSION_RADIUS_FAR")*l,2))}}t.CalculateOcclusionPass=d;class u extends s.BlitPass{constructor(e,t){super(e),this.shaderTag="occlusionFilter",this.blendMode=s.BlitBlendMode.BLEND_OFF,this.inputs.uOcclusionMap=t}}t.FilterOcclusionPass=u,t.makeSSAOPass=function(e){const t=n.default.getManager(),i=(0,s.makeBufferedNormalDepthPass)(e,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoBuffer1");let r=null;if(e.isSSAOFilteringSupported()){const n=new h(e,i);r=(0,s.makeBufferedPass)(e,n,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoFilterBuffer")}const a=new d(e,i,r),o=(0,s.makeBufferedPass)(e,a,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoBuffer2"),c=new u(e,o);return(0,s.makeBufferedPass)(e,c,t.getNumber("AMBIENT_OCCLUSION_VIEWPORT_RATIO"),"ssaoBuffer1")}},64511:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.OITBufferPass=void 0;const s=i(114924);class n extends s.BufferedPass{constructor(e,t,i,n){super(e,{makeFrameBuffer:!1}),this.component=i,this.depthPass=n,this.sceneGraph=null,this.clearColor=[0,0,0,0],this.colorPass=new s.OITColorPass(this.viewer,i),this.childPasses=[this.depthPass,this.colorPass],this.component!==s.OITComponent.ACCUMULATION&&(this.clearColor=[1,1,1,1])}clearBuffer(e){const t=this.viewer.getGlContext();t.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),e&&e.getFrameId()===this.depthPass.getLastRenderedFrame()?t.clear(t.COLOR_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}appliesTranslucentAlphaToAll(e){this.colorPass.appliesTranslucentAlphaToAll(e)}setSceneGraph(e){this.colorPass.setSceneGraph(e),this.depthPass.setSceneGraph(e)}setBlendFilter(e){this.colorPass.setBlendFilter(e)}setDepthPassEnabled(e){this.depthPass.setEnabled(e)}setDepthOpacity(e){e===s.Opacity.ALL?this.depthPass.setExtraMeshNodeFilter(this.createExcludeForNonBodyFilter()):this.depthPass.setExtraMeshNodeFilter(null),this.depthPass.setOpacity(e)}setExtraMeshNodeFilter(e){this.colorPass.setExtraMeshNodeFilter(e)}setTintColor(e){this.colorPass.setTintColor(e)}setTintFactor(e){this.colorPass.setTintFactor(e)}setHideSelectionInterior(e){this.colorPass.setHideSelectionInterior(e)}setPerformIsolationTest(e){this.colorPass.performIsolationTest=e}}t.OITBufferPass=n},931181:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.OITColorPass=void 0;const s=i(114924);class n extends s.DrawPass{constructor(e,t){super(e,null),this.component=t,this.applyTranslucentAlphaToAll=!1,this.sceneGraph=null,this.tintColor=[1,1,1],this.tintFactor=0,this.performIsolationTest=!1,this.shaderTag="OIT"+t,this.blendFilter=s.BlendFilter.ALL}usesShader(){return!0}preDraw(e){this.initializeShader();const t=this.viewer.getGlContext();e.setMaterial(),e.activateShader(this.shader);const i=this;return e.nodeFilter=function(e){if(e.getIsShowThrough()||!e.getIsDepthTested())return!1;if(i.blendFilter===s.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(i.blendFilter===s.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;return!(!i.applyTranslucentAlphaToAll||!e.isFaces())||!(i.extraMeshNodeFilter&&!i.extraMeshNodeFilter(e))&&!(!e.isFaces()||!e.hasTransparency())},e.getState().callGl("depthMask",!1),this.component===s.OITComponent.ACCUMULATION?t.blendFunc(t.ONE,t.ONE):t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_ALPHA),this.applyTranslucentAlphaToAll?t.disable(t.DEPTH_TEST):t.enable(t.DEPTH_TEST),t.enable(t.BLEND),!0}onShaderActivated(e,t){if((0,s.updateShaderClippingUniforms)(this.viewer,!0),t.uniform1i("uApplyTranslucentAlphaToAll",this.applyTranslucentAlphaToAll?1:0),t.uniform1i("uHideSelectionInterior",this.hideSelectionInterior?1:0),t.uniform1f("uTintFactor",this.tintFactor),t.uniform3fv("uTintColor",this.tintColor),this.testIsolation(e)?t.uniform1f("uIsolationSelector",this.forIsolate()?1:0):t.uniform1f("uIsolationSelector",-1),this.component===s.OITComponent.ACCUMULATION){const e=this.viewer.getResources().getHighlightTexture();t.useTexture("uHighlightColorTexture",e),t.uniform1f("uHighlightColorTextureWidth",this.viewer.getReferenceHighlights().getHighlightTextureWidth())}}appliesTranslucentAlphaToAll(e){this.applyTranslucentAlphaToAll=e}setSceneGraph(e){this.sceneGraph=e}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}setBlendFilter(e){this.blendFilter=e}setExtraMeshNodeFilter(e){this.extraMeshNodeFilter=e}setTintColor(e){this.tintColor=e}setTintFactor(e){this.tintFactor=e}testIsolation(e){return this.performIsolationTest&&e.getHasIsolate()}}t.OITColorPass=n},767024:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.OITCompositePass=void 0;const s=i(114924);class n extends s.BlitPass{constructor(e,t,i,s,n){super(e),this.shaderTag="OITComposite",this.inputs.uAccumulationBuffer=t,this.inputs.uRevealageBuffer=i,this.sceneGraph=s;const r=this.viewer.getGlContext(),a={id:"transparency",storageType:r.DEPTH_COMPONENT16,attachmentType:r.DEPTH_ATTACHMENT};n=n||"";const o=this.viewer.getOrCreateFrameBuffer(this.viewer.getDefaultFloatTextureType(),n+"TranslucentBufferAccumulation",a),c=this.viewer.getOrCreateFrameBuffer(r.UNSIGNED_BYTE,n+"TranslucentBufferRevealage",a);this.inputs.uAccumulationBuffer.setFrameBuffer(o),this.inputs.uRevealageBuffer.setFrameBuffer(c)}setSceneGraph(e){this.sceneGraph=e}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}}t.OITCompositePass=n},343110:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartComparePass=void 0;const s=i(114924),n=i(545348),r=i(322012),a=n.default.getManager(),o=(s.DefaultPasses,s.Opacity),c=s.Primitive,l=function(e,t,i,n,r,a){const o=new s.TranslucentPass(e,t,i,a);return o.setTintColor(n),o.setTintFactor(r),o};class h extends s.PartStudioBlendPass{constructor(e,t){super(e,t),this.overBlendColorNeedsUpdate=!0;const i=this.viewer.getSceneGraphs().getPreviewSceneGraph(),n=a.getColor("COMPARE_BASE_TINT").slice(0,3),h=a.getColor("COMPARE_TARGET_TINT").slice(0,3),d=a.getColor("COMPARE_SAME_LIT_TINT").slice(0,3),u=a.getColor("COMPARE_SAME_UNLIT_TINT").slice(0,3);this.underDepthPass=(0,s.makeBufferedNormalDepthWithMaskPass)(this.viewer,null,1),this.existsInBothDepthPass=(0,s.makeBufferedNormalDepthWithMaskPass)(this.viewer,this.underDepthPass,1),this.underPlaneIdPass=(0,s.makeBufferedPass)(this.viewer,new s.PlaneIdPass(this.viewer,this,null),1),this.existsInBothPlaneIdPass=(0,s.makeBufferedPass)(this.viewer,new s.PlaneIdPass(this.viewer,this,this.underPlaneIdPass),1),this.baseDefaultPasses.opaqueFaces=new s.TintedPass(this.viewer,this,{},n,d,this.existsInBothDepthPass),this.compareDefaultPasses.opaqueFaces=new s.TintedPass(this.viewer,this,{sceneGraph:i},h,d,this.existsInBothDepthPass),this.viewer.supportsOrderIndependentTranslucency()&&(this.baseDefaultPasses.transparentFaces=l(this.viewer,this,null,n,1,"CompareBase"),this.compareDefaultPasses.transparentFaces=l(this.viewer,this,i,h,1,"CompareTarget")),this.baseDefaultPasses.opaqueEdges.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),this.compareDefaultPasses.opaqueEdges.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),this.baseDefaultPasses.opaquePoints.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),this.compareDefaultPasses.opaquePoints.setExtraMeshNodeFilter((function(e){return!e.getIsTintedByCompare()})),this.baseDefaultPasses.compareTransparentFaces=new s.TintedPass(this.viewer,this,{opacity:o.TRANSPARENT},n,u,this.existsInBothPlaneIdPass),this.compareDefaultPasses.compareTransparentFaces=new s.TintedPass(this.viewer,this,{sceneGraph:i,opacity:o.TRANSPARENT},h,u,this.existsInBothPlaneIdPass),this.baseDefaultPasses.compareTintedEdges=new s.TintedPass(this.viewer,this,{primitiveType:c.EDGES},n,u,this.existsInBothDepthPass),this.baseDefaultPasses.compareTintedPoints=new s.TintedPass(this.viewer,this,{primitiveType:c.POINTS},n,u,this.existsInBothDepthPass),this.compareDefaultPasses.compareTintedEdges=new s.TintedPass(this.viewer,this,{sceneGraph:i,primitiveType:c.EDGES},h,u,this.existsInBothDepthPass),this.compareDefaultPasses.compareTintedPoints=new s.TintedPass(this.viewer,this,{sceneGraph:i,primitiveType:c.POINTS},h,u,this.existsInBothDepthPass);const g=function(e,t,i,n){const r=[];let a;for(r.push(i.opaqueFaces),r.push(i.opaqueFacesZebraStripes),r.push(i.draftAnalysisFaces),r.push(i.qualityVisualization),r.push(i.transparentFaces),r.push(i.sketchImageFaces),r.push(i.compareTransparentFaces),r.push(i.opaqueEdges),r.push(i.silhouettes),r.push(i.compareTintedEdges),r.push(new s.FaceAllHighlightsDrawPass(e,t,!1,n)),r.push(i.opaquePoints),r.push(i.compareTintedPoints),r.push(new s.LinePointAllHighlightsDrawPass(e,n,!0)),r.push(new s.DepthClearPass(e,t)),a=0;a<=s.RenderOrderPriority.DEFAULT;++a)r.push(i.showThroughNotStencilTested.getChildPass(a)),r.push(i.showThroughDepthTested.getChildPass(a));for(r.push(new s.LinePointAllHighlightsDrawPass(e,n,!1)),a=s.RenderOrderPriority.HIGHER;a<=s.RenderOrderPriority.HIGHEST;++a)r.push(i.showThroughNotStencilTested.getChildPass(a)),r.push(i.showThroughDepthTested.getChildPass(a));return i.showThroughNotStencilTested.setBlendFilter(s.BlendFilter.BLEND_ONLY),i.showThroughDepthTested.setBlendFilter(s.BlendFilter.BLEND_ONLY),r};this.underBasePass=new s.DrawPass(this.viewer,this),this.underBasePass.childPasses=g(this.viewer,this.underBasePass,this.baseDefaultPasses,s.BTGraphicsUsage.BASE),this.underComparePass=new s.DrawPass(this.viewer,this),this.underComparePass.childPasses=g(this.viewer,this.underComparePass,this.compareDefaultPasses,s.BTGraphicsUsage.PREVIEW),this.overBufferPass=new s.BufferedPass(this.viewer),this.overBufferPass.clearColor=[1,1,1,1],this.overBufferPass.childPasses=[];for(let e=0;e<this.underBasePass.childPasses.length;++e)this.overBufferPass.childPasses.push(this.underBasePass.childPasses[e]),this.overBufferPass.childPasses.push(this.underComparePass.childPasses[e]);this.compareBlendPass=new s.CompareBlendPass(this.viewer,this.overBufferPass),this.previewBlendChangedSubscription=(0,s.getEditState)().stateChangedObservable.pipe((0,r.filter)((e=>e===s.Events.PREVIEW_BLEND_CHANGE))).subscribe((()=>this.onStateChange())),this.listenTo(this.viewer.getEventDispatcher(),s.SESSION_ENDED,this.onSessionEnded),this.setBlendFilters()}onSessionEnded(){this.previewBlendChangedSubscription.unsubscribe(),super.onSessionEnded()}onStateChange(){this.enabled&&(0,s.requestDraw)()}drawInputs(e){let t;if((0,s.getPreviewAlpha)()<.5){for(t=0;t<this.underDepthPass.childPasses.length;++t)this.underDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph()),this.existsInBothDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph());this.underPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph()),this.existsInBothPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.childPasses=[this.underBasePass,this.compareBlendPass]}else{for(t=0;t<this.underDepthPass.childPasses.length;++t)this.underDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.existsInBothDepthPass.childPasses[t].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph());this.underPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getPreviewSceneGraph()),this.existsInBothPlaneIdPass.childPasses[0].setSceneGraph(this.viewer.getSceneGraphs().getMainSceneGraph()),this.childPasses=[this.underComparePass,this.compareBlendPass]}s.DrawPass.prototype.drawInputs.call(this,e)}setZebraStripeCount(e){this.baseDefaultPasses.setZebraStripeCount(e),this.compareDefaultPasses.setZebraStripeCount(e)}setZebraStripeRotation(e){this.baseDefaultPasses.setZebraStripeRotation(e),this.compareDefaultPasses.setZebraStripeRotation(e)}preDraw(e){if(this.overBlendColorNeedsUpdate){const e=this.viewer.$el.css("background-color");this.overBufferPass.clearColor=n.default.getManager().parseColor(e),this.overBlendColorNeedsUpdate=!1}return super.preDraw(e)}}t.PartComparePass=h},770392:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartPreviewPass=void 0;const s=i(114924);class n extends s.PartStudioBlendPass{constructor(e,t){super(e,t);const i=[0,0,0,0];this.baseBufferPass=new s.BufferedPass(this.viewer),this.compareBufferPass=new s.BufferedPass(this.viewer),this.baseBufferPass.clearColor=i,this.compareBufferPass.clearColor=i;const n=new Set;n.add(s.HighlightType.FILTERED_ENTITIES);const r=(e,t,i)=>{const r=[this.nonEditedFaceDepthPass,this.nonEditedEdgeDepthPass,t.opaqueFaces,t.opaqueFacesZebraStripes,t.draftAnalysisFaces,t.qualityVisualization,t.transparentFaces,t.depthTransparentFaces,t.sketchImageFaces,t.sectionPlaneEndcap,t.opaqueEdges,t.silhouettes,t.transparentEdges,t.opaquePoints,t.isolatePass];t.contextPass&&r.push(t.contextPass),r.push(new s.FaceAllHighlightsDrawPass(e,null,!1,i,n)),r.push(new s.LinePointAllHighlightsDrawPass(e,i,!0,n)),r.push(new s.DepthClearPass(e,this));for(let e=0;e<s.RenderOrderPriority.COUNT;++e)r.push(t.showThroughStencilTested.getChildPass(e)),r.push(t.showThroughNotStencilTested.getChildPass(e)),r.push(t.showThroughDepthTested.getChildPass(e));return r.push(new s.LinePointAllHighlightsDrawPass(e,i,!1,n)),r};this.baseBufferPass.childPasses=r(this.viewer,this.baseDefaultPasses,s.BTGraphicsUsage.BASE),this.compareBufferPass.childPasses=r(this.viewer,this.compareDefaultPasses,s.BTGraphicsUsage.PREVIEW),this.previewBlendPass=new s.PreviewBlendPass(this.viewer,this.baseBufferPass,this.compareBufferPass),this.setBlendFilters(),this.previewStateChangeSubscription=(0,s.getEditState)().stateChangedObservable.subscribe((()=>this.onStateChange())),this.listenTo(this.viewer.getEventDispatcher(),s.SESSION_ENDED,this.onSessionEnded),this.onStateChange()}onSessionEnded(){this.previewStateChangeSubscription.unsubscribe(),super.onSessionEnded()}onStateChange(){if(this.childPasses=[],!(0,s.isUsageBase)()&&!(0,s.isUsageCompare)())if((0,s.isUsagePreviewAfter)())this.pushOpaqueDepthPassWithAlpha(),this.childPasses.push(this.previewBlendPass);else for(let e=0;e<this.compareBufferPass.childPasses.length;++e){const t=this.compareBufferPass.childPasses[e];t!==this.nonEditedFaceDepthPass&&t!==this.nonEditedEdgeDepthPass&&this.childPasses.push(t)}this.viewer.requestDraw()}setDraftAnalysisPullDirection(e){this.baseDefaultPasses.draftAnalysisFaces.setPullDirection(e),this.compareDefaultPasses.draftAnalysisFaces.setPullDirection(e)}setDraftAnalysisMinimumAngle(e){this.baseDefaultPasses.draftAnalysisFaces.setMinimumAngle(e),this.compareDefaultPasses.draftAnalysisFaces.setMinimumAngle(e)}setDraftAnalysisParts(e){this.baseDefaultPasses.draftAnalysisFaces.setParts(e),this.compareDefaultPasses.draftAnalysisFaces.setParts(e)}setDraftAnalysisShowUndercut(e){this.baseDefaultPasses.draftAnalysisFaces.setShowUndercut(e),this.compareDefaultPasses.draftAnalysisFaces.setShowUndercut(e)}setZebraStripeCount(e){this.baseDefaultPasses.setZebraStripeCount(e),this.compareDefaultPasses.setZebraStripeCount(e)}setZebraStripeRotation(e){this.baseDefaultPasses.setZebraStripeRotation(e),this.compareDefaultPasses.setZebraStripeRotation(e)}}t.PartPreviewPass=n},301339:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioBlendPass=void 0;const s=i(114924),n=i(606544);class r extends s.DrawPass{constructor(e,t){super(e,t);const i=this.viewer.getSceneGraphs().getMainSceneGraph(),r=this.viewer.getSceneGraphs().getPreviewSceneGraph();this.baseDefaultPasses=new s.DefaultPasses(this.viewer,this,i,s.DefaultPassUsage.RENDERING),this.compareDefaultPasses=new s.DefaultPasses(this.viewer,this,r,s.DefaultPassUsage.RENDERING),this.baseDefaultPasses.depthTransparentFaces.setEnabled(!1),this.compareDefaultPasses.depthTransparentFaces.setEnabled(!1),this.nonEditedFaceDepthPass=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.FACES,disableColorWrites:!0}),this.nonEditedEdgeDepthPass=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,disableColorWrites:!0}),this.setRenderingMode(n.GBTGraphicsRenderMode.SHADED_WITH_EDGES)}setBlendFilters(){this.baseDefaultPasses.setBlendFilter(s.BlendFilter.BLEND_ONLY),this.compareDefaultPasses.setBlendFilter(s.BlendFilter.BLEND_ONLY),this.nonEditedFaceDepthPass.setBlendFilter(s.BlendFilter.NON_BLEND_ONLY),this.nonEditedEdgeDepthPass.setBlendFilter(s.BlendFilter.NON_BLEND_ONLY)}setHideSelectionInterior(e){this.baseDefaultPasses.setHideSelectionInterior(e),this.compareDefaultPasses.setHideSelectionInterior(e)}pushOpaqueDepthPassWithAlpha(){s.DefaultPasses;(0,s.getPreviewAlpha)()>.5?(this.childPasses.push(this.compareDefaultPasses.depthFaces),this.childPasses.push(this.compareDefaultPasses.sectionPlaneEndcap),this.childPasses.push(this.compareDefaultPasses.depthEdges)):(this.childPasses.push(this.baseDefaultPasses.depthFaces),this.childPasses.push(this.baseDefaultPasses.sectionPlaneEndcap),this.childPasses.push(this.baseDefaultPasses.depthEdges))}setRenderingMode(e){this.baseDefaultPasses.setRenderingMode(e),this.compareDefaultPasses.setRenderingMode(e)}getBaseEndcapMaskPass(){return this.baseDefaultPasses.sectionPlaneEndcapMask}getPreviewEndcapMaskPass(){return this.compareDefaultPasses.sectionPlaneEndcapMask}}t.PartStudioBlendPass=r},434278:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getBlendAmount=void 0;const s=i(114924);t.getBlendAmount=function(){const e=(0,s.getEditState)().previewAlpha;return e<.5?2*e:2*(1-e)}},229855:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PickAlternates=void 0;const s=i(114924);class n extends s.CustomPass{constructor(e,t,i){super(e,t,i),this.enabled=!1,this.shaderTag="alternates-"+this.shaderTag}usesShader(){return!0}preDraw(e){return this.initializeShader(),e.setPickPrimitiveAlternates(!0),super.preDraw(e)}postDraw(e){return e.setPickPrimitiveAlternates(!1),super.postDraw(e)}}t.PickAlternates=n},59779:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PickPass=void 0;const s=i(114924),n=i(545348),r=i(193786),a=i(606544),o=i(264292),c=i(613199),l=i(322012),h=n.default.getManager();class d extends s.BufferedPass{constructor(e,t){super(e),this.mainDrawPass=t,this.TEMP_VEC4=o.vec4.create(),this.TEMP_MAT4=o.mat4.create(),this.shaderTag="pick",this.checkFrameId=!1,this.pickBuffer=null,this.pickRect=[0,0,1,1],this.pickViewportWidthHeight=[1,1],this.enablePickViewportScaling=!0,this.oldViewport=[0,0,1,1],this.hitlist=[],this.isBoxSelecting=!1,this.suppressNonIsolatedPicks=!0,this.childrenPerformIsolationTest=null,this.childPassIsolateTests=[],this.nodeFilterOverride=null,this.pickFromPreview=!1,this.pickFrustum=new s.ViewFrustum;const i=new s.DefaultPasses(this.viewer,this,null,s.DefaultPassUsage.PICKING);this.opaqueFacePass=i.opaqueFaces,this.opaqueFaceAlternatePass=new s.PickAlternates(this.viewer,this,{performIsolationTest:!0}),this.previewStateChangeSubscription=(0,s.getEditState)().stateChangedObservable.pipe((0,l.filter)((e=>e===s.Events.PREVIEW_STATE_CHANGE))).subscribe((()=>this.onPreviewStateChange())),this.childPasses=[],this.childPasses.push(this.opaqueFacePass),this.childPasses.push(this.opaqueFaceAlternatePass),t&&(this.sectionPlaneEndcapDrawPasses=new s.SectionPlaneEndcapDrawPasses(this.viewer,this,t.sectionPlaneEndcapMaskPass),this.childPasses.push(this.sectionPlaneEndcapDrawPasses)),this.transparentFacePass=i.nonOitTransparentFaces,this.transparentFaceAlternatePass=new s.PickAlternates(this.viewer,this,{opacity:s.Opacity.TRANSPARENT,performIsolationTest:!0}),this.childPasses.push(this.transparentFacePass),this.childPasses.push(this.transparentFaceAlternatePass),this.childPasses.push(i.sketchImageFaces),this.postOpaqueFaceDepthClearPass=(0,s.makeDepthClearPass)(this.viewer,this),this.postOpaqueFaceDepthClearPass.setEnabled(!1),this.childPasses.push(this.postOpaqueFaceDepthClearPass),this.opaqueEdgesPass=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.EDGES,performIsolationTest:!0}),this.opaqueEdgesAlternatesPass=new s.PickAlternates(this.viewer,this,{primitiveType:s.Primitive.EDGES,performIsolationTest:!0}),this.childPasses.push(this.opaqueEdgesPass),this.childPasses.push(this.opaqueEdgesAlternatesPass),this.childPasses.push(i.transparentEdges),this.childPasses.push(new s.PickAlternates(this.viewer,this,{primitiveType:s.Primitive.EDGES,opacity:s.Opacity.TRANSPARENT,performIsolationTest:!0})),this.opaquePointsPass=i.opaquePoints,this.childPasses.push(this.opaquePointsPass),this.childPasses.push((0,s.makeDepthClearPass)(this.viewer,this));for(let e=0;e<s.RenderOrderPriority.COUNT;++e)this.childPasses.push(i.showThroughStencilTested.getChildPass(e)),this.childPasses.push(i.showThroughNotStencilTested.getChildPass(e)),this.childPasses.push(i.showThroughDepthTested.getChildPass(e));this.childPasses.push((0,s.buildHudPass)(this.viewer,this)),this.clearColor=s.PICK_CLEAR_COLOR;for(let e=0;e<this.childPasses.length;e++)this.childPassIsolateTests[e]=this.childPasses[e].getPerformIsolationTest();this.isolatedNodeOccurrenceFilter=e=>{if(e.occurrenceData.getIsolated()||!this.viewer.getIsolatedOccurrenceManager().isInIsolateMode()&&!this.viewer.getIsolatedOccurrenceManager().isInMakeTransparentMode()||this.viewer.getIsForFlattenedDisplay())return!0;const t=e.occurrenceData.getOccurrenceId();return t===s.PART_STUDIO_ELEMENT_ID||!(!this.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly()||!this.viewer.getModelViewManagers().getManager().isOccurrenceIdForInContext(t))}}onSessionEnded(){this.previewStateChangeSubscription.unsubscribe(),super.onSessionEnded()}setPickFromPreview(e){this.pickFromPreview!==e&&(this.pickFromPreview=e,this.onPreviewStateChange())}setPickAlternatesEnabled(e){for(let t=0;t<this.childPasses.length;++t)if(this.childPasses[t]instanceof s.PickAlternates)this.childPasses[t].setEnabled(e);else if(this.childPasses[t]instanceof s.FaceEdgePointPass)for(let i=0;i<this.childPasses[t].childPasses.length;++i)this.childPasses[t].childPasses[i]instanceof s.PickAlternates&&this.childPasses[t].childPasses[i].setEnabled(e)}setPerformIsolationTest(e){if(this.childrenPerformIsolationTest!==e)if(this.childrenPerformIsolationTest=e,this.childrenPerformIsolationTest)for(let e=0;e<this.childPasses.length;e++)this.childPasses[e].setPerformIsolationTest(this.childPassIsolateTests[e]);else for(let e=0;e<this.childPasses.length;e++)this.childPasses[e].setPerformIsolationTest(!1)}setSuppressNonIsolatedPicks(e){this.suppressNonIsolatedPicks=e}setIsBoxSelecting(e){this.isBoxSelecting=e}setRenderingMode(e){const t=this,i=function(e){e?(t.opaqueEdgesPass.setNodeFilter(null),t.opaqueEdgesAlternatesPass.setNodeFilter(null),t.opaquePointsPass.setNodeFilter(null)):(t.opaqueEdgesPass.setNodeFilter(s.hidePartNodesThatDoNotAddToBoundsFilter),t.opaqueEdgesAlternatesPass.setNodeFilter(s.hidePartNodesThatDoNotAddToBoundsFilter),t.opaquePointsPass.setNodeFilter(s.hidePartNodesThatDoNotAddToBoundsFilter))};switch(e){case a.GBTGraphicsRenderMode.SHADED_WITH_EDGES:case a.GBTGraphicsRenderMode.DRAFT_ANALYSIS:case a.GBTGraphicsRenderMode.SHADED_CURVATURE_VISUALIZATION:case a.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION:case a.GBTGraphicsRenderMode.SIMULATION_RESULTS:case a.GBTGraphicsRenderMode.SHADED_WITHOUT_EDGES:this.postOpaqueFaceDepthClearPass.setEnabled(!1),i(!0);break;case a.GBTGraphicsRenderMode.SHADED_WITH_HIDDEN_EDGES:this.postOpaqueFaceDepthClearPass.setEnabled(!0),i(!0);break;case a.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED:this.postOpaqueFaceDepthClearPass.setEnabled(!1),i(!0);break;case a.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE:case a.GBTGraphicsRenderMode.WIREFRAME:case a.GBTGraphicsRenderMode.TRANSLUCENT:this.postOpaqueFaceDepthClearPass.setEnabled(!0),i(!0)}}isPickPass(){return!0}setEnablePickViewportScaling(e){this.enablePickViewportScaling=e}getMaxHighResPickViewportSamples(){return h.getNumber("MAX_HIGH_RES_PICKING_RECT_SAMPLES")}setPickRect(e,t,i,s,n){this.pickRect=[e,t,i,s];const r=i*s;if(n&&r>n){const e=Math.sqrt(n/r),t=Math.floor((i-1)*e)+1,a=Math.floor((s-1)*e)+1;this.pickViewportWidthHeight=[t,a]}else if(this.enablePickViewportScaling&&r>this.getMaxHighResPickViewportSamples()){const e=h.getNumber("LOW_RES_PICKING_RECT_SCALE"),t=1/Math.min(i,s),n=Math.max(e,t),r=Math.floor((i-1)*n)+1,a=Math.floor((s-1)*n)+1;this.pickViewportWidthHeight=[r,a]}else this.pickViewportWidthHeight=[i,s]}getPickRect(){return this.pickRect}getPickViewportWidthHeight(){return this.pickViewportWidthHeight}getPickFrustum(e,t){const i=this.TEMP_VEC4;i[0]=this.pickRect[0]-t,i[1]=this.pickRect[1]-t,i[2]=this.pickRect[2]+2*t,i[3]=this.pickRect[3]+2*t;const n=(0,s.createPickMatrix)(i,e.getViewport(),e.getActiveCamera().getCanvasHeight()),r=c.mat4C.multiply(n,e.getProjectionMatrix(),this.TEMP_MAT4);return this.pickFrustum.updateClippingPlanes(e.getModelViewMatrix(),r),this.pickFrustum}preDraw(e){e.setNodeOccurrenceFilterFunction(this.isolatedNodeOccurrenceFilter);const t=this.getAllowedSelections(),i=this.suppressNonIsolatedPicks||!1===t.allowsNonModifiableGeometry;this.setPerformIsolationTest(i),this.oldViewport=e.getViewport();const n=(0,s.createPickMatrix)(this.pickRect,this.oldViewport,e.getActiveCamera().getCanvasHeight()),r=c.mat4C.multiply(n,e.getProjectionMatrix(),this.TEMP_MAT4);return e.pushProjectionMatrix(r),e.pushViewport([0,0,this.pickViewportWidthHeight[0],this.pickViewportWidthHeight[1]]),super.preDraw(e)}getAllowedSelections(){return this.isBoxSelecting?(0,r.getAllowedBoxSelections)():(0,r.getAllowedSelections)()}setNodeFilterOverride(e){this.nodeFilterOverride=e||null}nodeFilter(e){if(this.nodeFilterOverride)return this.nodeFilterOverride(e);const t=this.getAllowedSelections(),i=this.viewer.getModelViewManagers().getManagerForUsage(this.getUsage());if(t&&i.isNodeForModel(e)){const s=e.getParent();if(!1===t.allowsBodies&&!1===t.allowsSketchEntities&&i.isNodeForSketch(s))return!1;if(!1===t.allowsBodyEntities&&!1===t.allowsBodies&&i.isNodeForBody(s))return!1;if(e.isMeshNode()){if(!1===t.allowsBodies&&!1===t.allowsEdges&&i.isNodeForEdges(e))return!1;if(!1===t.allowsBodies&&!1===t.allowsVertices&&i.isNodeForPoints(e))return!1}}return e.getIsPickable()}postDraw(e){e.setNodeOccurrenceFilterFunction(null);const t=this.pickViewportWidthHeight[0]*this.pickViewportWidthHeight[1]*4;(!this.pickBuffer||this.pickBuffer.length<t)&&(this.pickBuffer=new Uint8Array(t));const i=this.viewer.getGlContext();i.readPixels(0,0,this.pickViewportWidthHeight[0],this.pickViewportWidthHeight[1],i.RGBA,i.UNSIGNED_BYTE,this.pickBuffer),this.hitlist=[];for(let e=0;e<t/4;e++){const t=4*e,i=(0,s.decodePickingIndex)(this.pickBuffer[t],this.pickBuffer[t+1],this.pickBuffer[t+2],this.pickBuffer[t+3]);this.hitlist.push(i)}e.popProjectionMatrix(),e.popViewport(),super.postDraw(e)}getPositionForPickHit(e){const t=this.pickRect[0],i=this.pickRect[1],s=this.pickRect[2],n=this.pickRect[3],r=s/this.pickViewportWidthHeight[0],a=n/this.pickViewportWidthHeight[1],c=e%this.pickViewportWidthHeight[0]*r,l=Math.floor(e/this.pickViewportWidthHeight[0])*a;return o.vec2.fromValues(t+c,i+(n-1-l))}getSceneGraph(){return this.pickFromPreview?this.viewer.getSceneGraphs().getPreviewSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()}getUsage(){return this.pickFromPreview?s.BTGraphicsUsage.PREVIEW:s.BTGraphicsUsage.BASE}onPreviewStateChange(){this.sectionPlaneEndcapDrawPasses&&this.sectionPlaneEndcapDrawPasses.setEndcapMaskPass(this.mainDrawPass.getSectionEndcapMaskPassForPicking(this.pickFromPreview))}}t.PickPass=d},897550:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PlaneIdPass=void 0;const s=i(114924);class n extends s.CustomPass{constructor(e,t,i){super(e,t,{opacity:s.Opacity.TRANSPARENT,blendMode:s.BlendMode.ADD}),this.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()})),i&&(this.inputs.uPlaneIdSetBuffer=i)}getShaderId(){return"-planeId-"+this.shaderTag}justBeforeDraw(e){super.justBeforeDraw(e);const t=e.getActiveShader();t.uniform1i("uDoSetTest",this.inputs.uPlaneIdSetBuffer?1:0),this.inputs.uPlaneIdSetBuffer?t.useTexture("uPlaneIdSetBuffer",this.inputs.uPlaneIdSetBuffer.getColorTexture()):t.useBlankTexture("uPlaneIdSetBuffer")}}t.PlaneIdPass=n},336431:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewBlendPass=void 0;const s=i(114924);class n extends s.BlitPass{constructor(e,t,i){super(e),this.shaderTag="previewBlend",this.inputs.uBaseTexture=t,this.inputs.uPreviewTexture=i,this.blendMode=s.BlitBlendMode.BLEND_ALPHA}justBeforeDraw(e){super.justBeforeDraw(e),this.shader.uniform1f("uPreviewAlpha",(0,s.getEditState)().previewAlpha)}}t.PreviewBlendPass=n},778363:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.QualityVisualizationPass=void 0;const s=i(114924);class n extends s.CustomPass{constructor(e,t,i,n){super(e,t,{facesShader:s.FacesShadeMode.QUALITY_VISUALIZATION,performIsolationTest:i}),this.setSceneGraph(n)}}t.QualityVisualizationPass=n},745312:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ScalarRetrievalPass=void 0;const s=i(114924);class n extends s.PickPass{constructor(e,t){super(e,null),this.managerNodeId=t,this.shaderTag="retrieveScalar",this.clearColor=[0,0,0,0],this.results=[];for(let e=0;e<this.childPasses.length;++e)this.childPasses[e].destroy();this.setNodeFilterOverride((e=>{const t=e.getParent();return 0===(t?t.getId():"").indexOf(this.managerNodeId)&&t.getIsVisible()}));const i=new s.CustomPass(this.viewer,this,{primitiveType:s.Primitive.FACES,performIsolationTest:!0});this.childPasses=[i]}draw(e){throw"Use retrieve method instead"}retrieve(e,t){return this.scalarRange=t,super.draw(e),this.results}postDraw(e){const t=this.pickRect[2]*this.pickRect[3]*4,i=new Uint8Array(t),n=this.viewer.getGlContext();n.readPixels(0,0,this.pickRect[2],this.pickRect[3],n.RGBA,n.UNSIGNED_BYTE,i),this.results=[];const r=this.viewer.isHighPrecisionSupportedInFragmentShader();for(let e=0;e<t/4;e++){const t=4*e,n=[i[t],i[t+1],i[t+2],i[t+3]];if(i[3]===this.clearColor[3])continue;const a=(0,s.decodeFloat)(n,r),o=this.scalarRange.scalarFromTextureCoordinate(a);this.results.push({canvasCoordinate:[this.pickRect[0]+e%this.pickRect[2],this.pickRect[1]+(this.pickRect[3]-Math.floor(e/this.pickRect[2]))],scalar:o})}super.postDraw(e)}}t.ScalarRetrievalPass=n},441150:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SectionPlaneEndcapMaskDrawPass=void 0;const s=i(114924);class n extends s.DrawPass{constructor(e,t,i){super(e,t),this.shaderTag="faces",this.sceneGraph=i}usesShader(){return!0}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}preDraw(e){this.initializeShader(),e.activateShader(this.shader);const t=this;return e.nodeFilter=function(e){return t.nodeFilter(e)},!0}onShaderActivated(e,t){(0,s.updateShaderClippingUniforms)(this.viewer,!0)}postDraw(e){}nodeFilter(e){return!(!(e.isMeshNode()&&e.getIsVisible()&&e.isFaces()&&!(0,s.isNodeForSurfaceBody)(e)&&e.getClippedBySectionPlanes())||(0,s.isNodeForDecal)(e))&&this.parentPass.nodeFilter(e)}needsFaceAppearances(){return!1}}t.SectionPlaneEndcapMaskDrawPass=n},128284:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SectionPlaneEndcapMaskPass=void 0;const s=i(193786),n=i(114924);class r extends n.BufferedPass{constructor(e,t){super(e),this.checkFrameId=!0,this.shaderTag="endcapMask",this.frameBuffer=null,this.childPasses=[],this.childPasses.push(new n.SectionPlaneEndcapMaskDrawPass(this.viewer,this,t));const i=this.viewer.getIsolatedOccurrenceManager();this.fullyTransparentGhostedNodeOccurrenceFilter=e=>{if(e.occurrenceData.getIsolated())return!0;return this.viewer.getModelViewManagers().getManager().isOccurrenceIdForInContext(e.occurrenceData.getOccurrenceId())?!(0===i.getContextTransparencyMultiplier()):!(i.isInIsolateOrMakeTransparentMode&&i.getIsIsolateFullyTransparent())}}shouldCheckSectionPlaneCount(){return!0}forSectionPlaneEndcapMask(){return!0}preDraw(e){if(!this.frameBuffer){const e=this.viewer.getGlContext();this.frameBuffer=this.viewer.getOrCreateFrameBuffer(this.viewer.getHighPrecisionFloatTextureType(),void 0,{storageType:e.DEPTH_STENCIL,attachmentType:e.DEPTH_STENCIL_ATTACHMENT})}if(this.shouldCheckSectionPlaneCount()&&0===(0,n.getSectionPlaneCount)())return!1;if(!super.preDraw(e))return!1;const t=this.viewer.getGlContext();t.disable(t.DEPTH_TEST),t.blendFunc(t.ONE,t.ONE),t.enable(t.BLEND),e.setOverrideFaceCullingMode(n.CullFace.NONE);const i=this.viewer.getIsolatedOccurrenceManager();return(i.isInIsolateOrMakeTransparentMode()&&i.getIsIsolateFullyTransparent()||(0,s.getActiveInContextNodeId)()&&0===i.getContextTransparencyMultiplier())&&e.setNodeOccurrenceFilterFunction(this.fullyTransparentGhostedNodeOccurrenceFilter),!0}postDraw(e){super.postDraw(e);const t=this.viewer.getGlContext();t.enable(t.DEPTH_TEST),t.disable(t.BLEND),e.clearOverrideFaceCullingMode(),e.setNodeOccurrenceFilterFunction(null)}}t.SectionPlaneEndcapMaskPass=r},439161:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeDetectAndBlurPass=t.SeparatedGaussianFilterBufferPass=t.EdgeDetectBufferPass=t.SeparatedGaussianFilterPass=t.DIRECTION=t.EdgeDetectPass=t.SectionPlaneEndcapDrawPasses=t.SectionPlaneEndcapDrawPass=void 0;const s=i(114924),n=i(264292);class r extends s.BlitPass{constructor(e,t,i,s,n){super(e),this.shaderTag="endcap",this.forDepthTesting=!1,this.parentPass=t,this.planeIndex=i,this.inputs.uEndcapMaskTexture=s,n&&(this.inputs.uEdgeDetectTexture=n)}setEndcapMaskPass(e){this.inputs.uEndcapMaskTexture=e}getEnabled(){return!!super.getEnabled()&&(0,s.getSectionPlaneCount)()>this.planeIndex}isFacingTheViewer(e){const t=e.getActiveCamera().getForward(),i=(0,s.getActiveSectionPlane)(this.planeIndex).normal;return n.vec3.dot(t,i)<0}preDraw(e){return!((0,s.getSectionPlaneCount)()<=this.planeIndex||this.isFacingTheViewer(e)||!this.inputs.uEndcapMaskTexture.getColorTexture())&&(!!super.preDraw(e)&&(e.setOverrideFaceCullingMode(s.CullFace.NONE),!0))}justBeforeDraw(e){super.justBeforeDraw(e);const t=this.viewer.getGlContext();this.inputs.uEdgeDetectTexture&&e.detailSettings.enableSectionPlaneEdgeDetection||this.shader.useBlankTexture("uEdgeDetectTexture"),this.shader.uniformMatrix4fv("uPMatrix",!1,e.getProjectionMatrix());const i=n.vec4.create();i[this.planeIndex]=1,this.shader.uniform4fv("uPlaneSelector",i);const r=e.getActiveCamera().getSceneBounds().diameter();this.shader.uniform1f("uSceneDiameter",r),(0,s.updateShaderClippingUniforms)(this.viewer,!0),(0,s.updateShaderEndcapUniforms)(e,this.planeIndex),this.isPickPass()?(this.shader.uniform4fv("uPickRect",this.parentPass.pickRect),this.shader.uniform2f("uPickRectScale",this.parentPass.pickRect[2]/this.parentPass.pickViewportWidthHeight[0],this.parentPass.pickRect[3]/this.parentPass.pickViewportWidthHeight[1]),this.shader.uniform2f("uMaskTextureDimensions",this.inputs.uEndcapMaskTexture.getWidth(),this.inputs.uEndcapMaskTexture.getHeight()),(0,s.updateShaderEndcapPickingUniforms)(e,this.planeIndex),t.disable(t.BLEND)):(0,s.updateShaderEndcapPatternUniforms)(e,this.planeIndex),t.enable(t.DEPTH_TEST)}draw(e){if(!this.enabled)return;if(e.setActivePass(this),!this.preDraw(e))return;this.justBeforeDraw(e);const t=this.viewer.getGlContext();this.isPickPass()||((0,s.setupStencilForWriteWithoutTest)(t,s.StencilRefValue.LOW_PRIORITY_EDGES,s.StencilRefMask.EDGES),this.forDepthTesting||this.shader.uniform1f("uDiscardPatternBackground",1),t.colorMask(!1,!1,!1,!1),e.getState().callGl("depthMask",!1),this.drawBlitNodes(e),t.colorMask(!0,!0,!0,!0),this.forDepthTesting||this.shader.uniform1f("uDiscardPatternBackground",0),t.disable(t.STENCIL_TEST)),e.getState().callGl("depthMask",!0),this.forDepthTesting&&t.colorMask(!1,!1,!1,!1),this.drawBlitNodes(e),this.justAfterDraw(e),this.postDraw(e)}postDraw(e){super.postDraw(e);const t=this.viewer.getGlContext();this.isPickPass()&&t.enable(t.BLEND),t.colorMask(!0,!0,!0,!0),e.clearOverrideFaceCullingMode()}}t.SectionPlaneEndcapDrawPass=r;class a extends s.DrawPass{constructor(e,t,i,s){super(e,t),this.childPasses=[new r(e,t,0,i,s),new r(e,t,1,i,s),new r(e,t,2,i,s),new r(e,t,3,i,s)]}setEndcapMaskPass(e){for(let t=0;t<this.childPasses.length;++t)this.childPasses[t].setEndcapMaskPass(e)}}t.SectionPlaneEndcapDrawPasses=a;class o extends s.BlitPass{constructor(e,t){super(e),this.shaderTag="edgeDetect",this.inputs.uSourceBuffer=t}justBeforeDraw(e){super.justBeforeDraw(e);const t=e.getViewport();this.shader.uniform2f("uPixelScale",1/t[2],1/t[3]),this.shader.uniform1f("uDoEdgeDetection",1)}}var c;t.EdgeDetectPass=o,function(e){e.X="X",e.Y="Y"}(c||(t.DIRECTION=c={}));class l extends s.BlitPass{constructor(e,t,i){super(e),this.direction=i,this.shaderTag="gaussianFilter",this.inputs.uSourceBuffer=t}justBeforeDraw(e){super.justBeforeDraw(e);const t=e.getViewport();this.shader.uniform2f("uPixelScale",1/t[2],1/t[3]),this.direction===c.X?this.shader.uniform2f("uDirection",1,0):this.shader.uniform2f("uDirection",0,1)}}t.SeparatedGaussianFilterPass=l;class h extends s.BufferedPass{constructor(e,t){super(e,{id:"edgeDetectAndBlurPassBufferA"}),this.childPasses=[new o(e,t)]}}t.EdgeDetectBufferPass=h;class d extends s.BufferedPass{constructor(e,t,i){super(e,{id:"edgeDetectAndBlurPassBufferB"}),this.childPasses=[new l(e,t,i)]}}t.SeparatedGaussianFilterBufferPass=d;class u extends s.BufferedPass{constructor(e,t){super(e,{id:"edgeDetectAndBlurPassBufferA"}),this.edgeDetect=new h(e,t),this.filterX=new d(e,this.edgeDetect,c.X),this.filterY=new l(e,this.filterX,c.Y),this.childPasses=[this.filterY]}preDraw(e){return!!e.detailSettings.enableSectionPlaneEdgeDetection&&super.preDraw(e)}}t.EdgeDetectAndBlurPass=u},820457:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SilhouettePass=t.BackFaceStencilPass=t.BackFaceSilhouettePass=void 0;const s=i(545348),n=i(368305),r=i(515785),a=i(114924),o=s.default.getManager();class c extends a.DrawPass{constructor(e,t,i,s){super(e,t),this.noSection=s,this.isBackFacePassEnabled=!0,this.blendFilter=a.BlendFilter.ALL,this.sceneGraph=i}usesShader(){return!0}getShaderId(){return"-backfacesil-faces"+(this.noSection?a.NO_SECTION_SHADER_ID_SUFFIX:"")}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}preDraw(e){if(this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances())return!1;this.initializeShader(),super.preDraw(e);const t=this.viewer.getGlContext();e.setOverrideFaceCullingMode(a.CullFace.FRONT),e.activateShader(this.shader);const i=this;return e.nodeFilter=function(e){return i.nodeFilter(e)},(0,a.updateShaderClippingUniforms)(this.viewer,!0),this.shader.uniform1f("uLineWidth",o.getNumber("DEFAULT_LINE_WIDTH")*o.getNumber("BACKFACE_SILHOUETTE_WIDTH_FACTOR")),this.shader.uniform4fv("uLineColor",o.getColor("LINE_POINT_COLOR")),this.shader.uniform1f("uSceneDiameter",e.getActiveCamera().getSceneBounds().diameter()),(0,a.setupStencilForTestWithoutWrite)(t,a.StencilRefValue.LOW_PRIORITY_EDGES,a.StencilRefMask.EDGES),!0}postDraw(e){super.postDraw(e);const t=this.viewer.getGlContext();e.clearOverrideFaceCullingMode(),t.disable(t.STENCIL_TEST)}nodeFilter(e){const t=this.viewer.getModelViewManagers().getManager(),i=e.getParent();if(this.blendFilter===a.BlendFilter.BLEND_ONLY){if(!e.getIncludedInBlend())return!1}else if(this.blendFilter===a.BlendFilter.NON_BLEND_ONLY&&e.getIncludedInBlend())return!1;return!e.hasTransparency()&&(!!(e.isFaces()&&i&&t.isNodeForBody(i))&&this.parentPass.nodeFilter(e))}setBlendFilter(e){this.blendFilter=e}}t.BackFaceSilhouettePass=c;class l extends a.CustomPass{constructor(e,t,i,s){super(e,t,{primitiveType:a.Primitive.FACES,sceneGraph:i,disableColorWrites:!0,performIsolationTest:!0}),this.noSection=s}getShaderId(){return"-depth-faces"+(this.noSection?a.NO_SECTION_SHADER_ID_SUFFIX:"")}preDraw(e){if(!super.preDraw(e))return!1;const t=this.viewer.getGlContext();return e.setOverrideFaceCullingMode(a.CullFace.FRONT),e.getState().callGl("depthMask",!1),(0,a.setupStencilForWriteWithoutTest)(t,a.StencilRefValue.LOW_PRIORITY_EDGES,a.StencilRefMask.EDGES),!0}postDraw(e){super.postDraw(e),e.clearOverrideFaceCullingMode()}}t.BackFaceStencilPass=l;class h extends a.DrawPass{constructor(e,t,i,s){super(e,t),this.isBackFacePassEnabled=!0,this.edgePass=new a.EdgeAndHiddenEdgePass(e,this,{primitiveType:a.Primitive.SILHOUETTES,performIsolationTest:!0,sceneGraph:i,shaderTagSuffix:s?a.NO_SECTION_SHADER_ID_SUFFIX:""}),this.backFaceStencilPass=new l(e,this,i,s),this.backfacePass=new c(e,this,i,s),this.childPasses=[this.edgePass,this.backFaceStencilPass,this.backfacePass]}setDrawHidden(e){this.edgePass.setDrawHidden(e)}setDrawVisibleParts(e){this.edgePass.setDrawVisibleParts(e),this.backFaceStencilPass.setEnabled(e),this.backfacePass.setEnabled(e)}setBlendFilter(e){this.edgePass.setBlendFilter(e),this.backFaceStencilPass.setBlendFilter(e),this.backfacePass.setBlendFilter(e)}setDrawBackFaceSilhouettes(e){this.isBackFacePassEnabled=e}preDraw(e){if(!this.viewer.debugIsShowingSilhouetteEdgesOnNonVisibleTangentEdgeStyle()&&this.viewer.getSmoothEdgesRenderStyle()!==r.GBTSmoothEdgeStyle.VISIBLE&&this.viewer.getRenderingMode()!==n.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE&&this.viewer.getRenderingMode()!==n.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED)return!1;super.preDraw(e);const t=e.getDetailSettings();this.edgePass.setEnabled(t.enableEdgeSilhouettes);const i=t.enableBackfaceSilhouettes&&this.isBackFacePassEnabled;return this.backFaceStencilPass.setEnabled(i),this.backfacePass.setEnabled(i),!0}}t.SilhouettePass=h},785992:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.TintedPass=t.TINT_TEST_TYPE=void 0;const s=i(114924),n=i(545348);var r;!function(e){e[e.DEPTH_AND_NORMAL=0]="DEPTH_AND_NORMAL",e[e.DEPTH_ONLY=1]="DEPTH_ONLY",e[e.PLANE_ID=2]="PLANE_ID"}(r||(t.TINT_TEST_TYPE=r={}));class a extends s.CustomPass{constructor(e,t,i,a,o,c){super(e,t,i),this.tintOpacity=1,this.tintColor=a,this.matchesCompareColor=o,this.inputs.uCompareBuffer=c,this.tintTestType=r.DEPTH_ONLY,this.primitiveType===s.Primitive.FACES&&(this.opacity===s.Opacity.TRANSPARENT?this.tintTestType=r.PLANE_ID:this.tintTestType=r.DEPTH_AND_NORMAL),this.opacity===s.Opacity.TRANSPARENT&&(this.tintOpacity=n.default.getManager().getNumber("COMPARE_TRANSLUCENT_FACE_OPACITY")),this.tintTestType===r.DEPTH_ONLY&&this.setExtraMeshNodeFilter((function(e){return e.getIsTintedByCompare()}))}getShaderId(){return this.tintTestType===r.PLANE_ID?"-tintByPlaneId-"+this.shaderTag:this.tintTestType===r.DEPTH_AND_NORMAL?"-tintByNormalDepth-"+this.shaderTag:"-tintByDepth-"+this.shaderTag}justBeforeDraw(e){super.justBeforeDraw(e);const t=e.getActiveShader();t.uniform3f("uTintColor",this.tintColor[0],this.tintColor[1],this.tintColor[2]),t.uniform1f("uTintOpacity",this.tintOpacity),t.uniform1f("uBlendOverdrawAdjustment",1/(1+(0,s.getBlendAmount)())),t.uniform3f("uMatchesCompareColor",this.matchesCompareColor[0],this.matchesCompareColor[1],this.matchesCompareColor[2]),this.inputs.uCompareBuffer&&t.useTexture("uCompareBuffer",this.inputs.uCompareBuffer.getColorTexture())}}t.TintedPass=a},840452:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.TransparencySwitchPass=t.TranslucentPass=void 0;const s=i(114924);class n extends s.DrawPass{constructor(e,t,i,n){super(e,t),this.childPasses=[],this.applyTranslucentAlphaToAll=!1,this.blendFilter=s.BlendFilter.ALL,this.sceneGraph=i;const r=new s.CustomPass(this.viewer,t,{primitiveType:s.Primitive.FACES,disableColorWrites:!0,performIsolationTest:!0}),a=new s.CustomPass(this.viewer,t,{primitiveType:s.Primitive.FACES,disableColorWrites:!0,performIsolationTest:!0,shaderTagSuffix:s.NO_SECTION_SHADER_ID_SUFFIX}),o=new s.SwitchPass(e,r,a,s.isSectionPlaneModeEnabled);o.setCheckFrameId(!0),this.accumulationPass=new s.OITBufferPass(this.viewer,t,s.OITComponent.ACCUMULATION,o),this.revealagePass=new s.OITBufferPass(this.viewer,t,s.OITComponent.REVEALAGE,o),this.compositePass=new s.OITCompositePass(this.viewer,this.accumulationPass,this.revealagePass,i,n),this.setSceneGraph(i),this.childPasses.push(this.compositePass)}appliesTranslucentAlphaToAll(e){this.applyTranslucentAlphaToAll=e,this.accumulationPass.appliesTranslucentAlphaToAll(e),this.revealagePass.appliesTranslucentAlphaToAll(e)}setSceneGraph(e){this.sceneGraph=e,this.accumulationPass.setSceneGraph(e),this.revealagePass.setSceneGraph(e),this.compositePass.setSceneGraph(e)}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}setBlendFilter(e){this.blendFilter=e,this.accumulationPass.setBlendFilter(e),this.revealagePass.setBlendFilter(e)}setDepthPassEnabled(e){this.accumulationPass.setDepthPassEnabled(e),this.revealagePass.setDepthPassEnabled(e)}setDepthOpacity(e){this.accumulationPass.setDepthOpacity(e),this.revealagePass.setDepthOpacity(e)}setExtraMeshNodeFilter(e){this.accumulationPass.setExtraMeshNodeFilter(e),this.revealagePass.setExtraMeshNodeFilter(e),this.extraMeshNodeFilter=e}setTintColor(e){this.accumulationPass.setTintColor(e)}setTintFactor(e){this.accumulationPass.setTintFactor(e)}setHideSelectionInterior(e){this.accumulationPass.setHideSelectionInterior(e)}setPerformIsolationTest(e){this.accumulationPass.setPerformIsolationTest(e),this.revealagePass.setPerformIsolationTest(e)}}t.TranslucentPass=n;class r extends s.SwitchPass{constructor(e,t,i,s){super(e,t,i,s)}appliesTranslucentAlphaToAll(e){this.pass1.appliesTranslucentAlphaToAll(e)}setDepthOpacity(e){this.pass1.setDepthOpacity(e)}setDepthPassEnabled(e){this.pass1.setDepthPassEnabled(e)}setExtraMeshNodeFilter(e){this.pass1.setExtraMeshNodeFilter(e),this.pass2.setExtraMeshNodeFilter(e)}}t.TransparencySwitchPass=r},977901:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.TransparentFaceDepth=void 0;const s=i(114924),n=i(606544),r=i(193786);class a extends s.CustomPass{constructor(e,t,i,n){super(e,t,{primitiveType:s.Primitive.FACES,opacity:s.Opacity.TRANSPARENT,disableColorWrites:!0,performIsolationTest:n}),this.setSceneGraph(i),this.setNodeFilter(this.createExcludeForNonBodyFilter())}getEnabled(){switch(this.viewer.getRenderingMode()){case n.GBTGraphicsRenderMode.SHADED_WITH_HIDDEN_EDGES:return!0;case n.GBTGraphicsRenderMode.SHADED_WITH_EDGES:case n.GBTGraphicsRenderMode.SHADED_WITHOUT_EDGES:case n.GBTGraphicsRenderMode.TRANSLUCENT:case n.GBTGraphicsRenderMode.SIMULATION_RESULTS:return(0,r.getFilteredEntitiesList)().length>0;default:return!1}}}t.TransparentFaceDepth=a},803439:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FaceEdgePointPass=t.makeDepthClearPass=t.DepthClearPass=t.makeBufferedNormalDepthPass=t.normalDepthClearColor=t.NormalDepthPass=void 0;const s=i(114924);class n extends s.DrawPass{constructor(e){super(e,null),this.shaderTag="normalDepth",this.childPasses=[],this.points=[],this.scenegraph=null,this.opaqueFacePass=new s.CustomPass(this.viewer,this,{}),this.childPasses.push(this.opaqueFacePass)}setSceneGraph(e){this.sceneGraph=e,this.opaqueFacePass.setSceneGraph(e)}getSceneGraph(){return this.sceneGraph?this.sceneGraph:super.getSceneGraph()}setOpacity(e){this.opaqueFacePass.setOpacity(e)}justBeforeDraw(e){const t=this.viewer.getGlContext();t.disable(t.BLEND),super.justBeforeDraw(e)}nodeFilter(e){const t=this.viewer.getModelViewManagers().getManager();return!!(!e.isMeshNode()||t.isNodeForModel(e)&&t.isNodeForFaces(e))&&e.getIsVisible()}}t.NormalDepthPass=n,t.normalDepthClearColor=[.5,.5,1,1],t.makeBufferedNormalDepthPass=function(e,i,r){const a=(0,s.makeBufferedPass)(e,new n(e),i,r);return a.clearColor=t.normalDepthClearColor,a};class r extends s.DrawPass{constructor(e,t){super(e,t),this.childPasses=[]}preDraw(e){const t=this.viewer.getGlContext();return t.clear(t.DEPTH_BUFFER_BIT),!0}}t.DepthClearPass=r,t.makeDepthClearPass=function(e,t){return new r(e,t)};class a extends s.DrawPass{constructor(e,t,i){super(e,t),this.childPasses=(0,s.buildFacesLinesPointsPasses)(e,this,i)}}t.FaceEdgePointPass=a},878365:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.EdgePointController=void 0;const s=i(142885),n=i(114924),r=i(545348),a=i(193786),o=i(196207),c=i(573879),l=i(606544),h=i(723617),d=i(264292),u=i(613199);class g{constructor(){this.selected=!1,this.preSelected=!1,this.edgePreSelected=!1,this.edgePointUiElement=null,this.selectedSheetmetalModelId=null}}const p=function(e){return e===(0,a.getPreselectionList)()},m=function(e,t){if(!(t.isEdge()&&!t.isClosedCurve()))return!1;const i=e.getSketch();if(!t.getSketchEntityId()||!i)return!0;const s=t.getFeatureIds();return 1!==s.length||i.id!==s[0]},E=function(e){return e.isEdgePoint()},I=function(e){return e.isVertex()},T=function(e){const t=o.DocumentController.getActiveFeatureController();if(t){const i=t.featureModel;if(i&&(!e||!i.get("isSketch")))return i}return null};class S extends s.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.edgePointUiElements={},this.purgeTimer=null,this.isEnabled=!1,(0,n.viewerCheck)(e),this.edgePointCandidate=new n.FilterEdgePointCandidate;const t=r.default.getManager();this.edgePointPixelSize=t.getNumber("POINT_BODY_SIZE")}enable(){this.viewer.getIsForPreviousVersionDisplay()||(this.isEnabled=!0,this.stopListening(),this.listenTo((0,a.getSelectionList)(),"add",this.onSelectionAdded),this.listenTo((0,a.getSelectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,a.getSelectionList)(),"reset",this.onSelectionReset),this.listenTo((0,a.getPreselectionList)(),"add",this.onSelectionAdded),this.listenTo((0,a.getPreselectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,a.getPreselectionList)(),"reset",this.onSelectionReset))}disable(){this.isEnabled&&(this.isEnabled=!1,this.stopListening(),this.removeAllEdgePointUiElements((0,a.getSelectionList)()),this.removeAllEdgePointUiElements((0,a.getPreselectionList)()))}addEdgePointUiElement(e,t,i){let s;s=t?e.getDeterministicId():e.getIdString();let r=this.edgePointUiElements[s];if(r||(r=new g),t?r.edgePreSelected=!0:i?r.preSelected=!0:r.selected=!0,t&&i){const t=n.EdgePoint.getEdgePointLocation(this.viewer,e,.5),i=this.viewer.getCamera().getPixelSizeAtWorldPoint(t)*this.edgePointPixelSize;if(!t||(0,a.getSelectionList)().models.find((e=>{if(I(e)){const s=this.viewer.getModelViewManagers().getManager().extractMeshIncrement(e.getDeterministicId());if(s){const e=s.points;return u.vec3C.length(u.vec3C.subtract(t,e,d.vec3.create()))<i}}return!1}),this))return null}return r.edgePointUiElement||(r.edgePointUiElement=new n.EdgePoint(n.MAIN_SCENEGRAPH_ID,e,.5,this.viewer)),this.edgePointUiElements[s]=r,r.edgePointUiElement}removeEdgePointUiElementWithDeterministicId(e,t){return!!this.edgePointUiElements.hasOwnProperty(e)&&(t?(this.edgePointUiElements[e].preSelected=!1,this.edgePointUiElements[e].edgePreSelected=!1):this.edgePointUiElements[e].selected=!1,!0)}purgeEdgePointUiElements(e){this.purgeTimer&&(clearTimeout(this.purgeTimer),this.purgeTimer=null);const t=[];Object.entries(this.edgePointUiElements).forEach((function([i,s]){!e&&(s.selected||s.preSelected||s.edgePreSelected)||(s.edgePointUiElement.remove(),t.push(i))})),this.edgePointUiElements=(0,h.omitProperty)(this.edgePointUiElements,t)}delayedPurgeUiElements(){if(this.purgeTimer)return;const e=this;this.purgeTimer=window.setTimeout((function(){e.purgeEdgePointUiElements()}),0)}removeEdgePointUiElement(e,t,i){let s=e.getDeterministicId();t||(s=e.getIdString()),this.removeEdgePointUiElementWithDeterministicId(s,i)}removeAllEdgePointUiElements(e){const t=p(e);Object.entries(this.edgePointUiElements).forEach((function([e,i]){this.removeEdgePointUiElementWithDeterministicId(e,t)}),this)}addSelection(e,t){if(e.isFromOccurrence()||e.isSectionEntity())return;const i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio();if(i&&"string"==typeof e.selectionId)if(e.entityMetaData&&e.entityMetaData.isFromSketch()){if(e.isFlattened()!==this.viewer.getIsForFlattenedDisplay())return!1}else{const t=i.getBodyComponent(null).idToMetaData[e.selectionId];if(!t&&this.viewer.getIsForFlattenedDisplay())return!1;if(t&&t instanceof l.BTBodyEntity&&t.getBodyMetaData().isForFlattenedView()!==this.viewer.getIsForFlattenedDisplay())return!1;if(t&&t instanceof l.BTBodyEntity&&this.selectedSheetmetalModelId&&t.getBodyMetaData().sheetMetalModelId!==this.selectedSheetmetalModelId)return!1}const s=p(t),n=E(e),r=m(this.viewer,e);if(n)this.addEdgePointUiElement(e,!1,s);else if(r){if(s){const t=(0,a.getCurrentSelectionQueryFilter)();t&&!t.filter(this.edgePointCandidate)||this.addEdgePointUiElement(e,!0,s)}}else if(I(e)&&!s){const t=this.viewer.getModelViewManagers().getManager();e.getFeatureIds().forEach((function(e){t.showPointBodies(e)}))}}onSelectionAdded(e,t){if(!e)return!1;const i=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio(),s=i?i.getEntityIdManager():null;s&&s.getIdForName(e.getIdString())!==n.INVALID_ID&&this.addSelection(e,t)}onSelectionRemoved(e,t){if(!e)return!1;const i=this.viewer.getModelViewManagers().getManager(),s=p(t),n=E(e),r=m(this.viewer,e);if(n){this.removeEdgePointUiElement(e,!1,s);const t=e.getSubfeatureId();t&&!s&&i.hidePointBodies(t),this.delayedPurgeUiElements()}else if(r&&s)this.removeEdgePointUiElement(e,!0,s),this.delayedPurgeUiElements();else if(I(e)&&!s&&T(!0)){e.getFeatureIds().forEach((function(e){i.hidePointBodies(e)}))}}addMultipleSelections(e){e.models.forEach((function(t){this.addSelection(t,e)}),this)}onSelectionReset(e,t){if(this.removeAllEdgePointUiElements(e),!p(e)){const t=T(!0);if(t&&!t.get("isSketch")){const i=function(e){const t=e.get("featureMsg");return t&&t.subFeatures?t.subFeatures.map((function(e){return e.featureId})):[]}(t),s=function(e){return e.filter((function(e){return I(e)&&1===e.getFeatureIds().length})).map((function(e){return e.getFeatureIds()[0]}))}(e),n=this.viewer.getModelViewManagers().getManager();(0,c.difference)(i,s).forEach((function(e){n.hidePointBodies(e)}))}}this.addMultipleSelections(e),t&&t.isForRemapping?this.purgeEdgePointUiElements(!0):this.delayedPurgeUiElements()}getUIElementsForSelection(e){if(E(e)){const t=this.edgePointUiElements[e.getIdString()];if(t)return[t.edgePointUiElement]}return[]}hideUIElementsForSelection(e){this.getUIElementsForSelection(e).forEach((function(e){e.hide()}))}setSelectedSheetmetalModelId(e){this.selectedSheetmetalModelId=e}}t.EdgePointController=S},653885:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodeLine=void 0;const s=i(114924),n=new s.NodeProperties({isShowThrough:!1,isPickable:!1,primitiveType:s.PrimitiveType.LINES});class r extends s.UIElement{constructor(e,t){super(e),this.graphicsId=r.GRAPHICS_ID_PREFIX+t,this.setId(this.graphicsId)}getExplodeLineNodeProperties(){return n}onAppearanceConstantsUpdated(){this.updateGraphics()}}t.ExplodeLine=r,r.GRAPHICS_ID_PREFIX="EXPLODE_LINE_GRAPHICS_"},358580:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodeLineArcSegment=void 0;const s=i(545348),n=i(264292),r=i(653885),a=i(114924),o=i(613199),c=s.default.getManager();class l extends r.ExplodeLine{constructor(e,t){super(e,t)}updateDefinition(e){e.startPosition&&e.center&&e.axis&&e.hasOwnProperty("angle")&&(this.startPosition=e.startPosition,this.arcCenter=e.center,this.arcAxis=e.axis,this.arcAngle=e.angle),this.updateGraphics()}updateGraphics(){const e=o.vec3C.subtract(this.startPosition,this.arcCenter,n.vec3.create()),t=o.vec3C.normalize(e,n.vec3.create()),i=o.vec3C.length(e),s=this.arcAngle,r=c.getNumber("EXPLODE_LINE_CIRCLE_SEGMENT_COUNT")*Math.abs(s-0)/(2*Math.PI),l=(0,a.createArc)(this.arcCenter,i,this.arcAxis,t,0,s,r);(0,a.addSizeToIncrement)(1,l),(0,a.addColorToIncrement)(c.getColor("EXPLODE_LINE_COLOR"),l),(0,a.addStyleToIncrement)(c.getStipple("EXPLODE_LINE_STIPPLE"),l);const h=this.graphicsId+"_MESH_INCREMENT";this.updateMeshIncrement(h,a.NO_SELECTION_ID,l,this.getExplodeLineNodeProperties())}}t.ExplodeLineArcSegment=l},503371:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ExplodeLineLineSegment=void 0;const s=i(545348),n=i(653885),r=i(114924),a=s.default.getManager();class o extends n.ExplodeLine{constructor(e,t){super(e,t),this.startPosition=null,this.endPosition=null}updateDefinition(e){this.startPosition=e.startPosition,this.endPosition=e.endPosition,this.updateGraphics()}updateGraphics(){const e=(0,r.createLine)(this.startPosition,this.endPosition);(0,r.addSizeToIncrement)(1,e),(0,r.addColorToIncrement)(a.getColor("EXPLODE_LINE_COLOR"),e),(0,r.addStyleToIncrement)(a.getStipple("EXPLODE_LINE_STIPPLE"),e);const t=this.graphicsId+"_MESH_INCREMENT";this.updateMeshIncrement(t,r.NO_SELECTION_ID,e,this.getExplodeLineNodeProperties())}}t.ExplodeLineLineSegment=o},724076:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsRefinementMode=void 0,function(e){e[e.NORMAL=0]="NORMAL",e[e.AGGRESSIVE_USER_CAUSED=1]="AGGRESSIVE_USER_CAUSED"}(i||(t.GraphicsRefinementMode=i={}))},785234:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},514313:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationCallbackStatus=void 0,function(e){e[e.ONGOING=0]="ONGOING",e[e.COMPLETE=1]="COMPLETE"}(i||(t.AnimationCallbackStatus=i={}))},602300:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},615655:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},728616:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectionType=void 0,function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INSIDE=1]="INSIDE",e[e.INTERSECTING=2]="INTERSECTING"}(i||(t.IntersectionType=i={}))},407173:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},845029:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CURVATURE_ANALYSIS_CANVAS_CONTROLS_WIDGET_ID=t.CURVATURE_ANALYSIS_CANVAS_CONTROLS_PANEL_ID=t.CURVATURE_COLOR_MAP_STORAGE_KEY=void 0,t.CURVATURE_COLOR_MAP_STORAGE_KEY="curvatureColorMap",t.CURVATURE_ANALYSIS_CANVAS_CONTROLS_PANEL_ID="curvature-analysis-canvas-controls-preferred-location",t.CURVATURE_ANALYSIS_CANVAS_CONTROLS_WIDGET_ID="curvatureAnalysis-canvas-controls"},939012:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isCountDimension=t.isRadialDimension=t.isCenterlineDimension=t.isLinearDimension=t.isEllipseDiameterDimension=t.isCurveLengthDimension=t.isArcLengthDimension=t.isAngularDimension=t.isDimension=t.DimensionPreferences=void 0;t.DimensionPreferences=class{constructor(){this.ignoreSpaceParameters=!1,this.displayLimitRangeText=!0,this.displayLimitRangeTicks=!1,this.textReadOnly=!1,this.textPrefix=""}},t.isDimension=function(e){return e&&e.isDimension()},t.isAngularDimension=function(e){return e&&"AngularDimension"===e.getId()},t.isArcLengthDimension=function(e){return e&&"ArcLengthDimension"===e.getId()},t.isCurveLengthDimension=function(e){return e&&"CurveLengthDimension"===e.getId()},t.isEllipseDiameterDimension=function(e){return e&&"EllipseDiameterDimension"===e.getId()},t.isLinearDimension=function(e){return e&&"LinearDimension"===e.getId()},t.isCenterlineDimension=function(e){return e&&"CenterlineDimension"===e.getId()},t.isRadialDimension=function(e){return e&&"RadialDimension"===e.getId()},t.isCountDimension=function(e){return e&&"CountDimension"===e.getId()}},967664:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},934663:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},701421:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},178738:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},618679:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.LAMINAR_EDGE_FILTER=void 0;t.LAMINAR_EDGE_FILTER=function(e){return e.isEdge()&&!e.isInternalEdge()&&e.isFromBody()&&!e.isFromWireBody()}},649962:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.FrameType=void 0,function(e){e.FULL="full",e.INTERACTIVE="interactive",e.MANIPULATING="manipulating"}(i||(t.FrameType=i={}))},904565:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.PART_INSTANCE_ALPHA=void 0,t.PART_INSTANCE_ALPHA=.3},261936:function(e,t){var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Action=t.highlightTypesThatChangeColor=t.HighlightType=void 0,function(e){e.UI="UI",e.RELATED_OCCURRENCE="RELATED_OCCURRENCE",e.RELATED_OCCURRENCE_MATE="RELATED_OCCURRENCE_MATE",e.ACCUMULATED_SMART_SELECTION="ACCUMULATED_SMART_SELECTION",e.SMART_SELECTION="SMART_SELECTION",e.ENTITY="ENTITY",e.UI_RELATED_ENTITY="UI_RELATED_ENTITY",e.FEATURE="FEATURE",e.PART="PART",e.OCCURRENCE="OCCURRENCE",e.OCCURRENCE_COMMENT="OCCURRENCE_COMMENT",e.COMMENT="COMMENT",e.FILTERED_ENTITIES="FILTERED_ENTITIES",e.OCCURRENCE_PRE="OCCURRENCE_PRE",e.PRE="PRE",e.ERROR="ERROR",e.SECONDARY="SECONDARY",e.SECONDARY_PRE="SECONDARY_PRE",e.OCCURRENCE_SECONDARY_PRE="OCCURRENCE_SECONDARY_PRE",e.ASSOCIATED_OCCURRENCE="ASSOCIATED_OCCURRENCE",e.ASSOCIATED_OCCURRENCE_PRE="ASSOCIATED_OCCURRENCE_PRE",e.INCONTEXT_REFERENCE="INCONTEXT_REFERENCE",e.INCONTEXT_REFERENCE_PRE="INCONTEXT_REFERENCE_PRE",e.RETRIEVAL="RETRIEVAL",e.OPERATION_PERSISTENT="OPERATION_PERSISTENT",e.REPAIR="REPAIR",e.REPAIR_HOVER="REPAIR_HOVER"}(i||(t.HighlightType=i={})),t.highlightTypesThatChangeColor=[i.UI,i.ACCUMULATED_SMART_SELECTION,i.SMART_SELECTION,i.ENTITY,i.FEATURE,i.PART,i.OCCURRENCE,i.SECONDARY],function(e){e[e.REMOVE=0]="REMOVE",e[e.ADD=1]="ADD"}(s||(t.Action=s={}))},78111:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MouseButton=void 0,function(e){e[e.LEFT=1]="LEFT",e[e.MIDDLE=2]="MIDDLE",e[e.RIGHT=3]="RIGHT"}(i||(t.MouseButton=i={}))},209006:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},183342:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},713289:function(e,t){var i,s,n;Object.defineProperty(t,"__esModule",{value:!0}),t.isFreeDragManipulator=t.isPlanarManipulator=t.isLinearManipulator=t.isAngularManipulator=t.isManipulator=t.FeatureManipulatorEvents=t.ManipulatorEvents=t.TriadManipulatorType=void 0,function(e){e.EXPLODE_CONVENIENCE_MANIPULATOR="explodeConvenienceManipulator",e.DRAG="drag",e.FULL="full",e.PLANE="plane",e.SKETCH="sketch",e.UNKNOWN="unknown"}(i||(t.TriadManipulatorType=i={})),function(e){e.MANIPULATION_STARTED="manipulationstarted",e.MANIPULATION_ENDED="manipulationended",e.VALUE_CHANGED="valuechanged",e.VALUE_EDITED="valueedited",e.CACHE_TRANSFORM="cachetransform",e.CLICKED="clicked",e.DOUBLE_CLICKED="doubleclicked",e.MANIPULATOR_ENTER="enter",e.MANIPULATOR_LEAVE="leave"}(s||(t.ManipulatorEvents=s={})),function(e){e.MANIPULATION_STARTED="manipulationstarted",e.VALUE_CHANGED="valuechanged",e.MANIPULATION_ENDED="manipulationended"}(n||(t.FeatureManipulatorEvents=n={})),t.isManipulator=function(e){return e.isManipulator()},t.isAngularManipulator=function(e){return void 0!==e.getAngle},t.isLinearManipulator=function(e){return void 0!==e.ray},t.isPlanarManipulator=function(e){return void 0!==e.origin},t.isFreeDragManipulator=function(e){return void 0!==e.lastMouseRay}},157083:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},552173:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},811177:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},616163:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},682946:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isPartStudio=void 0;const s=i(606544);t.isPartStudio=function(e){return e&&e.getElementType()===s.GBTElementType.PARTSTUDIO}},310408:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},962011:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},678233:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},966401:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},23658:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.enableSectionPlaneSelection=t.disableSectionPlaneSelection=t.sectionPlaneSelectionDisabled=t.SECTIONPLANE_SELECTION_ID=void 0,t.SECTIONPLANE_SELECTION_ID="sectionPlaneSelection",t.sectionPlaneSelectionDisabled=!1,t.disableSectionPlaneSelection=function(){t.sectionPlaneSelectionDisabled=!0},t.enableSectionPlaneSelection=function(){t.sectionPlaneSelectionDisabled=!1}},967623:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SIMULATION_LEGEND_CANVAS_CONTROLS_WIDGET_ID=t.SIMULATION_COLOR_MAP_STORAGE_KEY=void 0,t.SIMULATION_COLOR_MAP_STORAGE_KEY="simulationColorMap",t.SIMULATION_LEGEND_CANVAS_CONTROLS_WIDGET_ID="sim-canvas-controls"},757885:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenSpaceData=t.IconSelectionType=void 0,function(e){e[e.NOT_SELECTED=0]="NOT_SELECTED",e[e.PREHILITE=1]="PREHILITE",e[e.SELECTED=2]="SELECTED",e[e.MUTED=3]="MUTED"}(i||(t.IconSelectionType=i={}));t.ScreenSpaceData=class{constructor(){this.lowerLeft=null,this.lowerRight=null,this.upperLeft=null,this.pixelSize=1}}},275386:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.THICKNESS_ANALYSIS_CANVAS_CONTROLS_WIDGET_ID=t.THICKNESS_ANALYSIS_CANVAS_CONTROLS_PANEL_ID=t.THICKNESS_COLOR_MAP_STORAGE_KEY=void 0,t.THICKNESS_COLOR_MAP_STORAGE_KEY="thicknessColorMap",t.THICKNESS_ANALYSIS_CANVAS_CONTROLS_PANEL_ID="thickness-analysis-canvas-controls-panel",t.THICKNESS_ANALYSIS_CANVAS_CONTROLS_WIDGET_ID="thicknessAnalysis-canvas-controls"},499432:function(e,t){var i,s,n;Object.defineProperty(t,"__esModule",{value:!0}),t.OriginAxesIndex=t.ComponentNames=t.TriadEvents=void 0,function(e){e.REPOSITION_START="repositionStart",e.REPOSITION="reposition",e.REPOSITION_END="repositionEnd",e.ROTATION_START="rotationStart",e.ROTATION_CHANGE="rotationChange",e.ROTATION_END="rotationEnd",e.ROTATION_EDIT="rotationEdit",e.TRANSLATION_START="translationStart",e.TRANSLATION_CHANGE="translationChange",e.TRANSLATION_END="translationEnd",e.TRANSLATION_EDIT="translationEdit",e.SCALING_START="scalingStart",e.SCALING_CHANGE="scalingChange",e.SCALING_END="scalingEnd",e.SCALING_EDIT="scalingEdit",e.COMMAND="componentCommand",e.ENTER_INFERENCE="enterInference",e.LEAVE_INFERENCE="leaveInference",e.DOUBLE_CLICKED="doubleClicked"}(i||(t.TriadEvents=i={})),function(e){e.X_ROTATION="TRIAD_X_ROTATION",e.Y_ROTATION="TRIAD_Y_ROTATION",e.Z_ROTATION="TRIAD_Z_ROTATION",e.X_DIRECTION="TRIAD_X_DIRECTION",e.Y_DIRECTION="TRIAD_Y_DIRECTION",e.Z_DIRECTION="TRIAD_Z_DIRECTION",e.XY_PLANE="TRIAD_XY_PLANE",e.XZ_PLANE="TRIAD_XZ_PLANE",e.YZ_PLANE="TRIAD_YZ_PLANE",e.FREE_DRAG="TRIAD_FREE_DRAG",e.SCALING="SCALING"}(s||(t.ComponentNames=s={})),function(e){e[e.Origin=0]="Origin",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z"}(n||(t.OriginAxesIndex=n={}))},804299:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BTGraphicsISilhouette_CLICKED=t.InferenceData=t.isImageDisplay=void 0,t.isImageDisplay=function(e){return e&&e.getId&&"image"===e.getId()};t.InferenceData=class{constructor(e,t,i,s,n,r,a,o,c){this.deterministicId=e,this.secondDeterministicId=t,this.occurrence=i,this.inferenceType=s,this.coordinateSystem=n,this.sourceIsFeature=r,this.meshPointData=null,this.isInContextEntity=!!a,this.isPartStudioMateConnector=!!o,this.isInstanceOrigin=!!c}},t.BTGraphicsISilhouette_CLICKED="clicked"},37432:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},182322:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ManipulationMode=void 0,function(e){e.NONE="none",e.ROTATE="rotate",e.AXIS_ROTATE="axisRotate",e.PAN="pan",e.ZOOM="zoom"}(i||(t.ManipulationMode=i={}))},879655:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},877964:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0,function(e){e.DEFAULT="default",e.CROSSHAIR="url(/images/crosshair-cursor.svg) 7.5 7.5,crosshair",e.HAND="hand",e.GRAB="grab",e.GRABBING="grabbing",e.POINTER="pointer",e.ZOOM_IN="zoom-in",e.MOVE="move",e.TEXT="text",e.WAIT="wait",e.HELP="help",e.N_RESIZE="n-resize",e.NE_RESIZE="ne-resize",e.NS_RESIZE="ns-resize",e.E_RESIZE="e-resize",e.EW_RESIZE="ew-resize",e.SE_RESIZE="se-resize",e.S_RESIZE="s-resize",e.SW_RESIZE="sw-resize",e.W_RESIZE="w-resize",e.NW_RESIZE="nw-resize",e.PROGRESS="progress",e.NOT_ALLOWED="not-allowed",e.NO_DROP="no-drop",e.VERTICAL_TEXT="vertical-text",e.ALL_SCROLL="all-scroll",e.COL_RESIZE="col-resize",e.ROW_RESIZE="row-resize",e.SNAPMATE_GENERIC="url(/images/cursors/macSnapMate_Cursor.svg) 7.5 7.5,url(/images/cursors/SnapMate_Cursor.png) 7.5 7.5,nesw-resize",e.CONFIRMATION_GENERIC="url(/images/cursors/macConfirmation_Cursor.svg) 1 1,url(/images/cursors/Confirmation_Cursor.png) 1 1,default",e.SNAPMATE_WINDOWS="url(/images/cursors/winSnapMate_Cursor.svg) 7.5 7.5,url(/images/cursors/SnapMate_Cursor.png) 7.5 7.5,nesw-resize",e.CONFIRMATION_WINDOWS="url(/images/cursors/winConfirmation_Cursor.svg) 1 1,url(/images/cursors/Confirmation_Cursor.png) 1 1,default"}(i||(t.Cursor=i={}))},905311:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.XrSessionType=void 0,function(e){e.VR="immersive-vr",e.AR="immersive-ar"}(i||(t.XrSessionType=i={}))},575664:function(e,t){var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.XrButton=t.XRHandType=void 0,function(e){e[e.DOMINANT=0]="DOMINANT",e[e.NON_DOMINANT=1]="NON_DOMINANT"}(i||(t.XRHandType=i={})),function(e){e[e.TRIGGER=0]="TRIGGER",e[e.SQUEEZE=1]="SQUEEZE",e[e.TOUCH_PAD_PRESS=2]="TOUCH_PAD_PRESS",e[e.THUMBSTICK_PRESS=3]="THUMBSTICK_PRESS",e[e.A=4]="A",e[e.B=5]="B"}(s||(t.XrButton=s={}))},852349:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.BTGraphicsUsage=void 0,function(e){e[e.BASE=0]="BASE",e[e.PREVIEW=1]="PREVIEW"}(i||(t.BTGraphicsUsage=i={}))},13596:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EdgeCurvatureCheckboxNames=void 0,function(e){e.MINIMUM_RADIUS="minimum_radius",e.CURVATURE_COMBS="show_curvature",e.INFLECTION_POINTS="inflection_points",e.U_CURVES="u_curves",e.V_CURVES="v_curves",e.CROSS_FACE="cross_face",e.CPT_GRIDS="control_point_grids"}(i||(t.EdgeCurvatureCheckboxNames=i={}))},11770:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isUsagePreviewFinal=t.isUsagePreviewAfter=t.isUsagePreview=t.getLatestDisplayDataUsage=t.isUsageCompare=t.isUsageBase=t.getPickUsage=t.pickFromPreview=t.getPreviewAlpha=t.resetUsage=t.getEditState=t.DEFAULT_PREVIEW_OPACITY=t.Events=void 0;const s=i(852349),n=i(997687),r=i(912057),a=i(606544),o=i(322012);var c;!function(e){e.PREVIEW_STATE_CHANGE="previewStateChange",e.PREVIEW_BLEND_CHANGE="previewBlendChange"}(c||(t.Events=c={})),t.DEFAULT_PREVIEW_OPACITY=.7;class l{constructor(){this.eventsSubject=new o.Subject,this.stateProperties=new o.BehaviorSubject({previewAlpha:t.DEFAULT_PREVIEW_OPACITY,latestDisplayDataUsage:a.GBTDisplayDataUsage.BASE,inCompareMode:!1}),n.btInjector.StateService?this.inCompareMode=n.btInjector.StateService.isOnDocumentCompare():this.inCompareMode=!1,this.inCompareModeChangedObservable.subscribe((()=>{this.eventsSubject.next(c.PREVIEW_STATE_CHANGE)})),this.latestDisplayDataUsageChangedObservable.subscribe((()=>{const e=this.inCompareMode;e||this.eventsSubject.next(c.PREVIEW_STATE_CHANGE);const t=this.latestDisplayDataUsage===a.GBTDisplayDataUsage.BASE,i=this.latestDisplayDataUsage===a.GBTDisplayDataUsage.COMPARE_TARGET;!e||t||i?!e&&i&&r.log.warn("Received COMPARE_TARGET message while not in compare mode."):r.log.warn("Received a non-BASE and non-COMPARE_TARGET message while in compare mode.")})),this.previewAlphaChangedObservable.subscribe((()=>{this.eventsSubject.next(c.PREVIEW_BLEND_CHANGE)}))}get inCompareModeChangedObservable(){return this.stateProperties.asObservable().pipe((0,o.pairwise)(),(0,o.filter)((([e,t])=>e.inCompareMode!==t.inCompareMode)),(0,o.map)((([e,t])=>t)))}get stateChangedObservable(){return this.eventsSubject.asObservable()}get latestDisplayDataUsageChangedObservable(){return this.stateProperties.asObservable().pipe((0,o.pairwise)(),(0,o.filter)((([e,t])=>e.latestDisplayDataUsage!==t.latestDisplayDataUsage)),(0,o.map)((([e,t])=>t)))}get previewAlphaChangedObservable(){return this.stateProperties.asObservable().pipe((0,o.pairwise)(),(0,o.filter)((([e,t])=>e.previewAlpha!==t.previewAlpha)),(0,o.map)((([e,t])=>t)))}get latestDisplayDataUsage(){return this.stateProperties.getValue().latestDisplayDataUsage}set latestDisplayDataUsage(e){const t={...this.stateProperties.getValue(),latestDisplayDataUsage:e};this.stateProperties.next(t)}get inCompareMode(){return this.stateProperties.getValue().inCompareMode}set inCompareMode(e){const t={...this.stateProperties.getValue(),inCompareMode:e};this.stateProperties.next(t)}get previewAlpha(){return this.stateProperties.getValue().previewAlpha}set previewAlpha(e){const t={...this.stateProperties.getValue(),previewAlpha:e};this.stateProperties.next(t)}}let h=null;function d(){return h||(h=new l),h}function u(){return!!g()&&d().previewAlpha>.5}function g(){return d().inCompareMode}function p(){return d().latestDisplayDataUsage}t.getEditState=d,t.resetUsage=function(){d().inCompareMode=!1,d().latestDisplayDataUsage=a.GBTDisplayDataUsage.BASE},t.getPreviewAlpha=function(){return d().previewAlpha},t.pickFromPreview=u,t.getPickUsage=function(){return u()?s.BTGraphicsUsage.PREVIEW:s.BTGraphicsUsage.BASE},t.isUsageBase=function(){return d().latestDisplayDataUsage===a.GBTDisplayDataUsage.BASE&&!d().inCompareMode},t.isUsageCompare=g,t.getLatestDisplayDataUsage=p,t.isUsagePreview=function(){const e=p();return e===a.GBTDisplayDataUsage.PREVIEW_BEFORE||e===a.GBTDisplayDataUsage.PREVIEW_AFTER||e===a.GBTDisplayDataUsage.PREVIEW_FINAL},t.isUsagePreviewAfter=function(){return p()===a.GBTDisplayDataUsage.PREVIEW_AFTER},t.isUsagePreviewFinal=function(){return p()===a.GBTDisplayDataUsage.PREVIEW_FINAL}},262203:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.EntityCurvatureWrapper=t.CURVATURE_TYPE=void 0,function(e){e[e.EDGE_U=0]="EDGE_U",e[e.FACE_U=1]="FACE_U",e[e.FACE_V=2]="FACE_V"}(i||(t.CURVATURE_TYPE=i={}));t.EntityCurvatureWrapper=class{constructor(e,t){this.curvatureType=e,this.curvatureData=t}isEdgeCurvature(){return this.curvatureType===i.EDGE_U}isFaceUCurve(){return this.curvatureType===i.FACE_U}isFaceVCurve(){return this.curvatureType===i.FACE_V}isFaceCurvature(){return this.isFaceUCurve()||this.isFaceVCurve()}}},760240:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.VIEW_CONTAINER_MENU_INVOKED=t.CLOSE_MATE_DOF_CHOOSER=t.SELECTION_REJECTED=t.DEVICE_PIXEL_RATIO_CHANGED=t.GRAPHICS_HANDLED_CLICK_EVENT=t.CHANGE_VIEW=t.CHANGE_FEATURE_APPEARANCE=t.CANVAS_MOUSEMOVE=t.CANVAS_MOUSELEAVE=t.CANVAS_MOUSEENTER=t.CANVAS_CLICK=t.BODIES_LOADED=t.DIMENSION_VALUE_CHANGED=t.ASSEMBLY_DATA_PROCESSED=t.DISPLAYED_ASSEMBLY=t.DISPLAYED_PART_STUDIO=t.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED=t.PART_STUDIO_PART_VISIBILITY_CHANGED=t.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED=t.NEW_PART_LIST=t.CLOSE_SKETCH_SUB_DIALOG=t.SKETCH_COMMAND_ACTIVATED=t.SHOW_SKETCH_TEXT=t.CLOSE_SELECT_OTHER=t.SHOW_SMART_SELECTION=t.SELECT_OTHER_REVERSE=t.SELECT_OTHER=t.GL_CONTEXT_RESTORED=t.GL_CONTEXT_LOST=t.SESSION_ENDED=t.SHOW_DIMENSION_EXPRESSIONS_CHANGED=t.DIMENSION_DELETE_REQUEST=t.CLOSE_DIMENSION_EDIT=t.DIMENSION_EDIT_CLOSED=t.DIMENSION_TEXT_DOUBLE_CLICKED=t.DIMENSION_TEXT_SINGLE_CLICKED=t.ELEMENT_PREVIEW_GRAPHICS_LOADED=t.ELEMENT_VIEW_INITIALIZED=t.ELEMENT_GRAPHICS_LOADING=t.EVENT_NEEDS_ANGULAR_BROADCAST=t.PART_STUDIO_TIMES=t.ASSEMBLY_TIMES=t.VIEW_DID_DRAW=t.VIEW_WILL_PICK=t.VIEW_WILL_DRAW=t.ACTIVE_VIEWER_SET=t.getObservableFromActiveViewerForEvent=t.activeViewerChanging=t.getActiveViewerEventDispatcher=t.EventDispatcher=void 0,t.SIMULATION_CONNECTIONS_DISPLAYED=t.SIMULATION_RESULTS_DISPLAYED=t.FOLLOW_MODE_DEACTIVATED=t.FOLLOW_MODE_LEADER_MOUSE_OUT=t.FOLLOW_MODE_LEADER_MOUSE_MOVED=t.CURVATURE_ANALYSIS_CURVATURE_CONTROL_CHANGED=t.CURVATURE_ANALYSIS_COLOR_MAPPING_CHANGED=t.CURVATURE_ANALYSIS_LEGEND_CLOSED=t.CURVATURE_ANALYSIS_LEGEND_OPENED=t.CURVATURE_ANALYSIS_RANGE_CHANGED=t.CURVATURE_ANALYSIS_LEGEND_MAXIMUM_CLICKED=t.CURVATURE_ANALYSIS_LEGEND_MINIMUM_CLICKED=t.THICKNESS_ANALYSIS_LEGEND_CLOSED=t.THICKNESS_ANALYSIS_LEGEND_OPENED=t.THICKNESS_ANALYSIS_RANGE_CHANGED=t.THICKNESS_ANALYSIS_MAXIMUM_CLICKED=t.THICKNESS_ANALYSIS_MINIMUM_CLICKED=t.THICKNESS_ANALYSIS_DISPLAYED_FIELD_CHANGED=t.THICKNESS_ANALYSIS_COLOR_MAPPING_CHANGED=t.SIMULATION_LEGEND_CLOSED=t.SIMULATION_LEGEND_OPENED=t.SIMULATION_RANGE_CHANGED=t.SIMULATION_MAXIMUM_CLICKED=t.SIMULATION_MINIMUM_CLICKED=t.AFTER_MARKUP_IMAGE_GENERATION=t.BEFORE_MARKUP_IMAGE_GENERATION=t.ACTIVE_SHEETMETAL_MODEL_CHANGED=t.RETRIEVE_SMOOTH_EDGE_INFORMATION=t.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES=t.ADD_TEMPORARY_TESSELLATION_OVERRIDES=t.RETRIEVE_ELEMENT_DISPLAY_DATA=t.RETRIEVE_OCCURRENCE_DISPLAY_DATA=t.DID_RENDER_THUMBNAILS=t.WILL_RENDER_THUMBNAILS=t.SPACEMOUSE_COMMAND=t.SPACEMOUSE_COMMANDS_RECEIVED=t.SPACEMOUSE_ACTION_SET_CHANGED=t.ASSEMBLY_ANIMATE_MATE_ENDED=t.ASSEMBLY_ANIMATE_MATE_STARTED=t.VIEWER_CANVAS_ATTACHED_TO_CONTAINER=t.UPDATE_INCONTEXT_ISOLATION=t.SECTION_VIEW_DIALOG_CLOSED=t.SECTION_VIEW_DIALOG_OPENED=t.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED=t.SECTION_PLANE_REMOVED=t.SECTION_PLANE_ADDED=t.DEFAULT_UNITS_CHANGED=t.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER=t.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER=t.ANALYSIS_MENU_INVOKED=void 0,t.getDisplayedElementObservable=t.BOX_SELECTION_FINISHED=t.PICK_CONSTRAINT_SELECTED=t.PICKS_BOX_SELECTED=t.NAMED_VIEW_APPLIED=void 0;const s=i(520498),n=i(142885),r=i(322012),a=i(405993);class o extends n.BackboneEventsBaseClass{constructor(){super()}}t.EventDispatcher=o;let c=new o;function l(){if(s.getActiveViewer){const e=(0,s.getActiveViewer)();if(e)return e.getEventDispatcher()}return c}function h(e){return(0,r.fromEventPattern)((function(t){return l().on(e,t)}),(function(t){return l().off(e,t)}),(function(e){return arguments}))}t.getActiveViewerEventDispatcher=l,t.activeViewerChanging=function(e,t){t&&(t.setEventDispatcher(c),c=new o),e&&!t&&(c=e.getEventDispatcher(),e.setEventDispatcher(new o))},t.getObservableFromActiveViewerForEvent=h,t.ACTIVE_VIEWER_SET="ACTIVE_VIEWER_SET",t.VIEW_WILL_DRAW="VIEW_WILL_DRAW",t.VIEW_WILL_PICK="VIEW_WILL_PICK",t.VIEW_DID_DRAW="VIEW_DID_DRAW",t.ASSEMBLY_TIMES="ASSEMBLY_TIMES",t.PART_STUDIO_TIMES="PART_STUDIO_TIMES",t.EVENT_NEEDS_ANGULAR_BROADCAST="EVENT_NEEDS_ANGULAR_BROADCAST",t.ELEMENT_GRAPHICS_LOADING="ELEMENT_GRAPHICS_LOADING",t.ELEMENT_VIEW_INITIALIZED="ELEMENT_VIEW_INITIALIZED",t.ELEMENT_PREVIEW_GRAPHICS_LOADED="ELEMENT_PREVIEW_GRAPHICS_LOADED",t.DIMENSION_TEXT_SINGLE_CLICKED="DIMENSION_TEXT_SINGLE_CLICKED",t.DIMENSION_TEXT_DOUBLE_CLICKED="DIMENSION_TEXT_DOUBLE_CLICKED",t.DIMENSION_EDIT_CLOSED="DIMENSION_EDIT_CLOSED",t.CLOSE_DIMENSION_EDIT="CLOSE_DIMENSION_EDIT",t.DIMENSION_DELETE_REQUEST="DIMENSION_DELETE_REQUEST",t.SHOW_DIMENSION_EXPRESSIONS_CHANGED="SHOW_DIMENSION_EXPRESSIONS_CHANGED",t.SESSION_ENDED="SESSION_ENDED",t.GL_CONTEXT_LOST="GL_CONTEXT_LOST",t.GL_CONTEXT_RESTORED="GL_CONTEXT_RESTORED",t.SELECT_OTHER="SELECT_OTHER",t.SELECT_OTHER_REVERSE="SELECT_OTHER_REVERSE",t.SHOW_SMART_SELECTION="SHOW_SMART_SELECTION",t.CLOSE_SELECT_OTHER="CLOSE_SELECT_OTHER",t.SHOW_SKETCH_TEXT="SHOW_SKETCH_TEXT",t.SKETCH_COMMAND_ACTIVATED="SKETCH_COMMAND_ACTIVATED",t.CLOSE_SKETCH_SUB_DIALOG="CLOSE_SKETCH_SUB_DIALOG",t.NEW_PART_LIST="NEW_PART_LIST",t.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED="NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED",t.PART_STUDIO_PART_VISIBILITY_CHANGED="PART_STUDIO_PART_VISIBILITY_CHANGED",t.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED="PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED",t.DISPLAYED_PART_STUDIO="DISPLAYED_PART_STUDIO",t.DISPLAYED_ASSEMBLY="DISPLAYED_ASSEMBLY",t.ASSEMBLY_DATA_PROCESSED="ASSEMBLY_DATA_PROCESSED",t.DIMENSION_VALUE_CHANGED="DIMENSION_VALUE_CHANGED",t.BODIES_LOADED="BODIES_LOADED",t.CANVAS_CLICK="CANVAS_CLICK",t.CANVAS_MOUSEENTER="CANVAS_MOUSEENTER",t.CANVAS_MOUSELEAVE="CANVAS_MOUSELEAVE",t.CANVAS_MOUSEMOVE="CANVAS_MOUSEMOVE",t.CHANGE_FEATURE_APPEARANCE="CHANGE_FEATURE_APPEARANCE",t.CHANGE_VIEW="CHANGE_VIEW",t.GRAPHICS_HANDLED_CLICK_EVENT="GRAPHICS_HANDLED_CLICK_EVENT",t.DEVICE_PIXEL_RATIO_CHANGED="DEVICE_PIXEL_RATIO_CHANGED",t.SELECTION_REJECTED="SELECTION_REJECTED",t.CLOSE_MATE_DOF_CHOOSER="CLOSE_MATE_DOF_CHOOSER",t.VIEW_CONTAINER_MENU_INVOKED="VIEW_CONTAINER_MENU_INVOKED",t.ANALYSIS_MENU_INVOKED="ANALYSIS_MENU_INVOKED",t.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER="CREATE_SECTION_PLANE_INFERENCE_CONTROLLER",t.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER="DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER",t.DEFAULT_UNITS_CHANGED="DEFAULT_UNITS_CHANGED",t.SECTION_PLANE_ADDED="SECTION_PLANE_ADDED",t.SECTION_PLANE_REMOVED="SECTION_PLANE_REMOVED",t.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED="MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED",t.SECTION_VIEW_DIALOG_OPENED="SECTION_VIEW_DIALOG_OPENED",t.SECTION_VIEW_DIALOG_CLOSED="SECTION_VIEW_DIALOG_CLOSED",t.UPDATE_INCONTEXT_ISOLATION="UPDATE_INCONTEXT_ISOLATION",t.VIEWER_CANVAS_ATTACHED_TO_CONTAINER="VIEWER_CANVAS_ATTACHED_TO_CONTAINER",t.ASSEMBLY_ANIMATE_MATE_STARTED="ASSEMBLY_ANIMATE_MATE_STARTED",t.ASSEMBLY_ANIMATE_MATE_ENDED="ASSEMBLY_ANIMATE_MATE_ENDED",t.SPACEMOUSE_ACTION_SET_CHANGED="SPACEMOUSE_ACTION_SET_CHANGED",t.SPACEMOUSE_COMMANDS_RECEIVED="SPACEMOUSE_COMMANDS_RECEIVED",t.SPACEMOUSE_COMMAND="SPACEMOUSE_COMMAND",t.WILL_RENDER_THUMBNAILS="WILL_RENDER_THUMBNAILS",t.DID_RENDER_THUMBNAILS="DID_RENDER_THUMBNAILS",t.RETRIEVE_OCCURRENCE_DISPLAY_DATA="RETRIEVE_OCCURRENCE_DISPLAY_DATA",t.RETRIEVE_ELEMENT_DISPLAY_DATA="RETRIEVE_ELEMENT_DISPLAY_DATA",t.ADD_TEMPORARY_TESSELLATION_OVERRIDES="ADD_TEMPORARY_TESSELLATION_OVERRIDE",t.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES="CLEAR_TEMPORARY_TESSELLATION_OVERRIDES",t.RETRIEVE_SMOOTH_EDGE_INFORMATION="RETRIEVE_SMOOTH_EDGE_INFORMATION",t.ACTIVE_SHEETMETAL_MODEL_CHANGED="ACTIVE_SHEETMETAL_MODEL_CHANGED",t.BEFORE_MARKUP_IMAGE_GENERATION="BEFORE_PRINT_IMAGE_GENERATION",t.AFTER_MARKUP_IMAGE_GENERATION="AFTER_PRINT_IMAGE_GENERATION",t.SIMULATION_MINIMUM_CLICKED="SIMULATION_MINIMUM_CLICKED",t.SIMULATION_MAXIMUM_CLICKED="SIMULATION_MAXIMUM_CLICKED",t.SIMULATION_RANGE_CHANGED="SIMULATION_RANGE_CHANGED",t.SIMULATION_LEGEND_OPENED="SIMULATION_LEGEND_OPENED",t.SIMULATION_LEGEND_CLOSED="SIMULATION_LEGEND_CLOSED",t.THICKNESS_ANALYSIS_COLOR_MAPPING_CHANGED="THICKNESS_ANALYSIS_COLOR_MAPPING_CHANGED",t.THICKNESS_ANALYSIS_DISPLAYED_FIELD_CHANGED="THICKNESS_ANALYSIS_DISPLAYED_FIELD_CHANGED",t.THICKNESS_ANALYSIS_MINIMUM_CLICKED="THICKNESS_ANALYSIS_MINIMUM_CLICKED",t.THICKNESS_ANALYSIS_MAXIMUM_CLICKED="THICKNESS_ANALYSIS_MAXIMUM_CLICKED",t.THICKNESS_ANALYSIS_RANGE_CHANGED="THICKNESS_ANALYSIS_RANGE_CHANGED",t.THICKNESS_ANALYSIS_LEGEND_OPENED="THICKNESS_ANALYSIS_LEGEND_OPENED",t.THICKNESS_ANALYSIS_LEGEND_CLOSED="THICKNESS_ANALYSIS_LEGEND_CLOSED",t.CURVATURE_ANALYSIS_LEGEND_MINIMUM_CLICKED="CURVATURE_ANALYSIS_LEGEND_MINIMUM_CLICKED",t.CURVATURE_ANALYSIS_LEGEND_MAXIMUM_CLICKED="CURVATURE_ANALYSIS_LEGEND_MAXIMUM_CLICKED",t.CURVATURE_ANALYSIS_RANGE_CHANGED="CURVATURE_ANALYSIS_RANGE_CHANGED",t.CURVATURE_ANALYSIS_LEGEND_OPENED="CURVATURE_ANALYSIS_LEGEND_OPENED",t.CURVATURE_ANALYSIS_LEGEND_CLOSED="CURVATURE_ANALYSIS_LEGEND_CLOSED",t.CURVATURE_ANALYSIS_COLOR_MAPPING_CHANGED="CURVATURE_ANALYSIS_COLOR_MAPPING_CHANGED",t.CURVATURE_ANALYSIS_CURVATURE_CONTROL_CHANGED="CURVATURE_ANALYSIS_CURVATURE_CONTROL_CHANGED",t.FOLLOW_MODE_LEADER_MOUSE_MOVED="FOLLOW_MODE_LEADER_MOUSE_MOVED",t.FOLLOW_MODE_LEADER_MOUSE_OUT="FOLLOW_MODE_LEADER_MOUSE_OUT",t.FOLLOW_MODE_DEACTIVATED="FOLLOW_MODE_DEACTIVATED",t.SIMULATION_RESULTS_DISPLAYED="SIMULATION_RESULTS_DISPLAYED",t.SIMULATION_CONNECTIONS_DISPLAYED="SIMULATION_CONNECTIONS_DISPLAYED",t.NAMED_VIEW_APPLIED="NAMED_VIEW_APPLIED",t.PICKS_BOX_SELECTED="PICKS_BOX_SELECTED",t.PICK_CONSTRAINT_SELECTED="PICK_CONSTRAINT_SELECTED",t.BOX_SELECTION_FINISHED="BOX_SELECTION_FINISHED",t.getDisplayedElementObservable=function(){const e=h(t.DISPLAYED_PART_STUDIO).pipe((0,a.filter)((e=>e[1]))),i=h(t.DISPLAYED_ASSEMBLY).pipe((0,a.filter)((e=>e[1])));return e.pipe((0,a.mergeWith)(i),(0,a.take)(1))}},541198:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.NumberIdManager=t.INVALID_NUMBER_ID=t.idFromString=t.idIsValid=t.idsEqual=t.makeId=t.IdManager=t.IdMasks=t.IdSizes=t.FIRST_ID=t.INVALID_ID_ELEMENT=t.INVALID_ID=void 0;const s=i(573879);t.INVALID_ID=[],t.INVALID_ID_ELEMENT=0;var n,r;t.FIRST_ID=[1],function(e){e[e.DEFAULT=32]="DEFAULT",e[e.ENTITY=20]="ENTITY",e[e.OCCURRENCE_SLICE=12]="OCCURRENCE_SLICE",e[e.OCCURRENCE_ID=24]="OCCURRENCE_ID",e[e.HIGHLIGHT=16]="HIGHLIGHT"}(n||(t.IdSizes=n={})),function(e){e[e.ENTITY=1048575]="ENTITY",e[e.OCCURRENCE_SLICE=4095]="OCCURRENCE_SLICE"}(r||(t.IdMasks=r={}));class a{constructor(e){this.freeIds=[],this.nextId=t.FIRST_ID.slice(0);const i=e||n.DEFAULT;this.maximumElementSize=Math.pow(2,i)-1}clone(){const e=new a;return e.nextId=this.nextId.slice(0),e.freeIds=this.freeIds.slice(0),e.maximumElementSize=this.maximumElementSize,e}reset(){this.nextId=t.FIRST_ID.slice(0),this.freeIds=[]}getId(){if(this.freeIds.length>1)return this.freeIds.pop();const e=this.nextId.slice(0);let t,i=!1;for(t=0;t<this.nextId.length;++t)if(this.nextId[t]<this.maximumElementSize){this.nextId[t]=this.nextId[t]+1;for(let e=0;e<t;++e)this.nextId[e]=1;i=!0;break}if(!i){for(t=0;t<this.nextId.length;++t)this.nextId[t]=1;this.nextId.push(1)}return e}freeId(e){c(e)&&this.freeIds.push(e)}}function o(e){return e}function c(e){if(!e||e.length<1)return!1;for(let i=0;i<e.length;++i)if(e[i]===t.INVALID_ID_ELEMENT)return!1;return!0}t.IdManager=a,t.makeId=o,t.idsEqual=function(e,t){return(0,s.arraysEqual)(e,t)},t.idIsValid=c,t.idFromString=function(e){const t=e.split(","),i=[];for(let e=0;e<t.length;e++)i.push(+t[e]);return i},t.INVALID_NUMBER_ID=0;t.NumberIdManager=class{constructor(e){this.freeIds=[],this.nextId=1;const t=e||n.DEFAULT;this.maximumNumberSize=Math.pow(2,t)-1}reset(){this.nextId=1,this.freeIds=[]}getId(){if(this.freeIds.length>1)return this.freeIds.pop();if(this.nextId===t.INVALID_NUMBER_ID)return t.INVALID_NUMBER_ID;const e=this.nextId++;return this.nextId>=this.maximumNumberSize&&(this.nextId=t.INVALID_NUMBER_ID),e}isIdValid(e){return e!==t.INVALID_NUMBER_ID}freeId(e){this.isIdValid(e)&&this.freeIds.push(e)}}},683067:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0});const s=i(389496);s.__exportStar(i(11770),t),s.__exportStar(i(760240),t),s.__exportStar(i(724076),t),s.__exportStar(i(785234),t),s.__exportStar(i(514313),t),s.__exportStar(i(602300),t),s.__exportStar(i(615655),t),s.__exportStar(i(728616),t),s.__exportStar(i(939012),t),s.__exportStar(i(967664),t),s.__exportStar(i(934663),t),s.__exportStar(i(701421),t),s.__exportStar(i(178738),t),s.__exportStar(i(618679),t),s.__exportStar(i(649962),t),s.__exportStar(i(904565),t),s.__exportStar(i(261936),t),s.__exportStar(i(78111),t),s.__exportStar(i(183342),t),s.__exportStar(i(209006),t),s.__exportStar(i(157083),t),s.__exportStar(i(552173),t),s.__exportStar(i(811177),t),s.__exportStar(i(616163),t),s.__exportStar(i(682946),t),s.__exportStar(i(310408),t),s.__exportStar(i(962011),t),s.__exportStar(i(678233),t),s.__exportStar(i(966401),t),s.__exportStar(i(845029),t),s.__exportStar(i(407173),t),s.__exportStar(i(23658),t),s.__exportStar(i(757885),t),s.__exportStar(i(275386),t),s.__exportStar(i(804299),t),s.__exportStar(i(37432),t),s.__exportStar(i(182322),t),s.__exportStar(i(877964),t),s.__exportStar(i(879655),t),s.__exportStar(i(905311),t),s.__exportStar(i(575664),t),s.__exportStar(i(852349),t),s.__exportStar(i(508043),t),s.__exportStar(i(95517),t),s.__exportStar(i(541198),t),s.__exportStar(i(533637),t),s.__exportStar(i(490950),t),s.__exportStar(i(297306),t),s.__exportStar(i(520498),t)},508043:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.NamedIdManager=void 0;const s=i(736234),n=i(683067);class r{constructor(e){this.nameToId={},this.idToName={},this.idManager=new n.IdManager(e)}reset(){this.nameToId={},this.idToName={},this.idManager.reset()}clone(){const e=new r;return e.nameToId=(0,s.clone)(this.nameToId),e.idToName=(0,s.clone)(this.idToName),e.idManager=this.idManager.clone(),e}getOrCreateIdForName(e){let t=this.nameToId[e];return t||(t=this.idManager.getId(),this.nameToId[e]=t,this.idToName[t]=e),t}getIdForName(e){const t=this.nameToId[e];return t||n.INVALID_ID}getNameForId(e){const t=this.idToName[e];return t||null}removeName(e){const t=this.nameToId[e];t&&(this.idManager.freeId(t),delete this.nameToId[e],delete this.idToName[t])}}t.NamedIdManager=r},95517:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isIdValid=t.OccurrenceIdManager=t.PART_STUDIO_ELEMENT_ID=t.NO_ID=t.INVALID_OCCURRENCE_ID=void 0;const s=i(520498),n=i(541198),r=i(508043),a=i(912057);t.INVALID_OCCURRENCE_ID=-1,t.NO_ID=0,t.PART_STUDIO_ELEMENT_ID=0;const o=1<<n.IdSizes.OCCURRENCE_SLICE;t.OccurrenceIdManager=class{constructor(e){this.viewer=e,(0,s.viewerCheck)(e),this.namedIdManager=new r.NamedIdManager(n.IdSizes.OCCURRENCE_ID)}reset(){this.namedIdManager.reset()}convertToOccurrenceId(e){if(!(0,n.idIsValid)(e))return t.INVALID_OCCURRENCE_ID;if(e.length>1)return a.log.warn("More than the allowed number of occurrences have been allocated"),t.INVALID_OCCURRENCE_ID;let i=e[0],s=1;for(;i>=o;)++s,i/=o;return this.viewer.notifyOfPickPassCount(s),e[0]}getOrCreateIdForName(e){return this.convertToOccurrenceId(this.namedIdManager.getOrCreateIdForName(e))}getIdForName(e){return this.convertToOccurrenceId(this.namedIdManager.getIdForName(e))}getNameForId(e){return this.namedIdManager.getNameForId([e])}removeName(e){this.namedIdManager.removeName(e)}},t.isIdValid=function(e){return null!=e&&e!==t.INVALID_OCCURRENCE_ID}},315931:function(e,t){var i;Object.defineProperty(t,"__esModule",{value:!0}),t.numberToPrimitiveType=t.getPrimitiveTypeDescription=t.PRIMITIVE_TYPE_BITS=t.PrimitiveType=void 0,function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.INFINITE_LINES=2]="INFINITE_LINES",e[e.TRIANGLES=3]="TRIANGLES",e[e.TRIANGLE_STRIP=4]="TRIANGLE_STRIP",e[e.SILHOUETTES=5]="SILHOUETTES",e[e.COUNT=6]="COUNT",e[e.PRIMITIVE_UNKNOWN=-1]="PRIMITIVE_UNKNOWN"}(i||(t.PrimitiveType=i={})),t.PRIMITIVE_TYPE_BITS=Math.ceil(Math.log(i.COUNT)/Math.log(2)),t.getPrimitiveTypeDescription=function(e){switch(e){case i.POINTS:return"POINTS";case i.LINES:return"LINES";case i.INFINITE_LINES:return"INFINITE_LINES";case i.TRIANGLES:return"TRIANGLES";case i.TRIANGLE_STRIP:return"TRIANGLE_STRIP";case i.SILHOUETTES:return"SILHOUETTES";default:return"PRIMITIVE_UNKNOWN"}},t.numberToPrimitiveType=function(e){switch(e){case i.POINTS:return i.POINTS;case i.LINES:return i.LINES;case i.INFINITE_LINES:return i.INFINITE_LINES;case i.TRIANGLES:return i.TRIANGLES;case i.TRIANGLE_STRIP:return i.TRIANGLE_STRIP;case i.SILHOUETTES:return i.SILHOUETTES}return i.PRIMITIVE_UNKNOWN}},533637:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.updateAutoSetting=t.setRendererInfo=t.setRetinaDisplayMode=t.RetinaDisplayMode=void 0;const s=i(32620);var n;!function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.AUTO=2]="AUTO"}(n||(t.RetinaDisplayMode=n={}));let r,a=n.AUTO,o=null;function c(){if(a!==n.AUTO)return;let e=(void 0===r&&(r=navigator.platform.indexOf("Mac")>-1),!r);const t=new RegExp(".*intel.*","i");o&&t.test(o.glRenderer)&&(e=!0),(0,s.setPixelScalingDisabled)(e)}t.setRetinaDisplayMode=function(e){switch(a=e,a){case n.OFF:(0,s.setPixelScalingDisabled)(!0);break;case n.ON:(0,s.setPixelScalingDisabled)(!1);break;case n.AUTO:c()}},t.setRendererInfo=function(e){o=e,c()},t.updateAutoSetting=c,c()},490950:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.SIMULATION_BODY_SCENEGRAPH_ID=t.INFERENCE_PICKER_SCENEGRAPH_ID=t.HUD_MODEL_SCENEGRAPH_ID=t.HUD_SCENEGRAPH_ID=t.PREVIEW_SCENEGRAPH_ID=t.MAIN_SCENEGRAPH_ID=void 0,t.MAIN_SCENEGRAPH_ID="mainSceneGraph",t.PREVIEW_SCENEGRAPH_ID="previewSceneGraph",t.HUD_SCENEGRAPH_ID="hudSceneGraph",t.HUD_MODEL_SCENEGRAPH_ID="hudModelSceneGraph",t.INFERENCE_PICKER_SCENEGRAPH_ID="inferencePickerSceneGraph",t.SIMULATION_BODY_SCENEGRAPH_ID="simulationBodyScenegraph"},202816:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getCounters=t.Counters=t.CounterNames=void 0;const s=i(322012);var n;!function(e){e.UPDATES="counter updates",e.DRAW_CALLS="draw calls",e.TRIANGLES="triangles",e.LINES="lines",e.POINTS="points"}(n||(t.CounterNames=n={}));class r{constructor(){this.countersSubject=new s.Subject,this.counters={}}increment(e,t){void 0===t&&(t=1);let i=this.counters[e];i||(i=0),this.counters[e]=i+t}resetCounters(){this.counters={}}updateModel(){this.increment(n.UPDATES),this.countersSubject.next(this.counters)}get countersObservable(){return this.countersSubject.asObservable()}}t.Counters=r;const a=new r;t.getCounters=function(){return a}},297306:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.userWebPreferencesGetManager=void 0;const s=i(533637),n=i(520498);class r{constructor(){this.retinaDisplaySetting=s.RetinaDisplayMode.AUTO}getRetinaDisplaySetting(){return this.retinaDisplaySetting}setRetinaDisplaySetting(e){this.retinaDisplaySetting=e,(0,s.setRetinaDisplayMode)(this.retinaDisplaySetting),(0,n.getActiveViewer)().requestDraw()}setUserWebPreference(e){const t=s.RetinaDisplayMode[e.retinaDisplaySetting];this.setRetinaDisplaySetting(t)}}let a=null;t.userWebPreferencesGetManager=function(){return a||(a=new r),a}},520498:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.viewerCheck=t.getFocusedViewer=t.getActiveViewerModelViewManagers=t.getActiveViewer=t.setActiveViewer=t.setFocusedViewer=t.activeViewer=void 0;const s=i(912057),n=i(760240);t.activeViewer=null;let r=null;function a(e){r=e,r?r.getPrimaryViewController()&&t.activeViewer.getPrimaryViewController()&&(r.getPrimaryViewController().forcedManipulationMode=t.activeViewer.getPrimaryViewController().forcedManipulationMode):r=t.activeViewer}function o(){return t.activeViewer}t.setFocusedViewer=a,t.setActiveViewer=function(e){(0,n.activeViewerChanging)(t.activeViewer,e),t.activeViewer&&e&&s.log.warn("A second viewer was set to be active before the first was deactivated."),t.activeViewer=e,a(e)},t.getActiveViewer=o,t.getActiveViewerModelViewManagers=function(){const e=o();return e?e.getModelViewManagers():null},t.getFocusedViewer=function(){return r},t.viewerCheck=function(e){return!!e||(s.log.warn("viewer is null or undefined"),!1)}},799984:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Display=t.getNodeProperties=void 0;const s=i(545348),n=i(193786),r=i(606544),a=i(114924),o=new a.Material({diffuseFactor:.5,ambientFactor:.5});function c(){return{0:new a.NodeProperties({isPickable:!1,zOffset:3,isShowThrough:!0,primitiveType:a.PrimitiveType.POINTS}),1:new a.NodeProperties({isPickable:!1,zOffset:4,isShowThrough:!0,primitiveType:a.PrimitiveType.LINES,priority:a.RenderOrderPriority.HIGHEST}),4:new a.NodeProperties({isPickable:!1,isTwoSided:!0,zOffset:5,primitiveType:a.PrimitiveType.TRIANGLE_STRIP,material:o,primitivesHaveTransparency:!0})}}t.getNodeProperties=c;class l extends a.UIElement{constructor(e,t){super(t),this.sheetMetalModelId=null,this.incrementIdToHightlight={};s.default.getManager();e.forEach((function(e,t){let i=null;if(e instanceof r.BTDebugGeometry&&(i=e,this.sheetMetalModelId=i.sheetMetalModelId,i.deterministicId&&i.style===r.GBTDebugEntityStyle.ERROR)){const e=(0,n.createSelectionFromDeterministicId)(i.deterministicId);if(e)return void(0,n.getErrorSelectionList)().add(e)}const s=(0,a.createMeshIncrementForEntityData)(e);if(s){if(!s.colors){const e=(0,a.getColorFromDebugEntityColor)(r.GBTDebugEntityColor.FEATURE_ERROR,s.primitiveType);(0,a.addColorToIncrement)(e,s)}s.primitiveType===a.PrimitiveType.POINTS?s.primitiveSizes||(0,a.addSizeToIncrement)(7,s):s.primitiveType===a.PrimitiveType.LINES&&(0,a.addSizeToIncrement)(2.5,s);const e=c(),n="id"+t;if(this.updateMeshIncrement(n,a.NO_SELECTION_ID,s,e[s.primitiveType]),i&&i.style===r.GBTDebugEntityStyle.ERROR){const e=this.addNewHighlightToIncrement(n,a.HighlightType.ERROR);this.incrementIdToHightlight[n]=e,this.hideIncrement(n)}this.viewer.getIsolatedOccurrenceManager().addIdsToIsolate([this.graphicsOccurrenceId])}}),this)}show(){super.show();for(const e in this.incrementIdToHightlight){const t=this.addNewHighlightToIncrement(e,a.HighlightType.ERROR);this.incrementIdToHightlight[e]=t,this.hideIncrement(e)}}hide(){super.hide();for(const e in this.incrementIdToHightlight)this.removeHighlightFromIncrement(e,this.incrementIdToHightlight[e]);this.freeAllocatedHighlights()}remove(){(0,n.getErrorSelectionList)().reset(),this.viewer.getIsolatedOccurrenceManager().removeFromIsolate([this.graphicsOccurrenceId]),super.remove()}}t.Display=l},168349:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ToolDisplay=t.TOOL_EDGE_PROPERTIES=t.TOOL_FACE_PROPERTIES=void 0;const s=i(545348),n=i(114924),r=new n.Material({diffuseFactor:.5,ambientFactor:.5});t.TOOL_FACE_PROPERTIES=new n.NodeProperties({isPickable:!1,isTwoSided:!0,primitiveType:n.PrimitiveType.TRIANGLE_STRIP,isShowThrough:!0,isDepthTested:!1,priority:n.RenderOrderPriority.LOWER,material:r}),t.TOOL_EDGE_PROPERTIES=new n.NodeProperties({isPickable:!1,primitiveType:n.PrimitiveType.LINES});class a extends n.UIElement{constructor(e,t){super(e),this.manipulatorId=t,this.sourcePrimitives=[],this.sourceIds=[]}initialize(e){return!(e.length<1)&&(!!this.createPreviewMeshes(e)&&!!this.updateMeshes())}duplicatePrimitive(e){const t=e.clone();return t.id="",e.points&&(t.points=new Float32Array(e.points)),t}createPreviewMeshes(e){this.sourcePrimitives=[];const t=s.default.getManager().getColor("FEATURE_FAST_PREVIEW_COLOR"),i=this.viewer.getModelViewManagers().getManager();return i&&e.forEach((function(e){const s=i.extractMeshIncrement(e);if(s){const i=this.duplicatePrimitive(s);i.colors=null,(0,n.addColorToIncrement)(t,i),this.sourcePrimitives.push(i),this.sourceIds.push(e)}}),this),this.sourceIds.length>=1}updateMeshes(){return!1}}t.ToolDisplay=a},172166:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.FilterEdgePointCandidate=t.FilterVertexCandidate=t.FilterCandidate=void 0;class i{isFromWireBody(){return!1}isFromPointBody(){return!1}isCompositeBody(){return!1}isFromConstructionGeometry(){return!1}isInternalEdge(){return!1}isPlanar(){return!1}getPlanarNormal(){return null}isFromBody(){return!1}isFromSolidBody(){return!1}isFromSheetBody(){return!1}isFace(){return!1}canContainFace(){return!1}isEdge(){return!1}canContainEdge(){return!1}isVertex(){return!1}canContainVertex(){return!1}isDegenerateEdge(){return!1}isDefinedBySMVertex(){return!1}isDefinedBySMEdge(){return!1}isDefinedBySMFace(){return!1}isMateConnector(){return!1}isMate(){return!1}containsMesh(){return!1}isFlattened(){return!1}isFromActiveSheetMetal(){return!1}isBody(){return!1}isFromSketch(){return!1}isSketchTextEntity(){return!1}isSketchTextStroke(){return!1}isSketchImageEntity(){return!1}isSketchGroup(){return!1}getSketchGroupSelection(){return null}isUserSketchEntity(){return!1}getFeatureIds(){return[]}makeBodySelection(){return null}makeCompositeBodySelections(){return null}makeSketchFeatureSelection(){return null}isFromOccurrence(){return!1}isOccurrence(){return!1}makeOccurrenceSelection(e){return null}isClosedCurve(){return!1}isFromClick(){return!1}isEntity(){return!1}hasMateQueryData(){return!1}isGeometryMate(){return!1}getMateType(){return null}isMateGroup(){return!1}isMateConnectorBasedMate(){return!1}isFeature(){return!1}getFeatureType(){return null}isLine(){return!1}isCircle(){return!1}isEllipse(){return!1}isConic(){return!1}isCylinder(){return!1}isCone(){return!1}isSphere(){return!1}isTorus(){return!1}isRevolved(){return!1}isExtruded(){return!1}isAssemblyPattern(){return!1}isParametricInstance(){return!1}isParametricPartStudioInstance(){return!1}isParametricPartStudioChildInstance(){return!1}isParametricChildInstance(){return!1}isReplicatedInstance(){return!1}isNonSolidPartOccurrence(){return!1}isTemporaryGeometry(){return!1}isModifiable(){return!1}isNonModifiable(){return!1}isEdgePoint(){return!1}isPatternedOccurrence(){return!1}isAssemblyOccurrence(){return!1}isPartOccurrence(){return!1}isSuppressedOccurrence(){return!1}isFlattenedOccurrence(){return!1}isStandardContentOccurrence(){return!1}getOccurrence(){return null}getOwnerAssemblyOccurrence(){return null}makeMateConnectorSelection(){return null}isSpline(){return!1}isAssemblySketch(){return!1}isFromSplineHandle(){return!1}isInternalSplinePoint(){return!1}isFromSplineControlPolygon(){return!1}isSolveStatusUnknown(){return!1}isSolveStatusUnderDefined(){return!1}isSolveStatusWellDefined(){return!1}isSolveStatusFixed(){return!1}isSolveStatusOverDefined(){return!1}isSolveStatusNotConsistent(){return!1}isSectionEntity(){return!1}}t.FilterCandidate=i;class s extends i{isFromBody(){return!0}isFromSolidBody(){return!0}isVertex(){return!0}canContainVertex(){return!0}isEntity(){return!0}}t.FilterVertexCandidate=s;t.FilterEdgePointCandidate=class extends s{isEdgePoint(){return!0}isInContextSelection(){return!1}}},193890:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FilteredEntitiesHighlightController=void 0;const s=i(142885),n=i(193786),r=i(114924);class a extends s.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.isEnabled=!1,(0,r.viewerCheck)(e),this.graphicsViewer=e,this.highlightFilterFunction=t}enable(){this.isEnabled=!0,this.updateSetOfFilteredEntities(),this.stopListening(),this.listenTo(this.graphicsViewer.getEventDispatcher(),r.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED,this.updateSetOfFilteredEntities),this.latestDisplayDataUsageSubscription=(0,r.getEditState)().latestDisplayDataUsageChangedObservable.subscribe((()=>this.updateSetOfFilteredEntities()))}disable(){this.isEnabled&&(this.isEnabled=!1,this.stopListening(),this.latestDisplayDataUsageSubscription.unsubscribe(),(0,n.clearFilteredEntitiesHighlight)())}updateSetOfFilteredEntities(){(0,n.clearFilteredEntitiesHighlight)(),this.updateHighlightsForPartStudio(this.graphicsViewer.getModelViewManagers().getManager().getDisplayedPartStudio());const e=this.graphicsViewer.getModelViewManagers().getPreviewManager();e&&this.updateHighlightsForPartStudio(e.getDisplayedPartStudio())}updateHighlightsForPartStudio(e){if(!e)return;const t=e.getFilteredEntityIds(this.highlightFilterFunction),i=!this.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode(),s=e.getBodyComponent();for(let a=0;a<t.length;++a){const o=(0,n.createSelectionFromDeterministicId)(t[a],null,e.usage);o&&e.getBodyVisibility(o.getBodyId())===r.Visibility.VISIBLE&&(i||s.isBodyIsolated(r.PART_STUDIO_ELEMENT_ID,o.getBodyId()))&&(0,n.getFilteredEntitiesList)().add(o)}}}t.FilteredEntitiesHighlightController=a},637249:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FrameBuffer=void 0;const s=i(114924),n=i(142885),r=i(997687),a=i(912057);class o extends n.BackboneEventsBaseClass{constructor(e,t,i,n){super(),this.viewer=e,this.textureType=t,this.GAUGE_MEMORY_TYPE="Frame buffer",this.colorTexture=null,this.renderBuffer=null,this.frameBuffer=null,this.width=0,this.height=0,this.isWebXrEnabled=!1,(0,s.viewerCheck)(e),this.renderBufferArguments=n,this.id=i||"",this.listenTo(this.viewer.getEventDispatcher(),s.GL_CONTEXT_LOST,this.onGlContextLost),this.listenTo(this.viewer.getEventDispatcher(),s.SESSION_ENDED,this.onSessionEnded),r.btInjector.CapabilitiesService.isWebxrEnabled().then((e=>{this.isWebXrEnabled=e}))}destroy(){this.stopListening(),this.freeResources()}setExternalFrameBuffer(e,t,i){this.width=e,this.height=t,this.frameBuffer=i}onSessionEnded(){this.destroy()}onGlContextLost(){this.frameBuffer=null,this.colorTexture=null,this.renderBuffer=null}update(e,t,i){if(this.isWebXrEnabled){if(!t&&!i)if(e.isCustomViewportActive){const s=e.getViewport();t=s[2],i=s[3]}else t=this.viewer.getBaseFrameBufferWidth(),i=this.viewer.getBaseFrameBufferHeight()}else{const s=e.getViewport();t=s[2],i=s[3]}if(!this.colorTexture||t!==this.width||i!==this.height){const e=this.viewer.getGlContext();this.freeResources(),this.width=t,this.height=i;const s=e.getParameter(e.FRAMEBUFFER_BINDING);this.createBuffer(t,i),this.checkFrameBuffer()||this.textureType!==this.viewer.getHalfFloatType()||(this.textureType=e.FLOAT,a.log.info("The creation of a frame buffer with HALF_FLOAT failed.  Attempting to create buffer with full FLOAT"),this.freeResources(),this.createBuffer(t,i),this.checkFrameBuffer()),e.bindFramebuffer(e.FRAMEBUFFER,s||null)}}getColorTextureMemoryUsage(){return(0,s.getTextureSize)(this.width,this.height,s.GlPixelFormat.RGBA,this.textureType)}getRenderBufferMemoryUsage(){return this.renderBufferArguments?this.width*this.height*(0,s.sizeOfGlRenderBufferType)(this.renderBufferArguments.storageType):0}incrementMemoryGauge(){const e=this.viewer.getMemoryGauge();this.colorTexture&&e.incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getColorTextureMemoryUsage()),this.renderBuffer&&e.incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getRenderBufferMemoryUsage())}freeResources(){const e=this.viewer.getGlContext();if(!e)return;const t=this.viewer.getMemoryGauge();this.frameBuffer&&(e.deleteFramebuffer(this.frameBuffer),this.frameBuffer=null),this.colorTexture&&(t.decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getColorTextureMemoryUsage()),e.deleteTexture(this.colorTexture),this.colorTexture=null),this.renderBuffer&&(t.decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.getRenderBufferMemoryUsage()),e.deleteRenderbuffer(this.renderBuffer),this.renderBuffer=null)}createBuffer(e,t){const i=this.viewer.getGlContext();this.colorTexture=(0,s.createRGBATexture)(this.viewer,e,t,this.textureType),this.renderBufferArguments&&(this.renderBuffer=this.viewer.getOrCreateRenderBuffer(e,t,this.renderBufferArguments)),this.frameBuffer=i.createFramebuffer(),i.bindFramebuffer(i.FRAMEBUFFER,this.frameBuffer),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.colorTexture,0),this.renderBufferArguments&&i.framebufferRenderbuffer(i.FRAMEBUFFER,this.renderBufferArguments.attachmentType,i.RENDERBUFFER,this.renderBuffer),this.incrementMemoryGauge()}checkFrameBuffer(){const e=this.viewer.getGlContext();switch(e.checkFramebufferStatus(e.FRAMEBUFFER)){case e.FRAMEBUFFER_UNSUPPORTED:return a.log.warn(s.WEBGL_ERROR_LOG_TAG+"Framebuffer is unsupported"),!1;case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return this.textureType===this.viewer.getHalfFloatType()?a.log.info("Framebuffer incomplete attachment for half float type"):a.log.warn(s.WEBGL_ERROR_LOG_TAG+"Framebuffer incomplete attachment"),!1;case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return a.log.warn(s.WEBGL_ERROR_LOG_TAG+"Framebuffer incomplete dimensions"),!1;case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return a.log.warn(s.WEBGL_ERROR_LOG_TAG+"Framebuffer incomplete missing attachment"),!1}return!0}bindBuffer(){const e=this.viewer.getGlContext();e.bindFramebuffer(e.FRAMEBUFFER,this.frameBuffer)}unbindBuffer(){const e=this.viewer.getGlContext();e.bindFramebuffer(e.FRAMEBUFFER,null)}getTexture(){return this.colorTexture}resetBuffer(){this.freeResources()}getWidth(){return this.width}getHeight(){return this.height}}t.FrameBuffer=o},413366:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.FrameTimer=t.InteractionTypes=t.TimingDetails=t.getFramerateFromTime=void 0;const s=i(114924),n=i(649962);function r(e){return e<0?"--":(1e3/e).toFixed(1)}t.getFramerateFromTime=r;class a{constructor(){this.timings=[],this.averageTime=-1,this.framesSinceTiming=0,this.timingFrequency=10,this.timingCount=0,this.activeTimerQuery=null,this.pendingQueries=[],this.availableQueries=[],this.queryTimings=[],this.averageQueryTime=-1}reset(){this.timings=[],this.averageTime=-1,this.timingCount=0,this.framesSinceTiming=0,this.queryTimings=[],this.averageQueryTime=-1}onContextLost(){this.activeTimerQuery=null,this.pendingQueries=[],this.availableQueries=[]}hasTimings(){return this.timings.length>0}getAverageFramerate(){return 1e3/this.averageTime}onDrawStart(e,t){if(!e||!t)return;const i=t.getParameter(e.GPU_DISJOINT_EXT);let s;for(;s=this.pendingQueries.shift();)e.getQueryObjectEXT(s,e.QUERY_RESULT_AVAILABLE_EXT)&&(i||this.addQueryTiming(e.getQueryObjectEXT(s,e.QUERY_RESULT_EXT)/1e6),this.availableQueries.push(s));this.availableQueries.length>0?this.activeTimerQuery=this.availableQueries.shift():this.activeTimerQuery=e.createQueryEXT(),e.beginQueryEXT(e.TIME_ELAPSED_EXT,this.activeTimerQuery)}addQueryTiming(e){this.queryTimings.push(e),this.queryTimings.length>30&&this.queryTimings.shift();let t=0;for(let e=0;e<this.queryTimings.length;++e)t+=this.queryTimings[e];this.averageQueryTime=t/this.queryTimings.length}onDrawEnd(e){e&&this.activeTimerQuery&&(e.endQueryEXT(e.TIME_ELAPSED_EXT,this.activeTimerQuery),this.pendingQueries.push(this.activeTimerQuery),this.activeTimerQuery=null)}addTiming(e){this.timings.push(e),this.timings.length>5&&this.timings.shift();let t=0;for(let e=0;e<this.timings.length;++e)t+=this.timings[e];this.averageTime=t/this.timings.length,this.framesSinceTiming=0,++this.timingCount}}var o;t.TimingDetails=a,function(e){e[e.ADJUSTING_CAMERA=0]="ADJUSTING_CAMERA",e[e.MANIPULATING=1]="MANIPULATING",e[e.SYSTEM_ANIMATION=2]="SYSTEM_ANIMATION"}(o||(t.InteractionTypes=o={}));t.FrameTimer=class{constructor(e){this.viewer=e,this.timingFrameType=null,this.frameTimeStart=0,this.drawLoopStart=0,this.frameTimings=[],this.frameDetails={},this.drawLoopDetails={},this.interactionTimeouts={},(0,s.viewerCheck)(e),this.frameDetails[n.FrameType.INTERACTIVE]=new a,this.drawLoopDetails[n.FrameType.INTERACTIVE]=new a,this.disjointTimer=this.viewer.getExtension("EXT_disjoint_timer_query")}resetTimings(){this.frameDetails[n.FrameType.INTERACTIVE].reset(),this.drawLoopDetails[n.FrameType.INTERACTIVE].reset()}onContextLost(){Object.values(this.frameDetails).forEach((e=>{e.onContextLost()})),this.disjointTimer=null}onContextRestored(){this.disjointTimer=this.viewer.getExtension("EXT_disjoint_timer_query")}getAverageFrameRate(e){return r(this.frameDetails[e].averageTime)}getAverageQueryFrameRate(e){return this.disjointTimer?r(this.frameDetails[e].averageQueryTime):null}getTimingDetails(e){return this.frameDetails[e]}getDrawLoopDetails(e){return this.drawLoopDetails[e]}onDrawStart(){const e=this.getCurrentFrameType(),t=this.frameDetails[e];if(!t)return;t.onDrawStart(this.disjointTimer,this.viewer.getGlContext());const i=(0,s.getTimeInMilliseconds)();this.drawLoopStart=i,this.timingFrameType===e?(this.frameTimings.push(i-this.frameTimeStart),this.frameTimings.length<2?(this.frameTimeStart=i,this.viewer.forceRequestDraw()):(t.addTiming(Math.max(this.frameTimings[0],this.frameTimings[1])),this.timingFrameType=null)):(t.framesSinceTiming++,t.framesSinceTiming>=t.timingFrequency&&(this.frameTimeStart=i,this.timingFrameType=e,this.frameTimings=[],this.viewer.forceRequestDraw()))}onDrawEnd(){const e=this.getCurrentFrameType(),t=this.frameDetails[e];t&&t.onDrawEnd(this.disjointTimer);const i=this.drawLoopDetails[e];if(!i)return;const n=(0,s.getTimeInMilliseconds)();i.addTiming(n-this.drawLoopStart)}setUserIsInteractingWithTimeout(e){this.interactionTimeouts[e]&&window.clearTimeout(this.interactionTimeouts[e]);this.interactionTimeouts[e]=window.setTimeout((()=>{delete this.interactionTimeouts[e],this.viewer.requestDraw()}),500)}resetInteractionStatus(){Object.values(this.interactionTimeouts).forEach((function(e){window.clearTimeout(e)}),this),this.interactionTimeouts={}}setUserIsAdjustingCamera(){this.setUserIsInteractingWithTimeout(o.ADJUSTING_CAMERA)}setUserIsManipulatingWithTimeout(){this.setUserIsInteractingWithTimeout(o.MANIPULATING)}setSystemIsAnimating(){this.setUserIsInteractingWithTimeout(o.SYSTEM_ANIMATION)}userIsInteracting(){for(const e in this.interactionTimeouts)if(this.interactionTimeouts[e])return!0;return!1}userIsManipulating(){return!!this.interactionTimeouts[o.MANIPULATING]}getCurrentFrameType(){return this.userIsManipulating()?n.FrameType.MANIPULATING:this.userIsInteracting()?n.FrameType.INTERACTIVE:n.FrameType.FULL}}},613199:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.quat4C=t.mat4C=t.mat3C=t.mat2C=t.vec4C=t.vec3C=t.vec2C=void 0;const s=i(264292),n=i(873896);function r(e){return(t,i,s)=>(s||(s=t),e(s,t,i))}function a(e){return t=>e(t)}function o(e){return(t,i,s)=>(s||(s=t),e(s,t,i))}function c(e){return(t,i)=>e(t,i)}function l(e){return(t,i)=>(i||(i=t),e(i,t))}function h(e){return(t,i)=>(i||(i=t),e(i,t))}function d(e){return(t,i)=>e(t,i)}function u(e){return(t,i)=>e(i,t)}function g(e){return(t,i)=>e(t,i)}var p,m,E,I,T,S,f;function C(e){return(t,i,s)=>(s||(s=i),e(s,i,t))}function P(e){return(t,i)=>(i||(i=t),e(i,t))}function v(e){return(t,i,s)=>(s||(s=t),e(s,t,i))}function D(e){return(t,i,s)=>(s||(s=t),e(s,t,i))}!function(e){var t;e.subtract=r(s.vec2.subtract),e.length=a(s.vec2.length),e.scale=o(s.vec2.scale),e.add=(t=s.vec2.add,(e,i,s)=>(s||(s=i),t(s,e,i))),e.dot=c(s.vec2.dot),e.normalize=l(s.vec2.normalize),e.negate=h(s.vec2.negate),e.dist=d(s.vec2.dist),e.direction=(e,t,i)=>{i||(i=e);const s=e[0]-t[0],n=e[1]-t[1];let r=s*s+n*n;return r?(r=1/Math.sqrt(r),i[0]=s*r,i[1]=n*r,i):(i[0]=0,i[1]=0,i[2]=0,i)},e.squaredLength=e=>s.vec2.squaredLength(e),e.set=u(s.vec2.copy),e.distanceSquared=g(s.vec2.squaredDistance),e.cross=(e,t)=>{const i=s.vec3.create();return s.vec2.cross(i,e,t),i[2]}}(p||(t.vec2C=p={})),function(e){e.getAPerpendicularVector=e=>{const t=e[0],i=e[1];return Math.abs(t)<n.Tolerances.ZERO_LENGTH&&Math.abs(i)<n.Tolerances.ZERO_LENGTH?s.vec3.fromValues(1,0,0):s.vec3.fromValues(-i,t,0)},e.equal=s.vec3.equals,e.subtract=r(s.vec3.subtract),e.dist=d(s.vec3.dist),e.setXYZ=(e,t,i,n)=>(s.vec3.set(n,e,t,i),n),e.set=u(s.vec3.copy),e.scale=o(s.vec3.scale),e.dot=c(s.vec3.dot),e.add=(e,t,i)=>(i||(i=e),s.vec3.add(i,e,t)),e.negate=h(s.vec3.negate),e.normalize=l(s.vec3.normalize),e.length=a(s.vec3.length),e.cross=(e,t,i)=>(i||(i=e),s.vec3.cross(i,e,t)),e.distanceSquared=g(s.vec3.squaredDistance),e.squaredLength=e=>s.vec3.squaredLength(e),e.linComb=(e,t,i,s,n)=>(n||(n=e),n[0]=e[0]*t+i[0]*s,n[1]=e[1]*t+i[1]*s,n[2]=e[2]*t+i[2]*s,n);let t=null;const i=s.vec4.create();e.unproject=(e,n,r,a,o)=>{o||(o=e),t||(t=s.mat4.create());const c=t,l=i;return l[0]=2*(e[0]-a[0])/a[2]-1,l[1]=2*(e[1]-a[1])/a[3]-1,l[2]=2*e[2]-1,l[3]=1,s.mat4.multiply(c,r,n),s.mat4.invert(c,c)?(s.vec4.transformMat4(l,l,c),0===l[3]?null:(o[0]=l[0]/l[3],o[1]=l[1]/l[3],o[2]=l[2]/l[3],o)):null}}(m||(t.vec3C=m={})),function(e){e.negate=h(s.vec4.negate),e.setXYZW=(e,t,i,n,r)=>(s.vec4.set(r,e,t,i,n),r),e.distanceSquared=g(s.vec4.squaredDistance),e.subtract=r(s.vec4.subtract),e.set=u(s.vec4.copy)}(E||(t.vec4C=E={})),function(e){e.multiplyVec2=(e,t,i)=>{i||(i=t);const s=t[0],n=t[1];return i[0]=s*e[0]+n*e[1],i[1]=s*e[2]+n*e[3],i},e.transpose=P(s.mat2.transpose)}(I||(t.mat2C=I={})),function(e){e.multiplyVec2=C(s.vec2.transformMat3),e.transpose=P(s.mat3.transpose),e.multiply=v(s.mat3.multiply),e.multiplyVec3=C(s.vec3.transformMat3)}(T||(t.mat3C=T={})),function(e){e.createFrom=s.mat4.fromValues,e.equal=s.mat4.equals,e.multiply=v(s.mat4.multiply),e.multiplyVec4=C(s.vec4.transformMat4),e.multiplyVec3=C(s.vec3.transformMat4),e.inverse=(e,t)=>(t||(t=e),s.mat4.invert(t,e)),e.toRotationMat=(e,t)=>(t||(t=s.mat4.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),e.translate=(e,t,i)=>(i||(i=e),s.mat4.translate(i,e,t)),e.rotate=(e,t,i,n)=>(n||(n=e),s.mat4.rotate(n,e,t,i)),e.toMat3=(e,t)=>(t||(t=s.mat3.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t),e.fromRotationTranslation=(e,t,i)=>(i||(i=s.mat4.create()),s.mat4.fromRotationTranslation(i,e,t)),e.scale=(e,t,i)=>(i||(i=e),s.mat4.scale(i,e,t)),e.rotateX=D(s.mat4.rotateX),e.rotateY=D(s.mat4.rotateY),e.rotateZ=D(s.mat4.rotateZ),e.lookAt=(e,t,i,n)=>(n||(n=s.mat4.create()),s.mat4.lookAt(n,e,t,i)),e.perspective=(e,t,i,n,r)=>{r||(r=s.mat4.create());const a=i*Math.tan(e*Math.PI/360),o=a*t;return s.mat4.frustum(r,-o,o,-a,a,i,n)},e.ortho=(e,t,i,n,r,a,o)=>(o||(o=s.mat4.create()),s.mat4.ortho(o,e,t,i,n,r,a)),e.set=(e,t)=>s.mat4.copy(t,t)}(S||(t.mat4C=S={})),function(e){e.normalize=l(s.quat.normalize),e.multiply=(e,t,i)=>(i||(i=e),s.quat.multiply(i,e,t)),e.toMat4=(e,t)=>(t||(t=s.mat4.create()),s.mat4.fromQuat(t,e)),e.dot=s.quat.dot,e.multiplyVec3=(e,t,i)=>(i||(i=t),s.vec3.transformQuat(i,t,e)),e.fromAngleAxis=(e,t,i)=>{i||(i=s.quat.create());const n=.5*e,r=Math.sin(n);return i[3]=Math.cos(n),i[0]=r*t[0],i[1]=r*t[1],i[2]=r*t[2],i}}(f||(t.quat4C=f={}))},165890:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.removeHighlightFromList=t.addHighlightToList=t.HighlightManager=t.ReferenceHighlights=t.sortHighlights=t.fillHighlightWithDefault=t.highlightsEqual=t.Highlight=t.HighlightFlag=t.HighlightPriority=void 0;const s=i(545348),n=i(85655),r=i(550122),a=i(261936),o=i(114924);var c,l;!function(e){e[e.OPERATION_PERSISTENT=0]="OPERATION_PERSISTENT",e[e.UI=1]="UI",e[e.FILTERED_ENTITIES=2]="FILTERED_ENTITIES",e[e.ACCUMULATED_SMART_SELECTION=3]="ACCUMULATED_SMART_SELECTION",e[e.SMART_SELECTION=4]="SMART_SELECTION",e[e.INCONTEXT_REFERENCE_PRE=5]="INCONTEXT_REFERENCE_PRE",e[e.ASSOCIATED_OCCURRENCE_PRE=6]="ASSOCIATED_OCCURRENCE_PRE",e[e.OCCURRENCE_SECONDARY_PRE=7]="OCCURRENCE_SECONDARY_PRE",e[e.PRE=8]="PRE",e[e.OCCURRENCE_PRE=9]="OCCURRENCE_PRE",e[e.COMMENT=10]="COMMENT",e[e.INCONTEXT_REFERENCE=11]="INCONTEXT_REFERENCE",e[e.OCCURRENCE_COMMENT=12]="OCCURRENCE_COMMENT",e[e.UI_RELATED_ENTITY=13]="UI_RELATED_ENTITY",e[e.ASSOCIATED_OCCURRENCE=14]="ASSOCIATED_OCCURRENCE",e[e.RELATED_OCCURRENCE=15]="RELATED_OCCURRENCE",e[e.OCCURRENCE=16]="OCCURRENCE",e[e.PART=17]="PART",e[e.FEATURE=18]="FEATURE",e[e.ENTITY=19]="ENTITY",e[e.ERROR=20]="ERROR",e[e.SECONDARY_PRE=21]="SECONDARY_PRE",e[e.SECONDARY=22]="SECONDARY",e[e.RETRIEVAL=23]="RETRIEVAL",e[e.REPAIR=24]="REPAIR",e[e.REPAIR_HOVER=25]="REPAIR_HOVER"}(c||(t.HighlightPriority=c={})),function(e){e[e.NO_HIGHLIGHT=0]="NO_HIGHLIGHT",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.SUPPRESS_INTERIOR=2]="SUPPRESS_INTERIOR"}(l||(t.HighlightFlag=l={}));class h{constructor(e,t,i,s,n,r){this.type=e,this.priority=t,this.color1=[0,0,0,0],this.colorBorder=[0,0,0,0],this.indexInstanceIdColor=[0,0,0,l.HIGHLIGHT/255],this.style=null,this.index=0,this.idString="",this.debugStack=null,this.usage=o.BTGraphicsUsage.BASE,this.associatedPrimaryHighlightType=r||null,this.outlineOverlappingInteriorRegions=this.type===a.HighlightType.ENTITY||this.type===a.HighlightType.SMART_SELECTION||this.type===a.HighlightType.ACCUMULATED_SMART_SELECTION,this.forOccurrences=this.type===a.HighlightType.OCCURRENCE||this.type===a.HighlightType.OCCURRENCE_PRE||this.type===a.HighlightType.OCCURRENCE_COMMENT||this.type===a.HighlightType.OCCURRENCE_SECONDARY_PRE||this.type===a.HighlightType.RELATED_OCCURRENCE||this.type===a.HighlightType.RELATED_OCCURRENCE_MATE||this.type===a.HighlightType.ASSOCIATED_OCCURRENCE||this.type===a.HighlightType.ASSOCIATED_OCCURRENCE_PRE||this.type===a.HighlightType.RETRIEVAL||this.type===a.HighlightType.OPERATION_PERSISTENT,this.updateColors(),void 0!==i&&this.setIndex(i),this.instanceId=o.INVALID_ID,void 0!==s&&this.setInstanceId(s),this.occurrence=n}updateColors(e){const t=s.default.getManager();if(this.color1=t.getColor(this.type+"_HIGHLIGHT_COLOR1"),this.colorBorder=t.getColor(this.type+"_HIGHLIGHT_COLOR_BORDER"),e)for(let t=0;t<3;t++)this.color1[t]=e[t],this.colorBorder[t]=e[t]}getIdString(){return this.idString}cloneForOccurrence(e){return new h(this.type,this.priority,this.index,this.instanceId,e,this.associatedPrimaryHighlightType)}cloneForInstance(e){return new h(this.type,this.priority,this.index,e,this.occurrence,this.associatedPrimaryHighlightType)}setIndex(e){this.index=e,this.updateIndexInstanceColor()}setInstanceId(e){this.instanceId=e,this.idString=this.type+"."+this.instanceId,this.updateIndexInstanceColor()}getInstanceNumber(){return(0,o.idIsValid)(this.instanceId)?Math.max(255&this.instanceId[0],1):0}updateIndexInstanceColor(){this.indexInstanceIdColor[0]=(255&this.index)/255;const e=this.getInstanceNumber();this.indexInstanceIdColor[1]=(e>>>4&15)/255,this.indexInstanceIdColor[2]=(15&e)/255}getStyle(){return this.style||(this.style=new o.Style,this.style.setAttribute(o.Attributes.HIGHLIGHT_ID,this.indexInstanceIdColor)),this.style}getIndexInstanceEncodedInFloat(){return this.index+256*this.getInstanceNumber()}}function d(e,t){return e.type===t.type&&e.instanceId===t.instanceId&&e.associatedPrimaryHighlightType===t.associatedPrimaryHighlightType&&(0,n.occurrencesEqual)(e.occurrence,t.occurrence)}function u(e){e[a.HighlightType.UI]=new h(a.HighlightType.UI,c.UI),e[a.HighlightType.RELATED_OCCURRENCE]=new h(a.HighlightType.RELATED_OCCURRENCE,c.RELATED_OCCURRENCE),e[a.HighlightType.RELATED_OCCURRENCE_MATE]=new h(a.HighlightType.RELATED_OCCURRENCE_MATE,c.RELATED_OCCURRENCE),e[a.HighlightType.ACCUMULATED_SMART_SELECTION]=new h(a.HighlightType.ACCUMULATED_SMART_SELECTION,c.ACCUMULATED_SMART_SELECTION),e[a.HighlightType.SMART_SELECTION]=new h(a.HighlightType.SMART_SELECTION,c.SMART_SELECTION),e[a.HighlightType.UI_RELATED_ENTITY]=new h(a.HighlightType.UI_RELATED_ENTITY,c.ENTITY),e[a.HighlightType.ENTITY]=new h(a.HighlightType.ENTITY,c.ENTITY),e[a.HighlightType.FEATURE]=new h(a.HighlightType.FEATURE,c.FEATURE),e[a.HighlightType.PART]=new h(a.HighlightType.PART,c.PART),e[a.HighlightType.OCCURRENCE]=new h(a.HighlightType.OCCURRENCE,c.OCCURRENCE),e[a.HighlightType.OCCURRENCE_PRE]=new h(a.HighlightType.OCCURRENCE_PRE,c.OCCURRENCE_PRE),e[a.HighlightType.PRE]=new h(a.HighlightType.PRE,c.PRE),e[a.HighlightType.SECONDARY]=new h(a.HighlightType.SECONDARY,c.SECONDARY),e[a.HighlightType.SECONDARY_PRE]=new h(a.HighlightType.SECONDARY_PRE,c.SECONDARY_PRE),e[a.HighlightType.OCCURRENCE_SECONDARY_PRE]=new h(a.HighlightType.OCCURRENCE_SECONDARY_PRE,c.OCCURRENCE_SECONDARY_PRE),e[a.HighlightType.COMMENT]=new h(a.HighlightType.COMMENT,c.COMMENT),e[a.HighlightType.FILTERED_ENTITIES]=new h(a.HighlightType.FILTERED_ENTITIES,c.FILTERED_ENTITIES),e[a.HighlightType.OCCURRENCE_COMMENT]=new h(a.HighlightType.OCCURRENCE_COMMENT,c.OCCURRENCE_COMMENT),e[a.HighlightType.ASSOCIATED_OCCURRENCE]=new h(a.HighlightType.ASSOCIATED_OCCURRENCE,c.ASSOCIATED_OCCURRENCE),e[a.HighlightType.ASSOCIATED_OCCURRENCE_PRE]=new h(a.HighlightType.ASSOCIATED_OCCURRENCE_PRE,c.ASSOCIATED_OCCURRENCE_PRE),e[a.HighlightType.ERROR]=new h(a.HighlightType.ERROR,c.ERROR),e[a.HighlightType.INCONTEXT_REFERENCE]=new h(a.HighlightType.INCONTEXT_REFERENCE,c.INCONTEXT_REFERENCE),e[a.HighlightType.INCONTEXT_REFERENCE_PRE]=new h(a.HighlightType.INCONTEXT_REFERENCE_PRE,c.INCONTEXT_REFERENCE_PRE),e[a.HighlightType.RETRIEVAL]=new h(a.HighlightType.RETRIEVAL,c.RETRIEVAL),e[a.HighlightType.OPERATION_PERSISTENT]=new h(a.HighlightType.OPERATION_PERSISTENT,c.OPERATION_PERSISTENT),e[a.HighlightType.REPAIR]=new h(a.HighlightType.REPAIR,c.REPAIR),e[a.HighlightType.REPAIR_HOVER]=new h(a.HighlightType.REPAIR_HOVER,c.REPAIR_HOVER)}function g(e,t){for(const i in e)t.push(e[i]);t.sort((function(e,t){return e.priority>t.priority?1:e.priority<t.priority?-1:0}));for(let e=0;e<t.length;++e)t[e].setIndex(e)}t.Highlight=h,t.highlightsEqual=d,t.fillHighlightWithDefault=u,t.sortHighlights=g;t.ReferenceHighlights=class{constructor(e){this.viewer=e,this.highlights={},this.sortedHighlights=[],(0,o.viewerCheck)(e),u(this.highlights),g(this.highlights,this.sortedHighlights)}getSortedHighlights(){return this.sortedHighlights}getHighlightTextureWidth(){return this.sortedHighlights.length}updateHighlightColor(e,t){this.highlights[e].updateColors(t),this.viewer.getResources().invalidateHighlightTexture()}destroy(){this.highlights={},this.sortedHighlights=[]}};t.HighlightManager=class{constructor(e){this.referenceHighlights=e,this.highlightInstanceIdManagers={},this.highlightToSelectionToInstanceId={},this.usage=o.BTGraphicsUsage.BASE;for(const e in a.HighlightType)this.highlightInstanceIdManagers[e]=new o.IdManager(o.IdSizes.HIGHLIGHT),this.highlightToSelectionToInstanceId[e]={}}getInstanceIdForHighlightAndSelection(e,t){const i=this.highlightToSelectionToInstanceId[e][t];return i||o.INVALID_ID}constructHighlightForTypeAndInstance(e,t,i=!1){const s=this.referenceHighlights.highlights[e].cloneForInstance(t);if(s.usage=this.usage,i){(255*s.indexInstanceIdColor[3]&l.SUPPRESS_INTERIOR)>0||(s.indexInstanceIdColor[3]+=l.SUPPRESS_INTERIOR/255)}return s}createHighlightForSelection(e,t,i=!1){if(!this.referenceHighlights)return new h(a.HighlightType.ERROR,c.ERROR);let s=this.getInstanceIdForHighlightAndSelection(e,t);return(0,o.idIsValid)(s)||(s=this.highlightInstanceIdManagers[e].getId(),this.highlightToSelectionToInstanceId[e][t]=s),this.constructHighlightForTypeAndInstance(e,s,i)}freeHighlightForSelection(e,t){const i=this.getInstanceIdForHighlightAndSelection(e,t);return(0,o.idIsValid)(i)&&(this.highlightInstanceIdManagers[e].freeId(i),delete this.highlightToSelectionToInstanceId[e][t]),i}createSecondaryHighlight(e,t,i){const s=this.createHighlightForSelection(e,i+r.ID_SEPARATOR+t);return s.associatedPrimaryHighlightType=t,s}freeSecondaryHighlight(e,t,i){this.freeHighlightForSelection(e,i+r.ID_SEPARATOR+t)}resetHighlightInstanceIds(e){this.highlightInstanceIdManagers[e].reset(),this.highlightToSelectionToInstanceId[e]={}}highlightHasSelections(e){return!(0,o.isMapEmpty)(this.highlightToSelectionToInstanceId[e])}},t.addHighlightToList=function(e,t){let i=0;for(let s=0;s<t.length;++s){if(d(t[s],e))return-1;if(e.priority<t[s].priority)break;++i}return t.splice(i,0,e),i},t.removeHighlightFromList=function(e,t,i){let s=-1;for(let n=0;n<t.length;++n)if(i&&e.type===t[n].type||d(t[n],e)){s=n;break}return s<0||t.splice(s,1),s}},743159:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IconView=void 0;const s=i(545348),n=i(114924),r=i(264292),a=i(613199);class o extends n.UIElement{constructor(e,t,i){super(i,n.HUD_SCENEGRAPH_ID),this.iconNodeProperties=this.viewer.getResources().typeToNodeProperties[n.sketchinformation.nodePropertiesTypes.OK],this.worldLocation=t;const r=s.default.getManager();this.iconSizeConstantName="CONSTRAINT_INDICATOR_PIXEL_SIZE",this.iconSize=r.getNumber(this.iconSizeConstantName),this.icon=e,this.listenTo(this.viewer.getEventDispatcher(),n.VIEW_WILL_PICK,this.onViewWillDraw),(0,n.ensureTextureAtlas)(this.viewer),this.invalidateDisplay()}invalidateDisplay(){this.removeMeshIncrements(),(0,n.requestDraw)()}getOffset(e){const t=r.vec2.fromValues(0,1),i=function(e,i){return r.vec2.dot(r.vec2.fromValues(e,i),t)},a=-Math.abs(i(.5,.5)),o=-Math.abs(i(.5,-.5)),c=s.default.getManager().getNumber("TEMPORARY_INFERENCE_OFFSET")-Math.min(a,o),l=-.99*(0,n.getHudLayerDepthRange)(e.getViewport())[1];return[t[0]*c,t[1]*c,l]}onDevicePixelRatioChanged(e){const t=s.default.getManager();this.iconSize=t.getNumber(this.iconSizeConstantName),this.invalidateDisplay()}onViewWillDraw(e,t){if(!this.viewer.getResources().constraintAtlas)return;const i=this.getOffset(e),s=this.getDefaultTransform(e);a.mat4C.translate(s,i),s[12]=Math.floor(s[12]),s[13]=Math.floor(s[13]),this.setTransform(s),this.updateIconGraphics()}getDefaultTransform(e){let t=e.projectWorldPointToViewport(this.worldLocation);t[2]=0;const i=r.vec3.fromValues(0,0,0);t=a.vec3C.add(t,i);const s=a.mat4C.translate(r.mat4.create(),t),n=this.iconSize;return a.mat4C.scale(s,[n,n,1]),s}updateIconGraphics(){if(!this.viewer.getResources().constraintAtlas)return;const e=-.5,t=this.icon.id,i=this.viewer.getResources().constraintAtlas.getTextureCoords(t);if(!i)return;const s=(0,n.createQuad)([e,-.5,0],[.5,-.5,0],[e,.5,0],t,[i.lowS,i.highT],[i.highS,i.lowT]);this.updateMeshIncrement(t,"0",s,this.iconNodeProperties)}}t.IconView=o},147730:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ImageDisplay=void 0;const s=i(545348),n=i(193786),r=i(148734),a=i(114924),o=s.default.getManager(),c="image";class l extends a.UIElement{constructor(e,t,i,s,n,o,l,h,d,u,g){super(h,l===a.BTGraphicsUsage.PREVIEW?a.PREVIEW_SCENEGRAPH_ID:void 0),this.sketchEntityId=e,this.bottomLeftCorner=i,this.bottomRightCorner=s,this.topLeftCorner=n,this.texture=o,this.usage=l,this.isOnFlat=d,this.flattenedBodyId=u,this.transform=g,this.ownsTexture=!1,this.material=null,this.isActive=!1,this.id="image",this.url=(0,r.updateUriWithWorkspaceId)(t),this.listenTo(this,a.UiEvents.CLICK+c,this.onClick),this.updateImage(t,i,s,n),this.occurrenceData.setCanIsolateChange(!0)}getSource(){return{documentId:(0,r.getUriComponent)(this.url,"/d/"),elementId:(0,r.getUriComponent)(this.url,"/e/"),documentVersionId:(0,r.getUriComponent)(this.url,"/v/")}}updateImage(e,t,i,s){const n=this.viewer.getGlContext();let l=(0,r.updateUriWithWorkspaceId)(e);if(l||(l=this.url),this.url=l,this.bottomLeftCorner=t,this.bottomRightCorner=i,this.topLeftCorner=s,!l)return void this.removeMeshIncrement("image");if(!n)return;if(this.texture&&this.url!==l&&(this.texture.destroy(),this.texture=null,this.material&&(this.material.destroy(),this.material=null)),!this.texture){const e=new a.TextureDefinition(n);e.imageSource=l,e.minificationFilter=n.LINEAR,e.magnificationFilter=n.LINEAR,e.defersRendering=!0,this.texture=new a.Texture(this.viewer,e),this.ownsTexture=!0}this.material||(this.material=(0,a.createTextureMaterial)(this.texture));const h=new a.NodeProperties({primitiveType:a.PrimitiveType.TRIANGLES,isPickable:this.isActive,isDepthTested:!1,isTwoSided:!0,includedInBlend:!0,material:this.material}),d=(0,a.createQuad)(this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner,void 0,[0,1],[1,0]).createTransformed(this.transform),u=this.isActive?o.getNumber("SKETCH_IMAGE_ACTIVE_OPACITY"):o.getNumber("SKETCH_IMAGE_INACTIVE_OPACITY");(0,a.addColorToIncrement)([1,1,1,u],d),this.updateMeshIncrement(c,c,d,h),this.isHidden&&this.hideIncrements()}remove(){this.texture&&this.ownsTexture&&(this.texture.destroy(),this.texture=null,this.ownsTexture=!1),this.material&&(this.material.destroy(),this.material=null),super.remove()}getUsage(){return this.usage}onClick(){(0,n.clearSelection)()}getPickPriority(e){return a.PickPriority.SKETCH_FACE}cloneForPreview(){const e=new l(this.sketchEntityId,this.url,this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner,this.texture,a.BTGraphicsUsage.PREVIEW,this.viewer,this.isOnFlat,this.flattenedBodyId,this.transform);return this.isHidden&&e.hide(),this.isActive&&e.activate(),e}activate(){this.isActive=!0,this.updateImage(this.url,this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner)}deactivate(){this.isActive=!1,this.updateImage(this.url,this.bottomLeftCorner,this.bottomRightCorner,this.topLeftCorner)}preventsSketching(){return!1}}t.ImageDisplay=l},327170:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IdSizes=t.Id=t.IdManager=t.INVALID_OCCURRENCE_ID=t.HUD_MODEL_SCENEGRAPH_ID=t.HighlightType=t.GraphicsRefinementMode=t.GRAPHICS_HANDLED_CLICK_EVENT=t.GL_CONTEXT_RESTORED=t.GL_CONTEXT_LOST=t.FrameType=t.EventData=t.ELEMENT_VIEW_INITIALIZED=t.ELEMENT_PREVIEW_GRAPHICS_LOADED=t.ELEMENT_GRAPHICS_LOADING=t.DISPLAYED_PART_STUDIO=t.DIMENSION_VALUE_CHANGED=t.DIMENSION_TEXT_SINGLE_CLICKED=t.DIMENSION_TEXT_DOUBLE_CLICKED=t.DIMENSION_EDIT_CLOSED=t.DIMENSION_DELETE_REQUEST=t.DID_RENDER_THUMBNAILS=t.DEVICE_PIXEL_RATIO_CHANGED=t.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER=t.DEFAULT_UNITS_CHANGED=t.DEFAULT_PREVIEW_OPACITY=t.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER=t.CLOSE_SKETCH_SUB_DIALOG=t.CLOSE_SELECT_OTHER=t.CLOSE_MATE_DOF_CHOOSER=t.CLOSE_DIMENSION_EDIT=t.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES=t.CHANGE_VIEW=t.CHANGE_FEATURE_APPEARANCE=t.CANVAS_MOUSEMOVE=t.CANVAS_MOUSELEAVE=t.CANVAS_CLICK=t.AnimationCallbackStatus=t.Action=t.ASSEMBLY_DATA_PROCESSED=t.ASSEMBLY_ANIMATE_MATE_STARTED=t.ASSEMBLY_ANIMATE_MATE_ENDED=t.ADD_TEMPORARY_TESSELLATION_OVERRIDES=t.ACTIVE_VIEWER_SET=t.ACTIVE_SHEETMETAL_MODEL_CHANGED=t.BTGraphicsUsage=t.BTGraphicsISectionPlane=t.BTGraphicsIDistanceDisplay=t.BTGraphicsIAngleDisplay=t.btTs=void 0,t.viewerCheck=t.userWebPreferencesGetManager=t.resetUsage=t.OccurrenceId=t.NamedIdManager=t.isUsagePreview=t.isUsageCompare=t.isUsageBase=t.idIsValid=t.idsEqual=t.getObservableFromActiveViewerForEvent=t.getFocusedViewer=t.getEditState=t.getDisplayedElementObservable=t.getActiveViewerModelViewManagers=t.getActiveViewerEventDispatcher=t.getActiveViewer=t.enableSectionPlaneSelection=t.disableSectionPlaneSelection=t.WILL_RENDER_THUMBNAILS=t.NAMED_VIEW_APPLIED=t.VIEW_WILL_DRAW=t.VIEW_DID_DRAW=t.VIEW_CONTAINER_MENU_INVOKED=t.VIEWER_CANVAS_ATTACHED_TO_CONTAINER=t.UPDATE_INCONTEXT_ISOLATION=t.SPACEMOUSE_COMMANDS_RECEIVED=t.SKETCH_COMMAND_ACTIVATED=t.SHOW_SMART_SELECTION=t.SHOW_SKETCH_TEXT=t.SELECT_OTHER_REVERSE=t.SELECT_OTHER=t.SELECTION_REJECTED=t.SECTION_VIEW_DIALOG_OPENED=t.SECTION_VIEW_DIALOG_CLOSED=t.SECTIONPLANE_SELECTION_ID=t.SECTION_PLANE_REMOVED=t.SECTION_PLANE_ADDED=t.RETRIEVE_SMOOTH_EDGE_INFORMATION=t.RETRIEVE_ELEMENT_DISPLAY_DATA=t.RETRIEVE_OCCURRENCE_DISPLAY_DATA=t.PART_STUDIO_PART_VISIBILITY_CHANGED=t.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED=t.NEW_PART_LIST=t.ManipulationMode=t.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED=t.MAIN_SCENEGRAPH_ID=t.IXrController=t.INVALID_ID=t.IntersectionType=void 0,t.getMaxSectionPlanes=t.getHasFeatureQLVFacePatternCapability=t.getFeatureThumbnailKey=t.getDrawers=t.getDrawer=t.getDefaultNameForBody=t.getCurrentSectionPlaneParameters=t.getCounters=t.getColorStringArray=t.getAngle=t.getActiveViewerSketch=t.getActiveSectionViewState=t.getActiveSectionPlane=t.forEachActiveSectionPlane=t.distanceSquaredToLineSegment2d=t.distanceSquaredBetweenPoints=t.displayEntity=t.deselectEntities=t.createTestViewer=t.createPolyline=t.createInferenceIcon=t.createDimensionForDisplayData=t.createCirclePolyline=t.createArcPolyline=t.clearSavedSectionPlaneParameters=t.cacheCapabilities=t.areAnySectionPlanesSelectedOrPreselected=t.areMatricesEqual=t.are2dPointsEqual=t.angleBetweenVectors=t.addStyleToIncrement=t.ViewerSet=t.View=t.UiEvents=t.UISelection=t.UIElement=t.Text=t.TemporarySketchComponent=t.StandardViews=t.SplineHandle=t.SketchPlaneDisplay=t.Sketch=t.ExplodeLineLineSegment=t.ExplodeLineArcSegment=t.ExplodeLineDefinition=t.ExplodeLine=t.EntityData=t.DEFAULT_SIMULATION_COLOR_MAPPING=t.CursorAppendageLeader=t.CursorAppendage=void 0,t.setSectionPlaneOnMatrix=t.setSectionPlaneOnMateConnector=t.setSectionEntitiesEnabled=t.setIsInSectionPlaneMode=t.setIsInFollowMode=t.setInteractionEnabled=t.setFromSerializableSectionViewData=t.setFromSerializablePlaneData=t.setForceHideInteriorSelections=t.setDimensionToolActive=t.setBoxSelectionEnabled=t.setBaseHighlightsEnabled=t.collectGraphicsDataForHeapDump=t.requestDraw=t.removeSectionPlanes=t.removeSectionPlane=t.removeGraphicsViewers=t.projectToLine=t.PREVIOUS_VERSION_CANVAS_SELECTOR=t.preserveViewersForDocumentId=t.loadSectionPlanesFromParameters=t.isSectionPlaneModeEnabled=t.isRendererStringForDedicatedIntel=t.isRendererStringForIntel=t.IsolatedOccurrencesManager=t.isMapEmpty=t.isInSectionPlaneMode=t.intersectTwoLines2d=t.intersectTwoLineSegments2d=t.intersectLineSegmentRay=t.initializePreviousVersionViewer=t.GlRendererInfo=t.graphicsTakesSelectionPrecedence=t.getZoomToWindowState=t.getUnavailableRendererInfo=t.getTimeInMilliseconds=t.getThumbnailForKey=t.getSerializableSectionViewData=t.getSerializablePlaneData=t.getSectionPlaneCount=t.getSectionedItemsSize=t.getRendererInfo=t.getPointAtAngle=t.getPlaneIndexToAlignNormalTo=t.getPerpendicularBisector2d=t.getPartThumbnailKey=t.getPartStudioThumbnailKey=t.getOrCreateViewerSet=t.getMouseSettingsManager=t.getMostRecentActiveSectionPlaneParameters=void 0,t.basicPickSort=t.estimateTriangleCountAtSettingIndexUsingTriangleCounts=t.DragTrimLine=t.unprojectVectorToWorld=t.unprojectPlaneToWorld=t.toggleZoomModifierEnabled=t.timeRendering=t.tessellateArc=t.snapshotScenegraph=t.setZoomModeEnabled=t.setViewCubeMenuMgrInstance=t.setTransparencyTransition=t.setThumbnailForKey=t.setShowDimensionsMode=void 0;const s=i(736234),n=i(474326);t.btTs=(0,s.merge)({},n.btTs);var r=i(683067);Object.defineProperty(t,"BTGraphicsIAngleDisplay",{enumerable:!0,get:function(){return r.BTGraphicsIAngleDisplay}}),Object.defineProperty(t,"BTGraphicsIDistanceDisplay",{enumerable:!0,get:function(){return r.BTGraphicsIDistanceDisplay}}),Object.defineProperty(t,"BTGraphicsISectionPlane",{enumerable:!0,get:function(){return r.BTGraphicsISectionPlane}}),Object.defineProperty(t,"BTGraphicsUsage",{enumerable:!0,get:function(){return r.BTGraphicsUsage}}),Object.defineProperty(t,"ACTIVE_SHEETMETAL_MODEL_CHANGED",{enumerable:!0,get:function(){return r.ACTIVE_SHEETMETAL_MODEL_CHANGED}}),Object.defineProperty(t,"ACTIVE_VIEWER_SET",{enumerable:!0,get:function(){return r.ACTIVE_VIEWER_SET}}),Object.defineProperty(t,"ADD_TEMPORARY_TESSELLATION_OVERRIDES",{enumerable:!0,get:function(){return r.ADD_TEMPORARY_TESSELLATION_OVERRIDES}}),Object.defineProperty(t,"ASSEMBLY_ANIMATE_MATE_ENDED",{enumerable:!0,get:function(){return r.ASSEMBLY_ANIMATE_MATE_ENDED}}),Object.defineProperty(t,"ASSEMBLY_ANIMATE_MATE_STARTED",{enumerable:!0,get:function(){return r.ASSEMBLY_ANIMATE_MATE_STARTED}}),Object.defineProperty(t,"ASSEMBLY_DATA_PROCESSED",{enumerable:!0,get:function(){return r.ASSEMBLY_DATA_PROCESSED}}),Object.defineProperty(t,"Action",{enumerable:!0,get:function(){return r.Action}}),Object.defineProperty(t,"AnimationCallbackStatus",{enumerable:!0,get:function(){return r.AnimationCallbackStatus}}),Object.defineProperty(t,"CANVAS_CLICK",{enumerable:!0,get:function(){return r.CANVAS_CLICK}}),Object.defineProperty(t,"CANVAS_MOUSELEAVE",{enumerable:!0,get:function(){return r.CANVAS_MOUSELEAVE}}),Object.defineProperty(t,"CANVAS_MOUSEMOVE",{enumerable:!0,get:function(){return r.CANVAS_MOUSEMOVE}}),Object.defineProperty(t,"CHANGE_FEATURE_APPEARANCE",{enumerable:!0,get:function(){return r.CHANGE_FEATURE_APPEARANCE}}),Object.defineProperty(t,"CHANGE_VIEW",{enumerable:!0,get:function(){return r.CHANGE_VIEW}}),Object.defineProperty(t,"CLEAR_TEMPORARY_TESSELLATION_OVERRIDES",{enumerable:!0,get:function(){return r.CLEAR_TEMPORARY_TESSELLATION_OVERRIDES}}),Object.defineProperty(t,"CLOSE_DIMENSION_EDIT",{enumerable:!0,get:function(){return r.CLOSE_DIMENSION_EDIT}}),Object.defineProperty(t,"CLOSE_MATE_DOF_CHOOSER",{enumerable:!0,get:function(){return r.CLOSE_MATE_DOF_CHOOSER}}),Object.defineProperty(t,"CLOSE_SELECT_OTHER",{enumerable:!0,get:function(){return r.CLOSE_SELECT_OTHER}}),Object.defineProperty(t,"CLOSE_SKETCH_SUB_DIALOG",{enumerable:!0,get:function(){return r.CLOSE_SKETCH_SUB_DIALOG}}),Object.defineProperty(t,"CREATE_SECTION_PLANE_INFERENCE_CONTROLLER",{enumerable:!0,get:function(){return r.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER}}),Object.defineProperty(t,"DEFAULT_PREVIEW_OPACITY",{enumerable:!0,get:function(){return r.DEFAULT_PREVIEW_OPACITY}}),Object.defineProperty(t,"DEFAULT_UNITS_CHANGED",{enumerable:!0,get:function(){return r.DEFAULT_UNITS_CHANGED}}),Object.defineProperty(t,"DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER",{enumerable:!0,get:function(){return r.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER}}),Object.defineProperty(t,"DEVICE_PIXEL_RATIO_CHANGED",{enumerable:!0,get:function(){return r.DEVICE_PIXEL_RATIO_CHANGED}}),Object.defineProperty(t,"DID_RENDER_THUMBNAILS",{enumerable:!0,get:function(){return r.DID_RENDER_THUMBNAILS}}),Object.defineProperty(t,"DIMENSION_DELETE_REQUEST",{enumerable:!0,get:function(){return r.DIMENSION_DELETE_REQUEST}}),Object.defineProperty(t,"DIMENSION_EDIT_CLOSED",{enumerable:!0,get:function(){return r.DIMENSION_EDIT_CLOSED}}),Object.defineProperty(t,"DIMENSION_TEXT_DOUBLE_CLICKED",{enumerable:!0,get:function(){return r.DIMENSION_TEXT_DOUBLE_CLICKED}}),Object.defineProperty(t,"DIMENSION_TEXT_SINGLE_CLICKED",{enumerable:!0,get:function(){return r.DIMENSION_TEXT_SINGLE_CLICKED}}),Object.defineProperty(t,"DIMENSION_VALUE_CHANGED",{enumerable:!0,get:function(){return r.DIMENSION_VALUE_CHANGED}}),Object.defineProperty(t,"DISPLAYED_PART_STUDIO",{enumerable:!0,get:function(){return r.DISPLAYED_PART_STUDIO}}),Object.defineProperty(t,"ELEMENT_GRAPHICS_LOADING",{enumerable:!0,get:function(){return r.ELEMENT_GRAPHICS_LOADING}}),Object.defineProperty(t,"ELEMENT_PREVIEW_GRAPHICS_LOADED",{enumerable:!0,get:function(){return r.ELEMENT_PREVIEW_GRAPHICS_LOADED}}),Object.defineProperty(t,"ELEMENT_VIEW_INITIALIZED",{enumerable:!0,get:function(){return r.ELEMENT_VIEW_INITIALIZED}}),Object.defineProperty(t,"EventData",{enumerable:!0,get:function(){return r.EventData}}),Object.defineProperty(t,"FrameType",{enumerable:!0,get:function(){return r.FrameType}}),Object.defineProperty(t,"GL_CONTEXT_LOST",{enumerable:!0,get:function(){return r.GL_CONTEXT_LOST}}),Object.defineProperty(t,"GL_CONTEXT_RESTORED",{enumerable:!0,get:function(){return r.GL_CONTEXT_RESTORED}}),Object.defineProperty(t,"GRAPHICS_HANDLED_CLICK_EVENT",{enumerable:!0,get:function(){return r.GRAPHICS_HANDLED_CLICK_EVENT}}),Object.defineProperty(t,"GraphicsRefinementMode",{enumerable:!0,get:function(){return r.GraphicsRefinementMode}}),Object.defineProperty(t,"HighlightType",{enumerable:!0,get:function(){return r.HighlightType}}),Object.defineProperty(t,"HUD_MODEL_SCENEGRAPH_ID",{enumerable:!0,get:function(){return r.HUD_MODEL_SCENEGRAPH_ID}}),Object.defineProperty(t,"INVALID_OCCURRENCE_ID",{enumerable:!0,get:function(){return r.INVALID_OCCURRENCE_ID}}),Object.defineProperty(t,"IdManager",{enumerable:!0,get:function(){return r.IdManager}}),Object.defineProperty(t,"Id",{enumerable:!0,get:function(){return r.Id}}),Object.defineProperty(t,"IdSizes",{enumerable:!0,get:function(){return r.IdSizes}}),Object.defineProperty(t,"IntersectionType",{enumerable:!0,get:function(){return r.IntersectionType}}),Object.defineProperty(t,"INVALID_ID",{enumerable:!0,get:function(){return r.INVALID_ID}}),Object.defineProperty(t,"IXrController",{enumerable:!0,get:function(){return r.IXrController}}),Object.defineProperty(t,"MAIN_SCENEGRAPH_ID",{enumerable:!0,get:function(){return r.MAIN_SCENEGRAPH_ID}}),Object.defineProperty(t,"MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED",{enumerable:!0,get:function(){return r.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED}}),Object.defineProperty(t,"ManipulationMode",{enumerable:!0,get:function(){return r.ManipulationMode}}),Object.defineProperty(t,"NEW_PART_LIST",{enumerable:!0,get:function(){return r.NEW_PART_LIST}}),Object.defineProperty(t,"NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED",{enumerable:!0,get:function(){return r.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED}}),Object.defineProperty(t,"PART_STUDIO_PART_VISIBILITY_CHANGED",{enumerable:!0,get:function(){return r.PART_STUDIO_PART_VISIBILITY_CHANGED}}),Object.defineProperty(t,"RETRIEVE_OCCURRENCE_DISPLAY_DATA",{enumerable:!0,get:function(){return r.RETRIEVE_OCCURRENCE_DISPLAY_DATA}}),Object.defineProperty(t,"RETRIEVE_ELEMENT_DISPLAY_DATA",{enumerable:!0,get:function(){return r.RETRIEVE_ELEMENT_DISPLAY_DATA}}),Object.defineProperty(t,"RETRIEVE_SMOOTH_EDGE_INFORMATION",{enumerable:!0,get:function(){return r.RETRIEVE_SMOOTH_EDGE_INFORMATION}}),Object.defineProperty(t,"SECTION_PLANE_ADDED",{enumerable:!0,get:function(){return r.SECTION_PLANE_ADDED}}),Object.defineProperty(t,"SECTION_PLANE_REMOVED",{enumerable:!0,get:function(){return r.SECTION_PLANE_REMOVED}}),Object.defineProperty(t,"SECTIONPLANE_SELECTION_ID",{enumerable:!0,get:function(){return r.SECTIONPLANE_SELECTION_ID}}),Object.defineProperty(t,"SECTION_VIEW_DIALOG_CLOSED",{enumerable:!0,get:function(){return r.SECTION_VIEW_DIALOG_CLOSED}}),Object.defineProperty(t,"SECTION_VIEW_DIALOG_OPENED",{enumerable:!0,get:function(){return r.SECTION_VIEW_DIALOG_OPENED}}),Object.defineProperty(t,"SELECTION_REJECTED",{enumerable:!0,get:function(){return r.SELECTION_REJECTED}}),Object.defineProperty(t,"SELECT_OTHER",{enumerable:!0,get:function(){return r.SELECT_OTHER}}),Object.defineProperty(t,"SELECT_OTHER_REVERSE",{enumerable:!0,get:function(){return r.SELECT_OTHER_REVERSE}}),Object.defineProperty(t,"SHOW_SKETCH_TEXT",{enumerable:!0,get:function(){return r.SHOW_SKETCH_TEXT}}),Object.defineProperty(t,"SHOW_SMART_SELECTION",{enumerable:!0,get:function(){return r.SHOW_SMART_SELECTION}}),Object.defineProperty(t,"SKETCH_COMMAND_ACTIVATED",{enumerable:!0,get:function(){return r.SKETCH_COMMAND_ACTIVATED}}),Object.defineProperty(t,"SPACEMOUSE_COMMANDS_RECEIVED",{enumerable:!0,get:function(){return r.SPACEMOUSE_COMMANDS_RECEIVED}}),Object.defineProperty(t,"UPDATE_INCONTEXT_ISOLATION",{enumerable:!0,get:function(){return r.UPDATE_INCONTEXT_ISOLATION}}),Object.defineProperty(t,"VIEWER_CANVAS_ATTACHED_TO_CONTAINER",{enumerable:!0,get:function(){return r.VIEWER_CANVAS_ATTACHED_TO_CONTAINER}}),Object.defineProperty(t,"VIEW_CONTAINER_MENU_INVOKED",{enumerable:!0,get:function(){return r.VIEW_CONTAINER_MENU_INVOKED}}),Object.defineProperty(t,"VIEW_DID_DRAW",{enumerable:!0,get:function(){return r.VIEW_DID_DRAW}}),Object.defineProperty(t,"VIEW_WILL_DRAW",{enumerable:!0,get:function(){return r.VIEW_WILL_DRAW}}),Object.defineProperty(t,"NAMED_VIEW_APPLIED",{enumerable:!0,get:function(){return r.NAMED_VIEW_APPLIED}}),Object.defineProperty(t,"WILL_RENDER_THUMBNAILS",{enumerable:!0,get:function(){return r.WILL_RENDER_THUMBNAILS}}),Object.defineProperty(t,"disableSectionPlaneSelection",{enumerable:!0,get:function(){return r.disableSectionPlaneSelection}}),Object.defineProperty(t,"enableSectionPlaneSelection",{enumerable:!0,get:function(){return r.enableSectionPlaneSelection}}),Object.defineProperty(t,"getActiveViewer",{enumerable:!0,get:function(){return r.getActiveViewer}}),Object.defineProperty(t,"getActiveViewerEventDispatcher",{enumerable:!0,get:function(){return r.getActiveViewerEventDispatcher}}),Object.defineProperty(t,"getActiveViewerModelViewManagers",{enumerable:!0,get:function(){return r.getActiveViewerModelViewManagers}}),Object.defineProperty(t,"getDisplayedElementObservable",{enumerable:!0,get:function(){return r.getDisplayedElementObservable}}),Object.defineProperty(t,"getEditState",{enumerable:!0,get:function(){return r.getEditState}}),Object.defineProperty(t,"getFocusedViewer",{enumerable:!0,get:function(){return r.getFocusedViewer}}),Object.defineProperty(t,"getObservableFromActiveViewerForEvent",{enumerable:!0,get:function(){return r.getObservableFromActiveViewerForEvent}}),Object.defineProperty(t,"idsEqual",{enumerable:!0,get:function(){return r.idsEqual}}),Object.defineProperty(t,"idIsValid",{enumerable:!0,get:function(){return r.idIsValid}}),Object.defineProperty(t,"isUsageBase",{enumerable:!0,get:function(){return r.isUsageBase}}),Object.defineProperty(t,"isUsageCompare",{enumerable:!0,get:function(){return r.isUsageCompare}}),Object.defineProperty(t,"isUsagePreview",{enumerable:!0,get:function(){return r.isUsagePreview}}),Object.defineProperty(t,"NamedIdManager",{enumerable:!0,get:function(){return r.NamedIdManager}}),Object.defineProperty(t,"OccurrenceId",{enumerable:!0,get:function(){return r.OccurrenceId}}),Object.defineProperty(t,"resetUsage",{enumerable:!0,get:function(){return r.resetUsage}}),Object.defineProperty(t,"userWebPreferencesGetManager",{enumerable:!0,get:function(){return r.userWebPreferencesGetManager}}),Object.defineProperty(t,"viewerCheck",{enumerable:!0,get:function(){return r.viewerCheck}});var a=i(114924);Object.defineProperty(t,"CursorAppendage",{enumerable:!0,get:function(){return a.CursorAppendage}}),Object.defineProperty(t,"CursorAppendageLeader",{enumerable:!0,get:function(){return a.CursorAppendageLeader}}),Object.defineProperty(t,"DEFAULT_SIMULATION_COLOR_MAPPING",{enumerable:!0,get:function(){return a.DEFAULT_SIMULATION_COLOR_MAPPING}}),Object.defineProperty(t,"EntityData",{enumerable:!0,get:function(){return a.EntityData}}),Object.defineProperty(t,"ExplodeLine",{enumerable:!0,get:function(){return a.ExplodeLine}}),Object.defineProperty(t,"ExplodeLineDefinition",{enumerable:!0,get:function(){return a.ExplodeLineDefinition}}),Object.defineProperty(t,"ExplodeLineArcSegment",{enumerable:!0,get:function(){return a.ExplodeLineArcSegment}}),Object.defineProperty(t,"ExplodeLineLineSegment",{enumerable:!0,get:function(){return a.ExplodeLineLineSegment}}),Object.defineProperty(t,"Sketch",{enumerable:!0,get:function(){return a.Sketch}}),Object.defineProperty(t,"SketchPlaneDisplay",{enumerable:!0,get:function(){return a.SketchPlaneDisplay}}),Object.defineProperty(t,"SplineHandle",{enumerable:!0,get:function(){return a.SplineHandle}}),Object.defineProperty(t,"StandardViews",{enumerable:!0,get:function(){return a.StandardViews}}),Object.defineProperty(t,"TemporarySketchComponent",{enumerable:!0,get:function(){return a.TemporarySketchComponent}}),Object.defineProperty(t,"Text",{enumerable:!0,get:function(){return a.Text}}),Object.defineProperty(t,"UIElement",{enumerable:!0,get:function(){return a.UIElement}}),Object.defineProperty(t,"UISelection",{enumerable:!0,get:function(){return a.UISelection}}),Object.defineProperty(t,"UiEvents",{enumerable:!0,get:function(){return a.UiEvents}}),Object.defineProperty(t,"View",{enumerable:!0,get:function(){return a.View}}),Object.defineProperty(t,"ViewerSet",{enumerable:!0,get:function(){return a.ViewerSet}}),Object.defineProperty(t,"addStyleToIncrement",{enumerable:!0,get:function(){return a.addStyleToIncrement}}),Object.defineProperty(t,"angleBetweenVectors",{enumerable:!0,get:function(){return a.angleBetweenVectors}}),Object.defineProperty(t,"are2dPointsEqual",{enumerable:!0,get:function(){return a.are2dPointsEqual}}),Object.defineProperty(t,"areMatricesEqual",{enumerable:!0,get:function(){return a.areMatricesEqual}}),Object.defineProperty(t,"areAnySectionPlanesSelectedOrPreselected",{enumerable:!0,get:function(){return a.areAnySectionPlanesSelectedOrPreselected}}),Object.defineProperty(t,"cacheCapabilities",{enumerable:!0,get:function(){return a.cacheCapabilities}}),Object.defineProperty(t,"clearSavedSectionPlaneParameters",{enumerable:!0,get:function(){return a.clearSavedSectionPlaneParameters}}),Object.defineProperty(t,"createArcPolyline",{enumerable:!0,get:function(){return a.createArcPolyline}}),Object.defineProperty(t,"createCirclePolyline",{enumerable:!0,get:function(){return a.createCirclePolyline}}),Object.defineProperty(t,"createDimensionForDisplayData",{enumerable:!0,get:function(){return a.createDimensionForDisplayData}}),Object.defineProperty(t,"createInferenceIcon",{enumerable:!0,get:function(){return a.createInferenceIcon}}),Object.defineProperty(t,"createPolyline",{enumerable:!0,get:function(){return a.createPolyline}}),Object.defineProperty(t,"createTestViewer",{enumerable:!0,get:function(){return a.createTestViewer}}),Object.defineProperty(t,"deselectEntities",{enumerable:!0,get:function(){return a.deselectEntities}}),Object.defineProperty(t,"displayEntity",{enumerable:!0,get:function(){return a.displayEntity}}),Object.defineProperty(t,"distanceSquaredBetweenPoints",{enumerable:!0,get:function(){return a.distanceSquaredBetweenPoints}}),Object.defineProperty(t,"distanceSquaredToLineSegment2d",{enumerable:!0,get:function(){return a.distanceSquaredToLineSegment2d}}),Object.defineProperty(t,"forEachActiveSectionPlane",{enumerable:!0,get:function(){return a.forEachActiveSectionPlane}}),Object.defineProperty(t,"getActiveSectionPlane",{enumerable:!0,get:function(){return a.getActiveSectionPlane}}),Object.defineProperty(t,"getActiveSectionViewState",{enumerable:!0,get:function(){return a.getActiveSectionViewState}}),Object.defineProperty(t,"getActiveViewerSketch",{enumerable:!0,get:function(){return a.getActiveViewerSketch}}),Object.defineProperty(t,"getAngle",{enumerable:!0,get:function(){return a.getAngle}}),Object.defineProperty(t,"getColorStringArray",{enumerable:!0,get:function(){return a.getColorStringArray}}),Object.defineProperty(t,"getCounters",{enumerable:!0,get:function(){return a.getCounters}}),Object.defineProperty(t,"getCurrentSectionPlaneParameters",{enumerable:!0,get:function(){return a.getCurrentSectionPlaneParameters}}),Object.defineProperty(t,"getDefaultNameForBody",{enumerable:!0,get:function(){return a.getDefaultNameForBody}}),Object.defineProperty(t,"getDrawer",{enumerable:!0,get:function(){return a.getDrawer}}),Object.defineProperty(t,"getDrawers",{enumerable:!0,get:function(){return a.getDrawers}}),Object.defineProperty(t,"getFeatureThumbnailKey",{enumerable:!0,get:function(){return a.getFeatureThumbnailKey}}),Object.defineProperty(t,"getHasFeatureQLVFacePatternCapability",{enumerable:!0,get:function(){return a.getHasFeatureQLVFacePatternCapability}}),Object.defineProperty(t,"getMaxSectionPlanes",{enumerable:!0,get:function(){return a.getMaxSectionPlanes}}),Object.defineProperty(t,"getMostRecentActiveSectionPlaneParameters",{enumerable:!0,get:function(){return a.getMostRecentActiveSectionPlaneParameters}}),Object.defineProperty(t,"getMouseSettingsManager",{enumerable:!0,get:function(){return a.getMouseSettingsManager}}),Object.defineProperty(t,"getOrCreateViewerSet",{enumerable:!0,get:function(){return a.getOrCreateViewerSet}}),Object.defineProperty(t,"getPartStudioThumbnailKey",{enumerable:!0,get:function(){return a.getPartStudioThumbnailKey}}),Object.defineProperty(t,"getPartThumbnailKey",{enumerable:!0,get:function(){return a.getPartThumbnailKey}}),Object.defineProperty(t,"getPerpendicularBisector2d",{enumerable:!0,get:function(){return a.getPerpendicularBisector2d}}),Object.defineProperty(t,"getPlaneIndexToAlignNormalTo",{enumerable:!0,get:function(){return a.getPlaneIndexToAlignNormalTo}}),Object.defineProperty(t,"getPointAtAngle",{enumerable:!0,get:function(){return a.getPointAtAngle}}),Object.defineProperty(t,"getRendererInfo",{enumerable:!0,get:function(){return a.getRendererInfo}}),Object.defineProperty(t,"getSectionedItemsSize",{enumerable:!0,get:function(){return a.getSectionedItemsSize}}),Object.defineProperty(t,"getSectionPlaneCount",{enumerable:!0,get:function(){return a.getSectionPlaneCount}}),Object.defineProperty(t,"getSerializablePlaneData",{enumerable:!0,get:function(){return a.getSerializablePlaneData}}),Object.defineProperty(t,"getSerializableSectionViewData",{enumerable:!0,get:function(){return a.getSerializableSectionViewData}}),Object.defineProperty(t,"getThumbnailForKey",{enumerable:!0,get:function(){return a.getThumbnailForKey}}),Object.defineProperty(t,"getTimeInMilliseconds",{enumerable:!0,get:function(){return a.getTimeInMilliseconds}}),Object.defineProperty(t,"getUnavailableRendererInfo",{enumerable:!0,get:function(){return a.getUnavailableRendererInfo}}),Object.defineProperty(t,"getZoomToWindowState",{enumerable:!0,get:function(){return a.getZoomToWindowState}}),Object.defineProperty(t,"graphicsTakesSelectionPrecedence",{enumerable:!0,get:function(){return a.graphicsTakesSelectionPrecedence}}),Object.defineProperty(t,"GlRendererInfo",{enumerable:!0,get:function(){return a.GlRendererInfo}}),Object.defineProperty(t,"initializePreviousVersionViewer",{enumerable:!0,get:function(){return a.initializePreviousVersionViewer}}),Object.defineProperty(t,"intersectLineSegmentRay",{enumerable:!0,get:function(){return a.intersectLineSegmentRay}}),Object.defineProperty(t,"intersectTwoLineSegments2d",{enumerable:!0,get:function(){return a.intersectTwoLineSegments2d}}),Object.defineProperty(t,"intersectTwoLines2d",{enumerable:!0,get:function(){return a.intersectTwoLines2d}}),Object.defineProperty(t,"isInSectionPlaneMode",{enumerable:!0,get:function(){return a.isInSectionPlaneMode}}),Object.defineProperty(t,"isMapEmpty",{enumerable:!0,get:function(){return a.isMapEmpty}}),Object.defineProperty(t,"IsolatedOccurrencesManager",{enumerable:!0,get:function(){return a.IsolatedOccurrencesManager}}),Object.defineProperty(t,"isRendererStringForIntel",{enumerable:!0,get:function(){return a.isRendererStringForIntel}}),Object.defineProperty(t,"isRendererStringForDedicatedIntel",{enumerable:!0,get:function(){return a.isRendererStringForDedicatedIntel}}),Object.defineProperty(t,"isSectionPlaneModeEnabled",{enumerable:!0,get:function(){return a.isSectionPlaneModeEnabled}}),Object.defineProperty(t,"loadSectionPlanesFromParameters",{enumerable:!0,get:function(){return a.loadSectionPlanesFromParameters}}),Object.defineProperty(t,"preserveViewersForDocumentId",{enumerable:!0,get:function(){return a.preserveViewersForDocumentId}}),Object.defineProperty(t,"PREVIOUS_VERSION_CANVAS_SELECTOR",{enumerable:!0,get:function(){return a.PREVIOUS_VERSION_CANVAS_SELECTOR}}),Object.defineProperty(t,"projectToLine",{enumerable:!0,get:function(){return a.projectToLine}}),Object.defineProperty(t,"removeGraphicsViewers",{enumerable:!0,get:function(){return a.removeGraphicsViewers}}),Object.defineProperty(t,"removeSectionPlane",{enumerable:!0,get:function(){return a.removeSectionPlane}}),Object.defineProperty(t,"removeSectionPlanes",{enumerable:!0,get:function(){return a.removeSectionPlanes}}),Object.defineProperty(t,"requestDraw",{enumerable:!0,get:function(){return a.requestDraw}}),Object.defineProperty(t,"collectGraphicsDataForHeapDump",{enumerable:!0,get:function(){return a.collectGraphicsDataForHeapDump}}),Object.defineProperty(t,"setBaseHighlightsEnabled",{enumerable:!0,get:function(){return a.setBaseHighlightsEnabled}}),Object.defineProperty(t,"setBoxSelectionEnabled",{enumerable:!0,get:function(){return a.setBoxSelectionEnabled}}),Object.defineProperty(t,"setDimensionToolActive",{enumerable:!0,get:function(){return a.setDimensionToolActive}}),Object.defineProperty(t,"setForceHideInteriorSelections",{enumerable:!0,get:function(){return a.setForceHideInteriorSelections}}),Object.defineProperty(t,"setFromSerializablePlaneData",{enumerable:!0,get:function(){return a.setFromSerializablePlaneData}}),Object.defineProperty(t,"setFromSerializableSectionViewData",{enumerable:!0,get:function(){return a.setFromSerializableSectionViewData}}),Object.defineProperty(t,"setInteractionEnabled",{enumerable:!0,get:function(){return a.setInteractionEnabled}}),Object.defineProperty(t,"setIsInFollowMode",{enumerable:!0,get:function(){return a.setIsInFollowMode}}),Object.defineProperty(t,"setIsInSectionPlaneMode",{enumerable:!0,get:function(){return a.setIsInSectionPlaneMode}}),Object.defineProperty(t,"setSectionEntitiesEnabled",{enumerable:!0,get:function(){return a.setSectionEntitiesEnabled}}),Object.defineProperty(t,"setSectionPlaneOnMateConnector",{enumerable:!0,get:function(){return a.setSectionPlaneOnMateConnector}}),Object.defineProperty(t,"setSectionPlaneOnMatrix",{enumerable:!0,get:function(){return a.setSectionPlaneOnMatrix}}),Object.defineProperty(t,"setShowDimensionsMode",{enumerable:!0,get:function(){return a.setShowDimensionsMode}}),Object.defineProperty(t,"setThumbnailForKey",{enumerable:!0,get:function(){return a.setThumbnailForKey}}),Object.defineProperty(t,"setTransparencyTransition",{enumerable:!0,get:function(){return a.setTransparencyTransition}}),Object.defineProperty(t,"setViewCubeMenuMgrInstance",{enumerable:!0,get:function(){return a.setViewCubeMenuMgrInstance}}),Object.defineProperty(t,"setZoomModeEnabled",{enumerable:!0,get:function(){return a.setZoomModeEnabled}}),Object.defineProperty(t,"snapshotScenegraph",{enumerable:!0,get:function(){return a.snapshotScenegraph}}),Object.defineProperty(t,"tessellateArc",{enumerable:!0,get:function(){return a.tessellateArc}}),Object.defineProperty(t,"timeRendering",{enumerable:!0,get:function(){return a.timeRendering}}),Object.defineProperty(t,"toggleZoomModifierEnabled",{enumerable:!0,get:function(){return a.toggleZoomModifierEnabled}}),Object.defineProperty(t,"unprojectPlaneToWorld",{enumerable:!0,get:function(){return a.unprojectPlaneToWorld}}),Object.defineProperty(t,"unprojectVectorToWorld",{enumerable:!0,get:function(){return a.unprojectVectorToWorld}}),Object.defineProperty(t,"DragTrimLine",{enumerable:!0,get:function(){return a.DragTrimLine}}),Object.defineProperty(t,"estimateTriangleCountAtSettingIndexUsingTriangleCounts",{enumerable:!0,get:function(){return a.estimateTriangleCountAtSettingIndexUsingTriangleCounts}});var o=i(123085);Object.defineProperty(t,"basicPickSort",{enumerable:!0,get:function(){return o.basicPickSort}})},167097:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.InferencePicker=void 0;const s=i(545348),n=i(114924),r=i(123085),a=s.default.getManager();class o extends n.UIElement{constructor(e,t,i,s){super(e,n.INFERENCE_PICKER_SCENEGRAPH_ID),this.pickPass=new n.InferencePickPass(this.viewer),this.pickPass.setSceneGraph(this.getSceneGraph()),this.pointSizeConstantName=void 0!==t?t:"INFERENCE_POINT_SIZE_PX",this.lineWidthConstantName=void 0!==i?i:"INFERENCE_LINE_WIDTH_PX",this.pickRadiusConstantName=void 0!==s?s:"INFERENCE_PICK_RADIUS_PX",this.inferencePointMaterial=new n.Material({color:a.getColor("INFERENCE_DEBUG_POINT_COLOR"),pointSize:a.getNumber(this.pointSizeConstantName)}),this.inferenceLineMaterial=new n.Material({color:a.getColor("INFERENCE_DEBUG_LINE_COLOR"),lineWidth:a.getNumber(this.lineWidthConstantName)}),this.inferenceCurveMaterial=new n.Material({base:a.getColor("INFERENCE_DEBUG_CURVE_COLOR"),lineWidth:a.getNumber(this.lineWidthConstantName)}),this.pointNodeProperties=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,material:this.inferencePointMaterial,priority:n.RenderOrderPriority.HIGHER}),this.importantNodeProperties=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isShowThrough:!0,isDepthTested:!1,material:this.inferencePointMaterial,priority:n.RenderOrderPriority.HIGHEST}),this.linesNodeProperties=new n.NodeProperties({primitiveType:n.PrimitiveType.INFINITE_LINES,isShowThrough:!0,isDepthTested:!1,material:this.inferenceLineMaterial,priority:n.RenderOrderPriority.LOWER}),this.curvesNodeProperties=new n.NodeProperties({primitiveType:n.PrimitiveType.LINES,isShowThrough:!0,isDepthTested:!1,material:this.inferenceCurveMaterial,priority:n.RenderOrderPriority.DEFAULT}),this.pickRadius=a.getNumber(this.pickRadiusConstantName),this.viewer.visualizeInferenceSceneGraph(this.getSceneGraph())}getSceneGraph(){return this.viewer.getSceneGraphs().getSceneGraph(n.INFERENCE_PICKER_SCENEGRAPH_ID)}onDevicePixelRatioChanged(e){this.pickRadius=a.getNumber(this.pickRadiusConstantName),this.inferencePointMaterial.pointSize=a.getNumber(this.pointSizeConstantName),this.inferenceLineMaterial.lineWidth=a.getNumber(this.lineWidthConstantName),this.inferenceCurveMaterial.lineWidth=a.getNumber(this.lineWidthConstantName)}remove(){super.remove(),this.viewer&&this.viewer.visualizeInferenceSceneGraph(null),this.inferencePointMaterial.destroy(),this.inferenceLineMaterial.destroy(),this.inferenceCurveMaterial.destroy()}setIncrementPickId(e,t){if(!t.pickId)throw"InferencePicker should be supplied increments that already have a pick id set"}pick(e,t){if(this.viewer){const i=this.pickInRect(e,t,this.pickRadius),s=i.length>0?i[0]:null;return s?s.primitiveId:n.INVALID_ID}return n.INVALID_ID}pickMultiple(e,t){if(this.viewer){const i=this.pickIteratively(e,t,this.pickRadius,a.getNumber("MAXIMUM_INFERENCE_PICKS")).map((function(e){return e?e.primitiveId:n.INVALID_ID}));return this.getHighestPriorityInferences(i)}return[]}pickInRect(e,t,i){if(!this.viewer.isReadyForDrawing())return[];const s=2*i+1,n=2*i+1,a=e-i,o=t-i;this.viewer.pushCameraState(),this.pickPass.setSceneGraph(this.getSceneGraph()),this.pickPass.setPickRect(a,o,s,n),this.pickPass.draw(this.viewer.getRenderContext()),this.viewer.popCameraState();const c=this.pickPass.gatherPicksFromPickPass(),l=[];for(const e in c){const t=c[e];for(const e in t)l.push(t[e])}return l.sort(r.basicPickSort)}pickIteratively(e,t,i,s){const n=[];let r,a,o=!1,c=0;for(;!(c>s);){const s=this.pickInRect(e,t,i);if(s.length<1)break;for(r=0;r<s.length;++r)a=s[r],a.fromPass=c,n.push(a);for(r=0;r<s.length;++r)this.hideIncrementFromPick(s[r].primitiveId.toString()),o=!0;++c}return o&&this.occurrenceData.resetHiddenFromPick(),n}getHighestPriorityInferences(e){if(0===e.length)return[];const t=[e[0]],i=this.getRenderOrderPriority(e[0]);for(let s=1;s<e.length;s++){const n=this.getRenderOrderPriority(e[s]);if(n<0)return t;if(n!==i)break;t.push(e[s])}return t}getMeshIncrementForPrimitiveId(e){const t=this.getInstantiatedMeshIncrement(e.toString());return t?t.meshIncrement:null}getRenderOrderPriority(e){const t=this.getInstantiatedMeshIncrement(e.toString());return t?t.nodeProperties.priority:-1}updateInference(e,t){const i=e.id;if(!i)return;let s=null;e.primitiveType===n.PrimitiveType.POINTS?(s=t?this.importantNodeProperties:this.pointNodeProperties,(0,n.addSizeToIncrement)(a.getNumber(this.pointSizeConstantName),e)):e.primitiveType===n.PrimitiveType.INFINITE_LINES?(s=this.linesNodeProperties,(0,n.addSizeToIncrement)(a.getNumber(this.lineWidthConstantName),e)):e.primitiveType===n.PrimitiveType.LINES&&(s=this.curvesNodeProperties,(0,n.addSizeToIncrement)(a.getNumber(this.lineWidthConstantName),e)),s&&this.updateMeshIncrement(i,i,e,s)}deleteInference(e){this.removeMeshIncrement(e)}resetInferences(){this.removeMeshIncrements()}}t.InferencePicker=o},264701:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=void 0;const n=i(545348),r=i(84362),a=i(450798),o=i(997687),c=i(912057),l=i(193786),h=i(32620),d=i(78111),u=i(114924),g=i(613199);(0,u.registerDragHelper)();class p{constructor(e,t){this.editFeatureUnderCursor=e,this.viewer=t,this.sketch=null,this.lastMouseMovedEvent=null,this.lastMouseMoveTime=-1,this.showContextMenuOnMouseUp=!1,this.timeOfRightMouseButtonDown=0,this.mouseTravelSinceRightButtonDown=0,this.preHighlightTimeout=0,this.suppressMouseMovePick=!1,this.hoveredUiSelection=null,this.draggedUiSelection=null,this.longPressedUiSelection=null,this.skipNextClickSelection=!1,this.externalDragHandler=null,this.dragHandledExternally=!1,this.initialDragEvent=null,this.leftButtonDownOnDragStart=!1,this.startedLeftButtonDrag=!1,this.forcedManipulationActive=!1,this.dragTravel=0,this.dragStartTime=0,this.mouseInCanvas=!1,this.buttonState={leftButton:!1,middleButton:!1,rightButton:!1},this.middleMouseButtonDoubleClickHandler=null,this.altHeld=!1,(0,u.viewerCheck)(t),this.boxSelector=new u.BoxSelector(this.viewer),this.setupEventHandlers()}setupEventHandlers(){const e=this,t=this.getViewer().$el;t.dragHelper({lastX:0,lastY:0,onStart:function(t,i){e.buttonState=this.buttonState,e.onDragStart(t,i)},onDrag:function(t,i,s){e.buttonState=this.buttonState;const n=(0,h.getDevicePixelRatio)();e.onDrag(t,i*n,s*n,this.lastX*n,this.lastY*n)},onStop:function(t){e.buttonState=this.buttonState,e.onDragStop(t)}});const i=function(t){return t.bind(e)};t.on("mouseenter",i(p.prototype.onMouseEnter)),t.on("mouseleave",i(p.prototype.onMouseLeave)),t.on("mousemove",i(p.prototype.onMouseMove)),t.on("mousedown",i(p.prototype.onMouseDown)),t.on("mouseup",i(p.prototype.onMouseUp)),t.on("click",i(p.prototype.onClick)),t.on("dblclick",i(p.prototype.onDoubleClick)),t.on("mousewheel DOMMouseScroll",i(p.prototype.onMouseWheelScroll)),(0,u.on)(t,i(p.prototype.onLongPress)),this.middleMouseButtonDoubleClickHandler=new u.DoubleClickHandler(t,i(p.prototype.onMiddleMouseButtonDoubleClick)),s(document).on("keyup",i(p.prototype.onKeyUp)),s(document).on("keydown",i(p.prototype.onKeyDown))}remove(){this.boxSelector&&(this.boxSelector.remove(),this.boxSelector=null),this.middleMouseButtonDoubleClickHandler&&(this.middleMouseButtonDoubleClickHandler.off(),this.middleMouseButtonDoubleClickHandler=null)}setSketch(e){this.sketch=e}setExternalDragHandler(e){this.externalDragHandler=e}setSuppressMouseMovePick(e){this.suppressMouseMovePick=e,this.suppressMouseMovePick&&this.clearPreHighlightTimeout()}getLastMouseMovedEvent(){return this.lastMouseMovedEvent}isMouseRightButtonDown(){return this.buttonState.rightButton}isMouseMiddleButtonDown(){return this.buttonState.middleButton}isMouseLeftButtonDown(){return this.buttonState.leftButton}getViewer(){return this.viewer}onMouseEnter(e){this.viewer.getEventDispatcher().trigger(u.CANVAS_MOUSEENTER,e),this.mouseInCanvas=!0,this.lastMouseMoveTime=-1,window.focus()}trackMouseMovement(e){let t=1/0;const i=(0,u.getTimeInMilliseconds)(),s=i-this.lastMouseMoveTime,r=n.default.getManager(),a=r.getNumber("CONTEXT_MENU_DISTANCE_THRESHOLD"),o=this.viewer.getCanvasCoordinateFromEvent(e),l=this.viewer.getCanvasCoordinateFromEvent(this.lastMouseMovedEvent);if(this.lastMouseMoveTime>0&&this.lastMouseMovedEvent){const e=g.vec2C.length([o[0]-l[0],o[1]-l[1]]);t=e/s,r.getNumber("OUTPUT_MOUSE_SPEED")&&c.log.debug("Mouse speed: "+t.toFixed(3)+", distance since last movement: "+e.toFixed(2)+", time since last movement: "+s.toFixed(1)),this.mouseTravelSinceRightButtonDown+=e}return this.lastMouseMoveTime=i,this.lastMouseMovedEvent=e,this.showContextMenuOnMouseUp&&this.mouseTravelSinceRightButtonDown>a&&(this.showContextMenuOnMouseUp=!1),t}isViewManipulationActive(e){const t=this.getViewer().getPrimaryViewController();if(null!==t){if(t.isBeingManipulated())return!0;if(t.getManipulationMode(e,this.buttonState)!==u.ManipulationMode.NONE)return!0}return(0,u.inZoom)()}isNotManipulatingAndNotInZoom(e){return!this.suppressMouseMovePick&&!this.isViewManipulationActive(e)&&!this.draggedUiSelection}onMouseMove(e){if(this.viewer.getEventDispatcher().trigger(u.CANVAS_MOUSEMOVE,e),e.isPropagationStopped())return!1;if(!this.viewer.isReadyForDrawing())return!1;const t=n.default.getManager(),i=this.trackMouseMovement(e);this.clearPreHighlightTimeout();const s=this.getViewer();s.updateLastMouseLocation(e),this.isNotManipulatingAndNotInZoom(e)&&(i<t.getNumber("PREHIGHLIGHT_SPEED_THRESHOLD")?this.triggerPreHighlightPick(e):(0,l.getPreselectionList)().length>0?this.triggerPreHighlightPick(e,!0):this.schedulePreHighlightPick(e));const a=r.FollowdataModel.getLeaderFollowModel();if(a.active){a.width=s.el.width,a.height=s.el.height;const t=s.isMouseInsideViewManipulator()?[-1,-1]:s.getCanvasCoordinateFromEvent(e);a.setCursorPosition(t)}return!0}onMouseLeave(e){this.viewer.getEventDispatcher().trigger(u.CANVAS_MOUSELEAVE,e),this.mouseInCanvas=!1,this.clearPreHighlightTimeout(),this.suppressMouseMovePick||(0,l.handleEmptyPick)(!0,!1)}eventCanBeUsedForContextMenu(e){return e.ctrlKey||e.which===d.MouseButton.RIGHT}onMouseDown(e){(0,u.inZoom)()&&(this.hoveredUiSelection=new u.UISelection(this.boxSelector,u.SELECTION_ID,""),this.viewer.getUISelectionManager().setHoveredSelection(this.hoveredUiSelection,e)),this.eventCanBeUsedForContextMenu(e)&&(this.lastMouseMovedEvent=e,this.showContextMenuOnMouseUp=!0,this.mouseTravelSinceRightButtonDown=0,this.timeOfRightMouseButtonDown=(0,u.getTimeInMilliseconds)())}isMouseInCanvas(){return this.mouseInCanvas}onContextMenuWillHide(e,t){this.eventCanBeUsedForContextMenu(t)&&(this.lastMouseMovedEvent=null,this.showContextMenuOnMouseUp=!0,this.mouseTravelSinceRightButtonDown=0,this.timeOfRightMouseButtonDown=(0,u.getTimeInMilliseconds)())}onMouseUp(e){this.trackMouseMovement(e);const t=(0,u.getTimeElapsed)(this.timeOfRightMouseButtonDown)>n.default.getManager().getNumber("CONTEXT_MENU_TIME_THRESHOLD_MS");if(this.eventCanBeUsedForContextMenu(e)&&this.showContextMenuOnMouseUp&&!t){this.cancelDragging(e);const t={pickHandled:!1,contextMenuEnabled:!0,altKey:e.altKey};this.notifyGraphicsHandledClick(t),this.showContextMenu(e),s("#context-menu-layer").on("contextmenu:willhide",this.onContextMenuWillHide.bind(this))}this.longPressedUiSelection&&e.which===d.MouseButton.LEFT&&(this.longPressedUiSelection.uiElement.triggerLongPressEnd(this.longPressedUiSelection,e),this.longPressedUiSelection=null,this.skipNextClickSelection=!0)}updatePicksForKeyEvent(e){if(this.isNotManipulatingAndNotInZoom(e)){const t=this.getViewer();if(!t||!t.getGlContext()||null===this.lastMouseMovedEvent)return;if(t!==(0,u.getFocusedViewer)())return;const i=t.getCanvasCoordinateFromEvent(this.lastMouseMovedEvent);t.doPick(i[0],i[1],!0,!0,{onlyRemovePreHighlight:!1,sourceEvent:e,altKey:e.altKey})}}onKeyDown(e){e.altKey&&!this.altHeld&&(this.altHeld=!0,this.updatePicksForKeyEvent(e))}onKeyUp(e){!e.altKey&&this.altHeld&&(this.altHeld=!1,this.updatePicksForKeyEvent(e)),e.which===a.Keys.ALT&&e.preventDefault()}onClick(e){if(this.viewer.getEventDispatcher().trigger(u.CANVAS_CLICK,e),e.isPropagationStopped()||this.showContextMenuOnMouseUp&&this.eventCanBeUsedForContextMenu(e))return;let t={altKey:e.altKey};const i=e.which===d.MouseButton.LEFT;if(!this.isDragging()&&i&&!this.skipNextClickSelection){const i=this.getViewer(),s=i.getCanvasCoordinateFromEvent(e);t={click:!0,shiftKey:e.shiftKey,altKey:this.altHeld,sourceEvent:e},t.pickHandled=i.doPick(s[0],s[1],!1,!0,t)}this.skipNextClickSelection=!1,this.notifyGraphicsHandledClick(t)}onDoubleClick(e){if(this.viewer.getIsForPreviousVersionDisplay())return;let t;if(!this.isDragging()){if(e.which===d.MouseButton.LEFT){const i=this.viewer.getCanvasCoordinateFromEvent(e);t=this.viewer.onDoubleClick(i[0],i[1],e),!t&&this.viewer.getCanEdit()&&this.editFeatureUnderCursor(i[0],i[1])}}this.notifyGraphicsHandledClick({pickHandled:t,altKey:e.altKey})}onMiddleMouseButtonDoubleClick(e){this.isDragging()||this.viewer.animateZoomFit()}onMouseWheelScroll(e){if(this.viewer.performingBoxSelection())return!1;if(!this.viewer.isReadyForDrawing())return!1;return!!this.viewer.getPrimaryViewController().zoomOnMouseWheelScroll(e)&&(this.viewer.getEventDispatcher().trigger(u.CHANGE_VIEW,e),this.viewer.setUserIsAdjustingCamera(),this.viewer.requestDraw(),!1)}cancelDragging(e){this.getViewer().$el.dragHelper("cancelDragging",e)}isDragging(){return this.getViewer().$el.dragHelper("dragging")}onDragStart(e,t){if(this.leftButtonDownOnDragStart=this.buttonState.leftButton,this.viewer.performingBoxSelection())return;if(!this.viewer.isReadyForDrawing())return;this.initialDragEvent=e,this.dragTravel=0,this.dragStartTime=(0,u.getTimeInMilliseconds)();const i=this.viewer.getPrimaryViewController(),s=i.onDragStart(e,t,this.buttonState);this.leftButtonDownOnDragStart&&i.isBeingForceManipulated()&&(this.forcedManipulationActive=!0,this.leftButtonDownOnDragStart=!1),s&&this.viewer.getEventDispatcher().trigger(u.CHANGE_VIEW,e),this.draggedUiSelection=null,this.dragHandledExternally=!1,this.startedLeftButtonDrag=!1,this.preHighlightTimeout&&(this.triggerPreHighlightPick(t),this.clearPreHighlightTimeout()),this.hoveredUiSelection=this.viewer.getUISelectionManager().getHoveredSelection()}onDrag(e,t,i,s,n){this.dragTravel+=g.vec2C.length([t,i]);const r=this.getViewer();if(!r.performingBoxSelection()&&r.isReadyForDrawing())if(r.getPrimaryViewController().onDrag(e,this.buttonState,t,i,s,n),r.getPrimaryViewController().isBeingManipulated()?(this.viewer.setUserIsAdjustingCamera(),(0,l.clearPreSelection)()):this.viewer.setUserIsManipulatingWithTimeout(),this.buttonState.leftButton||this.stopLeftMouseButtonHandlers.call(this,e),!this.startedLeftButtonDrag&&this.shouldStartLeftButtonDrag())this.startLeftButtonDrag();else if(this.draggedUiSelection){const t=r.getCanvasCoordinateFromEvent(e);this.draggedUiSelection.uiElement.triggerDrag(this.draggedUiSelection,{mouseX:t[0],mouseY:t[1],camera:r.getCamera(),shiftKey:e.shiftKey})}else this.dragHandledExternally&&(this.sketch&&this.sketch.endPointScreen(r.getCanvasCoordinateFromEvent(e)),this.externalDragHandler&&this.externalDragHandler.onDrag(e))}onDragStop(e){const t=this.getViewer();this.leftButtonDownOnDragStart&&!this.startedLeftButtonDrag&&this.initialDragEvent&&!this.forcedManipulationActive&&this.onClick(this.initialDragEvent),this.forcedManipulationActive=!1,t.isReadyForDrawing()&&(t.getPrimaryViewController().onDragStop(e),this.stopLeftMouseButtonHandlers.call(this,e),this.suppressMouseMovePick||this.schedulePreHighlightPick(e))}schedulePreHighlightPick(e){const t=this,i=this.viewer.getAveragePickDuration()*n.default.getManager().getNumber("PAUSED_MOUSE_PREHIGHLIGHT_TIMEOUT_MULTIPLIER");this.preHighlightTimeout=window.setTimeout((function(){t.triggerPreHighlightPick(e),t.preHighlightTimeout=0}),i)}clearPreHighlightTimeout(){this.preHighlightTimeout&&(window.clearTimeout(this.preHighlightTimeout),this.preHighlightTimeout=0)}triggerPreHighlightPick(e,t){const i=this.getViewer();if(!i||!i.getGlContext())return;if(this.viewer.getIsForPreviousVersionDisplay())return;const s=i.getCanvasCoordinateFromEvent(e);i.doPick(s[0],s[1],!0,!0,{onlyRemovePreHighlight:!!t,sourceEvent:e,altKey:this.altHeld})}shouldStartLeftButtonDrag(){const e=n.default.getManager(),t=(0,u.getTimeInMilliseconds)()-this.dragStartTime,i=this.getViewer().getPrimaryViewController();return!this.startedLeftButtonDrag&&!i.isBeingForceManipulated()&&this.leftButtonDownOnDragStart&&t>e.getNumber("LEFT_MOUSE_DRAG_TIME_TOLERANCE")&&this.dragTravel>e.getNumber("LEFT_MOUSE_DRAG_DISTANCE_TOLERANCE")}startLeftButtonDrag(){const e=this.getViewer();(0,u.inZoom)()?this.hoveredUiSelection=new u.UISelection(this.boxSelector,u.SELECTION_ID,""):this.triggerPreHighlightPick(this.initialDragEvent);const t=e.getCanvasCoordinateFromEvent(this.initialDragEvent);this.hoveredUiSelection&&this.hoveredUiSelection.uiElement.triggerDragStart(this.hoveredUiSelection,{mouseX:t[0],mouseY:t[1],camera:e.getCamera()})&&(this.draggedUiSelection=this.hoveredUiSelection),this.dragHandledExternally=!1,this.draggedUiSelection||(this.sketch&&this.sketch.startPointScreen(t),this.externalDragHandler&&(this.dragHandledExternally=this.externalDragHandler.onDragStart(this.initialDragEvent))),this.draggedUiSelection||this.dragHandledExternally||(this.draggedUiSelection=new u.UISelection(this.boxSelector,u.SELECTION_ID,""),this.draggedUiSelection.uiElement.triggerDragStart(this.draggedUiSelection,{mouseX:t[0],mouseY:t[1],camera:e.getCamera()})||(this.draggedUiSelection=null)),this.startedLeftButtonDrag=!0}stopLeftMouseButtonHandlers(e){const t=this.getViewer();if(this.draggedUiSelection){const i=this.viewer.getCanvasCoordinateFromEvent(e);this.draggedUiSelection.uiElement.triggerDragStop(this.draggedUiSelection,{mouseX:i[0],mouseY:i[1],camera:t.getCamera()}),this.draggedUiSelection=null}this.dragHandledExternally&&(this.sketch&&this.sketch.endPointScreen([e.pageX,e.pageY]),this.externalDragHandler&&this.externalDragHandler.onDragStop(e),this.dragHandledExternally=!1)}showContextMenu(e){this.getViewer().$el.osContextMenu({x:e.pageX,y:e.pageY})}notifyGraphicsHandledClick(e){(0,u.getActiveViewerEventDispatcher)().trigger(u.GRAPHICS_HANDLED_CLICK_EVENT,e),o.btInjector.FlyoutService.collapseAllFlyouts(),e&&e.skipCommentClearHighlight||o.btInjector.CommentEditService.clearCommentHighlights()}onLongPress(e,t){const i=this.viewer.getCanvasCoordinateFromEvent(t),s=this.viewer.pickIteratively(i[0],i[1],this.viewer.getDefaultPickTerminationEvaluator(),{altKey:e.altKey});let n=null;for(let e=0;e<s.length&&!n;++e)n=s[e].uiSelection;n&&(this.longPressedUiSelection=n,this.longPressedUiSelection.uiElement.triggerLongPressStart(this.longPressedUiSelection,e))}getAltHeld(){return this.altHeld}}t.InputHandler=p},610223:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.InterferenceDisplay=t.BOUNDING_BOX_MESH_INCREMENT_NAME=void 0;const s=i(999714),n=i(606544),r=i(114924),a=i(98357),o=i(936870),c=i(315931),l=i(768125),h=i(114924),d=i(837454);t.BOUNDING_BOX_MESH_INCREMENT_NAME="boxId";class u extends l.UIElement{constructor(e,t,i,s,n,l,u,g){super(t),this.firstClashParentId=i,this.secondClashParentId=s,this.interferenceIndex=n,this.boundingBox=l,this.LINE_WIDTH=2.5,this.lineNodeProps=new d.NodeProperties({primitiveType:c.PrimitiveType.LINES,isPickable:!0,isHighlightable:!0,isTwoSided:!0,isShowThrough:!1}),this.boxLineNodeProps=new d.NodeProperties({primitiveType:c.PrimitiveType.LINES,isPickable:!1,isHighlightable:!0,isVisible:!1}),this.faceNodeProps=new d.NodeProperties({isPickable:!0,primitiveType:c.PrimitiveType.TRIANGLE_STRIP}),this.interferenceIndex=n,this.selectionId=i+s+n,e.tessellation.forEach(((t,i)=>{const s=(0,o.createMeshIncrementForEntityData)(t),n=e.appearance,r="id"+i;let l;if(s.primitiveType===c.PrimitiveType.LINES){l=this.lineNodeProps,(0,a.addSizeToIncrement)(this.LINE_WIDTH,s);const e=(0,h.getColorFromDebugEntityColor)(n,c.PrimitiveType.LINES);(0,a.addColorToIncrement)(e,s)}else if(s.primitiveType===c.PrimitiveType.TRIANGLE_STRIP){l=this.faceNodeProps;const e=(0,h.getColorFromDebugEntityColor)(n,c.PrimitiveType.TRIANGLE_STRIP);(0,a.addColorToIncrement)(e,s)}l&&(this.updateMeshIncrement(r,this.selectionId,s,l),this.viewer.getIsolatedOccurrenceManager().addIdsToIsolate([this.graphicsOccurrenceId],!0))})),this.boxIncrement=(0,r.createWireBox)(this.boundingBox.minCorner.getVec3(),this.boundingBox.maxCorner.getVec3()).createTransformed(u.getGlMatrix()),g&&this.setTransform(g.getGlMatrix())}getSelectionId(){return this.selectionId}remove(){this.viewer.getIsolatedOccurrenceManager().removeFromIsolate([this.graphicsOccurrenceId]),super.remove()}getModelSelection(){return new s.Selection(n.GBTUiSelectionType.TEMPORARY_GEOMETRY,this.selectionId)}processResetSelection(e){e===h.HighlightType.SECONDARY&&this.boxIncrement&&this.removeMeshIncrement(t.BOUNDING_BOX_MESH_INCREMENT_NAME),this.removeHighlightFromOccurrence(e)}processAddSelection(e,i){this.selectionId===e&&(i===h.HighlightType.SECONDARY&&this.boxIncrement&&this.updateMeshIncrement(t.BOUNDING_BOX_MESH_INCREMENT_NAME,this.selectionId,this.boxIncrement,this.boxLineNodeProps),this.addNewHighlightToOccurrence(i))}processRemoveSelection(e,t){this.selectionId===e&&this.removeHighlightFromOccurrence(t)}}t.InterferenceDisplay=u},114924:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicsRefinementMode=t.SectionPlaneParameters=t.ScreenSpaceData=t.OriginAxesIndex=t.MouseButton=t.EntityFilterFunction=t.InferenceData=t.IconSelectionType=t.DimensionPreferences=t.ComponentNames=t.sectionPlaneSelectionDisabled=t.enableSectionPlaneSelection=t.disableSectionPlaneSelection=t.MAIN_SCENEGRAPH_ID=t.PREVIEW_SCENEGRAPH_ID=t.HUD_SCENEGRAPH_ID=t.HUD_MODEL_SCENEGRAPH_ID=t.INFERENCE_PICKER_SCENEGRAPH_ID=t.sign=t.EventData=t.IntersectionType=t.ManipulationMode=t.HighlightType=t.Action=t.GLRenderingContext=t.ExplodeLineLineSegment=t.ExplodeLineArcSegment=t.ExplodeLineDefinition=t.ExplodeLine=t.viewerCheck=t.getFocusedViewer=t.setFocusedViewer=t.getColorFromDebugEntityColor=void 0;const s=i(389496);s.__exportStar(i(131980),t),s.__exportStar(i(940417),t),s.__exportStar(i(527657),t),s.__exportStar(i(439161),t),s.__exportStar(i(690342),t),s.__exportStar(i(931181),t),s.__exportStar(i(803439),t),s.__exportStar(i(37763),t),s.__exportStar(i(301339),t),s.__exportStar(i(389759),t),s.__exportStar(i(272278),t),s.__exportStar(i(778363),t),s.__exportStar(i(822251),t),s.__exportStar(i(885298),t),s.__exportStar(i(336431),t),s.__exportStar(i(81593),t),s.__exportStar(i(175381),t),s.__exportStar(i(785992),t),s.__exportStar(i(59779),t),s.__exportStar(i(401592),t),s.__exportStar(i(989089),t),s.__exportStar(i(128284),t),s.__exportStar(i(840452),t),s.__exportStar(i(767024),t),s.__exportStar(i(343110),t),s.__exportStar(i(229855),t),s.__exportStar(i(282309),t),s.__exportStar(i(64511),t),s.__exportStar(i(732122),t),s.__exportStar(i(770392),t),s.__exportStar(i(538945),t),s.__exportStar(i(569706),t),s.__exportStar(i(523252),t),s.__exportStar(i(394636),t),s.__exportStar(i(441150),t),s.__exportStar(i(374898),t),s.__exportStar(i(170029),t),s.__exportStar(i(897550),t),s.__exportStar(i(817315),t),s.__exportStar(i(541067),t),s.__exportStar(i(492658),t),s.__exportStar(i(434278),t),s.__exportStar(i(745312),t),s.__exportStar(i(820457),t),s.__exportStar(i(977901),t),s.__exportStar(i(806159),t),s.__exportStar(i(649480),t),s.__exportStar(i(126049),t),s.__exportStar(i(878365),t),s.__exportStar(i(541198),t),s.__exportStar(i(768125),t),s.__exportStar(i(315931),t),s.__exportStar(i(960743),t),s.__exportStar(i(879283),t),s.__exportStar(i(921131),t),s.__exportStar(i(837454),t),s.__exportStar(i(3693),t),s.__exportStar(i(703424),t),s.__exportStar(i(204151),t),s.__exportStar(i(778828),t),s.__exportStar(i(690279),t),s.__exportStar(i(755735),t),s.__exportStar(i(164829),t),s.__exportStar(i(264701),t),s.__exportStar(i(531100),t),s.__exportStar(i(11770),t),s.__exportStar(i(726759),t),s.__exportStar(i(168349),t),s.__exportStar(i(368207),t),s.__exportStar(i(372895),t),s.__exportStar(i(455410),t),s.__exportStar(i(324226),t),s.__exportStar(i(918228),t),s.__exportStar(i(165890),t),s.__exportStar(i(202816),t),s.__exportStar(i(297306),t),s.__exportStar(i(493428),t),s.__exportStar(i(157083),t),s.__exportStar(i(852349),t),s.__exportStar(i(552173),t),s.__exportStar(i(811177),t),s.__exportStar(i(678233),t),s.__exportStar(i(934663),t),s.__exportStar(i(877964),t),s.__exportStar(i(277197),t),s.__exportStar(i(147730),t),s.__exportStar(i(165035),t),s.__exportStar(i(360071),t),s.__exportStar(i(12150),t),s.__exportStar(i(487747),t),s.__exportStar(i(462178),t),s.__exportStar(i(890082),t),s.__exportStar(i(960233),t),s.__exportStar(i(250567),t),s.__exportStar(i(473059),t),s.__exportStar(i(996408),t),s.__exportStar(i(559008),t),s.__exportStar(i(766470),t),s.__exportStar(i(489564),t),s.__exportStar(i(985612),t),s.__exportStar(i(919458),t),s.__exportStar(i(413366),t),s.__exportStar(i(637249),t),s.__exportStar(i(698698),t),s.__exportStar(i(804336),t),s.__exportStar(i(82145),t),s.__exportStar(i(87892),t),s.__exportStar(i(853747),t),s.__exportStar(i(815578),t),s.__exportStar(i(316654),t),s.__exportStar(i(950704),t),s.__exportStar(i(516847),t),s.__exportStar(i(533637),t),s.__exportStar(i(733733),t),s.__exportStar(i(866435),t),s.__exportStar(i(496916),t),s.__exportStar(i(136675),t),s.__exportStar(i(854727),t),s.__exportStar(i(107117),t),s.__exportStar(i(379168),t),s.__exportStar(i(754175),t),s.__exportStar(i(792141),t),s.__exportStar(i(841407),t),s.__exportStar(i(494461),t),s.__exportStar(i(568668),t),s.__exportStar(i(36516),t),s.__exportStar(i(399274),t),s.__exportStar(i(553378),t),s.__exportStar(i(87794),t),s.__exportStar(i(388129),t),s.__exportStar(i(772430),t),s.__exportStar(i(919139),t),s.__exportStar(i(854747),t),s.__exportStar(i(767843),t),s.__exportStar(i(195161),t),s.__exportStar(i(751794),t),s.__exportStar(i(870704),t),s.__exportStar(i(523676),t),s.__exportStar(i(156398),t),s.__exportStar(i(814692),t),s.__exportStar(i(539329),t),s.__exportStar(i(935037),t),s.__exportStar(i(467919),t),s.__exportStar(i(708256),t),s.__exportStar(i(539431),t),s.__exportStar(i(446106),t),s.__exportStar(i(665184),t),s.__exportStar(i(116595),t),s.__exportStar(i(557068),t),s.__exportStar(i(449428),t),s.__exportStar(i(605381),t),s.__exportStar(i(582214),t),s.__exportStar(i(445632),t),s.__exportStar(i(124664),t),s.__exportStar(i(196765),t),s.__exportStar(i(885658),t),s.__exportStar(i(465528),t),s.__exportStar(i(313297),t),s.__exportStar(i(37123),t),s.__exportStar(i(717495),t),s.__exportStar(i(688683),t),s.__exportStar(i(789133),t),s.__exportStar(i(904644),t),s.__exportStar(i(954325),t),s.__exportStar(i(172166),t),s.__exportStar(i(772068),t),s.__exportStar(i(810972),t),s.__exportStar(i(254749),t),s.__exportStar(i(105113),t),s.__exportStar(i(500021),t),s.__exportStar(i(431008),t),s.__exportStar(i(691144),t),s.__exportStar(i(865096),t),s.__exportStar(i(176446),t),s.__exportStar(i(799984),t),s.__exportStar(i(95517),t),s.__exportStar(i(508043),t),s.__exportStar(i(865020),t),s.__exportStar(i(584318),t),s.__exportStar(i(936870),t),s.__exportStar(i(98357),t),s.__exportStar(i(370126),t),s.__exportStar(i(54858),t),s.__exportStar(i(859528),t),s.__exportStar(i(371339),t),s.__exportStar(i(952180),t),s.__exportStar(i(827410),t),s.__exportStar(i(982233),t),s.__exportStar(i(36264),t),s.__exportStar(i(841334),t),s.__exportStar(i(618065),t),s.__exportStar(i(977772),t),s.__exportStar(i(465723),t),s.__exportStar(i(151434),t),s.__exportStar(i(154669),t),s.__exportStar(i(121715),t),s.__exportStar(i(186949),t),s.__exportStar(i(605985),t),s.__exportStar(i(356309),t),s.__exportStar(i(687070),t),s.__exportStar(i(656010),t),s.__exportStar(i(189643),t),s.__exportStar(i(51173),t),s.__exportStar(i(526018),t),s.__exportStar(i(434567),t),s.__exportStar(i(247615),t),s.__exportStar(i(343574),t),s.__exportStar(i(5273),t),s.__exportStar(i(432188),t),s.__exportStar(i(61161),t),s.__exportStar(i(961049),t),s.__exportStar(i(833206),t),s.__exportStar(i(616534),t),s.__exportStar(i(66595),t),s.__exportStar(i(539411),t),s.__exportStar(i(941196),t),s.__exportStar(i(388456),t),s.__exportStar(i(697608),t),s.__exportStar(i(139978),t),s.__exportStar(i(312742),t),s.__exportStar(i(542042),t),s.__exportStar(i(969848),t),s.__exportStar(i(167097),t),s.__exportStar(i(610223),t),s.__exportStar(i(821848),t),s.__exportStar(i(921183),t),s.__exportStar(i(783708),t),s.__exportStar(i(21656),t),s.__exportStar(i(304338),t),s.__exportStar(i(571541),t),s.__exportStar(i(178651),t),s.__exportStar(i(263267),t),s.__exportStar(i(723231),t),s.__exportStar(i(844420),t),s.__exportStar(i(83965),t),s.__exportStar(i(53538),t),s.__exportStar(i(219610),t),s.__exportStar(i(376278),t),s.__exportStar(i(160179),t),s.__exportStar(i(760240),t),s.__exportStar(i(754280),t),s.__exportStar(i(246753),t),s.__exportStar(i(161656),t),s.__exportStar(i(972072),t),s.__exportStar(i(638953),t),s.__exportStar(i(817156),t),s.__exportStar(i(467155),t),s.__exportStar(i(544224),t),s.__exportStar(i(533637),t),s.__exportStar(i(193890),t),s.__exportStar(i(695519),t),s.__exportStar(i(406304),t),s.__exportStar(i(131621),t),s.__exportStar(i(714235),t),s.__exportStar(i(212751),t),s.__exportStar(i(649805),t),s.__exportStar(i(110575),t),s.__exportStar(i(394082),t),s.__exportStar(i(725584),t),s.__exportStar(i(336937),t),s.__exportStar(i(860409),t);var n=i(936870);Object.defineProperty(t,"getColorFromDebugEntityColor",{enumerable:!0,get:function(){return n.getColorFromDebugEntityColor}});var r=i(520498);Object.defineProperty(t,"setFocusedViewer",{enumerable:!0,get:function(){return r.setFocusedViewer}}),Object.defineProperty(t,"getFocusedViewer",{enumerable:!0,get:function(){return r.getFocusedViewer}}),Object.defineProperty(t,"viewerCheck",{enumerable:!0,get:function(){return r.viewerCheck}});var a=i(653885);Object.defineProperty(t,"ExplodeLine",{enumerable:!0,get:function(){return a.ExplodeLine}}),Object.defineProperty(t,"ExplodeLineDefinition",{enumerable:!0,get:function(){return a.ExplodeLineDefinition}});var o=i(358580);Object.defineProperty(t,"ExplodeLineArcSegment",{enumerable:!0,get:function(){return o.ExplodeLineArcSegment}});var c=i(503371);Object.defineProperty(t,"ExplodeLineLineSegment",{enumerable:!0,get:function(){return c.ExplodeLineLineSegment}});var l=i(877964);Object.defineProperty(t,"GLRenderingContext",{enumerable:!0,get:function(){return l.GLRenderingContext}});var h=i(261936);Object.defineProperty(t,"Action",{enumerable:!0,get:function(){return h.Action}}),Object.defineProperty(t,"HighlightType",{enumerable:!0,get:function(){return h.HighlightType}});var d=i(182322);Object.defineProperty(t,"ManipulationMode",{enumerable:!0,get:function(){return d.ManipulationMode}});var u=i(728616);Object.defineProperty(t,"IntersectionType",{enumerable:!0,get:function(){return u.IntersectionType}});var g=i(37432);Object.defineProperty(t,"EventData",{enumerable:!0,get:function(){return g.EventData}});var p=i(223456);Object.defineProperty(t,"sign",{enumerable:!0,get:function(){return p.sign}});var m=i(490950);Object.defineProperty(t,"INFERENCE_PICKER_SCENEGRAPH_ID",{enumerable:!0,get:function(){return m.INFERENCE_PICKER_SCENEGRAPH_ID}});var E=i(490950);Object.defineProperty(t,"HUD_MODEL_SCENEGRAPH_ID",{enumerable:!0,get:function(){return E.HUD_MODEL_SCENEGRAPH_ID}});var I=i(490950);Object.defineProperty(t,"HUD_SCENEGRAPH_ID",{enumerable:!0,get:function(){return I.HUD_SCENEGRAPH_ID}});var T=i(490950);Object.defineProperty(t,"PREVIEW_SCENEGRAPH_ID",{enumerable:!0,get:function(){return T.PREVIEW_SCENEGRAPH_ID}});var S=i(490950);Object.defineProperty(t,"MAIN_SCENEGRAPH_ID",{enumerable:!0,get:function(){return S.MAIN_SCENEGRAPH_ID}});var f=i(23658);Object.defineProperty(t,"disableSectionPlaneSelection",{enumerable:!0,get:function(){return f.disableSectionPlaneSelection}}),Object.defineProperty(t,"enableSectionPlaneSelection",{enumerable:!0,get:function(){return f.enableSectionPlaneSelection}}),Object.defineProperty(t,"sectionPlaneSelectionDisabled",{enumerable:!0,get:function(){return f.sectionPlaneSelectionDisabled}});var C=i(499432);Object.defineProperty(t,"ComponentNames",{enumerable:!0,get:function(){return C.ComponentNames}});var P=i(683067);Object.defineProperty(t,"DimensionPreferences",{enumerable:!0,get:function(){return P.DimensionPreferences}});var v=i(683067);Object.defineProperty(t,"IconSelectionType",{enumerable:!0,get:function(){return v.IconSelectionType}});var D=i(683067);Object.defineProperty(t,"InferenceData",{enumerable:!0,get:function(){return D.InferenceData}});var M=i(683067);Object.defineProperty(t,"EntityFilterFunction",{enumerable:!0,get:function(){return M.EntityFilterFunction}});var y=i(683067);Object.defineProperty(t,"MouseButton",{enumerable:!0,get:function(){return y.MouseButton}});var O=i(499432);Object.defineProperty(t,"OriginAxesIndex",{enumerable:!0,get:function(){return O.OriginAxesIndex}});var _=i(683067);Object.defineProperty(t,"ScreenSpaceData",{enumerable:!0,get:function(){return _.ScreenSpaceData}});var A=i(683067);Object.defineProperty(t,"SectionPlaneParameters",{enumerable:!0,get:function(){return A.SectionPlaneParameters}});var R=i(683067);Object.defineProperty(t,"GraphicsRefinementMode",{enumerable:!0,get:function(){return R.GraphicsRefinementMode}})},304338:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IsolatedManagerBase=void 0;const s=i(142885),n=i(606544),r=i(114924),a=i(613199);class o extends s.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.isolatedOccurrencesManager=t,this.affectedOccurrenceIds=[],this.centersOfInitialAffectedInstances=null,this.dialog=null,this.isIsolateFullyTransparent=!1,this.setUpListeners()}destroy(){this.dialog&&(this.dialog.destroy(),this.dialog=null),this.stopListening()}setIsIsolateFullyTransparent(e){this.isIsolateFullyTransparent!==e&&(this.isIsolateFullyTransparent=e,this.isolatedOccurrencesManager.onIsIsolateFullyTransparentChanged(),this.viewer.requestDraw())}setIsIsolateFullyTransparentAsDefault(){this.isIsolateFullyTransparent=!0}getIsIsolateFullyTransparent(){return this.isIsolateFullyTransparent}clearEffectNoAnimation(){this.hasAffectedInstances()&&(this.setIsIsolateFullyTransparent(!1),this.clearEffect(),this.viewer.onIsolateChanged(),(0,r.requestDraw)()),this.dialog&&(this.dialog.destroy(),this.dialog=null)}clearEffectExit(e){if(this.viewer!==e)return;let t=!0;this.setIsIsolateFullyTransparent(!1),this.currentRenderModeSupportsAnimation()?this.hasAffectedInstances()&&(t=!1,this.viewer.animateIsolation(!1,function(){this.destroyDialog(),this.clearEffect(),this.viewer.onIsolateChanged(),(0,r.requestDraw)()}.bind(this))):this.clearEffectNoAnimation(),t&&this.destroyDialog()}destroyDialog(){this.dialog&&(this.dialog.destroy(),this.dialog=null)}currentRenderModeSupportsAnimation(){return!(this.viewer.getRenderingMode()===n.GBTGraphicsRenderMode.TRANSLUCENT)}getModelViewManager(){return this.viewer.getModelViewManagers().getManager()}getPreviewViewManager(){return this.viewer.getModelViewManagers().getPreviewManager()}hasAffectedInstances(){return this.affectedOccurrenceIds.length>0}addIdsToAffect(e,t){if(this.hasAffectedInstances()||t){let t=!1;for(let i=0;i<e.length;i++)this.affectedOccurrenceIds.indexOf(e[i])<0&&(this.affectedOccurrenceIds.push(e[i]),t=!0);t&&this.updateOccurrenceManagerAndPreviewBoundingBoxes()}}removeFromEffect(e){if(this.hasAffectedInstances()){let t=!1;for(let i=0;i<e.length;i++){const s=this.affectedOccurrenceIds.indexOf(e[i]);s>-1&&(this.affectedOccurrenceIds.splice(s,1),t=!0)}t&&this.updateOccurrenceManagerAndPreviewBoundingBoxes()}}makeTransparent(e,t){const i=t?function(){const e=(0,r.getActiveViewer)();e.setSuppressMouseMovePick(!1),e.getInputHandler().isMouseInCanvas()&&e.doPreHighlightPick()}:()=>{};e&&this.currentRenderModeSupportsAnimation()?this.viewer.animateIsolation(!0):((0,r.setTransparencyTransition)(1),this.viewer.requestDraw(function(){this.viewer.getAnimationController().incrementAnimationSequence(),i()}.bind(this)))}getSelectionFromNodeModelOrSelection(e){return r.IsolatedOccurrencesManager.getSelectionFromNodeModelOrSelection(e,this.viewer)}setAffectedOccurrenceIds(e){this.affectedOccurrenceIds=e,this.updateOccurrenceManagerAndPreviewBoundingBoxes()}isInEffectMode(){return!!this.dialog}isWithinDistanceOfAnInitialAffectedOccurrence(e,t){const i=this.getModelViewManager().getOccurrenceBounds(t);return!!i&&this.isBoundsWithinDistanceOfInitialAffectedInstances(i,e)}isBoundsWithinDistanceOfInitialAffectedInstances(e,t){const i=e.center();return this.isPointWithinDistanceOfInitialAffectedInstances(i,t)}isPointWithinDistanceOfInitialAffectedInstances(e,t){for(const i of this.centersOfInitialAffectedInstances){if(a.vec3C.distanceSquared(i,e)<t)return!0}return!1}getMinDistanceSquaredFromInitialAffectedInstanceToCenterOfModel(){let e=1/0;const t=this.getModelBoundsForEffect();if(t){const i=t.center();this.updateCentersOfInitialAffectedInstances();const s=this.centersOfInitialAffectedInstances.map((function(e){return a.vec3C.distanceSquared(e,i)}));e=Math.min(...s)}return e}getModelBoundsForEffect(){return this.viewer.getModelBounds()}expandEffectByConnectivity(e){}getAffectedOccurrences(){return[]}initialAffectedOccurrencesHaveConnectedOccurrences(){return!1}affectOccurrences(e,t,i){}updateOccurrenceManagerAndPreviewBoundingBoxes(){this.updateOccurrenceDataManager(),this.updatePreviewBoundingBoxes(),this.viewer.onIsolateChanged()}updatePreviewBoundingBoxes(){this.viewer.getBodyManager().refreshReducedDetailBoxes()}clearAffectedOccurrenceIdsNoGraphicsUpdate(){this.affectedOccurrenceIds=[]}}t.IsolatedManagerBase=o},219610:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IsolatedManagersUtils=void 0;const s=i(114924),n=i(859589);t.IsolatedManagersUtils=class{static createIsolateDialog(e){const t={isolateManager:e};return new n.IsolateDialog(t)}static updateOccurrenceDataManager(e,t){e&&t&&(0===e.length?t.clearIsolation():e.forEach((e=>{e!==s.INVALID_OCCURRENCE_ID&&t.setOccurrenceIsolated(e,!0)})))}}},160179:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IsolatedOccurrencesManager=t.IsolateFlag=void 0;const s=i(523903),n=i(142885),r=i(905898),a=i(7401),o=i(681459),c=i(193786),l=i(606544),h=i(114924),d=i(196207);var u;!function(e){e[e.INITIAL=0]="INITIAL",e[e.ASSEMBLY_DATA_UPDATE=1]="ASSEMBLY_DATA_UPDATE",e[e.EXPAND=2]="EXPAND",e[e.PART_STUDIO_UPDATE=3]="PART_STUDIO_UPDATE"}(u||(t.IsolateFlag=u={}));class g extends n.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.contextTransparencyMultiplier=1,(0,o.isInPartStudioElement)()?this.currentIsolateManager=new h.PartStudioIsolateManager(e,this):this.currentIsolateManager=new h.AssemblyIsolateManager(e,this),this.setUpListeners()}switchActiveElement(e){this.currentIsolateManager.destroy(),this.currentMakeTransparentManager&&(this.currentMakeTransparentManager.destroy(),this.currentMakeTransparentManager=null),this.currentIsolateManager=e?new h.PartStudioIsolateManager(this.viewer,this):new h.AssemblyIsolateManager(this.viewer,this)}clearIsolateManagerNoGraphicsUpdate(){this.currentIsolateManager.clearAffectedOccurrenceIdsNoGraphicsUpdate()}removeMakeTransparentManager(){this.currentMakeTransparentManager&&this.currentMakeTransparentManager.destroy(),this.currentMakeTransparentManager=null}getContextTransparencyMultiplier(){return this.contextTransparencyMultiplier}getIsIsolateFullyTransparent(){return this.currentMakeTransparentManager?this.currentMakeTransparentManager.getIsIsolateFullyTransparent():this.currentIsolateManager.getIsIsolateFullyTransparent()}onIsIsolateFullyTransparentChanged(){this.trigger(g.IS_ISOLATE_FULLY_TRANSPARENT_CHANGED_EVENT)}setContextTransparencyMultiplier(e){this.contextTransparencyMultiplier=e,this.viewer.requestDraw()}onMakeTransparentParts(e,t){if(0!==e.length&&!this.currentMakeTransparentManager){this.currentMakeTransparentManager=new h.PartStudioMakeTransparentManager(this.viewer,this,e,t);const i=t.getFilteredEntitiesHighlightController();i&&i.updateSetOfFilteredEntities()}}onMakeTransparentComponents(e,t,i,s){this.currentMakeTransparentManager||(this.currentMakeTransparentManager=new h.AssemblyMakeTransparentManager(this.viewer,this,e,i,t,s))}static partCanBeIsolated(e){return e.bodyType===l.GBTBodyType.SOLID||e.bodyType===l.GBTBodyType.SHEET||e.bodyType===l.GBTBodyType.WIRE||e.isComposite}setUpListeners(){this.listenTo((0,r.getCommandDispatcher)(),a.commands.MAKE_TRANSPARENT_COMPONENTS,this.onMakeTransparentComponents),this.listenTo((0,r.getCommandDispatcher)(),a.commands.MAKE_TRANSPARENT_PARTS,this.onMakeTransparentParts),this.currentIsolateManager.setUpListeners()}destroy(){this.currentIsolateManager.destroy(),this.currentMakeTransparentManager&&this.currentMakeTransparentManager.destroy()}isIsolateManagerInUse(){return this.isInIsolateMode()||!!(0,c.getActiveInContextNodeId)()||d.DocumentController.getOpenDocumentController().isInterferenceDetectionActive()}clearAllIsolateNoAnimation(){this.currentIsolateManager.clearIsolateNoAnimation(),this.currentMakeTransparentManager&&this.currentMakeTransparentManager.clearTransparentNoAnimation()}hasIsolatedInstances(){return this.currentIsolateManager.hasIsolatedInstances()||this.currentMakeTransparentManager&&this.currentMakeTransparentManager.hasTransparentInstances()}areSelectionsAlreadyIsolated(e){return this.currentIsolateManager.areSelectionsAlreadyIsolated(e)}areSelectionsInListAlreadyIsolated(e){return this.currentIsolateManager.areSelectionsInListAlreadyIsolated(e)}isInIsolateMode(){return this.currentIsolateManager.isInIsolateMode()}addIdsToIsolate(e,t){this.currentIsolateManager.addIdsToIsolate(e,t)}removeFromIsolate(e){this.currentIsolateManager.removeFromIsolate(e)}isolateOccurrences(e,t){this.currentIsolateManager.isolateOccurrences(e,t)}getIsolatedOccurrences(){return this.currentMakeTransparentManager?this.currentMakeTransparentManager.getTransparentOccurrences():this.currentIsolateManager.getIsolatedOccurrences()}setIsolatedOccurrenceIds(e){this.currentIsolateManager.setIsolatedOccurrenceIds(e)}isInMakeTransparentMode(){return!!this.currentMakeTransparentManager}areSelectionsInListAlreadyTransparent(e){if(this.currentMakeTransparentManager)return this.currentMakeTransparentManager.areSelectionsInListAlreadyTransparent(e);{let t=!0;return e.forEach((e=>{this.noOccurrencesOrPartsSelected(e)||(t=!1)})),t}}areSelectionsAlreadyTransparent(e){return this.currentMakeTransparentManager?this.currentMakeTransparentManager.areSelectionsAlreadyTransparent(e):this.noOccurrencesOrPartsSelected(e)}isInIsolateOrMakeTransparentMode(){return this.isInIsolateMode()||this.isInMakeTransparentMode()}noOccurrencesOrPartsSelected(e){if((0,o.isInPartStudioElement)())return 0===h.PartStudioIsolateManagerBase.getSelectedParts(e,this.viewer).length;if((0,o.isInAssemblyElement)()){if(e){if(0!==g.getSelectionFromNodeModelOrSelection(e,this.viewer).getOccurrencesFromSelection().length)return!1}let t=!1;return(0,c.getSelectionList)().forEach((e=>{0!==e.getOccurrencesFromSelection().length&&(t=!0)})),!t}return!0}static getSelectionFromNodeModelOrSelection(e,t){return e?e instanceof c.Selection?e:e instanceof s.InstanceItem?e.getSelection():e.getSelection(t):null}}t.IsolatedOccurrencesManager=g,g.IS_ISOLATE_FULLY_TRANSPARENT_CHANGED_EVENT="IS_ISOLATE_FULLY_TRANSPARENT_CHANGED_EVENT"},372895:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createLinearToolPreview=t.LinearToolPreview=void 0;const s=i(264292),n=i(736234),r=i(114924),a=i(613199);class o extends r.ToolDisplay{constructor(e,t){super(e,t),this.direction=null,this.distance=0,this.offset=0}setDistance(e){this.update(null,null,e)}update(e,t,i,s){return!(e&&!(0,n.isEqual)(e,this.sourceIds))&&(t&&(this.direction=t),i&&(this.distance=i),void 0!==s&&(this.offset=s),this.updateMeshes())}updateMeshes(){let e,t,i,n,o;const c=s.vec3.create();a.vec3C.scale(this.direction,this.distance+this.offset,c);for(let s=0;s<this.sourceIds.length;++s){for(e=this.sourcePrimitives[s],t=this.duplicatePrimitive(e),i=this.sourceIds[s],n=0;n<e.points.length;n+=3)for(o=0;o<3;++o)t.points[n+o]=e.points[n+o]+c[o];t.isTriangles()?this.updateMeshIncrement(i,r.NO_SELECTION_ID,t,r.TOOL_FACE_PROPERTIES):this.updateMeshIncrement(i,r.NO_SELECTION_ID,t,r.TOOL_EDGE_PROPERTIES)}return!0}}t.LinearToolPreview=o,t.createLinearToolPreview=function(e,t,i,s,n,r){const a=new o(n,e);return a.direction=i,a.distance=s,void 0!==r&&(a.offset=r),a.initialize(t)?a:null}},698698:function(e,t,i){var s=i(185956),n=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.Listener=t.off=t.on=void 0;const r={duration:500,tolerance:10},a={mousedown:"mousedown",mouseup:"mouseup",mousemove:"mousemove",longpress:"longpress"},o={LEFT:1,MIDDLE:2,RIGHT:3};function c(e){if(e.which!==o.LEFT)return;const t=s(e.target),i=(new Date).getTime(),c=n.Event(a.longpress);for(const t in e)c[t]=e[t];c.type=a.longpress,t.on(a.mouseup,h),t.on(a.mousemove,d);const l=setTimeout((function(){t.trigger(a.longpress,c),u()}),r.duration);function h(e){(new Date).getTime()-i<r.duration?clearTimeout(l):t.trigger(a.longpress,c),u()}function d(e){(Math.abs(e.pageX-c.pageX)>r.tolerance||Math.abs(e.pageY-c.pageY)>r.tolerance)&&(clearTimeout(l),u())}function u(){t.off(a.mouseup,void 0,h),t.off(a.mousemove,void 0,d)}}t.on=function(e,t){e.on(a.mousedown,c),e.on(a.longpress,t)},t.off=function(e){e.off(a.mousedown,void 0,c),e.off(a.longpress)},t.Listener=c},804336:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getManipulatorDisplacementDisplayManager=void 0;class i{constructor(){this.activeManipulator=null}setActiveManipulator(e){this.activeManipulator&&this.activeManipulator.removeDisplacementMeshIncrements(),this.activeManipulator=e}resetActiveManipulator(){this.setActiveManipulator(null)}}let s=null;t.getManipulatorDisplacementDisplayManager=function(){return s||(s=new i),s}},12150:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ScalingManipulator=t.PointSelection=t.FreeDrag=t.AngularWithArrow=t.Angular=t.Planar=t.LinearDisplacement=t.createArrowPrimitives=t.Linear=t.Manipulator=void 0;const s=i(545348),n=i(7401),r=i(905898),a=i(264292),o=i(912057),c=i(197134),l=i(845556),h=i(606544),d=i(223456),u=i(32620),g=i(873896),p=i(114924),m=i(683067),E=i(713289),I=i(613199),T=i(723617),S=s.default.getManager(),f="selection",C="lines.",P="outlines.",v="lines",D="manipulator-displacement-graphics",M=new p.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,priority:p.RenderOrderPriority.DEFAULT,primitiveType:p.PrimitiveType.LINES}),y=new p.NodeProperties(Object.assign({},M,{priority:p.RenderOrderPriority.HIGHEST})),O=new p.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,priority:p.RenderOrderPriority.LOWER,primitiveType:p.PrimitiveType.LINES}),_=new p.NodeProperties(Object.assign({},O,{priority:p.RenderOrderPriority.HIGHER})),A=new p.NodeProperties({isVisible:!1,isPickable:!0,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,primitiveType:p.PrimitiveType.TRIANGLES});class R extends p.UIElement{constructor(e,t){super(e),this.isDragging=!1,this.isHovering=!1,this.isEnabled=!0,this.meshIncrement=null,this.pickIncrement=null,this.updateIncrement=!1,this.doSnappingBehavior=!0,this.offsetRoundDecimals=8,this.hasEditView=!1,this.isLocked=!1,t||(t={displayEditView:!1}),this.style=h.GBTManipulatorStyleEnum.DEFAULT,this.lineColor=new Uint8Array([0,0,0,0]),this.outlineColor=new Uint8Array([0,0,0,0]),this.triadOwnerType=E.TriadManipulatorType.UNKNOWN,this.displayEditView=t.displayEditView,this.listenTo(this,p.UiEvents.MOUSE_ENTER+f,this.onMouseEnter),this.listenTo(this,p.UiEvents.MOUSE_LEAVE+f,this.onMouseLeave),this.listenTo(this,p.UiEvents.DRAG_START+f,this.onDragStart),this.listenTo(this,p.UiEvents.DRAG+f,this.onDrag),this.listenTo(this,p.UiEvents.DRAG_STOP+f,this.onDragStop),this.listenTo(this,p.UiEvents.CLICK+f,this.onClick),this.listenTo(this,p.UiEvents.DOUBLE_CLICK+f,this.onDoubleClick),this.listenTo(this,p.UiEvents.XR_DRAG_START+f,this.onXrDragStart),this.listenTo(this,p.UiEvents.XR_DRAG+f,this.onXrDrag),this.listenTo(this,p.UiEvents.XR_DRAG_STOP+f,this.onXrDragStop)}onAppearanceConstantsUpdated(){this.updateIncrement=!0}isManipulator(){return!0}setIsLocked(e){this.isLocked=e}getIsLocked(){return this.isLocked}onDevicePixelRatioChanged(e){this.meshIncrement=null,this.updateGraphics(e)}setStyle(e){this.style=e||h.GBTManipulatorStyleEnum.DEFAULT}setFadeParameters(e,t){this.fadeAngleStart=(0,p.toRadians)((0,p.clamp)(e,0,90)),this.fadeAngleEnd=(0,p.toRadians)((0,p.clamp)(t,0,90))}setIsEnabled(e){this.isEnabled=e,(0,p.requestDraw)()}getIsEnabled(){return this.isEnabled}setTriadOwnerType(e){this.triadOwnerType=e}getTriadOwnerType(){return this.triadOwnerType}onViewWillDraw(e,t){this.isHidden||this.updateGraphics(e)}onMouseEnter(e,t){this.isEnabled&&(this.isHovering=!0,this.updateIncrement=!0,this.trigger(E.ManipulatorEvents.MANIPULATOR_ENTER,this),(0,p.requestDraw)())}onMouseLeave(e,t){this.isEnabled&&(this.isHovering=!1,this.updateIncrement=!0,this.trigger(E.ManipulatorEvents.MANIPULATOR_LEAVE,this),(0,p.requestDraw)())}onDragStart(e,t,i){this.isEnabled&&(this.isDragging=!0,this.updateIncrement=!0,i.requestDrag=!0,this.trigger(E.ManipulatorEvents.MANIPULATION_STARTED,this),(0,p.requestDraw)())}onDragStop(e,t){this.isDragging=!1,this.updateIncrement=!0,this.trigger(E.ManipulatorEvents.MANIPULATION_ENDED),(0,p.requestDraw)()}onDrag(e,t){}onXrDragStart(e,t,i){this.isEnabled&&(this.isDragging=!0,this.updateIncrement=!0,i.requestDrag=!0,this.trigger(E.ManipulatorEvents.MANIPULATION_STARTED,this),this.viewer.requestDraw())}onXrDragStop(e,t){this.isDragging=!1,this.updateIncrement=!0,this.trigger(E.ManipulatorEvents.MANIPULATION_ENDED),(0,p.requestDraw)()}onXrDrag(e,t){}onClick(e,t){this.isEnabled&&this.trigger(E.ManipulatorEvents.CLICKED,this)}onDoubleClick(e,t){this.isEnabled&&this.trigger(E.ManipulatorEvents.DOUBLE_CLICKED,this,e)}getOutlineColor(){return this.isEnabled?this.isDragging?S.getColor("MANIPULATOR_OUTLINE_DRAG_COLOR"):this.isHovering?S.getColor("MANIPULATOR_OUTLINE_HOVER_COLOR"):S.getColor("MANIPULATOR_OUTLINE_COLOR"):S.getColor("MANIPULATOR_OUTLINE_DISABLED_COLOR")}getLineColor(){return this.isEnabled?this.isDragging?S.getColor("MANIPULATOR_LINE_DRAG_COLOR"):this.isHovering?S.getColor("MANIPULATOR_LINE_HOVER_COLOR"):S.getColor("MANIPULATOR_LINE_COLOR"):S.getColor("MANIPULATOR_LINE_DISABLED_COLOR")}isHighlighted(){return this.isDragging||this.isHovering}updateLines(e,t,i){const s=t.clone();i=void 0!==i?i:1,this.isEnabled||(i*=S.getNumber("MANIPULATOR_DISABLED_OPACITY"));const n=this.getLineColor();n[3]=(0,p.clamp)(n[3]*i,1/255,1),(0,p.addColorToIncrement)(n,t),(0,p.addSizeToIncrement)(S.getNumber("MANIPULATOR_LINE_WIDTH"),t),this.updateMeshIncrement(C+e,p.NO_SELECTION_ID,t,this.isHighlighted()?y:M);const r=this.getOutlineColor();r[3]=(0,p.clamp)(r[3]*i,1/255,1),(0,p.addColorToIncrement)(r,s),(0,p.addSizeToIncrement)(S.getNumber("MANIPULATOR_LINE_WIDTH")+2*S.getNumber("MANIPULATOR_OUTLINE_WIDTH"),s),this.updateMeshIncrement(P+e,p.NO_SELECTION_ID,s,this.isHighlighted()?_:O)}removeDisplacementMeshIncrements(){this.removeMeshIncrement(D)}updatePickArea(e){this.viewer.performingBoxSelection()||((0,p.addColorToIncrement)([0,0,0,1],e),this.updateMeshIncrement("pickarea",f,e,A))}updateGeometry(){}updateColor(e){if(e=void 0!==e?e:1,this.isEnabled||(e*=S.getNumber("MANIPULATOR_DISABLED_OPACITY")),e<=0?this.isTransparent||this.makeTransparent():this.isTransparent&&this.makeOpaque(),this.isHidden||this.isTransparent)return;let t=this.getLineColor();t[3]=(0,p.clamp)(t[3]*e,1/255,1),t=[255*t[0],255*t[1],255*t[2],255*t[3]],this.lineColor[0]===t[0]&&this.lineColor[1]===t[1]&&this.lineColor[2]===t[2]&&this.lineColor[3]===t[3]||(this.lineColor.set(t),this.updateIncrementAttribute(C+v,p.Attributes.COLOR,this.lineColor));let i=this.getOutlineColor();i[3]=(0,p.clamp)(i[3]*e,1/255,1),i=[255*i[0],255*i[1],255*i[2],255*i[3]],this.outlineColor[0]===i[0]&&this.outlineColor[1]===i[1]&&this.outlineColor[2]===i[2]&&this.outlineColor[3]===i[3]||(this.outlineColor.set(i),this.updateIncrementAttribute(P+v,p.Attributes.COLOR,this.outlineColor))}updateGraphics(e){let t=this.updateIncrement;this.meshIncrement||(this.updateGeometry(),t=!0),this.meshIncrement&&t&&(this.updateLines(v,this.meshIncrement),this.updatePickArea(this.pickIncrement))}isBeingManipulated(){return this.isDragging}getLinearSnapValue(e,t,i){const s=e.camera.getPixelSizeAtWorldPoint(i),n=S.getNumber("MANIPULATOR_LINEAR_SNAP_RESOLUTION_PX")*s,r=(0,c.getCurrentDocumentSettingsModel)().getLengthUnits(),a=(0,l.convertFromBase)(n,r);if(a<=0)return t;const o=Math.round(Math.log(a)/Math.log(10));let h=Math.pow(10,o-1);h/=S.getNumber("MANIPULATOR_LINEAR_INCREMENT_DIVISOR");const d=(0,l.convertFromBase)(t,r)/h,u=Math.round(d),g=u-d,p=S.getNumber("MANIPULATOR_LINEAR_SNAP_DEVIATION");if(Math.abs(g)<=p){const e=h*u;t=(0,l.convertToBase)(e,r)}return t}onEditChange(e){}onEditCreate(){this.hasEditView=!0}onEditClose(){this.hasEditView=!1}triggerEditValueChange(e){(0,r.getCommandDispatcher)().trigger(n.commands.SET_EDIT_VALUE,e)}triggerEditValueChangeNoUnit(e){(0,r.getCommandDispatcher)().trigger(n.commands.SET_EDIT_VALUE_NO_UNIT,e)}triggerEditOriginChange(e,t){(0,r.getCommandDispatcher)().trigger(n.commands.SET_EDIT_VIEW_ORIGIN,e,t)}remove(){this.hasEditView&&((0,r.getCommandDispatcher)().trigger(n.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)),super.remove()}removeEditViewAndHighlights(){this.isHovering=!1,(0,r.getCommandDispatcher)().trigger(n.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)}dragByIncrementValue(e){}}t.Manipulator=R;function N(e,t,i,s,n,r){r=r||h.GBTManipulatorStyleEnum.DEFAULT;const o=e.point,c=e.evaluate(t),l=I.vec3C.cross(e.direction,n.getForward(),a.vec3.create());I.vec3C.normalize(l);const d=I.vec3C.add(I.vec3C.scale(l,i,a.vec3.create()),c),u=I.vec3C.add(I.vec3C.scale(l,-i,a.vec3.create()),c),g=e.evaluate(t+s),m={};if(r!==h.GBTManipulatorStyleEnum.SECONDARY)m.lines=(0,p.createLines)([o,c,d,u,d,g,u,g]);else{const n=e.evaluate(t+.5*s),r=I.vec3C.add(I.vec3C.scale(l,i,a.vec3.create()),n),h=I.vec3C.add(I.vec3C.scale(l,-i,a.vec3.create()),n);m.lines=(0,p.createLines)([o,c,d,u,d,n,u,n,r,h,r,g,h,g])}const E=I.vec3C.add(I.vec3C.scale(l,-i,a.vec3.create()),o),T=I.vec3C.add(I.vec3C.scale(l,-i,a.vec3.create()),g),S=I.vec3C.add(I.vec3C.scale(l,i,a.vec3.create()),o);return m.pickArea=(0,p.createQuad)(E,T,S),m}function w(e,t){let i=I.vec3C.subtract(t,e,a.vec3.create());i=I.vec3C.normalize(i,a.vec3.create());const s=Math.atan2(-i[1],i[0]),n={x:S.getNumber("MANIPULATOR_EDIT_VIEW_ORIGIN_X_OFFSET"),y:S.getNumber("MANIPULATOR_EDIT_VIEW_ORIGIN_Y_OFFSET")};return Math.abs(s)>=Math.PI/2&&(n.x=-(n.x+75)),s>=0&&(n.y=-(30+n.y)),n}t.Linear=class extends R{constructor(e,t){super(e,t),this.offset=0,this.initialRay=null,this.editOffset=0,this.visualGapPx=0,this.flipDirectionWhenNegative=!1,this.dragOffset=0,this.minOffset=-1/0,this.maxOffset=1/0,this.displacementGraphics=null,this.ray=new p.Ray([0,0,0],[0,0,1]),this.shaftLengthPx=S.getNumber("MANIPULATOR_LINEAR_SHAFT_LENGTH_PX"),this.isDraggable=!t||!t.hasOwnProperty("isDraggable")||t.isDraggable,this.setFadeParameters(S.getNumber("MANIPULATOR_LINEAR_FADE_ANGLE_START"),S.getNumber("MANIPULATOR_LINEAR_FADE_ANGLE_END"))}remove(){super.remove(),this.displacementGraphics&&(this.displacementGraphics.remove(),this.displacementGraphics=null)}updateGeometry(){let e=this.shaftLengthPx,t=S.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"),i=S.getNumber("MANIPULATOR_LINEAR_HEAD_RADIUS_PX");const s=S.getNumber("MANIPULATOR_CIRCLE_SEGMENTS");if(this.style===h.GBTManipulatorStyleEnum.TANGENTIAL){const e=S.getNumber("MANIPULATOR_TANGENTIAL_SHAFT_LENGTH_PX"),t=S.getNumber("MANIPULATOR_TANGENTIAL_HEAD_LENGTH_PX"),i=S.getNumber("MANIPULATOR_TANGENTIAL_HEAD_RADIUS_PX"),n=S.getNumber("MANIPULATOR_TANGENTIAL_BASE_RADIUS_PX"),r=2*Math.max(i,n),o=2*(t+e)+n,c=(0,p.createArrow)(a.vec3.fromValues(0,0,n),a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),e,t,i),l=(0,p.createArrow)(a.vec3.fromValues(0,0,-n),a.vec3.fromValues(0,0,-1),a.vec3.fromValues(1,0,0),e,t,i),h=(0,p.createCircle)(a.vec3.fromValues(0,0,0),n,a.vec3.fromValues(0,1,0),s);this.meshIncrement=h.concatenate(c).concatenate(l),this.pickIncrement=(0,p.createQuad)(a.vec3.fromValues(-r/2,0,-o/2),a.vec3.fromValues(r/2,0,-o/2),a.vec3.fromValues(-r/2,0,o/2))}else this.style===h.GBTManipulatorStyleEnum.SECONDARY?(e-=t*S.getNumber("SECOND_DIRECTION_MANIPULATOR_OFFSET_PERCENT"),this.meshIncrement=(0,p.createDoubleHeadArrow)(a.vec3.fromValues(0,0,0),a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),e,t,i),this.pickIncrement=(0,p.createQuad)(a.vec3.fromValues(-i,0,0),a.vec3.fromValues(i,0,0),a.vec3.fromValues(-i,0,e+t))):(this.style!==h.GBTManipulatorStyleEnum.DEFAULT&&this.style!==h.GBTManipulatorStyleEnum.SIMPLE&&o.log.debug("Manipulator style "+h.KeyOfGBTManipulatorStyleEnum[this.style]+" not implemented.  Using default style"),this.style===h.GBTManipulatorStyleEnum.SIMPLE&&(e=0,t=S.getNumber("MANIPULATOR_LINEAR_SIMPLE_HEAD_LENGTH_PX"),i=S.getNumber("MANIPULATOR_LINEAR_SIMPLE_HEAD_RADIUS_PX")),this.meshIncrement=(0,p.createArrow)(a.vec3.fromValues(0,0,0),a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),e,t,i),this.pickIncrement=(0,p.createQuad)(a.vec3.fromValues(-i,0,0),a.vec3.fromValues(i,0,0),a.vec3.fromValues(-i,0,e+t)))}setVisualGap(e){this.visualGapPx=e}setShaftLength(e){this.shaftLengthPx=e}setFlipDirectionWhenNegative(e){this.flipDirectionWhenNegative=e}setIsDraggable(e){this.isDraggable=e}getOffsetFromEvent(e){const t=e.camera.getRay(e.mouseX,e.mouseY),i=this.ray.findClosestPositionToOtherRay(t);return i||0}getOffsetFromXrInputEvent(e){const t=this.ray.findClosestPositionToOtherRay(e.modelSpaceRay);return t||0}onDefaultUnitsChanged(){this.hasEditView&&this.createEditView()}createEditView(){this.editViewUnits=(0,c.getCurrentDocumentSettingsModel)().getLengthUnits();const e=new h.BTMParameterQuantity;e.parameterId="length",e.units=this.editViewUnits,e.value=this.offset;const t={paramQuantity:e,quantityType:h.GBTQuantityType.LENGTH,range:null};(0,r.getCommandDispatcher)().trigger(n.commands.CREATE_MANIPULATOR_EDIT_VIEW,this,t,this.viewer)}onDragStart(e,t,i){this.dragOffset=this.getOffsetFromEvent(t)-this.offset,super.onDragStart(e,t,i),this.initializeEditView()}onXrDragStart(e,t,i){this.dragOffset=this.getOffsetFromXrInputEvent(t)-this.offset,super.onXrDragStart(e,t,i),this.initializeEditView()}initializeEditView(){this.displayEditView&&!this.hasEditView&&(this.createEditView(),this.initialRay=new p.Ray(this.ray.point,this.ray.direction),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(this))}onEditChange(e){const t=e.units;this.editOffset=(0,l.convertToBase)(e.value,t),this.trigger(E.ManipulatorEvents.VALUE_EDITED)}onDrag(e,t){if(this.isLocked||!this.isDraggable)return;const i=this.getOffsetFromEvent(t)-this.dragOffset,s=!t.shiftKey;this.handleDrag(i,t.camera.getRay(t.mouseX,t.mouseY),s,t)}onXrDrag(e,t){if(this.isLocked||!this.isDraggable)return;const i=this.getOffsetFromXrInputEvent(t)-this.dragOffset;this.handleDrag(i,t.modelSpaceRay,!1)}handleDrag(e,t,i,s){if(e=(0,p.clamp)(e,this.minOffset,this.maxOffset),i&&(e=this.getLinearSnapValue(s,e,this.ray.point),e=(0,p.clamp)(e,this.minOffset,this.maxOffset)),this.offset=parseFloat(e.toFixed(this.offsetRoundDecimals)),this.hasEditView){let e=this.initialRay.findClosestPositionToOtherRay(t);e=e?e-this.dragOffset:0,i&&(e=this.getLinearSnapValue(s,e,this.initialRay.point),e=(0,p.clamp)(e,this.minOffset,this.maxOffset)),this.editOffset=e}this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.offset,s),this.viewer.requestDraw()}updateDefinition(e,t,i){if(this.isBeingManipulated()){const i=this.ray.evaluate(this.offset);this.ray=new p.Ray(e,t);const s=this.ray.findPositionOfPoint(i);this.offset=s}else this.ray=new p.Ray(e,t),i||(i=0),this.offset=i;(0,p.requestDraw)()}updateDefinitionForLocalManipulatorAtRest(e,t,i){const s=2*g.Tolerances.ZERO_LENGTH,n=i?-s:s;this.updateDefinition(e,t,n)}updateLimits(e,t){this.minOffset=e,this.maxOffset=t}getOffset(){return this.offset}getEditOffset(){return this.editOffset}getOffsetPosition(){return this.ray.evaluate(this.offset)}getEditOffsetPosition(){return this.initialRay.evaluate(this.editOffset)}getInitialOffsetPosition(){return this.initialRay.point}getEditTranslation(){return I.vec3C.subtract(this.getOffsetPosition(),this.getInitialOffsetPosition(),a.vec3.create())}dragByIncrementValue(e){const t=this.ray.point,i=this.viewer.getCamera(),s=i.projectWorldPointToCanvas(t),n={mouseX:s[0],mouseY:s[1],camera:i};this.onDragStart(null,n,{requestDrag:!1});const r=(0,c.getCurrentDocumentSettingsModel)().getLengthUnits(),a=(0,l.convertToBase)(e,r),o=this.ray.evaluate(a),h=i.projectWorldPointToCanvas(o);n.mouseX=h[0],n.mouseY=h[1],this.onDrag(null,n),this.onDragStop(null,n)}updateGraphics(e){super.updateGraphics(e);const t=Math.acos(Math.min(Math.abs(a.vec3.dot(e.getForward(),this.ray.direction)),1)),i=this.isBeingManipulated()?1:(0,p.smoothstep)(this.fadeAngleEnd,this.fadeAngleStart,t);if(this.updateColor(i),!this.isHidden){const t=e.getPixelSizeAtWorldPoint(this.ray.evaluate(this.offset)),i=this.offset<0&&this.flipDirectionWhenNegative?-1:1,s=this.visualGapPx*t+this.offset,n=this.ray.evaluate(s),r=I.vec3C.scale(I.vec3C.normalize(this.ray.direction,a.vec3.create()),i*t),o=I.vec3C.scale(I.vec3C.normalize(I.vec3C.cross(e.getForward(),r,a.vec3.create())),t),h=I.vec3C.scale(I.vec3C.normalize(I.vec3C.cross(r,o,a.vec3.create())),t),d=a.mat4.fromValues(o[0],o[1],o[2],0,h[0],h[1],h[2],0,r[0],r[1],r[2],0,n[0],n[1],n[2],1);if(this.hasEditView){const i=(0,c.getCurrentDocumentSettingsModel)().getLengthUnits(),s=this.getEditTranslation(),r=a.vec3.dot(this.initialRay.direction,s)<0?-1:1,h=I.vec3C.length(s)*r,d=(0,l.convertFromBase)(h,i);this.triggerEditValueChange({value:d,isLength:!0});const g=(0,u.getDevicePixelRatio)(),p=this.shaftLengthPx*t*g,m=this.ray.evaluate(this.offset+p),E=e.projectWorldPointToCanvas(m),T=w(e.projectWorldPointToCanvas(n),E);E[0]=T.x+E[0]/(0,u.getDevicePixelRatio)(),E[1]=T.y+E[1]/(0,u.getDevicePixelRatio)(),this.triggerEditOriginChange(E[0],E[1]),this.displacementGraphics||(this.displacementGraphics=new b(this.viewer,this)),this.displacementGraphics.updateGraphics(e,o,h)}this.setTransform(d)}}removeDisplacementMeshIncrements(){this.displacementGraphics&&this.displacementGraphics.removeMeshIncrement(D)}},t.createArrowPrimitives=N;class b extends p.UIElement{constructor(e,t){super(e),this.parent=t}updateGraphics(e,t,i){const s=S.getNumber("MANIPULATOR_LINEAR_START_LINE_LENGTH_PX"),n=e.getPixelSizeAtWorldPoint(this.parent.initialRay.point);let r=I.vec3C.normalize(t,a.vec3.create());r=I.vec3C.scale(r,n*s,a.vec3.create());const o=I.vec3C.add(this.parent.initialRay.point,r,a.vec3.create());r=I.vec3C.scale(r,-1);const c=I.vec3C.add(this.parent.initialRay.point,r,a.vec3.create()),l=(0,p.createLines)([this.parent.initialRay.point,this.parent.initialRay.evaluate(i),o,c]);(0,p.addColorToIncrement)(S.getColor("MANIPULATOR_DISPLACEMENT_COLOR"),l),(0,p.addSizeToIncrement)(S.getNumber("MANIPULATOR_DISPLACEMENT_LINE_WIDTH"),l),this.updateMeshIncrement(D,p.NO_SELECTION_ID,l,M)}}t.LinearDisplacement=b;t.Planar=class extends R{constructor(e,t){super(e,t),this.direction0=a.vec3.fromValues(1,0,0),this.direction1=a.vec3.fromValues(0,1,0),this.normal=a.vec3.fromValues(0,0,1),this.visualGapPx=0,this.sideLengthPx=0,this.dragOffset=a.vec2.create(),this.origin=a.vec3.create(),this.offset=a.vec2.create(),this.dragDelta=a.vec2.create(),this.setFadeParameters(S.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_START"),S.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_END"))}updateGeometry(){this.meshIncrement=(0,p.createLines)([a.vec3.fromValues(0,0,0),a.vec3.fromValues(1,0,0),a.vec3.fromValues(1,0,0),a.vec3.fromValues(1,1,0),a.vec3.fromValues(1,1,0),a.vec3.fromValues(0,1,0),a.vec3.fromValues(0,1,0),a.vec3.fromValues(0,0,0)]),this.pickIncrement=(0,p.createQuad)(a.vec3.fromValues(0,0,0),a.vec3.fromValues(1,0,0),a.vec3.fromValues(0,1,0))}setVisualGap(e){this.visualGapPx=e}setSideLength(e){this.sideLengthPx=e}getOffsetFromEvent(e){const t=e.camera.getRay(e.mouseX,e.mouseY);return this.getOffsetFromRay(t)}getOffsetFromXrInputEvent(e){return this.getOffsetFromRay(e.modelSpaceRay)}getOffsetFromRay(e){const t=a.vec3.create(),i=a.vec4.fromValues(this.normal[0],this.normal[1],this.normal[2],-a.vec3.dot(this.normal,this.origin)),s=(0,p.intersectRayPlane)(e,i);if(null===s)return null;const n=a.vec3.dot(I.vec3C.subtract(s,this.origin,t),this.direction0),r=a.vec3.dot(I.vec3C.subtract(s,this.origin,t),this.direction1);return a.vec2.fromValues(n,r)}onDragStart(e,t,i){const s=this.getOffsetFromEvent(t);this.displayEditView&&((0,r.getCommandDispatcher)().trigger(n.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)),s&&(this.dragOffset=I.vec2C.subtract(s,this.offset,a.vec2.create()),super.onDragStart(e,t,i))}onXrDragStart(e,t,i){const s=this.getOffsetFromXrInputEvent(t);this.displayEditView&&((0,r.getCommandDispatcher)().trigger(n.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)),s&&(this.dragOffset=I.vec2C.subtract(s,this.offset,a.vec2.create()),super.onXrDragStart(e,t,i))}onDrag(e,t){if(this.isLocked)return;const i=this.getOffsetFromEvent(t),s=!t.shiftKey;this.handleDrag(i,s,t)}onXrDrag(e,t){if(this.isLocked)return;const i=this.getOffsetFromXrInputEvent(t);this.handleDrag(i,!1)}handleDrag(e,t,i){if(e){this.offset=I.vec2C.subtract(e,this.dragOffset,a.vec2.create());for(let e=0;e<this.offset.length;e++)t&&(this.offset[e]=this.getLinearSnapValue(i,this.offset[e],this.origin)),this.offset[e]=parseFloat(this.offset[e].toFixed(this.offsetRoundDecimals));this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.offset,i),this.viewer.requestDraw()}}updateDefinition(e,t,i,s){this.origin=e,this.direction0=t,this.direction1=i,(0,d.areUnitVectorsParallel)(this.direction0,this.direction1)?o.log.warn("Trying to create a planar manipulator with two parallel directions"):this.normal=I.vec3C.normalize(I.vec3C.cross(this.direction0,this.direction1,a.vec3.create())),this.offset=s,(0,p.requestDraw)()}getOffset(){return this.offset}evaluatePosition(e,t){return I.vec3C.add(I.vec3C.scale(this.direction0,e,a.vec3.create()),I.vec3C.add(I.vec3C.scale(this.direction1,t,a.vec3.create()),this.origin))}getOffsetPosition(){return this.evaluatePosition(this.offset[0],this.offset[1])}updateGraphics(e){super.updateGraphics(e);const t=Math.acos(Math.min(Math.abs(a.vec3.dot(e.getForward(),this.normal)),1)),i=this.isBeingManipulated()?1:1-(0,p.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,t);if(this.updateColor(i),!this.isHidden){const t=e.getPixelSizeAtWorldPoint(this.getOffsetPosition()),i=this.visualGapPx*t,s=this.sideLengthPx*t,n=this.evaluatePosition(this.offset[0]+i,this.offset[1]+i),r=I.vec3C.scale(this.direction0,s,a.vec3.create()),o=I.vec3C.scale(this.direction1,s,a.vec3.create()),c=this.normal,l=a.mat4.fromValues(r[0],r[1],r[2],0,o[0],o[1],o[2],0,c[0],c[1],c[2],0,n[0],n[1],n[2],1);this.setTransform(l)}}};class L extends R{constructor(e,t){super(e,t),this.zeroAngleDirection=a.vec3.fromValues(1,0,0),this.upDirection=a.vec3.fromValues(0,1,0),this.angle=0,this.angleRelativeToInitialZeroDirection=0,this.angleRelativeToInitialZeroDirectionForEdit=0,this.isClockWiseRotation=!0,this.radius=0,this.radialOffsetPx=0,this.dragOffset=0,this.disableMinimumOffset=!1,this.axis=new p.Ray([0,0,0],[0,0,1]),this.initialZeroAngleDirection=this.zeroAngleDirection,this.initialUpDirection=this.upDirection,this.minAngle=-Math.PI,this.maxAngle=Math.PI,this.minDisplayAngle=-Math.PI,this.maxDisplayAngle=Math.PI,this.setFadeParameters(S.getNumber("MANIPULATOR_ANGULAR_FADE_ANGLE_START"),S.getNumber("MANIPULATOR_ANGULAR_FADE_ANGLE_END"))}updateGeometry(){this.meshIncrement=(0,p.createCircle)(a.vec3.fromValues(0,0,0),1,a.vec3.fromValues(0,0,1),S.getNumber("MANIPULATOR_CIRCLE_SEGMENTS"));const e=S.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS_SCALE"),t=Math.abs(Math.atan(1/e)),i=S.getNumber("MANIPULATOR_ANGULAR_HANDLE_SUBTENSION_FACTOR"),s=S.getNumber("MANIPULATOR_ANGULAR_HANDLE_ARC_SEGMENTS"),n=(0,p.createArc)(a.vec3.fromValues(-e,0,0),e,a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),t,i*t,s);this.meshIncrement=this.meshIncrement.concatenate(n);const r=(0,p.createArc)(a.vec3.fromValues(-e,0,0),e,a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),-t,-i*t,s);this.meshIncrement=this.meshIncrement.concatenate(r);const o=6*e*t;this.pickIncrement=(0,p.createQuad)(a.vec3.fromValues(-1,o/2,0),a.vec3.fromValues(-1,-o/2,0),a.vec3.fromValues(1,o/2,0))}setAngle(e){this.angle=e}setRadialOffset(e){this.radialOffsetPx=e}getPlaneDefinition(){return a.vec4.fromValues(this.axis.direction[0],this.axis.direction[1],this.axis.direction[2],-a.vec3.dot(this.axis.point,this.axis.direction))}getMousePlanePosition(e){const t=e.camera.getRay(e.mouseX,e.mouseY);return(0,p.intersectRayPlane)(t,this.getPlaneDefinition())}getXrInputPlanePosition(e){return(0,p.intersectRayPlane)(e.modelSpaceRay,this.getPlaneDefinition())}getAngleFromEvent(e,t,i,s,n,r,a){const o=this.getMousePlanePosition(e);return this.getAngleFromPlanePosition(o,t,i,s,n,r,a)}getAngleFromXrInputEvent(e,t,i,s,n,r,a){const o=this.getXrInputPlanePosition(e);return this.getAngleFromPlanePosition(o,t,i,s,n,r,a)}getAngleFromPlanePosition(e,t,i,s,n,r,o){if(!e)return null;const c=I.vec3C.subtract(e,this.axis.point),l=a.vec3.dot(c,i),h=a.vec3.dot(c,s);if(l*l+h*h<g.Tolerances.ZERO_LENGTH*g.Tolerances.ZERO_LENGTH)return null;const d=Math.atan2(h,l)+t;return(0,p.closestAngleInRange)(d,n,r,o)}onDefaultUnitsChanged(){this.hasEditView&&this.createEditView()}createEditView(){const e=new h.BTMParameterQuantity;e.parameterId="angle",e.units=(0,c.getCurrentDocumentSettingsModel)().getAngleUnits(),e.value=this.angle;const t=new h.BTQuantityRange;t.minValue=Math.max(0,F(this.minDisplayAngle)),t.maxValue=Math.max(0,F(this.maxDisplayAngle)),t.units=e.units;const i={paramQuantity:e,quantityType:h.GBTQuantityType.ANGLE,range:t};(0,r.getCommandDispatcher)().trigger(n.commands.CREATE_MANIPULATOR_EDIT_VIEW,this,i,this.viewer)}onDragStart(e,t,i){this.dragOffset=this.angle-this.getAngleFromEvent(t,0,this.zeroAngleDirection,this.upDirection,this.angle,this.minAngle,this.maxAngle),super.onDragStart(e,t,i),this.initializeEditView()}onXrDragStart(e,t,i){this.dragOffset=this.angle-this.getAngleFromXrInputEvent(t,0,this.zeroAngleDirection,this.upDirection,this.angle,this.minAngle,this.maxAngle),super.onXrDragStart(e,t,i),this.initializeEditView()}initializeEditView(){this.displayEditView&&!this.hasEditView&&(this.createEditView(),this.initialZeroAngleDirection=a.vec3.clone(this.zeroAngleDirection),this.initialUpDirection=a.vec3.clone(this.upDirection),this.trigger(E.ManipulatorEvents.CACHE_TRANSFORM),this.isClockWiseRotation=this.dragOffset>0,this.angleRelativeToInitialZeroDirectionForEdit=0,(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(this))}onEditChange(e){const t=Math.abs(B(e.value));this.isClockWiseRotation?this.angleRelativeToInitialZeroDirectionForEdit=t:this.angleRelativeToInitialZeroDirectionForEdit=-t,this.trigger(E.ManipulatorEvents.VALUE_EDITED)}getSnapAngle(e,t){const i=e.camera,s=S.getNumberArray("MANIPULATOR_ANGULAR_SNAP_DIVISOR"),n=S.getNumber("MANIPULATOR_ANGULAR_SNAP_RESOLUTION_PX"),r=this.getMousePlanePosition(e);let a=0;if(r){const e=i.getUnitSizeAtWorldPoint(r)/(0,u.getDevicePixelRatio)(),t=I.vec3C.subtract(r,this.axis.point),o=I.vec3C.length(t);for(;a<s.length;++a){if(o*(Math.PI/s[a])*e<=n)break}}const o=s[a]*t/Math.PI,c=Math.round(o),l=c-o;let h=S.getNumber("MANIPULATOR_ANGULAR_SNAP_ANGLE_DEVIATION");return h*=1+a/s.length,Math.abs(l)<=h&&(t=c*Math.PI/s[a]),t}onDrag(e,t){if(this.isLocked)return;const i=this.getAngleFromEvent(t,this.dragOffset,this.zeroAngleDirection,this.upDirection,this.angle,this.minAngle,this.maxAngle),s=this.hasEditView?this.getAngleFromEvent(t,this.dragOffset,this.initialZeroAngleDirection,this.initialUpDirection,this.angleRelativeToInitialZeroDirectionForEdit,this.minDisplayAngle,this.maxDisplayAngle):null,n=!t.shiftKey;this.handleDrag(i,s,n,t)}onXrDrag(e,t){if(this.isLocked)return;const i=this.getAngleFromXrInputEvent(t,this.dragOffset,this.zeroAngleDirection,this.upDirection,this.angle,this.minAngle,this.maxAngle),s=this.hasEditView?this.getAngleFromXrInputEvent(t,this.dragOffset,this.initialZeroAngleDirection,this.initialUpDirection,this.angleRelativeToInitialZeroDirectionForEdit,this.minDisplayAngle,this.maxDisplayAngle):null;this.handleDrag(i,s,!1)}handleDrag(e,t,i,s){if(null!==e){if(this.angle=parseFloat(e.toFixed(this.offsetRoundDecimals)),i&&(this.angle=this.getSnapAngle(s,this.angle)),this.angle=(0,p.clamp)(this.angle,this.minAngle,this.maxAngle),this.hasEditView&&null!==t){this.isClockWiseRotation=t>0;let e=(0,p.angleBetweenVectors)(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction)+this.angle;e<this.minDisplayAngle?e=(0,p.closestAngleGreaterThanOrEqual)(e,this.minDisplayAngle):e>this.maxDisplayAngle&&(e=(0,p.closestAngleLessThanOrEqual)(e,this.maxDisplayAngle)),this.angleRelativeToInitialZeroDirection=t,this.angleRelativeToInitialZeroDirectionForEdit=e}this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.angle,s),this.viewer.requestDraw()}}updateDefinition(e,t,i,s,n){let r;if(this.isBeingManipulated()&&(r=I.vec3C.add(I.vec3C.scale(this.zeroAngleDirection,Math.cos(this.angle),a.vec3.create()),I.vec3C.scale(this.upDirection,Math.sin(this.angle),a.vec3.create()))),this.axis=new p.Ray(e,t),this.zeroAngleDirection=I.vec3C.normalize(i,a.vec3.create()),this.radius=s,this.upDirection=I.vec3C.cross(this.axis.direction,this.zeroAngleDirection,a.vec3.create()),I.vec3C.normalize(this.upDirection),n||(n=0),this.isBeingManipulated()&&r){const e=a.vec3.dot(r,this.zeroAngleDirection),t=a.vec3.dot(r,this.upDirection);if(e*e+t*t<g.Tolerances.ZERO_LENGTH*g.Tolerances.ZERO_LENGTH)this.angle=n;else{const i=Math.atan2(t,e);this.angle=(0,p.closestAngleInRange)(i,this.angle,this.minAngle,this.maxAngle)}}else this.angle=n;(0,p.requestDraw)()}updateLimits(e,t){this.minAngle=e,this.maxAngle=t}updateEditLimits(e,t){this.minDisplayAngle=e,this.maxDisplayAngle=t}setDisableMinimumOffset(e){this.disableMinimumOffset=e}getAngle(){return this.angle}getEditAngle(){return this.angleRelativeToInitialZeroDirectionForEdit}getEditAngleDisplacement(){let e=(0,p.angleBetweenVectors)(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction);if(this.maxDisplayAngle-this.minDisplayAngle>2*Math.PI&&(0,p.sign)(e)!==(0,p.sign)(this.angleRelativeToInitialZeroDirection)){const t=2*Math.PI-Math.abs(e);e=(0,p.sign)(this.angleRelativeToInitialZeroDirection)*t}let t=Math.abs(e)-Math.abs(this.angleRelativeToInitialZeroDirectionForEdit);return this.angleRelativeToInitialZeroDirection<0&&(t=-t),t}getAxis(){return this.axis}getZeroAngleDirection(){return this.zeroAngleDirection}getPosition(e,t){const i=Math.cos(e)*t,s=Math.sin(e)*t,n=a.vec3.create(),r=a.vec3.create();return I.vec3C.add(I.vec3C.scale(this.zeroAngleDirection,i,n),I.vec3C.add(I.vec3C.scale(this.upDirection,s,r),this.axis.point))}updateEditBoxPosition(e){const t=e.getPixelSizeAtWorldPoint(this.axis.point),i=(0,u.getDevicePixelRatio)(),s=(S.getNumber("MANIPULATOR_ANGULAR_ARROW_SHAFT_LENGTH_PX")+S.getNumber("MANIPULATOR_ANGULAR_ARROW_RADIUS_PX")+S.getNumber("MANIPULATOR_ANGULAR_ARROW_LENGTH_PX")+2*S.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS")*i+2*S.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS")*i)*t,n=this.getPosition(0,s),r=e.projectWorldPointToCanvas(this.axis.point),a=e.projectWorldPointToCanvas(n),o=w(r,a);a[0]=o.x+a[0]/(0,u.getDevicePixelRatio)(),a[1]=o.y+a[1]/(0,u.getDevicePixelRatio)(),this.triggerEditOriginChange(a[0],a[1])}updateGraphics(e){super.updateGraphics(e);const t=Math.acos(Math.abs(a.vec3.dot(e.getForward(),this.axis.direction))),i=this.isBeingManipulated()?1:1-(0,p.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,t);if(this.updateColor(i),!this.isHidden){const t=e.getPixelSizeAtWorldPoint(this.axis.point),i=this.axis.point,s=this.radius+t*this.radialOffsetPx,n=this.getPosition(this.angle,s),r=S.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS")*t,o=n,c=I.vec3C.scale(I.vec3C.normalize(I.vec3C.subtract(n,i,a.vec3.create())),r),l=I.vec3C.normalize(this.axis.direction,a.vec3.create()),h=I.vec3C.cross(l,c,a.vec3.create()),d=a.mat4.fromValues(c[0],c[1],c[2],0,h[0],h[1],h[2],0,l[0],l[1],l[2],0,o[0],o[1],o[2],1),m=(0,u.getDevicePixelRatio)();if(I.mat4C.scale(d,a.vec3.fromValues(m,m,m)),this.hasEditView){this.updateEditBoxPosition(e);let t=0;if(this.isDragging)t=this.angleRelativeToInitialZeroDirectionForEdit;else{let e=(0,p.angleBetweenVectors)(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction);this.maxDisplayAngle-this.minDisplayAngle>2*Math.PI&&(e=Math.abs(this.angleRelativeToInitialZeroDirectionForEdit)>g.Tolerances.ZERO_ANGLE?function(e,t,i,s){let n=(0,p.angleBetweenVectors)(e,t,i);s?n<0&&(n=2*Math.PI+n):n>0&&(n=-1*(2*Math.PI-n));return n}(this.initialZeroAngleDirection,this.zeroAngleDirection,this.getAxis().direction,this.isClockWiseRotation):this.angleRelativeToInitialZeroDirectionForEdit),t=e}const i=Math.abs(F(t));this.triggerEditValueChange({value:i,isLength:!1});const s=1.5,n=S.getNumber("MANIPULATOR_ANGULAR_HANDLE_RADIUS_SCALE")-s,r=S.getNumber("MANIPULATOR_ANGULAR_HANDLE_SUBTENSION_FACTOR")*Math.abs(Math.atan(1/n)),o=2*S.getNumber("MANIPULATOR_CIRCLE_SEGMENTS"),c=t<0?r:-r,l=a.vec3.fromValues(-n,0,0);let h=(0,p.createArc)(l,n,a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),c,-t,o);const d=a.vec3.create(),u=a.vec3.fromValues(0,1,0),m=a.vec3.fromValues(1,0,0),E=n*Math.cos(-t),T=n*Math.sin(-t);I.vec3C.add(l,I.vec3C.add(I.vec3C.scale(u,T,a.vec3.create()),I.vec3C.scale(m,E,a.vec3.create()),d),d);const f=new p.Ray(l,I.vec3C.subtract(l,d,a.vec3.create())),C=S.getNumber("MANIPULATOR_ANGULAR_START_LINE_LENGTH_FACTOR"),P=(0,p.createLines)([f.evaluate(-n+C),f.evaluate(-n-C)]);h=h.concatenate(P),(0,p.addColorToIncrement)(S.getColor("MANIPULATOR_DISPLACEMENT_COLOR"),h),(0,p.addSizeToIncrement)(S.getNumber("MANIPULATOR_DISPLACEMENT_LINE_WIDTH"),h),this.updateMeshIncrement(D,p.NO_SELECTION_ID,h,M)}this.setTransform(d)}}dragByIncrementValue(e){const t=this.viewer.getCamera(),i=t.getPixelSizeAtWorldPoint(this.axis.point),s=this.getClampedRadius(i,!0);let n=t.projectWorldPointToCanvas(this.getPosition(this.angle,s));const r={mouseX:n[0],mouseY:n[1],camera:t};this.onDragStart(null,r,{requestDrag:!1}),e=B(e),n=t.projectWorldPointToCanvas(this.getPosition(this.angle+e,s)),r.mouseX=n[0],r.mouseY=n[1],this.onDrag(null,r),this.onDragStop(null,r)}getClampedRadius(e,t){if(this.disableMinimumOffset)return this.radius;let i=this.radius;const s=S.getNumber("MANIPULATOR_ANGULAR_MINIMUM_RADIUS_PX")*e;return i<s&&(i=s),t&&(i+=e*this.radialOffsetPx),i}}function B(e){return e="degree"===(0,c.getCurrentDocumentSettingsModel)().getAngleUnits()?e*Math.PI/180:e}function F(e){return e="degree"===(0,c.getCurrentDocumentSettingsModel)().getAngleUnits()?180*e/Math.PI:e}t.Angular=L;t.AngularWithArrow=class extends L{constructor(e){super(e)}updateGraphics(e){let t=Math.abs(a.vec3.dot(e.getForward(),this.axis.direction));t>1?t=1:t<-1&&(t=-1);const i=Math.acos(t),s=this.isBeingManipulated()?1:1-(0,p.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,i);if(s<=0)return void this.removeMeshIncrements();const n=e.getPixelSizeAtWorldPoint(this.axis.point),r=this.getClampedRadius(n,!0),o=this.getPosition(this.angle,r),c=Math.cos(this.angle),l=Math.sin(this.angle),h=I.vec3C.add(I.vec3C.scale(this.zeroAngleDirection,-l,a.vec3.create()),I.vec3C.scale(this.upDirection,c,a.vec3.create()));this.angle<0&&I.vec3C.negate(h);const d=N(new p.Ray(o,h),S.getNumber("MANIPULATOR_ANGULAR_ARROW_SHAFT_LENGTH_PX")*n,S.getNumber("MANIPULATOR_ANGULAR_ARROW_RADIUS_PX")*n,S.getNumber("MANIPULATOR_ANGULAR_ARROW_LENGTH_PX")*n,e,this.style);this.updateLines("linear",d.lines,s),this.updatePickArea(d.pickArea);const u=this.getClampedRadius(n,!1),g=u+S.getNumber("MANIPULATOR_ANGULAR_ARROW_LEADER_EXTENSION_PX")*n,m=this.getPosition(0,g),E=this.getPosition(this.angle,g),T=(0,p.createLines)([this.axis.point,m,this.axis.point,E]);this.updateLines("leaders",T,.5*s);const f=Math.abs(this.angle)*u/n,C=(0,p.createArc)(this.axis.point,u,this.axis.direction,this.zeroAngleDirection,0,this.angle,Math.floor(f/10));this.updateLines("arc",C,.5*s),!this.isHidden&&this.hasEditView&&this.updateEditBoxPosition(e)}};t.FreeDrag=class extends R{constructor(e,t){super(e,t),this.position=a.vec3.fromValues(0,0,0),this.dragPlane=a.vec4.fromValues(0,0,1,0),this.xrDragDistance=-1,this.lastMouseRay=new p.Ray([0,0,0],[1,0,0])}updateGeometry(){const e=S.getNumber("MANIPULATOR_CIRCLE_SEGMENTS");this.meshIncrement=(0,p.createCircle)(a.vec3.fromValues(0,0,0),1,a.vec3.fromValues(0,0,1),e),this.pickIncrement=(0,p.createDisc)(a.vec3.fromValues(0,0,0),1,a.vec3.fromValues(0,0,1),e)}onDragStart(e,t,i){if(!this.isEnabled)return;this.displayEditView&&((0,r.getCommandDispatcher)().trigger(n.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null));const s=t.camera.getForward();this.dragPlane=[s[0],s[1],s[2],a.vec3.dot(s,this.position)],super.onDragStart(e,t,i)}onXrDragStart(e,t,i){this.isEnabled&&(this.displayEditView&&((0,r.getCommandDispatcher)().trigger(n.commands.CLOSE_MANIPULATOR_EDIT_VIEW),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(null)),this.xrDragDistance=t.modelSpaceRay.findPositionOfPoint(this.position),super.onXrDragStart(e,t,i))}onDrag(e,t){if(this.isLocked)return;this.lastMouseRay=t.camera.getRay(t.mouseX,t.mouseY);const i=(0,p.intersectRayPlane)(this.lastMouseRay,this.dragPlane);this.handleDrag(i,t)}onXrDrag(e,t){if(this.isLocked)return;const i=t.modelSpaceRay.evaluate(this.xrDragDistance);this.handleDrag(i)}handleDrag(e,t){e&&(this.position=e,this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.position,null==t?void 0:t.mouseX,null==t?void 0:t.mouseY,t),this.viewer.requestDraw())}getLastMouseRay(){return this.lastMouseRay}updateDefinition(e){this.position=e,(0,p.requestDraw)()}updateGraphics(e){if(super.updateGraphics(e),this.updateColor(),!this.isHidden){const t=e.getPixelSizeAtWorldPoint(this.position),i=S.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX")*t,s=this.position,n=I.vec3C.scale(e.getForward(),-1,a.vec3.create()),r=I.vec3C.scale(e.getRight(),i,a.vec3.create()),o=I.vec3C.scale(e.getUp(),i,a.vec3.create()),c=a.mat4.fromValues(r[0],r[1],r[2],0,o[0],o[1],o[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],1);this.setTransform(c)}}};const x=new p.NodeProperties({isVisible:!0,isPickable:!0,isShowThrough:!0,isDepthTested:!1,priority:p.RenderOrderPriority.DEFAULT,primitiveType:p.PrimitiveType.POINTS}),U=new p.NodeProperties(Object.assign({},x,{priority:p.RenderOrderPriority.HIGHEST})),G=new p.NodeProperties(Object.assign({},x,{isPickable:!1}));class V extends R{constructor(e,t,i){super(e),this.points=[],this.pointBoundsCenter=a.vec3.create(),this.minimimumPointDistance=-1,this.lastPixelSize=-1,this.pointSize=-1,this.hoveredPointIndex=V.NO_SELECTED_INDEX,this.isMultiSelect=!1,this.isPointSelected=[],this.suppressedIndices=new Set,this.selectedIndicesServerState=new Set,this.boxSelectedIndices=new Set,this.isMultiSelect=t,this.isMultiSelect&&(this.listenTo(e.getEventDispatcher(),m.PICKS_BOX_SELECTED,this.onPicksBoxSelected),this.listenTo(e.getEventDispatcher(),m.BOX_SELECTION_FINISHED,this.onBoxSelectionFinished)),this.manipulatorChangesInFlightSubscription=null==i?void 0:i.subscribe((e=>{this.manipulatorChangesInFlight=e}))}updateDefinition(e,t,i){var s;this.selectedIndicesServerState=t,0===(null!==(s=this.manipulatorChangesInFlight)&&void 0!==s?s:0)&&(this.isPointSelected=e.map(((e,t)=>this.selectedIndicesServerState.has(t)))),this.suppressedIndices=null!=i?i:new Set,this.processPoints(e)}processPoints(e){this.points=e;const t=new p.BoundingBox;t.addPointArray(e),t.isFinite()&&(this.pointBoundsCenter=t.center());let i=-1;this.minimimumPointDistance=-1;for(let t=0;t<e.length;++t)for(let s=t+1;s<e.length;++s){const n=a.vec3.squaredDistance(e[t],e[s]);(i<0||n<i)&&(i=n)}i>=0&&(this.minimimumPointDistance=Math.sqrt(i)),this.lastPixelSize=-1,this.pointSize=-1}updatePointGraphics(){if(this.isMultiSelect&&this.viewer.performingBoxSelection())return;if(this.removeMeshIncrements(),this.stopListening(this),this.stopListening(this.viewer.getEventDispatcher()),this.pointSize<=0)return;const e=S.getPointFont("MANIPULATOR_POINT_FONT");for(let t=0;t<this.points.length;++t){const i="point"+t,s=this.getSelectionIdForIndex(t),n=this.isMultiSelect?this.getPointColorMultiSelect(t):this.getPointColor(t),r=this.isMultiSelect&&this.suppressedIndices.has(t)?this.pointSize/1.5:this.pointSize,a=(0,p.createPoint)(this.points[t],i,n,r,e);this.updateMeshIncrement(i,s,a,this.getPointNodeProperties(t)),this.listenTo(this,p.UiEvents.MOUSE_ENTER+s,this.onMouseEnter),this.listenTo(this,p.UiEvents.MOUSE_LEAVE+s,this.onMouseLeave),this.listenTo(this,p.UiEvents.CLICK+s,this.onClick)}this.isMultiSelect&&(this.listenTo(this.viewer.getEventDispatcher(),m.PICKS_BOX_SELECTED,this.onPicksBoxSelected),this.listenTo(this.viewer.getEventDispatcher(),m.BOX_SELECTION_FINISHED,this.onBoxSelectionFinished))}onViewWillDraw(e,t){if(this.isHidden)return;const i=e.getPixelSizeAtWorldPoint(this.pointBoundsCenter);if(i!==this.lastPixelSize){let e;this.lastPixelSize=i;const t=this.minimimumPointDistance/i,s=S.getNumber("MANIPULATOR_SMALL_POINT_DISTANCE_PX"),n=S.getNumber("MANIPULATOR_LARGE_POINT_DISTANCE_PX");if(t<=s)e=V.SMALL_SIZE_CONSTANT;else if(t>=n)e=V.LARGE_SIZE_CONSTANT;else{const i=(t-s)/(n-s);e=(0,p.mix)(V.SMALL_SIZE_CONSTANT,V.LARGE_SIZE_CONSTANT,i)}this.pointSize!==e&&(this.pointSize=e,this.updatePointGraphics())}}onMouseEnter(e){this.isEnabled&&this.setHoveredPoint(this.getIndexForSelection(e))}onMouseLeave(e){if(!this.isEnabled)return;this.getIndexForSelection(e)===this.hoveredPointIndex&&this.setHoveredPoint(V.NO_SELECTED_INDEX)}onClick(e){if(!this.isEnabled)return;const t=this.getIndexForSelection(e);!this.isMultiSelect&&this.isPointSelected[t]||this.setSelectedPoint(t)}onPicksBoxSelected(e){this.isEnabled&&this.queueManipulatorSelectionsFromPicks(e)}onBoxSelectionFinished(){this.setBoxSelectedPoints()}queueManipulatorSelectionsFromPicks(e){var t;for(const i of e){const e=null===(t=(0,T.as)(p.Pick,i))||void 0===t?void 0:t.uiSelection;(null==e?void 0:e.uiElement)instanceof V&&this.boxSelectedIndices.add(this.getIndexForSelection(e))}}getSelectionIdForIndex(e){return""+e}getIndexForSelection(e){return+e.selectionId}getPointColor(e){return this.isPointSelected[e]?S.getColor("MANIPULATOR_OUTLINE_DRAG_COLOR"):e===this.hoveredPointIndex?S.getColor("MANIPULATOR_OUTLINE_HOVER_COLOR"):S.getColor("MANIPULATOR_OUTLINE_COLOR")}getPointColorMultiSelect(e){return this.suppressedIndices.has(e)?S.getColor("MANIPULATOR_OUTLINE_DISABLED_COLOR"):e===this.hoveredPointIndex?S.getColor("MANIPULATOR_OUTLINE_HOVER_COLOR"):this.isPointSelected[e]?S.getColor("MANIPULATOR_OUTLINE_DRAG_COLOR"):S.getColor("MANIPULATOR_OUTLINE_COLOR")}getPointNodeProperties(e){return this.suppressedIndices.has(e)?G:this.isPointSelected[e]||e===this.hoveredPointIndex?U:x}setHoveredPoint(e){this.hoveredPointIndex!==e&&(this.hoveredPointIndex=e,this.updatePointGraphics())}setSelectedPoint(e){this.isMultiSelect?this.isPointSelected[e]=!this.isPointSelected[e]:(this.isPointSelected[this.isPointSelected.findIndex((e=>e))]=!1,this.isPointSelected[e]=!0),this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.isPointSelected),this.updatePointGraphics()}setBoxSelectedPoints(){for(const e of this.boxSelectedIndices)this.isPointSelected[e]=!this.isPointSelected[e];this.boxSelectedIndices.clear(),this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.isPointSelected),this.updatePointGraphics()}remove(){var e;super.remove(),null===(e=this.manipulatorChangesInFlightSubscription)||void 0===e||e.unsubscribe()}}t.PointSelection=V,V.NO_SELECTED_INDEX=-1,V.SMALL_SIZE_CONSTANT=S.getNumber("MANIPULATOR_POINT_SMALL_SIZE"),V.LARGE_SIZE_CONSTANT=S.getNumber("MANIPULATOR_POINT_LARGE_SIZE");t.ScalingManipulator=class extends R{constructor(e,t){super(e,t),this.scale=1,this.dragScale=1,this.minScale=1e-5,this.maxScale=1e3,this.ray=new p.Ray([0,0,0],[0,0,1]),this.gapLengthPx=S.getNumber("MANIPULATOR_LINEAR_SHAFT_LENGTH_PX")*Math.sqrt(2),S.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"),this.headLengthPx=S.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"),this.isDraggable=!t||!t.hasOwnProperty("isDraggable")||t.isDraggable,this.setFadeParameters(S.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_START"),S.getNumber("MANIPULATOR_PLANAR_FADE_ANGLE_END"))}updateGeometry(){this.meshIncrement=(0,p.createArrow)(a.vec3.fromValues(0,0,this.gapLengthPx),a.vec3.fromValues(0,0,1),a.vec3.fromValues(1,0,0),0,this.headLengthPx,this.headLengthPx/Math.sqrt(3)),this.pickIncrement=(0,p.createQuad)(a.vec3.fromValues(-this.headLengthPx/2,0,this.gapLengthPx),a.vec3.fromValues(this.headLengthPx/2,0,this.gapLengthPx),a.vec3.fromValues(-this.headLengthPx/2,0,this.gapLengthPx+this.headLengthPx))}setGapLength(e){this.gapLengthPx=e}setHeadLength(e){this.headLengthPx=e}setIsDraggable(e){this.isDraggable=e}getPlaneDefinition(){return a.vec4.fromValues(this.normal[0],this.normal[1],this.normal[2],-a.vec3.dot(this.ray.point,this.normal))}getMousePlanePosition(e){const t=e.camera.getRay(e.mouseX,e.mouseY);return(0,p.intersectRayPlane)(t,this.getPlaneDefinition())}getXrInputPlanePosition(e){return(0,p.intersectRayPlane)(e.modelSpaceRay,this.getPlaneDefinition())}createEditView(){const e=new h.BTMParameterQuantity;e.parameterId="scale",e.units="",e.value=this.scale;const t=new h.BTQuantityRange;t.minValue=this.minScale,t.maxValue=this.maxScale,t.units="";const i={paramQuantity:e,quantityType:h.GBTQuantityType.REAL,range:t};(0,r.getCommandDispatcher)().trigger(n.commands.CREATE_MANIPULATOR_EDIT_VIEW,this,i,this.viewer)}onDragStart(e,t,i){const s=this.getMousePlanePosition(t);s&&(this.initializeDrag(s),super.onDragStart(e,t,i))}onXrDragStart(e,t,i){const s=this.getXrInputPlanePosition(t);s&&(this.initializeDrag(s),super.onXrDragStart(e,t,i))}initializeDrag(e){if(!e)return;const t=I.vec3C.subtract(e,this.ray.point,a.vec3.create());this.originToInitialLength=I.vec3C.length(t),this.dragScale=this.scale,this.displayEditView&&!this.hasEditView&&(this.createEditView(),(0,p.getManipulatorDisplacementDisplayManager)().setActiveManipulator(this))}onEditChange(e){this.scale=Math.max(0,e.value),this.trigger(E.ManipulatorEvents.VALUE_EDITED)}getScaleFromEvent(e){return this.getScaleFromPosition(this.getMousePlanePosition(e))}getScaleFromXrInputEvent(e){return this.getScaleFromPosition(this.getXrInputPlanePosition(e))}getScaleFromPosition(e){const t=I.vec3C.subtract(e,this.ray.point,a.vec3.create());return I.vec3C.length(t)/this.originToInitialLength}onDrag(e,t){!this.isLocked&&this.isDraggable&&this.handleDrag(this.getScaleFromEvent(t),t)}onXrDrag(e,t){!this.isLocked&&this.isDraggable&&this.handleDrag(this.getScaleFromXrInputEvent(t))}handleDrag(e,t){this.scale=this.dragScale*e,this.scale=parseFloat(this.scale.toFixed(this.offsetRoundDecimals)),this.trigger(E.ManipulatorEvents.VALUE_CHANGED,this.scale,t),this.viewer.requestDraw()}resetScale(){this.scale=1}updateDefinition(e,t,i){this.ray=new p.Ray(e,i),this.normal=t,(0,p.requestDraw)()}getScale(){return this.scale}updateGraphics(e){super.updateGraphics(e);const t=Math.acos(Math.min(Math.abs(a.vec3.dot(e.getForward(),this.normal)),1)),i=this.isBeingManipulated()?1:1-(0,p.smoothstep)(this.fadeAngleStart,this.fadeAngleEnd,t);if(this.updateColor(i),!this.isHidden){const t=e.getPixelSizeAtWorldPoint(this.ray.point),i=this.isBeingDragged?this.scale/this.dragScale:1,s=this.ray.point,n=I.vec3C.scale(I.vec3C.normalize(this.ray.direction,a.vec3.create()),i*t),r=I.vec3C.scale(I.vec3C.normalize(I.vec3C.cross(e.getForward(),n,a.vec3.create())),i*t),o=I.vec3C.scale(I.vec3C.normalize(I.vec3C.cross(n,r,a.vec3.create())),i*t),c=a.mat4.fromValues(r[0],r[1],r[2],0,o[0],o[1],o[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],1);if(this.hasEditView){this.triggerEditValueChangeNoUnit({value:this.scale});const i=(0,u.getDevicePixelRatio)(),n=this.gapLengthPx*t*i,r=this.ray.evaluate(n),a=e.projectWorldPointToCanvas(r),o=w(e.projectWorldPointToCanvas(s),a);a[0]=o.x+a[0]/(0,u.getDevicePixelRatio)(),a[1]=a[1]/(0,u.getDevicePixelRatio)(),this.triggerEditOriginChange(a[0],a[1])}this.setTransform(c)}}}},921131:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createTextureMaterial=t.DEFAULT_MATERIAL=t.UNLIT_COLOR_FROM_ATTRIBUTE=t.Material=void 0;const s=i(608521),n=i(114924),r=i(545348),a=i(723617),o=new n.NumberIdManager;class c{constructor(e){this.ambientTextureFactor=0,this.ambientTexture=null,this.shaderId=null,this.customFloatUniformSettings=null,this.customIntUniformSettings=null,this.customMatrixUniforms=null;const t=r.default.getManager();this.color=t.getColor("DEFAULT_MATERIAL_COLOR"),this.specularColor=t.getColor("DEFAULT_SPECULAR"),this.diffuseFactor=t.getNumber("COLOR_DIFFUSE_FACTOR"),this.ambientFactor=t.getNumber("COLOR_AMBIENT_FACTOR"),this.shininess=t.getNumber("DEFAULT_SHININESS"),this.translucentPassAlpha=t.getNumber("TRANSLUCENT_PASS_ALPHA"),this.pointSize=t.getNumber("DEFAULT_POINT_SIZE"),this.pointFont=t.getPointFont("DEFAULT_POINT_FONT"),this.lineWidth=t.getNumber("DEFAULT_LINE_WIDTH"),this.lineStipple=t.getStipple("DEFAULT_LINE_STIPPLE"),e&&((0,a.overwriteMatchingProperties)(this,e),e.hasOwnProperty("ambientTexture")&&!e.hasOwnProperty("ambientTextureFactor")&&(this.ambientTextureFactor=1)),this.id=o.getId(),this.specularColor=this.specularColor.slice(0,3),this.highlightSpecularContribution=t.getNumber("HIGHLIGHT_SPECULAR_CONTRIBUTION")}destroy(){o.isIdValid(this.id)&&(o.freeId(this.id),this.id=n.INVALID_NUMBER_ID)}setTexture(e){this.ambientTexture!==e&&(this.ambientTexture=e,this.ambientTextureFactor=1)}getTexture(){return this.ambientTexture}makeSceneDebugObject(){return(0,n.makeSceneDebugObjectFromObject)(this,"Material "+this.id)}setCustomFloatUniform(e,t){this.customFloatUniformSettings||(this.customFloatUniformSettings=new s.FastIteratorMap),this.customFloatUniformSettings.set(e,t)}setCustomIntUniform(e,t){this.customIntUniformSettings||(this.customIntUniformSettings=new s.FastIteratorMap),this.customIntUniformSettings.set(e,t)}setCustomMatrixUniform(e,t){this.customMatrixUniforms||(this.customMatrixUniforms=new s.FastIteratorMap),this.customMatrixUniforms.set(e,t)}setAttributes(e,t){if(e){if(t.setLastBufferBound(null),e.vertexAttrib4fv(n.AttributeNames.COLOR,this.color),e.uniform3fv("uSpecular",this.specularColor),e.uniform1f("uShininess",this.shininess),e.uniform1f("uColorDiffuseFactor",this.diffuseFactor),e.uniform1f("uColorAmbientFactor",this.ambientFactor),this.ambientTexture?(this.ambientTexture.viewer=t.viewer,e.useTexture("uAmbientTexture",this.ambientTexture)):e.useBlankTexture("uAmbientTexture"),e.uniform1f("uAmbientTextureFactor",this.ambientTextureFactor),e.uniform1f("uTranslucentPassAlpha",this.translucentPassAlpha),e.uniform1f("uHighlightSpecularContribution",this.highlightSpecularContribution),this.customFloatUniformSettings){const t=this.customFloatUniformSettings.getKeyValues();for(let i=0;i<t.length;i+=2)e.setFloatUniform(t[i],t[i+1])}if(this.customIntUniformSettings){const t=this.customIntUniformSettings.getKeyValues();for(let i=0;i<t.length;i+=2)e.setIntUniform(t[i],t[i+1])}if(this.customMatrixUniforms){const t=this.customMatrixUniforms.getKeyValues();for(let i=0;i<t.length;i+=2)e.setMatrixUniform(t[i],t[i+1])}}}hasTransparency(){return this.color[3]<1||!!this.ambientTexture&&this.ambientTexture.getHasTransparency()}getExtendedShaderId(){return this.shaderId}}t.Material=c,t.UNLIT_COLOR_FROM_ATTRIBUTE=new c({ambientFactor:1,diffuseFactor:0,specularColor:[0,0,0]}),t.DEFAULT_MATERIAL=new c,t.createTextureMaterial=function(e){return new c({ambientTexture:e||null,diffuseFactor:0,ambientFactor:1,specularColor:[0,0,0]})}},3693:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getEulerAnglesFromMatrix=t.toRotationMat=t.isUnitVector=t.vec4FromVec3=t.getPerpendicularBisector2d=t.distanceSquaredBetweenPoints=t.distanceSquaredToLineSegment2d=t.getIntersectionParameters=t.intersectTwoLineSegments2d=t.intersectLineSegmentRay=t.intersectTwoLines2d=t.difference2d=t.crossProduct2d=t.isMatrixIdentity=t.areMatricesEqual=t.areVectorsEqual=t.toDegrees=t.toRadians=t.smoothstep=t.interpolateInArray=t.mix=t.clamp=t.planeToWorld=t.worldToPlane=t.intersectRayTriangle=t.intersectRaySphere=t.intersectRayBox=t.intersectRayPlane=t.intersectRayPlaneMatrix=t.unprojectVectorToWorld=t.unprojectPlaneToWorld=t.projectWorldToPlane=t.extractPlaneFromMatrix=t.closestPointOnLine=t.projectToLine=t.getCosineOfAngleBetweenTwoVectors=t.Ray=t.isValidForBounding=t.BoundingBox=t.BoundingBox2D=t.BoundingSpot=t.intervalsOverlap=t.floorTowardsZero=t.ceilAwayFromZero=t.angleBetweenVectors=t.LARGEST_REPRESENTABLE_INTEGER=t.NUMBER_INTEGER_BITS=t.are2dPointsEqual=t.IDENTITY_MATRIX=t.canPointBeDisplayed=void 0,t.packedNormalsToFloatArray=t.isFiniteVector=t.isFinite=t.getNextPowerOfTwo=t.closestAngleInRange=t.closestAngleLessThanOrEqual=t.closestAngleGreaterThanOrEqual=t.closestAngle=t.getAngle=t.getPointAtAngle=t.getScaleFromMatrix=t.createTileViewportMatrix=t.createPickMatrix=t.createOffsetTileViewportMatrix=t.getMatrixFromEulerAngles=void 0;const s=i(264292),n=i(912057),r=i(873896),a=i(613199),o=[0,0,0];function c(e,t,i,s){return!(e>t||i>s)&&(e<i?i<t-r.Tolerances.ZERO_LENGTH:e<s-r.Tolerances.ZERO_LENGTH)}var l;window.glMatrixArrayType=Array,t.canPointBeDisplayed=function(e){return s.vec3.squaredLength(e)<Math.pow(r.Tolerances.MAX_MODEL_SIZE,2)},t.IDENTITY_MATRIX=s.mat4.create(),t.are2dPointsEqual=function(e,t){return s.vec2.squaredLength(a.vec2C.subtract(e,t,s.vec2.create()))<r.Tolerances.ZERO_LENGTH_SQUARED},t.NUMBER_INTEGER_BITS=53,t.LARGEST_REPRESENTABLE_INTEGER=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:9007199254740991,t.angleBetweenVectors=function(e,t,i){const n=s.vec3.dot(e,t),r=s.vec3.dot(a.vec3C.cross(e,t,s.vec3.create()),a.vec3C.normalize(i,s.vec3.create()));return Math.atan2(r,n)},t.ceilAwayFromZero=function(e){return e<0?Math.floor(e):Math.ceil(e)},t.floorTowardsZero=function(e){return e<0?Math.ceil(e):Math.floor(e)},t.intervalsOverlap=c,function(e){e[e.LOW=0]="LOW",e[e.MID=.5]="MID",e[e.HIGH=1]="HIGH"}(l||(t.BoundingSpot=l={}));class h{constructor(){this.reset()}isInitialized(){for(let e=0;e<2;++e)if(this.min[e]>this.max[e])return!1;return!0}reset(){this.min=[1/0,1/0],this.max=[-1/0,-1/0]}set(e,t){s.vec2.copy(this.min,e),s.vec2.copy(this.max,t)}copyFrom(e){this.set(e.min,e.max)}add(e){const t=e.length;for(let i=0;i<t;++i)for(let t=0;t<2;++t)e[i][t]<this.min[t]&&(this.min[t]=e[i][t]),e[i][t]>this.max[t]&&(this.max[t]=e[i][t])}addPoint(e){for(let t=0;t<2;++t)e[t]<this.min[t]&&(this.min[t]=e[t]),e[t]>this.max[t]&&(this.max[t]=e[t])}addPointXY(e,t){e<this.min[0]&&(this.min[0]=e),e>this.max[0]&&(this.max[0]=e),t<this.min[1]&&(this.min[1]=t),t>this.max[1]&&(this.max[1]=t)}addBox(e){if(e.isInitialized())for(let t=0;t<2;++t)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}getDimensions(){return a.vec2C.subtract(this.max,this.min,s.vec2.create())}overlapsWith(e){return c(this.min[0],this.max[0],e.min[0],e.max[0])&&c(this.min[1],this.max[1],e.min[1],e.max[1])}contains(e){return e[0]>=this.min[0]&&e[1]>=this.min[1]&&e[0]<=this.max[0]&&e[1]<=this.max[1]}makeCenteredBoxOnPoint(e,t){const i=.5*t;this.min[0]=e[0]-i,this.min[1]=e[1]-i,this.max[0]=e[0]+i,this.max[1]=e[1]+i}center(e){return e=e||s.vec2.create(),a.vec2C.scale(a.vec2C.add(this.min,this.max,e),.5)}getCorners(e){if(!e){e=[];for(let t=0;t<4;++t)e.push(s.vec2.create())}for(let t=0;t<2;++t)for(let i=0;i<2;++i){const s=e[2*i+t];s[0]=0===t?this.min[0]:this.max[0],s[1]=0===i?this.min[1]:this.max[1]}return e}translate(e){a.vec2C.add(this.min,e,this.min),a.vec2C.add(this.max,e,this.max)}}t.BoundingBox2D=h;const d=[0,0,0];class u{constructor(e,t){this.min=s.vec3.create(),this.max=s.vec3.create(),void 0!==e&&void 0!==t?this.set(e,t):this.reset()}clone(){return new u(this.min,this.max)}toString(){return"min: "+this.min+", max: "+this.max}makeSceneDebugObject(){let e="BoundingBox: ";if(this.isInitialized()){const t=[],i=[];for(let e=0;e<3;++e)t.push(this.min[e].toFixed(5)),i.push(this.max[e].toFixed(5));e+="(min: "+t+", max: "+i+")"}else e+="(Uninitialized)";return{text:e,children:[]}}getMin(){return s.vec3.clone(this.min)}getMax(){return s.vec3.clone(this.max)}set(e,t){s.vec3.copy(this.min,e),s.vec3.copy(this.max,t)}copyFrom(e){this.set(e.min,e.max)}reset(){this.set([1/0,1/0,1/0],[-1/0,-1/0,-1/0])}equals(e){for(let t=0;t<3;++t)if(this.min[t]!==e.min[t]||this.max[t]!==e.max[t])return!1;return!0}setInfinite(){this.set([-1/0,-1/0,-1/0],[1/0,1/0,1/0])}isInitialized(){for(let e=0;e<3;++e)if(this.min[e]>this.max[e])return!1;return!0}isInfinite(){for(let e=0;e<3;++e)if(this.min[e]===-1/0||this.max[e]===1/0)return!0;return!1}isFinite(){return this.isInitialized()&&!this.isInfinite()}areBoundDimensionsSmallerThan(e){for(let t=0;t<3;++t)if(this.max[t]-this.min[t]>=e)return!1;return!0}addPoint(e){for(let t=0;t<3;++t)e[t]<this.min[t]&&(this.min[t]=e[t]),e[t]>this.max[t]&&(this.max[t]=e[t])}addXYZ(e,t,i){e<this.min[0]&&(this.min[0]=e),e>this.max[0]&&(this.max[0]=e),t<this.min[1]&&(this.min[1]=t),t>this.max[1]&&(this.max[1]=t),i<this.min[2]&&(this.min[2]=i),i>this.max[2]&&(this.max[2]=i)}addPointArray(e){for(let t=0;t<e.length;++t)for(let i=0;i<3;++i)e[t][i]<this.min[i]&&(this.min[i]=e[t][i]),e[t][i]>this.max[i]&&(this.max[i]=e[t][i])}createTransformedCopy(e){const t=new u;return t.addBox(this,e),t}addBox(e,t,i){if(e&&e.isInitialized())if(e.isInfinite())this.setInfinite();else{if(i&&g.copyFrom(this),!t||A(t))this.addXYZ(e.min[0],e.min[1],e.min[2]),this.addXYZ(e.max[0],e.max[1],e.max[2]);else{const i=[e.min,e.max];for(let e=0;e<2;e++)for(let s=0;s<2;s++)for(let n=0;n<2;n++){const r=[i[e][0],i[s][1],i[n][2]];a.mat4C.multiplyVec3(t,r),this.addPoint(r)}}i&&!m(this)&&this.copyFrom(g)}}getCorners(){const e=[this.min,this.max],t=[];if(!this.isInitialized())return null;for(let i=0;i<2;i++)for(let n=0;n<2;n++)for(let r=0;r<2;r++)t.push(s.vec3.fromValues(e[i][0],e[n][1],e[r][2]));return t}getLocationInBox(e,t,i){return[M(this.min[0],this.max[0],e),M(this.min[1],this.max[1],t),M(this.min[2],this.max[2],i)]}isExtensive(){for(let e=0;e<3;e++)if(Math.abs(this.max[e]-this.min[e])>r.Tolerances.ZERO_LENGTH)return!0;return!1}center(e){e||(e=s.vec3.create());const t=a.vec3C.add(this.min,this.max,e);return a.vec3C.scale(t,.5),t}diagonalVector(e){return e||(e=s.vec3.create()),a.vec3C.subtract(this.max,this.min,e)}diameter(){return a.vec3C.length(a.vec3C.subtract(this.max,this.min,d))}maxDimension(){const e=a.vec3C.subtract(this.max,this.min,s.vec3.create());return Math.max(Math.abs(e[0]),Math.max(Math.abs(e[1]),Math.abs(e[2])))}scale(e){const t=this.center();a.vec3C.subtract(this.max,t),a.vec3C.scale(this.max,e),a.vec3C.add(this.max,t),a.vec3C.subtract(this.min,t),a.vec3C.scale(this.min,e),a.vec3C.add(this.min,t)}dilate(e){const t=s.vec3.fromValues(e,e,e);a.vec3C.add(this.max,t),a.vec3C.subtract(this.min,t)}getXyBounds(){const e=new h;return e.set([this.min[0],this.min[1]],[this.max[0],this.max[1]]),e}}t.BoundingBox=u;const g=new u;let p=!1;function m(e){return!!e&&(!!e.isInitialized()&&(!!e.areBoundDimensionsSmallerThan(r.Tolerances.MAX_BOUNDS_DIMENSION)||(p||(n.log.info("Found scenegraph node with very large bounds. It will be omitted from bounds computation"),p=!0),!1)))}t.isValidForBounding=m;function E(e,t,i){const s=i[0],n=i[1],r=(s*t[0]-s*e[0]+n*t[1]-n*e[1])/(s*s+n*n);t[0]=s*r+e[0],t[1]=n*r+e[1]}function I(e){const t=s.vec3.create();t[0]=e[8],t[1]=e[9],t[2]=e[10];const i=s.vec3.create();i[0]=e[12],i[1]=e[13],i[2]=e[14];const n=s.vec3.dot(t,i),r=s.vec4.create();return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=-n,r}function T(e,t,i){const n=s.vec3.dot(e.point,t),o=s.vec3.dot(e.direction,t);if(i=i||r.Tolerances.ZERO_ANGLE,Math.abs(o)<i)return null;{const i=-(n+t[3])/o;return a.vec3C.linComb(e.point,1,e.direction,i,s.vec3.create())}}t.Ray=class{constructor(e,t){this.point=s.vec3.clone(e),this.direction=a.vec3C.normalize(t,s.vec3.create())}setPoint(e){this.point=s.vec3.clone(e)}setDirection(e){this.direction=a.vec3C.normalize(e,s.vec3.create())}evaluate(e,t){return a.vec3C.add(a.vec3C.scale(this.direction,e,t||s.vec3.create()),this.point)}findClosestPositionToOtherRay(e){const t=s.vec3.dot(this.direction,this.direction),i=s.vec3.dot(this.direction,e.direction),n=s.vec3.dot(e.direction,e.direction),o=t*n-i*i;if(Math.abs(o)<r.Tolerances.ZERO_ANGLE)return null;const c=a.vec3C.subtract(this.point,e.point,s.vec3.create()),l=s.vec3.dot(this.direction,c);return(i*s.vec3.dot(e.direction,c)-n*l)/o}findPositionOfPoint(e){return s.vec3.dot(this.direction,a.vec3C.subtract(e,this.point,s.vec3.create()))}},t.getCosineOfAngleBetweenTwoVectors=function(e,t){const i=e[0]*t[0]+e[1]*t[1],s=Math.sqrt(e[0]*e[0]+e[1]*e[1]),n=Math.sqrt(t[0]*t[0]+t[1]*t[1]);return s<=r.Tolerances.ZERO_LENGTH||n<=r.Tolerances.ZERO_LENGTH?null:i/(s*n)},t.projectToLine=E,t.closestPointOnLine=function(e,t,i){const n=a.vec3C.subtract(t,e,s.vec3.create()),r=(s.vec3.dot(i,n)-s.vec3.dot(e,n))/s.vec3.squaredLength(n);return r<=0?(n[0]=e[0],n[1]=e[1],n[2]=e[2]):r>=1?(n[0]=t[0],n[1]=t[1],n[2]=t[2]):a.vec3C.add(a.vec3C.scale(n,r),e),n},t.extractPlaneFromMatrix=I,t.projectWorldToPlane=function(e,t){let i=s.vec4.create();const n=s.vec4.create();return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=1,i=a.mat4C.multiplyVec4(t,n,i),[i[0],i[1],i[2]]},t.unprojectPlaneToWorld=function(e,t){let i=s.vec4.create();const n=s.vec4.create();return n[0]=e[0],n[1]=e[1],n[2]=0,n[3]=1,i=a.mat4C.multiplyVec4(t,n,i),[i[0],i[1],i[2]]},t.unprojectVectorToWorld=function(e,t){let i=s.vec4.create();const n=s.vec4.create();return n[0]=e[0],n[1]=e[1],n[2]=0,n[3]=0,i=a.mat4C.multiplyVec4(t,n,i),[i[0],i[1],i[2]]},t.intersectRayPlaneMatrix=function(e,t,i){return T(e,I(t),i)},t.intersectRayPlane=T;const S=s.vec3.create(),f=s.vec3.create(),C=s.vec3.create(),P=s.vec3.create(),v=s.vec3.create();function D(e,t,i){return Math.min(i,Math.max(e,t))}function M(e,t,i){return(1-i)*e+i*t}t.intersectRayBox=function(e,t,i){let n,r=!0;const a=S,o=f,c=C;for(n=0;n<3;++n)e.point[n]<t.min[n]?(a[n]=1,c[n]=t.min[n],r=!1):e.point[n]>t.max[n]?(a[n]=0,c[n]=t.max[n],r=!1):a[n]=2;if(r)return i=i||s.vec3.create(),s.vec3.copy(i,e.point),i;for(n=0;n<3;++n)2!==a[n]&&0!==e.direction[n]?o[n]=(c[n]-e.point[n])/e.direction[n]:o[n]=-1;let l=0;for(n=1;n<3;++n)o[l]<o[n]&&(l=n);if(o[l]<0)return null;for(i=i||s.vec3.create(),n=0;n<3;++n)if(l!==n){if(i[n]=e.point[n]+o[l]*e.direction[n],i[n]<t.min[n]||i[n]>t.max[n])return null}else i[n]=c[n];return i},t.intersectRaySphere=function(e,t,i,n){const a=s.vec3.dot(e.direction,e.direction),o=2*e.direction[0]*(e.point[0]-t[0])+2*e.direction[1]*(e.point[1]-t[1])+2*e.direction[2]*(e.point[2]-t[2]);let c=o*o-4*a*(s.vec3.dot(t,t)+s.vec3.dot(e.point,e.point)-2*s.vec3.dot(t,e.point)-i*i);if(c<-r.Tolerances.ZERO_LENGTH_SQUARED)return null;if(Math.abs(c)<r.Tolerances.ZERO_LENGTH_SQUARED){const t=-o/2*a;return e.evaluate(t,n)}{c=Math.sqrt(c);const t=(-o-c)/(2*a);return t<0&&(-o+c)/(2*a)<0?null:t<0?s.vec3.copy(n||s.vec3.create(),e.point):e.evaluate(t,n)}},t.intersectRayTriangle=function(e,t,i,n){const r=1e-6,o=S,c=f,l=C,h=P,d=v;a.vec3C.subtract(i,t,o),a.vec3C.subtract(n,t,c),a.vec3C.cross(e.direction,c,l);const u=s.vec3.dot(o,l);if(u>-r&&u<r)return;const g=1/u;a.vec3C.subtract(e.point,t,d);const p=s.vec3.dot(d,l)*g;if(p<0||p>1)return;a.vec3C.cross(d,o,h);const m=s.vec3.dot(e.direction,h)*g;if(m<0||p+m>1)return;const E=s.vec3.dot(c,h);return E>r?E:void 0},t.worldToPlane=function(e,t,i,n){const r=a.vec3C.subtract(e,t,s.vec3.create());return[s.vec3.dot(r,n),s.vec3.dot(r,a.vec3C.cross(i,n,s.vec3.create()))]},t.planeToWorld=function(e,t,i,n){const r=a.vec3C.normalize(n,s.vec3.create()),o=a.vec3C.scale(r,e[0],s.vec3.create()),c=a.vec3C.scale(a.vec3C.cross(i,r,s.vec3.create()),e[1],s.vec3.create());return a.vec3C.add(t,a.vec3C.add(o,c,s.vec3.create()),s.vec3.create())},t.clamp=D,t.mix=M,t.interpolateInArray=function(e,t){if(!e||0===e.length)return;const i=(t-Math.floor(t))*e.length,s=Math.floor(i),n=(s+1)%e.length,r=i-s;return M(e[s],e[n],r)},t.smoothstep=function(e,t,i){return(i=D((i-e)/(t-e),0,1))*i*(3-2*i)};const y=Math.PI/180,O=180/Math.PI;function _(e,t){if(e===t)return!0;const i=!!e;if(i!==!!t)return!1;if(!i)return!0;if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(Math.abs(e[i]-t[i])>=r.Tolerances.ZERO_LENGTH)return!1;return!0}function A(e){return!!e&&(0,t.areMatricesEqual)(e,t.IDENTITY_MATRIX)}function R(e,t){return e[0]*t[1]-e[1]*t[0]}function N(e,t){return[e[0]-t[0],e[1]-t[1]]}function w(e,t,i,s,n){const a=R(t,s);if(Math.abs(a)<r.Tolerances.ZERO_LENGTH)return!1;const o=N(i,e);return n[0]=R(o,s)/a,n[1]=R(o,t)/a,!0}function b(e,t){return Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)}t.toRadians=function(e){return e*y},t.toDegrees=function(e){return e*O},t.areVectorsEqual=_,t.areMatricesEqual=_,t.isMatrixIdentity=A,t.crossProduct2d=R,t.difference2d=N,t.intersectTwoLines2d=function(e,t,i,s,n){const r=[];return!!w(e,t,i,s,r)&&(n[0]=e[0]+r[0]*t[0],n[1]=e[1]+r[0]*t[1],!0)},t.intersectLineSegmentRay=function(e,t,i,s,n){const r=[];return!!w(e,t,i,[s[0]-i[0],s[1]-i[1]],r)&&(r[0]>=0&&r[1]>=0&&r[1]<=1&&(n[0]=i[0]+r[0]*t[0],n[1]=i[1]+r[0]*t[1],!0))},t.intersectTwoLineSegments2d=function(e,t,i,s,n){const r=[t[0]-e[0],t[1]-e[1]],a=[];return!!w(e,r,i,[s[0]-i[0],s[1]-i[1]],a)&&(a[0]>=0&&a[0]<=1&&a[1]>=0&&a[1]<=1&&(n[0]=e[0]+a[0]*r[0],n[1]=e[1]+a[0]*r[1],!0))},t.getIntersectionParameters=w,t.distanceSquaredToLineSegment2d=function(e,t,i){const s=[i[0],i[1]];return E(e,s,[t[0]-e[0],t[1]-e[1]]),s[0]<=Math.max(e[0],t[0])&&s[0]>=Math.min(e[0],t[0])&&s[1]<=Math.max(e[1],t[1])&&s[1]>=Math.min(e[1],t[1])?b(i,s):Math.min(b(i,e),b(i,t))},t.distanceSquaredBetweenPoints=b,t.getPerpendicularBisector2d=function(e,t,i,s){i[0]=(e[0]+t[0])/2,i[1]=(e[1]+t[1])/2;const n=[t[0]-e[0],t[1]-e[1]],a=[n[1],-n[0]],o=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return!(o<r.Tolerances.ZERO_LENGTH)&&(s[0]=a[0]/o,s[1]=a[1]/o,!0)},t.vec4FromVec3=function(e,t){return[e[0],e[1],e[2],t]},t.isUnitVector=function(e){return Math.abs(1-s.vec3.squaredLength(e))<=r.Tolerances.ZERO_LENGTH_SQUARED},t.toRotationMat=function(e,t){return t||(t=s.mat4.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=0,t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t};const L=[0,0,0];function B(e,t,i,n){const r=s.mat4.create(),o=t[2]/e[2],c=t[3]/e[3];a.mat4C.scale(r,[o,c,1]);const l=e[0]-i+e[2]/2,h=e[1]-n+e[3]/2,d=1-2*l/t[2],u=2*h/t[3]-1;return a.mat4C.translate(r,[d,u,0]),r}function F(e,t){for(let i=0;i<3;++i){for(let t=0;t<3;++t)o[t]=e[4*i+t];t[i]=a.vec3C.length(o)}}function x(e,t){return e-2*Math.round((e-t)/(2*Math.PI))*Math.PI}function U(e,t){return e-2*Math.floor((e-t)/(2*Math.PI))*Math.PI}function G(e,t){return e+2*Math.floor((t-e)/(2*Math.PI))*Math.PI}function V(e){for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}t.getEulerAnglesFromMatrix=function(e,t){if(F(e,L),Math.abs(1-Math.abs(e[2]/L[0]))>r.Tolerances.ZERO_ANGLE){t[1]=-Math.asin(e[2]/L[0]);const i=Math.cos(t[1]);t[0]=Math.atan2(e[6]/(i*L[1]),e[10]/(i*L[2])),t[2]=Math.atan2(e[1]/(i*L[0]),e[0]/(i*L[0]))}else t[2]=0,e[2]<0?(t[1]=Math.PI/2,t[0]=t[2]+Math.atan2(e[4]/L[1],e[8]/L[2])):(t[1]=-Math.PI/2,t[0]=-t[2]+Math.atan2(-e[4]/L[1],-e[8]/L[2]))},t.getMatrixFromEulerAngles=function(e){const t=Math.cos(e[0]),i=Math.sin(e[0]),n=Math.cos(e[1]),r=Math.sin(e[1]),a=Math.cos(e[2]),o=Math.sin(e[2]),c=s.mat4.create();return c[0]=n*a,c[1]=n*o,c[2]=-r,c[4]=i*r*a-t*o,c[5]=i*r*o+t*a,c[6]=i*n,c[8]=t*r*a+i*o,c[9]=t*r*o-i*a,c[10]=t*n,c},t.createOffsetTileViewportMatrix=B,t.createPickMatrix=function(e,t,i){const s=i-(t[1]+t[3]);return B(e,t,t[0],s)},t.createTileViewportMatrix=function(e,t){return B(e,t,0,0)},t.getScaleFromMatrix=F,t.getPointAtAngle=function(e,t,i){const s=Math.cos(i),n=Math.sin(i);return[e[0]+s*t,e[1]+n*t]},t.getAngle=function(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])},t.closestAngle=x,t.closestAngleGreaterThanOrEqual=U,t.closestAngleLessThanOrEqual=G,t.closestAngleInRange=function(e,t,i,s){let n;return s-i<2*Math.PI?(n=U(e,i),n>s&&(n=U(n,s)-s>U(i,n)-n?i:s)):(n=x(e,t),n>s?n=U(n,i):n<i&&(n=G(n,s))),n},t.getNextPowerOfTwo=function(e){let t=1;for(;t<e;)t*=2;return t},t.isFinite=function(e){return e.length?V(e):Number.isFinite(e)},t.isFiniteVector=V;const H=1023,k=511,W=1/k;function z(e){return e>k?e-1024:e}t.packedNormalsToFloatArray=function(e,t){const i=new Float32Array(3*e.length);let s=0;for(let n=0;n<e.length;++n){const r=t?t[n]*W:W,a=0|e[n];i[s++]=z(a&H)*r,i[s++]=z(a>>10&H)*r,i[s++]=z(a>>20&H)*r}return i}},638953:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.CombDisplay=t.AngleDisplay=t.DistanceDisplay=void 0;const s=i(545348),n=i(264292),r=i(114924),a=i(613199),o=new r.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,primitiveType:r.PrimitiveType.LINES}),c=new r.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,primitiveType:r.PrimitiveType.POINTS}),l=new r.NodeProperties({primitiveType:r.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isTwoSided:!1,isShowThrough:!1,isDepthTested:!0}),h=new r.NodeProperties({primitiveType:r.PrimitiveType.LINES,isPickable:!1,isHighlightable:!1,isShowThrough:!0,isTwoSided:!0,isDepthTested:!1,isStencilTested:!0}),d=s.default.CONSTANT_DEFAULTS,u=s.default.getManager(),g=u.getStipple("CURVATURE_UV_TOOTH_STIPPLE"),p=u.getNumber("CURVATURE_TOOTH_LINE_WIDTH"),m=u.getNumber("CURVATURE_ROOF_LINE_WIDTH"),E=u.getStipple("CURVATURE_UV_ROOF_STIPPLE"),I="distanceedge";class T extends r.UIElement{constructor(e,t,i){super(i),this.startPoint=e,this.endPoint=t,this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!1,this.drawDistanceP=!1,this.deltaPoint=a.vec3C.subtract(t,e,n.vec3.create()),this.distance=a.vec3C.length(this.deltaPoint),this.distanceColor=u.getColor("PROJECT_MEASUREMENT_DISTANCE_COLOR"),this.componentColors=[u.getColor("X_AXIS_COLOR"),u.getColor("Y_AXIS_COLOR"),u.getColor("Z_AXIS_COLOR")],this.measurementStipple=u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),this.pointSize=d.PROJECT_MEASUREMENT_POINT_SIZE,this.lineWidth=d.PROJECT_MEASUREMENT_DISTANCE_LINE_WIDTH}onViewWillDraw(e,t){this.updateGraphics()}onAppearanceConstantsUpdated(){this.distanceColor=u.getColor("PROJECT_MEASUREMENT_DISTANCE_COLOR"),this.componentColors=[u.getColor("X_AXIS_COLOR"),u.getColor("Y_AXIS_COLOR"),u.getColor("Z_AXIS_COLOR")]}updateGraphics(){if(this.drawDistanceP||this.drawDeltaP){const e=[this.deltaPoint[0],0,0],t=[0,this.deltaPoint[1],0],i=a.vec3C.add(this.startPoint,e,n.vec3.create()),s=a.vec3C.add(i,t,n.vec3.create()),c=this.endPoint;if(this.drawDeltaP){const e=(0,r.createLine)(this.startPoint,i);(0,r.addColorToIncrement)(this.componentColors[0],e),(0,r.addSizeToIncrement)(this.lineWidth,e),(0,r.addStyleToIncrement)(this.measurementStipple,e),this.updateMeshIncrement("xedge",r.NO_SELECTION_ID,e,o);const t=(0,r.createLine)(i,s);(0,r.addColorToIncrement)(this.componentColors[1],t),(0,r.addSizeToIncrement)(this.lineWidth,t),(0,r.addStyleToIncrement)(this.measurementStipple,t),this.updateMeshIncrement("yedge",r.NO_SELECTION_ID,t,o);const n=(0,r.createLine)(s,c);(0,r.addColorToIncrement)(this.componentColors[2],n),(0,r.addSizeToIncrement)(this.lineWidth,n),(0,r.addStyleToIncrement)(this.measurementStipple,n),this.updateMeshIncrement("zedge",r.NO_SELECTION_ID,n,o)}if(this.drawDistanceP){const e=(0,r.createLine)(this.startPoint,this.endPoint);(0,r.addColorToIncrement)(this.distanceColor,e),(0,r.addSizeToIncrement)(this.lineWidth,e),(0,r.addStyleToIncrement)(this.measurementStipple,e),this.updateMeshIncrement(I,r.NO_SELECTION_ID,e,o)}}else if(this.drawStartPointP&&this.startPoint){const e=(0,r.createPoint)(this.startPoint,"startPoint",this.distanceColor,this.pointSize);this.updateMeshIncrement("point0",r.NO_SELECTION_ID,e,c)}else if(this.drawEndPointP&&this.endPoint){const e=(0,r.createPoint)(this.endPoint,"endPoint",this.distanceColor,this.pointSize);this.updateMeshIncrement("point1",r.NO_SELECTION_ID,e,c)}}setPermanentlyHighlightDistance(e){this.permanentlyHighlightDistance=e}drawNothing(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!1,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()}drawDelta(){this.removeMeshIncrements(),this.drawDeltaP=!0,this.drawStartPointP=!1,this.drawEndPointP=!1,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()}drawStartPoint(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!0,this.drawEndPointP=!1,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()}drawEndPoint(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!0,this.permanentlyHighlightDistance?this.drawDistanceP=!0:this.drawDistanceP=!1,this.viewer.requestDraw()}drawDistance(){this.removeMeshIncrements(),this.drawDeltaP=!1,this.drawStartPointP=!1,this.drawEndPointP=!1,this.drawDistanceP=!0,this.viewer.requestDraw()}drawAngle(){}drawComb(){}callMethod(e){switch(e){case"drawAngle":this.drawAngle();break;case"drawComb":this.drawComb();break;case"drawDistance":this.drawDistance();break;case"drawDelta":this.drawDelta();break;case"drawStartPoint":this.drawStartPoint();break;case"drawEndPoint":this.drawEndPoint();break;default:this.drawNothing()}}getValue(){return this.distance}getDeltaPoint(){return this.deltaPoint}getStartPoint(){return this.startPoint}getEndPoint(){return this.endPoint}}t.DistanceDisplay=T;t.AngleDisplay=class extends T{constructor(e,t,i,s,r,o,c){super(e,t,c),this.startVector=i,this.endVector=s,this.angle=o,this.isInvalid=!1,this.drawAngleP=!1,this.startLength=a.vec3C.length(i),this.startDir=a.vec3C.normalize(i,n.vec3.create()),this.endLength=a.vec3C.length(s),this.endDir=a.vec3C.normalize(s,n.vec3.create()),this.normalDir=r,this.angleColor=u.getColor("PROJECT_MEASUREMENT_ANGLE_COLOR"),this.angleLineWidth=d.PROJECT_MEASUREMENT_ANGLE_LINE_WIDTH,this.measurementStipple=u.getStipple("PROJECT_MEASUREMENT_STIPPLE")}onAppearanceConstantsUpdated(){this.angleColor=u.getColor("PROJECT_MEASUREMENT_ANGLE_COLOR"),super.onAppearanceConstantsUpdated()}getValue(){return this.angle}updateGraphics(){if(this.drawAngleP){const e=50,t=(0,r.createLine)(this.getStartPoint(),this.getEndPoint());(0,r.addColorToIncrement)(this.distanceColor,t),(0,r.addSizeToIncrement)(this.lineWidth,t),(0,r.addStyleToIncrement)(this.measurementStipple,t),this.updateMeshIncrement(I,r.NO_SELECTION_ID,t,o);const i=a.vec3C.add(this.getStartPoint(),this.startVector,n.vec3.create()),s=a.vec3C.add(this.getStartPoint(),this.endVector,n.vec3.create()),c=a.vec3C.add(this.getEndPoint(),this.startVector,n.vec3.create()),l=a.vec3C.add(this.getEndPoint(),this.endVector,n.vec3.create()),h=(0,r.createLine)(this.getStartPoint(),i);(0,r.addColorToIncrement)(this.angleColor,h),(0,r.addSizeToIncrement)(this.angleLineWidth,h),this.updateMeshIncrement("edge00",r.NO_SELECTION_ID,h,o);const d=(0,r.createLine)(this.getStartPoint(),s);(0,r.addColorToIncrement)(this.angleColor,d),(0,r.addSizeToIncrement)(this.angleLineWidth,d),(0,r.addStyleToIncrement)(u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),d),this.updateMeshIncrement("edge01",r.NO_SELECTION_ID,d,o);const g=(this.startLength+this.endLength)/4,p=(0,r.createArc)(this.getStartPoint(),g,this.normalDir,this.startDir,0,this.angle,e);(0,r.addColorToIncrement)(this.angleColor,p),(0,r.addSizeToIncrement)(this.angleLineWidth,p),this.updateMeshIncrement("arc0",r.NO_SELECTION_ID,p,o);const m=(0,r.createLine)(this.getEndPoint(),c);(0,r.addColorToIncrement)(this.angleColor,m),(0,r.addSizeToIncrement)(this.angleLineWidth,m),(0,r.addStyleToIncrement)(u.getStipple("PROJECT_MEASUREMENT_STIPPLE"),m),this.updateMeshIncrement("edge10",r.NO_SELECTION_ID,m,o);const E=(0,r.createLine)(this.getEndPoint(),l);(0,r.addColorToIncrement)(this.angleColor,E),(0,r.addSizeToIncrement)(this.angleLineWidth,E),this.updateMeshIncrement("edge11",r.NO_SELECTION_ID,E,o);const T=(0,r.createArc)(this.getEndPoint(),g,this.normalDir,this.startDir,0,this.angle,e);(0,r.addColorToIncrement)(this.angleColor,T),(0,r.addSizeToIncrement)(this.angleLineWidth,T),this.updateMeshIncrement("arc1",r.NO_SELECTION_ID,T,o)}}drawNothing(){this.removeMeshIncrements(),this.drawAngleP=!1,(0,r.requestDraw)()}drawAngle(){this.removeMeshIncrements(),this.drawAngleP=!0,(0,r.requestDraw)()}drawDistance(){}drawDelta(){}drawStartPoint(){}drawEndPoint(){}};t.CombDisplay=class extends T{constructor(e,t,i,s,n,r){super(e[0],e[0],r),this.isInvalid=!1,this.drawCombP=!1,this.combIndex=0,this.oversampling=1,this.points=e,this.normals=t,this.lengths=i,this.combIndex=s,this.oversampling=n}getValue(){return 0}updateGraphics(){if(this.drawCombP){const e=this.points.length,t=[],i=[],s=[];for(let s=0;s<e;s++){const e=n.vec3.create();a.vec3C.linComb(this.points[s],1,this.normals[s],this.lengths[s],e),i.push(e),s%this.oversampling||t.push(this.points[s],e)}for(let t=1;t<e;t++)s.push(i[t-1]),s.push(i[t]);const o=(0,r.createLines)(t,"comb",u.getColor(this.combIndex?"PROJECT_MEASUREMENT_CURVATURE_COLOR_2":"PROJECT_MEASUREMENT_CURVATURE_COLOR_1"),p);this.updateMeshIncrement("combIncrement",r.NO_SELECTION_ID,o,l);const c=(0,r.createLines)(t,"stippledComb",u.getColor(this.combIndex?"PROJECT_MEASUREMENT_CURVATURE_COLOR_2":"PROJECT_MEASUREMENT_CURVATURE_COLOR_1"),p,g);this.updateMeshIncrement("stippledCombIncrement",r.NO_SELECTION_ID,c,h);const d=(0,r.createLines)(s,"spine",u.getColor(this.combIndex?"PROJECT_MEASUREMENT_CURVATURE_COLOR_2":"PROJECT_MEASUREMENT_CURVATURE_COLOR_1"),m);this.updateMeshIncrement("spineCombIncrement",r.NO_SELECTION_ID,d,l);const I=(0,r.createLines)(s,"stippledSpine",u.getColor(this.combIndex?"PROJECT_MEASUREMENT_CURVATURE_COLOR_2":"PROJECT_MEASUREMENT_CURVATURE_COLOR_1"),m,E);this.updateMeshIncrement("stippledSpineIncrement",r.NO_SELECTION_ID,I,h)}}drawNothing(){this.removeMeshIncrements(),this.drawCombP=!1,(0,r.requestDraw)()}drawComb(){this.removeMeshIncrements(),this.drawCombP=!0,(0,r.requestDraw)()}drawDistance(){}drawDelta(){}drawStartPoint(){}drawEndPoint(){}}},691144:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryGauge=void 0;const s=i(736234),n=i(114924);t.MemoryGauge=class{constructor(){this.TOTAL_PROPERTY="total",this.BYTE_TO_MB=1/1048576,this.memoryUsage={}}reset(){this.memoryUsage={}}incrementMemoryUsage(e,t){if(e===this.TOTAL_PROPERTY)throw'Do not use "'+this.TOTAL_PROPERTY+'" as memory type.';this.memoryUsage.hasOwnProperty(e)?this.memoryUsage[e]+=t:this.memoryUsage[e]=t}decrementMemoryUsage(e,t){if(e===this.TOTAL_PROPERTY)throw'Do not use "'+this.TOTAL_PROPERTY+'" as memory type.';this.memoryUsage.hasOwnProperty(e)&&(this.memoryUsage[e]-=t)}addToStatistics(){const e=(0,n.getCounters)();for(const t in this.memoryUsage)e.increment("MB "+t,this.memoryUsage[t]*this.BYTE_TO_MB)}getUsageDetails(){const e=(0,s.clone)(this.memoryUsage);let t=0;for(const e in this.memoryUsage)t+=this.memoryUsage[e];return e[this.TOTAL_PROPERTY]=t,e}}},277197:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MeshPointController=void 0;const s=i(142885),n=i(114924),r=i(193786),a=i(545348),o=i(264292),c=i(613199),l=a.default.getManager().getColor("DEFAULT_MATERIAL_COLOR"),h=function(e){return e===(0,r.getPreselectionList)()};class d{constructor(e,t,i){this.pointElement=e,this.highlight=t,this.isPreSelection=i}}class u extends s.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.meshPoints={},(0,n.viewerCheck)(e),this.addMultipleSelections((0,r.getPreselectionList)()),this.addMultipleSelections((0,r.getSelectionList)()),this.resetSelectionListHandlers()}resetSelectionListHandlers(){this.listenTo((0,r.getPreselectionList)(),"add",this.onSelectionAdded),this.listenTo((0,r.getPreselectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,r.getPreselectionList)(),"reset",this.onSelectionReset),this.listenTo((0,r.getSelectionList)(),"add",this.onSelectionAdded),this.listenTo((0,r.getSelectionList)(),"remove",this.onSelectionRemoved),this.listenTo((0,r.getSelectionList)(),"reset",this.onSelectionReset)}onSelectionAdded(e,t){this.addSelection(e,t)}onSelectionReset(e){this.deleteAllMeshPoints(h(e)),this.addMultipleSelections(e)}onSelectionRemoved(e,t){this.removeSelection(e,t)}addMultipleSelections(e){e.each((function(t){this.addSelection(t,e)}),this)}deleteAllMeshPoints(e){Object.entries(this.meshPoints).forEach((function([t,i]){i.isPreSelection===e&&this.deleteMeshPoint(t)}),this)}removeSelection(e,t){if(!e||!e.isMeshPoint()||!(e.id in this.meshPoints))return;h(t)===this.meshPoints[e.id].isPreSelection&&this.deleteMeshPoint(e.id)}deleteMeshPoint(e){if(e in this.meshPoints){const t=this.meshPoints[e].pointElement,i=this.meshPoints[e].highlight;this.viewer.getHighlightManager(n.BTGraphicsUsage.BASE).freeHighlightForSelection(i.type,e),t.removeHighlight(i),t.remove(),delete this.meshPoints[e]}}addSelection(e,t){if(!e||!e.isMeshPoint())return;const i=h(t);if(e.id in this.meshPoints){if(i)return;this.deleteMeshPoint(e.id)}const s=this.viewer.getHighlightManager(n.BTGraphicsUsage.BASE).createHighlightForSelection(function(e){return h(e)?n.HighlightType.PRE:n.HighlightType.ENTITY}(t),e.id),r=e.sourcePick?this.viewer.getOccurrenceDataManager().getOccurrenceTransform(e.sourcePick.getOccurrenceId()):null,a=function(e,t,i,s){if(!e)return null;let r=o.vec3.clone(e);s&&(r=c.mat4C.multiplyVec3(s,r));const a=new n.PointElement(r,n.MAIN_SCENEGRAPH_ID,l,0,i);return a.addHighlight(t),a}(e.getMeshPointData().point,s,this.viewer,r);a&&(this.meshPoints[e.id]=new d(a,s,i))}destroy(){this.deleteAllMeshPoints(!0),this.deleteAllMeshPoints(!1),this.stopListening()}}t.MeshPointController=u},98357:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.addTriangleNormals=t.setIncrementOpacity=t.clearPlaneEquationIds=t.getPlaneEquationColor=t.getBitForPlaneEquationId=t.getBitForPlaneEquation=t.getPlaneEquationId=t.hashXYZ=t.hashPoint=t.numberToFixedPointString=t.createTriangleStrip=t.createTriangles=t.addStyleToIncrement=t.addSizeToIncrement=t.addPackedIntegerToIncrement=t.addByteColorToIncrement=t.addColorToIncrement=t.addTextureCoordinateToIncrement=t.addNormalToIncrement=t.addQuadToMesh=t.createWireBox=t.createBox=t.createRoundedRectangle=t.createQuadOutline=t.createQuad=t.createTriangle=t.createRing=t.createDoubleHeadArrow=t.createArrow=t.createArc=t.createCircle=t.createDisc=t.getCirclePoints=t.createPoint=t.addLinesToMesh=t.createLines=t.createLineLoop=t.addLineToMesh=t.createLine=t.makeCone=t.makeCylinder=t.makeSphere=t.createEdgesFromTriangles=t.createEdgesFromTriangleStrip=void 0;const s=i(912057),n=i(223456),r=i(114924),a=i(264292),o=i(613199);function c(e,t,i,s,n,a){const o=[e[0],e[1],e[2],t[0],t[1],t[2]],c=new r.MeshIncrement(r.PrimitiveType.LINES,o,[0,1],i);return s&&m(s,c),void 0!==n&&I(n,c),a&&T(a,c),c}function l(e,t,i,s,n){const a=new Float32Array(3*e.length),o=new Int32Array(e.length);for(let t=0;t<e.length;++t){o[t]=t;for(let i=0;i<3;++i)a[3*t+i]=e[t][i]}const c=new r.MeshIncrement(r.PrimitiveType.LINES,a,o,t);return i&&m(i,c),void 0!==s&&I(s,c),n&&T(n,c),c}function h(e,t,i,s,r,c,l){let h=r;h||(h=a.vec3.fromValues(1,0,0),(0,n.areUnitVectorsParallel)(i,h)&&(h=[0,1,0]));const d=o.vec3C.normalize(o.vec3C.cross(i,h,a.vec3.create()));h=o.vec3C.normalize(o.vec3C.cross(d,i,a.vec3.create())),void 0===c&&(c=0),void 0===l&&(l=2*Math.PI);const u=new Float32Array(3*(s+1));let g=c;const p=(l-c)/s,m=a.vec3.create(),E=a.vec3.create(),I=a.vec3.create();for(let i=0;i<s+1;++i){const s=t*Math.cos(g),n=t*Math.sin(g);o.vec3C.add(e,o.vec3C.add(o.vec3C.scale(d,n,E),o.vec3C.scale(h,s,I),m),m);for(let e=0;e<3;++e)u[3*i+e]=m[e];g+=p}return u}function d(e,t,i,s,n,c){const l=o.vec3C.subtract(t,e,a.vec3.create()),h=o.vec3C.subtract(i,e,a.vec3.create()),d=o.vec3C.normalize(o.vec3C.cross(l,h,a.vec3.create())),u=new Float32Array(12),g=new Float32Array(12),p=function(e,t){for(let i=0;i<3;++i)u[3*e+i]=t[i],g[3*e+i]=d[i]};let m;if(p(0,e),p(1,t),p(2,o.vec3C.add(t,h,a.vec3.create())),p(3,i),n&&c){m=new Float32Array(8);const e=function(e,t,i){m[2*e]=t,m[2*e+1]=i};e(0,n[0],n[1]),e(1,c[0],n[1]),e(2,c[0],c[1]),e(3,n[0],c[1])}const E=new r.MeshIncrement(r.PrimitiveType.TRIANGLES,u,[0,1,2,0,2,3],s);return E.normals=g,E.textureCoordinates=m||null,E}t.createEdgesFromTriangleStrip=function(e,t){const i=[];for(let t=0;t<e.indices.length-2;t++)e.indices[t+2]!==e.indices[t+1]&&e.indices[t+1]!==e.indices[t]&&(i.push(e.indices[t]),i.push(e.indices[t+1]),i.push(e.indices[t]),i.push(e.indices[t+2]),i.push(e.indices[t+1]),i.push(e.indices[t+2]));return new r.MeshIncrement(r.PrimitiveType.LINES,e.points,i,t)},t.createEdgesFromTriangles=function(e,t){if(e.primitiveType!==r.PrimitiveType.TRIANGLES)throw new Error("createEdgesFromTriangles can only be called with triangle primitives");const i=[];for(let t=0;t<e.indices.length;t+=3)i.push(e.indices[t]),i.push(e.indices[t+1]),i.push(e.indices[t]),i.push(e.indices[t+2]),i.push(e.indices[t+1]),i.push(e.indices[t+2]);return new r.MeshIncrement(r.PrimitiveType.LINES,e.points,i,t)},t.makeSphere=function(e,t){t||(t=12),e||(e=12);const i=[],s=[],n=[],r=function(e,t,n){i.push(e),i.push(t),i.push(n),s.push(e),s.push(t),s.push(n)};let a,o;for(r(0,0,1),a=0;a<t;a++){const i=a*Math.PI*2/t,s=Math.cos(i),n=Math.sin(i);for(o=1;o<=e;o++){const t=o*Math.PI/(e+1),i=Math.sin(t);r(i*s,i*n,Math.cos(t))}}r(0,0,-1);const c=function(i,s){return e*(s%t)+i+1},l=function(){n.push(n[n.length-1])};for(a=0;a<t;a++){for(n.length>1&&l(),n.push(0),o=0;o<e;o++)n.push(c(o,a)),n.push(c(o,a+1));n.push(e*t+1),l(),n.length%2==0&&l()}return S(i,n,s)},t.makeCylinder=function(e){(!e||e<3)&&(e=12);const t=[],i=[],s=[],n=function(e){const s=Math.cos(e),n=Math.sin(e);t.push(s),t.push(n),t.push(1),i.push(s),i.push(n),i.push(0),t.push(s),t.push(n),t.push(0),i.push(s),i.push(n),i.push(0)};let r,a;for(r=0;r<e;r++)a=2*Math.PI*r/e,n(a);for(r=0;r<e;r++)s.push(2*r),s.push(2*r+1);return s.push(0),s.push(1),S(t,s,i)},t.makeCone=function(e){(!e||e<3)&&(e=12);const t=[],i=[],s=[],n=function(e){const s=Math.cos(e),n=Math.sin(e),r=[s,n,1];o.vec3C.normalize(r),t.push(0),t.push(0),t.push(1),i.push(r[0]),i.push(r[1]),i.push(r[2]),t.push(s),t.push(n),t.push(0),i.push(r[0]),i.push(r[1]),i.push(r[2])};let r,a;for(r=0;r<e;r++)a=2*Math.PI*r/e,n(a);for(r=0;r<e;r++)s.push(2*r),s.push(2*r+1);return s.push(0),s.push(1),S(t,s,i)},t.createLine=c,t.addLineToMesh=function(e,t,i,s,n,r){e.addIncrement(c(t,i,s,n,r))},t.createLineLoop=function(e,t,i,s){const n=new Float32Array(3*e.length),a=new Int32Array(2*e.length);for(let t=0;t<e.length;++t){for(let i=0;i<3;++i)n[3*t+i]=e[t][i];a[2*t]=t,a[2*t+1]=(t+1)%e.length}const o=new r.MeshIncrement(r.PrimitiveType.LINES,n,a,t);return i&&m(i,o),void 0!==s&&I(s,o),o},t.createLines=l,t.addLinesToMesh=function(e,t,i,s,n){e.addIncrement(l(t,i,s,n))},t.createPoint=function(e,t,i,s,n){const a=new r.MeshIncrement(r.PrimitiveType.POINTS,e,[0],t);return i&&m(i,a),void 0!==s&&I(s,a),n&&T(n,a),a},t.getCirclePoints=h,t.createDisc=function(e,t,i,s){const n=h(e,t,i,s=Math.floor(Math.max(3,s)));let a;const o=n.length/3,c=new Float32Array(3*o);for(a=0;a<o;++a)for(let e=0;e<3;++e)c[3*a+e]=i[e];const l=s-2,d=new Int32Array(3*l);for(a=0;a<l;++a)d[3*a]=0,d[3*a+1]=a+1,d[3*a+2]=a+2;const u=new r.MeshIncrement(r.PrimitiveType.TRIANGLES,n,d);return u.normals=c,u},t.createCircle=function(e,t,i,s){const n=h(e,t,i,s=Math.floor(Math.max(3,s)));let a;const o=new Int32Array(2*s);for(a=0;a<s;++a)o[2*a]=a,o[2*a+1]=a+1;return o[o.length-1]=0,new r.MeshIncrement(r.PrimitiveType.LINES,n,o)},t.createArc=function(e,t,i,s,n,a,o){const c=h(e,t,i,o=Math.floor(Math.max(3,o)),s,n,a),l=new Int32Array(2*o);for(let e=0;e<o;++e)l[2*e]=e,l[2*e+1]=e+1;return new r.MeshIncrement(r.PrimitiveType.LINES,c,l)},t.createArrow=function(e,t,i,s,n,r){const c=e,h=o.vec3C.add(o.vec3C.scale(t,s,a.vec3.create()),c),d=o.vec3C.add(o.vec3C.scale(t,n,a.vec3.create()),h),u=o.vec3C.add(o.vec3C.scale(i,-r,a.vec3.create()),h),g=o.vec3C.add(o.vec3C.scale(i,r,a.vec3.create()),h);return l([c,h,u,g,u,d,g,d])},t.createDoubleHeadArrow=function(e,t,i,s,n,r){const c=e,h=o.vec3C.scale(t,.5*n,a.vec3.create()),d=o.vec3C.add(o.vec3C.scale(t,s,a.vec3.create()),c),u=o.vec3C.add(h,d,a.vec3.create()),g=o.vec3C.add(o.vec3C.scale(i,-r,a.vec3.create()),d),p=o.vec3C.add(o.vec3C.scale(i,r,a.vec3.create()),d),m=o.vec3C.add(o.vec3C.scale(t,n,a.vec3.create()),d),E=o.vec3C.add(g,h,a.vec3.create()),I=o.vec3C.add(p,h,a.vec3.create());return l([c,d,g,p,g,u,p,u,E,I,E,m,I,m])},t.createRing=function(e,t,i,s,n,a,o,c){c=Math.floor(Math.max(3,c));const l=(0,r.concatenateFloat32Arrays)(h(e,t,s,c,n,a,o),h(e,i,s,c,n,a,o)),d=c+1,u=new Int32Array(2*d);for(let e=0;e<d;++e)u[2*e]=e,u[2*e+1]=d+e;const g=new r.MeshIncrement(r.PrimitiveType.TRIANGLE_STRIP,l,u);return p(s,g),g},t.createTriangle=function(e,t,i,s,n,c,l){const h=o.vec3C.subtract(t,e,a.vec3.create()),d=o.vec3C.subtract(i,e,a.vec3.create()),u=o.vec3C.normalize(o.vec3C.cross(h,d,a.vec3.create())),g=new Float32Array(9),p=new Float32Array(9),m=function(e,t){for(let i=0;i<3;++i)g[3*e+i]=t[i],p[3*e+i]=u[i]};let E;if(m(0,e),m(1,t),m(2,i),n&&c&&l){E=new Float32Array(6);const e=function(e,t,i){E[2*e]=t,E[2*e+1]=i};e(0,n[0],n[1]),e(1,c[0],c[1]),e(2,l[0],l[1])}const I=new r.MeshIncrement(r.PrimitiveType.TRIANGLES,g,[0,1,2],s);return I.normals=p,I.textureCoordinates=E||null,I},t.createQuad=d,t.createQuadOutline=function(e,t,i,s,n){const r=o.vec3C.add(e,o.vec3C.scale(t,-1,a.vec3.create()),a.vec3.create());o.vec3C.add(r,i);const c=o.vec3C.add(r,o.vec3C.scale(t,2,a.vec3.create()),a.vec3.create()),h=o.vec3C.add(r,o.vec3C.scale(i,-2,a.vec3.create()),a.vec3.create()),d=o.vec3C.add(c,o.vec3C.scale(i,-2,a.vec3.create()),a.vec3.create());return l([r,h,h,d,d,c,c,r],"outlineLines",s,n)},t.createRoundedRectangle=function(e,t,i,s,n,c){const l=o.vec3C.subtract(t,e,a.vec3.create()),d=o.vec3C.subtract(i,e,a.vec3.create()),u=o.vec3C.length(l),g=o.vec3C.length(d);o.vec3C.normalize(l),o.vec3C.normalize(d);const p=o.vec3C.normalize(o.vec3C.cross(l,d,a.vec3.create())),m=o.vec3C.add(o.vec3C.scale(l,u,a.vec3.create()),o.vec3C.scale(d,g,a.vec3.create())),E=o.vec3C.add(e,m,a.vec3.create()),I=(o.vec3C.add(o.vec3C.scale(m,.5,a.vec3.create()),e),o.vec3C.add(o.vec3C.add(o.vec3C.scale(l,s,a.vec3.create()),o.vec3C.scale(d,s,a.vec3.create())),e)),T=o.vec3C.add(o.vec3C.add(o.vec3C.scale(l,-s,a.vec3.create()),o.vec3C.scale(d,s,a.vec3.create())),t),S=o.vec3C.add(o.vec3C.add(o.vec3C.scale(l,s,a.vec3.create()),o.vec3C.scale(d,-s,a.vec3.create())),i),f=o.vec3C.add(o.vec3C.add(o.vec3C.scale(l,-s,a.vec3.create()),o.vec3C.scale(d,-s,a.vec3.create())),E),C=4*(n+1),P=new Float32Array(3*C),v=new Float32Array(3*C);let D=0;const M=function(e,t){for(let i=0;i<3;++i)P[3*e+i]=t[i],v[3*e+i]=p[i]},y=function(e,t,i){const r=h(e,s,p,n,l,t,i);for(let e=0;e<r.length/3;++e)M(D++,[r[3*e],r[3*e+1],r[3*e+2]])};y(T,-Math.PI/2,0),y(f,0,Math.PI/2),y(S,Math.PI/2,Math.PI),y(I,-Math.PI,-Math.PI/2);const O=[];for(let e=1;e<C-1;++e)O.push(0),O.push(e),O.push(e+1);const _=new r.MeshIncrement(r.PrimitiveType.TRIANGLES,P,O,c);return _.normals=v,_};const u=[0,1,2,3,3,4,4,5,6,7,7,8,8,9,10,11,11,12,12,13,14,15,15,16,16,17,18,19,19,20,20,21,22,23],g=[-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1];function p(e,t){const i=t.vertexCount(),s=new Float32Array(3*i);for(let t=0;t<i;++t)for(let i=0;i<3;++i)s[3*t+i]=e[i];t.normals=s}function m(e,t){const i=[255,255,255,255];for(let t=0;t<4&&t<e.length;++t)i[t]=255*e[t];E(i,t)}function E(e,t){const i=t.vertexCount(),n=new Uint8Array(4*i);let r;if(4===e.length){for(r=0;r<i;++r)for(let t=0;t<4;++t)n[4*r+t]=e[t];t.colors=n}else s.log.warn("Tried to add a color with the wrong number of channels to a mesh increment")}function I(e,t){const i=t.vertexCount(),s=new Float32Array(i);for(let t=0;t<i;++t)s[t]=e;t.primitiveSizes=s}function T(e,t){const i=t.vertexCount(),s=new Uint8Array(r.Attributes.PRIMITIVE_STYLE.dimension*i);let n;const a=[];for(n=0;n<r.Attributes.PRIMITIVE_STYLE.dimension;++n)n<e.length?a.push((0,r.clamp)(Math.round(e[n]),0,255)):a.push(0);for(n=0;n<i;++n)for(let e=0;e<r.Attributes.PRIMITIVE_STYLE.dimension;++e)s[n*r.Attributes.PRIMITIVE_STYLE.dimension+e]=a[e];t.primitiveStyles=s}function S(e,t,i,s){const n=new r.MeshIncrement(r.PrimitiveType.TRIANGLE_STRIP,e,t);return i&&(n.normals=i),s&&m(s,n),n}function f(e){return e.toFixed(10).slice(0,12)}function C(e){return P(e[0],e[1],e[2])}function P(e,t,i){return f(e)+"_"+f(t)+"_"+f(i)}t.createBox=function(e,t){const i=new Float32Array(72);let s=0;const n=new Float32Array(3),a=function(r,a){n[r]=a?t[r]:e[r];const o=0===r?2:1===r?0:1,c=0===r?1:1===r?2:0;for(let r=0;r<2;++r)for(let l=0;l<2;++l)n[o]=a!==(0===l)?e[o]:t[o],n[c]=0===r?e[c]:t[c],i.set(n,4*s*3+3*(2*r+l));++s};a(0,!1),a(0,!0),a(1,!1),a(1,!0),a(2,!1),a(2,!0);const o=new r.MeshIncrement(r.PrimitiveType.TRIANGLE_STRIP,i,u);return o.normals=g,o},t.createWireBox=function(e,t){const i=[],s=[e,t];for(let e=0;e<2;e++)for(let t=0;t<2;t++)for(let n=0;n<2;n++)i.push(a.vec3.fromValues(s[e][0],s[t][1],s[n][2]));const n=[];for(let e=0;e<i.length;e++)for(let t=e+1;t<i.length;t++){const s=i[e],r=i[t],a=s[0]===r[0],o=s[1]===r[1],c=s[2]===r[2];(a&&o||a&&c||o&&c)&&(n.push(s),n.push(r))}return l(n)},t.addQuadToMesh=function(e,t,i,s,n,r,a){e.addIncrement(d(t,i,s,n,r,a))},t.addNormalToIncrement=p,t.addTextureCoordinateToIncrement=function(e,t){const i=t.vertexCount(),s=new Float32Array(2*i);for(let t=0;t<i;++t)for(let i=0;i<2;++i)s[2*t+i]=e[i];t.textureCoordinates=s},t.addColorToIncrement=m,t.addByteColorToIncrement=E,t.addPackedIntegerToIncrement=function(e,t){E((0,r.convertIntToUcharArray)(e),t)},t.addSizeToIncrement=I,t.addStyleToIncrement=T,t.createTriangles=function(e,t,i,s){const n=new r.MeshIncrement(r.PrimitiveType.TRIANGLES,e,t,i);return s&&m(s,n),n},t.createTriangleStrip=S,t.numberToFixedPointString=f,t.hashPoint=C,t.hashXYZ=P;let v={},D=1;function M(e,t){let i=a.vec3.dot(e,t);i<0&&(i=-i,t=a.vec3.fromValues(-t[0],-t[1],-t[2]));const s=C(t)+"_"+f(i);return v[s]||(v[s]=D,D=Math.max((D+1)%24,1)),v[s]}function y(e){const t=(0,r.convertIntToUcharArray)(1<<e);return t[1]<<8|t[2]<<16|t[3]<<24}t.getPlaneEquationId=M,t.getBitForPlaneEquation=function(e,t){return y(M(e,t))},t.getBitForPlaneEquationId=y,t.getPlaneEquationColor=function(e){const t=y(e),i=(0,r.convertIntToUcharArray)(t);return(0,r.convertRGBA255ToRGBA)(i)},t.clearPlaneEquationIds=function(){v={},D=1},t.setIncrementOpacity=function(e,t){const i=e.vertexCount(),s=new Uint8Array(4*i);let n,r;for(n=0;n<i;++n)for(let i=0;i<4;++i)r=4*n+i,e.colors?s[r]=e.colors[r]:s[r]=255,(r+1)%4==0&&(s[r]=255*t);return e.colors=s,e},t.addTriangleNormals=function(e){if(e.primitiveType!==r.PrimitiveType.TRIANGLES)return;const t=new Float32Array(3*e.indices.length),i=new Int32Array(e.indices.length),s=new Float32Array(3*e.indices.length),n=a.vec3.create(),o=a.vec3.create();for(let r=0;r<i.length;r+=3){i[r]=r;const c=e.getPoint(e.indices[r],t.subarray(3*r));i[r+1]=r+1;const l=e.getPoint(e.indices[r+1],t.subarray(3*(r+1)));i[r+2]=r+2;const h=e.getPoint(e.indices[r+2],t.subarray(3*(r+2))),d=a.vec3.cross(s.subarray(3*r),a.vec3.normalize(n,a.vec3.subtract(n,l,c)),a.vec3.normalize(o,a.vec3.subtract(o,h,c)));a.vec3.copy(s.subarray(3*(r+1)),d),a.vec3.copy(s.subarray(3*(r+2)),d)}e.points=t,e.indices=i,e.normals=s}},370126:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DoubleClickHandler=t.MouseEvents=void 0;const s=i(545348),n=i(375680),r=i(114924);t.MouseEvents={mouseup:"mouseup"};t.DoubleClickHandler=class{constructor(e,t){this.element=e,this.firstMiddleMouseButtonUp=!1,this.timeOfFirstMiddleMouseUp=-1,this.elementDoubleClickHandler=t,this.mouseUpHandler=e=>this.MouseUpHandler(e),this.setupEventHandlers()}setupEventHandlers(){this.element&&this.element.on(t.MouseEvents.mouseup,this.mouseUpHandler)}off(){this.element&&this.element.off(t.MouseEvents.mouseup,this.mouseUpHandler)}resetFirstMiddleButtonUpState(){this.firstMiddleMouseButtonUp=!1,this.timeOfFirstMiddleMouseUp=-1}setFirstMiddleButtonUpState(){this.firstMiddleMouseButtonUp=!0,this.timeOfFirstMiddleMouseUp=(0,r.getTimeInMilliseconds)()}MouseUpHandler(e){if(e.which!==n.MouseButton.MIDDLE)return void this.resetFirstMiddleButtonUpState();if(!this.firstMiddleMouseButtonUp)return void this.setFirstMiddleButtonUpState();if((0,r.getTimeElapsed)(this.timeOfFirstMiddleMouseUp)<=s.default.getManager().getNumber("MIDDLE_MOUSE_BUTTON_DOUBLE_CLICK_TIMEOUT"))return this.resetFirstMiddleButtonUpState(),void this.elementDoubleClickHandler(e);this.setFirstMiddleButtonUpState()}}},936870:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.isFeatureIdCompound=t.filterEntitiesWithData=t.getEntityPrimitiveType=t.createMeshIncrementForEntityData=t.getColorFromDebugEntityColor=t.getMeshIncrementForEntityData=t.MODEL_MESH_MANAGER_SETTINGS=t.PART_STUDIO_OCCURRENCE_ID=t.OCCURRENCE_SOURCE=t.ASSEMBLY_PREFIX=t.PART_STUDIO_PREFIX=t.TEMPORARY_SKETCH_COMPONENT_NODE_ID=t.ROOT_ELEMENT_PREVIEW_NODE_ID=t.ROOT_ELEMENT_NODE_ID=void 0;const s=i(114924),n=i(545348),r=i(606544);function a(e,t){let i="";switch(e){case r.GBTDebugEntityColor.RED:i="CPP_RED";break;case r.GBTDebugEntityColor.GREEN:i="CPP_GREEN";break;case r.GBTDebugEntityColor.BLUE:i="CPP_BLUE";break;case r.GBTDebugEntityColor.CYAN:i="CPP_CYAN";break;case r.GBTDebugEntityColor.YELLOW:i="CPP_YELLOW";break;case r.GBTDebugEntityColor.MAGENTA:i="CPP_MAGENTA";break;case r.GBTDebugEntityColor.BLACK:i="CPP_BLACK";break;case r.GBTDebugEntityColor.TRANSLUCENT_PURPLE:i="CPP_TRANSLUCENT_PURPLE";break;case r.GBTDebugEntityColor.FEATURE_ERROR:case r.GBTDebugEntityColor.FEATURE_DEBUG:i="FEATURE_ERROR_GRAPHIC_COLOR";break;case r.GBTDebugEntityColor.TRANSLUCENT_GREEN:i="CPP_TRANSLUCENT_GREEN";break;case r.GBTDebugEntityColor.TRANSLUCENT_BLUE:i="CPP_TRANSLUCENT_BLUE";break;case r.GBTDebugEntityColor.TRANSLUCENT_CYAN:i="CPP_TRANSLUCENT_CYAN";break;case r.GBTDebugEntityColor.TRANSLUCENT_YELLOW:i="CPP_TRANSLUCENT_YELLOW";break;case r.GBTDebugEntityColor.TRANSLUCENT_BLACK:i="CPP_TRANSLUCENT_BLACK";break;case r.GBTDebugEntityColor.TRANSLUCENT_ORANGE:i="CPP_TRANSLUCENT_ORANGE";break;default:i="CPP_RED"}const a=n.default.getManager().getColor(i);return e!==r.GBTDebugEntityColor.FEATURE_ERROR||t!==s.PrimitiveType.POINTS&&t!==s.PrimitiveType.LINES?a:[a[0],a[1],a[2],1]}t.ROOT_ELEMENT_NODE_ID="element.",t.ROOT_ELEMENT_PREVIEW_NODE_ID="elementpreview.",t.TEMPORARY_SKETCH_COMPONENT_NODE_ID="temporary_sketch_component.",t.PART_STUDIO_PREFIX="partStudio.",t.ASSEMBLY_PREFIX="assembly.",t.OCCURRENCE_SOURCE="occurrence",t.PART_STUDIO_OCCURRENCE_ID="",t.MODEL_MESH_MANAGER_SETTINGS={bufferAllocationPolicy:s.BufferAllocationPolicy.MAXIMUM},t.getMeshIncrementForEntityData=function(e,t,i){const s=e.getMeshIncrement(),n=s?s.clone():c(e);return n&&(t&&(n.id=t),n.pickId=i),n},t.getColorFromDebugEntityColor=a;const o=function(e){let t=null;if(e&&e.length>1){const i=new Float32Array(e.buffer,0,6),s=new Uint16Array(e.buffer,24);t=new Float32Array(s.length);const n=(i[3]-i[0])/65535,r=(i[4]-i[1])/65535,a=(i[5]-i[2])/65535,o=i[0],c=i[1],l=i[2];for(let e=0;e<s.length;e+=3)t[e+0]=o+n*s[e+0],t[e+1]=c+r*s[e+1],t[e+2]=l+a*s[e+2]}return t};function c(e){let t=null;switch(e.getMessageName()){case"display.GBTEntityFace":const i=e;if(i.decompress(),!i.points||!i.indices||!i.normals)return null;t=new s.MeshIncrement(s.PrimitiveType.TRIANGLE_STRIP,i.points,i.indices),t.normals=i.normals;break;case"display.GBTEntityEdge":const l=e;if((!l.points||l.points.length<6)&&(!l.compressedPoints||l.compressedPoints.length<6))return null;l.compressedPoints&&l.compressedPoints.length>1&&(l.points=o(l.compressedPoints),l.compressedPoints=new Uint8Array(0));const h=Math.floor(l.points.length/3)-1,d=new Int32Array(2*h);for(let e=0;e<h;++e)d[2*e]=e,d[2*e+1]=e+1;t=new s.MeshIncrement(s.PrimitiveType.LINES,l.points,d,void 0,!0);break;case"display.GBTEntityPoint":case"display.GBTEntityDegenerateEdge":const u=e;if(!u.point)return null;t=new s.MeshIncrement(s.PrimitiveType.POINTS,u.point,[0],void 0,!0);break;case"display.GBTFeatureEntity":case"display.GBTConstructionPlaneEntity":case"display.GBTBodyEntity":case"display.GBTPointEntity":case"display.GBTOriginEntity":case"display.GBTMateConnectorEntity":case"display.GBTSketchEntity":const g=e;t=g.getGeometry()?c(g.getGeometry()):null;break;case"display.GBTDebugGeometry":const p=e;if(!p.tessellation)return null;if(t=c(p.tessellation),p.style!==r.GBTDebugEntityStyle.ERROR){const e=a(p.color,t.primitiveType);(0,s.addColorToIncrement)(e,t),t.primitiveType===s.PrimitiveType.POINTS&&(p.style===r.GBTDebugEntityStyle.STAR?((0,s.addStyleToIncrement)(n.default.getManager().getPointFont("STAR_POINT"),t),(0,s.addSizeToIncrement)(n.default.getManager().getNumber("STAR_POINT_SIZE"),t)):(0,s.addSizeToIncrement)(n.default.getManager().getNumber("DEBUG_POINT_SIZE"),t))}}return t}t.createMeshIncrementForEntityData=c,t.getEntityPrimitiveType=function(e){switch(e.getEntityType()){case r.GBTEntityType.VERTEX:return s.PrimitiveType.POINTS;case r.GBTEntityType.EDGE:return s.PrimitiveType.LINES;case r.GBTEntityType.FACE:return s.PrimitiveType.TRIANGLE_STRIP;case r.GBTEntityType.DEGENERATE_EDGE:return s.PrimitiveType.POINTS}return s.PrimitiveType.PRIMITIVE_UNKNOWN},t.filterEntitiesWithData=function(e,t,i){if(!e)return[];let s;return i?(s=[],e.each((function(e,n){return i(t[n])&&s.push(n),!1}))):s=e.getKeys(),s},t.isFeatureIdCompound=function(e){return!!e&&-1!==e.indexOf(".")}},853747:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ModelViewManagers=t.ModelViewManager=void 0;const s=i(142885),n=i(545348),r=i(719347),a=i(681459),o=i(997687),c=i(912057),l=i(225072),h=i(193786),d=i(606544),u=i(427134),g=i(132549),p=i(736234),m=i(268154),E=i(772687),I=i(550122),T=i(114924),S=i(649962),f=i(264292),C=i(613199),P=n.default.getManager();class v extends s.BackboneEventsBaseClass{constructor(e,t,i){super(),this.usage=e,this.occurrenceDataManager=t,this.viewer=i,this.partStudios={},this.sharedBaseMeshManager=null,this.i18next=i18n,this.assemblies={},this.displayedElementMicroversionIdAndConfiguration=null,this.displayedElementType=null,this.displayedPartStudio=null,this.partStudioPreservedForPreview=null,this.pendingPartStudioComputedData=null,this.selectionsToClearOnReset={},this.secondaryOccurrenceHighlights={},this.secondaryEntityHighlights={},this.secondaryEntityHighlightSelectionRepeats={},this.addDerivedEntityHighlights=!0,this.selectionListsHandled=[],this.bodyLoadTasks=null,this.meshPointController=null,this.queuedAssemblyDisplayData=[],this.queuedAssemblyTimeout=null,this.notCollapsedAssemblyMessageCount=0,this.selectedSheetmetalModelId=null,this.lastFitSheetMetalModelId=null,this.resyncFunction=null,this.resyncNeeded=!1,this.resyncReason=null,this.resyncPromise=null,this.lastPartStudioProcessed="",this.lastPartStudioMicroversionIdAndConfigurationIntervalProcessed=null,this.temporarySketchComponents={},this.partStudioVisibilityUpdated=!1,this.partDisplayDataPendingVisibilityUpdate=null,this.subFeaturesShownByParameters={},(0,T.viewerCheck)(i),this.meshManager=new T.MeshManager(this.viewer,T.MODEL_MESH_MANAGER_SETTINGS),this.displayedElementId="",this.partsAtTheBeginningOfEdit=new E.StringSet,this.sheetModelIdsAtTheBeginningOfEdit=new E.StringSet,this.handleAllSelectionListHighlights(),this.collapsibleDisplayDataTimer=new T.TimingDetails,this.bodyNode=new T.Node(T.BodyComponentId,new T.NodeProperties,e),this.sketchNode=new T.Node(T.SketchComponentId,new T.NodeProperties,e),this.elementPreviewBodyNode=new T.Node(T.BodyComponentId,new T.NodeProperties,e),this.isBase()&&(this.listenTo(this.viewer.getEventDispatcher(),T.BODIES_LOADED,this.refreshHighlight),i.getIsPrimaryViewer()&&(this.simulationManager=new T.SimulationManager(this),this.generativeDesignManager=new T.GenerativeDesignManager(this),this.thicknessAnalysisManager=new T.ThicknessAnalysisManager(this))),this.alternateEntityMapping=new u.AlternateEntityMapping,this.latestDisplayDataUsageSubscription=(0,T.getEditState)().latestDisplayDataUsageChangedObservable.subscribe((()=>this.clearAndRefreshHighlights())),this.meshPointController=new T.MeshPointController(this.viewer)}clearAndRefreshHighlights(){this.clearHighlights(),this.refreshHighlight()}getViewer(){return this.viewer}onViewerShown(){this.viewer.getIsForFlattenedDisplay()&&this.fitToSelectedSheetMetalModel()}setAlternateEntityMapping(e){this.alternateEntityMapping=e}setResyncFunction(e){this.resyncFunction=e}getResyncPromise(){return this.resyncPromise?this.resyncPromise:null}getSimulationManager(){return this.simulationManager}getGenerativeDesignManager(){return this.generativeDesignManager}getThicknessAnalysisManager(){return this.thicknessAnalysisManager}purgeUnusedPartStudios(e,t){const i=[];for(const t of Object.keys(this.partStudios))e.contains(t)||i.push(this.partStudios[t]);i.sort((function(e,t){return e.getEstimatedMemoryUsageOfBodies()>t.getEstimatedMemoryUsageOfBodies()?-1:e.getEstimatedMemoryUsageOfBodies()<t.getEstimatedMemoryUsageOfBodies()?1:0}));const s=[];for(;(t||this.isEstimatedBodyMemoryUsageAboveThreshold())&&i.length>0;){const e=i.shift();if(t||!e.getIsCachedPartStudioPendingUse()){const t=e.getFullElementId();e.onDeletion(),delete this.partStudios[t],s.push(t),this.displayedElementId&&this.setResyncNeeded(d.GBTUiSyncClientReason.CLIENT_UNLOADED_DISPLAY_DATA)}}t&&Object.keys(this.partStudios).length>0&&c.log.error("Failed to purge all part studios. Remaining part studios: "+Object.keys(this.partStudios)+", deleted part studios: "+s),s.length>0&&(this.meshManager.removeEmptyMeshes(),c.log.info("Purged unused, in-memory part studios: "+s))}getInUsePartStudioIds(){const e=new E.StringSet;if(this.displayingPartStudio()){this.getDisplayedPartStudio()&&e.add(this.getDisplayedPartStudio().getFullElementId());const t=this.getDisplayedInContextAssembly();t&&t.getUsedPartStudioIds(e)}else if(this.displayingAssembly()){const t=this.assemblies[this.displayedElementId];t&&t.getUsedPartStudioIds(e)}return e}getEstimatedMemoryUsageOfBodies(){const e=new r.Timer("ModelViewManager.prototype.getEstimatedMemoryUsageOfBodies");let t=0;return Object.values(this.partStudios).forEach((function(e){t+=e.getEstimatedMemoryUsageOfBodies()}),this),e.report(),t}getBodyDisplayMemoryLimit(){return 1024*(o.btInjector.CapabilitiesService.checkDecreasedBodyDisplayLimitCurrentlyEnabled()?P.getNumber("DECREASED_BODY_DISPLAY_MEMORY_LIMIT_MB"):(0,m.isBrowser64BitFirefox)()?P.getNumber("BODY_DISPLAY_MEMORY_LIMIT_FIREFOX64_MB"):P.getNumber("BODY_DISPLAY_MEMORY_LIMIT_MB"))*1024}getBodyRefinementMemoryLimit(){return this.getBodyDisplayMemoryLimit()}isEstimatedBodyMemoryUsageAboveThreshold(){return this.getEstimatedMemoryUsageOfBodies()>this.getBodyDisplayMemoryLimit()}checkBodyMemoryUsage(e){if(!this.isBase()||this.viewer.getIsForFlattenedDisplay()||this.bodyLoadTasks.hasPendingUnloads()||e.fromDisplayCache)return;const t=this.getEstimatedMemoryUsageOfBodies(),i=this.getBodyDisplayMemoryLimit();if(t<=i)return;this.purgeUnusedPartStudios(this.getInUsePartStudioIds());const s=this.getEstimatedMemoryUsageOfBodies();if(s<=i)return;const n=new r.Timer("ModelViewManager.prototype.checkBodyMemoryUsage",{logResult:(0,T.isRetrievalDebuggingEnabled)()});(0,T.isRetrievalDebuggingEnabled)()&&c.log.info("bodyMemoryUse before unload: "+(0,T.byteToMbString)(s));const a=this.viewer.getBodyManager().unloadBodies(s-i,this);if(a){const e=new r.Timer("Unloading body display data",{logResult:(0,T.isRetrievalDebuggingEnabled)()});a.then((t=>{if(this.setResyncNeeded(d.GBTUiSyncClientReason.CLIENT_UNLOADED_DISPLAY_DATA),this.resyncAsNeeded(),e.report(),(0,T.isRetrievalDebuggingEnabled)()){const e=this.getEstimatedMemoryUsageOfBodies();c.log.info("Unloaded "+t.bodiesProcessedSinceStart+" bodies after "+t.iterationsSinceStart+" frames. bodyMemoryUse after unload: "+(0,T.byteToMbString)(e))}}))}n.report()}setResyncNeeded(e){this.resyncNeeded=!0,this.resyncReason=void 0!==e?e:null}resyncAsNeeded(){if(this.resyncFunction&&this.resyncNeeded){const e=this.resyncFunction(this.resyncReason);return this.resyncNeeded=!1,this.resyncReason=null,e}return l()}integrityCheck(){if(this.displayedElementId in this.assemblies&&this.displayedElementType!==d.GBTElementType.ASSEMBLY)c.log.warn("Found an assembly with the displayed element id, but the element type is incorrect");else{const e=this.displayedElementId;let t=!1;if(e)for(const i in this.partStudios)if(0===i.indexOf(e)){t=!0;break}t&&this.displayedElementType!==d.GBTElementType.PARTSTUDIO&&c.log.warn("Found a part studio with the displayed element id, but the element type is incorrect")}}getSharedBodyNode(){return this.bodyNode}getSharedSketchNode(){return this.sketchNode}getElementPreviewBodyNode(){return this.elementPreviewBodyNode}clearSilhouetteRequests(){this.viewer.getSilhouetteTask().clearPendingRequestsForUsage(this.usage)}instantiateSharedNodes(e){e.addChild(this.bodyNode),e.addChild(this.sketchNode)}isBase(){return this.usage===T.BTGraphicsUsage.BASE}getDisplayedFullElementId(){return this.displayedElementMicroversionIdAndConfiguration?d.BTFullElementId.getFullElementIdString(this.displayedElementId,this.displayedElementMicroversionIdAndConfiguration.getKey()):this.displayedElementId}setBodyLoadTasks(e){this.bodyLoadTasks=e}getHideableFeatureIdsForDisplayedPartStudio(e){if(e===this.getDisplayedElementId()){const e=this.partStudios[this.getDisplayedFullElementId()];if(e)return e.getHideableFeatureIds()}return[]}onDeletion(){Object.values(this.assemblies).forEach((function(e){e.onDeletion()})),Object.values(this.partStudios).forEach((function(e){e.onDeletion(!0)}),this),this.meshManager.destroy(),this.sharedBaseMeshManager&&(this.sharedBaseMeshManager.destroy(),this.sharedBaseMeshManager=null),this.stopListening(),this.latestDisplayDataUsageSubscription.unsubscribe(),this.meshPointController&&this.meshPointController.destroy(),this.clearSilhouetteRequests(),(0,p.isNumber)(this.queuedAssemblyTimeout)&&(window.clearTimeout(this.queuedAssemblyTimeout),this.queuedAssemblyTimeout=null)}getSceneGraph(){return this.usage===T.BTGraphicsUsage.PREVIEW?this.viewer.getSceneGraphs().getPreviewSceneGraph():this.viewer.getSceneGraphs().getMainSceneGraph()}getMeshManager(){return this.meshManager}getSharedBaseMeshManager(){return this.sharedBaseMeshManager}displayedMicroversionAndConfigMatchesDisplayData(e){return!!this.displayedElementMicroversionIdAndConfiguration&&e.microversionIdAndConfigurationInterval.to.equals(this.displayedElementMicroversionIdAndConfiguration)}processRootAssemblyDisplayData(e,t){if(!t&&(e.isCollapsible||this.viewer.getFrameTimer().userIsInteracting()&&this.displayedMicroversionAndConfigMatchesDisplayData(e))){const t=this.queuedAssemblyDisplayData.length>0?this.queuedAssemblyDisplayData[this.queuedAssemblyDisplayData.length-1]:null;t&&t.isCollapsible&&e.isCollapsible?(++t.collapseCount,t.mergeCollapsibleData(e)):this.queuedAssemblyDisplayData.push(e),this.startAssemblyDisplayDataQueueTimeout()}else this.emptyAssemblyDisplayDataQueue(),this.processRootAssemblyDisplayDataInternal(e,t),this.collapsibleDisplayDataTimer.reset()}startAssemblyDisplayDataQueueTimeout(){if((0,p.isNumber)(this.queuedAssemblyTimeout))return;const e=this.viewer.getFrameTimer().getTimingDetails(S.FrameType.INTERACTIVE).averageTime,t=this.collapsibleDisplayDataTimer.averageTime,i=Math.max((e+t)*P.getNumber("ASSEMBLY_DRAG_COLLAPSE_WAIT_RATIO"),0);this.queuedAssemblyTimeout=window.setTimeout((()=>this.processAssemblyDisplayDataQueue()),i)}emptyAssemblyDisplayDataQueue(){(0,p.isNumber)(this.queuedAssemblyTimeout)&&(window.clearTimeout(this.queuedAssemblyTimeout),this.queuedAssemblyTimeout=null);for(let e=0;e<this.queuedAssemblyDisplayData.length;++e){const t=this.queuedAssemblyDisplayData[e];t.elementId!==this.displayedElementId||t.isCollapsible||this.processRootAssemblyDisplayDataInternal(t)}this.queuedAssemblyDisplayData=[]}processAssemblyDisplayDataQueue(){this.queuedAssemblyTimeout=null;let e=!1;for(let t=0;t<this.queuedAssemblyDisplayData.length&&!e;++t)e=e||this.queuedAssemblyDisplayData[t].elementId===this.displayedElementId&&this.queuedAssemblyDisplayData[t].isCollapsible;if(!e&&this.viewer.getFrameTimer().userIsInteracting())return void this.startAssemblyDisplayDataQueueTimeout();const t=this.queuedAssemblyDisplayData.shift();if(t&&t.elementId===this.displayedElementId){t.isCollapsible&&P.getNumber("LOG_ASSEMBLY_DRAG_COLLAPSE_INFO")&&(t.collapseCount>1?(c.log.debug("Did not collapse "+this.notCollapsedAssemblyMessageCount+" messages"),c.log.debug("Collapsed "+t.collapseCount+" display data messages for "+t.elementId),this.notCollapsedAssemblyMessageCount=0):++this.notCollapsedAssemblyMessageCount);const e=(0,T.getTimeInMilliseconds)();this.processRootAssemblyDisplayDataInternal(t),t.isCollapsible&&this.collapsibleDisplayDataTimer.addTiming((0,T.getTimeElapsed)(e))}this.queuedAssemblyDisplayData.length>0&&this.startAssemblyDisplayDataQueueTimeout()}resetAllIncontextGraphicsForPartstudio(e){if(!this.assemblies)return;let t="";const i=Object.keys(this.assemblies);for(let s=0;s<i.length;s++){const n=i[s];if((0,T.getPartstudioElementIdFromContextId)(n)===e){t=n;const e=this.assemblies[t];if(!e)continue;e.reset()}}}processPartStudioDisplayDataList(e,t,i){let s=i;for(const i of e){const e=i;if(!e)return;const n=!0,r=this.getAndUpdatePartStudioForMessage(e,t,n),a=e.microversionIdAndConfigurationInterval.to.equals(e.microversionIdAndConfigurationInterval.from);r&&r.processDisplayData(e,!1,t,a),s=s&&a}return s}processRootAssemblyDisplayDataInternal(e,t){const i=new r.Timer("processRootAssemblyDisplayDataInternal",{setTraceId:!0}),s=e.elementId,n=!!t,a=this.displayedMicroversionAndConfigMatchesDisplayData(e);s!==this.displayedElementId||e.incremental||e.fromDisplayCache||this.clearSilhouetteRequests();let o=this.assemblies[s];o||(o=new T.Assembly(s,this,this.viewer),this.assemblies[s]=o,this.integrityCheck()),e.isForInContext&&this.showAssembly(s,e.isForInContext),this.clearHighlights(),o.processOccurrenceDeletions(e,t);const l=this.processPartStudioDisplayDataList(e.partStudioDisplayData,n,a);this.resyncNeeded&&this.resyncFunction?l?(this.resyncNeeded=!1,c.log.warn("Skipped resync when processing tessellation update for assembly "+this.displayedElementId+" "+this.displayedElementMicroversionIdAndConfiguration)):this.resyncPromise=this.resyncAsNeeded().then((()=>{this.processRootAssemblyDisplayDataHelper(s,o,e,l,i),this.resyncPromise=null})):this.processRootAssemblyDisplayDataHelper(s,o,e,l,i)}processRootAssemblyDisplayDataHelper(e,t,i,s,n){if(i.isForInContext&&this.showAssembly(e,i.isForInContext),s&&(this.viewer.getBodyManager().cleanupPendingRefinementRequests(),(0,T.isRetrievalDebuggingEnabled)())){const e=[];for(let t=0;t<i.partStudioDisplayData.length;++t){const s=i.partStudioDisplayData[t],n=d.BTFullElementId.getFullElementIdString(s.elementId,s.microversionIdAndConfigurationInterval.to.getKey());if(this.getPartStudio(n)){for(const t in s.deterministicPartIdToData)if(s.deterministicPartIdToData.hasOwnProperty(t)){const i=s.deterministicPartIdToData[t];e.push(t+"-"+i.tessellationSettings)}}else c.log.warn(`Cannot find part studio: ${n} to apply display data refinement update.`)}c.log.info("Processing update for bodies:\n"+e);const t=this.getEstimatedMemoryUsageOfBodies();c.log.info("bodyMemoryUse prior to update: "+(0,T.byteToMbString)(t))}if(t.processDisplayData(i),e===this.displayedElementId){const e=!!this.displayedElementMicroversionIdAndConfiguration;this.displayedElementMicroversionIdAndConfiguration=i.microversionIdAndConfigurationInterval.to,this.displayAssembly(this.displayedElementId,e)}if(this.updateOrVerifySelections(null,e),this.refreshHighlight(),this.viewer.getEventDispatcher().trigger(T.ASSEMBLY_DATA_PROCESSED,i,s),this.viewer.requestDraw(),t.microversionIdAndConfiguration=i.microversionIdAndConfigurationInterval.to,!s&&this.simulationManager&&this.simulationManager.onAssemblyChanged(),!s){const e=this.viewer.getPendingBodiesToLoadPromise();e?e.then((()=>{this.viewer.getBodyManager().initiateAutomaticRetrieval()})):this.viewer.getBodyManager().initiateAutomaticRetrieval()}this.checkBodyMemoryUsage(i),this.resyncAsNeeded(),n.report()}getOrCreatePartStudio(e,t){const i=t?d.BTFullElementId.getFullElementIdString(e,t.getKey()):e;let s=this.partStudios[i];if(!s){if(!this.bodyLoadTasks)throw"Loaders should be constructed prior to handling display data";s=new T.PartStudio(e,t||null,this,this.bodyLoadTasks,this.usage,this.viewer),this.partStudios[i]=s,this.integrityCheck()}return s}getMicroversionIdsString(e){const t=[];for(const i in this.partStudios){const s=this.partStudios[i];s.getElementId()===e&&t.push(s.getMicroversionIdAndConfiguration())}return"["+t.join(", ")+"]"}getAndUpdatePartStudioForMessage(e,t,i,s){let n;if(!this.isBase())return n=this.partStudios[e.elementId]||this.getOrCreatePartStudio(e.elementId),n.microversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to,n;const r=!(t||i||e.elementId!==this.displayedElementId||e.fromDisplayCache||s);let a=!1;this.displayedElementMicroversionIdAndConfiguration&&!this.displayedElementIsPublicationItem||!r||(this.displayedElementMicroversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to,a=!0);const o=e.buildFullElementId(!0).toString(),l=e.buildFullElementId(!1).toString();if(this.isBase()&&this.viewer.getModelViewManagers().getPreviewManager()&&!e.incremental&&!e.keepFromMicroversion&&o in this.partStudios&&(c.log.info("Received non-incremental base display data during preview/compare. Cloning base reference"),n=this.partStudios[o],this.partStudioPreservedForPreview=n,this.partStudios[o]=n.clone(e.incremental)),o!==l&&o in this.partStudios)l in this.partStudios&&(c.log.info("Deleting existing local copy of : "+l),this.partStudios[l].onDeletion(),delete this.partStudios[l]),n=this.partStudios[o],e.keepFromMicroversion?n=n.clone(e.incremental):delete this.partStudios[o],this.partStudios[l]=n,n.microversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to,this.getDisplayedFullElementId()===o&&r&&(this.displayedElementMicroversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to);else{if(o!==l&&e.microversionIdAndConfigurationInterval.from&&e.microversionIdAndConfigurationInterval.from.microversion.theId)return this.partStudios[l]?(c.log.trace("Skipped application of increment for part studio "+e.elementId+" because it was incrementing to a microversion that was already present "+e.microversionIdAndConfigurationInterval.to),r&&(this.displayedElementMicroversionIdAndConfiguration=e.microversionIdAndConfigurationInterval.to),this.partStudios[l].updateExternalState(t,i)):(c.log.warn("Skipped application of increment for part studio "+e.elementId+" due to missing from data.  Interval with missing data: "+e.microversionIdAndConfigurationInterval+". Existing microversions for element: "+this.getMicroversionIdsString(e.elementId)),this.setResyncNeeded(),a&&(this.displayedElementMicroversionIdAndConfiguration=null)),null;if(e.incremental&&!(l in this.partStudios))return c.log.warn("Skipped creation of part studio "+e.elementId+" because the destination microversion is missing.  MV interval: "+e.microversionIdAndConfigurationInterval+". From display cache: "+e.fromDisplayCache+". Existing microversions for element: "+this.getMicroversionIdsString(e.elementId)),this.setResyncNeeded(),a&&(this.displayedElementMicroversionIdAndConfiguration=null),null;n=this.getOrCreatePartStudio(e.elementId,e.microversionIdAndConfigurationInterval.to)}return n.updateExternalState(t,i),n}processManagedData(e){var t,i;(null===(t=null==e?void 0:e.computedData)||void 0===t?void 0:t.computedData)&&(this.displayedPartStudio&&(null===(i=this.displayedPartStudio.microversionIdAndConfiguration)||void 0===i?void 0:i.equals(e.microversionIdAndConfigurationInterval.to))?(this.displayedPartStudio.addManagedIdMappings(e.computedData.computedData),this.pendingPartStudioComputedData=null):this.pendingPartStudioComputedData=e)}processReceivedInsertableDisplayData(e){const t=this.partStudios[this.getDisplayedFullElementId()];t&&t.processReceivedInsertableData(e)}processPartStudioDisplayData(e,t){var i,s;const n=!!this.displayedElementMicroversionIdAndConfiguration;this.lastPartStudioProcessed=e.elementId,this.lastPartStudioMicroversionIdAndConfigurationIntervalProcessed=e.microversionIdAndConfigurationInterval;const r=this.displayedMicroversionAndConfigMatchesDisplayData(e);r?this.viewer.getBodyManager().cleanupPendingRefinementRequests():this.viewer.getBodyManager().clearPreviewOccurrences(),this.isBase()&&this.hideInactiveContextAssemblies(e);const a=this.getAndUpdatePartStudioForMessage(e,e.isExternal);if(e.incremental)for(const t in e.deterministicPartIdToData)if(!e.deterministicPartIdToData[t].isACopyForTessellationSettings){const i=(0,T.getPartThumbnailKey)(e.elementId,t,70,40);(0,T.removeThumbnailForKey)(i),(0,T.setPartThumbnailNeedsToBeRerendered)(i)}const o=this.isBase()?e.buildFullElementId().toString()===this.getDisplayedFullElementId():this.displayedElementId===e.elementId&&!e.fromDisplayCache;if(o&&(this.displayPartStudio(this.getDisplayedFullElementId()),e.incremental||(this.partStudioVisibilityUpdated=!1)),a&&!e.isNoop){const n=!1,c=this.viewer.getModelViewManagers().getManager();let l;if(e.usage===d.GBTDisplayDataUsage.PREVIEW_AFTER){l=new E.StringSet;const t=c.partsAtTheBeginningOfEdit,i=c.sheetModelIdsAtTheBeginningOfEdit;e.partDisplayData.forEach((s=>{const n=e.deterministicPartIdToData[s.id];let r=null;if(n)r=n.sheetMetalModelId;else{const e=this.viewer.getModelViewManagers().getPreviewManager().retrieveBodyMetaData(null,s.id);r=e?e.sheetMetalModelId:null}t.contains(s.id)||i.contains(r)||l.add(s.id)}))}if(a.processDisplayData(e,o,n,r,l),null===(i=this.viewer.getCurvatureAnalysisManager())||void 0===i||i.onPartStudioDisplayDataChanged(e,e.buildFullElementId().toString()),null===(s=this.thicknessAnalysisManager)||void 0===s||s.onPartStudioDisplayDataChanged(e),this.processPartVisibility(e.partDisplayData),e.usage===d.GBTDisplayDataUsage.PREVIEW_BEFORE){this.partsAtTheBeginningOfEdit=new E.StringSet,this.sheetModelIdsAtTheBeginningOfEdit=new E.StringSet,this.newParts=new E.StringSet;const t=this.displayedPartStudio,i=this;e.partDisplayData.forEach((function(e){i.partsAtTheBeginningOfEdit.add(e.id);const s=t.retrieveBodyMetaData(e.id);s&&s.sheetMetalModelId&&i.sheetModelIdsAtTheBeginningOfEdit.add(s.sheetMetalModelId)}))}else e.usage===d.GBTDisplayDataUsage.PREVIEW_AFTER&&(c.newParts=l);this.updateOrVerifySelections(t,e.elementId),this.viewer.getEventDispatcher().trigger(T.PART_STUDIO_DATA_AND_SELECTION_REMAP_PROCESSED,e.elementId),this.refreshHighlight()}else a&&(this.partDisplayDataPendingVisibilityUpdate&&this.processPartVisibility(this.partDisplayDataPendingVisibilityUpdate),a.processInContextData(e,o));return this.resyncNeeded&&(r?(this.resyncNeeded=!1,c.log.warn("Skipped resync when processing tessellation update for part studio "+this.displayedElementId+" "+this.displayedElementMicroversionIdAndConfiguration)):this.resyncAsNeeded()),o&&(this.processInContextDisplayData(e,r),this.selectedSheetmetalModelId&&this.showPartsWithSheetmetalModelIdOnly(this.selectedSheetmetalModelId),this.pendingPartStudioComputedData&&this.processManagedData(this.pendingPartStudioComputedData),n||this.viewer.getIsForFlattenedDisplay()||this.viewer.getEventDispatcher().trigger(T.DISPLAYED_PART_STUDIO,e.elementId,!n)),this.checkBodyMemoryUsage(e),r}processPartVisibility(e){const t=this.viewer.getModelViewManagers().getManager();if(!t.getDisplayedPartStudio())return void(this.partDisplayDataPendingVisibilityUpdate=e);const i=this.viewer.getModelViewManagers().previewManagerExists()||!!this.viewer.getSketch();e.forEach((function(e){const s=e.id;e.visibility===d.GBTPartVisibility.HIDDEN?i&&!e.isModifiable||t.hidePart(s):e.visibility===d.GBTPartVisibility.VISIBLE&&t.showPart(s)})),this.partDisplayDataPendingVisibilityUpdate=null}populateClientCacheStateDisplayInformation(e){this.emptyAssemblyDisplayDataQueue();this.viewer.processQueuedDisplayData(!0);this.getPartStudioSortedForCache().forEach((function(t){t.populateClientCacheStateDisplayInformation(e)}),this),Object.values(this.assemblies).forEach((function(t){t.populateClientCacheStateDisplayInformation(e)}),this)}displayPartStudio(e){var t;const i=this.partStudios[e];i!==this.displayedPartStudio&&this.removePartStudioDisplay(),i&&(i.instantiateForEditingInNode(this.getElementRootNode()),this.displayedPartStudio=i,null===(t=this.viewer.getCurvatureAnalysisManager())||void 0===t||t.onPartStudioDisplayed());a.DocumentModel.isElementAtVersionOrLater(d.GBTFeatureScriptVersionNumber.V343_SUBFEATURES)&&!o.btInjector.StateService.isOnDocumentCompare()?(this.viewer.getEdgePointController()||this.viewer.createEdgePointController(),this.viewer.getEdgePointController().enable()):this.viewer.getEdgePointController()&&this.viewer.getEdgePointController().disable()}removePartStudioDisplay(){this.displayedPartStudio&&(this.displayedPartStudio.removeInstantiationForEditing(this.getElementRootNode()),this.displayedPartStudio=null)}displayAssembly(e,t){const i=this.assemblies[e];i&&(this.getElementRootNode(),i.show(),this.simulationManager&&this.simulationManager.onAssemblyDisplayed(),this.viewer.getEventDispatcher().trigger(T.DISPLAYED_ASSEMBLY,e,t))}getModelBounds(e){const t=new T.BoundingBox,i=this.getSceneGraph().getRootNode(),s=i.getChildById(T.ROOT_ELEMENT_NODE_ID);if(s&&s.getBoundingBox().isInitialized()&&t.addBox(s.getBoundingBox()),!e||!e.doNotBoundTemporarySketchEntities){const e=i.getChildrenWithPrefix(T.TEMPORARY_SKETCH_COMPONENT_NODE_ID);if(e)for(let i=0;i<e.length;++i)t.addBox(e[i].getBoundingBox())}const n=this.getDisplayedElement();return n&&t.addBox(n.getBoundsOutsideElementNode()),t.addBox(this.viewer.getBodyManager().getUnloadedBodyBounds()),t.isInitialized()?t:null}setModelTransform(e){const t=this.getSceneGraph().getRootNode(),i=t.getChildById(T.ROOT_ELEMENT_NODE_ID),s=t.getChildById(T.ROOT_ELEMENT_PREVIEW_NODE_ID);i&&i.setPose(e),s&&s.setPose(e),this.applyToPreview(this.setModelTransform,arguments)}getModelTransform(){const e=this.getSceneGraph().getRootNode().getChildById(T.ROOT_ELEMENT_NODE_ID);return e?e.getPose():null}getEntityBounds(e,t){const i=this.getPartStudioDataFromOccurrence(t);if(!i)return null;const s=i.getEntityBounds(e,t);return s&&t?s.createTransformedCopy(this.getOccurrenceTransform(t)):s}getFeatureBounds(e){if(!this.displayingPartStudio())return null;const t=this.getDisplayedPartStudio();return t?t.getFeatureBounds(e):null}getBodyBounds(e,t){const i=this.getDisplayedElement();return i?i.getBodyBounds(e,t):null}getSelectionFitBounds(e){if(!e)return null;const t=e.getIdString(),i=e.getOccurrence();switch(e.getType()){case d.GBTUiSelectionType.ENTITY:let e=this.getEntityBounds(t,i);return e||(e=this.getEntityBounds(this.alternateEntityMapping.get(t),i)),e;case d.GBTUiSelectionType.FEATURE:if((0,T.isUsageCompare)()){const e=new T.BoundingBox;return e.addBox((0,T.getActiveViewerModelViewManagers)().getManager().getFeatureBounds(t)),e.addBox((0,T.getActiveViewerModelViewManagers)().getPreviewManager().getFeatureBounds(t)),e}return this.getFeatureBounds(t);case d.GBTUiSelectionType.BODY:let s=this.getBodyBounds(t,i);return s||(s=this.getBodyBounds(this.alternateEntityMapping.get(t),i)),s;case d.GBTUiSelectionType.TABLE_ITEM:case d.GBTUiSelectionType.OCCURRENCE:return i?this.getOccurrenceBounds(i):null;default:return null}}getElementRootNode(){const e=this.getSceneGraph().getRootNode();if(!e.getChildById(T.ROOT_ELEMENT_NODE_ID)){const t=new T.Node(T.ROOT_ELEMENT_NODE_ID);e.addChild(t,0),this.instantiateSharedNodes(t)}return e.getChildById(T.ROOT_ELEMENT_NODE_ID)}getElementPreviewRootNode(){const e=this.getSceneGraph().getRootNode();if(!e.getChildById(T.ROOT_ELEMENT_PREVIEW_NODE_ID)){const t=new T.Node(T.ROOT_ELEMENT_PREVIEW_NODE_ID);e.addChild(t),t.addChild(this.elementPreviewBodyNode)}return e.getChildById(T.ROOT_ELEMENT_PREVIEW_NODE_ID)}cloneForPreview(e){const t=new r.Timer("ModelViewManager.cloneForPreview"),i=new v(T.BTGraphicsUsage.PREVIEW,this.occurrenceDataManager,this.viewer),s=this.getDisplayedPartStudio();if(!s)throw"There is no base part studio to clone.";if(s.getElementId()!==e.elementId)throw"Displayed part studio does not match the part studio being previewed";i.sharedBaseMeshManager=this.meshManager.cloneForPreview(s.getMeshOwnerId());const n=s.cloneForPreview(i,!1);return i.partStudios[e.elementId]=n,i.displayedElementId=e.elementId,i.displayedElementType=d.GBTElementType.PARTSTUDIO,i.setBodyLoadTasks(this.bodyLoadTasks),i.displayPartStudio(e.elementId),i.occurrenceDataManager=this.occurrenceDataManager,i.alternateEntityMapping=this.alternateEntityMapping,i.selectedSheetmetalModelId=this.selectedSheetmetalModelId,i.processManagedData(this.pendingPartStudioComputedData),t.report(),i}onPreviewDestroyed(){Object.values(this.partStudios).forEach((function(e){e.onPreviewDestroyed()}),this),this.partStudioPreservedForPreview&&(this.partStudioPreservedForPreview.onDeletion(),this.partStudioPreservedForPreview=null)}getPartStudioSortedForCache(){return Object.values(this.partStudios).sort((function(e,t){return e.getIsInternal()===t.getIsInternal()?e.microversionIdAndConfiguration.microversion.theId===t.microversionIdAndConfiguration.microversion.theId?e.microversionIdAndConfiguration.getKey()<t.microversionIdAndConfiguration.getKey()?-1:1:e.microversionIdAndConfiguration.microversion.theId<t.microversionIdAndConfiguration.microversion.theId?-1:1:e.getIsInternal()?-1:1}))}resetDisplayedElement(){this.displayedElementMicroversionIdAndConfiguration=null}onChangeActiveElement(e,t,i){var s,n;if(this.clearSilhouetteRequests(),this.simulationManager&&this.simulationManager.clearSimulationAndConnectionGraphics(),null===(s=this.viewer.getCurvatureAnalysisManager())||void 0===s||s.onChangeActiveElement(),null===(n=this.generativeDesignManager)||void 0===n||n.onChangeActiveElement(),this.displayingAssembly()){const e=this.assemblies[this.displayedElementId];e&&e.hide()}else this.displayingPartStudio()&&this.removePartStudioDisplay();this.displayedElementId="",this.displayedElementMicroversionIdAndConfiguration=null,this.displayedElementIsPublicationItem=void 0,this.partStudioVisibilityUpdated=!1,e?(this.displayedElementType=t,this.displayedElementType===d.GBTElementType.PARTSTUDIO?(this.displayedElementId=e,this.displayedElementIsPublicationItem=i,this.displayedElementMicroversionIdAndConfiguration=null,this.viewer.requestDraw()):this.displayedElementType===d.GBTElementType.ASSEMBLY?(this.displayedElementId=e,this.displayedElementIsPublicationItem=i,this.viewer.requestDraw()):this.displayedElementId=""):this.displayedElementId="",this.integrityCheck();!this.displayingPartStudio()&&this.viewer.getEdgePointController()&&this.viewer.getEdgePointController().disable()}displayingPartStudio(){return this.displayedElementType===d.GBTElementType.PARTSTUDIO}displayingAssembly(){return this.displayedElementType===d.GBTElementType.ASSEMBLY}getDisplayedElementId(){return this.displayedElementId}getDisplayedElement(){return this.displayingPartStudio()?this.partStudios[this.isBase()?this.getDisplayedFullElementId():this.displayedElementId]:this.displayingAssembly?this.assemblies[this.displayedElementId]:null}getDisplayedElementMicroversionId(e){if(e===T.BTGraphicsUsage.PREVIEW&&this.usage!==T.BTGraphicsUsage.PREVIEW)return this.applyToPreview(this.getDisplayedElementMicroversionId,arguments);const t=this.getDisplayedElement();return t&&t.microversionIdAndConfiguration&&t.microversionIdAndConfiguration.microversion?t.microversionIdAndConfiguration.microversion.theId:""}getDisplayedPartStudio(){return this.partStudios[this.getDisplayedFullElementId()]||null}getDisplayedInContextAssembly(){const e=this.getDisplayedPartStudio();return e&&e.isDisplayingIncontextAssembly()?this.assemblies[e.getVisibleInContextAssemblyId()]:null}getDisplayedAssembly(){return this.assemblies[this.displayedElementId]||null}getPartStudioVisibilityUpdated(){return this.partStudioVisibilityUpdated}setPartStudioVisibilityUpdated(){this.getDisplayedPartStudio()&&(this.partStudioVisibilityUpdated=!0)}getInContextOccurrenceDisplayData(e){const t=this.getDisplayedPartStudio();if(t){const i=this.assemblies[t.getVisibleInContextAssemblyId()];if(i){const t=i.getDisplayDataForOccurrence(e);if(t)return t}}return null}getOccurrenceDisplayData(e){const t=this.assemblies[this.displayedElementId];return t?t.getOccurrenceDisplayData(e):this.getInContextOccurrenceDisplayData(e)}getMateConnectorGraphics(e,t){if(this.displayingAssembly()){const i=this.assemblies[this.displayedElementId];if(i)return i.getMateConnectorGraphics(e,t)}else if(this.displayingPartStudio()){if(e){const i=this.getDisplayedInContextAssembly();if(i)return i.getMateConnectorGraphics(e,t)}const i=this.partStudios[this.getDisplayedFullElementId()];if(i)return i.getMateConnectorGraphics(e,t)}return null}hasMateIndicatorForOccurrence(e){if(this.displayingAssembly()){const t=this.assemblies[this.displayedElementId];if(t)return t.hasMateIndicatorForOccurrence(e)}return!1}hasGraphicsOccurrenceData(e){return!!e.isAssemblyRoot()||!!this.getOccurrenceDisplayData(e)}getOccurrenceElementId(e){const t=this.getOccurrenceDisplayData(e);return t?t.fullElementId:null}getOccurrenceTransform(e){const t=this.getOccurrenceDisplayData(e);return t?t.occurrenceData.transform.getGlMatrix():f.mat4.create()}updateOccurrenceTransform(e,t){const i=this.assemblies[this.displayedElementId];i&&i.updateOccurrenceTransform(e,t)}batchUpdateOccurrenceTransforms(e){if(0===e.length)return!0;const t=this.assemblies[this.displayedElementId];return!!t&&t.batchUpdateOccurrenceTransforms(e)}getPartStudios(){return Object.values(this.partStudios)}getPartStudioDataFromOccurrence(e){if(this.displayingAssembly()){if(!e)return c.log.warn("An attempt was made to retrieve an part studio data from an assembly without a specified occurrence"),null;const t=this.assemblies[this.displayedElementId];if(t){const i=t.getDisplayDataForOccurrence(e);if(i)return this.partStudios[i.fullElementId.toString()]||null}}else if(this.displayingPartStudio()){if(e){const t=this.getInContextOccurrenceDisplayData(e);if(t&&this.partStudios[t.fullElementId.toString()])return this.partStudios[t.fullElementId.toString()]}return this.partStudios[this.getDisplayedFullElementId()]||null}return null}getPartStudio(e){return(e=e.toString()).length>0&&e.length<=25&&"-"!==e&&this.isBase()&&c.log.info("An attempt was made to get part studio with id that is not in elementId-microversionId format"),this.partStudios[e]||null}getDeterministicIdForFeature(e,t,i){let s;const n=this,r=n.getEntitiesForFeature(e,t);return r&&(s=r.find((function(t){const s=n.retrieveEntityMetaData(e,t);if(s){const n=(0,h.createSelectionFromEntityData)(t,s,{},e);if(n&&(!i||i.filter(n)))return!0}return!1}))),s||""}getDeterministicIdForPickId(e,t){const i=e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio();return i?i.getEntityIdManager().getNameForId(t):null}retrieveEntityMetaData(e,t){if(t.startsWith(d.BTUiGenerateSectionEntitiesResponse.SECTION_IDENTIFIER)){const e=(0,T.getActiveSectionViewState)();return null==e?void 0:e.getEntityMetaData(t)}let i=this.getDisplayedPartStudio();if(e&&(i=this.getPartStudioDataFromOccurrence(e)),!i)return null;let s=i.retrieveEntityMetaData(t);if(!s){const e=this.alternateEntityMapping.get(t);e&&(s=i.retrieveEntityMetaData(e))}return s}retrieveBodyMetaData(e,t){let i=this.getDisplayedPartStudio();if(e&&(i=this.getPartStudioDataFromOccurrence(e)),!i)return null;let s=i.retrieveBodyMetaData(t);return!s&&(s=this.applyToPreview(this.retrieveBodyMetaData,arguments)||null,s)?(s.foundInPreview=!0,s):s}retrieveAssociatedFeatureIds(e,t){let i=this.getDisplayedPartStudio();return e&&(i=this.getPartStudioDataFromOccurrence(e)),i?i.retrieveAssociatedFeatureIds(t):null}getFlattenedEntityOwnerBodyDetails(e,t){if(!this.viewer.getIsForFlattenedDisplay())return null;const i=this.retrieveEntityMetaData(t,e);if(!i)return null;const s=this.getPartStudioDataFromOccurrence(t);if(!s)return null;let n=null;if(n=i.isFromSketch()?s.getSketchComponent().getOwnerFlattenedBodyId(e):i.getBodyId(),!n)return null;const r=s.retrieveBodyMetaData(n);if(r){return{bodyMetaData:r,transform:s.getBodyComponent().getTransformFromSheetMetalBodyMetaData(r)}}return null}updatePSOI(e){const t=this.getDisplayedPartStudio();t&&t.updatePSOI(e)}getPartStudioBodyMetaDataAssociatedWithSelections(e){if(!this.displayingPartStudio())return[];const t=new Set;e&&t.add(e),(0,h.getSelectionList)().each((function(e){if(!e.getOccurrence()){const i=e.getBodyId();i&&t.add(i)}}),this);const i=[];return t.forEach((function(e){const t=this.retrieveBodyMetaData(null,e);t&&i.push(t)}),this),i.filter((e=>!e.getIsFromSketch()))}getAssemblyOccurrencesAssociatedWithSelections(){if(!this.displayingAssembly())return[];const e=[];return(0,h.getSelectionList)().forEach((t=>{e.push(t.getOccurrence().getPathAsString())})),e}hasEntity(e,t){return!!this.retrieveEntityMetaData(e,t)}hasFeature(e,t){const i=this.getCurrentPartStudioData(e);return!!i&&i.hasFeature(t)}getFirstMateConnectorId(e){const t=this.getCurrentPartStudioData(e);return t?t.mateConnectorComponent.featureToIds.firstKey():null}assemblyHasHiddenOccurrences(){const e=this.getDisplayedAssembly();if(e)for(const t in e.occurrences)if(e.occurrences[t].isHidden)return!0;return!1}getAllMateConnectorIds(e,t){let i=[];const s=this.getCurrentPartStudioData(e);if(s)i=s.mateConnectorComponent.getInstantiatedMateConnectorsForOccurrence(e);else if(this.displayingAssembly()&&e){const s=this.assemblies[this.displayedElementId];s&&(i=s.getMateConnectorIdsForOccurrence(e,t))}return i}hasBody(e,t){const i=this.getCurrentPartStudioData(e);return!!i&&i.hasBody(t)}getCurrentPartStudioData(e){return e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio()}hideSketch(e){const t=this.getDisplayedPartStudio();t&&t.hideSketch(e),this.applyToPreview(this.hideSketch,arguments)}retrieveSketchEntityDeterministicId(e,t){const i=this.getDisplayedPartStudio();return i?i.retrieveSketchEntityDeterministicId(e,t):null}showSketch(e){const t=this.getDisplayedPartStudio();t&&t.showSketch(e),this.applyToPreview(this.showSketch,arguments)}displaySketchAsActive(e){const t=this.getDisplayedPartStudio();t&&t.displaySketchAsActive(e)}displaySketchAsInactive(e){const t=this.getDisplayedPartStudio();t&&t.displaySketchAsInactive(e)}hasActiveSketch(){const e=this.getDisplayedPartStudio();return!!e&&e.hasActiveSketch()}hideInactiveContextAssemblies(e){if((0,T.isUsagePreviewFinal)())return;const t=e.assemblyReferenceDisplayData,i=new E.StringSet;let s;for(s=0;s<t.assemblyReferences.length;s++){const e=t.assemblyReferences[s],n=e.assemblyDisplayData,r=(0,T.getAssemblyInContextElementId)(n.elementId,t.elementId,e.referenceNodeId);i.add(r),e.visibility!==d.GBTBSFeatureVisibility.VISIBLE&&this.hideAssembly(r)}const n=this.getDisplayedPartStudio();if(n){const e=n.getReferencedInContextAssemblyIds();for(s=0;s<e.length;s++)i.contains(e[s])||this.hideAssembly(e[s])}}processInContextDisplayData(e,t){e.isBase()&&(this.viewer.getIsForFlattenedDisplay()?this.processInContextDisplayDataForFlat(e,t):this.viewer.getIsPrimaryViewer()&&this.processInContextDisplayDataFor3d(e,t))}processInContextDisplayDataFor3d(e,t){let i=!1;const s=e.assemblyReferenceDisplayData;for(let t=0;t<s.assemblyReferences.length;t++){const n=s.assemblyReferences[t],r=n.assemblyDisplayData;if(n.visibility!==d.GBTBSFeatureVisibility.VISIBLE)continue;r.elementId=(0,T.getAssemblyInContextElementId)(r.elementId,s.elementId,n.referenceNodeId);const a=[];n.occurrencesToExclude.forEach((function(e){a.push(e.getPathAsString())}));const o=[];r.occurrences.push(d.BTOccurrenceDisplayData.createRootOccurrenceDisplayData(r.elementId)),r.occurrences.forEach((function(e){const t=e.occurrenceData.occurrence.getPathAsString(),i=e.occurrenceData.transform.getGlMatrix(),s=n.transform.getGlMatrix(),r=C.mat4C.multiply(s,i,f.mat4.create());e.occurrenceData.transform.updateFromGlMatrix(r),o.push(e),a.indexOf(t)>=0&&(e.partIds=[],e.fullElementId=new d.BTFullElementId)})),r.occurrences=o,(0,T.isUsagePreviewFinal)()||this.viewer.onRootAssemblyDisplayData(r,e),i=!0}i?(0,T.getActiveViewerEventDispatcher)().trigger(T.UPDATE_INCONTEXT_ISOLATION,i):e.isNoop||(0,T.getActiveViewerEventDispatcher)().trigger(T.UPDATE_INCONTEXT_ISOLATION,i)}processInContextDisplayDataForFlat(e,t){if((0,T.isUsagePreviewFinal)())return;const i=e.assemblyReferenceDisplayData;for(let e=0;e<i.assemblyReferences.length;e++){const s=i.assemblyReferences[e].assemblyDisplayData,n=!0;this.processPartStudioDisplayDataList(s.partStudioDisplayData,n,t)}}applyToPreview(e,t){if(this.isBase()){const i=this.viewer.getModelViewManagers().getPreviewManager();if(i)return e.apply(i,t)}return null}showConstructionPlane(e){const t=this.getDisplayedPartStudio();t&&t.showConstructionPlane(e),this.applyToPreview(this.showConstructionPlane,arguments),this.viewer.requestDraw()}hideMateConnector(e,t){const i=this.getDisplayedPartStudio();i&&i.hideMateConnector(e,t),this.applyToPreview(this.hideMateConnector,arguments),this.viewer.requestDraw()}showMateConnector(e,t){const i=this.getDisplayedPartStudio();i&&i.showMateConnector(e,t),this.applyToPreview(this.showMateConnector,arguments),this.viewer.requestDraw()}hideFeatureBodies(e,t){const i=this.getDisplayedPartStudio();i&&i.hideFeatureBodies(e,t),this.applyToPreview(this.hideFeatureBodies,arguments),this.viewer.requestDraw()}showFeatureBodies(e,t){const i=this.getDisplayedPartStudio();i&&i.showFeatureBodies(e,t),this.applyToPreview(this.showFeatureBodies,arguments),this.viewer.requestDraw()}hideConstructionPlane(e){const t=this.getDisplayedPartStudio();t&&t.hideConstructionPlane(e),this.applyToPreview(this.hideConstructionPlane,arguments),this.viewer.requestDraw()}hidePart(e){let t=!1;const i=this.getDisplayedPartStudio();return i&&(t=i.hidePart(e)),this.applyToPreview(this.hidePart,arguments),this.viewer.requestDraw(),t}showPart(e){let t=!1;const i=this.getDisplayedPartStudio();return i&&(t=i.showPart(e)),this.applyToPreview(this.showPart,arguments),this.viewer.requestDraw(),t}setPlaneAppearance(e,t){const i=this.getDisplayedPartStudio();i&&(i.setPlaneAppearance(e,t),this.viewer.requestDraw()),this.applyToPreview(this.setPlaneAppearance,arguments)}hidePointBodies(e){const t=this.getDisplayedPartStudio();t&&(t.hidePointBodies(e),this.applyToPreview(this.hidePointBodies,arguments),this.viewer.requestDraw())}showPointBodies(e){const t=this.getDisplayedPartStudio();t&&(t.showPointBodies(e),this.applyToPreview(this.showPointBodies,arguments),this.viewer.requestDraw())}changePartColor(e,t,i){const s=this.getDisplayedPartStudio();s&&(s.changePartColor(e,t,i),this.viewer.requestDraw())}changePartOpacity(e,t,i){const s=this.getDisplayedPartStudio();s&&(s.changePartOpacity(e,t,i),this.viewer.requestDraw())}getPartColor(e){const t=this.getDisplayedPartStudio();return t?t.getPartColor(e):null}getPartOpacity(e){const t=this.getDisplayedPartStudio();return t?t.getPartOpacity(e):-1}getOccurrenceColor(e){const t=this.getPartStudioDataFromOccurrence(e);return t?t.getBodyComponent(e).getOccurrenceColor(e):null}setOccurrenceAlphaModifier(e,t){const i=this.getPartStudioDataFromOccurrence(e);i&&i.getBodyComponent(e).setOccurrenceAlphaModifier(e,t)}clearOccurrenceAlphaModifier(e){const t=this.getPartStudioDataFromOccurrence(e);t&&t.getBodyComponent(e).clearOccurrenceAlphaModifier(e)}addTemporarySketchComponent(e){this.temporarySketchComponents[e.getUniqueId()]=e}removeTemporarySketchComponent(e){delete this.temporarySketchComponents[e.getUniqueId()]}processEntitiesHighlight(e,t,i,s){let n=T.PART_STUDIO_ELEMENT_ID;const r=this.getPartStudioDataFromOccurrence(t);if(t&&(n=this.viewer.getOccurrenceIdManager().getIdForName(t.getPathAsString())),n!==T.INVALID_OCCURRENCE_ID)for(let t=0;t<i.length;++t){const a=i[t];r.updateEntityHighlight(e,s,a,n),this.updateTemprorarySketchHighlights(e,s,a,n);const o=this.alternateEntityMapping.get(a);o&&r.updateEntityHighlight(e,s,o,n)}}updateTemprorarySketchHighlights(e,t,i,s){for(const n in this.temporarySketchComponents)this.temporarySketchComponents[n].updateEntityHighlight(e,t,i,s)}getDimensionGraphic(e,t){let i=null;return this.displayedElementType===d.GBTElementType.PARTSTUDIO&&(i=this.getDisplayedPartStudio()),i?i.getDimensionGraphic(e,t):null}processOccurrenceHighlight(e,t,i){const s=i.cloneForOccurrence(t);let n;if(t&&t.path[0]===T.BodyComponent.PART_STUDIO_BODY_OCCURRENCE_PREFIX)n=[t];else{const i=this.assemblies[this.displayedElementId];if(!i)return;n=i.getLeafOccurrencesContainedWithinOccurrence(t);for(let t=0;t<n.length;++t){const r=i.getOccurrenceEntityIdsForHighlight(n[t]);r.length>0&&this.processEntitiesHighlight(e,n[t],r,s)}}this.viewer.getBodyManager().onOccurrencesHighlighted(e,n),this.occurrenceDataManager.processHighlightForOccurrences(e,n,s,this.usage)}getOccurrenceIdForSelection(e){if(e.getOccurrence())return this.viewer.getOccurrenceIdManager().getIdForName(e.getOccurrence().getPathAsString());{const t=this.getPartStudioDataFromOccurrence(e.getOccurrence());if(t)return t.getPartStudioOccurrenceIdForSelection(e)}return T.INVALID_OCCURRENCE_ID}getEntityIdsForSelection(e){let t=null;const i=this.getPartStudioDataFromOccurrence(e.getOccurrence());return i&&(t=i.getEntityIdsForSelection(e)),t||[]}getEntitiesForFeature(e,t,i){let s=this.displayedPartStudio;return e&&(s=this.getPartStudioDataFromOccurrence(e)),s?s.getEntitiesForFeature(t,i):null}getFeatureIdsRelatedToBody(e,t){const i=e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio();if(!i)return[];const s=new Set,n=i.getEntitiesForBody(t);for(let t=0;t<n.length;++t){const r=i.retrieveEntityMetaData(n[t]);if(r){const e=r.getFeatureIds();for(let t=0;t<e.length;++t)s.add(e[t])}for(const i of this.retrieveAssociatedFeatureIds(e,n[t]))s.add(i)}for(const i of this.retrieveAssociatedFeatureIds(e,t))s.add(i);return[...s]}getBodyIdsRelatedToFeature(e,t){const i=e?this.getPartStudioDataFromOccurrence(e):this.getDisplayedPartStudio();if(!i)return[];const s=i.getEntitiesForFeature(t),n=new Set;for(let e=0;e<s.length;++e){const t=i.retrieveEntityMetaData(s[e]);t&&n.add(t.getBodyId())}return[...n]}getEntitiesForBody(e,t){const i=this.getPartStudioDataFromOccurrence(e);return i?i.getEntitiesForBody(t):null}getIncrementsForFeature(e,t){const i=this,s=[],n=i.getEntitiesForFeature(e,t);return n&&n.forEach((function(t){const n=i.extractMeshIncrement(t,e);n&&s.push(n)})),s}extractMeshIncrement(e,t){var i;if(null==e?void 0:e.startsWith(d.BTUiGenerateSectionEntitiesResponse.SECTION_IDENTIFIER)){const t=(0,T.getActiveSectionViewState)();return null!==(i=null==t?void 0:t.extractMeshIncrement(e))&&void 0!==i?i:null}let s=this.getDisplayedPartStudio();return t&&(s=this.getPartStudioDataFromOccurrence(t)),s?s.extractMeshIncrement(e):null}isEntityOnOccurrence(e,t){const i=this.getOccurrenceDisplayData(t);if(!i)return!1;const s=this.retrieveEntityMetaData(t,e);return!!s&&(this.occurrenceContainsBody(i,s.getBodyId())||i.containsPart(e))}occurrenceContainsBody(e,t){if(e.containsPart(t))return!0;const i=this.partStudios[e.fullElementId.toString()];if(!i)return!1;if(i.getSketchComponent().hasBody(t)){const s=i.getEntitiesForBody(t);for(let t=0;t<s.length;++t)if(e.containsPart(s[t]))return!0}const s=i.retrieveBodyMetaData(t);if(!s)return!1;if(s.isClosedCompositeConstituent&&e.containsPart(s.consumingClosedCompositeData.id))return!0;if(s.referencingOpenCompositeData)for(const[t,i]of s.referencingOpenCompositeData)if(e.containsPart(t))return!0;return!1}isNodeForModel(e){return e.getId()===T.ROOT_ELEMENT_NODE_ID||!!e.getParent()&&this.isNodeForModel(e.getParent())}isNodeForSketch(e){return e.getId()===T.SketchComponentId}isNodeForBody(e,t){if(0===e.getId().indexOf(T.BodyComponentId))return!0;if(t){if(this.simulationManager)return this.simulationManager.isNodeForBodyVisualization(e);if(this.thicknessAnalysisManager)return this.thicknessAnalysisManager.isNodeForBodyVisualization(e)}return!1}isNodeForFaces(e){return e.isFaces()}isNodeForEdges(e){return e.isEdges()}isNodeForPoints(e){return e.isPoints()}handleAllSelectionListHighlights(){this.viewer.getIsForPreviousVersionDisplay()||(this.handleSelectionListHighlights("selectionList",(0,h.getSelectionList)()),this.handleSelectionListHighlights("preselectionList",(0,h.getPreselectionList)(),T.HighlightType.PRE),this.handleSelectionListHighlights("secondarySelectionList",(0,h.getSecondarySelectionList)(),T.HighlightType.SECONDARY),this.handleSelectionListHighlights("secondaryPreSelectionList",(0,h.getSecondaryPreSelectionList)(),T.HighlightType.SECONDARY_PRE),this.handleSelectionListHighlights("smartSelectionList",(0,h.getSmartSelectionList)(),T.HighlightType.SMART_SELECTION),this.handleSelectionListHighlights("accumulatedSmartSelections",(0,h.getAccumulatedSmartSelections)(),T.HighlightType.ACCUMULATED_SMART_SELECTION),this.handleSelectionListHighlights("commentSelectionList",(0,h.getCommentSelectionList)(),T.HighlightType.COMMENT),this.handleSelectionListHighlights("filteredEntitiesList",(0,h.getFilteredEntitiesList)(),T.HighlightType.FILTERED_ENTITIES),this.handleSelectionListHighlights("errorSelectionList",(0,h.getErrorSelectionList)(),T.HighlightType.ERROR),this.handleSelectionListHighlights("retrievalSelectionList",(0,h.getRetrievalSelectionList)(),T.HighlightType.RETRIEVAL))}resetSelectionListHandlers(){this.selectionListsHandled.forEach((function(e){this.stopListening(e.selectionList)}),this),this.selectionListsHandled=[],this.handleAllSelectionListHighlights(),this.meshPointController&&this.meshPointController.resetSelectionListHandlers()}handleSelectionListHighlights(e,t,i){this.selectionListsHandled.push({selectionListName:e,selectionList:t,highlightType:i});const s=this;this.selectionsToClearOnReset[e]={},this.listenTo(t,"add",(function(t){s.processSelectionHighlight(T.Action.ADD,t,e,i)})),this.listenTo(t,"remove",(function(t){s.processSelectionHighlight(T.Action.REMOVE,t,e,i)})),this.listenTo(t,"reset",(function(t){s.resetSelectionListHighlights(t,e,i)})),t.each((function(t){s.processSelectionHighlight(T.Action.ADD,t,e,i)}))}removeSelectionListHandler(e){const t=this.selectionListsHandled.findIndex((t=>t.selectionListName===e));if(t>=0){const e=this.selectionListsHandled[t];this.clearSelectionHighlight(e.selectionListName,e.highlightType),this.stopListening(e.selectionList),this.selectionListsHandled.splice(t,1)}delete this.selectionsToClearOnReset[e]}resetSelectionListHighlights(e,t,i){this.clearSelectionHighlight(t,i),e.each((function(e){this.processSelectionHighlight(T.Action.ADD,e,t,i)}),this)}updateOrVerifySelections(e,t){if(this.viewer.getIsForFlattenedDisplay())return;const i=this;(0,h.getAllSelectionLists)().forEach((function(s){i.updateOrVerifySelectionsInList(e,t,s)}))}updateOrVerifySelectionsInList(e,t,i){const s=[];let n=!1,r=!0;const a=this,o={},c=(0,h.getSelectionFocus)(),l=!c||!c.getReceivesComputedData();return i.each((function(i){let c=i;if(c.getUsage()!==a.usage)return;e&&(c=e.updateSelection(c,t),c=c||i);let h=!l&&!!c;if(c&&l)switch(c.getType()){case d.GBTUiSelectionType.ENTITY:h=a.hasEntity(c.getOccurrence(),c.getIdString())||c.isSectionEntity();break;case d.GBTUiSelectionType.FEATURE:case d.GBTUiSelectionType.FOLDER:case d.GBTUiSelectionType.ROLLBACKBAR:h=!0;break;case d.GBTUiSelectionType.BODY:h=a.hasBody(c.getOccurrence(),c.getIdString());break;case d.GBTUiSelectionType.MATE_CONNECTOR:case d.GBTUiSelectionType.OCCURRENCE:case d.GBTUiSelectionType.MATE:case d.GBTUiSelectionType.NON_GEOMETRIC_ITEM:case d.GBTUiSelectionType.SIMULATION_LOAD:case d.GBTUiSelectionType.EDGE_POINT:case d.GBTUiSelectionType.MESH_POINT:case d.GBTUiSelectionType.TABLE_ITEM:h=!0}h?(n=n||c.getIdString()!==i.getIdString(),o.hasOwnProperty(c.id)?(s[o[c.id]]=c,n=!0):(o[c.id]=s.length,s.push(c))):(n=!0,r=r&&i.isInContextSubFeature())})),n&&i.reset(s,{suppressServerCalls:r,isForRemapping:!0}),n}clearHighlights(){for(let e=0;e<this.selectionListsHandled.length;++e){const t=this.selectionListsHandled[e];this.clearSelectionHighlight(t.selectionListName,t.highlightType)}}refreshHighlight(){const e=this,t=function(t,i,s){i.each((function(n){n.isMeshPoint()&&n.getMeshPointData()?e.meshPointController.addSelection(n,i):e.processSelectionHighlight(T.Action.ADD,n,t,s)}))};for(let e=0;e<this.selectionListsHandled.length;++e){const i=this.selectionListsHandled[e];t(i.selectionListName,i.selectionList,i.highlightType)}}handlesHighlightForSelection(e,t){if(e.getUsage()!==this.usage)return!1;if(t===T.HighlightType.PRE&&e.source===h.Source.PICK&&P.getNumber("INHIBIT_PREHIGHLIGHT"))return!1;switch(e.getType()){case d.GBTUiSelectionType.ENTITY:case d.GBTUiSelectionType.FEATURE:case d.GBTUiSelectionType.BODY:case d.GBTUiSelectionType.OCCURRENCE:case d.GBTUiSelectionType.MATE:case d.GBTUiSelectionType.MATE_CONNECTOR:case d.GBTUiSelectionType.EDGE_POINT:case d.GBTUiSelectionType.TABLE_ITEM:case d.GBTUiSelectionType.SKETCH_GROUP:case d.GBTUiSelectionType.NON_GEOMETRIC_ITEM:case d.GBTUiSelectionType.PROPERTY:case d.GBTUiSelectionType.SIMULATION_LOAD:case d.GBTUiSelectionType.FOLDER:return!0}return!1}getHighlightTypeForSelection(e,t){if(t===T.HighlightType.PRE&&(e.isOccurrence()||e.isFolder()))return T.HighlightType.OCCURRENCE_PRE;if(t===T.HighlightType.SECONDARY_PRE&&e.isOccurrence())return T.HighlightType.OCCURRENCE_SECONDARY_PRE;if(t===T.HighlightType.COMMENT&&e.isOccurrence())return T.HighlightType.OCCURRENCE_COMMENT;if(t)return t;switch(e.getType()){case d.GBTUiSelectionType.ENTITY:return T.HighlightType.ENTITY;case d.GBTUiSelectionType.FEATURE:case d.GBTUiSelectionType.SKETCH_GROUP:return T.HighlightType.FEATURE;case d.GBTUiSelectionType.BODY:return T.HighlightType.PART;case d.GBTUiSelectionType.FOLDER:case d.GBTUiSelectionType.OCCURRENCE:case d.GBTUiSelectionType.NON_GEOMETRIC_ITEM:return T.HighlightType.OCCURRENCE;case d.GBTUiSelectionType.TABLE_ITEM:if(e.getOccurrence())return T.HighlightType.OCCURRENCE}return T.HighlightType.UI}processSelectionHighlight(e,t,i,s,n,r){if(!t||!this.handlesHighlightForSelection(t,s))return;const a=this.getDisplayedElement();if(!a)return;const o=!s||s===T.HighlightType.PRE;s=this.getHighlightTypeForSelection(t,s);let c=!1;if(t.isFromBody()&&(t.isBody()||t.isFace())){let e;e=t.isBody()?t.getBodyMetaData():t.getEntityMetaData().getBodyMetaData(),e&&(!e.isModifiableBody()||(0,T.isUsagePreview)()&&t.isBody())&&(c=!0)}const l=this.viewer.getHighlightManager(this.usage),h=l.createHighlightForSelection(s,t.getIdForCollection(),c),d=this.getEntityIdsForSelection(t),u=a.getInContextImportEntityIdsForSelection(t),g=s===T.HighlightType.PRE?T.HighlightType.INCONTEXT_REFERENCE_PRE:T.HighlightType.INCONTEXT_REFERENCE,p=n?[]:a.getOccurrencesForSelection(t);let m=!t.isEntity()||t.isFromConstructionGeometry()||this.addDerivedEntityHighlights;s!==T.HighlightType.COMMENT||t.isPlane()||(m=!1);let E=[];if(r||!m&&e===T.Action.ADD||(E=this.viewer.getEdgePointController()&&t.isEdgePoint()?this.viewer.getEdgePointController().getUIElementsForSelection(t):t.getOccurrence()&&this.getDisplayedInContextAssembly()?this.getDisplayedInContextAssembly().getUIElementsForSelection(t):a.getUIElementsForSelection(t)),this.processUiHighlights(e,E,t,i,h),t.isMateConnector()||t.isMate()||t.isMateRelation()||t.isExplodeStep()||t.isNonGeometricItem()||t.isSimulationLoad())this.processSecondaryAssemblyFeatureHighlights(e,p,t,i,s);else if(d&&d.length>0&&this.processEntitiesHighlight(e,t.getOccurrence(),d,h),u&&u.length>0&&o&&this.processEntitiesHighlight(e,t.getOccurrence(),u,l.createHighlightForSelection(this.getHighlightTypeForSelection(t,g),t.getIdForCollection())),p&&p.length>0&&m){const n=t.isBody()&&!!t.getOccurrence();let r=h;(t.isEntity()||n||t.isFeature())&&(e===T.Action.ADD&&(this.selectionsToClearOnReset[i][t.getIdForCollection()]=t),r=s===T.HighlightType.FEATURE?l.createSecondaryHighlight(T.HighlightType.OCCURRENCE,T.HighlightType.OCCURRENCE,t.getIdForCollection()):l.createSecondaryHighlight(s===T.HighlightType.PRE?T.HighlightType.ASSOCIATED_OCCURRENCE_PRE:T.HighlightType.ASSOCIATED_OCCURRENCE,s,t.getIdForCollection()));for(let t=0;t<p.length;++t)this.processOccurrenceHighlight(e,p[t],r);r.associatedPrimaryHighlightType&&e===T.Action.REMOVE&&l.freeSecondaryHighlight(r.type,r.associatedPrimaryHighlightType,t.getIdForCollection())}e===T.Action.REMOVE&&(l.freeHighlightForSelection(s,t.getIdForCollection()),o&&l.freeHighlightForSelection(g,t.getIdForCollection())),this.viewer.requestDraw()}processUiHighlights(e,t,i,s,n){if(!t||t.length<=0)return;let r=!0;for(let i=0;i<t.length;++i)e===T.Action.ADD?t[i].addHighlight(n):r=r&&t[i].removeHighlight(n);e===T.Action.ADD?this.selectionsToClearOnReset[s][i.getIdForCollection()]=i:r&&delete this.selectionsToClearOnReset[s][i.getIdForCollection()]}processSecondaryAssemblyFeatureHighlights(e,t,i,s,n){const r=this.getDisplayedElement();if(!r)return;const a=i.getIdForCollection()+I.ID_SEPARATOR+n,o=this.viewer.getHighlightManager(this.usage);let l,h;h=i.isMateConnector()||i.isMate()&&i.featureType!==g.FeatureTypeName.MATE_GROUP?o.createSecondaryHighlight(T.HighlightType.RELATED_OCCURRENCE_MATE,n,i.getIdForCollection()):o.createSecondaryHighlight(T.HighlightType.RELATED_OCCURRENCE,n,i.getIdForCollection());const d=n===T.HighlightType.UI?T.HighlightType.UI_RELATED_ENTITY:n;if(e===T.Action.ADD){const e=this.secondaryOccurrenceHighlights[a];if(e&&e.length>0){for(l=0;l<e.length;++l)this.processOccurrenceHighlight(T.Action.REMOVE,e[l],h);delete this.secondaryOccurrenceHighlights[a]}this.secondaryOccurrenceHighlights[a]=t}else t=this.secondaryOccurrenceHighlights[a],delete this.secondaryOccurrenceHighlights[a];for(l=0;t&&l<t.length;++l)this.processOccurrenceHighlight(e,t[l],h);if(this.displayingAssembly()){let t;if(this.secondaryEntityHighlights.hasOwnProperty(a))for(t=this.secondaryEntityHighlights[a],delete this.secondaryEntityHighlights[a],l=0;t&&l<t.length;++l)if(!this.updateSecondaryEntityHighlightRepeatCount(t[l],s,n,!1)){const e=!t[l].isAssemblyOrigin(),i=!t[l].isAssemblyOrigin();this.processSelectionHighlight(T.Action.REMOVE,t[l],s,d,e,i)}if(e===T.Action.ADD)for(t=r.getEntitiesForNonInstanceSelection(i),this.secondaryEntityHighlights[a]=t,l=0;t&&l<t.length;++l){this.updateSecondaryEntityHighlightRepeatCount(t[l],s,n,!0)||c.log.warn("Adding highlight should always result in an existing entity highlight");const i=!t[l].isAssemblyOrigin(),r=!t[l].isAssemblyOrigin();this.processSelectionHighlight(e,t[l],s,d,i,r)}}e===T.Action.ADD?this.selectionsToClearOnReset[s][i.getIdForCollection()]=i:o.freeSecondaryHighlight(T.HighlightType.RELATED_OCCURRENCE,n,i.getIdForCollection())}updateSecondaryEntityHighlightRepeatCount(e,t,i,s){const n=e.id+t+i.toString();let r=this.secondaryEntityHighlightSelectionRepeats[n];return r||(r=0),s?r++:r--,r>0?(this.secondaryEntityHighlightSelectionRepeats[n]=r,!0):(delete this.secondaryEntityHighlightSelectionRepeats[n],!1)}clearHighlight(e,t,i){const s=this.viewer.getReferenceHighlights().highlights[e];this.occurrenceDataManager.clearHighlight(s,this.usage),this.clearIndividualHighlights(s,t,i),this.viewer.getHighlightManager(this.usage).resetHighlightInstanceIds(e),e===T.HighlightType.PRE?(this.clearHighlight(T.HighlightType.OCCURRENCE_PRE,t,i),this.clearHighlight(T.HighlightType.ASSOCIATED_OCCURRENCE_PRE,t,i),this.clearHighlight(T.HighlightType.INCONTEXT_REFERENCE_PRE,t,!0)):e===T.HighlightType.SECONDARY_PRE?this.clearHighlight(T.HighlightType.OCCURRENCE_SECONDARY_PRE,t,i):e===T.HighlightType.COMMENT&&this.clearHighlight(T.HighlightType.OCCURRENCE_COMMENT,t,i),this.viewer.requestDraw()}clearSelectionHighlight(e,t){t?this.clearHighlight(t,e,!0):(this.clearHighlight(T.HighlightType.ENTITY,e,!1),this.clearHighlight(T.HighlightType.FEATURE,e,!1),this.clearHighlight(T.HighlightType.PART,e,!1),this.clearHighlight(T.HighlightType.OCCURRENCE,e,!1),this.clearHighlight(T.HighlightType.UI,e,!0),this.clearHighlight(T.HighlightType.INCONTEXT_REFERENCE,e,!0))}clearIndividualHighlights(e,t,i){const s=this.selectionsToClearOnReset[t];if(!s)return;const n=Object.keys(s);for(let i=0;i<n.length;++i)this.processSelectionHighlight(T.Action.REMOVE,s[n[i]],t,e.type);i&&(this.selectionsToClearOnReset[t]={})}getOccurrencesStartingWithPath(e){const t=this.assemblies[this.displayedElementId];return t?t.getLeafOccurrencesContainedWithinOccurrence(e):[]}getOccurrenceBounds(e){const t=this.assemblies[this.displayedElementId];return t?(this.getSceneGraph().updateBounds(),t.getOccurrenceBounds(e)):null}setPlaneName(e,t,i){const s=this.getDisplayedPartStudio();s&&s.getElementId()===e&&(s.setPlaneName(t,i),(0,T.isUsageCompare)()||this.applyToPreview(this.setPlaneName,arguments))}setAddDerivedEntityHighlights(e){this.addDerivedEntityHighlights!==e&&(this.clearHighlights(),this.addDerivedEntityHighlights=e,this.refreshHighlight())}getAddDerivedEntityHighlights(){return this.addDerivedEntityHighlights}isActiveElementEditingInContext(){const e=this.partStudios[this.getDisplayedFullElementId()];return!!e&&e.isDisplayingIncontextAssembly()}isDisplayingIncontextAssembly(){const e=this.getDisplayedPartStudio();return!!e&&e.isDisplayingIncontextAssembly()}isolateAllPartStudioBodies(){const e=this.getDisplayedPartStudio();if(!e)return;const t=e.getPartStudioOccurrenceIds(),i=this.viewer.getIsolatedOccurrenceManager();this.isBase()?i.setIsolatedOccurrenceIds(t):i.addIdsToIsolate(t);const s=e.getAllMateConnectorGraphics(null).map((e=>e.getOccurrenceData().getOccurrenceId()));i.addIdsToIsolate(s),(0,T.setTransparencyTransition)(1),this.viewer.requestDraw()}clearIsolatedBodies(){this.viewer.getIsolatedOccurrenceManager().clearAllIsolateNoAnimation()}switchIsolateActiveElement(e){this.viewer.getIsolatedOccurrenceManager().switchActiveElement(e)}getModelStatistics(e,t=!1){const i={faces:0,triangles:0,edges:0,lines:0,vertices:0,silhouettes:0,settingCounts:{},uniqueParts:0,uniqueSurfaces:0,uniqueCurves:0,uniqueOpenComposites:0,uniqueClosedComposites:0,partOccurrences:0,surfaceOccurrences:0,curveOccurrences:0,openCompositeOccurrences:0,openCompositeConstituentOccurrences:0,closedCompositeOccurrences:0,closedCompositeConstituentOccurrences:0,bodiesPendingRetrieval:0,errors:[],veryFineParts:new Array,veryFineOccurrences:new Array};let s;for(s in this.partStudios){const n=this.partStudios[s].getStatistics(e,t);i.faces+=n.faces,i.triangles+=n.triangles,i.edges+=n.edges,i.lines+=n.lines,i.vertices+=n.vertices,i.silhouettes+=n.silhouettes,i.uniqueParts+=n.uniqueParts,i.uniqueSurfaces+=n.uniqueSurfaces,i.uniqueCurves+=n.uniqueCurves,i.uniqueOpenComposites+=n.uniqueOpenComposites,i.uniqueClosedComposites+=n.uniqueClosedComposites,i.partOccurrences+=n.partOccurrences,i.surfaceOccurrences+=n.surfaceOccurrences,i.curveOccurrences+=n.curveOccurrences,i.openCompositeOccurrences+=n.openCompositeOccurrences,i.openCompositeConstituentOccurrences+=n.openCompositeConstituentOccurrences,i.closedCompositeOccurrences+=n.closedCompositeOccurrences,i.closedCompositeConstituentOccurrences+=n.closedCompositeConstituentOccurrences,i.bodiesPendingRetrieval+=n.bodiesPendingRetrieval;for(const e in n.settingCounts){const t=i.settingCounts[e]||0;i.settingCounts[+e]=t+n.settingCounts[+e]}t&&(n.veryFineOccurrences.length&&(i.veryFineOccurrences=[...i.veryFineOccurrences,...n.veryFineOccurrences]),n.veryFineParts.size&&i.veryFineParts.push(n.veryFineParts)),n.errorMessage&&i.errors.push(n.errorMessage)}return i}removeSelectionHighlights(){const e=this;(0,h.getSelectionList)().each((function(t){e.processSelectionHighlight(T.Action.REMOVE,t,"selectionList")}))}reAddSelectionHighlights(){const e=this;(0,h.getSelectionList)().each((function(t){e.processSelectionHighlight(T.Action.ADD,t,"selectionList")}))}hideAssembly(e){const t=this.assemblies[e];t&&t.hide()}showAssembly(e,t){const i=this.assemblies[e];i&&i.show(t)}getInstantiatedTriangleCount(){let e=0;for(const t in this.partStudios)e+=this.partStudios[t].getInstantiatedTriangleCount();return e}showPartsWithSheetmetalModelIdOnly(e){const t=this.getDisplayedPartStudio();if(t&&(e||this.selectedSheetmetalModelId)&&(t.getBodyComponent(null).showPartsWithSheetmetalModelIdOnly(e),t.getSketchComponent().showPartsWithSheetmetalModelIdOnly(e),t.getImageComponent().showPartsWithSheetmetalModelIdOnly(e),t.getDimensionComponent().showDimensionsWithSheetmetalModelIdOnly(e,t)),this.selectedSheetmetalModelId!==e){this.selectedSheetmetalModelId=e;for(let e=0;e<this.selectionListsHandled.length;++e){const t=this.selectionListsHandled[e];this.resetSelectionListHighlights(t.selectionList,t.selectionListName,t.highlightType)}this.fitToSelectedSheetMetalModel(),this.viewer.getEventDispatcher().trigger(T.ACTIVE_SHEETMETAL_MODEL_CHANGED,e),this.viewer.requestDraw()}}fitToSelectedSheetMetalModel(){this.lastFitSheetMetalModelId===this.selectedSheetmetalModelId||this.viewer.isHidden()||!this.viewer.getPrimaryViewController()||(this.viewer.getPrimaryViewController().setStandardView(this.viewer.getDefaultStandardView()),this.viewer.setViewInitialized(!1),this.viewer.requestDraw(),this.lastFitSheetMetalModelId=this.selectedSheetmetalModelId)}hasSelectedSheetmetalModelId(){return!!this.selectedSheetmetalModelId}getSelectedSheetmetalModelId(){return this.selectedSheetmetalModelId}isBodyEntityMeasurable(e,t){const i=this.getDisplayedPartStudio();return!!i&&i.getBodyComponent(null).isEntityMeasurable(e,t)}needsDisplayData(e){let t=!1;for(const i in this.partStudios)e.elementId===this.partStudios[i].id&&(t=t||this.partStudios[i].getBodyComponent(null).needsDisplayData(e));return t}getOccurrenceSketchFeatureId(e){const t=this.getPartStudioDataFromOccurrence(e),i=this.viewer.getOccurrenceIdManager().getIdForName(e.getPathAsString());return t&&i!==T.INVALID_OCCURRENCE_ID?t.getSketchComponent().getFeatureIdForOccurrence(i):null}getDescriptionOfLastProcessedPartStudio(){return this.lastPartStudioProcessed+" : "+this.lastPartStudioMicroversionIdAndConfigurationIntervalProcessed}isOccurrenceIdForInContext(e){const t=this.getDisplayedPartStudio();if(t){const i=this.assemblies[t.getVisibleInContextAssemblyId()];if(i){const t=this.viewer.getOccurrenceIdManager().getNameForId(e);return!!i.getDisplayDataForOccurrencePath(t)}}return!1}hideEntityFromPick(e,t,i){const s=this.getPartStudioDataFromOccurrence(i);if(s){const i=this.viewer.getOccurrenceDataManager().getOccurrenceData(t);if(i){const t=s.getMeshManager().getIncrementDetails(e,s.getMeshOwnerId());t&&i.hideIncrementFromPick(t,this.usage)}}}hideBodyFromPick(e,t,i){const s=this.getPartStudioDataFromOccurrence(i);if(s){const i=this.viewer.getOccurrenceDataManager().getOccurrenceData(t);if(i){const t=s.getEntitiesForBody(e);for(let e=0;t&&e<t.length;++e){const n=s.getMeshManager().getIncrementDetails(t[e],s.getMeshOwnerId());n&&i.hideIncrementFromPick(n,this.usage)}}}}setDebugFaceTriangles(e){Object.values(this.partStudios).forEach((function(t){t.getBodyComponent().setDebugFaceTriangles(e)})),this.simulationManager&&this.simulationManager.setDebugMeshEdges(e)}clearSubFeaturesShownByParameters(){this.subFeaturesShownByParameters={}}getSubFeaturesShownByParameters(){return this.subFeaturesShownByParameters}collectComponentsForHeapDump(e){for(const t in this.partStudios)this.partStudios[t].collectComponentsForHeapDump(e);(0,T.resetStaticSilhouetteState)()}setExplodeViewActive(e){const t=this.getDisplayedAssembly();t&&t.setExplodeViewActive(e)}onStartEditingAssemblyFeature(e){const t=this.getDisplayedAssembly();t&&t.setEditState(e,!0)}onStopEditingAssemblyFeature(e){const t=this.getDisplayedAssembly();t&&t.setEditState(e,!1)}refreshSmoothEdgesForAllPartStudios(e){for(const t in this.partStudios){const i=this.partStudios[t],s=i.getBodyComponent();if(s&&(s.refreshSmoothEdges(),!e)){this.viewer.getSmoothEdgesRenderStyle()===d.GBTSmoothEdgeStyle.VISIBLE&&i.setIsMissingTangencyInformationMessageShown(!1);const e=this.getDisplayedPartStudio()===i;if(this.viewer.getSmoothEdgesRenderStyle()!==d.GBTSmoothEdgeStyle.VISIBLE&&s.hasDisplayedEdgesWithOutdatedSmoothnessInfo()){if(!e)return this.viewer.showTangencyInformationMissingMessage(),i.setIsMissingTangencyInformationMessageShown(!0),!1;this.updateSmoothEdgesForDisplayedPartStudio()}}}return!0}updateSmoothEdgesForDisplayedPartStudio(){this.viewer.getIsForFlattenedDisplay()||(this.isBase()?c.log.debug("Triggered smooth edge update from base viewer"):c.log.debug("Triggered smooth edge update from preview"),this.viewer.getEventDispatcher().trigger(T.RETRIEVE_SMOOTH_EDGE_INFORMATION))}processSmoothEdgeUpdate(e){for(let t=0;t<e.tangencyReponses.length;++t){const i=e.tangencyReponses[t],s=this.getPartStudio(i.source);s?s.getBodyComponent().updateEdgeSmoothness(i.edgeDeterministicIDToIsSmoothMap):c.log.warn("Part studio not found when applying smooth edge response")}this.refreshSmoothEdgesForAllPartStudios(!0),this.viewer.requestDraw()}onAppearanceConstantsUpdated(){for(const e of Object.values(this.partStudios))e.onAppearanceConstantsUpdated()}}t.ModelViewManager=v;t.ModelViewManagers=class{constructor(e,t){this.occurrenceDataManager=e,this.viewer=t,this.modelViewManagers={},this.lastPreviewedPartStudioId=null,(0,T.viewerCheck)(t),this.viewer.getEventDispatcher().on(T.SESSION_ENDED,(()=>{this.clearTheManagers()}))}getManager(){const e=T.BTGraphicsUsage.BASE;let t=this.modelViewManagers[e];return t||(t=new v(e,this.occurrenceDataManager,this.viewer),this.modelViewManagers[e]=t),t}clearTheManagers(){Object.values(this.modelViewManagers).forEach((function(e){e&&e.onDeletion()})),this.modelViewManagers={}}getManagerForUsage(e){return e===T.BTGraphicsUsage.BASE?this.getManager():e===T.BTGraphicsUsage.PREVIEW?this.getPreviewManager():null}getPreviewManager(e){const t=this.getManager().bodyLoadTasks,i=e?e.buildFullElementId(!0):null;if(!i||this.modelViewManagers[T.BTGraphicsUsage.PREVIEW]&&i.elementId===this.lastPreviewedPartStudioId){const e=this.modelViewManagers[T.BTGraphicsUsage.PREVIEW];return e&&t&&t.completeTasks(),e}{t&&t.completeTasks(),this.resetPreviewManager();const e=this.getManager().cloneForPreview(i);return this.modelViewManagers[T.BTGraphicsUsage.PREVIEW]=e,this.lastPreviewedPartStudioId=i.elementId,e}}previewManagerExists(){return null!==this.lastPreviewedPartStudioId&&!!this.modelViewManagers[T.BTGraphicsUsage.PREVIEW]}resetPreviewManager(){var e;this.viewer.getUiResourceManager().destroyPreviewGraphics(),this.viewer.getSceneGraphs().getPreviewSceneGraph().removeEverything(),this.modelViewManagers[T.BTGraphicsUsage.PREVIEW]&&this.modelViewManagers[T.BTGraphicsUsage.PREVIEW].onDeletion(),this.modelViewManagers[T.BTGraphicsUsage.PREVIEW]=null,this.lastPreviewedPartStudioId=null,this.getManager().onPreviewDestroyed(),this.viewer.getOccurrenceDataManager().onPreviewDestroyed(),null===(e=this.viewer.getCurvatureAnalysisManager())||void 0===e||e.onPreviewDestroyed()}onAppearanceConstantsUpdated(){for(const e of Object.values(this.modelViewManagers))null==e||e.onAppearanceConstantsUpdated()}}},754280:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getMouseSettingsManager=void 0;const s=i(375680),n=i(450798),r=i(114924),a=i(723617),o=i(997687);class c{constructor(){this.zoomScrollDirection=!1,this.viewManipulationMouseKeyMapping={},this.allowDefaultAxisRotationLock=!1,this.axisRotationLock=!1,this.mouseStringCodeMap={},this.keyStringCodeMap={},this.defaultReverseScrollWheelZoomDirection=!1,this.mouseStringCodeMap.LMB=s.MouseButton.LEFT,this.mouseStringCodeMap.MMB=s.MouseButton.MIDDLE,this.mouseStringCodeMap.RMB=s.MouseButton.RIGHT,this.keyStringCodeMap.CTRL=n.Keys.CONTROL,this.keyStringCodeMap.SHIFT=n.Keys.SHIFT,this.keyStringCodeMap.ALT=n.Keys.ALT,this.allowDefaultAxisRotationLock=o.btInjector.CapabilitiesService.checkAllowDefaultAxisRotationLockCurrentlyEnabled()}setMouseSettings(e){this.zoomScrollDirection=e.reverseScrollWheelZoomDirection,this.viewManipulationMouseKeyMapping=e.viewManipulationMouseKeyMapping,this.axisRotationLock=e.axisRotationLock,this.applyViewManipulationMouseKeyMapping()}getMouseButtons(e){const t=[];return e.forEach((function(e){this.mouseStringCodeMap.hasOwnProperty(e)&&t.push(this.mouseStringCodeMap[e])}),this),t}getKeyCodes(e){const t=[];return e.forEach((function(e){this.keyStringCodeMap.hasOwnProperty(e)&&t.push(this.keyStringCodeMap[e])}),this),t}applyViewManipulationMouseKeyMapping(){if(!this.viewManipulationMouseKeyMapping)return;const e=(0,r.viewManipulationSettingsGetManager)();e.clearMouseKeyManipulationBindings(),Object.keys(this.viewManipulationMouseKeyMapping).forEach((t=>{let i=r.ManipulationMode.NONE;switch(t){case"pan3DMapping":i=r.ManipulationMode.PAN;break;case"zoom3DMapping":i=r.ManipulationMode.ZOOM;break;case"rotate3DMapping":i=!0===this.axisRotationLock&&this.allowDefaultAxisRotationLock?r.ManipulationMode.AXIS_ROTATE:r.ManipulationMode.ROTATE;break;case"axisRotate3DMapping":i=!0===this.axisRotationLock&&this.allowDefaultAxisRotationLock?r.ManipulationMode.ROTATE:r.ManipulationMode.AXIS_ROTATE;break;default:i=r.ManipulationMode.NONE}if(i!==r.ManipulationMode.NONE){const s=this.viewManipulationMouseKeyMapping[t];for(let t=0;t<s.length;++t){const n=s[t],r=this.getMouseButtons(n.mouseButtons),o=this.getKeyCodes(n.keys);(0,a.isEmptyObjectOrArray)(r)&&(0,a.isEmptyObjectOrArray)(o)||e.addMouseKeyManipulationModeBinding(r,o,i)}}}))}isScrollZoomDefault(){return this.zoomScrollDirection===this.defaultReverseScrollWheelZoomDirection}}let l=null;t.getMouseSettingsManager=function(){return l||(l=new c),l}},474326:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.btTs=void 0;const s=i(736234),n=i(520498),r=i(114924),a=i(114924),o=i(114924),c=i(114924),l=i(114924),h=i(114924),d=i(114924),u=i(114924),g=i(114924),p=i(114924),m=i(114924),E=i(114924),I=i(114924),T=i(114924),S=i(114924),f=i(114924),C=i(114924),P=i(114924),v=i(114924),D=i(114924),M=i(114924),y=i(114924),O=i(114924),_=i(114924),A=i(114924),R=i(114924),N=i(114924),w=i(114924),b=i(114924),L=i(114924),B=i(114924),F=i(114924);var x;!function(e){!function(e){e.camera=d,e.frametimer=h,e.math=a,e.editstate=r,e.debugTools=o,e.eventdispatcher=c,e.utilities=(0,s.merge)({},l,{RetinaDisplayMode:F.RetinaDisplayMode},{pixelscaling:w}),e.viewcontroller=g,e.measurementdisplay=u,e.sectionplane=p,e.statistics=m,e.sketchdisplaydata=E,e.imagedisplay=I,e.sketchcomponent=T,e.splinehandle=S,e.zoomToWindowState=f,e.dimensions=C,e.coordinatesysteminference=P,e.triad=v,e.mateconnector=D,e.animationcontroller=M,e.occurrence=y,e.manipulators=O,e.idmanager=_,e.inferencepicker=A,e.mateindicator=R,e.viewerset=N,e.viewmanipulator=b,e.axes=L,e.inputhandler=B}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.getActiveViewer=F.getActiveViewer,e.viewerCheck=n.viewerCheck,e.getFocusedViewer=F.getFocusedViewer,e.getActiveViewerModelViewManagers=F.getActiveViewerModelViewManagers,e.retrieveViewportAsImage=F.retrieveViewportAsImage,e.getActiveViewerOccurrenceDataManager=F.getActiveViewerOccurrenceDataManager}(e.viewer||(e.viewer={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.setRefinementMode=F.setRefinementMode,e.RefinementMode=F.RefinementMode}(e.bodymanager||(e.bodymanager={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.View=F.View}(e.sketchinformation||(e.sketchinformation={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.PrimitiveType=F.PrimitiveType}(e.meshattr||(e.meshattr={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.EdgePoint=F.EdgePoint}(e.edgepoint||(e.edgepoint={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.Manager=F.DetailManager}(e.detail||(e.detail={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={})),function(e){!function(e){!function(e){e.visualizePicks=F.visualizePicks}(e.debug||(e.debug={}))}(e.graphics||(e.graphics={}))}(x||(t.btTs=x={}))},890082:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.OccurrenceData=void 0;const s=i(114924),n=i(723617),r=i(264292),a=new s.ChainedOperator;t.OccurrenceData=class{constructor(e,t){this.occurrenceId=e,this.shouldSetOccurrenceUniform=!0,this.isolated=!1,this.canIsolateChange=!0,this.cullingState=null,this.hiddenBaseMeshRanges=null,this.hiddenPreviewMeshRanges=null,this.hiddenFromPickBaseMeshRanges=null,this.hiddenFromPickPreviewMeshRanges=null,this.baseHighlights=null,this.previewHighlights=null,this.transform=r.mat4.create(),this.lod=s.Lod.DEFAULT,this.visibility=s.Visibility.VISIBLE,this.boundables=new Set,this.isClippedBySectionPlane=t}destroy(){this.hiddenBaseMeshRanges&&(this.hiddenBaseMeshRanges.destroy(),this.hiddenBaseMeshRanges=null),this.hiddenPreviewMeshRanges&&(this.hiddenPreviewMeshRanges.destroy(),this.hiddenPreviewMeshRanges=null),this.hiddenFromPickBaseMeshRanges&&(this.hiddenFromPickBaseMeshRanges.destroy(),this.hiddenFromPickBaseMeshRanges=null),this.hiddenFromPickPreviewMeshRanges&&(this.hiddenFromPickPreviewMeshRanges.destroy(),this.hiddenFromPickPreviewMeshRanges=null),this.baseHighlights&&(this.baseHighlights.destroy(),this.baseHighlights=null),this.previewHighlights&&(this.previewHighlights.destroy(),this.previewHighlights=null),this.boundables.clear()}onPreviewDestroyed(){this.hiddenPreviewMeshRanges&&(this.hiddenPreviewMeshRanges.destroy(),this.hiddenPreviewMeshRanges=null),this.hiddenFromPickPreviewMeshRanges&&(this.hiddenFromPickPreviewMeshRanges.destroy(),this.hiddenFromPickPreviewMeshRanges=null),this.previewHighlights&&(this.previewHighlights.destroy(),this.previewHighlights=null)}getOccurrenceId(){return this.occurrenceId}setShouldSetOccurrenceUniform(e){this.shouldSetOccurrenceUniform=e}getShouldSetOccurrenceUniform(){return this.shouldSetOccurrenceUniform}setTransform(e){(0,s.areMatricesEqual)(this.transform,e)||(this.transform=r.mat4.clone(e),this.damageBoundables())}getTransform(){return this.transform}setIsolated(e){this.canIsolateChange&&(this.isolated=e)}getIsolated(){return this.isolated}setCanIsolateChange(e){this.canIsolateChange=e}setLod(e){this.lod=e}getLod(){return this.lod}setVisibility(e){e!==this.visibility&&(this.visibility=e,this.damageBoundables())}getVisibility(){return this.visibility}getCullingState(){return this.cullingState}get culledMeshGroupIdSet(){const e=this.cullingState;return e&&e.size?e:null}setCullingState(e,t){if(!t)return void(this.cullingState=e);let i=this.culledMeshGroupIdSet;e===s.CullingState.CULLED?(i||(i=new Set,this.cullingState=i),i.add(t)):i&&(i.delete(t),0===i.size&&(this.cullingState=s.CullingState.VISIBLE))}getMeshGroupCullingState(e){if(this.cullingState===s.CullingState.VISIBLE||this.cullingState===s.CullingState.CULLED)return this.cullingState;const t=this.culledMeshGroupIdSet;return t&&t.has(e)?s.CullingState.CULLED:s.CullingState.VISIBLE}isStyledRangeCulled(e,t){const i=e.getMeshRangesGroupId();return this.isMeshGroupCulled(i,t)}isMeshGroupCulled(e,t){return this.cullingState!==s.CullingState.VISIBLE&&t.getUsage()===s.BTGraphicsUsage.BASE&&(this.cullingState===s.CullingState.CULLED||!!e&&this.getMeshGroupCullingState(e)===s.CullingState.CULLED)}isVisible(e){return!(this.cullingState===s.CullingState.CULLED&&e.getUsage()===s.BTGraphicsUsage.BASE)&&(e.isHighlighting()?this.hasHighlight():this.visibility===s.Visibility.VISIBLE)}isBoundable(){return this.visibility===s.Visibility.VISIBLE||this.hasHighlight()}isIncrementBoundable(e,t){const i=this.getHiddenRangesForUsage(t),s=this.getHighlightsForUsage(t),n=!!i&&i.containsIncrement(e),r=!!s&&s.entityHasHighlight(e);return!n||r}hasHighlight(){let e=!1;return this.baseHighlights&&(e=this.baseHighlights.hasHighlight()),this.previewHighlights&&(e=e||this.previewHighlights.hasHighlight()),e}getOrCreateHiddenRangesForUsage(e){return e===s.BTGraphicsUsage.BASE?(this.hiddenBaseMeshRanges||(this.hiddenBaseMeshRanges=new s.SubtractMeshRanges(this.occurrenceId+".hiddenBaseMeshRanges")),this.hiddenBaseMeshRanges):(this.hiddenPreviewMeshRanges||(this.hiddenPreviewMeshRanges=new s.SubtractMeshRanges(this.occurrenceId+".hiddenPreviewMeshRanges")),this.hiddenPreviewMeshRanges)}getHiddenRangesForUsage(e){return e===s.BTGraphicsUsage.BASE?this.hiddenBaseMeshRanges:this.hiddenPreviewMeshRanges}getOrCreateHiddenFromPickRangesForUsage(e){return e===s.BTGraphicsUsage.BASE?(this.hiddenFromPickBaseMeshRanges||(this.hiddenFromPickBaseMeshRanges=new s.SubtractMeshRanges(this.occurrenceId+".hiddenFromPickBaseMeshRanges")),this.hiddenFromPickBaseMeshRanges):(this.hiddenFromPickPreviewMeshRanges||(this.hiddenFromPickPreviewMeshRanges=new s.SubtractMeshRanges(this.occurrenceId+".hiddenFromPickPreviewMeshRanges")),this.hiddenFromPickPreviewMeshRanges)}getHiddenFromPickRangesForUsage(e){return e===s.BTGraphicsUsage.BASE?this.hiddenFromPickBaseMeshRanges:this.hiddenFromPickPreviewMeshRanges}hideIncrement(e,t){this.getOrCreateHiddenRangesForUsage(t).onIncrementAdded(e)&&this.damageBoundables()}showIncrement(e,t){const i=this.getHiddenRangesForUsage(t);i&&i.onIncrementRemoved(e)&&this.damageBoundables()}isIncrementHidden(e,t){const i=this.getHiddenRangesForUsage(t);return!!i&&i.containsIncrement(e)}hideIncrementFromPick(e,t){this.getOrCreateHiddenFromPickRangesForUsage(t).onIncrementAdded(e)}isIncrementHiddenFromPick(e,t){const i=this.getHiddenFromPickRangesForUsage(t);return!!i&&i.containsIncrement(e)}resetHiddenFromPick(){this.hiddenFromPickBaseMeshRanges&&(this.hiddenFromPickBaseMeshRanges.destroy(),this.hiddenFromPickBaseMeshRanges=null),this.hiddenFromPickPreviewMeshRanges&&(this.hiddenFromPickPreviewMeshRanges.destroy(),this.hiddenFromPickPreviewMeshRanges=null)}getOrCreateHighlightsForUsage(e){return e===s.BTGraphicsUsage.BASE?(this.baseHighlights||(this.baseHighlights=new s.OccurrenceHighlights),this.baseHighlights):(this.previewHighlights||(this.previewHighlights=new s.OccurrenceHighlights),this.previewHighlights)}getBaseOccurrenceHighlight(){return this.baseHighlights?this.baseHighlights.getHighestPriorityOccurrenceHighlight():null}getHighlightsForUsage(e){return e===s.BTGraphicsUsage.BASE?this.baseHighlights:this.previewHighlights}updateEntityHighlight(e,t,i,s){const n=this.hasHighlight();this.getOrCreateHighlightsForUsage(s).updateEntityHighlight(e,t,i),n!==this.hasHighlight()&&this.damageBoundables()}updateOccurrenceHighlight(e,t,i){const s=this.hasHighlight();this.getOrCreateHighlightsForUsage(i).updateOccurrenceHighlight(e,t),s!==this.hasHighlight()&&this.damageBoundables()}clearHighlight(e,t){const i=this.hasHighlight(),s=this.getHighlightsForUsage(t);s&&s.clearHighlight(e),i!==this.hasHighlight()&&this.damageBoundables()}clearAllOccurrenceLevelHighlights(){this.hasHighlight()&&(this.baseHighlights&&this.baseHighlights.clearAllOccurrenceLevelHighlights(),this.previewHighlights&&this.previewHighlights.clearAllOccurrenceLevelHighlights(),this.damageBoundables())}getEntityHighlights(e,t){const i=this.getHighlightsForUsage(t);return i?i.getEntityHighlights(e):null}removeEntityHighlights(e,t){const i=this.getHighlightsForUsage(t);i&&i.removeEntityHighlights(e)}getMeshRangeOperator(e){if(e.isHighlighting()){const t=this.getHighlightsForUsage(e.getUsage());return t?t.getHighlightOperator(e):s.NO_RANGE_OPERATOR}if(e.isPicking()){const t=this.getHiddenRangesForUsage(e.getUsage()),i=this.getHiddenFromPickRangesForUsage(e.getUsage());return i&&t?(a.resetWithOperands(t,i),a):t||i}{e.applyStyle(s.EMPTY_HIGHLIGHT_STYLE);const t=this.getHighlightsForUsage(e.getUsage()),i=this.getHiddenRangesForUsage(e.getUsage());return t?t.getHighlightStyleOperator(e,i):i}}addBoundable(e){this.boundables.add(e)}removeBoundable(e){this.boundables.delete(e)}damageBoundables(){for(const e of this.boundables.values())e.damageBounds()}makeSceneDebugObject(){const e="Occurrence "+this.occurrenceId,t=[];return t.push((0,s.createTextDebugObject)("transform",this.transform)),t.push((0,s.createTextDebugObject)("isolated",this.isolated)),t.push((0,s.createTextDebugObject)("clippedBySectionPlane",this.isClippedBySectionPlane)),t.push((0,s.createTextDebugObject)("lod",this.lod)),t.push((0,s.createTextDebugObject)("visibility",(0,s.visibilityDescriptor)(this.visibility))),t.push((0,s.createTextDebugObject)("cullingState",this.cullingState instanceof Set?Array.from(this.cullingState).toString():(0,n.getKeyForValue)(s.CullingState,this.cullingState))),t.push((0,s.createTextDebugObject)("shouldSetOccurrenceUniform",this.shouldSetOccurrenceUniform)),this.hiddenBaseMeshRanges&&t.push(this.hiddenBaseMeshRanges.makeSceneDebugObject()),this.hiddenPreviewMeshRanges&&t.push(this.hiddenPreviewMeshRanges.makeSceneDebugObject()),this.hiddenFromPickBaseMeshRanges&&t.push(this.hiddenFromPickBaseMeshRanges.makeSceneDebugObject()),this.hiddenFromPickPreviewMeshRanges&&t.push(this.hiddenFromPickPreviewMeshRanges.makeSceneDebugObject()),this.baseHighlights&&t.push(this.baseHighlights.makeSceneDebugObject("baseHighlights")),this.previewHighlights&&t.push(this.previewHighlights.makeSceneDebugObject("previewHighlights")),{text:e,children:t}}getIsClippedBySectionPlanes(){return this.isClippedBySectionPlane}setIsClippedBySectionPlanes(e){this.isClippedBySectionPlane=e}}},316654:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.DataManager=void 0;const s=i(114924),n=i(264292);t.DataManager=class{constructor(e){this.viewer=e,this.occurrenceData={},(0,s.viewerCheck)(e),this.getOrCreateOccurrenceData(s.PART_STUDIO_ELEMENT_ID)}destroy(){Object.values(this.occurrenceData).forEach((function(e){e.destroy()})),this.occurrenceData={},(0,s.resetSharedOperators)()}onPreviewDestroyed(){Object.values(this.occurrenceData).forEach((function(e){e.onPreviewDestroyed()}))}forEach(e){for(const t in this.occurrenceData)e(t,this.occurrenceData[t])}getOrCreateOccurrenceData(e){let t=this.occurrenceData[e];return t||(this.occurrenceData[e]=t=new s.OccurrenceData(+e,this.viewer.getIsExcludingItemsForSection())),t}getOccurrenceData(e){const t=this.occurrenceData[e];return t||null}destroyOccurrenceData(e){const t=this.occurrenceData[e];t&&(t.destroy(),delete this.occurrenceData[e])}setOccurrenceTransform(e,t){const i=this.getOrCreateOccurrenceData(e);return i.setTransform(t),this.viewer.requestDraw(),i}getOccurrenceTransform(e){const t=this.getOrCreateOccurrenceData(e);if(t)return t.getTransform();return n.mat4.create()}processHighlightForOccurrences(e,t,i,n){const r=this.viewer.getOccurrenceIdManager();for(let a=0;a<t.length;++a){const o=r.getIdForName(t[a].getPathAsString());o!==s.INVALID_OCCURRENCE_ID&&this.getOrCreateOccurrenceData(o).updateOccurrenceHighlight(e,i,n)}this.viewer.requestDraw()}clearHighlight(e,t){for(const i in this.occurrenceData){this.occurrenceData[i].clearHighlight(e,t)}this.viewer.requestDraw()}clearIsolation(){this.setAllIsolated(!1)}isolateAll(){this.setAllIsolated(!0)}setAllIsolated(e){for(const t in this.occurrenceData){this.occurrenceData[t].setIsolated(e)}this.viewer.requestDraw()}setOccurrenceIsolated(e,t){this.getOrCreateOccurrenceData(e).setIsolated(t),this.viewer.requestDraw()}resetHiddenFromPick(){for(const e in this.occurrenceData)this.occurrenceData[e].resetHiddenFromPick()}makeSceneDebugObject(){const e=[];return Object.values(this.occurrenceData).forEach((function(t){e.push(t.makeSceneDebugObject())})),{text:"Occurrence data",children:e}}}},844420:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioIsolateManager=void 0;const s=i(7401),n=i(905898),r=i(114924);class a extends r.PartStudioIsolateManagerBase{setUpListeners(){super.setUpListeners(),this.listenTo((0,n.getCommandDispatcher)(),s.commands.EXIT_ISOLATE,this.clearEffectExit),this.listenTo((0,n.getCommandDispatcher)(),s.commands.ISOLATE_PARTS,this.affectParts)}clearIsolateNoAnimation(){this.clearEffectNoAnimation()}hasIsolatedInstances(){return this.hasAffectedInstances()}areSelectionsAlreadyIsolated(e){return this.areSelectionsAlreadyAffected(e)}areSelectionsInListAlreadyIsolated(e){return this.areSelectionsInListAlreadyAffected(e)}isInIsolateMode(){return this.isInEffectMode()}addIdsToIsolate(e,t){this.addIdsToAffect(e,t)}removeFromIsolate(e){this.removeFromEffect(e)}isolateOccurrences(e,t){this.affectOccurrences(e,t)}getIsolatedOccurrences(){return this.getAffectedOccurrences()}setIsolatedOccurrenceIds(e){this.setAffectedOccurrenceIds(e)}clearEffect(){this.initialAffectedPartIds=[],this.setAffectedOccurrenceIds([]),this.setIsolatedPartMates(!1),this.initialAffectedSheetMetalIds=new Set}triggerExit(){(0,n.getCommandDispatcher)().trigger(s.commands.EXIT_ISOLATE,this.viewer)}shouldNotDoAnimation(){return this.hasAffectedInstances()}shouldClearOccurrenceIds(){return this.hasAffectedInstances()}refreshMateIsolation(e){this.setIsolatedPartMates(!1),this.setIsolatedPartMates(!0,e)}shouldAddPreexistingParts(){return!1}shouldAddSketchesToIsolate(){return!0}showDialog(){this.dialog?this.dialog.onAssemblyOrPartStudioDataProcessed():this.dialog=r.IsolatedManagersUtils.createIsolateDialog(this)}updateOccurrenceDataManager(){r.IsolatedManagersUtils.updateOccurrenceDataManager(this.affectedOccurrenceIds,this.viewer.getOccurrenceDataManager())}}t.PartStudioIsolateManager=a},723231:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioIsolateManagerBase=void 0;const s=i(681459),n=i(537321),r=i(193786),a=i(723617),o=i(114924),c=i(873896),l=i(196207);class h extends o.IsolatedManagerBase{constructor(){super(...arguments),this.initialAffectedPartIds=[],this.initialAffectedSheetMetalIds=new Set,this.affectedPartIds=[]}setUpListeners(){this.stopListening(),this.listenTo(this.viewer.getEventDispatcher(),o.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,this.onPartDataProcessed)}onPartDataProcessed(e){const t=e.elementId,i=l.DocumentController.getOpenDocumentController().getDeterministicIdMapper(t);this.initialAffectedPartIds=this.initialAffectedPartIds.map((t=>i.remapDetId(t,e.featureIdToOperationIndices))),this.isInEffectMode()&&(0,s.isInPartStudioElement)()&&this.reAffectParts(this.initialAffectedPartIds,o.IsolateFlag.PART_STUDIO_UPDATE,!1)}affectParts(e,t,i,s){this.viewer===t&&(s&&this.setIsIsolateFullyTransparentAsDefault(),this.reAffectParts(e.map((e=>e.id)),o.IsolateFlag.INITIAL,i))}clearEffectExit(e){const t=this.viewer.getModelViewManagers().getManager().isDisplayingIncontextAssembly();t?(this.clearEffectNoAnimation(),(0,o.getActiveViewerEventDispatcher)().trigger(o.UPDATE_INCONTEXT_ISOLATION,t)):(super.clearEffectExit(e),this.updateLaminarEdges())}clearEffectNoAnimation(){super.clearEffectNoAnimation(),this.updateLaminarEdges()}reAffectParts(e,t,i){this.shouldAddPreexistingParts()&&(e=(0,a.unionWithoutDuplicateValues)([...e,...this.initialAffectedPartIds],(e=>e))),t===o.IsolateFlag.INITIAL&&(this.initialAffectedSheetMetalIds=this.getSheetMetalIds(e,this.getModelViewManager()));let s=this.getAssociatedPartIdsFromSheetMetalIds(this.initialAffectedSheetMetalIds,this.getModelViewManager());this.getPreviewViewManager()&&(s=s.concat(this.getAssociatedPartIdsFromSheetMetalIds(this.initialAffectedSheetMetalIds,this.getPreviewViewManager()))),e=(0,a.unionWithoutDuplicateValues)([...e,...s],(e=>e));const n=this.getIndividualOccurrenceIdsFromPartIds(e);if(0===n.length)return void this.triggerExit();let c=!0;this.shouldNotDoAnimation()&&(c=!1),this.shouldClearOccurrenceIds()&&this.setAffectedOccurrenceIds([]);!(0,r.isSelectionFocused)()&&t!==o.IsolateFlag.PART_STUDIO_UPDATE&&!l.DocumentController.getOpenDocumentController().getActiveElementController().getViewAlignmentController().isSectionViewDialogVisible()&&((0,r.clearSelection)(),(0,r.clearPreSelection)()),t!==o.IsolateFlag.INITIAL&&t!==o.IsolateFlag.PART_STUDIO_UPDATE||(this.initialAffectedPartIds=e,this.centersOfInitialAffectedInstances=null),this.affectedPartIds=e,this.refreshMateIsolation(this.affectedPartIds),this.affectPartOccurrenceIds(n,t,c,i)}getSheetMetalIds(e,t){const i=t.getDisplayedPartStudio(),s=new Set;return e.forEach((e=>{const t=i.retrieveBodyMetaData(e);t&&t.sheetMetalModelId&&s.add(t.sheetMetalModelId)})),s}getAssociatedPartIdsFromSheetMetalIds(e,t){const i=t.getDisplayedPartStudio(),s=[];for(const t in i.bodyComponent.bodyMetaData){const n=i.bodyComponent.bodyMetaData[t];n.sheetMetalModelId&&e.has(n.sheetMetalModelId)&&s.push(t)}return s}setIsolatedPartMates(e,t){const i=this.getModelViewManager().getDisplayedPartStudio();if(i){const s=i.getAllMateConnectorGraphics(null).filter((e=>""!==e.definition.partId));this.isolateMateConnectors(s,this.getModelViewManager(),e,t)}const s=this.getPreviewViewManager();if(s){const i=s.getDisplayedPartStudio();if(i){const n=i.getAllMateConnectorGraphics(null).filter((e=>""!==e.definition.partId));this.isolateMateConnectors(n,s,e,t)}}}isolateMateConnectors(e,t,i,s){if(s){const n=this.getIndividualPartIds(s,t),r=t.getDisplayedPartStudio();e.forEach((e=>{let t=e.definition.partId;const s=r.retrieveBodyMetaData(t);s&&s.consumingClosedCompositeData&&(t=s.consumingClosedCompositeData.id),n.has(t)&&e.getOccurrenceData().setIsolated(i)}))}else e.forEach((e=>{e.getOccurrenceData().setIsolated(i)}))}shouldAddSketchesToEffect(){return!0}updateLaminarEdges(){const e=this.viewer.getFilteredEntitiesHighlightController();e&&e.updateSetOfFilteredEntities()}affectPartOccurrenceIds(e,t,i,s){0!==e.length?(this.shouldAddSketchesToEffect()&&e.push(this.getModelViewManager().getDisplayedPartStudio().getSketchComponent().sketchComponentElementId),this.hasAffectedInstances()&&this.setAffectedOccurrenceIds([]),this.addIdsToAffect(e,!0),this.refreshMateIsolation(this.affectedPartIds),this.makeTransparent(i,s),(t===o.IsolateFlag.INITIAL||t===o.IsolateFlag.PART_STUDIO_UPDATE&&this.isInEffectMode())&&this.showDialog(),this.updateLaminarEdges()):this.triggerExit()}getIndividualOccurrenceIdsFromPartIds(e){const t=[],i=this.getIndividualPartIds(e,this.getModelViewManager()),s=this;return i.forEach((e=>{const i=s.getOccurrenceIdFromPartId(e);i&&t.push(i)})),t}getIndividualPartIds(e,t){const i=t.getDisplayedPartStudio(),s=new Set;return e.forEach((e=>{const t=i.retrieveBodyMetaData(e);t&&(t.isComposite&&!t.isGroupableCompositeBody?t.constituentBodyIds.forEach((e=>{s.add(e)})):s.add(e))})),s}getOccurrenceIdFromPartId(e){const t=this.getModelViewManager().getDisplayedPartStudio().getBodyComponent().getBodyOccurrenceData(e);if(t){const e=t.getOccurrenceId();if(e&&e!==o.INVALID_OCCURRENCE_ID)return e}return null}areSelectionsAlreadyAffected(e){if((0,s.isInPartStudioElement)()){const t=h.getSelectedParts(e,this.viewer);return this.arePartsAlreadyAffected(t)}return!1}areSelectionsInListAlreadyAffected(e){const t=this.viewer.getModelViewManagers().getManager().getDisplayedPartStudio().id;if((0,s.isInPartStudioElement)()){const i=(0,r.getPartModelsFromListOfSelections)(t,e);return this.arePartsAlreadyAffected(i)}return!1}arePartsAlreadyAffected(e){const t=e.map((e=>e.id));return(0,a.hasEquivalentValues)(t,this.initialAffectedPartIds,(e=>e))}static getSelectedParts(e,t){const i=o.IsolatedOccurrencesManager.getSelectionFromNodeModelOrSelection(e,t),s=t.getModelViewManagers().getManager().getDisplayedPartStudio();if(!s)return[];const a=s.getElementId();let c;return i&&(c=n.PartList.getPartModelFromPartId(i.getPartId(),a)),(0,r.getSelectedAndAssociatedPartModels)(a,c)}updateCentersOfInitialAffectedInstances(){if(!this.centersOfInitialAffectedInstances){const e=[];this.initialAffectedPartIds.forEach((t=>{const i=this.getModelViewManager().getBodyBounds(t,null);i&&e.push(i.center())})),this.centersOfInitialAffectedInstances=e.filter(a.isDefined,this)}}expandEffectByProximity(e){let t=this.getAffectedPartIdsForExpandEffectByProximity(e,this.getModelViewManager(),!1),i=this.getIndividualOccurrenceIdsFromPartIds(t);const s=this.getPreviewViewManager();if(s){const n=this.getAffectedPartIdsForExpandEffectByProximity(e,s,!0),r=s.getDisplayedPartStudio().getBodyComponent(),o=[];n.forEach((e=>{const t=r.getBodyOccurrenceData(e);t&&o.push(t.getOccurrenceId())})),t=(0,a.unionWithoutDuplicateValues)([...t,...n],(e=>e)),i=(0,a.unionWithoutDuplicateValues)([...i,...o],(e=>e+"")),i=i.concat(this.getAffectedOwnerlessMatesOccurrenceIdsByProximity(e,s))}this.affectedPartIds=t,this.affectPartOccurrenceIds(i,o.IsolateFlag.EXPAND,!1,!1)}getAffectedOwnerlessMatesOccurrenceIdsByProximity(e,t){if(Math.abs(e)<=c.Tolerances.ZERO_LENGTH)return[];const i=[],s=t.getDisplayedPartStudio().getAllMateConnectorGraphics(null).filter((e=>""===e.definition.partId)),n=e*e;for(const e of s)this.isPointWithinDistanceOfInitialAffectedInstances(e.worldSpacePosition,n)&&i.push(e.getOccurrenceData().getOccurrenceId());return i}getAffectedPartIdsForExpandEffectByProximity(e,t,i){const s=this.getAssociatedPartIdsFromSheetMetalIds(this.initialAffectedSheetMetalIds,t);if(!i&&Math.abs(e)<=c.Tolerances.ZERO_LENGTH)return(0,a.unionWithoutDuplicateValues)([...this.initialAffectedPartIds,...s],(e=>e));this.updateCentersOfInitialAffectedInstances();const n=t.getDisplayedPartStudio().getBodyComponent(),r=[],o=e*e;for(const e in n.partStudioBodyIdToOccurrenceId)this.isWithinDistanceOfAnInitialIsolatedPart(o,e,null,t)&&r.push(e);const l=this.getSheetMetalIds(r,t),h=this.getAssociatedPartIdsFromSheetMetalIds(l,t);return(0,a.unionWithoutDuplicateValues)([...r,...this.initialAffectedPartIds,...h,...s],(e=>e))}isWithinDistanceOfAnInitialIsolatedPart(e,t,i,s){const n=s.getBodyBounds(t,i);return!!n&&this.isBoundsWithinDistanceOfInitialAffectedInstances(n,e)}}t.PartStudioIsolateManagerBase=h},83965:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PartStudioMakeTransparentManager=void 0;const s=i(859589),n=i(905898),r=i(7401),a=i(114924);class o extends a.PartStudioIsolateManagerBase{constructor(e,t,i,s){super(e,t),this.affectParts(i,s)}getTransparentOccurrences(){return this.getAffectedOccurrences()}areSelectionsAlreadyTransparent(e){return this.areSelectionsAlreadyAffected(e)}areSelectionsInListAlreadyTransparent(e){return this.areSelectionsInListAlreadyAffected(e)}hasTransparentInstances(){return this.hasAffectedInstances()}clearTransparentNoAnimation(){this.clearEffectNoAnimation()}setUpListeners(){super.setUpListeners(),this.listenTo((0,n.getCommandDispatcher)(),r.commands.MAKE_TRANSPARENT_PARTS,this.affectParts),this.listenTo((0,n.getCommandDispatcher)(),r.commands.EXIT_MAKE_TRANSPARENT,this.clearEffectExit)}showDialog(){if(this.dialog)this.dialog.onAssemblyOrPartStudioDataProcessed();else{const e={isolateManager:this};this.dialog=new s.MakeTransparentDialog(e)}}clearEffect(){this.viewer.getOccurrenceDataManager().clearIsolation(),this.isolatedOccurrencesManager.removeMakeTransparentManager(),this.updateLaminarEdges()}updateOccurrenceDataManager(){if(0===this.affectedOccurrenceIds.length){let e=this.getModelViewManager().getDisplayedPartStudio().getPartStudioOccurrenceIds();this.getPreviewViewManager()&&(e=e.concat(this.getPreviewViewManager().getDisplayedPartStudio().getPartStudioOccurrenceIds())),e.forEach((e=>{e!==a.INVALID_OCCURRENCE_ID&&this.viewer.getOccurrenceDataManager().setOccurrenceIsolated(e,!0)}))}else this.affectedOccurrenceIds.forEach((e=>{e!==a.INVALID_OCCURRENCE_ID&&this.viewer.getOccurrenceDataManager().setOccurrenceIsolated(e,!1)}))}refreshMateIsolation(e){this.setIsolatedPartMates(!0),this.setIsolatedPartMates(!1,e)}triggerExit(){(0,n.getCommandDispatcher)().trigger(r.commands.EXIT_MAKE_TRANSPARENT,this.viewer)}shouldAddPreexistingParts(){return!0}shouldAddSketchesToEffect(){return!1}shouldNotDoAnimation(){return this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances()}shouldClearOccurrenceIds(){return!0}}t.PartStudioMakeTransparentManager=o},810972:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Pick=t.PickPriority=void 0;const s=i(550122),n=i(193786),r=i(912057),a=i(606544),o=i(264292),c=i(613199);var l;!function(e){e[e.UNKNOWN=-10]="UNKNOWN",e[e.REDUCED_DIMENSION_PRIORITY=-1]="REDUCED_DIMENSION_PRIORITY",e[e.CONSTRUCTION_PLANE=0]="CONSTRUCTION_PLANE",e[e.CONSTRUCTION_PLANE_EDGE=1]="CONSTRUCTION_PLANE_EDGE",e[e.PART_FACE=5]="PART_FACE",e[e.NON_MODIFIABLE_FACE=7]="NON_MODIFIABLE_FACE",e[e.NON_MODIFIABLE_EDGE=8]="NON_MODIFIABLE_EDGE",e[e.NON_MODIFIABLE_VERTEX=9]="NON_MODIFIABLE_VERTEX",e[e.SKETCH_FACE=10]="SKETCH_FACE",e[e.ORIGIN=15]="ORIGIN",e[e.SECTION_PLANE=16]="SECTION_PLANE",e[e.PART_EDGE=20]="PART_EDGE",e[e.POINT_BODY=25]="POINT_BODY",e[e.PART_VERTEX=30]="PART_VERTEX",e[e.DIMENSION=45]="DIMENSION",e[e.MATE_CONNECTOR=46]="MATE_CONNECTOR",e[e.DEGENERATE_SKETCH_EDGE=47]="DEGENERATE_SKETCH_EDGE",e[e.SKETCH_EDGE=50]="SKETCH_EDGE",e[e.SKETCH_VERTEX=60]="SKETCH_VERTEX",e[e.UI=70]="UI"}(l||(t.PickPriority=l={}));t.Pick=class{constructor(e,t,i,s){this.occurrenceId=t,this.location=i,this.usage=s,this.deterministicId=null,this.partId=null,this.locationCount=1,this.locationsSinceSample=0,this.distance=1,this.coverage=0,this.fromPass=0,this.entityMetaData=null,this.bodyMetaData=null,this.uiSelection=null,this.occurrence=null,this.featureIdList=null,this.isPickThrough=null,this.primitiveId=e.slice(0),this.locationSum=o.vec2.clone(i),this.locationSamples=[this.location],this.pickedOccurrenceId=t}incorporateLocation(e){c.vec2C.add(this.locationSum,e,this.locationSum),++this.locationCount;const t=this.locationSamples.length<10?5:this.locationSamples.length<20?50:500;this.locationsSinceSample>=t?(this.locationSamples.push(e),this.locationsSinceSample=0):++this.locationsSinceSample}determineBestLocation(){const e=c.vec2C.scale(this.locationSum,1/this.locationCount,o.vec2.create());let t=1/0;for(let i=0;i<this.locationSamples.length;++i){const s=c.vec2C.distanceSquared(e,this.locationSamples[i]);s<t&&(this.location=this.locationSamples[i],t=s)}}isUIPick(){return!!this.uiSelection}getUISelection(){return this.uiSelection?this.uiSelection.uiElement:null}isEntityPick(){return!!this.entityMetaData}isBodyPick(){return!!this.bodyMetaData}isModelPick(){return this.isBodyPick()||this.isEntityPick()}getBodyId(){return this.bodyMetaData?this.bodyMetaData.id:this.entityMetaData?this.entityMetaData.getBodyId():null}getOccurrence(){return this.occurrence}getId(){return this.primitiveId+s.ID_SEPARATOR+this.occurrenceId}getModelSelection(){if(this.isEntityPick())return new n.Selection(a.GBTUiSelectionType.ENTITY,this.deterministicId,this.occurrence,{entityMetaData:this.entityMetaData,source:n.Source.PICK,sourcePick:this,usage:this.usage,featureIdList:this.featureIdList,name:this.entityMetaData.getName()});if(this.isBodyPick())return new n.Selection(a.GBTUiSelectionType.BODY,this.deterministicId,this.occurrence,{bodyMetaData:this.bodyMetaData,source:n.Source.PICK,sourcePick:this,usage:this.usage,name:this.bodyMetaData.getName()});const e=this.isUIPick()?this.uiSelection.getModelSelection():null;return e&&(e.sourcePick||(e.sourcePick=this),e.source=n.Source.PICK,e.usage=this.usage),e}getPickPriority(){if(this.isUIPick()){const e=this.uiSelection.getPickPriority();return null!==e?e:l.UI}if(this.entityMetaData){if(this.entityMetaData.isFromOrigin())return l.ORIGIN;if(this.entityMetaData.isPointEntity())return l.POINT_BODY;if(this.entityMetaData.isFromSketch())return this.entityMetaData.isFace()?l.SKETCH_FACE:this.entityMetaData.isEdge()?l.SKETCH_EDGE:this.entityMetaData.isDegenerateEdge()?l.DEGENERATE_SKETCH_EDGE:l.SKETCH_VERTEX;if(this.entityMetaData.isFromBody())return this.entityMetaData.getBodyMetaData()&&!this.entityMetaData.getBodyMetaData().isModifiableBody()?this.entityMetaData.isFace()?l.NON_MODIFIABLE_FACE:this.entityMetaData.isEdge()?l.NON_MODIFIABLE_EDGE:l.NON_MODIFIABLE_VERTEX:this.entityMetaData.isFace()?l.PART_FACE:this.entityMetaData.isEdge()?l.PART_EDGE:l.PART_VERTEX}return l.UNKNOWN}getIncrementId(){if(this.isModelPick()){if(this.deterministicId)return this.deterministicId;r.log.warn("Found a model pick without a valid entity id")}else{if(this.uiSelection)return this.uiSelection.meshIncrementId;if(this.primitiveId)return this.primitiveId.toString();r.log.warn("Found a pick without an owner from which to retrieve an increment id")}return""}getEntityMetaData(){if(this.entityMetaData)return this.entityMetaData;const e=this.getModelSelection();return e?e.getEntityMetaData():null}getDeterministicId(){if(this.deterministicId)return this.deterministicId;const e=this.getModelSelection();return e?e.getDeterministicId():""}setIsPickThrough(e){this.isPickThrough=e}canPickThrough(e,t,i){if(i&&i.pickHiddenOccurrences&&t.isPickFromHiddenOccurrence(this))return!0;if(null===this.isPickThrough)if(this.uiSelection)this.isPickThrough=this.uiSelection.canPickThrough();else{const s=this.getEntityMetaData();if(s){let n=s.isTranslucent();if(!!i&&i.altKey&&s.isFromBody()&&s.isFace()){const e=t.getModelViewManagers().getManagerForUsage(this.usage).getPartStudioDataFromOccurrence(this.occurrence).getBodyComponent().getFaceColor(this.deterministicId,this.occurrenceId);n=!!e&&e[3]<1}this.isPickThrough=n&&e!==a.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED||s.isFromSketch()}else this.isPickThrough=!1}return this.isPickThrough}getOccurrenceId(){return this.occurrenceId}}},123085:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.pickSortWithTranslucency=t.basicPickSort=void 0;const s=i(193786),n=i(810972);function r(e,t){if(!e&&!t)return 0;if(e&&!t)return-1;if(!e&&t)return 1;const i=e.getPickPriority(),r=t.getPickPriority();if(i>r)return-1;if(i<r)return 1;if(i!==n.PickPriority.SKETCH_VERTEX){if(e.fromPass<t.fromPass)return-1;if(e.fromPass>t.fromPass)return 1}const a=(1+e.distance)*(1-e.coverage),o=(1+t.distance)*(1-t.coverage);if(a<o)return-1;if(a>o)return 1;if(i===n.PickPriority.SKETCH_VERTEX&&e.deterministicId&&t.deterministicId){const i=s.SelectionMapper.unpackDetId(e.deterministicId),n=s.SelectionMapper.unpackDetId(t.deterministicId);if(i.operationIdx<n.operationIdx)return-1;if(i.operationIdx>n.operationIdx)return 1;if(i.entityIdx<n.entityIdx)return-1;if(i.entityIdx>n.entityIdx)return 1}return 0}t.basicPickSort=r,t.pickSortWithTranslucency=function(e,t){return e.sort(((e,i)=>{const s=e.getModelSelection(),n=i.getModelSelection();if(!s||!n)return r(e,i);if(s.isPlane()||n.isPlane())return r(e,i);if(s.isFace()!==n.isFace())return r(e,i);const a=t(e);return a===t(i)?r(e,i):a?1:-1}))}},854747:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.PointElement=void 0;const s=i(264292),n=i(114924),r=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isPickable:!1,isShowThrough:!0,isDepthTested:!1});class a extends n.UIElement{constructor(e,t,i,s,a,o){super(a,t),this.position=e,this.increment=(0,n.createPoint)([0,0,0],"point",i,s),this.updatePosition(e),this.nodeProperties=r,o&&(this.nodeProperties=o),this.updateGraphics()}updatePosition(e){if(e){this.position=e;const t=s.mat4.create();t[12]=this.position[0],t[13]=this.position[1],t[14]=this.position[2],this.setTransform(t)}}setStyle(e){(0,n.addStyleToIncrement)(e,this.increment),this.updateGraphics()}updateGraphics(){this.updateMeshIncrement(a.INCREMENT_ID,"pointElementSelection",this.increment,this.nodeProperties)}addHighlight(e){super.addHighlight(e),this.addHighlightToIncrement("pointElement",e),this.highlight=e}removeHighlight(e){return!!e&&(this.removeHighlightFromIncrement("pointElement",e),!!super.removeHighlight(e))}}t.PointElement=a,a.INCREMENT_ID="pointElement"},821848:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Quad=void 0;const s=i(114924);class n extends s.UIElement{constructor(e,t,i,n,r,a){super(r,a);const o=(0,s.createQuad)(e,t,i);this.updateMeshIncrement("quad",s.NO_SELECTION_ID,o,n)}}t.Quad=n},859528:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.spliceRangesFromArray=t.removeRange=t.insertRangeStartEnd=t.insertRange=t.binarySearchRanges=void 0;const s=i(912057);function n(e,t,i,s,n){let r,a=t;for(;t!==i;)if(a=Math.floor(.5*(t+i)),r=e[a][s],n>r)a=t=a+1;else{if(!(n<r))break;i=a}return a}function r(e,t){if(t.length<1)t.push(e.slice(0));else{const i=n(t,0,t.length,0,e[0]);let s=!1,r=0,a=e[1];i>0&&t[i-1][1]>=e[0]&&(s=!0,a=Math.max(a,t[i-1][1]));for(let s=i;s<t.length&&t[s][0]<=e[1];++s)++r,a=Math.max(a,t[s][1]);s?(t[i-1][1]=a,t.splice(i,r)):t.splice(i,r,[e[0],a])}}t.binarySearchRanges=n,t.insertRange=r;const a=[0,1];t.insertRangeStartEnd=function(e,t,i){a[0]=e,a[1]=t,r(a,i)},t.removeRange=function(e,t){if(e[0]===e[1])return;const i=n(t,0,t.length,1,e[0]),r=n(t,i,t.length,0,e[1]);if(i>=t.length||i===r)return void s.log.warn("Failed to find range to remove");let a=null,o=null;t[i][0]<e[0]&&(a=[t[i][0],e[0]]),t[r-1][1]>e[1]&&(o=[e[1],t[r-1][1]]),a&&o?t.splice(i,r-i,a,o):a?t.splice(i,r-i,a):o?t.splice(i,r-i,o):t.splice(i,r-i)},t.spliceRangesFromArray=function(e,t){let i=0;for(let s=0;s<t.length;++s){const n=t[s],r=n[0]-i,a=n[1]-n[0];e.splice(r,a),i+=a}}},371339:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RenderContext=t.INVALID_FRAME_ID=void 0;const s=i(114924),n=i(545348),r=i(142885),a=i(997687),o=i(912057),c=i(606544),l=i(32620),h=i(264292),d=n.default.getManager(),u="uViewport",g="uBlitTextureOffset";t.INVALID_FRAME_ID=-1;const p=[0,0],m=[1,1];let E=!1;class I extends r.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.MAXIMUM_Z_OFFSET=d.getNumber("MAXIMUM_Z_OFFSET"),this.activeShader=null,this.shaderStack=[],this.modelViewMatrixStack=[],this.projectionMatrixStack=[],this.viewport=[0,0,1,1],this.viewportStack=[],this.materialPushedShaderStack=[!1],this.activePass=null,this.lastPolygonOffsetFactor=NaN,this.lastPolygonOffsetUnits=NaN,this.overridePolygonOffset=!1,this.lastCullFace=null,this.pickBackFaces=!1,this.pickPrimitiveAlternates=!1,this.baseHighlightsEnabled=!0,this.activeCamera=null,this.isPickingHiddenOccurrences=!1,this.useHiddenOpacityForEdgeHighlights=!1,this.frameId=0,this.lastBufferBound=null,this.lastStyleApplied=new s.Style,this.hasIsolate=!1,this.nodeOccurrenceFilterFunction=null,this.isWebXrEnabled=!1,(0,s.viewerCheck)(e),this.state=new s.State,this.modelViewMatrix=h.mat4.create(),this.projectionMatrix=h.mat4.create(),this.materialStack=[s.DEFAULT_MATERIAL],this.overrideFaceCullingMode=s.CullFace.UNSPECIFIED,this.renderingMode=c.GBTGraphicsRenderMode.SHADED_WITH_EDGES,this.detailSettings=new s.Settings,this.listenTo(this.viewer.getEventDispatcher(),s.GL_CONTEXT_LOST,this.onGlContextLost),this.listenTo(this.viewer.getEventDispatcher(),s.DEVICE_PIXEL_RATIO_CHANGED,this.onDevicePixelRatioChanged),a.btInjector.CapabilitiesService.isWebxrEnabled().then((e=>{this.isWebXrEnabled=e}))}onNewContext(e){this.state.setGlContext(e),this.setFacesToCull(s.CullFace.BACK)}onDevicePixelRatioChanged(e){if(this.activeShader){const e=(0,l.getDevicePixelRatio)();this.activeShader.uniform1f("uDevicePixelRatio",e)}}destroy(){this.stopListening()}onGlContextLost(){this.activeShader=null}setOccurrencePickId(e){this.activeShader&&this.activeShader.uniform4fv("uOccurrencePickId",e)}getViewer(){return this.viewer}setActiveCamera(e){this.activeCamera=e}getActiveCamera(){return this.activeCamera}getState(){return this.state}pushModelViewMatrix(e){this.modelViewMatrixStack.push(this.modelViewMatrix),this.modelViewMatrix=e}getModelViewMatrix(){return this.modelViewMatrix}popModelViewMatrix(){0!==this.modelViewMatrixStack.length?this.modelViewMatrix=this.modelViewMatrixStack.pop():o.log.warn("Tried to pop modelview matrix from stack with zero length")}updateModelviewUniforms(){const e=this.activeShader;e&&e.uniformMatrix4fv("uMVMatrix",!1,this.modelViewMatrix)}pushProjectionMatrix(e){this.projectionMatrixStack.push(this.projectionMatrix),this.projectionMatrix=e,this.updateProjectionUniforms()}updateProjectionUniforms(){this.activeShader&&(this.activeShader.uniformMatrix4fv("uPMatrix",!1,this.projectionMatrix),this.activeShader.uniformMatrix4fv("uPMatrix_fs",!1,this.projectionMatrix))}getProjectionMatrix(){return this.projectionMatrix}popProjectionMatrix(){0!==this.projectionMatrixStack.length?(this.projectionMatrix=this.projectionMatrixStack.pop(),this.updateProjectionUniforms()):o.log.warn("Tried to pop projection matrix from stack with zero length")}updateViewportUniforms(){const e=this.getActiveShader();if(e&&e.getUniformLocation(u)&&e.uniform4fv(u,this.viewport),e&&e.getUniformLocation(g)){let t=p,i=m;this.isWebXrEnabled&&!this.isCustomViewportActive&&(t=h.vec2.fromValues(this.viewport[0]/this.viewer.getBaseFrameBufferWidth(),this.viewport[1]/this.viewer.getBaseFrameBufferHeight()),i=h.vec2.fromValues(this.viewport[2]/this.viewer.getBaseFrameBufferWidth(),this.viewport[3]/this.viewer.getBaseFrameBufferHeight())),e.uniform2fv(g,t),e.uniform2fv("uBlitTextureScale",i)}}setViewport(e){this.viewport=e,this.viewer.getGlContext().viewport(e[0],e[1],e[2],e[3]),this.updateViewportUniforms()}pushViewport(e){this.viewportStack.push(this.viewport),this.setViewport(e)}getViewport(){return this.viewport}popViewport(){if(0===this.viewportStack.length)return void o.log.warn("Tried to pop viewport from stack with zero length");const e=this.viewportStack.pop();this.setViewport(e)}get isCustomViewportActive(){return this.viewportStack.length>1}activateShader(e,t){if((null===this.activeShader||!this.activeShader.equals(e))&&(this.activeShader&&this.activeShader.deactivate(),this.lastBufferBound=null,this.defaultStyle=null,this.lastStyleApplied.clear(),this.activeShader=e,t||(this.shaderStack=[this.activeShader]),null!==this.activeShader)){this.lastNormalMatrixComputed=null,this.activeShader.useShader(),this.updateProjectionUniforms(),this.updateModelviewUniforms(),this.updateViewportUniforms();const e=[0,0,0,0],t=[0,0,0,-1],i=[0,0,0,0];this.activeShader.vertexAttrib4fv(s.AttributeNames.COLOR,t),this.activeShader.vertexAttrib4fv(s.AttributeNames.HIGHLIGHT_ID,e),this.activeShader.vertexAttrib4fv(s.AttributeNames.PRIMITIVE_STYLE,i),this.activeShader.vertexAttrib1f(s.AttributeNames.OCCURRENCE_ID,0),this.activeShader.uniform2fv("uHighlightPointFont",d.getPointFont("HIGHLIGHT_POINT_FONT")),this.activeShader.uniform1f("uHighlightPointSizeMin",d.getNumber("HIGHLIGHT_POINT_SIZE_MIN_PX")),this.activeShader.uniform1f("uHighlightPointSizeScale",d.getNumber("HIGHLIGHT_POINT_SIZE_SCALE")),this.activeShader.uniform4fv("uHighlightLineStipple",d.getStipple("HIGHLIGHT_LINE_STIPPLE")),this.activeShader.uniform1f("uHighlightLineWidthMin",d.getNumber("HIGHLIGHT_LINE_WIDTH_MIN_PX")),this.activeShader.uniform1f("uHighlightLineWidthScale",d.getNumber("HIGHLIGHT_LINE_WIDTH_SCALE")),this.activeShader.uniform1f("uHighlightCount",this.viewer.getReferenceHighlights().sortedHighlights.length);const n=(0,l.getDevicePixelRatio)();this.activeShader.uniform1f("uDevicePixelRatio",n),this.activePass.onShaderActivated(this,this.activeShader)}}getActiveShader(){return this.activeShader}pushShader(e){this.shaderStack.push(e)}activateTopShader(){this.shaderStack.length>0&&this.activateShader(this.shaderStack[this.shaderStack.length-1],!0)}popShader(){0!==this.shaderStack.length?this.shaderStack.pop():o.log.warn("Tried to pop a shader off of an empty stack")}getExtendedShaderForMaterial(e){const t=e.getExtendedShaderId();if(!t)return null;const i=this.shaderStack.length>0?this.shaderStack[this.shaderStack.length-1]:this.activeShader,n=(0,s.getShaderIdWithExtension)(i.getId(),t);return(0,s.shaderExistsForId)(n)?this.viewer.getShader(n):null}pushMaterial(e){this.materialStack.push(e);const t=this.getExtendedShaderForMaterial(e);t&&this.pushShader(t),this.materialPushedShaderStack.push(!!t)}setMaterial(){this.activeShader&&this.materialStack&&this.materialStack.length>0&&this.materialStack[this.materialStack.length-1].setAttributes(this.activeShader,this)}popMaterial(){if(0===this.materialStack.length)return void o.log.warn("Tried to pop a material off of an empty stack");this.materialStack.pop();this.materialPushedShaderStack.pop()&&this.popShader()}setActivePass(e){this.activePass=e}getActivePass(){return this.activePass}setIsPickingHiddenOccurrences(e){this.isPickingHiddenOccurrences=e}getIsPickingHiddenOccurrences(){return this.isPickingHiddenOccurrences}isPicking(){return!!this.activePass&&this.activePass.isPickPass()}isHighlighting(){return!!this.activePass&&this.activePass.isHighlightPass()}getActiveHighlightType(){return this.activePass?this.activePass.getActiveHighlightType():null}needsAttribute(e){return!!this.activePass&&this.activePass.needsAttribute(e)}getPickPassIteration(){return this.activePass&&this.activePass.isPickPass()?this.activePass.getPickIteration():-1}isShowthrough(){return!!this.activePass&&this.activePass.isShowthroughPass()}setBackFacePicking(e){this.pickBackFaces=e}isPickingBackFaces(){return this.isPicking()&&this.pickBackFaces}setOverrideFaceCullingMode(e){this.overrideFaceCullingMode=e}clearOverrideFaceCullingMode(){this.overrideFaceCullingMode=s.CullFace.UNSPECIFIED}nodeFilter(e){return!0}setZOffset(e){const t=e/this.MAXIMUM_Z_OFFSET;this.setPolygonOffset(t,e)}setOverridePolygonOffset(e,t){this.overridePolygonOffset=!1,this.setPolygonOffset(e,t),this.overridePolygonOffset=!0}clearOverridePolygonOffset(){this.overridePolygonOffset=!1}setPolygonOffset(e,t){if(this.overridePolygonOffset||e===this.lastPolygonOffsetFactor&&t===this.lastPolygonOffsetUnits)return;const i=this.viewer.getGlContext();0===e&&0===t?i.disable(i.POLYGON_OFFSET_FILL):(i.polygonOffset(e,t),i.enable(i.POLYGON_OFFSET_FILL)),this.lastPolygonOffsetFactor=e,this.lastPolygonOffsetUnits=t}setFacesToCull(e){if(this.lastCullFace===e)return;let t=e;this.overrideFaceCullingMode!==s.CullFace.UNSPECIFIED&&(t=this.overrideFaceCullingMode);const i=this.viewer.getGlContext();s.CullFace.BACK===t?(i.enable(i.CULL_FACE),i.cullFace(i.BACK)):s.CullFace.FRONT===t?(i.enable(i.CULL_FACE),i.cullFace(i.FRONT)):s.CullFace.NONE===t?i.disable(i.CULL_FACE):o.log.error("Unknown face culling parameter: "+t)}setPointSize(e){this.setPrimitiveSize(e)}setPointFont(e){this.setPrimitiveStyle([e[0],e[1],0,0])}setLineWidth(e){this.setPrimitiveSize(e)}setLineStipple(e){this.setPrimitiveStyle(e)}setPrimitiveSize(e){const t=this.getActiveShader();t&&t.vertexAttrib1f(s.AttributeNames.PRIMITIVE_SIZE,e)}setPrimitiveStyle(e){const t=this.getActiveShader();t&&t.vertexAttrib4fv(s.AttributeNames.PRIMITIVE_STYLE,e)}setPickPrimitiveAlternates(e){this.pickPrimitiveAlternates=e}getPickPrimitiveAlternates(){return this.pickPrimitiveAlternates}setBaseHighlightsEnabled(e){this.baseHighlightsEnabled=e}getBaseHighlightsEnabled(){return this.baseHighlightsEnabled}setUseHiddenOpacityForEdgeHighlights(e){this.useHiddenOpacityForEdgeHighlights=e}getUseHiddenOpacityForEdgeHighlights(){return this.useHiddenOpacityForEdgeHighlights}prepareForNextFrame(){this.frameId<s.LARGEST_REPRESENTABLE_INTEGER?this.frameId+=1:this.frameId=0,this.hasIsolate=this.viewer.getIsolatedOccurrenceManager().hasIsolatedInstances(),!E&&this.materialStack.length>5&&(o.log.warn("Material stack has grown unexpectedly long"),E=!0)}getFrameId(){return this.frameId}getHasIsolate(){return this.hasIsolate}setRenderingMode(e){this.renderingMode=e}setDetailSettings(e){this.detailSettings=e}getDetailSettings(){return this.detailSettings}setUsage(e){this.usage=e}getUsage(){return this.usage}getLastBufferBound(){return this.lastBufferBound}setLastBufferBound(e){this.lastBufferBound=e}applyStyle(e){e&&!(0,s.stylesEqual)(e,this.lastStyleApplied)&&e.applyStyle(this),e?this.lastStyleApplied.copyFrom(e):this.lastStyleApplied.clear()}activePassNeedsIsolationTest(){return!!this.activePass&&this.activePass.testIsolation(this)}activePassIsForIsolate(){return!!this.activePass&&this.activePass.forIsolate()}activePassIsForSectionPlaneEndcapMask(){return!!this.activePass&&this.activePass.forSectionPlaneEndcapMask()}setNodeOccurrenceFilterFunction(e){this.nodeOccurrenceFilterFunction=e}doesNodeOcccurrencePassFilter(e){return!this.nodeOccurrenceFilterFunction||this.nodeOccurrenceFilterFunction(e)}activePassNeedsFaceAppearances(){return!this.activePass||this.activePass.needsFaceAppearances()}}t.RenderContext=I},544224:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ResizeManipulator=void 0;const s=i(114924),n=i(545348),r=i(606544),a=i(32620),o=i(264292),c=i(613199),l=n.default.getManager(),h=1e-6,d=500,u="move",g=new s.NodeProperties({primitiveType:s.PrimitiveType.TRIANGLES,material:s.UNLIT_COLOR_FROM_ATTRIBUTE,zOffset:2,isTwoSided:!0,includedInBlend:!1,primitivesHaveTransparency:!0,isShowThrough:!0,isDepthTested:!1,addsToBounds:!1}),p=new s.NodeProperties({primitiveType:s.PrimitiveType.TRIANGLE_STRIP,material:s.UNLIT_COLOR_FROM_ATTRIBUTE,zOffset:2,isTwoSided:!0,includedInBlend:!1,primitivesHaveTransparency:!0,isShowThrough:!0,isDepthTested:!1,addsToBounds:!1});class m extends s.UIElement{constructor(e,t,i,n,r,a,c){super(c,n.usage===s.BTGraphicsUsage.BASE?s.MAIN_SCENEGRAPH_ID:s.PREVIEW_SCENEGRAPH_ID),this.highlighted=!1,this.dragOffset=[0,0],this.resizeUniformly=!1,this.cursorString="",this.staticIncrements=null,this.center=t,this.normal=i,this.direction0=r,this.direction1=a,this.offset=o.vec2.create(),this.parent=n,this.selectionId=e,this.listenTo(this,s.UiEvents.MOUSE_ENTER+this.selectionId,this.onMouseEnter),this.listenTo(this,s.UiEvents.MOUSE_LEAVE+this.selectionId,this.onMouseLeave),this.listenTo(this,s.UiEvents.DRAG_START+this.selectionId,this.onDragStart),this.listenTo(this,s.UiEvents.DRAG+this.selectionId,this.onDrag),this.listenTo(this,s.UiEvents.DRAG_STOP+this.selectionId,this.onDragStop)}onViewWillDraw(e,t){this.updateTransform(e),this.hasMeshIncrements()||this.updateGraphics()}onAppearanceConstantsUpdated(){this.removeMeshIncrements(),this.staticIncrements=null}updateTransform(e){const t=o.mat4.create(),i=o.vec3.fromValues(this.center[0],this.center[1],this.center[2]),s=(c.vec3C.length(this.parent.getXAxis())+c.vec3C.length(this.parent.getYAxis()))/2,n=Math.min(e.getPixelSizeAtWorldPoint(this.transformPoint(i)),s/16),r=(0,a.getDevicePixelRatio)();t[0]=n*r,t[5]=n*r,t[10]=n*r,t[12]=this.center[0],t[13]=this.center[1],t[14]=this.center[2],this.setTransform(t)}getClearModelSelectionsOnPrehilite(){return!1}getStaticIncrements(){if(this.staticIncrements)return this.staticIncrements;this.staticIncrements={};const e=[0,0,0],t=c.vec3C.normalize(this.direction0,o.vec3.create()),i=l.getNumber("RESIZE_MANIPULATOR_RADIUS"),n=this.selectionId+"FrontFace",r=(0,s.createDisc)(e,i,this.normal,36);this.staticIncrements[n]={selection:this.selectionId,data:r,type:g,color:l.getColor("RESIZE_MANIPULATOR_INNER_COLOR")};const a=this.selectionId+"Border",h=(0,s.createRing)(e,i,1.3*i,this.normal,t,0,2*Math.PI,36);return this.staticIncrements[a]={selection:this.selectionId,data:h,type:p,color:l.getColor("RESIZE_MANIPULATOR_OUTER_COLOR")},this.staticIncrements}updateGraphics(){this.updateIncrementsOnEntity(this.selectionId,"FrontFace"),this.updateIncrementsOnEntity(this.selectionId,"Border")}updateIncrementsOnEntity(e,t){const i=this,n=this.getStaticIncrements();n[e+t].type===g?(0,s.addColorToIncrement)(n[e+t].color,n[e+t].data):n[e+t].type===p&&(0,s.addColorToIncrement)(i.highlighted?l.getColor("RESIZE_MANIPULATOR_OUTER_COLOR_HIGHLIGHT"):n[e+t].color,n[e+t].data),this.updateMeshIncrement(e+t,n[e+t].selection,n[e+t].data.clone(),n[e+t].type)}cleanup(){this.cursorString===u&&(this.cursorString="",this.viewer.popCursor())}updateDefinition(e,t,i,s){this.staticIncrements=null,this.center=e,this.normal=c.vec3C.normalize(t,o.vec3.create()),this.direction0=c.vec3C.normalize(i,o.vec3.create()),this.direction1=c.vec3C.normalize(s,o.vec3.create()),this.updateGraphics()}onMouseEnter(e,t){this.highlighted=!0,0===this.cursorString.length&&(this.cursorString=u,this.viewer.pushCursor(this.cursorString)),this.updateGraphics(),(0,s.requestDraw)()}onMouseLeave(e,t){this.highlighted&&(this.highlighted=!1,this.updateGraphics()),this.cursorString===u&&(this.cursorString="",this.viewer.popCursor()),(0,s.requestDraw)()}getOffsetFromEvent(e){const t=e.camera.getRay(e.mouseX,e.mouseY),i=o.vec3.create(),n=this.normal,r=o.vec4.fromValues(n[0],n[1],n[2],-o.vec3.dot(n,this.center)),a=(0,s.intersectRayPlane)(t,r);if(null===a)return null;return[o.vec3.dot(c.vec3C.subtract(a,this.center,i),this.direction0),o.vec3.dot(c.vec3C.subtract(a,this.center,i),this.direction1)]}onDragStart(e,t,i){const s=this.getOffsetFromEvent(t);s&&(this.dragOffset=c.vec2C.subtract(s,this.offset,o.vec2.create()),i.requestDrag=!0,this.resizeUniformly=this.viewer.getLastMouseMovedEvent().shiftKey)}onDrag(e,t){const i=this.getOffsetFromEvent(t);if(!i)return;this.offset=c.vec2C.subtract(i,this.dragOffset,o.vec2.create());for(let e=0;e<this.offset.length;e++)this.offset[e]=parseFloat(this.offset[e].toFixed(8));let n,r,a=0,l=0;this.resizeUniformly?(n=2*c.vec3C.length(this.parent.getXAxis())+2*this.offset[0],r=2*c.vec3C.length(this.parent.getYAxis())+2*this.offset[1],n>h&&n<d&&(this.parent.width=n),r>h&&r<d&&(this.parent.height=r)):(n=2*c.vec3C.length(this.parent.getXAxis())+1*this.offset[0],r=2*c.vec3C.length(this.parent.getYAxis())+1*this.offset[1],n>h&&n<d&&(this.parent.width=n,a=this.offset[0]/2*o.vec3.dot(this.direction0,c.vec3C.normalize(this.parent.getXAxis(),o.vec3.create()))),r>h&&r<d&&(this.parent.height=r,l=this.offset[1]/2*o.vec3.dot(this.direction1,c.vec3C.normalize(this.parent.getYAxis(),o.vec3.create()))),this.parent.centerOffset=c.vec3C.subtract(c.vec3C.add(this.parent.centerOffset,(0,s.planeToWorld)([a,l],this.parent.getCenter(),this.normal,c.vec3C.normalize(this.parent.getXAxis(),o.vec3.create())),o.vec3.create()),this.parent.getCenter(),o.vec3.create())),this.parent.updateDefinition(this.parent.getName(),this.parent.getCenter(),this.parent.getXAxis(),this.parent.getYAxis(),!0),(0,s.requestDraw)()}onDragStop(e,t){const i=new r.BTFeaturePlaneAppearance;i.width=this.parent.width,i.height=this.parent.height;const n=(0,s.worldToPlane)(c.vec3C.add(this.parent.centerOffset,this.parent.getCenter(),o.vec3.create()),this.parent.getCenter(),this.normal,c.vec3C.normalize(this.parent.getXAxis(),o.vec3.create()));i.xOffset=n[0],i.yOffset=n[1],this.viewer.getEventDispatcher().trigger(s.CHANGE_FEATURE_APPEARANCE,i,this.parent.planeId),this.offset=[0,0]}}t.ResizeManipulator=m},82145:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getSceneGraphIdForUsage=t.SceneGraphs=t.SceneGraph=void 0;const s=i(490950),n=i(114924);class r{constructor(e){this.id=e;const t=e===s.PREVIEW_SCENEGRAPH_ID?n.BTGraphicsUsage.PREVIEW:n.BTGraphicsUsage.BASE;this.rootNode=new n.Node(e+" root",{},t)}getRootNode(){return this.rootNode}isForPreview(){return this.rootNode.getUsage()===n.BTGraphicsUsage.PREVIEW}getBounds(){return this.rootNode.getBoundingBox()}updateBounds(){this.rootNode.updateBounds()}removeEverything(){this.rootNode&&this.rootNode.removeAllChildren()}draw(e){this.rootNode.draw(e)}passesNodeFilter(e){return this.rootNode.passesNodeFilter(e)}getAllNodesWithId(e){const t=[],i=function(s){s.getId()===e&&t.push(s);for(let e=0;e<s.getChildCount();++e)i(s.getChildByIndex(e))};return i(this.rootNode),t}getNodeAtEndOfPath(e){const t=e.slice(0);let i=this.rootNode;for(t.shift();t.length>0;){const e=t.shift();if(i=i.getChildById(e),null===i)return null}return i}ownsNode(e){for(;e;){if(e===this.rootNode)return!0;e=e.getParent()}return!1}makeSceneDebugObject(){return{text:this.id,children:[this.rootNode.makeSceneDebugObject(0)]}}}t.SceneGraph=r;t.SceneGraphs=class{constructor(){this.theSceneGraphs={}}destroySceneGraphs(){Object.values(this.theSceneGraphs).forEach((function(e){e.getRootNode().onPermanentlyRemoved()})),this.theSceneGraphs={}}getSceneGraph(e){let t=this.theSceneGraphs[e];return t||(this.theSceneGraphs[e]=t=new r(e)),t}getMainSceneGraph(){return this.getSceneGraph(s.MAIN_SCENEGRAPH_ID)}getPreviewSceneGraph(){return this.getSceneGraph(s.PREVIEW_SCENEGRAPH_ID)}getHudSceneGraph(){return this.getSceneGraph(s.HUD_SCENEGRAPH_ID)}getHudModelSceneGraph(){return this.getSceneGraph(s.HUD_MODEL_SCENEGRAPH_ID)}},t.getSceneGraphIdForUsage=function(e){return e===n.BTGraphicsUsage.BASE?s.MAIN_SCENEGRAPH_ID:s.PREVIEW_SCENEGRAPH_ID}},90753:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getMeshSetId=void 0;const s=i(114924),n=new s.BitShiftId;t.getMeshSetId=function(e){n.reset(),n.addNumber(e.getPrimitiveType(),s.PRIMITIVE_TYPE_BITS);for(const t in s.Attributes){const i=s.Attributes[t];n.addBoolean(e.hasAttribute(i.incrementProperty))}return n.getId()}},605985:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.BooleanIterator=void 0;t.BooleanIterator=class{constructor(){this.resultRange1=[0,0,null],this.resultRange2=[0,0,null],this.nextResult=null}hasMoreRanges(){return!!this.nextResult}getNextRange(){const e=this.nextResult;return this.nextResult=this.findNextRange(),e}getStorageForNextResult(){const e=this.nextResult===this.resultRange1?this.resultRange2:this.resultRange1;return e[2]=null,e}}},982233:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},343574:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.releaseScratchSpace=t.getScratchSpace=t.scratchSpaces=t.setTestingBuffers=t.getTestingBuffers=void 0;const s=i(912057),n=i(114924);let r=!1;function a(){return r}function o(e,i){let s=1/0,r=-1,a=1/0,o=-1;for(let i=0;i<t.scratchSpaces.length;++i)t.scratchSpaces[i].byteLength>=e&&t.scratchSpaces[i].byteLength<a?(a=t.scratchSpaces[i].byteLength,o=i):t.scratchSpaces[i].byteLength<s&&(s=t.scratchSpaces[i].byteLength,r=i);if(o>=0){const s=t.scratchSpaces[o];return i&&(0,n.zeroOutArrayBuffer)(s,e),t.scratchSpaces.splice(o,1),s}return r>=0&&t.scratchSpaces.splice(r,1),new ArrayBuffer(e)}function c(e){e&&t.scratchSpaces.push(e)}t.getTestingBuffers=a,t.setTestingBuffers=function(e){r=e},t.scratchSpaces=[],t.getScratchSpace=o,t.releaseScratchSpace=c;t.Buffer=class{constructor(e,t,i,n){this.viewer=e,this.target=i,this.componentCount=n,this.GAUGE_MEMORY_TYPE="Vertex buffer",this.scratchSpace=null,this.floatView=null,this.indexView=null,this.uint8View=null,this.initialCopyPerfomed=!1,this.rangesToCopy=[],this.gl=this.viewer.getGlContext(),this.size=t,this.webGlBuffer=this.gl.createBuffer(),this.webGlBuffer||s.log.error("Failed to create gl buffer")}ensureScratchSpace(){if(!this.scratchSpace){const e=!this.initialCopyPerfomed;this.scratchSpace=o(this.size,e)}}releaseScratchSpace(){this.scratchSpace&&!a()&&(c(this.scratchSpace),this.scratchSpace=null,this.floatView=null,this.indexView=null,this.uint8View=null)}destroy(){this.gl&&this.webGlBuffer&&this.gl.deleteBuffer(this.webGlBuffer),this.webGlBuffer&&this.viewer.getMemoryGauge().decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.size),this.webGlBuffer=null}getComponentCount(){return this.componentCount}copyToGl(){if(!this.scratchSpace)return this.rangesToCopy.length>0&&s.log.warn("Encountered buffer with ranges that need copying, but no scratch space to copy from"),!1;let e;return e=this.initialCopyPerfomed?this.copyPartialUpdatesToGl():this.copyWholeBufferToGl(),this.releaseScratchSpace(),e}copyWholeBufferToGl(){if(!this.webGlBuffer)return!1;this.gl.bindBuffer(this.target,this.webGlBuffer);const e=new DataView(this.scratchSpace,0,this.size);return this.gl.bufferData(this.target,e,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.target,null),this.viewer.getMemoryGauge().incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.size),this.initialCopyPerfomed=!0,this.rangesToCopy=[],!0}addRangeToCopyToGl(e,t){this.initialCopyPerfomed&&(0,n.insertRangeStartEnd)(e,t,this.rangesToCopy)}copyPartialUpdatesToGl(){if(this.rangesToCopy.length<1)return!1;this.gl.bindBuffer(this.target,this.webGlBuffer);for(let e=0;e<this.rangesToCopy.length;++e){const t=this.rangesToCopy[e],i=new Uint8Array(this.scratchSpace,t[0],t[1]-t[0]);this.gl.bufferSubData(this.target,t[0],i)}return this.gl.bindBuffer(this.target,null),this.rangesToCopy=[],!0}getSize(){return this.size}getFloatView(){return this.ensureScratchSpace(),this.floatView||(this.floatView=new Float32Array(this.scratchSpace,0,this.size/4)),this.floatView}getIndexView(e){if(this.ensureScratchSpace(),!this.indexView){const t=e===Uint32Array?4:2;this.indexView=new e(this.scratchSpace,0,this.size/t)}return this.indexView}getUint8View(){return this.ensureScratchSpace(),this.uint8View||(this.uint8View=new Uint8Array(this.scratchSpace,0,this.size)),this.uint8View}getGlBuffer(){return this.webGlBuffer}bind(){this.webGlBuffer?this.gl.bindBuffer(this.target,this.webGlBuffer):s.log.warn("Attempting to bind a null gl buffer")}makeSceneDebugObject(e){const t=new e(this.scratchSpace),i=[];for(let e=0;e<t.length;++e)i.push(t[e].toString());return"["+i.join(", ")+"]"}}},432188:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=t.debugIdCount=t.incrementListenerIdCounter=t.IncrementDetails=void 0;const s=i(114924),n=i(315689),r=i(912057),a=i(61161),o=0,c=1,l=[1/0,1/0,1/0],h=8388608,d=new s.AttributeBinding(s.GlDataType.UNSIGNED_BYTE,4,0,0,!0);let u=null;class g{constructor(e,t,i,s){this.increment=e,this.bufferSet=s,this.vertexRange=t,this.indexRange=i,this.pickId=e.pickId}}t.IncrementDetails=g;let p=1;t.incrementListenerIdCounter=function(){return p++},t.debugIdCount=0;class m extends a.BufferSetBase{constructor(e){super(e),this.lineStripIndexBuffer=null,this.pickIdBuffers=[],this.indexRangesToDelete=[],this.pendingFreeSpace=[[],[]],this.freeSpace=[[],[]],this.incrementDeletionListeners=null,this.shaderIdToVAOs=new Map,this.initialVertexCount=1,this.initialIndexCount=this.getDefaultIndexCount(),this.incrementsToBuffer=new n.TemplatedCountedMap,this.increments=new n.TemplatedCountedMap,this.debugId=t.debugIdCount++}clone(e){const t=new m(e);if(t.increments.insertCountedMap(this.increments),this.attributeBindings){t.attributeBindings={};for(const e in this.attributeBindings)this.attributeBindings[e]&&(t.attributeBindings[e]=this.attributeBindings[e].clone())}t.initialVertexCount=this.initialVertexCount,t.initialIndexCount=this.initialIndexCount;for(let e=0;e<this.freeSpace[o].length;++e)t.freeSpace[o].push(this.freeSpace[o][e].slice(0));for(let e=0;e<this.freeSpace[c].length;++e)t.freeSpace[c].push(this.freeSpace[c][e].slice(0));return t.markAllIncrementsForBuffering(),t.updateBuffers({forClone:!0}),t}markAllIncrementsForBuffering(){this.incrementsToBuffer.insertCountedMap(this.increments)}destroy(){if(super.destroy(),this.lineStripIndexBuffer&&(this.lineStripIndexBuffer.destroy(),this.lineStripIndexBuffer=null),this.pickIdBuffers){for(let e=0;e<this.pickIdBuffers.length;++e)this.pickIdBuffers[e].destroy();this.pickIdBuffers=[]}if(this.parentMesh.viewer.areVertexArrayObjectsAvailable){for(const[e,t]of this.shaderIdToVAOs)this.parentMesh.viewer.getVertexArrayExtension().deleteVertexArrayOES(t);this.shaderIdToVAOs.clear()}}getDebugId(){return this.debugId.toString()}addIncrementDeletionListener(e){this.incrementDeletionListeners||(this.incrementDeletionListeners={}),this.incrementDeletionListeners[e.getListenerId()]=e}removeIncrementDeletionListener(e){this.incrementDeletionListeners&&delete this.incrementDeletionListeners[e.getListenerId()]}triggerDeletedListeners(e){if(e&&this.incrementDeletionListeners)for(const t in this.incrementDeletionListeners)this.incrementDeletionListeners[t].onIncrementDeleted(e)}getDefaultIndexCount(){return this.isTriangleStrip()?1:0}getUsedVertexCount(){let e=0;return this.increments.each((function(t){return e+=t.increment.points.length/3,!1}),this),e}addFreeSpace(e,t,i,n){const r=n?this.pendingFreeSpace[e]:this.freeSpace[e];(0,s.insertRangeStartEnd)(t,i,r)}incorporatePendingFreeSpace(){for(let e=0;e<this.pendingFreeSpace.length;++e){const t=this.pendingFreeSpace[e],i=this.freeSpace[e];for(let e=0;e<t.length;++e)(0,s.insertRange)(t[e],i);t.splice(0,t.length)}}findFreeSpace(e,t){for(let i=0;i<this.freeSpace[e].length;++i){const s=this.freeSpace[e][i];if(s[1]-s[0]>=t)return s[0]}return-1}markFreeSpaceUsed(e,t,i){(0,s.removeRange)([t,t+i],this.freeSpace[e])}getLastUsedIndex(){const e=this.freeSpace[c][this.freeSpace[c].length-1],t=this.indexBuffer.getComponentCount();return e&&e[1]===t?e[0]:t}reinitialize(){super.reinitialize(),this.lineStripIndexBuffer=null,this.pickIdBuffers=[],this.markAllIncrementsForBuffering(),this.updateBuffers({forReinitialize:!0}),this.shaderIdToVAOs=new Map}getIncrement(e){const t=this.increments.get(e);return t?t.increment:null}incorporateIncrement(e){if(!e||!e.getFullId())return null;let t,i;const n=e.getPreparedVertexCount(),r=e.getPreparedIndexCount(),a=this.findFreeSpace(o,n),l=this.findFreeSpace(c,r);if(a>=0&&l>=0)t=[a,a+n],i=[l,l+r],this.markFreeSpaceUsed(o,a,n),this.markFreeSpaceUsed(c,l,r);else if(!this.areBuffersInitialized()){const e=this.initialVertexCount+n<=(0,s.getMaximumVerticesPerVbo)(),a=(this.initialVertexCount+n)*this.parentMesh.vertexSize,o=a<=h,c=this.initialIndexCount===this.getDefaultIndexCount()&&a<=268435456;e&&(o||c)&&(t=[this.initialVertexCount,this.initialVertexCount+n],i=[this.initialIndexCount,this.initialIndexCount+r],this.initialVertexCount+=n,this.initialIndexCount+=r)}if(t&&i){const s=new g(e,t,i,this);return this.incrementsToBuffer.insert(e.getFullId(),s),this.increments.insert(e.getFullId(),s),s}return null}getIncrementDetails(e){return this.increments.get(e)||null}deleteIncrement(e){const t=this.increments.get(e);return t&&(this.addFreeSpace(o,t.vertexRange[0],t.vertexRange[1],!1),this.addFreeSpace(c,t.indexRange[0],t.indexRange[1],!0),(0,s.insertRange)(t.indexRange,this.indexRangesToDelete),this.increments.remove(e)),this.incrementsToBuffer.remove(e),this.triggerDeletedListeners(t),t||null}hasBufferUpdates(){return!this.incrementsToBuffer.isEmpty()||this.indexRangesToDelete.length>0}updateBuffers(e){this.areBuffersInitialized()||this.initializeBuffers(e),this.processDeletedRanges(),this.processNewIncrements();const t=this.copyBuffersToGl();return this.incorporatePendingFreeSpace(),t}validateBufferIndices(e){if(!(0,s.getTestingBuffers)())return void r.log.warn("Can only validate index buffers when getTestingBuffers is true");const t=this.vertexBuffer.getUint8View(),i=this.indexBuffer.getIndexView((0,s.getIndexBufferType)());for(const n in this.attributeBindings){const a=this.attributeBindings[n],o=a.elementCount*(0,s.sizeOfGlType)(a.type);e||(e=[0,i.length]);for(let s=e[0];s<e[1];++s){const e=i[s];if(a.offset+e*(a.stride+o)+o>t.length){r.log.warn("Found inconsistency in buffer set "+this.debugId+" for attribute "+n);break}}}}copyBuffersToGl(){let e=super.copyBuffersToGl();this.lineStripIndexBuffer&&(e=this.lineStripIndexBuffer.copyToGl()||e);for(let t=0;t<this.pickIdBuffers.length;++t)e=this.pickIdBuffers[t].copyToGl()||e;return e}initializeBuffers(e){if(this.areBuffersInitialized())return;const t=this.parentMesh.viewer,i=t.getGlContext();let n,r=this.initialVertexCount,d=this.initialIndexCount;const g=e&&e.forClone,p=e&&e.forReinitialize;if(this.parentMesh.bufferAllocationPolicy===s.BufferAllocationPolicy.MAXIMUM&&this.parentMesh.vertexSize>0){const e=Math.floor(h/this.parentMesh.vertexSize);r=Math.max(r,e);const t=Math.ceil(1.5*r);d=Math.max(d,t)}else this.parentMesh.bufferAllocationPolicy===s.BufferAllocationPolicy.MEDIUM&&(r=Math.max(r,512),d=Math.max(d,2048));this.vertexBuffer=new s.Buffer(t,r*this.parentMesh.vertexSize,i.ARRAY_BUFFER,r),this.initialVertexCount<r&&!g&&!p&&this.addFreeSpace(o,this.initialVertexCount,r,!1);const m=this.vertexBuffer.getFloatView();for(n=0;n<a.ATTRIBUTES.POINT.dimension;++n)m[n]=l[n];this.indexBuffer=new s.Buffer(t,d*(0,s.getIndexElementSize)(),i.ELEMENT_ARRAY_BUFFER,d),this.initialIndexCount<d&&!g&&!p&&this.addFreeSpace(c,this.initialIndexCount,d,!1);const E=this.indexBuffer.getIndexView((0,s.getIndexBufferType)());for(n=0;n<this.getDefaultIndexCount();++n)E[n]=0;this.isTriangleStrip()&&(this.lineStripIndexBuffer=new s.Buffer(t,d*(0,s.getIndexElementSize)(),i.ELEMENT_ARRAY_BUFFER,d),function(e,t){const i=e.getGlContext();u||(u=new s.AttributeBinding(i.FLOAT,1,0,0)),(!e.getResources().primitiveRestartBuffer||e.getResources().primitiveRestartBuffer.getComponentCount()<t)&&(e.getResources().primitiveRestartBuffer=new s.Buffer(e,4*t,i.ARRAY_BUFFER,t),e.getResources().primitiveRestartBuffer.getFloatView()[0]=16384,e.getResources().primitiveRestartBuffer.copyToGl())}(t,d)),this.pickIdBuffers=[]}processDeletedRanges(){for(let e=0;e<this.indexRangesToDelete.length;++e){const t=this.indexRangesToDelete[e],i=t[1]-t[0],n=t[0],r=this.indexBuffer.getIndexView((0,s.getIndexBufferType)());for(let e=t[0];e<t[1];++e)r[e]=0;this.isTriangleStrip()&&this.updateLineStripIndices(t),this.indexBuffer.addRangeToCopyToGl(n*(0,s.getIndexElementSize)(),(n+i)*(0,s.getIndexElementSize)())}this.indexRangesToDelete=[]}updateLineStripIndices(e){if(!this.isTriangleStrip())return;if(!this.lineStripIndexBuffer)return void r.log.warn("Did not find line strip index buffer for triangle strip");const t=this.indexBuffer.getIndexView((0,s.getIndexBufferType)()),i=this.lineStripIndexBuffer.getIndexView((0,s.getIndexBufferType)());let n=!1,a=0;i[e[0]]=0;for(let s=e[0]+1;s<e[1]-1;++s)n?(t[s]!==t[s-1]?++a:a=0,2===a&&(n=!1,i[s-2]=t[s-2],i[s-1]=t[s-1])):t[s]===t[s-1]&&(n=!0,a=0),i[s]=n?0:t[s];i[e[1]-1]=0,this.lineStripIndexBuffer.addRangeToCopyToGl(e[0]*(0,s.getIndexElementSize)(),e[1]*(0,s.getIndexElementSize)())}processNewIncrements(){this.incrementsToBuffer.each(((e,t)=>(e.increment.isPreparedForBuffering()||e.increment.prepareForBuffering(),this.copyIncrementVertices(e.increment,e.vertexRange),this.copyIncrementPickIds(e,e.vertexRange),this.copyIncrementIndices(e.increment,e.indexRange,e.vertexRange),!1))),this.incrementsToBuffer.clear()}replicateAttributeValue(e,t,i,n){if(e.elementCount!==n.length)return void r.log.warn("An attempt was made to update a vertex attribute with a value with the wrong dimension");const a=t/e.typeSize(),o=a+i[0]*e.elementCount,c=a+i[1]*e.elementCount,l=e.type===s.GlDataType.FLOAT?this.vertexBuffer.getFloatView():this.vertexBuffer.getUint8View();for(let t=o;t<c;t+=e.elementCount)l.set(n,t)}copyIncrementVertices(e,t){const i=this.vertexBuffer.getComponentCount(),n=this.vertexBuffer.getFloatView(),r=this.vertexBuffer.getUint8View(),o=e.vertexCount(),c=t[0];let l=0,h=0,d=0,u=!1;this.attributeBindings||(this.attributeBindings={},u=!0);for(let t=0;t<a.ATTRIBUTE_LAYOUT.length;++t){const g=a.ATTRIBUTE_LAYOUT[t];let p=!1;e[g.incrementProperty]&&(g.type===s.GlDataType.FLOAT?n.set(e[g.incrementProperty],l+g.elementCount*c):r.set(e[g.incrementProperty],h+g.elementCount*c),p=!0),u&&p&&(this.attributeBindings[g.name]=new s.AttributeBinding(+g.type,g.dimension,d,0,g.normalize,g.secondDimension),d+=g.sizeInBytes()*i),p&&(this.vertexBuffer.addRangeToCopyToGl(h+c*g.sizeInBytes(),h+(c+o)*g.sizeInBytes()),h+=g.sizeInBytes()*i,l+=g.sizeInBytes()/4*i)}}updateIncrementAttribute(e,t,i){this.areBuffersInitialized()||this.updateBuffers();const s=this.increments.get(t);if(!s)return void r.log.warn("Increment was not found in updateIncrementAttribute");const n=this.attributeBindings[e.name];n?(this.replicateAttributeValue(e,n.offset,s.vertexRange,i),this.vertexBuffer.addRangeToCopyToGl(n.offset+s.vertexRange[0]*e.sizeInBytes(),n.offset+s.vertexRange[1]*e.sizeInBytes())):r.log.warn("An attempt was made to update an attribute that did not have a binding")}copyIncrementPickIds(e,t){const i=e.pickId;if((0,s.idIsValid)(i)){this.parentMesh.viewer.notifyOfPickPassCount(i.length);for(let e=0;e<i.length;++e){let n=this.pickIdBuffers[e];n||(this.pickIdBuffers[e]=n=new s.Buffer(this.parentMesh.viewer,4*this.vertexBuffer.getComponentCount(),this.parentMesh.viewer.getGlContext().ARRAY_BUFFER,this.vertexBuffer.getComponentCount()));const r=n.getUint8View(),a=(0,s.convertIntToUcharArray)(i[e]);for(let e=t[0];e<t[1];++e)r.set(a,4*e);n.addRangeToCopyToGl(4*t[0],4*t[1])}}}copyIncrementIndices(e,t,i){if(!this.indexBuffer)return;const n=this.indexBuffer.getIndexView((0,s.getIndexBufferType)());let r=0;this.isTriangleStrip()&&(n[t[0]]=i[0]+e.indices[r],r=1);let a=0;for(a=0;a<e.indices.length;++a)n[t[0]+a+r]=i[0]+e.indices[a];if(this.isTriangleStrip()){const s=i[0]+e.indices[e.indices.length-1];for(;a<e.indexLengthWithDegenerates();++a)n[t[0]+a]=s;this.updateLineStripIndices(t)}this.indexBuffer.addRangeToCopyToGl(t[0]*(0,s.getIndexElementSize)(),t[1]*(0,s.getIndexElementSize)())}bindBuffers(e,t,i,n,r){super.bindBuffers(e,t,i,n,r),n&&this.vertexBuffer.bind();let a=this.indexBuffer;e.getPickPrimitiveAlternates()&&i&&(a=this.lineStripIndexBuffer),a.bind(),r&&e.isPicking()&&e.getPickPassIteration()>=0&&(this.pickIdBuffers[e.getPickPassIteration()]?this.pickIdBuffers[e.getPickPassIteration()].bind():t.vertexAttrib4fv(s.AttributeNames.PICKING,s.PICK_CLEAR_COLOR))}initializeAttributes(e,t,i){super.initializeAttributes(e,t,i),t.isPicking()&&t.getPickPassIteration()>=0?this.pickIdBuffers[t.getPickPassIteration()]?(this.pickIdBuffers[t.getPickPassIteration()].bind(),e.vertexAttribPointer(s.AttributeNames.PICKING,d)):e.vertexAttrib4fv(s.AttributeNames.PICKING,s.PICK_CLEAR_COLOR):e.enableVertexAttribArray(s.AttributeNames.PICKING,!1),t.getPickPrimitiveAlternates()&&i?(this.parentMesh.viewer.getResources().primitiveRestartBuffer.bind(),e.vertexAttribPointer(s.AttributeNames.PRIMITIVE_RESTART,u)):e.enableVertexAttribArray(s.AttributeNames.PRIMITIVE_RESTART,!1)}bindAttributeStateWithVAOs(e,t,i,s){let n=t.getNumericId();i.getPickPassIteration()>0&&(n=1e3*n+i.getPickPassIteration());let r=this.shaderIdToVAOs.get(n);e?r?(this.parentMesh.viewer.bindVao(r),this.bindBuffers(i,t,s,!1,!0)):(r=this.parentMesh.viewer.getVertexArrayExtension().createVertexArrayOES(),this.shaderIdToVAOs.set(n,r),this.parentMesh.viewer.bindVao(r),this.bindAttributeStateWithoutVAOs(e,t,i,s)):this.parentMesh.viewer.bindVao(r)}draw(e,t){this.drawRanges(e,t)}drawRanges(e,t){if(this.parentMesh.compileBuffers(e),!this.attributeBindings)return;if(!this.areBuffersInitialized())return void this.logInconsistency("BEL-53632 BufferSet.prototype.draw without initialized buffers");const i=t.getRangeIteratorForBufferSet(this);if(!i||!i.hasMoreRanges())return;const n=e.getActiveShader(),r=this.parentMesh.viewer.getGlContext(),a=this.isTriangleStrip(),o=e.getPickPrimitiveAlternates()?this.parentMesh.getAlternatePrimitiveMode():this.parentMesh.getPrimitiveMode(),c=this.buffersNeedBinding(e);this.parentMesh.viewer.areVertexArrayObjectsAvailable?this.bindAttributeStateWithVAOs(c,n,e,a):this.bindAttributeStateWithoutVAOs(c,n,e,a);let l=0,h=0;for(;i.hasMoreRanges();){const t=i.getNextRange();if(!t)continue;let n=t[0],c=t[1]-t[0];1&n&&a&&(c-=1,n+=1),c<3&&a||(e.applyStyle(t[2]),r.drawElements(o,c,(0,s.getIndexElementType)(),n*(0,s.getIndexElementSize)()),l++,h+=c,e.getPickPrimitiveAlternates()&&a&&r.drawElements(r.POINTS,c,(0,s.getIndexElementType)(),n*(0,s.getIndexElementSize)()))}this.parentMesh.incrementStatisticsForCall(h,l)}makeSceneDebugObject(){const e={};if(this.increments.isEmpty())return e;this.markAllIncrementsForBuffering(),this.processNewIncrements(),e.vertexBuffer=this.vertexBuffer.makeSceneDebugObject(Uint8Array),e.indexBuffer=this.indexBuffer.makeSceneDebugObject((0,s.getIndexBufferType)()),this.lineStripIndexBuffer&&(e.lineStripIndexBuffer=this.lineStripIndexBuffer.makeSceneDebugObject((0,s.getIndexBufferType)())),e.pickIdBuffers=[];for(let t=0;t<this.pickIdBuffers.length;++t)e.pickIdBuffers.push(this.pickIdBuffers[t].makeSceneDebugObject(Uint32Array));return this.copyBuffersToGl(),e}addGroupIncrementsToBounds(e,t,i,s){this.increments.each((function(n){const r=n.increment;return r.groupId===e&&r.ownerId===t&&r.lod===i&&s.addBox(r.getBounds()),!1}),this)}}t.BufferSet=m},61161:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSetBase=t.ATTRIBUTE_LAYOUT=t.ATTRIBUTES=void 0;const s=i(912057),n=i(723617),r=i(114924),a=i(151434).Attributes;t.ATTRIBUTES=a;const o=[a.POINT,a.NORMAL,a.OFFSET_VECTOR,a.COLOR,a.TEXTURE,a.POINT_DATA,a.EDGE_DATA,a.PRIMITIVE_SIZE,a.PRIMITIVE_STYLE,a.CONTACT_TRACTION,a.CONTACT_PAIR_COORDINATE];t.ATTRIBUTE_LAYOUT=o;class c{constructor(e){this.parentMesh=e,this.vertexBuffer=null,this.indexBuffer=null,this.attributeBindings=null}getVertexBuffer(){return this.vertexBuffer}getIndexBuffer(){return this.indexBuffer}getParentMesh(){return this.parentMesh}setParentMesh(e){this.parentMesh=e}logInconsistency(e){c.loggedInconsistency||(s.log.warn(e),c.loggedInconsistency=!0)}hasOptimizedBuffers(){return!1}getComponentCount(){return this.vertexBuffer?this.vertexBuffer.getComponentCount():0}isTriangleStrip(){return this.parentMesh.getPrimitiveType()===r.PrimitiveType.TRIANGLE_STRIP}reinitialize(){this.vertexBuffer=null,this.indexBuffer=null}areBuffersInitialized(){return(0,n.objectsDefinedInSameWay)(this.vertexBuffer,this.indexBuffer)||this.logInconsistency("BEL-56218, BEL-55900, BEL-56214 The vertex buffer and index buffer were initialized independently"),!!this.vertexBuffer&&!!this.indexBuffer}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBuffer=null),this.indexBuffer&&(this.indexBuffer.destroy(),this.indexBuffer=null)}bindBuffers(e,t,i,s,n){e.setLastBufferBound(this)}buffersNeedBinding(e){return e.getLastBufferBound()!==this}initializeAttributes(e,t,i){for(let t=0;t<o.length;++t){const i=o[t],s=this.attributeBindings[i.name];s?e.vertexAttribPointer(i.name,s):e.enableVertexAttribArray(i.name,!1)}}bindAttributeStateWithoutVAOs(e,t,i,s){e&&(this.bindBuffers(i,t,s,!0,!1),this.initializeAttributes(t,i,s))}copyBuffersToGl(){if(!this.vertexBuffer||!this.indexBuffer)return;let e=this.vertexBuffer.copyToGl();return e=this.indexBuffer.copyToGl()||e,e}}t.BufferSetBase=c,c.loggedInconsistency=!1},462178:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ChainedOperator=void 0;const s=i(114924);t.ChainedOperator=class{constructor(){this.operandA=null,this.operandB=null}resetWithOperands(e,t){return this.operandA=e,this.operandB=t,this.operandB.setOperand(this.operandA),this}getRangeIteratorForBufferSet(e){return this.operandA&&this.operandB?this.operandB.getRangeIteratorForBufferSet(e):null}setOperand(e){this.operandA.setOperand(e)}makeSceneDebugObject(){const e={text:"ChainedOperator",children:[]};return(0,s.addDebuggableChild)(e,this.operandA),e}}},616534:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.GroupRanges=void 0;const s=i(114924);class n extends s.Ranges{constructor(e,t,i,s){super(),this.groupId=e,this.ownerId=t,this.primitiveType=i,this.lod=s,this.bounds=null}getOwnerId(){return this.ownerId}getMeshGroupId(){return this.groupId}cloneForPreview(){const e=new n(this.groupId,this.ownerId,this.primitiveType,this.lod);return this.copyDataTo(e),e.setListenForDeletions(!0),e.setBounds(this.bounds),e}onIncrementDeleted(e){e.increment.groupId===this.groupId&&e.increment.ownerId===this.ownerId&&this.onIncrementRemoved(e)}makeSceneDebugObject(e){const t=e?this.shouldDrawForOccurrences(e):void 0,i="Group ranges: (ownerId: "+this.ownerId+", groupId: "+this.groupId+", primitiveType: "+(0,s.getPrimitiveTypeDescription)(this.primitiveType)+", lod: "+this.lod+", shouldDrawForOccurrence: "+t+", listenForDeletions: "+this.listenForDeletions+")",n=this.getChildSceneDebugObjects();return this.bounds&&n.push(this.bounds.makeSceneDebugObject()),{text:i,children:n,state:{opened:t}}}isCheaplyBoundable(){return this.lod===s.Lod.LOWEST}damageBounds(){this.bounds=null,s.Ranges.prototype.damageBounds.apply(this,arguments)}setBounds(e){this.bounds=e}getBounds(e,t){if(!this.bounds){this.bounds=new s.BoundingBox;const e=this.bufferSetRanges.getKeyValues();for(let t=0;t<e.length;t+=2){e[t].addGroupIncrementsToBounds(this.groupId,this.ownerId,this.lod,this.bounds)}}return this.bounds}shouldDrawForOccurrences(e){return e.getLod()===this.lod}getPrimitiveCount(){let e=0;const t=this.bufferSetRanges.getKeyValues();for(let i=0;i<t.length;i+=2){const n=t[i+1];for(let t=0;t<n.length;++t){const i=n[t];this.primitiveType===s.PrimitiveType.TRIANGLE_STRIP?e+=i[1]-i[0]-2:this.primitiveType===s.PrimitiveType.TRIANGLES?e+=(i[1]-i[0])/3:this.primitiveType===s.PrimitiveType.SILHOUETTES&&(e+=(i[1]-i[0])/6)}}return e}}t.GroupRanges=n},66595:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IncrementRanges=void 0;const s=i(114924);class n extends s.Ranges{constructor(e,t){super(),this.debugId=e,this.sourceMeshGroupId=t,this.incrementDetails=new Set}clone(){const e=new n(this.debugId,this.sourceMeshGroupId);return e.incrementDetails=new Set(this.incrementDetails),this.copyDataTo(e),e}getMeshGroupId(){return this.sourceMeshGroupId}makeSceneDebugObject(){let e="",t=!0;this.incrementDetails.forEach((function(i){t||(e+=","),t=!1,e+=i.increment.getFullId()}));return{text:"Increment ranges "+this.debugId+": (incrementIds: ["+e+"], listenForDeletions: "+this.listenForDeletions+")",children:this.getChildSceneDebugObjects()}}isEmpty(){return 0===this.incrementDetails.size}containsIncrement(e){return this.incrementDetails.has(e)}onIncrementAdded(e,t){if(this.incrementDetails.has(e)&&!t)return!1;this.incrementDetails.add(e);const i=s.Ranges.prototype.onIncrementAdded.apply(this,arguments);return this.listenForDeletions&&e.bufferSet.addIncrementDeletionListener(this),i}onIncrementRemoved(e){if(!this.incrementDetails.has(e))return!1;this.incrementDetails.delete(e);const t=s.Ranges.prototype.onIncrementRemoved.apply(this,arguments);return this.listenForDeletions&&!this.bufferSetRanges.has(e.bufferSet)&&e.bufferSet.removeIncrementDeletionListener(this),t}getListenerId(){return this.listenerId}onIncrementDeleted(e){this.onIncrementRemoved(e)}getBounds(e,t){const i=new s.BoundingBox;return this.incrementDetails.forEach((s=>{e.isIncrementBoundable(s,t)&&i.addBox(s.increment.getBounds())})),i}}t.IncrementRanges=n},687070:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectOperator=void 0;const s=i(114924);t.IntersectOperator=class{constructor(){this.operandA=null,this.operandB=null,this.iterator=new s.IntersectIterator}setOperandA(e){this.operandA=e}setOperand(e){this.operandB=e}getRangeIteratorForBufferSet(e){if(!this.operandA||!this.operandB)return null;const t=this.operandA.getRangeIteratorForBufferSet(e);if(!t)return null;const i=this.operandB.getRangeIteratorForBufferSet(e);return i?(this.iterator.reset(t,i),this.iterator):null}makeSceneDebugObject(){const e={text:"IntersectOperator",children:[]};return(0,s.addDebuggableChild)(e,this.operandA),(0,s.addDebuggableChild)(e,this.operandB),e}}},356309:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.IntersectIterator=void 0;const s=i(114924);class n extends s.BooleanIterator{constructor(){super(),this.operandA=null,this.currentARange=null,this.operandB=null,this.currentBRange=null}reset(e,t){this.operandA=e,this.currentARange=null,this.operandB=t,this.currentBRange=null,this.nextResult=this.findNextRange()}findNextRange(){if(this.currentARange||(this.currentARange=this.operandA.getNextRange()),!this.currentARange)return null;for(;this.bIsBehind();)this.currentBRange=this.operandB.getNextRange();if(!this.currentBRange)return null;if(this.currentARange[1]<=this.currentBRange[0])return this.currentARange=null,this.findNextRange();const e=this.getStorageForNextResult();return e[2]=this.currentARange[2],this.currentARange[0]>=this.currentBRange[0]?e[0]=this.currentARange[0]:e[0]=this.currentBRange[0],this.currentARange[1]<=this.currentBRange[1]?(e[1]=this.currentARange[1],this.currentARange[1]===this.currentBRange[1]&&(this.currentBRange=null),this.currentARange=null):(e[1]=this.currentBRange[1],this.currentBRange=null),e}bIsBehind(){return this.currentBRange?this.currentBRange[1]<=this.currentARange[0]:this.operandB.hasMoreRanges()}}t.IntersectIterator=n},584318:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=t.BufferAllocationPolicy=void 0;const s=i(142885),n=i(114924),r=i(315689),a=i(912057),o=i(719347);var c;!function(e){e[e.MINIMUM=0]="MINIMUM",e[e.MEDIUM=1]="MEDIUM",e[e.MAXIMUM=2]="MAXIMUM"}(c||(t.BufferAllocationPolicy=c={}));const l=(0,n.getCounters)();class h extends s.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.bufferSets=[],this.buffersNeedCompilation=!1,this.vertexSize=0,(0,n.viewerCheck)(e),this.bufferAllocationPolicy=t&&void 0!==t.bufferAllocationPolicy?t.bufferAllocationPolicy:c.MINIMUM,this.id=t?t.id:void 0,this.primitiveType=n.PrimitiveType.PRIMITIVE_UNKNOWN,this.incrementToBufferSetIndex=new r.TemplatedCountedMap,this.listenTo(this.viewer.getEventDispatcher(),n.GL_CONTEXT_RESTORED,this.onGlContextRestored),this.listenTo(this.viewer.getEventDispatcher(),n.SESSION_ENDED,this.onGlContextDestroyed)}destroy(){let e;for(e=0;e<this.bufferSets.length;++e)this.bufferSets[e].destroy();this.incrementToBufferSetIndex.clear(),this.stopListening()}getId(){return this.id}onGlContextRestored(e){for(let e=0;e<this.bufferSets.length;++e)this.bufferSets[e].reinitialize()}onGlContextDestroyed(){this.destroy()}getPrimitiveType(){return this.primitiveType}setPrimitiveType(e){this.primitiveType=e}getBuffersNeedCompilation(){return this.buffersNeedCompilation}setBuffersNeedCompilation(){this.buffersNeedCompilation=!0}onPermanentlyRemoved(){this.destroy()}incrementStatisticsForCall(e,t){switch(l.increment(n.CounterNames.DRAW_CALLS,t),this.primitiveType){case n.PrimitiveType.LINES:l.increment(n.CounterNames.LINES,Math.floor(e/6));break;case n.PrimitiveType.POINTS:l.increment(n.CounterNames.POINTS,Math.floor(e/6));break;case n.PrimitiveType.TRIANGLES:l.increment(n.CounterNames.TRIANGLES,Math.floor(e/3));break;case n.PrimitiveType.TRIANGLE_STRIP:l.increment(n.CounterNames.TRIANGLES,e-2)}}getPrimitiveMode(){const e=this.viewer.getGlContext();switch(this.primitiveType){case n.PrimitiveType.POINTS:case n.PrimitiveType.LINES:case n.PrimitiveType.INFINITE_LINES:case n.PrimitiveType.TRIANGLES:case n.PrimitiveType.SILHOUETTES:return e.TRIANGLES;case n.PrimitiveType.TRIANGLE_STRIP:return e.TRIANGLE_STRIP;default:a.log.warn("Unknown mesh primitive type: "+this.primitiveType)}return 0}getAlternatePrimitiveMode(){const e=this.viewer.getGlContext();switch(this.primitiveType){case n.PrimitiveType.LINES:return e.POINTS;case n.PrimitiveType.TRIANGLE_STRIP:return e.LINE_STRIP}return 0}getBufferSetIndexForIncrement(e){return this.incrementToBufferSetIndex.has(e)?this.incrementToBufferSetIndex.get(e):-1}addBufferSet(e){this.bufferSets.push(e),e.setParentMesh(this)}removeBufferSet(e){const t=this.bufferSets.indexOf(e);t>-1&&this.bufferSets.splice(t,1)}removeSimpleBufferSetWithMeshGroupId(e){for(let t=this.bufferSets.length-1;t>=0;t--){const i=this.bufferSets[t];if(i.hasOptimizedBuffers()&&i.getMeshGroupId()===e)return this.bufferSets.splice(t,1),!0}return!1}addIncrement(e){if(!e.getFullId())return a.log.warn("An attempt was made to add a increment without a valid id"),null;if(!this.updateMeshPropertiesFromIncrement(e))return null;const t=this.getBufferSetIndexForIncrement(e.getFullId());if(t>=0&&!this.bufferSets[t].hasOptimizedBuffers()){this.bufferSets[t].deleteIncrement(e.getFullId())}let i=null,s=-1;for(let t=0;t<this.bufferSets.length;++t){if(this.bufferSets[t].hasOptimizedBuffers())continue;if(i=this.bufferSets[t].incorporateIncrement(e),i){s=t;break}}if(s<0){const t=new n.BufferSet(this);i=t.incorporateIncrement(e),i?(s=this.bufferSets.length,this.bufferSets.push(t)):a.log.warn("A new buffer set failed to incorporate a single mesh increment")}return s>=0&&this.incrementToBufferSetIndex.insert(e.getFullId(),s),this.setBuffersNeedCompilation(),i}updateMeshPropertiesFromIncrement(e){if(this.primitiveType===n.PrimitiveType.PRIMITIVE_UNKNOWN)this.primitiveType=e.primitiveType;else if(this.primitiveType!==e.primitiveType)return a.log.warn("Tried to add two different increment types to the same mesh."),!1;const t=e.getVertexSize();if(this.vertexSize){if(this.vertexSize!==t)return a.log.warn("Encountered primitives with different sized vertices in the same mesh"),!1}else this.vertexSize=t;return!0}getIncrementDetails(e){const t=this.getBufferSetIndexForIncrement(e);if(t<0||this.bufferSets[t].hasOptimizedBuffers())return null;return this.bufferSets[t].getIncrementDetails(e)}deleteIncrement(e){const t=this.getBufferSetIndexForIncrement(e);let i=null;if(t<0||this.bufferSets[t].hasOptimizedBuffers())return null;return i=this.bufferSets[t].deleteIncrement(e),this.incrementToBufferSetIndex.remove(e),this.setBuffersNeedCompilation(),i}updateIncrementAttribute(e,t,i){const s=this.getBufferSetIndexForIncrement(t);if(s<0||this.bufferSets[s].hasOptimizedBuffers())return;this.bufferSets[s].updateIncrementAttribute(e,t,i),this.setBuffersNeedCompilation()}extractMeshIncrement(e){const t=this.getBufferSetIndexForIncrement(e);if(t<0||this.bufferSets[t].hasOptimizedBuffers())return null;return this.bufferSets[t].getIncrement(e)}compileBuffers(e){if(!this.buffersNeedCompilation)return;const t=new o.Timer("Mesh.compileBuffers");this.buffersNeedCompilation=!1;let i=!1;for(let e=0;e<this.bufferSets.length;++e){if(this.bufferSets[e].hasOptimizedBuffers())continue;const t=this.bufferSets[e];i=t.updateBuffers()||i,this.buffersNeedCompilation=this.buffersNeedCompilation||t.hasBufferUpdates()}e&&i&&e.setLastBufferBound(null),t.report()}copyOptimizedBuffersToGl(e){let t=!1;for(let e=0;e<this.bufferSets.length;++e)this.bufferSets[e].hasOptimizedBuffers()&&(t=this.bufferSets[e].copyBuffersToGl()||t);e&&t&&e.setLastBufferBound(null)}isEmpty(){return this.incrementToBufferSetIndex.isEmpty()}}t.Mesh=h},151434:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Lod=t.Attributes=t.AttributeNames=t.Attribute=void 0;const s=i(912057),n=i(114924),r=n.GlDataType;class a{constructor(e,t,i,n,r=!1,a=1){this.name=e,this.dimension=t,this.type=i,this.incrementProperty=n,this.normalize=r,this.secondDimension=a,this.elementCount=this.dimension*this.secondDimension,this.secondDimension>1&&this.dimension!==this.secondDimension&&s.log.warn("Only square matrices are supported as glsl attributes. Attribute "+this.name+" will have issues")}typeSize(){return(0,n.sizeOfGlType)(this.type)}sizeInBytes(){return this.elementCount*this.typeSize()}}var o,c;t.Attribute=a,function(e){e.POSITION="aVertexPosition",e.NORMAL="aVertexNormal",e.OFFSET_VECTOR="aOffsetVector",e.COLOR="aVertexColor",e.PICKING="aPickId",e.TEXTURE="aTextureCoordinate",e.HIGHLIGHT_ID="aHighlightId",e.POINT_DATA="aPointData",e.EDGE_DATA="aEdgeData",e.PRIMITIVE_SIZE="aPrimitiveSize",e.PRIMITIVE_STYLE="aPrimitiveStyle",e.PRIMITIVE_RESTART="aPrimitiveRestart",e.OCCURRENCE_ID="aOccurrenceId",e.CONTACT_TRACTION="aContactTraction",e.CONTACT_PAIR_COORDINATE="aContactPairCoordinate"}(o||(t.AttributeNames=o={})),t.Attributes={POINT:new a(o.POSITION,3,r.FLOAT,"points"),NORMAL:new a(o.NORMAL,3,r.FLOAT,"normals"),OFFSET_VECTOR:new a(o.OFFSET_VECTOR,3,r.FLOAT,"offsetVectors"),COLOR:new a(o.COLOR,4,r.UNSIGNED_BYTE,"colors",!0),TEXTURE:new a(o.TEXTURE,2,r.FLOAT,"textureCoordinates"),POINT_DATA:new a(o.POINT_DATA,1,r.FLOAT,"pointData"),EDGE_DATA:new a(o.EDGE_DATA,4,r.FLOAT,"edgeData"),PRIMITIVE_SIZE:new a(o.PRIMITIVE_SIZE,1,r.FLOAT,"primitiveSizes"),PRIMITIVE_STYLE:new a(o.PRIMITIVE_STYLE,4,r.UNSIGNED_BYTE,"primitiveStyles"),HIGHLIGHT_ID:new a(o.HIGHLIGHT_ID,4,r.UNSIGNED_BYTE,"highlightVisibility",!0),CONTACT_TRACTION:new a(o.CONTACT_TRACTION,4,r.UNSIGNED_BYTE,"contactTraction",!1,4),CONTACT_PAIR_COORDINATE:new a(o.CONTACT_PAIR_COORDINATE,4,r.FLOAT,"contactPairCoordinate",!1,4)},function(e){e.LOWEST="LOWEST",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH",e.DEFAULT="MEDIUM"}(c||(t.Lod=c={}))},154669:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MeshIncrement=t.makeFullId=void 0;const s=i(264292),n=i(912057),r=i(573879),a=i(723617),o=i(613199),c=i(114924),l=c.Attributes,h={globallyUniqueId:!0,pickId:!0,properties:!0},d=s.mat3.create(),u=s.mat4.create(),g=s.vec3.create(),p=s.vec3.create();Math.pow(2,16);function m(e,t){return t?t+"."+e:e}t.makeFullId=m;let E=1;const I=function(e,t,i,s,n,r,a,o,c,l,h,d,u,g){return t[3*e+0]=o[0],t[3*e+1]=o[1],t[3*e+2]=o[2],c&&(i[3*e+0]=c[0],i[3*e+1]=c[1],i[3*e+2]=c[2]),l&&(s[4*e+0]=l[0],s[4*e+1]=l[1],s[4*e+2]=l[2],s[4*e+3]=l[3]),null!==h&&(n[e]=h),d&&(r[4*e+0]=d[0],r[4*e+1]=d[1],r[4*e+2]=d[2],r[4*e+3]=d[3]),a[4*e+0]=u[0],a[4*e+1]=u[1],a[4*e+2]=u[2],a[4*e+3]=g,e+1},T=s.vec3.create(),S=s.vec3.create(),f=s.vec3.create(),C=s.vec3.create(),P=s.vec4.create(),v=s.vec4.create(),D=s.vec3.create(),M=s.vec3.create(),y=s.vec4.create(),O=s.vec4.create(),_=s.vec3.create(),A=s.vec3.create(),R=s.vec3.create();class N{constructor(e,t,i,s,n){this.primitiveType=e,this.points=t,this.properties={},this.id=s||"",this.indices=i,n||this.prepareForBuffering()}clone(e){const t=new N(this.primitiveType,this.points,this.indices,this.id,!0);(0,a.overwriteMatchingProperties)(t,this,h);for(const e in this.properties)h[e]||(t.properties[e]=this.properties[e]);return e&&(t.ownerId=e),t}setProperty(e,t){null==t?delete this.properties[e]:this.properties[e]=t}set indices(e){this.setProperty("indices",e)}get indices(){return this.properties.indices||null}set normals(e){this.setProperty("normals",e)}get normals(){return this.properties.normals||null}set offsetVectors(e){this.setProperty("offsetVectors",e)}get offsetVectors(){return this.properties.offsetVectors||null}set colors(e){this.setProperty("colors",e)}get colors(){return this.properties.colors||null}set textureCoordinates(e){this.setProperty("textureCoordinates",e)}get textureCoordinates(){return this.properties.textureCoordinates||null}set primitiveSizes(e){this.setProperty("primitiveSizes",e)}get primitiveSizes(){return this.properties.primitiveSizes||null}set primitiveStyles(e){this.setProperty("primitiveStyles",e)}get primitiveStyles(){return this.properties.primitiveStyles||null}set contactTraction(e){this.setProperty("contactTraction",e)}get contactTraction(){return this.properties.contactTraction||null}set contactPairCoordinate(e){this.setProperty("contactPairCoordinate",e)}get contactPairCoordinate(){return this.properties.contactPairCoordinate||null}set pointData(e){this.setProperty("pointData",e)}get pointData(){return this.properties.pointData||null}set edgeData(e){this.setProperty("edgeData",e)}get edgeData(){return this.properties.edgeData||null}set pickId(e){this.setProperty("pickId",e)}get pickId(){return this.properties.pickId||void 0}set groupId(e){this.setProperty("groupId",e)}get groupId(){return this.properties.groupId||""}set ownerId(e){this.setProperty("ownerId",e)}get ownerId(){return this.properties.ownerId||""}set boundingBox(e){this.setProperty("boundingBox",e)}get boundingBox(){return this.properties.boundingBox||null}set globallyUniqueId(e){this.setProperty("globallyUniqueId",e)}get globallyUniqueId(){return this.properties.globallyUniqueId||null}set lod(e){this.setProperty("lod",e)}get lod(){return this.properties.lod||c.Lod.DEFAULT}getFullId(){return m(this.id,this.ownerId)}getFullGroupId(){return m(this.groupId,this.ownerId)}getPoint(e,t){const i=3*e;return e<0||i>=this.points.length?null:t?(t[0]=this.points[i],t[1]=this.points[i+1],t[2]=this.points[i+2],t):this.points instanceof Float32Array?this.points.subarray(i,i+3):this.points.slice(i,i+3)}getLinesLength(){if(this.primitiveType!==c.PrimitiveType.LINES)return-1;this.isPreparedForBuffering()||this.prepareForBuffering();let e=0;for(let t=0;t<this.indices.length;t+=6)e+=o.vec3C.dist(this.getPoint(this.indices[t+0]),this.getPoint(this.indices[t+1]));return e}getPositionAtDistanceAlongLines(e){if(this.primitiveType!==c.PrimitiveType.LINES)return null;this.isPreparedForBuffering()||this.prepareForBuffering();let t=0;for(let i=0;i<this.indices.length;i+=6){const n=this.getPoint(this.indices[i+0]),r=this.getPoint(this.indices[i+1]),a=o.vec3C.dist(n,r);if(t+a>=e){const i=(e-t)/a;return o.vec3C.add(n,o.vec3C.scale(o.vec3C.subtract(r,n,s.vec3.create()),i),s.vec3.create())}t+=a}return null}getLineDirection(e){if(!this.isLines())return null;if(this.isPreparedForBuffering()||this.prepareForBuffering(),e<0||6*(e+1)>this.indices.length)return null;const t=6*e,i=o.vec3C.subtract(this.getPoint(this.indices[t+1]),this.getPoint(this.indices[t+0]),s.vec3.create());return o.vec3C.normalize(i)}getRepresentativeDirection(){return this.isLines()?this.getLineDirection(0):this.isTriangles()&&this.normals&&this.normals.length>=3?this.normals instanceof Float32Array?this.normals.subarray(0,3):this.normals.slice(0,3):null}equals(e){return!(!e||this.primitiveType!==e.primitiveType)&&(this.id===e.id&&(0,r.arraysEqual)(this.pickId,e.pickId)&&(0,r.arraysEqual)(this.points,e.points)&&(0,r.arraysEqual)(this.indices,e.indices)&&(0,r.arraysEqual)(this.normals,e.normals)&&(0,r.arraysEqual)(this.offsetVectors,e.offsetVectors)&&(0,r.arraysEqual)(this.colors,e.colors)&&(0,r.arraysEqual)(this.textureCoordinates,e.textureCoordinates)&&(0,r.arraysEqual)(this.primitiveSizes,e.primitiveSizes)&&(0,r.arraysEqual)(this.primitiveStyles,e.primitiveStyles)&&(0,r.arraysEqual)(this.pointData,e.pointData)&&(0,r.arraysEqual)(this.edgeData,e.edgeData))}getBounds(){if(!this.boundingBox){this.boundingBox=new c.BoundingBox;for(let e=0;e<this.points.length;e+=3)this.boundingBox.addXYZ(this.points[e],this.points[e+1],this.points[e+2])}return this.boundingBox}getGloballyUniqueId(){return this.globallyUniqueId||(this.globallyUniqueId=E,E+=1),this.globallyUniqueId}isPreparedForBuffering(){return this.isTriangles()||this.isPoints()&&!!this.pointData||this.isLines()&&!!this.edgeData}hasAttribute(e){return!!(this.isLines()&&"edgeData"===e||this.isPoints()&&"pointData"===e)||!!this[e]}getPrimitiveType(){return this.primitiveType}prepareForBuffering(){this.points&&this.indices&&!this.pointData&&this.isPoints()&&this.createPointData(),this.points&&this.indices&&!this.edgeData&&this.isLines()&&this.createEdgeData()}isPoints(){return this.primitiveType===c.PrimitiveType.POINTS}isLines(){return this.primitiveType===c.PrimitiveType.LINES||this.primitiveType===c.PrimitiveType.INFINITE_LINES||this.primitiveType===c.PrimitiveType.SILHOUETTES}isTriangles(){return this.primitiveType===c.PrimitiveType.TRIANGLES||this.primitiveType===c.PrimitiveType.TRIANGLE_STRIP}getTriangleCount(){return this.primitiveType===c.PrimitiveType.TRIANGLES?this.indices.length/3:this.primitiveType===c.PrimitiveType.TRIANGLE_STRIP?this.indices.length-2:0}getLineCount(){return this.isLines()?this.isPreparedForBuffering()?this.indices.length/6:this.indices.length/2:0}createPointData(){const e=this.indices.length,t=4*e,i=6*e,s=new Float32Array(l.POINT.dimension*t),n=new Int32Array(i),r=this.colors?new Uint8Array(l.COLOR.dimension*t):null,a=this.primitiveSizes?new Float32Array(l.PRIMITIVE_SIZE.dimension*t):null,o=this.primitiveStyles?new Uint8Array(l.PRIMITIVE_STYLE.dimension*t):null,c=new Float32Array(l.POINT_DATA.dimension*t);let h=0;const d=function(e,t,i,n,l){s[3*h+0]=e[0],s[3*h+1]=e[1],s[3*h+2]=e[2],t&&(r[4*h+0]=t[0],r[4*h+1]=t[1],r[4*h+2]=t[2],r[4*h+3]=t[3]),null!==i&&(a[h]=i),n&&(o[4*h+0]=n[0],o[4*h+1]=n[1],o[4*h+2]=n[2],o[4*h+3]=n[3]),c[h]=l,h+=1};let u=0;for(let t=0;t<e;++t){const e=this.indices[t],i=[this.points[3*e+0],this.points[3*e+1],this.points[3*e+2]];let s=null;if(this.colors){s=[this.colors[4*e+0],this.colors[4*e+1],this.colors[4*e+2],this.colors[4*e+3]]}let r=null;this.primitiveSizes&&(r=this.primitiveSizes[4*e]);let a=null;if(this.primitiveStyles){a=[this.primitiveStyles[4*e+0],this.primitiveStyles[4*e+1],this.primitiveStyles[4*e+2],this.primitiveStyles[4*e+3]]}d(i,s,r,a,1),d(i,s,r,a,2),d(i,s,r,a,3),d(i,s,r,a,4),n[6*t+0]=u+0,n[6*t+1]=u+1,n[6*t+2]=u+2,n[6*t+3]=u+0,n[6*t+4]=u+2,n[6*t+5]=u+3,u+=4}this.points=s,this.indices=n,this.colors=r,this.primitiveSizes=a,this.primitiveStyles=o,this.pointData=c,this.normals=null,this.textureCoordinates=null}createEdgeData(){this.indices.length%2!=0&&n.log.warn("Trying to create lines with an odd number of indices");const e=Math.floor(this.indices.length/2),t=4*e,i=6*e,r=new Float32Array(l.POINT.dimension*t),a=new Int32Array(i),h=this.normals?new Float32Array(l.NORMAL.dimension*t):null,d=this.colors?new Uint8Array(l.COLOR.dimension*t):null,u=this.primitiveSizes?new Float32Array(l.PRIMITIVE_SIZE.dimension*t):null,g=this.primitiveStyles?new Uint8Array(l.PRIMITIVE_STYLE.dimension*t):null,p=new Float32Array(l.EDGE_DATA.dimension*t);let m=0,E=0,_=1;for(let t=0;t<e;++t){const e=this.indices[2*t+0],i=s.vec3.set(f,this.points[3*e+0],this.points[3*e+1],this.points[3*e+2]),n=this.normals?s.vec3.set(C,this.normals[3*e+0],this.normals[3*e+1],this.normals[3*e+2]):null,l=this.colors?s.vec4.set(P,this.colors[4*e+0],this.colors[4*e+1],this.colors[4*e+2],this.colors[4*e+3]):null,A=this.primitiveSizes?this.primitiveSizes[e]:null,R=this.primitiveStyles?s.vec4.set(v,this.primitiveStyles[4*e+0],this.primitiveStyles[4*e+1],this.primitiveStyles[4*e+2],this.primitiveStyles[4*e+3]):null,N=this.indices[2*t+1];let w=s.vec3.set(D,this.points[3*N+0],this.points[3*N+1],this.points[3*N+2]);const b=this.normals?s.vec3.set(M,this.normals[3*N+0],this.normals[3*N+1],this.normals[3*N+2]):null,L=this.colors?s.vec4.set(y,this.colors[4*N+0],this.colors[4*N+1],this.colors[4*N+2],this.colors[4*N+3]):null,B=this.primitiveSizes?this.primitiveSizes[N]:null,F=this.primitiveStyles?s.vec4.set(O,this.primitiveStyles[4*N+0],this.primitiveStyles[4*N+1],this.primitiveStyles[4*N+2],this.primitiveStyles[4*N+3]):null,x=o.vec3C.subtract(w,i,T),U=o.vec3C.length(x);o.vec3C.normalize(x);let G=_;_+=U;let V=_;this.primitiveType===c.PrimitiveType.INFINITE_LINES&&(G=-G,V=-V,w=i),m=I(m,r,h,d,u,g,p,i,n,l,A,R,o.vec3C.scale(x,1,S),G),m=I(m,r,h,d,u,g,p,w,b,L,B,F,o.vec3C.scale(x,2,S),V),m=I(m,r,h,d,u,g,p,w,b,L,B,F,o.vec3C.scale(x,3,S),V),m=I(m,r,h,d,u,g,p,i,n,l,A,R,o.vec3C.scale(x,4,S),G),a[6*t+0]=E+0,a[6*t+1]=E+1,a[6*t+2]=E+2,a[6*t+3]=E+0,a[6*t+4]=E+2,a[6*t+5]=E+3,E+=4}this.points=r,this.indices=a,this.normals=h,this.colors=d,this.primitiveSizes=u,this.primitiveStyles=g,this.edgeData=p,this.textureCoordinates=null}createTransformed(e){let t;const i=[0,0,0],s=o.mat4C.toMat3(o.mat4C.toRotationMat(e,u),d),n=this.clone();for(n.boundingBox=null,n.points=new Float32Array(n.points.length),t=0;t<this.points.length;t+=3)i[0]=this.points[t],i[1]=this.points[t+1],i[2]=this.points[t+2],o.mat4C.multiplyVec3(e,i),n.points[t]=i[0],n.points[t+1]=i[1],n.points[t+2]=i[2];function r(e){const n=new Float32Array(e.length);for(t=0;t<e.length;t+=3)i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2],o.mat3C.multiplyVec3(s,i),o.vec3C.normalize(i),n[t]=i[0],n[t+1]=i[1],n[t+2]=i[2];return n}if(this.normals&&(n.normals=r(this.normals)),this.offsetVectors&&(n.offsetVectors=r(this.offsetVectors)),this.edgeData){const e=this.edgeData,r=new Float32Array(n.edgeData.length);for(t=0;t<this.edgeData.length;t+=4){i[0]=e[t],i[1]=e[t+1],i[2]=e[t+2];const n=o.vec3C.length(i);o.mat3C.multiplyVec3(s,i),o.vec3C.scale(i,n/o.vec3C.length(i)),r[t]=i[0],r[t+1]=i[1],r[t+2]=i[2],r[t+3]=this.edgeData[t+3]}n.edgeData=r}return n}concatenate(e){if(!(e&&e.primitiveType===this.primitiveType&&(0,a.objectsDefinedInSameWay)(this.normals,e.normals)&&(0,a.objectsDefinedInSameWay)(this.offsetVectors,e.offsetVectors)&&(0,a.objectsDefinedInSameWay)(this.colors,e.colors)&&(0,a.objectsDefinedInSameWay)(this.textureCoordinates,e.textureCoordinates)&&(0,a.objectsDefinedInSameWay)(this.primitiveSizes,e.primitiveSizes)&&(0,a.objectsDefinedInSameWay)(this.primitiveStyles,e.primitiveStyles)&&(0,a.objectsDefinedInSameWay)(this.edgeData,e.edgeData)&&(0,a.objectsDefinedInSameWay)(this.pointData,e.pointData)))return null;const t=(0,c.concatenateFloat32Arrays)(this.points,e.points),i=new Int32Array(this.indexLengthWithDegenerates()+e.indices.length);i.set(this.indices);const s=this.indexLengthWithDegenerates(),n=this.vertexCount();for(let t=0;t<e.indices.length;++t)i[s+t]=e.indices[t]+n;this.primitiveType===c.PrimitiveType.TRIANGLE_STRIP&&(i[s-2]=this.indices[this.indices.length-1],this.indices.length%2&&(i[s-3]=this.indices[this.indices.length-1]),i[s-1]=e.indices[0]+n);const r=new N(this.primitiveType,t,i,void 0,!0);return this.normals&&e.normals&&(r.normals=(0,c.concatenateFloat32Arrays)(this.points,e.points)),this.colors&&e.colors&&(r.colors=(0,c.concatenateUint8Arrays)(this.colors,e.colors)),this.textureCoordinates&&e.textureCoordinates&&(r.textureCoordinates=(0,c.concatenateFloat32Arrays)(this.textureCoordinates,e.textureCoordinates)),this.primitiveSizes&&e.primitiveSizes&&(r.primitiveSizes=(0,c.concatenateFloat32Arrays)(this.primitiveSizes,e.primitiveSizes)),this.primitiveStyles&&e.primitiveStyles&&(r.primitiveStyles=(0,c.concatenateUint8Arrays)(this.primitiveStyles,e.primitiveStyles)),this.edgeData&&e.edgeData&&(r.edgeData=(0,c.concatenateFloat32Arrays)(this.edgeData,e.edgeData)),this.pointData&&e.pointData&&(r.pointData=(0,c.concatenateFloat32Arrays)(this.pointData,e.pointData)),this.offsetVectors&&e.offsetVectors&&(r.offsetVectors=(0,c.concatenateFloat32Arrays)(this.offsetVectors,e.offsetVectors)),r}indexLengthWithDegenerates(){return this.primitiveType===c.PrimitiveType.TRIANGLE_STRIP?this.indices.length%2==0?this.indices.length+2:this.indices.length+3:this.indices.length}vertexCount(){return this.points.length/l.POINT.dimension}getPreparedVertexCount(){return this.isPreparedForBuffering()?this.vertexCount():4*this.vertexCount()}getPreparedIndexCount(){if(this.isPreparedForBuffering())return this.indexLengthWithDegenerates();if(this.isLines()){return 6*Math.floor(this.indices.length/2)}return this.isPoints()?6*this.indices.length:(n.log.warn("Found unprepared increment that was not lines or points"),this.indexLengthWithDegenerates())}getVertexSize(){let e=0;for(const t in c.Attributes){const i=c.Attributes[t];(this.hasAttribute(i.incrementProperty)||i.name===c.AttributeNames.OCCURRENCE_ID)&&(e+=i.sizeInBytes())}return e}iteratePrimitives(e){switch(this.primitiveType){case c.PrimitiveType.POINTS:this.iteratePoints(e);break;case c.PrimitiveType.LINES:this.iterateLines(e);break;case c.PrimitiveType.TRIANGLES:this.iterateTriangles(e);break;case c.PrimitiveType.TRIANGLE_STRIP:this.iterateTriangleStrip(e);break;default:n.log.warn("Cannot iterate over primitive type "+this.primitiveType)}}iteratePoints(e){this.prepareForBuffering();for(let t=0;t<this.indices.length;t+=6)e(this.getPoint(this.indices[t],_))}iterateLines(e){this.prepareForBuffering();for(let t=0;t<this.indices.length;t+=6)e(this.getPoint(this.indices[t],_),this.getPoint(this.indices[t+1],A))}iterateTriangles(e){const t=Math.floor(this.indices.length/3);for(let i=0;i<3*t;i+=3)e(this.getPoint(this.indices[i],_),this.getPoint(this.indices[i+1],A),this.getPoint(this.indices[i+2],R))}iterateTriangleStrip(e){for(let t=0;t<this.indices.length-2;++t)this.indices[t]!==this.indices[t+1]&&this.indices[t]!==this.indices[t+2]&&this.indices[t+1]!==this.indices[t+2]&&(t%2?e(this.getPoint(this.indices[t],_),this.getPoint(this.indices[t+2],A),this.getPoint(this.indices[t+1],R)):e(this.getPoint(this.indices[t],_),this.getPoint(this.indices[t+1],A),this.getPoint(this.indices[t+2],R)))}getPositionNearCenter(){return this.getPositionNearPoint(this.getBounds().center()).position}getPositionNearPoint(e){let t=null,i=1/0;function n(n){const r=o.vec3C.distanceSquared(e,n);r<i&&(t=s.vec3.clone(n),i=r)}function r(t,i){n((0,c.closestPointOnLine)(t,i,e))}return this.iteratePrimitives((function(e,t,i){t||i?i?function(e,t,i){r(e,t),r(t,i),r(i,e);const s=g;o.vec3C.add(s,o.vec3C.scale(e,1/3,p)),o.vec3C.add(s,o.vec3C.scale(t,1/3,p)),o.vec3C.add(s,o.vec3C.scale(i,1/3,p)),n(s)}(e,t,i):r(e,t):n(e)})),{position:t,distance:i}}packScalarsIntoTextureCoordinates(e){const t=new Float32Array(this.vertexCount()*c.Attributes.TEXTURE.dimension);if(e.length!==this.vertexCount())return void n.log.debug(`Scalars of length ${e.length} did not match increment vertex count of ${this.vertexCount()}`);const i=[1,0];for(let s=0;s<this.vertexCount();++s)i[1]=e[s],t.set(i,c.Attributes.TEXTURE.dimension*s);this.textureCoordinates=t}replicateTextureCoordinate(e){const t=new Float32Array(this.vertexCount()*c.Attributes.TEXTURE.dimension);for(let i=0;i<this.vertexCount();++i)t.set(e,c.Attributes.TEXTURE.dimension*i);this.textureCoordinates=t}}t.MeshIncrement=N},388456:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.MeshManager=t.getNewOwnerId=t.nextOwnerId=void 0;const s=i(719347),n=i(736234),r=i(114924),a=i(912057),o=i(90753);t.nextOwnerId=1,t.getNewOwnerId=function(){const e=t.nextOwnerId.toString();return++t.nextOwnerId,e};class c{constructor(e,t){this.viewer=e,this.meshCreationOptions=t,this.meshes={},this.incrementIdToMesh={},this.groupRanges={},this.ownsMeshes=!0,this.groupRangesIdToBufferSet=null}destroy(){if(this.ownsMeshes)for(const e in this.meshes)this.meshes[e].destroy();for(const e in this.groupRanges)this.groupRanges[e].destroy()}getBufferSetForGroup(e,t,i,s){const n=this.getGroupRangesId(e,t,i,s);return this.groupRangesIdToBufferSet?this.groupRangesIdToBufferSet.get(n):(a.log.warn("groupRangesIdToBufferSet is null for body/featureId: "+e+", ownerId: "+t+", primitiveType: "+i+", lod: "+s),null)}cloneForPreview(e){const t=new c(this.viewer,this.meshCreationOptions);t.ownsMeshes=!1,t.meshes=(0,n.clone)(this.meshes),t.incrementIdToMesh=(0,n.clone)(this.incrementIdToMesh);for(const i in this.groupRanges){this.groupRanges[i].getOwnerId()===e&&(t.groupRanges[i]=this.groupRanges[i].cloneForPreview())}return t}addMeshIncrement(e,t,i){this.removeMeshIncrement(e.id,t),e.ownerId=t;const s=(0,o.getMeshSetId)(e);let n=this.meshes[s];n||(this.meshes[s]=n=new r.Mesh(this.viewer,this.meshCreationOptions));const a=n.addIncrement(e);if(a){this.incrementIdToMesh[e.getFullId()]=n;const t=this.getGroupRangesForIncrement(e);t&&(t.onIncrementAdded(a),i&&t.setBounds(i))}return a}addBufferSet(e,t,i,s,n){if(!e||!t)return;const a=(0,o.getMeshSetId)(t);let c=this.meshes[a];const l=t.getPrimitiveType();c||(this.meshes[a]=c=new r.Mesh(this.viewer,this.meshCreationOptions),c.setPrimitiveType(l)),c.removeSimpleBufferSetWithMeshGroupId(e.getMeshGroupId()),c.addBufferSet(e);const h=this.getGroupRangesId(i,s,l,r.Lod.DEFAULT);this.groupRangesIdToBufferSet||(this.groupRangesIdToBufferSet=new Map),this.groupRangesIdToBufferSet.set(h,e)}getIncrementDetails(e,t){const i=(0,r.makeFullId)(e,t),s=this.incrementIdToMesh[i];return s?s.getIncrementDetails(i):null}removeMeshIncrement(e,t){const i=(0,r.makeFullId)(e,t),s=this.incrementIdToMesh[i];let n=null;if(s){if(n=s.deleteIncrement(i),n){const e=this.getGroupRangesForIncrement(n.increment);e&&e.onIncrementRemoved(n)}delete this.incrementIdToMesh[i]}return n}getGroupRangesForIncrement(e){return e.groupId?this.getOrCreateGroupRangesForGroupTypeAndLod(e.groupId,e.ownerId,e.primitiveType,e.lod):null}getGroupRangesId(e,t,i,s){return e+"."+t+"."+i+"."+s}getOrCreateGroupRangesForGroupTypeAndLod(e,t,i,s){const n=this.getGroupRangesId(e,t,i,s);let a=this.groupRanges[n];return a||(this.groupRanges[n]=a=new r.GroupRanges(e,t,i,s)),a}getGroupRangesForGroupTypeAndLod(e,t,i,s){const n=this.getGroupRangesId(e,t,i,s);return this.groupRanges[n]||null}removeEmptyMeshes(){const e=[];let t=null;for(t in this.meshes)this.meshes[t].isEmpty()&&e.push(t);for(let i=0;i<e.length;++i)t=e[i],this.meshes[t].destroy(),delete this.meshes[t]}getMeshForIncrement(e){return this.meshes[(0,o.getMeshSetId)(e)]||null}compileBuffers(){const e=new s.Timer("MeshManager: Compiling Vertex Buffers");for(const e in this.meshes)this.meshes[e].compileBuffers();e.report()}}t.MeshManager=c},36264:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},697608:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},941196:function(e,t){Object.defineProperty(t,"__esModule",{value:!0})},186949:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Ranges=void 0;const s=i(114924),n=i(608521);t.Ranges=class{constructor(){this.bufferSetRanges=new n.FastIteratorMap,this.boundables=new Set,this.iterator=new s.RangeSetIterator,this.listenForDeletions=!1,this.listenerId=(0,s.incrementListenerIdCounter)()}getMeshGroupId(){return null}destroy(){this.setListenForDeletions(!1)}copyDataTo(e){const t=this.bufferSetRanges.getKeyValues();for(let i=0;i<t.length;i+=2)e.bufferSetRanges.set(t[i],(0,s.cloneStyledRangeSet)(t[i+1]));e.boundables=new Set(this.boundables),e.setListenForDeletions(this.listenForDeletions)}getListenerId(){return this.listenerId}onIncrementDeleted(e){this.onIncrementRemoved(e)}setListenForDeletions(e){if(this.listenForDeletions===e)return;this.listenForDeletions=e;const t=this.bufferSetRanges.getKeyValues();for(let e=0;e<t.length;e+=2)this.listenForDeletions?t[e].addIncrementDeletionListener(this):t[e].removeIncrementDeletionListener(this)}isEmpty(){return 0===this.bufferSetRanges.size}onIncrementAdded(e,t){let i=this.bufferSetRanges.get(e.bufferSet);i||(i=[],this.bufferSetRanges.set(e.bufferSet,i));let n=e.indexRange;return t&&(n=[n[0],n[1],t]),(0,s.insertStyledRange)(n,i),this.damageBounds(),!0}onIncrementRemoved(e){const t=this.bufferSetRanges.get(e.bufferSet);return!!t&&((0,s.removeStyledRange)(e.indexRange,t),0===t.length&&this.bufferSetRanges.delete(e.bufferSet),this.damageBounds(),!0)}addBoundable(e){this.boundables.add(e)}removeBoundable(e){this.boundables.delete(e)}damageBounds(){for(const e of this.boundables.values())e.damageBounds()}isCheaplyBoundable(){return!1}getRangeIteratorForBufferSet(e){const t=this.bufferSetRanges.get(e);return t?(this.iterator.resetForRangeSet(t),this.iterator):null}shouldDrawForOccurrences(e){return!0}draw(e,t){const i=this.bufferSetRanges.getKeyValues();for(let s=0;s<i.length;s+=2)i[s].draw(e,t||this)}getChildSceneDebugObjects(){const e=[],t=this.bufferSetRanges.getKeyValues();for(let i=0;i<t.length;i+=2)e.push({text:"Buffer set "+t[i].getDebugId()+" ranges: ("+(0,s.toString)(t[i+1])+")",children:[]});return e}}},837454:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Node=t.cleanUpParentlessNodes=t.addParentlessNode=t.NodeProperties=t.RenderOrderPriority=void 0;const s=i(114924),n=i(545348),r=i(723617),a=i(608521),o=i(912057),c=i(264292),l=i(613199),h=i(415592),d=n.default.getManager();var u;!function(e){e[e.LOWER=0]="LOWER",e[e.DEFAULT=1]="DEFAULT",e[e.HIGHER=2]="HIGHER",e[e.HIGHEST=3]="HIGHEST",e[e.COUNT=4]="COUNT"}(u||(t.RenderOrderPriority=u={}));const g=Math.ceil(Math.log(u.COUNT)/Math.log(2)),p=new s.BitShiftId;class m{constructor(e){this.isVisible=!0,this.isPickable=!0,this.isHighlightable=!0,this.isTwoSided=!1,this.isTintedByCompare=!1,this.isShowThrough=!1,this.isDepthTested=!0,this.isStencilTested=!1,this.isStencilWritten=!0,this.clippedBySectionPlanes=!1,this.addsToSectionMask=!0,this.primitivesHaveTransparency=!1,this.zOffset=0,this.pickZOffset=0,this.addsToBounds=!0,this.includedInBlend=!1,this.priority=u.DEFAULT,this.primitiveType=s.PrimitiveType.PRIMITIVE_UNKNOWN,this.material=s.DEFAULT_MATERIAL,this.initializeFromProperties(e),this.updateId()}initializeFromProperties(e){e&&(0,r.overwriteMatchingProperties)(this,e),(null==e?void 0:e.hasOwnProperty("pickZOffset"))||(this.pickZOffset=this.zOffset)}clone(){return new m(this)}cloneAndModify(e){const t=new m(this);return t.initializeFromProperties(e),t.updateId(),t}toString(e){return e?(this.primitiveType!==s.PrimitiveType.PRIMITIVE_UNKNOWN?"primitiveType:"+(0,s.getPrimitiveTypeDescription)(this.primitiveType):"")+(this.material?",m:"+this.material.id:""):"NodeProperties: primitiveType:"+(0,s.getPrimitiveTypeDescription)(this.primitiveType)+",m:"+(this.material?this.material.id:"null")+",iV:"+this.isVisible+",iP:"+this.isPickable+",iH:"+this.isHighlightable+",iTS:"+this.isTwoSided+",iTBC:"+this.isTintedByCompare+",iShTh:"+this.isShowThrough+",iDT:"+this.isDepthTested+",iStTe:"+this.isStencilTested+",iStWr:"+this.isStencilWritten+",cBSP:"+this.clippedBySectionPlanes+",aTSM:"+this.addsToSectionMask+",pHT:"+this.primitivesHaveTransparency+",p:"+this.priority+",zO:"+this.zOffset+",pZO:"+this.pickZOffset+",aTB:"+this.addsToBounds+",iIB:"+this.includedInBlend}makeSceneDebugObject(){const e=[];return e.push((0,s.createTextDebugObject)("primitiveType",(0,s.getPrimitiveTypeDescription)(this.primitiveType))),e.push(this.material?this.material.makeSceneDebugObject():(0,s.createTextDebugObject)("material",null)),(0,s.addChildDebugObjectsFromProperties)(e,this,{id:!0,primitiveType:!0,material:!0}),{text:"[Node properties] "+this.id+" "+this.toString(!0),children:e}}updateId(){p.reset(),p.addBoolean(this.isVisible),p.addBoolean(this.isPickable),p.addBoolean(this.isHighlightable),p.addBoolean(this.isTwoSided),p.addBoolean(this.isShowThrough),p.addBoolean(this.isDepthTested),p.addBoolean(this.isStencilTested),p.addBoolean(this.isStencilWritten),p.addBoolean(this.clippedBySectionPlanes),p.addBoolean(this.addsToSectionMask),p.addBoolean(this.primitivesHaveTransparency),p.addBoolean(this.includedInBlend),p.addNumber(this.priority,g),p.addNumber(this.primitiveType,s.PRIMITIVE_TYPE_BITS),p.addNumber(this.zOffset+31,6),p.addNumber(this.pickZOffset+31,6),Math.abs(this.zOffset)>31&&o.log.warn("zOffset "+this.zOffset+" could result in a duplicate node id, resulting in bad z offset state"),Math.abs(this.pickZOffset)>31&&o.log.warn("pickZOffset "+this.pickZOffset+" could result in a duplicate node id, resulting in bad pick z offset state"),p.addBoolean(this.addsToBounds);let e=p.getId();this.material&&(e=p.getIdWithIdAppended(this.material.id)),this.id=e}}t.NodeProperties=m;let E=[];function I(e){E.push(e)}t.addParentlessNode=I,t.cleanUpParentlessNodes=function(){for(let e=0;e<E.length;++e){const t=E[e];t&&!t.getParent()&&t.onPermanentlyRemoved()}E=[]};class T{constructor(e,t,i){this.id=e,this.pose=null,this.children=null,this.childMap={},this.parent=null,this.areBoundsDamaged=!1,this.nodeOccurrences=null,this.usage=void 0!==i?i:s.BTGraphicsUsage.BASE,this.properties=new m(t),this.boundingBox=new s.BoundingBox}integrityCheck(){this.nodeOccurrences&&this.children&&this.children.length>0&&o.log.error("Found non-leaf scenegraph node with a node occurrences. Node id: "+this.id)}getId(){return this.id}setPose(e){e&&this.pose&&c.mat4.equals(e,this.pose)||(this.pose=e,this.damageBounds())}getPose(){return this.pose}damageBounds(){this.areBoundsDamaged||(this.areBoundsDamaged=!0,this.parent&&this.parent.damageBounds())}getUsage(){return this.usage}updateBounds(e){const t=!!e&&!!e.includeHiddenBounds;if(this.areBoundsDamaged||t)if(this.boundingBox.reset(),this.nodeOccurrences){if(this.getAddsToBounds()||t){const t=this.nodeOccurrences.getKeyValues();for(let i=0;i<t.length;i+=2)t[i+1].addBounds(this.boundingBox,e)}this.areBoundsDamaged=!1}else if(this.children){this.areBoundsDamaged=!1;for(let t=0;t<this.children.length;++t){const i=this.children[t].getBoundingBox(e);this.children[t].getIsVisible()&&this.children[t].getAddsToBounds()&&(0,s.isValidForBounding)(i)&&(this.boundingBox.addBox(i,this.pose),this.areBoundsDamaged=this.areBoundsDamaged||this.children[t].areBoundsDamaged)}}}getBoundingBox(e){return(this.areBoundsDamaged||e&&e.includeHiddenBounds)&&this.updateBounds(e),this.boundingBox}getOccurrenceBounds(e,t){if(this.getAddsToBounds())if(this.nodeOccurrences){const i=this.nodeOccurrences.get(e);i&&i.addBounds(t)}else if(this.children)for(let i=0;i<this.children.length;++i)this.children[i].getOccurrenceBounds(e,t)}addChild(e,t){if(e){switch(this.children||(this.children=[]),void 0===t?this.children.push(e):(t=(0,s.clamp)(Math.round(t),0,this.children.length),this.children.splice(t,0,e)),this.childMap[e.id]=e,e.parent=this,e.usage){case s.BTGraphicsUsage.PREVIEW:this.usage!==s.BTGraphicsUsage.PREVIEW&&o.log.warn("Adding PREVIEW node to non-PREVIEW node (usage "+this.usage+")");break;case s.BTGraphicsUsage.BASE:e.usage=this.usage}this.damageBounds(),this.integrityCheck()}else o.log.warn("A scenegraph node cannot add a null child")}findOrCreateChildNodeByProperties(e){const t=e.id.toString();let i=this.getChildById(t);return i||(i=new T(t.toString(),e,this.usage),this.addChild(i)),i}addOccurrenceGeometryToNode(e,t,i,s,n,r){const a=this.findOrCreateChildNodeByProperties(e),o=a.findOrCreateNodeOccurrenceByData(t).addStyledMeshRanges(i,s,n,r);return a.damageBounds(),o}addOccurrenceBufferSetToNode(e,t,i,s){const n=this.findOrCreateChildNodeByProperties(e),r=n.findOrCreateNodeOccurrenceByData(t),a=new h.StyledSimpleBufferSet(r,i,s);return r.addStyledBufferSet(a),n.damageBounds(),a}findOrCreateNodeOccurrenceByData(e){this.nodeOccurrences||(this.nodeOccurrences=new a.FastIteratorMap);let t=this.nodeOccurrences.get(e.getOccurrenceId());return t||(t=new s.NodeOccurrence(this,e),this.nodeOccurrences.set(e.getOccurrenceId(),t)),t}removeOccurrenceFromNode(e,t){const i=e.id.toString(),s=this.getChildById(i);s&&s.removeOccurrence(t),this.cleanEmptyMeshNodes()}hasNonIsolatedOccurrences(){if(this.nodeOccurrences){const e=this.nodeOccurrences.getKeyValues();for(let t=1;t<e.length;t+=2){if(!e[t].occurrenceData.getIsolated())return!0}}return!1}removeOccurrence(e){if(e=+e,this.nodeOccurrences){const t=this.nodeOccurrences.get(e);t&&(t.destroy(),this.nodeOccurrences.delete(e),this.damageBounds())}else{for(let t=0;this.children&&t<this.children.length;++t)this.children[t].removeOccurrence(e);this.cleanEmptyMeshNodes()}}removeMeshGroupFromOccurrence(e,t){if(t=+t,this.isMeshNode()){const i=this.nodeOccurrences.get(t);if(i){i.removeAllChildrenForMeshGroup(e)&&(i.isEmpty&&(i.destroy(),this.nodeOccurrences.delete(t)),this.damageBounds())}}else{for(let i=0;this.children&&i<this.children.length;++i)this.children[i].removeMeshGroupFromOccurrence(e,t);this.cleanEmptyMeshNodes()}}removeChild(e,t){if(!this.children)return;const i=this.children.indexOf(e);i>-1&&(delete this.childMap[e.id],this.children.splice(i,1),e.onRemoved(t),this.damageBounds())}removeChildById(e){if(!this.children)return;const t=this.childMap[e];t&&this.removeChild(t)}removeAllChildren(){if(this.children){for(let e=0;e<this.children.length;++e)this.children[e].onRemoved();this.childMap={},this.children=[],this.damageBounds()}}remove(){this.parent?this.parent.removeChild(this):o.log.error("Trying to remove parentless child")}onRemoved(e){this.parent=null,e||I(this)}onPermanentlyRemoved(){if(this.children)for(let e=0;e<this.children.length;++e)this.children[e]&&this.children[e].onPermanentlyRemoved();else if(this.nodeOccurrences){const e=this.nodeOccurrences.getKeyValues();for(let t=0;t<e.length;t+=2)e[t+1].destroy();this.nodeOccurrences=null}}cleanEmptyMeshNodes(){if(this.children)for(let e=0;e<this.children.length;++e)this.children[e].isMeshNode()?this.children[e].isEmptyMeshNode()&&this.children[e].remove():this.children[e].cleanEmptyMeshNodes()}getParent(){return this.parent}getChildById(e){return this.children&&this.childMap[e]||null}getChildrenWithPrefix(e){if(!this.children)return null;let t=null;for(const i in this.childMap)0===i.indexOf(e)&&(t=t||[],t.push(this.childMap[i]));return t}getChildByIndex(e){return!this.children||e>=this.children.length||e<0?null:this.children[e]}getChildCount(){return this.children?this.children.length:0}isMeshNode(){return!!this.nodeOccurrences}isEmptyMeshNode(){return this.isMeshNode()&&0===this.nodeOccurrences.size}getPrimitiveType(){return this.properties?this.properties.primitiveType:s.PrimitiveType.PRIMITIVE_UNKNOWN}isFaces(){if(!this.isMeshNode())return!1;const e=this.getPrimitiveType();return e===s.PrimitiveType.TRIANGLES||e===s.PrimitiveType.TRIANGLE_STRIP}isEdges(){if(!this.isMeshNode())return!1;const e=this.getPrimitiveType();return e===s.PrimitiveType.LINES||e===s.PrimitiveType.INFINITE_LINES}isPoints(){if(!this.isMeshNode())return!1;return this.getPrimitiveType()===s.PrimitiveType.POINTS}isSilhouettes(){if(!this.isMeshNode())return!1;return this.getPrimitiveType()===s.PrimitiveType.SILHOUETTES}getProperties(){return this.properties}getMaterial(){return this.properties.material}getIsVisible(){return this.properties.isVisible}getIsPickable(){return this.properties.isPickable}getIsHighlightable(){return this.properties.isHighlightable}getIsTwoSided(){return this.properties.isTwoSided}getIsTintedByCompare(){return this.properties.isTintedByCompare}getIsShowThrough(){return this.properties.isShowThrough}getIsDepthTested(){return this.properties.isDepthTested}getIsStencilTested(){return this.properties.isStencilTested}getIsStencilWritten(){return this.properties.isStencilWritten}getClippedBySectionPlanes(){return this.properties.clippedBySectionPlanes}getAddsToSectionMask(){return this.properties.addsToSectionMask}hasTransparency(){return this.properties.primitivesHaveTransparency||!!this.properties.material&&this.properties.material.hasTransparency()}getRenderOrderPriority(){return this.properties.priority}getIncludedInBlend(){return this.properties.includedInBlend}getAddsToBounds(){return this.properties.addsToBounds}getZOffset(){return this.properties.zOffset}getPickZOffset(){return this.properties.pickZOffset}draw(e){if((!e.isHighlighting()||this.getIsHighlightable())&&(e.isHighlighting()||e.isPicking()||this.getIsVisible())&&(this.children||e.nodeFilter(this))){if(this.pose&&e.pushModelViewMatrix(l.mat4C.multiply(e.getModelViewMatrix(),this.pose,c.mat4.create())),this.isMeshNode()){this.properties.material&&e.pushMaterial(this.properties.material),e.activateTopShader();const t=e.getActiveShader();if(!t)return this.properties.material&&e.popMaterial(),void(this.pose&&e.popModelViewMatrix());e.setMaterial(),e.updateModelviewUniforms(),e.setUsage(this.usage);const i=this.nodeOccurrences?this.nodeOccurrences.getKeyValues():null;if(i&&e.isHighlighting()){this.isEdges()?(e.getUseHiddenOpacityForEdgeHighlights()?(t.uniform1f("uHighlightOpacity",d.getNumber("HIGHLIGHT_HIDDEN_EDGE_OPACITY")),t.uniform1f("uHighlightBorderOpacity",d.getNumber("HIGHLIGHT_HIDDEN_EDGE_BORDER_OPACITY"))):(t.uniform1f("uHighlightOpacity",d.getNumber("HIGHLIGHT_EDGE_OPACITY")),t.uniform1f("uHighlightBorderOpacity",d.getNumber("HIGHLIGHT_EDGE_BORDER_OPACITY"))),e.setLineWidth(this.properties.material.lineWidth),e.setLineStipple(this.properties.material.lineStipple)):this.isPoints()&&(t.uniform1f("uHighlightOpacity",d.getNumber("HIGHLIGHT_POINT_OPACITY")),e.setPointSize(this.properties.material.pointSize)),e.setFacesToCull(s.CullFace.NONE);for(let t=0;t<i.length;t+=2)i[t+1].draw(e);e.setFacesToCull(s.CullFace.BACK)}if((this.getIsVisible()||e.isPicking())&&!e.isHighlighting()&&(this.getIsTwoSided()||e.isPickingBackFaces()?e.setFacesToCull(s.CullFace.NONE):e.setFacesToCull(s.CullFace.BACK),this.isPoints()?(e.setPointSize(this.properties.material.pointSize),e.setPointFont(this.properties.material.pointFont)):(this.isEdges()||this.isSilhouettes())&&(e.setLineWidth(this.properties.material.lineWidth),e.setLineStipple(this.properties.material.lineStipple)),t.uniform1i("uClippedBySectionPlanes",this.getClippedBySectionPlanes()?1:0),t.uniform1f("uAddsToSectionMask",this.getAddsToSectionMask()?1:0),i))for(let t=0;t<i.length;t+=2)i[t+1].draw(e);this.properties.material&&e.popMaterial()}else if(this.children)for(let t=0;t<this.children.length;++t)this.children[t].draw(e);this.pose&&e.popModelViewMatrix()}}passesNodeFilter(e){if(e(this))return!0;if(this.children)for(let t=0;t<this.children.length;++t)if(this.children[t].passesNodeFilter(e))return!0;return!1}walk(e){if(e(this))return!0;let t=!1;for(let i=0;i<this.getChildCount()&&!t;++i)t=this.getChildByIndex(i).walk(e);return t}getIdPath(){let e="",t=this;for(;t;)e.length>0&&(e="."+e),e=t.id+e,t=t.parent;return e}makeSceneDebugObject(e){let t="Node: "+this.getId();this.properties.primitiveType!==s.PrimitiveType.PRIMITIVE_UNKNOWN&&(t+=" ",t+=this.properties.toString(!0));const i=[];i.push(this.properties.makeSceneDebugObject());const n=this.getBoundingBox();if(n&&i.push(n.makeSceneDebugObject()),this.isMeshNode()){const t=this.nodeOccurrences.getKeyValues();for(let s=0;s<t.length;s+=2)i.push(t[s+1].makeSceneDebugObject(e+1))}else for(let t=0;t<this.getChildCount();t++)i.push(this.getChildByIndex(t).makeSceneDebugObject(e+1));return{text:t,children:i,state:{opened:e<2}}}setVisible(e){if(this.getIsVisible()!==e){const t=this.properties.cloneAndModify({isVisible:e});this.properties=t}}}t.Node=T},5273:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.NodeOccurrence=void 0;const s=i(114924),n=i(545348),r=i(613199),a=i(264292).mat4.create();class o{constructor(e,t){this.parent=e,this.occurrenceData=t,this.styledRanges=[],this.bounds=null,this.styledBufferSets=null,this.occurrenceData.addBoundable(this)}destroy(){for(let e=0;e<this.styledRanges.length;++e)this.styledRanges[e].destroy();if(this.styledBufferSets)for(const e of this.styledBufferSets)this.removeStyledBufferSet(e);this.occurrenceData.removeBoundable(this)}addStyledBufferSet(e){null===this.styledBufferSets&&(this.styledBufferSets=new Set),this.styledBufferSets.add(e),e.getBufferSet().addParent(this)}hasBufferSet(e){if(!this.hasOptimizedBuffers())return!1;for(const t of this.styledBufferSets)if(t.getBufferSet()===e)return!0;return!1}removeSimpleBufferSet(e){if(!this.hasOptimizedBuffers())return!1;let t=!1;for(const i of this.styledBufferSets)i.getBufferSet()===e&&(t||(t=this.removeStyledBufferSet(i)));return t}removeStyledBufferSet(e){const t=this.styledBufferSets.delete(e);return e.getBufferSet().removeParent(this),t}hasOptimizedBuffers(){return null!==this.styledBufferSets&&this.styledBufferSets.size>0}addStyledMeshRanges(e,t,i,n){const r=new s.StyledMeshRanges(this,e,t,i,n);return this.styledRanges.push(r),r}removeAllChildrenForMeshGroup(e){return this.removeStyledMeshRangesForGroup(e)||this.removeBufferSetsForMeshGroup(e)}removeStyledMeshRangesForGroup(e){const t=[];let i=!1;for(let s=0;s<this.styledRanges.length;++s){const n=this.styledRanges[s];n.getMeshRangesGroupId()===e?(i=!0,n.destroy()):t.push(n)}return this.styledRanges=t,i}removeBufferSetsForMeshGroup(e){if(!this.hasOptimizedBuffers())return!1;let t=!1;for(const i of this.styledBufferSets)i.getBufferSet().getMeshGroupId()===e&&(this.styledBufferSets.delete(i),t=!0);return t}get isEmpty(){return 0===this.styledRanges.length}draw(e){const t=e.getActiveShader();if(!t)return;if(!this.occurrenceData.isVisible(e)&&!e.getIsPickingHiddenOccurrences())return;if(!e.doesNodeOcccurrencePassFilter(this))return;if(e.activePassNeedsIsolationTest()&&e.activePassIsForIsolate()!==this.occurrenceData.getIsolated())return;let i=!1;if(this.hasOptimizedBuffers())for(const s of this.styledBufferSets)this.occurrenceData.isMeshGroupCulled(s.getBufferSet().getMeshGroupId(),e)||(t.uniform1f("uUsePrimitiveLines",1),i||(this.pushGraphicsState(e,t),i=!0),this.occurrenceData.getShouldSetOccurrenceUniform()&&t.uniform1f("uMeshGroupIdHash",s.getBufferSet().getMeshRangesGroupIdHash()),s.draw(e));else for(let s=0;s<this.styledRanges.length;++s){const n=this.styledRanges[s];this.occurrenceData.isStyledRangeCulled(n,e)||(t.uniform1f("uUsePrimitiveLines",0),i||(this.pushGraphicsState(e,t),i=!0),this.occurrenceData.getShouldSetOccurrenceUniform()&&t.uniform1f("uMeshGroupIdHash",n.getMeshRangesGroupIdHash()),n.draw(e,this.occurrenceData))}i&&o.popGraphicsState(e)}pushGraphicsState(e,t){o.pushGraphicsState(e,t,this.occurrenceData,this.parent)}static pushGraphicsState(e,t,i,s){if(e.pushModelViewMatrix(r.mat4C.multiply(e.getModelViewMatrix(),i.getTransform(),a)),e.updateModelviewUniforms(),e.activePassIsForSectionPlaneEndcapMask()){const s=e.viewer.getIsolatedOccurrenceManager().isInIsolateOrMakeTransparentMode()&&!i.getIsolated();t.uniform1f("uOutsideIsolation",s?1:0)}i.getShouldSetOccurrenceUniform()&&t.uniform1f("uOccurrenceId",i.getOccurrenceId()),t.uniform1i("uClippedBySectionPlanes",s.getClippedBySectionPlanes()&&i.getIsClippedBySectionPlanes()?1:0);let n=e.isPicking()?s.getPickZOffset():s.getZOffset();e.getHasIsolate()&&!i.getIsolated()&&(n+=o.NON_ISOLATED_Z_OFFSET_ADDITION),e.setZOffset(n)}static popGraphicsState(e){e.popModelViewMatrix()}damageBounds(){this.bounds&&this.bounds.reset(),this.parent.damageBounds()}addBounds(e,t){if(this.bounds||(this.bounds=new s.BoundingBox),(this.occurrenceData.isBoundable()||t&&t.includeHiddenBounds)&&!this.bounds.isInitialized()){let e,t=!1;if(this.hasOptimizedBuffers())for(const e of this.styledBufferSets)this.bounds.addBox(e.getBounds(this.occurrenceData,this.parent.getUsage()),this.occurrenceData.getTransform());else{for(e=0;e<this.styledRanges.length;++e)if(this.styledRanges[e].isCheaplyBoundable()){const i=this.styledRanges[e].getBounds(this.occurrenceData,this.parent.getUsage());i.isInitialized()&&(this.bounds.addBox(i,this.occurrenceData.getTransform()),t=!0)}if(!t)for(e=0;e<this.styledRanges.length;++e)this.bounds.addBox(this.styledRanges[e].getBounds(this.occurrenceData,this.parent.getUsage()),this.occurrenceData.getTransform())}}e.addBox(this.bounds,null,!0)}makeSceneDebugObject(e){const t="NodeOccurrence: (Occurrence id: "+this.occurrenceData.getOccurrenceId()+")",i=[this.occurrenceData.makeSceneDebugObject()];if(this.bounds&&i.push(this.bounds.makeSceneDebugObject()),this.hasOptimizedBuffers())for(const t of this.styledBufferSets)i.push(t.makeSceneDebugObject(e+1));else for(let e=0;e<this.styledRanges.length;++e)i.push(this.styledRanges[e].makeSceneDebugObject(this.occurrenceData));return{text:t,children:i,state:{opened:!0}}}parentHasTransparency(){return this.parent.hasTransparency()}}t.NodeOccurrence=o,o.NON_ISOLATED_Z_OFFSET_ADDITION=n.default.getManager().getNumber("NON_ISOLATED_Z_OFFSET_ADDITION")},465723:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.NO_RANGE_OPERATOR=t.NoRangeOperator=void 0;class i{getRangeIteratorForBufferSet(e){return null}setOperand(e){}makeSceneDebugObject(){return{text:"NoRangeOperator",children:[]}}}t.NoRangeOperator=i,t.NO_RANGE_OPERATOR=new i},434567:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.resetSharedOperators=t.OccurrenceHighlights=t.EMPTY_HIGHLIGHT_STYLE=void 0;const s=i(114924),n=i(315689);let r=new s.IntersectOperator,a=new s.ChainedOperator,o=new s.StyleOverwriteOperator,c={};t.EMPTY_HIGHLIGHT_STYLE=new s.Style,t.EMPTY_HIGHLIGHT_STYLE.setAttribute(s.Attributes.HIGHLIGHT_ID,[0,0,0,0]);t.OccurrenceHighlights=class{constructor(){this.entityHighlightRanges=new Map,this.entityHighlights=new Map,this.occurrenceHighlights=new Map}destroy(){for(const e of this.entityHighlightRanges.values())e.destroy();this.occurrenceHighlights.clear()}hasHighlight(){if(this.occurrenceHighlights.size>0)return!0;for(const e of this.entityHighlightRanges.values())if(!e.isEmpty())return!0;return!1}entityHasHighlight(e){if(this.occurrenceHighlights.size>0)return!0;for(const t of this.entityHighlightRanges.values())if(t.containsIncrement(e))return!0;return!1}getEntityHighlights(e){return this.entityHighlights.get(e)}removeEntityHighlights(e){this.entityHighlights.delete(e)}getOrCreateEntityRangesForType(e){let t=this.entityHighlightRanges.get(e);return t||(t=new s.IncrementRanges(e),this.entityHighlightRanges.set(e,t),t.setListenForDeletions(!0)),t}updateEntityHighlight(e,t,i){const r=this.getOrCreateEntityRangesForType(t.type),a=(0,n.getOrCreateSubMap)(this.entityHighlights,i),o=this.getHighestPriorityHighlightFromMap(a);if(e===s.Action.ADD){if(a.set(t.getIdString(),t),!o||o.priority<t.priority){if(o){const e=this.entityHighlightRanges.get(o.type);e&&e.onIncrementRemoved(i)}r.onIncrementAdded(i,t.getStyle())}}else{a.delete(t.getIdString()),r.onIncrementRemoved(i);const e=this.getHighestPriorityHighlightFromMap(a);if(e){this.getOrCreateEntityRangesForType(e.type).onIncrementAdded(i,e.getStyle())}r.isEmpty()&&(this.entityHighlightRanges.delete(t.type),r.destroy()),0===a.size&&this.entityHighlights.delete(i)}}updateOccurrenceHighlight(e,t){let i;e===s.Action.ADD?(i=(0,n.getOrCreateSubMap)(this.occurrenceHighlights,t.type),i.set(t.getIdString(),t)):(i=this.occurrenceHighlights.get(t.type),i&&(i.delete(t.getIdString()),0===i.size&&this.occurrenceHighlights.delete(t.type)))}getHighestPriorityOccurrenceHighlight(){if(0===this.occurrenceHighlights.size)return null;let e=null;for(const t of this.occurrenceHighlights.values())for(const i of t.values())(!e||i.priority>e.priority)&&(e=i);return e}clearHighlight(e){this.occurrenceHighlights.delete(e.type);const t=this.entityHighlightRanges.get(e.type);t&&(this.entityHighlightRanges.delete(e.type),t.destroy()),this.entityHighlights.forEach(((t,i)=>{let s=!1;if(t.forEach(((i,n)=>{i.type===e.type&&(s=!0,t.delete(n))})),s)if(t.size>0){const s=this.getHighestPriorityHighlightFromMap(t);if(s&&s.priority<=e.priority){this.getOrCreateEntityRangesForType(s.type).onIncrementAdded(i,s.getStyle())}}else this.entityHighlights.delete(i)}))}clearAllOccurrenceLevelHighlights(){this.occurrenceHighlights.clear()}getUnionOperator(e,t){let i=c[e];return i||(c[e]=i=new s.StyleUnionOperator),i.setOperandA(t),i.setOperand(null),i}getHighestPriorityHighlightFromMap(e){if(!e)return null;let t=null;for(const i of e.values())(!t||i.priority>t.priority)&&(t=i);return t}getFirstHighlightFromMap(e){if(e)for(const t of e.values())return t;return null}getFirstOccurrenceHighlightOfType(e){return this.getFirstHighlightFromMap(this.occurrenceHighlights.get(e))}getHighlightOperator(e){const t=e.getActiveHighlightType(),i=this.getFirstOccurrenceHighlightOfType(t);if(i)return e.applyStyle(i.getStyle()),null;const n=this.entityHighlightRanges.get(t);return n?(r.setOperandA(n),r):s.NO_RANGE_OPERATOR}getHighlightStyleOperator(e,i){if(!e.getActiveShader().hasAttribute(s.AttributeNames.HIGHLIGHT_ID)||!this.hasHighlight())return i;const n=o;n.setDefaultStyle(t.EMPTY_HIGHLIGHT_STYLE);let r=null,c=null;const l=e.getActiveHighlightType(),h=e.getViewer().getReferenceHighlights().getSortedHighlights();for(let e=0;e<h.length;++e){const t=h[e].type;if(l&&t!==l)continue;const i=this.getFirstOccurrenceHighlightOfType(t);if(i){n.setDefaultStyle(i.getStyle()),r=null,c=null;continue}const s=this.entityHighlightRanges.get(t);if(s){const t=this.getUnionOperator(e,s);r||(r=t),c&&c.setOperand(t),c=t}}return n.setOverwriteOperand(r),i?a.resetWithOperands(i,n):n}makeSceneDebugObject(e){const t=[],i=[];for(const e of this.entityHighlightRanges.values())i.push(e.makeSceneDebugObject());t.push({text:"entityHighlightRanges",children:i}),t.push({text:"entityHighlights",children:this.getEntityHighlightsDebugInfo()});const s=[];return this.occurrenceHighlights.forEach(((e,t)=>{const i=[];for(const t of e.keys())i.push({text:t.toString(),children:[]});s.push({text:t.toString(),children:i})})),t.push({text:"occurrenceHighlights",children:s}),{text:e,children:t}}getEntityHighlightsDebugInfo(){const e=[];return this.entityHighlights.forEach(((t,i)=>{const s=[];for(const e of t.keys()){const i=[],n=t.get(e);n.debugStack&&i.push({text:"Stack: "+n.debugStack}),s.push({text:e.toString(),children:i})}e.push({text:i.increment.id,children:s})})),e}},t.resetSharedOperators=function(){r=new s.IntersectOperator,a=new s.ChainedOperator,o=new s.StyleOverwriteOperator,c={}}},121715:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.RangeSetIterator=void 0;t.RangeSetIterator=class{constructor(){this.rangeSet=null,this.index=0}resetForRangeSet(e){this.rangeSet=e,this.index=0}hasMoreRanges(){return!!this.rangeSet&&this.index<this.rangeSet.length}getNextRange(){return this.hasMoreRanges()?this.rangeSet[this.index++]:null}}},961049:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SimpleBufferSet=void 0;const s=i(114924),n=i(61161);class r extends n.BufferSetBase{constructor(e,t,i,n,a,o){super(e),this.vertexCount=0,this.indexCount=0,this.vertexByteData=null,this.indexByteData=null,this.hasNormals=!1,this.meshGroupId="",this.meshRangeGroupIdHash=null,this.visible=!0,this.parents=null,this.bounds=null,this.vertexCount=t;let c=r.VERTEX_SIZE,l=s.Attributes.POINT.dimension;o&&(this.hasNormals=!0,c*=2,l*=2),this.vertexByteData=new ArrayBuffer(t*c);if(new Float32Array(this.vertexByteData,0,t*l).set(n,0),this.indexCount=i,i>0){this.indexByteData=new ArrayBuffer(i*(0,s.getIndexElementSize)());new((0,s.getIndexBufferType)())(this.indexByteData,0,i).set(a,0)}}getBounds(e,t){if(!this.bounds){this.bounds=new s.BoundingBox,this.areBuffersInitialized()||this.initializeBuffers();const e=this.vertexBuffer.getFloatView(),t=3*this.vertexCount;for(let i=0;i<t;i+=3)this.bounds.addXYZ(e[i],e[i+1],e[i+2])}return this.bounds}setMeshGroupId(e){this.meshGroupId=e}getMeshGroupId(){return this.meshGroupId}isVisible(){return this.visible}setIsVisible(e){this.visible=e}addParent(e){if(!e.hasBufferSet(this))throw new Error("This function should only be called from Node.addBufferSet()");this.parents||(this.parents=new Set),this.parents.add(e)}removeParent(e){if(e&&e.hasBufferSet(this))throw new Error("This function should only be called from Node.removeBufferSet()");this.parents&&this.parents.delete(e)}removeFromAllParents(){if(this.parents)for(const e of this.parents)e.removeSimpleBufferSet(this);this.parentMesh&&(this.parentMesh.removeBufferSet(this),this.parentMesh=null)}initializeBuffers(){if(this.areBuffersInitialized())return;if(!this.parentMesh)throw new Error("SimpleBufferSet has no parent mesh.");const e=this.parentMesh.viewer,t=e.getGlContext();let i=r.VERTEX_SIZE;this.hasNormals&&(this.hasNormals=!0,i*=2),this.vertexBuffer=new s.Buffer(e,this.vertexCount*i,t.ARRAY_BUFFER,this.vertexCount);if(this.vertexBuffer.getFloatView().set(new Float32Array(this.vertexByteData),0),this.indexCount>0){this.indexBuffer=new s.Buffer(e,this.indexCount*(0,s.getIndexElementSize)(),t.ELEMENT_ARRAY_BUFFER,this.indexCount);const i=this.indexBuffer.getIndexView((0,s.getIndexBufferType)()),n=(0,s.getIndexBufferType)();i.set(new n(this.indexByteData,0,this.indexCount),0)}}bindBuffers(e,t,i,s,n){super.bindBuffers(e,t,i,s,n),s&&this.vertexBuffer.bind(),this.indexBuffer.bind()}draw(e,t){if(!this.isVisible()||!this.parentMesh)return;if(e.activePass.isPickPass())return;this.areBuffersInitialized()||this.initializeBuffers();const i=e.getActiveShader(),n=this.parentMesh.viewer.getGlContext(),r=this.isTriangleStrip(),a=this.parentMesh.getPrimitiveType(),o=a===s.PrimitiveType.TRIANGLE_STRIP?n.TRIANGLE_STRIP:a===s.PrimitiveType.LINES?n.LINES:n.POINTS,c=this.buffersNeedBinding(e);if(this.parentMesh.copyOptimizedBuffersToGl(e),c){this.attributeBindings={};let t=s.Attributes.POINT,n=0;this.attributeBindings[t.name]=new s.AttributeBinding(+t.type,t.dimension,n,0,t.normalize,t.secondDimension),this.hasNormals&&(t=s.Attributes.NORMAL,n=this.vertexCount*s.Attributes.POINT.dimension*4,this.attributeBindings[t.name]=new s.AttributeBinding(+t.type,t.dimension,n,0,t.normalize,t.secondDimension)),this.bindAttributeStateWithoutVAOs(c,i,e,r)}n.drawElements(o,this.indexBuffer.getComponentCount(),(0,s.getIndexElementType)(),0)}getMeshRangesGroupIdHash(){if(this.meshRangeGroupIdHash)return this.meshRangeGroupIdHash;if(this.meshGroupId){this.meshRangeGroupIdHash=0;for(let e=0;e<this.meshGroupId.length;e++)this.meshRangeGroupIdHash+=this.meshGroupId.charCodeAt(e)}return this.meshRangeGroupIdHash}hasOptimizedBuffers(){return!0}makeSceneDebugObject(e){let t="SimpleBufferSet ("+this.meshGroupId+"): ";t+="vertexCount: "+this.vertexCount,t+=", indexCount: "+this.indexCount;const i=[];return i.push({text:"Visible? : "+this.isVisible(),children:[]}),this.bounds&&i.push(this.bounds.makeSceneDebugObject()),{text:t,children:i,state:{opened:e<2}}}}t.SimpleBufferSet=r,r.VERTEX_SIZE=12},656010:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.merge=t.stylesEqual=t.styleMapsEqual=t.Style=void 0;const s=i(608521);class n{constructor(){this.attributeSettings=new s.FastIteratorMap,this.floatUniformSettings=new s.FastIteratorMap}copyFrom(e){this.attributeSettings.setAll(e.attributeSettings),this.floatUniformSettings.setAll(e.floatUniformSettings)}clone(){const e=new n;return e.copyFrom(this),e}clear(){this.attributeSettings.clear(),this.floatUniformSettings.clear()}equals(e){return!!e&&(this===e||!!r(this.attributeSettings,e.attributeSettings)&&!!r(this.floatUniformSettings,e.floatUniformSettings))}setAttribute(e,t){this.attributeSettings.set(e,t)}getAttribute(e){return this.attributeSettings.get(e)}setFloatUniform(e,t){this.floatUniformSettings.set(e,t)}applyStyle(e){const t=e.getActiveShader();if(!t)return;const i=this.attributeSettings.getKeyValues();for(let e=0;e<i.length;e+=2)t.setAttribute(i[e],i[e+1]);const s=this.floatUniformSettings.getKeyValues();for(let e=0;e<s.length;e+=2)t.setFloatUniform(s[e],s[e+1])}toString(){let e="Style: ";const t=this.attributeSettings.getKeyValues(),i=", ";for(let s=0;s<t.length;s+=2){const n=t[s],r=t[s+1];s>0&&(e+=i),e+=n.name+": "+r}t.length>0&&(e+=i);const s=this.floatUniformSettings.getKeyValues();for(let t=0;t<s.length;t+=2)t>0&&(e+=i),e+=s[t]+": "+s[t+1];return e}}function r(e,t){if(e.size!==t.size)return!1;const i=e.getKeyValues();for(let e=0;e<i.length;e+=2){const s=i[e],n=i[e+1],r=t.get(s);if(n!==r){if(void 0===r)return!1;if(void 0===n.length&&void 0===r.length)return!1;if(n.length!==r.length)return!1;for(let e=0;e<n.length;++e)if(n[e]!==r[e])return!1}}return!0}t.Style=n,t.styleMapsEqual=r,t.stylesEqual=function(e,t){return e&&t?e.equals(t):!(e||t)},t.merge=function(e,t,i){return e?t?(i.clear(),i.copyFrom(e),i.copyFrom(t),i):e:t}},977772:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StyledMeshRanges=void 0;const s=i(114924),n=new s.StyleResetOperator;t.StyledMeshRanges=class{constructor(e,t,i,n,r){this.parent=e,this.style=t,this.meshRanges=i,this.styleOverrideRanges=n,this.styleOverrideOperator=null,this.meshRangeGroupIdHash=null,this.meshRanges.addBoundable(this),r&&(this.rangeSkipOperator=new s.SubtractOperator,this.rangeSkipOperator.setSubtrahend(r))}destroy(){this.meshRanges.removeBoundable(this)}getMeshRanges(){return this.meshRanges}getMeshRangesGroupIdHash(){if(this.meshRangeGroupIdHash)return this.meshRangeGroupIdHash;const e=this.getMeshRangesGroupId();if(e){this.meshRangeGroupIdHash=0;for(let t=0;t<e.length;t++)this.meshRangeGroupIdHash+=e.charCodeAt(t)}return this.meshRangeGroupIdHash}getMeshRangesGroupId(){return this.meshRanges.getMeshGroupId()}draw(e,t){if(!this.meshRanges.shouldDrawForOccurrences(t))return;e.applyStyle(this.style);let i=t.getMeshRangeOperator(e);i!==s.NO_RANGE_OPERATOR&&(i&&i.setOperand(this.meshRanges),this.rangeSkipOperator&&(this.rangeSkipOperator.setOperand(i||this.meshRanges),i=this.rangeSkipOperator),e.activePassNeedsFaceAppearances()&&this.styleOverrideRanges&&(this.styleOverrideOperator||(this.styleOverrideOperator=new s.StyleOverwriteOperator,this.styleOverrideOperator.setOverwriteOperand(this.styleOverrideRanges),this.styleOverrideOperator.setDefaultStyle(this.style)),this.styleOverrideOperator.setOperand(i||this.meshRanges),i=this.styleOverrideOperator),e.activePassNeedsFaceAppearances()||(n.setOperand(i||this.meshRanges),n.setResetStyle(this.style),i=n),this.meshRanges.draw(e,i))}isCheaplyBoundable(){return this.meshRanges.isCheaplyBoundable()}damageBounds(){this.parent.damageBounds()}getBounds(e,t){return this.meshRanges.getBounds(e,t)}makeSceneDebugObject(e){let t="Styled mesh range: (style: "+this.style+")";const i=[this.meshRanges.makeSceneDebugObject(e)];return this.styleOverrideRanges&&(i.push(this.styleOverrideRanges.makeSceneDebugObject()),t+=", with style overrides"),{text:t,children:i}}}},841334:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.cloneStyledRangeSet=t.toString=t.removeStyledRange=t.insertStyledRange=void 0;const s=i(114924);t.insertStyledRange=function(e,t){if(t.length<1)t.push(e.slice(0));else{const i=(0,s.binarySearchRanges)(t,0,t.length,0,e[0]);let n,r=!1,a=0,o=e[1];if(i>0){const a=t[i-1];a[1]>=e[0]&&((0,s.stylesEqual)(a[2],e[2])?(r=!0,o=Math.max(o,a[1])):(a[1]>o&&(n=[e[1],a[1],a[2]]),a[1]=e[0]))}for(let n=i;n<t.length;++n){const i=t[n];if(!(i[0]<=e[1]))break;i[1]<=e[1]?++a:(0,s.stylesEqual)(i[2],e[2])?(++a,o=Math.max(o,i[1])):i[0]<o&&(i[0]=o)}r?(t[i-1][1]=o,t.splice(i,a)):n?t.splice(i,a,[e[0],o,e[2]],n):t.splice(i,a,[e[0],o,e[2]])}},t.removeStyledRange=function(e,t){if(e[0]===e[1])return;const i=(0,s.binarySearchRanges)(t,0,t.length,1,e[0]),n=(0,s.binarySearchRanges)(t,i,t.length,0,e[1]);if(i>=t.length||i===n)return;let r=null,a=null;t[i][0]<e[0]&&(r=[t[i][0],e[0],t[i][2]]),t[n-1][1]>e[1]&&(a=[e[1],t[n-1][1],t[n-1][2]]),r&&a?t.splice(i,n-i,r,a):r?t.splice(i,n-i,r):a?t.splice(i,n-i,a):t.splice(i,n-i)},t.toString=function(e){return 0===e.length?"[]":"[["+e.join("],[")+"]]"},t.cloneStyledRangeSet=function(e){const t=new Array(e.length);for(let i=0;i<e.length;++i)t[i]=e[i].slice();return t}},415592:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.StyledSimpleBufferSet=void 0;t.StyledSimpleBufferSet=class{constructor(e,t,i){this.setStyle(t),this.setBufferSet(i),this.parent=e}getStyle(){return this.style}setStyle(e){this.style=e}getBufferSet(){return this.bufferSet}setBufferSet(e){this.bufferSet=e}damageBounds(){this.parent.damageBounds()}getBounds(e,t){return this.bufferSet.getBounds(e,t)}draw(e){this.bufferSet&&(null!=this.style&&e.applyStyle(this.style),this.bufferSet.draw(e))}makeSceneDebugObject(e){const t=[];return t.push(this.bufferSet.makeSceneDebugObject(e+1)),{text:"StyledSimpleBufferSet",children:t,state:{opened:e<2}}}}},189643:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StyleMergeIterator=void 0;const s=i(605985),n=i(656010);class r extends s.BooleanIterator{constructor(e){super(),this.styleMergeStorage=[],this.currentStyleMergeStoragePointer=0;for(let t=0;t<e;++t)this.styleMergeStorage.push(new n.Style)}getStyleMergeStorage(){const e=this.styleMergeStorage[this.currentStyleMergeStoragePointer];return this.currentStyleMergeStoragePointer=(this.currentStyleMergeStoragePointer+1)%this.styleMergeStorage.length,e}}t.StyleMergeIterator=r},51173:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StyleModificationOperator=t.StyleModifierIterator=t.getAlphaModifierFunction=void 0;const s=i(114924);t.getAlphaModifierFunction=function(e){return t=>{const i=t.getAttribute(s.Attributes.COLOR);if(i){const n=t.clone(),r=i.slice();return r[3]*=e,n.setAttribute(s.Attributes.COLOR,r),n}return t}};class n{constructor(e){this.styleModifier=e,this.baseIterator=null}reset(e){return this.baseIterator=e,this}hasMoreRanges(){return this.baseIterator.hasMoreRanges()}getNextRange(){const e=this.baseIterator.getNextRange();if(e){const t=[e[0],e[1],e[2]];return t[2]&&(t[2]=this.styleModifier(t[2])),t}return null}}t.StyleModifierIterator=n;t.StyleModificationOperator=class{constructor(e){this.baseOperand=null,this.iterator=new n(e)}setOperand(e){this.baseOperand=e}getRangeIteratorForBufferSet(e){if(!this.baseOperand)return null;const t=this.baseOperand.getRangeIteratorForBufferSet(e);return t?this.iterator.reset(t):null}makeSceneDebugObject(){const e={text:"StyleModificationOperator",children:[]};return(0,s.addDebuggableChild)(e,this.baseOperand),e}}},526018:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StyleOverwriteOperator=t.StyleOverwriteIterator=void 0;const s=i(114924);class n extends s.StyleMergeIterator{constructor(){super(4),this.baseIterator=null,this.currentBaseRange=null,this.currentBaseOffset=-1,this.overwriteIterator=null,this.currentOverwriteRange=null,this.defaultStyle=null}setDefaultStyle(e){this.defaultStyle=e}reset(e,t){return this.baseIterator=e,this.currentBaseRange=null,this.currentBaseOffset=-1,this.overwriteIterator=t,this.currentOverwriteRange=null,this.nextResult=this.findNextRange(),this}findNextRange(){if(this.currentBaseRange||(this.currentBaseRange=this.baseIterator.getNextRange(),this.currentBaseOffset=-1),!this.currentBaseRange)return null;for(;this.overwriteIteratorIsBehind();)this.currentOverwriteRange=this.overwriteIterator.getNextRange();const e=this.getStorageForNextResult();if(!this.currentOverwriteRange||this.currentOverwriteRange[0]>=this.currentBaseRange[1])e[0]=this.currentBaseOffset>=0?this.currentBaseOffset:this.currentBaseRange[0],e[1]=this.currentBaseRange[1],e[2]=(0,s.merge)(this.defaultStyle,this.currentBaseRange[2],this.getStyleMergeStorage()),this.currentBaseRange=null;else{const t=this.currentBaseOffset>=0?this.currentBaseOffset:this.currentBaseRange[0];e[0]=t;const i=(0,s.merge)(this.defaultStyle,this.currentBaseRange[2],this.getStyleMergeStorage());this.currentOverwriteRange[0]<=t?(e[2]=(0,s.merge)(i,this.currentOverwriteRange[2],this.getStyleMergeStorage()),this.currentBaseRange[1]<this.currentOverwriteRange[1]?(e[1]=this.currentBaseRange[1],this.currentBaseRange=null):this.currentBaseRange[1]>this.currentOverwriteRange[1]?(e[1]=this.currentOverwriteRange[1],this.currentBaseOffset=this.currentOverwriteRange[1],this.currentOverwriteRange=null):(e[1]=this.currentBaseRange[1],this.currentBaseRange=null,this.currentOverwriteRange=null)):(e[1]=this.currentOverwriteRange[0],e[2]=i,this.currentBaseOffset=this.currentOverwriteRange[0])}return e}overwriteIteratorIsBehind(){if(this.overwriteIterator){if(this.currentOverwriteRange){const e=this.currentBaseOffset>=0?this.currentBaseOffset:this.currentBaseRange[0];return this.currentOverwriteRange[1]<=e}return this.overwriteIterator.hasMoreRanges()}return!1}}t.StyleOverwriteIterator=n;t.StyleOverwriteOperator=class{constructor(){this.baseOperand=null,this.overwriteOperand=null,this.iterator=new n}setDefaultStyle(e){this.iterator.setDefaultStyle(e)}setOverwriteOperand(e){this.overwriteOperand=e}setOperand(e){this.baseOperand=e}getRangeIteratorForBufferSet(e){if(!this.baseOperand)return null;const t=this.baseOperand.getRangeIteratorForBufferSet(e);if(!t)return null;const i=this.overwriteOperand?this.overwriteOperand.getRangeIteratorForBufferSet(e):null;return this.iterator.reset(t,i)}makeSceneDebugObject(){const e={text:"StyleOverwriteOperator",children:[]};return(0,s.addDebuggableChild)(e,this.baseOperand),(0,s.addDebuggableChild)(e,this.overwriteOperand),e}}},618065:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StyleResetOperator=t.StyleResetIterator=void 0;const s=i(656010),n=i(189643),r=i(726759);class a extends n.StyleMergeIterator{constructor(){super(2),this.baseIterator=null,this.resetStyle=null}setResetStyle(e){this.resetStyle=e}reset(e){return this.baseIterator=e,this.nextResult=this.findNextRange(),this}findNextRange(){const e=this.baseIterator.getNextRange();if(!e)return null;const t=this.getStorageForNextResult();return t[0]=e[0],t[1]=e[1],t[2]=(0,s.merge)(e[2],this.resetStyle,this.getStyleMergeStorage()),t}}t.StyleResetIterator=a;t.StyleResetOperator=class{constructor(){this.operand=null,this.iterator=new a}setResetStyle(e){this.iterator.setResetStyle(e)}setOperand(e){this.operand=e}getRangeIteratorForBufferSet(e){if(!this.operand)return null;const t=this.operand.getRangeIteratorForBufferSet(e);return t?this.iterator.reset(t):null}makeSceneDebugObject(){const e={text:"StyleResetOperator",children:[]};return(0,r.addDebuggableChild)(e,this.operand),e}}},247615:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.StyleUnionOperator=t.StyleUnionIterator=void 0;const s=i(114924);class n extends s.BooleanIterator{constructor(){super(),this.iteratorA=null,this.currentARange=null,this.currentAOffset=-1,this.iteratorB=null,this.currentBRange=null,this.currentBOffset=-1}reset(e,t){return this.iteratorA=e,this.currentARange=null,this.currentAOffset=-1,this.iteratorB=t,this.currentBRange=null,this.currentBOffset=-1,this.nextResult=this.findNextRange(),this}findNextRange(){if(this.currentARange||(this.currentARange=this.iteratorA.getNextRange(),this.currentAOffset=-1),this.currentBRange||(this.currentBRange=this.iteratorB.getNextRange(),this.currentBOffset=-1),!this.currentARange&&!this.currentBRange)return null;const e=this.getStorageForNextResult();if(!this.currentARange){const t=this.currentBOffset>=0?this.currentBOffset:this.currentBRange[0];return e[0]=t,e[1]=this.currentBRange[1],e[2]=this.currentBRange[2],this.currentBRange=null,e}if(!this.currentBRange){const t=this.currentAOffset>=0?this.currentAOffset:this.currentARange[0];return e[0]=t,e[1]=this.currentARange[1],e[2]=this.currentARange[2],this.currentARange=null,e}const t=this.currentAOffset>=0?this.currentAOffset:this.currentARange[0],i=this.currentBOffset>=0?this.currentBOffset:this.currentBRange[0];return t<i?(e[0]=t,e[2]=this.currentARange[2],i<this.currentARange[1]?(e[1]=i,this.currentAOffset=i):(e[1]=this.currentARange[1],this.currentARange=null)):i<t?(e[0]=i,e[2]=this.currentBRange[2],t<this.currentBRange[1]?(e[1]=t,this.currentBOffset=t):(e[1]=this.currentBRange[1],this.currentBRange=null)):(e[0]=i,e[2]=this.currentBRange[2],this.currentARange[1]<this.currentBRange[1]?(e[1]=this.currentARange[1],this.currentBOffset=this.currentARange[1],this.currentARange=null):this.currentBRange[1]<this.currentARange[1]?(e[1]=this.currentBRange[1],this.currentAOffset=this.currentBRange[1],this.currentBRange=null):(e[1]=this.currentARange[1],this.currentARange=null,this.currentBRange=null)),e}}t.StyleUnionIterator=n;t.StyleUnionOperator=class{constructor(){this.operandA=null,this.operandB=null,this.iterator=new n}setOperandA(e){this.operandA=e}setOperand(e){this.operandB=e}getRangeIteratorForBufferSet(e){const t=this.operandA?this.operandA.getRangeIteratorForBufferSet(e):null,i=this.operandB?this.operandB.getRangeIteratorForBufferSet(e):null;return t||i?t?i?this.iterator.reset(t,i):t:i:null}makeSceneDebugObject(){const e={text:"StyleUnionOperator",children:[]};return(0,s.addDebuggableChild)(e,this.operandA),(0,s.addDebuggableChild)(e,this.operandB),e}}},539411:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SubtractMeshRanges=void 0;const s=i(114924);class n{constructor(e){this.subtractMeshRanges=e}getRangeIteratorForBufferSet(e){return s.IncrementRanges.prototype.getRangeIteratorForBufferSet.call(this.subtractMeshRanges,e)}makeSceneDebugObject(){const e={text:"SubtractMeshRangeIncrementProvider",children:[]};return(0,s.addDebuggableChild)(e,this.subtractMeshRanges),e}}class r extends s.IncrementRanges{constructor(e){super(e),this.subtractOperator=new s.SubtractOperator,this.subtractOperator.setSubtrahend(new n(this)),this.setListenForDeletions(!0)}setOperand(e){this.subtractOperator.setOperand(e)}getRangeIteratorForBufferSet(e){return this.subtractOperator.getRangeIteratorForBufferSet(e)}}t.SubtractMeshRanges=r},833206:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SubtractIterator=void 0;const s=i(114924);class n extends s.BooleanIterator{constructor(){super(),this.minuendRangeIterator=null,this.currentMinuendRange=null,this.minuendSubRangeStart=-1,this.subtrahendRangeIterator=null,this.currentSubtrahendRange=null}reset(e,t){this.minuendRangeIterator=e,this.currentMinuendRange=null,this.minuendSubRangeStart=-1,this.subtrahendRangeIterator=t,this.currentSubtrahendRange=null,this.nextResult=this.findNextRange()}findNextRange(){if(this.currentMinuendRange||(this.currentMinuendRange=this.minuendRangeIterator.getNextRange()),!this.currentMinuendRange)return null;for(;this.subtrahendIsBehind();)this.currentSubtrahendRange=this.subtrahendRangeIterator.getNextRange();const e=this.getStorageForNextResult();if(!this.currentSubtrahendRange||this.currentSubtrahendRange[0]>this.currentMinuendRange[1])e[0]=this.minuendSubRangeStart>=0?this.minuendSubRangeStart:this.currentMinuendRange[0],e[1]=this.currentMinuendRange[1],e[2]=this.currentMinuendRange[2],this.currentMinuendRange=null,this.minuendSubRangeStart=-1;else{const t=this.minuendSubRangeStart>=0?this.minuendSubRangeStart:this.currentMinuendRange[0];if(this.currentSubtrahendRange[0]<=t)return this.currentSubtrahendRange[1]>=this.currentMinuendRange[1]?(this.currentMinuendRange=null,this.minuendSubRangeStart=-1):this.minuendSubRangeStart=this.currentSubtrahendRange[1],this.findNextRange();e[0]=t,e[1]=this.currentSubtrahendRange[0],e[2]=this.currentMinuendRange[2],this.currentSubtrahendRange[1]>=this.currentMinuendRange[1]?(this.currentMinuendRange=null,this.minuendSubRangeStart=-1):this.minuendSubRangeStart=this.currentSubtrahendRange[1]}return e}subtrahendIsBehind(){if(this.currentSubtrahendRange){const e=this.minuendSubRangeStart>=0?this.minuendSubRangeStart:this.currentMinuendRange[0];return this.currentSubtrahendRange[1]<=e}return this.subtrahendRangeIterator.hasMoreRanges()}}t.SubtractIterator=n},139978:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SubtractOperator=void 0;const s=i(912057),n=i(114924);t.SubtractOperator=class{constructor(){this.minuend=null,this.subtrahend=null,this.resultIterator=new n.SubtractIterator}setOperand(e){this.minuend=e}setSubtrahend(e){this.subtrahend=e}getRangeIteratorForBufferSet(e){if(!this.minuend||!this.subtrahend)return s.log.info("SubtractOperator.getRangeIteratorForBufferSet should be called with subtrahend and minuend"),null;const t=this.minuend.getRangeIteratorForBufferSet(e);if(!t)return null;const i=this.subtrahend.getRangeIteratorForBufferSet(e);return i?(this.resultIterator.reset(t,i),this.resultIterator):t}makeSceneDebugObject(e){const t={text:"SubtractOperator",children:[]};return(0,n.addDebuggableChild)(t,this.minuend),(0,n.addDebuggableChild)(t,this.subtrahend),t}}},473059:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectedSectionPlane=t.SectionPlane=void 0;const s=i(499432),n=i(196207),r=i(114924),a=i(695519),o=i(23658),c=i(713289),l=i(905898),h=i(7401),d=i(264292),u=i(613199),g=i(322012),p=i(193786);class m extends r.UIElement{constructor(e,t,i,s,n,a=1){super(n),this.normal=e,this.tangent=t,this.center=i,this.elementConnection=s,this.faceSize=a,this.isPreSelected=!1,this.isSelected=!1,this.isHiddenFromPick=!1,this.manipulator=null,this.inversePreManipulationMatrix=null,this.preManipulationCenter=null,this.preManipulationNormal=null,this.preManipulationTangent=null,this.inferredCenter=null,this.label=-1,this.isManipulatorRemovedOnDeselection=!0,this.editSubject=new g.Subject,this.listenTo(this,r.UiEvents.CLICK+o.SECTIONPLANE_SELECTION_ID,this.onClick),this.listenTo(this,r.UiEvents.MOUSE_ENTER+o.SECTIONPLANE_SELECTION_ID,this.onMouseEnter),this.listenTo(this,r.UiEvents.MOUSE_LEAVE+o.SECTIONPLANE_SELECTION_ID,this.onMouseLeave),this.listenTo(this,r.UiEvents.SELECT+o.SECTIONPLANE_SELECTION_ID,this.onSelect),this.listenTo(this,r.UiEvents.DESELECT+o.SECTIONPLANE_SELECTION_ID,this.onDeselect),this.listenTo(this,r.UiEvents.DOUBLE_CLICK+o.SECTIONPLANE_SELECTION_ID,this.onDoubleClick),this.center=d.vec3.clone(i),e.length<4?this.normal=d.vec4.fromValues(e[0],e[1],e[2],0):this.normal=d.vec4.clone(e),t.length<4?this.tangent=d.vec4.fromValues(t[0],t[1],t[2],0):this.tangent=d.vec4.clone(t)}getSelection(e,t){return new r.UISelection(this,o.SECTIONPLANE_SELECTION_ID,"")}getPickPriority(e){return r.PickPriority.SECTION_PLANE}shouldBeClearedWithSelections(){return!1}allowSelection(){const e=this.viewer.getModelViewManagers().getManager().hasActiveSketch(),t=!(0,r.isUsageBase)();return!o.sectionPlaneSelectionDisabled&&!e&&!t}onClick(e,t,i){(0,a.getActiveSectionViewState)().sectionPlaneToFocus=this,(0,a.getActiveSectionViewState)().pickOnSectionPlaneToFocus=e.sourcePick,i.requestSelectedStatus=this.allowSelection()}onTriadDoubleClick(e,t){var i;(null===(i=(0,a.getActiveSectionViewState)())||void 0===i?void 0:i.hasFaceEntities())||this.onDoubleClick(t)}onDoubleClick(e){(0,a.getActiveSectionViewState)().sectionPlaneToFocus=this,(0,a.getActiveSectionViewState)().pickOnSectionPlaneToFocus=e.sourcePick,(0,l.getCommandDispatcher)().trigger(h.commands.EDIT_SECTION_VIEW)}onMouseEnter(){this.isPreSelected=this.allowSelection(),(0,r.requestDraw)()}onMouseLeave(){this.isPreSelected=!1,(0,r.requestDraw)()}isInteractionEnabled(){return this.allowSelection()}setupManipulator(e){e||(e=this.getSelection()),this.manipulator?this.checkAndCreateInferenceControllerIfNeeded():this.createManipulator(e)}onSelect(e){this.isSelected=!0,this.setupManipulator(e),(0,r.requestDraw)()}listenToManipulator(e){this.listenTo(e,s.TriadEvents.DOUBLE_CLICKED,this.onTriadDoubleClick),this.listenTo(e,s.TriadEvents.REPOSITION_START,this.onRepositionStart),this.listenTo(e,s.TriadEvents.REPOSITION_END,this.onRepositionEnd),this.listenTo(e,s.TriadEvents.ENTER_INFERENCE,this.onEnterInference),this.listenTo(e,s.TriadEvents.LEAVE_INFERENCE,this.onLeaveInference),this.listenTo(e,c.ManipulatorEvents.CLICKED,this.onManipulatorClicked),this.listenTo(e,s.TriadEvents.ROTATION_START,this.onRotationStart),this.listenTo(e,s.TriadEvents.ROTATION_CHANGE,this.onRotationChange),this.listenTo(e,s.TriadEvents.ROTATION_EDIT,this.onRotationEdit),this.listenTo(e,s.TriadEvents.ROTATION_END,this.onRotationEnd),this.listenTo(e,s.TriadEvents.TRANSLATION_START,this.onTranslationStart),this.listenTo(e,s.TriadEvents.TRANSLATION_CHANGE,this.onTranslationChange),this.listenTo(e,s.TriadEvents.TRANSLATION_EDIT,this.onTranslationEdit),this.listenTo(e,s.TriadEvents.TRANSLATION_END,this.onTranslationEnd),this.listenTo((0,p.getSelectionList)(),"reset",this.onDeselect)}createManipulator(e){let t=this.center;const i=e.sourcePick?e.sourcePick.location:null;if(i){const e=this.viewer.getCamera().getRay(i[0],i[1]),s=(0,r.intersectRayPlane)(e,this.getWorldSpacePlaneEquation());s&&(t=s)}this.manipulator=new r.Triad(this.viewer,c.TriadManipulatorType.PLANE,{displayEditView:!0}),this.manipulator.updateDefinition(this.getWorldSpaceMatrix(t)),this.viewer.getEventDispatcher().trigger(r.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER,this.manipulator,this.elementConnection),this.listenToManipulator(this.manipulator),this.previewStateChangeSubscription=(0,r.getEditState)().stateChangedObservable.pipe((0,g.filter)((e=>e===r.Events.PREVIEW_STATE_CHANGE))).subscribe((()=>this.onPreviewStateChange()))}onRepositionStart(){const e=this.checkAndCreateInferenceControllerIfNeeded();null!==e&&e.startInferencing(),this.preManipulationCenter=this.center,this.editSubject.next(!1)}checkAndCreateInferenceControllerIfNeeded(){const e=n.DocumentController.getOpenDocumentController();if(!e)return null;const t=e.getSectionPlaneInferenceControllerManager();return t&&t.activeManipulator!==this.manipulator?(this.viewer.getEventDispatcher().trigger(r.CREATE_SECTION_PLANE_INFERENCE_CONTROLLER,this.manipulator,this.elementConnection),t.activeController):null}onRepositionEnd(){this.inferredCenter?(this.center=this.inferredCenter,(0,a.setSerializableDataDirty)(!0)):this.manipulator.updateOrigin(this.preManipulationCenter),this.inferredCenter=null,this.editSubject.next(!0)}onEnterInference(e){this.inferredCenter=e}onLeaveInference(){this.inferredCenter=null}onPreviewStateChange(){(0,r.isUsageBase)()||this.onDeselect()}onDeselect(){this.manipulator&&(this.getIsManipulatorRemovedOnDeselection()?this.destroyManipulator():this.manipulator.removeEditViewAndHighlights()),this.isSelected=!1,(0,r.requestDraw)()}destroyManipulator(){this.manipulator&&(this.stopListening(this.manipulator),this.previewStateChangeSubscription.unsubscribe(),this.manipulator.remove(),this.manipulator=null,this.viewer.getEventDispatcher().trigger(r.DESTROY_SECTION_PLANE_INFERENCE_CONTROLLER))}getIsManipulatorRemovedOnDeselection(){return this.isManipulatorRemovedOnDeselection}setIsManipulatorRemovedOnDeselection(e){this.isManipulatorRemovedOnDeselection=e}rotationStart(e){this.preManipulationCenter=d.vec3.fromValues(this.center[0],this.center[1],this.center[2]),this.preManipulationNormal=d.vec4.fromValues(this.normal[0],this.normal[1],this.normal[2],0),this.preManipulationTangent=d.vec4.fromValues(this.tangent[0],this.tangent[1],this.tangent[2],0),this.inversePreManipulationMatrix=u.mat4C.inverse(e,d.mat4.create())}onManipulatorClicked(e){if(e instanceof r.Linear){const e=this.manipulator,t=d.mat4.clone(e.transform),i=0;e.processUpdateFromAngularManipulator(i,t,Math.PI),this.onRotationEdit(t);const s=e.linearManipulators[0];if(s){const e=s.initialRay;if(e){const t=u.vec3C.scale(e.direction,-1,d.vec3.create());s.initialRay=new r.Ray(e.point,t)}}}}onRotationStart(){this.rotationStart(this.manipulator.transform),this.editSubject.next(!1)}onRotationChange(){const e=u.mat4C.multiply(this.manipulator.transform,this.inversePreManipulationMatrix,d.mat4.create());this.center=u.mat4C.multiplyVec3(e,this.preManipulationCenter,d.vec3.create()),this.normal=u.mat4C.multiplyVec4(e,this.preManipulationNormal,d.vec4.create()),this.tangent=u.mat4C.multiplyVec4(e,this.preManipulationTangent,d.vec4.create()),(0,a.setSerializableDataDirty)(!0)}onRotationEdit(e){this.rotationStart(e),this.onRotationChange(),this.editSubject.next(!0)}onRotationEnd(){this.editSubject.next(!0)}equals(e){return(0,r.areVectorsEqual)(this.normal,e.normal)&&(0,r.areVectorsEqual)(this.tangent,e.tangent)&&(0,r.areVectorsEqual)(this.center,e.center)}onTranslationStart(){this.preManipulationCenter=d.vec3.fromValues(this.center[0],this.center[1],this.center[2]),this.editSubject.next(!1)}onTranslationChange(e){u.vec3C.add(this.preManipulationCenter,e,this.center),(0,a.setSerializableDataDirty)(!0)}onTranslationEdit(e){this.onTranslationStart(),this.onTranslationChange(e),this.editSubject.next(!0)}onTranslationEnd(){this.editSubject.next(!0)}onRemove(){this.onDeselect()}getWorldSpacePlaneEquation(){const e=d.vec3.dot(this.normal,this.center);return d.vec4.fromValues(this.normal[0],this.normal[1],this.normal[2],-e)}getWorldSpaceMatrix(e){const t=u.vec3C.cross(this.tangent,this.normal,d.vec3.create());return d.mat4.fromValues(this.tangent[0],this.tangent[1],this.tangent[2],0,t[0],t[1],t[2],0,-this.normal[0],-this.normal[1],-this.normal[2],0,e[0],e[1],e[2],1)}getCameraSpacePlaneEquation(e,t){const i=u.mat4C.multiplyVec4(e,this.normal,d.vec4.create()),s=d.vec3.dot(i,t);return d.vec4.fromValues(i[0],i[1],i[2],-s)}getCameraSpaceTangent(e){return u.mat4C.multiplyVec4(e,this.tangent,d.vec4.create())}getCameraSpaceCenter(e){return u.mat4C.multiplyVec3(e,this.center,d.vec3.create())}getPlaneMatrix(e){e||(e=d.mat4.create()),e[0]=this.tangent[0],e[1]=this.tangent[1],e[2]=this.tangent[2],e[3]=0;const t=d.vec3.create(),i=d.vec3.create();return u.vec3C.cross(this.normal,this.tangent,i),u.vec3C.normalize(i,t),e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=0,e[8]=this.normal[0],e[9]=this.normal[1],e[10]=this.normal[2],e[11]=0,e[12]=this.center[0],e[13]=this.center[1],e[14]=this.center[2],e[15]=1,e}getViewManipulatorOrigin(e){return e||(e=d.vec3.create()),e[0]=this.manipulator?this.manipulator.transform[12]:this.center[0],e[1]=this.manipulator?this.manipulator.transform[13]:this.center[1],e[2]=this.manipulator?this.manipulator.transform[14]:this.center[2],e}getEditObservable(){return this.editSubject.asObservable()}isMeshIncrementCoplanar({points:e},t){const i=d.vec3.create();for(let s=0;s<e.length;s+=3)if(i[0]=e[s]-this.center[0],i[1]=e[s+1]-this.center[1],i[2]=e[s+2]-this.center[2],Math.abs(d.vec3.dot(i,this.normal))>t)return!1;return!0}}t.SectionPlane=m,t.getSelectedSectionPlane=function(e){const t=e.getUISelectionManager().getSelection();if(t&&t.selectionId===o.SECTIONPLANE_SELECTION_ID&&t.uiElement instanceof m&&(t.uiElement.isSelected||t.uiElement.isPreSelected))return t.uiElement}},695519:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.setFromSerializableSectionViewData=t.setFromSerializablePlaneData=t.getSerializableSectionViewDataWithPersistentQueries=t.getSerializableSectionViewData=t.getSerializablePlaneData=t.loadState=t.saveAndClearState=t.resetSectionPlanesHiddenFromPick=t.hideSectionPlaneFromPick=t.isSectionPlaneModeEnabled=t.getSectionedItemsSize=t.getSectionPlaneCount=t.loadSectionPlanesFromParameters=t.removeSectionPlane=t.removeSectionPlanes=t.setSectionPlaneOnMatrix=t.setSectionPlaneOnMateConnector=t.clearSavedSectionPlaneParameters=t.getMostRecentActiveSectionPlaneParameters=t.updateShaderEndcapPatternUniforms=t.updateShaderEndcapPickingUniforms=t.updateShaderEndcapUniforms=t.updateShaderClippingUniforms=t.setForcePredictableHatching=t.makePlaneEquationMatrixDirty=t.getSectionPlaneOccurrenceIds=t.filterActiveSectionPlanes=t.forEachActiveSectionPlane=t.getActiveSectionPlane=t.areAnySectionPlanesSelectedOrPreselected=t.getPlaneIndexToAlignNormalTo=t.getCurrentSectionPlaneParameters=t.getActiveSectionViewState=t.SectionViewState=t.setSectionEntitiesEnabled=t.SectionedItemType=t.getMaxSectionPlanes=t.setSerializableDataDirty=void 0;const s=i(142885),n=i(545348),r=i(681459),a=i(912057),o=i(193786),c=i(906772),l=i(606544),h=i(760240),d=i(23658),u=i(473059),g=i(950704),p=i(726759),m=i(649480),E=i(723617),I=i(378695),T=i(264292),S=i(613199),f=i(905898),C=i(7401),P=i(322012),v=i(14715),D=i(662525),M=i(196207),y=n.default.getManager();let O=!1,_=0;function A(){return 3}var R;t.setSerializableDataDirty=function(e){O=e},t.getMaxSectionPlanes=A,function(e){e[e.Excluded=0]="Excluded",e[e.Included=1]="Included"}(R||(t.SectionedItemType=R={}));let N=!1;t.setSectionEntitiesEnabled=function(e){var t;N=e,null===(t=L())||void 0===t||t.setEntitiesEnabled(N)};class w extends s.BackboneEventsBaseClass{constructor(e=!0){super(),this.sectionPlanes=[],this.sectionedItems=[null,null],this.currentSectionedItemType=R.Excluded,this.isListening=!1,this.elementId="",this.eligibleCompositeParts=[new Set,new Set],this.areEntitiesEnabled=!1,this.entitiesElement=null,this.isRequestingEntities=!1,this.editSubject=new P.Subject,this.planeEditSubscriptions=new Map,this.hasVisibilityUpdate=!1,e&&this.setEntitiesEnabled(N)}isNotEmpty(){var e,t;return this.sectionPlanes.length>0||(null===(e=this.sectionedItems[R.Excluded])||void 0===e?void 0:e.selections.length)>0||(null===(t=this.sectionedItems[R.Included])||void 0===t?void 0:t.selections.length)>0}setupListeners(){this.isListening=!0,this.listenTo((0,h.getActiveViewerEventDispatcher)(),h.NON_TRIVIAL_PART_STUDIO_DATA_PROCESSED,this.onPartStudioDisplayDataChanged),this.listenTo((0,h.getActiveViewerEventDispatcher)(),h.PART_STUDIO_PART_VISIBILITY_CHANGED,this.onPartVisibilityChanged),this.listenTo((0,h.getActiveViewerEventDispatcher)(),h.ASSEMBLY_DATA_PROCESSED,this.onAssemblyDataProcessed),this.listenTo((0,f.getCommandDispatcher)(),C.commands.EXIT_EDIT_INCONTEXT,this.removeAssemblyParts)}stopListening(e,t,i){this.isListening&&(super.stopListening(e,t,i),this.isListening=!1)}updateEntitiesIfEnabled(){this.areEntitiesEnabled&&this.updateEntities((0,m.getActiveViewer)(),this.getElementConnection())}updateEntitiesIfMicroversionChanged(e){var t;e.to.deepEquals(e.from)?null===(t=this.entitiesElement)||void 0===t||t.hide():this.updateEntitiesIfEnabled()}doesPartStudioDisplayDataContainGeometryChanges(e){return Object.values(e.deterministicPartIdToData).some((e=>e.isDeletion||e.entityDIds.length>0))}onPartStudioDisplayDataChanged(e){this.setAllOccurrencesClippedExceptSelectedOnes(this.getIsExcludingItemsForSection()),(this.doesPartStudioDisplayDataContainGeometryChanges(e)||this.hasVisibilityUpdate)&&(this.updateEntitiesIfMicroversionChanged(e.microversionIdAndConfigurationInterval),this.hasVisibilityUpdate=!1)}onPartVisibilityChanged(){this.hasVisibilityUpdate=!0,this.clearEntities()}onAssemblyDataProcessed(e){this.removeDeletedOccurrencesFromSectionedItems(e),this.setAllOccurrencesClippedExceptSelectedOnes(this.getIsExcludingItemsForSection());const t=e.occurrences.length,i=e.deletedOccurrences.length;(t>0||i>0)&&this.updateEntitiesIfMicroversionChanged(e.microversionIdAndConfigurationInterval)}removeDeletedOccurrencesFromSectionedItems(e){if(0===e.deletedOccurrences.length)return;const t=this.getSectionedItems();if(t&&t.length>0){const i=new Set(e.deletedOccurrences.map((e=>e.getPathAsString())));t.reset(t.filter((e=>!i.has(e.getOccurrence().getPathAsString()))))}}setAllOccurrencesClippedExceptSelectedOnes(e){const t=(0,m.getActiveViewer)(),i=t.getModelViewManagers().getManager(),s=(0,r.isInAssemblyElement)()?i.getDisplayedAssembly():i.getDisplayedInContextAssembly();if(s){const t=this.getSectionedItemsAsSetOfOccurrencePaths();s.setAreOccurrencesClippedBySectionPlaneExcept(e,t)}if((0,r.isInPartStudioElement)()){const s=!0,n=this.getSectionedItemsAsSetOfBodyIds(s),r=i.getDisplayedPartStudio();if(r&&r.getBodyComponent().setAreOccurrencesClippedBySectionPlaneExcept(e,n),t.getModelViewManagers().previewManagerExists()){const i=t.getModelViewManagers().getPreviewManager().getDisplayedPartStudio();i&&i.getBodyComponent().setAreOccurrencesClippedBySectionPlaneExcept(e,n)}}}getIsExcludingItemsForSection(){return this.currentSectionedItemType===R.Excluded}getCurrentSectionedItemType(){return this.currentSectionedItemType}getElementConnection(){return M.DocumentController.getOpenDocumentController().elementConnection}onSectionPlaneEdit(e,t){if(this.editSubject.next({plane:e,isValidForEntities:t}),this.areEntitiesEnabled)if(t){const e=(0,m.getActiveViewer)(),t=this.getElementConnection();this.updateEntities(e,t)}else this.clearEntities()}setIsExcludingItemsForSection(e){this.currentSectionedItemType=e?R.Excluded:R.Included,O=!0,this.setAllOccurrencesClippedExceptSelectedOnes(e);(0,m.getActiveViewer)().requestDraw()}getSectionPlanes(){return this.sectionPlanes}clearSectionPlanes(){this.sectionPlanes=[],this.clearEntities()}addSectionPlane(e){this.sectionPlanes.push(e);const t=e.getEditObservable().subscribe((t=>{this.onSectionPlaneEdit(e,t)}));this.planeEditSubscriptions.set(e,t),this.onSectionPlaneEdit(e,!0)}removeSectionPlane(e){this.onSectionPlaneEdit(e,!0),this.sectionPlanes=this.sectionPlanes.filter((t=>t!==e));const t=this.planeEditSubscriptions.get(e);t&&(t.unsubscribe(),this.planeEditSubscriptions.delete(e))}getEditObservable(){return this.editSubject.asObservable()}destroySectionedItems(){this.currentSectionedItemType=R.Excluded,this.sectionedItems.forEach((e=>{e&&e.destroy()})),this.stopListening(),this.sectionedItems=[null,null],this.eligibleCompositeParts.forEach((e=>e.clear())),this.elementId=""}setElementId(e,t){this.elementId!==e&&(""!==this.elementId&&this.destroySectionedItems(),this.elementId=e,this.sectionedItems[R.Excluded]=new c.RemappedSelectionListWrapper(e),this.sectionedItems[R.Included]=new c.RemappedSelectionListWrapper(e),t&&this.setupListeners())}getElementId(){return this.elementId}setIsItemClipped(e,t){if(!e)return;const i=(0,m.getActiveViewer)(),s=i.getModelViewManagers().getManager(),n=(0,r.isInAssemblyElement)()?s.getDisplayedAssembly():s.getDisplayedInContextAssembly();let a=!1;if(n){const i=e.getOccurrence();i&&(n.setAllLeafOccurrencesClippedForOccurrence(i,t),a=!0)}(0,r.isInPartStudioElement)()&&!a&&s.getDisplayedPartStudio().getBodyComponent().setIsBodyClippedBySectionPlane(e.getBodyId(),t,!1,this.getHasEligibleCompositeParts()?this.getSectionedItemsAsSetOfBodyIds():null),i.requestDraw()}getHasEligibleCompositeParts(e){return e=null!=e?e:this.currentSectionedItemType,this.eligibleCompositeParts[e].size>0}addSectionedItem(e,t){var i,s;""!==this.getElementId()?(null==t&&(t=this.currentSectionedItemType),null===(i=this.getSectionedItems(t))||void 0===i||i.add(e),t===this.currentSectionedItemType&&this.setIsItemClipped(e,!this.getIsExcludingItemsForSection()),(null===(s=e.getBodyMetaData())||void 0===s?void 0:s.isNonGroupingCompositeBody)&&this.eligibleCompositeParts[t].add(e.getBodyId()),O=!0):a.log.warn("SectionViewState.addSectionedItem used without initializing via setElementId")}removeSectionedItem(e,t){var i,s;if(""===this.getElementId())return void a.log.warn("SectionViewState.removeSectionedItem used without initializing via setElementId");null==t&&(t=this.currentSectionedItemType);(null===(i=this.getSectionedItems(t))||void 0===i?void 0:i.remove(e))&&(t===this.currentSectionedItemType&&this.setIsItemClipped(e,this.getIsExcludingItemsForSection()),(null===(s=e.getBodyMetaData())||void 0===s?void 0:s.isNonGroupingCompositeBody)&&this.eligibleCompositeParts[t].delete(e.getBodyId()),O=!0)}getSectionedItems(e){return""===this.getElementId()?(a.log.error("SectionViewState.getSectionedItems used without initializing via setElementId"),null):(null==e&&(e=this.currentSectionedItemType),this.sectionedItems[e]?this.sectionedItems[e].selections:null)}getSectionedItemsAsSetOfBodyIds(e){const t=new Set,i=this.getSectionedItems();return i&&i.forEach((i=>{!i||e&&i.getOccurrence()||t.add(i.getBodyId())})),t}getSectionedItemsAsSetOfOccurrencePaths(){const e=new Set,t=this.getSectionedItems();return t&&t.forEach((t=>{const i=t.getOccurrence();i&&e.add(i.getPathAsString())})),e}resetSectionedItems(e,t){if(""===this.getElementId())return void a.log.warn("SectionViewState.resetSectionedItems used without initializing via setElementId");const i=new o.SelectionList("newSelectionList",e),s=this.getSectionedItems(t);for(let e=s.length-1;e>=0;--e){const n=s.at(e);i.has(n)||this.removeSectionedItem(n,t)}i.forEach((e=>{s.has(e)||this.addSectionedItem(e,t)}))}destroy(){this.clearEntities(),q(!1),this.destroySectionedItems()}static copy(e,t,i){var s,n;if(e&&t){t.sectionPlanes=[];for(const i of e.sectionPlanes)t.addSectionPlane(i);t.currentSectionedItemType=e.currentSectionedItemType,""!==e.getElementId()&&(t.elementId="",t.setElementId(e.getElementId(),i),null===(s=t.getSectionedItems(R.Excluded))||void 0===s||s.reset(e.getSectionedItems(R.Excluded).toArray()),null===(n=t.getSectionedItems(R.Included))||void 0===n||n.reset(e.getSectionedItems(R.Included).toArray()),t.eligibleCompositeParts[R.Excluded]=new Set(e.eligibleCompositeParts[R.Excluded]),t.eligibleCompositeParts[R.Included]=new Set(e.eligibleCompositeParts[R.Included]))}}clone(e){const t=new w;return w.copy(this,t,e),t}setFrom(e,t){if(!e)return!1;w.copy(e,this,t);const i=this.sectionPlanes.length>0;return i&&(O=!0,this.sectionPlanes.forEach((function(e){e.viewer.getEventDispatcher().trigger(h.SECTION_PLANE_ADDED,e)}))),i}getSectionedItemsSize(e){var t,i;return""===this.getElementId()?(a.log.warn("SectionViewState.getSectionedItemsSize used without initializing via setElementId"),0):null!==(i=null===(t=this.getSectionedItems(e))||void 0===t?void 0:t.length)&&void 0!==i?i:0}removeAssemblyParts(){const e=[],t=t=>{t.occurrence&&e.push(t)};this.sectionedItems[R.Excluded].selections.forEach(t),this.sectionedItems[R.Included].selections.forEach(t),e.forEach((e=>this.removeSectionedItem(e)))}getSerializedSectionPlanes(){return this.getSectionPlanes().map((e=>{const t=new l.BTGraphicsSectionPlaneData;return t.center.updateFromArray(e.center),t.normal.updateFromArray(e.normal),t.tangent.updateFromArray(e.tangent),t}))}clearEntities(){this.setEntitiesElement(null),this.isRequestingEntities=!1}disableEntities(){this.clearEntities(),this.areEntitiesEnabled=!1}updateEntities(e,t){this.areEntitiesEnabled&&this.clearEntities(),this.generateEntities(e,t)}enableEntities(e=!1){const t=(0,m.getActiveViewer)(),i=this.getElementConnection();this.areEntitiesEnabled?e&&this.updateEntities(t,i):(this.areEntitiesEnabled=!0,this.generateEntities(t,i))}setEntitiesEnabled(e,t=!1){e?this.enableEntities(t):this.disableEntities()}setEntitiesElement(e){var t;null===(t=this.entitiesElement)||void 0===t||t.remove(),this.entitiesElement=e}generateEntities(e,t){var i;if(this.entitiesElement)return;const s=new l.BTUiGenerateSectionEntities;if(s.elementId=this.elementId,s.sectionPlanes=this.getSerializedSectionPlanes(),s.currentSectionedItemType=this.getCurrentSectionedItemType(),0===s.sectionPlanes.length)return;const n=[],r=[];null===(i=this.getSectionedItems())||void 0===i||i.forEach((e=>{let t=e.getOccurrence();if((null==t?void 0:t.isAssemblyRoot())&&(t=new l.BTOccurrence),t)return void n.push(t);const i=e.getPartId();i&&r.push(i)})),s.selectedItems=n,s.partIds=r;const o=performance.now(),c=new v.TaskFeedbackOptions("sectionplane_helpers.SectionViewState.generateEntities");c.setImportant(i18n("Generating entities")),t.callAndPromiseWithFeedback(s,c).then((t=>{if(!(t instanceof l.BTUiGenerateSectionEntitiesResponse))return;if(!this.areEntitiesEnabled||!this.isRequestingEntities)return;const i=performance.now()-o,s=t.occurrenceList.length+t.partIds.length;a.log.debug(`Toggle section entities time taken ${i}ms. Number of bodies=${s}`),this.setEntitiesElement(new D.SectionViewEntitiesElement(this.elementId,this,e)),this.entitiesElement.populate(t)})).catch((e=>{a.log.error(e),this.clearEntities()})),this.isRequestingEntities=!0}hasEntities(){return!!this.entitiesElement}hasFaceEntities(){var e,t;return null!==(t=null===(e=this.entitiesElement)||void 0===e?void 0:e.hasFaceEntities())&&void 0!==t&&t}getSelectedFaceEntityForAlignment(){var e,t;return null!==(t=null===(e=this.entitiesElement)||void 0===e?void 0:e.getSelectedFaceEntityForAlignment())&&void 0!==t?t:null}extractMeshIncrement(e){var t,i;return null!==(i=null===(t=this.entitiesElement)||void 0===t?void 0:t.extractMeshIncrement(e))&&void 0!==i?i:null}getEntityMetaData(e){var t,i;return null!==(i=null===(t=this.entitiesElement)||void 0===t?void 0:t.getEntityMetaData(e))&&void 0!==i?i:null}}t.SectionViewState=w;const b=new w(!1);function L(){return b}t.getActiveSectionViewState=L;const B=T.mat4.create(),F=T.mat4.create(),x=T.mat4.create();let U=[];const G=function(){U=V()};function V(){const e=[];return b.getSectionPlanes().forEach((function(t){const i={};i.center=T.vec3.clone(t.center),i.tangent=T.vec4.clone(t.tangent),i.normal=T.vec4.clone(t.normal),e.push(i)})),e}t.getCurrentSectionPlaneParameters=V;t.getPlaneIndexToAlignNormalTo=function(e){let t=-1,i=-1;return b.getSectionPlanes().forEach((function(s,n){!1!==e&&s.isPreSelected?t=-1===t?n:-2:s.isSelected&&(i=-1===i?n:-2)})),t>-1?t:i>-1?i:-1},t.areAnySectionPlanesSelectedOrPreselected=function(){const e=b.getSectionPlanes();for(let t=0;t<e.length;t++){const i=e[t];if(i.isSelected||i.isPreSelected)return!0}return!1},t.getActiveSectionPlane=function(e){const t=b.getSectionPlanes();return(e<0||e>=t.length)&&a.log.warn("attempting to retrieve a section plane with an invalid index"),t[e]},t.forEachActiveSectionPlane=function(e,t){b.getSectionPlanes().forEach(e,t)},t.filterActiveSectionPlanes=function(e,t){return b.getSectionPlanes().filter(e,t)},t.getSectionPlaneOccurrenceIds=function(){const e=[];return b.getSectionPlanes().forEach((function(t){e.push(t.graphicsOccurrenceId)})),e},t.makePlaneEquationMatrixDirty=function(){_=-1};const H=y.getNumber("SECTION_PLANE_ENDCAP_ORTHOGRAPHIC_Z_FIGHTING_FACTOR"),k=y.getNumber("SECTION_PLANE_ENDCAP_PERSPECTIVE_Z_FIGHTING_FACTOR"),W=y.getNumber("SECTION_PLANE_INTER_ENDCAP_Z_FIGHTING_FACTOR");let z=!1;t.setForcePredictableHatching=function(e){z=e},t.updateShaderClippingUniforms=function(e,t,i){const s=e.getRenderContext(),n=s.getActiveShader(),r=b.getSectionPlanes();if(!t||!e.areSectionPlanesEnabled()||0===r.length)return void n.uniform1f("uSectionPlaneCount",0);!function(e,t){if(!t&&_===e.getFrameId())return;let i,s;const n=b.getSectionPlanes();for(i=0;i<n.length;++i){const t=n[i].getCameraSpaceCenter(e.modelViewMatrix),r=n[i].getCameraSpacePlaneEquation(e.modelViewMatrix,t),a=n[i].getCameraSpaceTangent(e.modelViewMatrix);for(s=0;s<4;++s)B[4*s+i]=r[s],x[4*s+i]=a[s];for(s=0;s<3;++s)F[4*s+i]=t[s]}t||(_=e.getFrameId())}(s,i),n.uniformMatrix4fv("uSectionPlaneEquations",!1,B),n.uniform1f("uSectionPlaneCount",r.length);const a=s.getActiveCamera(),o=a.getFarDepth()-a.getNearDepth(),c=o*(a.isOrthographic()?H:k),l=o*W;n.uniform1f("uEndcapZFightingThreshold",c),n.uniform1f("uInterEndcapZFightingThreshold",l),n.uniform1f("uUseOccurrenceIdForHatchOffset",z?0:1)},t.updateShaderEndcapUniforms=function(e,t){const i=b.getSectionPlanes();if(t<0||i.length<=t)return;const s=e.getActiveShader();s.uniformMatrix4fv("uSectionPlaneCenters",!1,F),s.uniformMatrix4fv("uSectionPlaneTangents",!1,x)},t.updateShaderEndcapPickingUniforms=function(e,t){const i=b.getSectionPlanes();if(t<0||i.length<=t)return;const s=i[t],n=e.getActiveShader();n.uniform1f("uOccurrenceId",s.graphicsOccurrenceId);const r=[0,0,0,0];for(let e=0;e<i.length;++e)r[e]=i[e].isHiddenFromPick?1:0;n.uniform4fv("uSectionPlaneIsHiddenFromPick",r)},t.updateShaderEndcapPatternUniforms=function(e,t){const i=b.getSectionPlanes();if(t<0||i.length<=t)return;const s=i[t],n=e.getActiveShader();n.uniform1f("uSectionPlaneIsPreSelected",s.isPreSelected?1:0),n.uniform1f("uSectionPlaneIsSelected",s.isSelected?1:0),n.uniform4fv("uSectionPlanePreSelectColor",y.getColor("SECTION_PLANE_PRE_HIGHLIGHT_COLOR")),n.uniform4fv("uSectionPlaneSelectColor",y.getColor("ENTITY_HIGHLIGHT_COLOR1")),n.uniform4fv("uSectionPlaneIntersectingColor",y.getColor("SECTION_PLANE_INTERSECTING_COLOR"));const r=y.getColor("SECTION_PLANE_SELECTOR_COLOR_0"),a=y.getColor("SECTION_PLANE_SELECTOR_COLOR_1"),o=y.getColor("SECTION_PLANE_SELECTOR_COLOR_2"),c=y.getColor("SECTION_PLANE_SELECTOR_COLOR_3");n.uniformMatrix4fv("uSectionPlaneSelectorColor",!1,T.mat4.fromValues(r[0],a[0],o[0],c[0],r[1],a[1],o[1],c[1],r[2],a[2],o[2],c[2],r[3],a[3],o[3],c[3]));const h=e.getActiveCamera();if(h.isPerspective()){const e=h.getSceneBounds().diameter(),t=(h.distanceToCenter()+.5*e)/h.getViewportHeight();n.uniform1f("uSectionPlanePatternScale",t*y.getNumber("SECTION_PLANE_PERSPECTIVE_PATTERN_SCALE"))}else{const e=1/(h.projectionMatrix[5]*h.getViewportHeight());n.uniform1f("uSectionPlanePatternScale",e*y.getNumber("SECTION_PLANE_ORTHOGRAPHIC_PATTERN_SCALE"))}n.uniform1f("uSectionPlanePatternFade",y.getNumber("SECTION_PLANE_PATTERN_FADE")),n.uniform1f("uSectionPlanePatternThickness",y.getNumber("SECTION_PLANE_PATTERN_THICKNESS")),n.uniform1f("uSectionPlanePatternPacingVariation",y.getNumber("SECTION_PLANE_PATTERN_PACING_VARIATION"));let d=0,u=1;switch(e.renderingMode){case l.GBTGraphicsRenderMode.HIDDEN_LINE_REMOVED:case l.GBTGraphicsRenderMode.HIDDEN_LINE_VISIBLE:case l.GBTGraphicsRenderMode.WIREFRAME:case l.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION:d=1;break;case l.GBTGraphicsRenderMode.TRANSLUCENT:u=y.getNumber("TRANSLUCENT_PASS_ALPHA")}n.uniform1f("uSectionPlanePatternIsBlackAndWhite",d),n.uniform1f("uSectionPlaneEndcapAlpha",u),n.uniform1f("uSectionPlaneIsolateContextOpacity",y.getNumber("ISOLATE_CONTEXT_FACE_TRANSPARENCY")),n.uniform1f("uSectionPlaneIntersectingAdditionalAlpha",y.getNumber("SECTION_PLANE_INTERSECTING_ADDITIONAL_ALPHA"))};const j=function(e){b.getSectionPlanes().length<3?(b.addSectionPlane(e),O=!0,e.viewer.getEventDispatcher().trigger(h.SECTION_PLANE_ADDED,e)):e.viewer.getEventDispatcher().trigger(h.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED)},X=function(e,t){if(b.getSectionPlanes().length<3){j(e);const i=new g.UISelection(e,d.SECTIONPLANE_SELECTION_ID,"");i.sourcePick=t;e.viewer.getUISelectionManager().setSelection(i)}else e.viewer.getEventDispatcher().trigger(h.MAXIMUM_NUMBER_OF_SECTION_PLANES_REACHED)};function q(e){e?G():U=[],b.getSectionPlanes().forEach((function(e){Y(e)})),b.clearSectionPlanes(),O=!0}function Y(e){b.removeSectionPlane(e),e.onRemove(),O=!0,e.viewer.getEventDispatcher().trigger(h.SECTION_PLANE_REMOVED,e)}t.getMostRecentActiveSectionPlaneParameters=function(){return U},t.clearSavedSectionPlaneParameters=function(){U=[]},t.setSectionPlaneOnMateConnector=function(e,t,i,s){const n=s.getModelViewManagers().getManager().getMateConnectorGraphics(e,t);if(!n)return;const r=T.vec3.clone(n.worldSpacePosition),a=S.mat4C.multiplyVec4(n.transform,T.vec4.fromValues(0,0,1,0),T.vec4.create());S.vec4C.negate(a),S.quat4C.normalize(a);const o=S.mat4C.multiplyVec4(n.transform,T.vec4.fromValues(1,0,0,0),T.vec4.create());S.quat4C.normalize(o),X(new u.SectionPlane(a,o,r,i,s))},t.setSectionPlaneOnMatrix=function(e,t,i,s,n){if(!t||s||!i)return;const r=T.vec4.fromValues(t[8],t[9],t[10],0),a=T.vec4.fromValues(t[0],t[1],t[2],0),o=T.vec3.fromValues(t[12],t[13],t[14]),c=T.vec3.dot(r,o)-T.vec3.dot(i.center(),r),l=S.vec3C.add(i.center(),S.vec3C.scale(r,c,T.vec3.create()),T.vec3.create()),h=(0,p.getDrawer)().getCamera();T.vec3.dot(h.direction,r)<0&&(S.vec3C.negate(r),S.vec3C.negate(a)),X(new u.SectionPlane(r,a,l,n,e,i.diameter()))},t.removeSectionPlanes=q,t.removeSectionPlane=Y,t.loadSectionPlanesFromParameters=function(e,t,i,s){q(!1),e.forEach((function(e){const n=new u.SectionPlane(e.normal,e.tangent,e.center,t,i);L().sectionPlaneToFocus&&L().sectionPlaneToFocus.equals(n)?(L().sectionPlaneToFocus=n,X(n,L().pickOnSectionPlaneToFocus)):(j(n),s&&n.setupManipulator())}))},t.getSectionPlaneCount=function(){return b.getSectionPlanes().length},t.getSectionedItemsSize=function(){return b.getSectionedItemsSize()},t.isSectionPlaneModeEnabled=function(){return!(0,E.isEmptyObjectOrArray)(b.getSectionPlanes())},t.hideSectionPlaneFromPick=function(e){b.getSectionPlanes().forEach((function(t){t.graphicsOccurrenceId===e&&(t.isHiddenFromPick=!0)}))},t.resetSectionPlanesHiddenFromPick=function(){b.getSectionPlanes().forEach((function(e){e.isHiddenFromPick=!1}))},t.saveAndClearState=function(){const e=b.clone(!1);return b.destroy(),e},t.loadState=function(e){return b.destroy(),b.setFrom(e,!0)};let Z=new l.BTGraphicsSectionViewStateData;function K(e){b.getSerializedSectionPlanes().forEach((t=>{e.push(t)}))}function Q(){Z=Z.clone(),Z.sectionPlanes=[],K(Z.sectionPlanes),Z.isExcluding=b.getIsExcludingItemsForSection();const e=b.getElementId();return Z.elementId=e,e.length>0}function $(e,t){return t?new Promise((t=>{const i=(0,I.createPersistentQueryBTUiSelectionsFromSelectionArray)(b.getSectionedItems(R.Excluded).toArray()),s=(0,I.createPersistentQueryBTUiSelectionsFromSelectionArray)(b.getSectionedItems(R.Included).toArray());Promise.all([i,s]).then((i=>{e.selectionsToExclude=i[0],e.selectionsToInclude=i[1],t()}))})):(e.selectionsToExclude=(0,I.createBTUiSelectionsFromSelectionArray)(b.getSectionedItems(R.Excluded).toArray()),e.selectionsToInclude=(0,I.createBTUiSelectionsFromSelectionArray)(b.getSectionedItems(R.Included).toArray()),null)}function J(e,t,i){let s;const n=b.getSectionPlanes();if(e.length===n.length&&e.length>0)for(O=!0,s=0;s<e.length;s++)n[s].center=T.vec3.fromValues(e[s].center.x,e[s].center.y,e[s].center.z),n[s].normal=T.vec4.fromValues(e[s].normal.x,e[s].normal.y,e[s].normal.z,0),n[s].tangent=T.vec4.fromValues(e[s].tangent.x,e[s].tangent.y,e[s].tangent.z,0);else for(n.length>0&&q(!1),s=0;s<e.length;s++){const n=T.vec3.fromValues(e[s].center.x,e[s].center.y,e[s].center.z),r=T.vec4.fromValues(e[s].normal.x,e[s].normal.y,e[s].normal.z,0),a=T.vec4.fromValues(e[s].tangent.x,e[s].tangent.y,e[s].tangent.z,0);j(new u.SectionPlane(r,a,n,t,i))}}t.getSerializablePlaneData=function(){const e=[];return K(e),e},t.getSerializableSectionViewData=function(){return O&&(Q()&&$(Z,!1),O=!1),Z},t.getSerializableSectionViewDataWithPersistentQueries=function(){let e=null;return O&&Q()&&(e=$(Z,!0))?e.then((()=>(O=!1,Z))):(O=!1,Promise.resolve(Z))},t.setFromSerializablePlaneData=J,t.setFromSerializableSectionViewData=function(e,t,i){J(e.sectionPlanes,t,i),function(e,t){const i=b.getElementId();!e||""===e.elementId||""!==i&&e.elementId!==i||(b.setElementId(e.elementId,!0),b.setIsExcludingItemsForSection(e.isExcluding),(0,I.createSelectionsFromBTUiSelectionArrayAsync)(e.selectionsToExclude,t).then((e=>{b.resetSectionedItems(e,R.Excluded)})),(0,I.createSelectionsFromBTUiSelectionArrayAsync)(e.selectionsToInclude,t).then((e=>{b.resetSectionedItems(e,R.Included)})))}(e,i)}},662525:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SectionViewEntitiesElement=void 0;const s=i(606544),n=i(114924),r=i(193786),a=i(545348),o=i(681459),c=new n.NodeProperties({primitiveType:n.PrimitiveType.LINES,isPickable:!0,isHighlightable:!0,isTwoSided:!0,isShowThrough:!1,isVisible:!0,zOffset:a.default.getManager().getNumber("SECTION_EDGES_Z_OFFSET")}),l=new n.NodeProperties({primitiveType:n.PrimitiveType.POINTS,isPickable:!0,isHighlightable:!0,isTwoSided:!0,isShowThrough:!1,isVisible:!1,isSectionEntity:!0,zOffset:a.default.getManager().getNumber("SECTION_POINTS_Z_OFFSET")}),h=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLE_STRIP,isPickable:!0,isHighlightable:!0,isVisible:!0,zOffset:a.default.getManager().getNumber("PART_FACES_Z_OFFSET"),pickZOffset:a.default.getManager().getNumber("SECTION_FACES_Z_OFFSET")});let d=null;function u(){return null===d&&(d=new Map([[n.PrimitiveType.LINES,{nodeProperties:c,entityType:s.GBTEntityType.EDGE,pickPriority:n.PickPriority.PART_EDGE}],[n.PrimitiveType.POINTS,{nodeProperties:l,entityType:s.GBTEntityType.VERTEX,pickPriority:n.PickPriority.PART_VERTEX}],[n.PrimitiveType.TRIANGLE_STRIP,{nodeProperties:h,entityType:s.GBTEntityType.FACE,pickPriority:n.PickPriority.PART_FACE}]])),d}class g extends n.UIElement{constructor(e,t,i){super(i),this.elementId=e,this.state=t,this.incrementData=new Map,this.hasFace=!1,this.isCleaningUp=!1,this.selectedEntities=new Set,this.preselectedEntities=new Set,this.secondarySelectedEntities=new Set,this.sectionPlaneSelections=[],this.selectionLists={selection:(0,r.getSelectionList)(),preselection:(0,r.getPreselectionList)(),secondary:(0,r.getSecondarySelectionList)()},this.initializePlaneSelectionCounts(),this.listenToSelectionLists(),this.listenTo(this.viewer.getIsolatedOccurrenceManager(),n.IsolatedOccurrencesManager.IS_ISOLATE_FULLY_TRANSPARENT_CHANGED_EVENT,this.updateEntityVisibility)}initializePlaneSelectionCounts(){for(const e of this.state.getSectionPlanes())this.sectionPlaneSelections.push(0)}incrementPlaneSelectionCount(e,t){const i=this.sectionPlaneSelections[e];if(0===i){const i=this.state.getSectionPlanes()[e];null==i||i.onDeselect(),null==i||i.setupManipulator(t)}this.sectionPlaneSelections[e]=i+1}decrementPlaneSelectionCount(e){const t=this.sectionPlaneSelections[e],i=Math.max(0,t-1);if(this.sectionPlaneSelections[e]=i,0===i){const t=this.state.getSectionPlanes()[e];null==t||t.onDeselect()}}getHighlightType(e){return e===this.selectionLists.preselection?n.HighlightType.PRE:e===this.selectionLists.secondary?n.HighlightType.SECONDARY:n.HighlightType.ENTITY}getSelectedSetFromSelectionList(e){return e===this.selectionLists.preselection?this.preselectedEntities:e===this.selectionLists.secondary?this.secondarySelectedEntities:this.selectedEntities}findAssociatedPlaneIndex(e){const t=this.state.getSectionPlanes();let i=-1;return t.forEach(((t,s)=>{t.isMeshIncrementCoplanar(e,1e-5)&&(i=s)})),i}getSelectedFaceEntityForAlignment(){for(const e of this.preselectedEntities)return e;for(const e of this.selectedEntities)return e;return null}onSelectFace(e,t,i){this.getSelectedSetFromSelectionList(i).add(e),this.isCleaningUp||i===this.selectionLists.selection&&this.incrementPlaneSelectionCount(e.associatedPlaneIndex,t)}onDeselectFace(e,t){this.getSelectedSetFromSelectionList(t).delete(e),this.isCleaningUp||t===this.selectionLists.selection&&this.decrementPlaneSelectionCount(e.associatedPlaneIndex)}handleChangeSelectionList({list:e,selection:t,doAdd:i,doDraw:n=!0}){if(!t.isSectionEntity())return;const r=t.getIdString(),a=this.getHighlightType(e),o=this.addHighlightToSection(a,r);i?o.entityType===s.GBTEntityType.FACE&&this.onSelectFace(o,t,e):(o.entityType===s.GBTEntityType.FACE&&this.onDeselectFace(o,e),this.removeHighlightFromSection(a,r)),n&&this.viewer.requestDraw()}clearHighlightsOfType(e){for(const t of this.incrementData.values()){const i=t.highlights.get(e);void 0!==i&&(this.removeHighlightFromIncrement(t.incrementId,i),t.highlights.delete(e))}}handleResetSelectionList(e){const t=this.getHighlightType(e);this.clearHighlightsOfType(t);if(this.getSelectedSetFromSelectionList(e).clear(),e===this.selectionLists.selection)for(let e=0;e<this.sectionPlaneSelections.length;e+=1)this.sectionPlaneSelections[e]=0;e.forEach((t=>{this.handleChangeSelectionList({list:e,selection:t,doAdd:!0,doDraw:!1})})),this.viewer.requestDraw()}listenForChangesToSelectionList(e){this.listenTo(e,"add",(t=>{this.handleChangeSelectionList({list:e,selection:t,doAdd:!0})})),this.listenTo(e,"remove",(t=>{this.handleChangeSelectionList({list:e,selection:t,doAdd:!1})})),this.listenTo(e,"reset",(()=>{this.handleResetSelectionList(e)}))}listenToSelectionLists(){this.listenForChangesToSelectionList(this.selectionLists.preselection),this.listenForChangesToSelectionList(this.selectionLists.selection),this.listenForChangesToSelectionList(this.selectionLists.secondary)}getBodyId(e,t){var i,s;return null!==(s=null===(i=e.occurrenceList[t])||void 0===i?void 0:i.getPathAsString())&&void 0!==s?s:e.partIds[t]}getFullId(e,t){const i=this.getBodyId(e,t);return`${s.BTUiGenerateSectionEntitiesResponse.SECTION_IDENTIFIER}-${i}`}getEntityTypeFromPrimitiveType(e){var t,i;return null!==(i=null===(t=u().get(e))||void 0===t?void 0:t.entityType)&&void 0!==i?i:s.GBTEntityType.UNKNOWN}getColor(e){const t=this.viewer.getModelViewManagers().getManager();return e.occurrence?t.getOccurrenceColor(e.occurrence):e.partId?t.getPartColor(e.partId):null}populate(e){e.entities.forEach(((t,i)=>{const r=this.getFullId(e,i);t.forEach(((t,a)=>{t.tessellation.forEach(((t,o)=>{var c;const l=(0,n.createMeshIncrementForEntityData)(t),h=`${s.BTUiGenerateSectionEntitiesResponse.ID}${i}-${a}-${o}`,d=`${s.BTUiGenerateSectionEntitiesResponse.ID}${a}-${o}`,g=`${r}-${d}`,p=null===(c=u().get(l.primitiveType))||void 0===c?void 0:c.nodeProperties;if(p){const r={incrementId:h,selectionId:g,primitiveType:p.primitiveType,entityType:this.getEntityTypeFromPrimitiveType(p.primitiveType),highlights:new Map,occurrence:e.occurrenceList[i],partId:e.partIds[i],metadata:this.createEntityMetadata(h,t),meshIncrement:l};if(r.entityType===s.GBTEntityType.FACE){const e=this.findAssociatedPlaneIndex(l);-1!==e&&(r.associatedPlaneIndex=e);const t=this.getColor(r);this.hasFace=!0,t&&(0,n.addColorToIncrement)(t,l)}this.incrementData.set(g,r),this.updateMeshIncrement(h,g,l,p)}}))}))})),this.updateEntityVisibility()}hasFaceEntities(){return this.hasFace}createEntityMetadata(e,t){const i=new s.BTFeatureEntity;return i.setBodyId(e),i.setGeometry(t),i}getMeshIncrementForUISelection(e){var t;const i=this.getInstantiatedMeshIncrement(e.meshIncrementId);return null!==(t=null==i?void 0:i.meshIncrement)&&void 0!==t?t:null}getPickPriority(e){var t;const i=this.getMeshIncrementForUISelection(e);let s=null;return i&&(s=null===(t=u().get(i.primitiveType))||void 0===t?void 0:t.pickPriority),null!=s?s:n.PickPriority.UNKNOWN}getModelSelection(e){const t=new r.Selection(s.GBTUiSelectionType.ENTITY,e.selectionId,(0,o.isInAssemblyElement)()?new s.BTOccurrence:null,{sourcePick:e.sourcePick}),i=this.findIncrementData(e.selectionId);return i&&(t.setNameFromSectionDetails({entityType:i.entityType,partId:i.partId,occurrence:i.occurrence,elementId:this.elementId}),t.entityMetaData=i.metadata),t}getEntityMetaData(e){var t,i;return null!==(i=null===(t=this.findIncrementData(e))||void 0===t?void 0:t.metadata)&&void 0!==i?i:null}findIncrementData(e){var t;return null!==(t=this.incrementData.get(e))&&void 0!==t?t:null}addHighlightToSection(e,t){const i=this.viewer.getHighlightManager(n.BTGraphicsUsage.BASE).createHighlightForSelection(e,t),s=this.findIncrementData(t);return s?(s.highlights.has(e)&&(this.removeHighlightFromIncrement(s.incrementId,s.highlights.get(e)),s.highlights.delete(e)),this.addHighlightToIncrement(s.incrementId,i),s.highlights.set(e,i),s):null}removeHighlightFromSection(e,t){const i=this.findIncrementData(t);i&&this.removeHighlightFromIncrementData(e,i)}removeHighlightFromIncrementData(e,t){const i=t.highlights.get(e);i&&(this.removeHighlightFromIncrement(t.incrementId,i),t.highlights.delete(e))}clearSelections(e){const t=e.filter((e=>null==e?void 0:e.isSectionEntity()));e.remove(t)}remove(){this.isCleaningUp=!0,this.clearSelections((0,r.getPreselectionList)()),this.clearSelections((0,r.getSelectionList)()),super.remove()}onIsolateChanged(){this.updateEntityVisibility()}updateEntityVisibility(){const e=this.viewer.getModelViewManagers().getManager(),t=this.viewer.getIsolatedOccurrenceManager().getIsIsolateFullyTransparent();for(const i of this.incrementData.values()){let s;if(i.occurrence){const e=this.viewer.getOccurrenceIdManager().getIdForName(i.occurrence.toString());s=this.viewer.getOccurrenceDataManager().getOccurrenceData(e)}else{const t=e.getDisplayedPartStudio();t&&(s=t.getBodyComponent().getBodyOccurrenceData(i.partId))}s&&t&&!s.getIsolated()?this.hideIncrement(i.incrementId):this.showIncrement(i.incrementId)}}extractMeshIncrement(e){var t;const i=this.findIncrementData(e);return null!==(t=null==i?void 0:i.meshIncrement)&&void 0!==t?t:null}}t.SectionViewEntitiesElement=g},254749:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.dumpShader=t.ShaderProgram=t.shaderExistsForId=t.AttributeBinding=t.getShaderIdWithExtension=t.prepareShaderCode=t.NO_SECTION_SHADER_ID_SUFFIX=t.FALSE_INT_UNIFORM=t.TRUE_INT_UNIFORM=void 0;const s=i(736234),n=i(142885),r=i(912057),a=i(268154),o=i(114924),c=i(750004);var l;function h(e,t){return t?"#define "+e+" 1\n":""}t.TRUE_INT_UNIFORM=1,t.FALSE_INT_UNIFORM=0,function(e){e.SKIP_SECTION_PLANES="SKIP_SECTION_PLANES",e.USE_OCCURRENCE_TEXTURE="USE_OCCURRENCE_TEXTURE",e.USE_SECTION_PLANES="USE_SECTION_PLANES",e.USE_VERTEX_HIGHLIGHT_TEXTURE="USE_VERTEX_HIGHLIGHT_TEXTURE",e.DERIVATIVES_SUPPORTED="DERIVATIVES_SUPPORTED",e.LOOP_BREAK_SUPPORTED="LOOP_BREAK_SUPPORTED"}(l||(l={})),t.NO_SECTION_SHADER_ID_SUFFIX="-nosection";let d=null;t.prepareShaderCode=function(e,i){if(d&&!i)return;if(!c.shadersGlsl)return;const n=(0,s.clone)(c.shadersGlsl);for(const e in n){let t=n[e];const i=/{{{.*}}}/g;let s=0,a=i.exec(t);for(;a;){const o=a[0].substr(3,a[0].length-6);if(!n.hasOwnProperty(o)){r.log.warn("Missing shader include: "+o);break}const c=a.index+a[0].length;t=t.substr(0,a.index)+n[o]+t.substr(c,t.length-c),++s>100&&r.log.warn("Encountered a large number of includes while substituting shader "+e+". An include cycle may have been introduced."),i.lastIndex=0,a=i.exec(t)}n[e]=t}d={};let o=h(l.USE_SECTION_PLANES,e.supportsGraphicalSectionPlanes());o+=h(l.USE_VERTEX_HIGHLIGHT_TEXTURE,e.areHighlightVertexTexturesSupported()),o+=h(l.DERIVATIVES_SUPPORTED,e.areShaderDerivativesSupported()),o+=h(l.LOOP_BREAK_SUPPORTED,!(0,a.isPlatformMac)()||(0,a.isBrowserSafari)());const u=o+h(l.SKIP_SECTION_PLANES,!0),g=Object.keys(n);for(let e=0;e<g.length;++e){const i=g[e],s=n[i];if(d[i]=o+s,i.startsWith("fs-")&&-1!==s.indexOf("discardIfPositionFails")){d[i+t.NO_SECTION_SHADER_ID_SUFFIX]=u+s;const e="v"+i.substr(1,i.length);e in n&&(d[e+t.NO_SECTION_SHADER_ID_SUFFIX]=u+n[e])}}},t.getShaderIdWithExtension=function(e,i){const s=e.indexOf(t.NO_SECTION_SHADER_ID_SUFFIX);return s<0?e+"-"+i:e.substr(0,s)+"-"+i+t.NO_SECTION_SHADER_ID_SUFFIX};class u{constructor(e,t,i,s,n=!1,r=1){this.type=e,this.dimension=t,this.offset=i,this.stride=s,this.normalize=n,this.secondDimension=r,this.columnStride=(0,o.sizeOfGlType)(this.type)*this.dimension}clone(){return new u(this.type,this.dimension,this.offset,this.stride,this.normalize,this.secondDimension)}offsetForColumn(e){return this.offset+e*this.columnStride}get multiDimensionStride(){return this.stride+this.secondDimension*this.columnStride}get elementCount(){return this.dimension*this.secondDimension}}t.AttributeBinding=u,t.shaderExistsForId=function(e){const t="vs"+e,i="fs"+e;return d.hasOwnProperty(t)&&d.hasOwnProperty(i)};class g extends n.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.id=t,this.vertexShader=null,this.fragmentShader=null,this.shaderProgram=null,this.uniformLocations={},this.attribLocations={},this.boundTextures={},this.shaderValidated=!1,this.disableVertexAttribArrayIfVaoUnavailable=null,(0,o.viewerCheck)(e),this.listenTo(this.viewer.getEventDispatcher(),o.GL_CONTEXT_LOST,this.onGlContextLost),this.listenTo(this.viewer.getEventDispatcher(),o.GL_CONTEXT_RESTORED,this.onGlContextRestored),this.listenTo(this.viewer.getEventDispatcher(),o.SESSION_ENDED,this.destroy),this.reinitialize(),this.disableVertexAttribArrayIfVaoUnavailable=this.viewer.areVertexArrayObjectsAvailable?e=>{}:e=>this.enableVertexAttribArray(e,!1),this.numericId=++g.numericIdIncrementer}getId(){return this.id}getNumericId(){return this.numericId}destroy(){this.stopListening(),this.clearGlReferences()}clearGlReferences(){this.shaderValidated=!1,this.shaderProgram=null,this.vertexShader=null,this.fragmentShader=null,this.uniformLocations={},this.attribLocations={}}onGlContextLost(){this.clearGlReferences()}onGlContextRestored(){this.reinitialize()}reinitialize(){this.initializationFailed||(this.clearGlReferences(),this.viewer.getGlContext()&&(this.shaderProgram=this.initProgram()),this.unbindTextures())}equals(e){return null!==e&&this.id===e.id}deactivate(){if(!this.viewer.areVertexArrayObjectsAvailable)for(const e in this.attribLocations)this.enableVertexAttribArray(e,!1);this.unbindTextures()}unbindTextures(){for(const e in this.boundTextures)(0,o.unbindTexture)(this.viewer,e);this.boundTextures={}}makeShader(e,t){const i=d[e];if(!i||i.length<1)return r.log.warn('Shader "'+e+'" not found'),null;const s=this.viewer.getGlContext();if(!s)return null;const n=s.createShader(t);return s.shaderSource(n,i),s.compileShader(n),n}getVertexShaderId(){return"vs"+this.id}getFragmentShaderId(){return"fs"+this.id}get initializationFailed(){return this.viewer.badShaders.hasOwnProperty(this.id)}set initializationFailed(e){e?this.viewer.badShaders[this.id]=!0:delete this.viewer.badShaders[this.id]}initProgram(){if(this.initializationFailed)return null;const e=this.viewer.getGlContext();if(this.vertexShader=this.makeShader(this.getVertexShaderId(),e.VERTEX_SHADER),this.fragmentShader=this.makeShader(this.getFragmentShaderId(),e.FRAGMENT_SHADER),!this.vertexShader||!this.fragmentShader)return this.initializationFailed=!0,null;const t=e.createProgram();return e.attachShader(t,this.vertexShader),e.attachShader(t,this.fragmentShader),e.bindAttribLocation(t,0,o.AttributeNames.POSITION),e.linkProgram(t),t}validateProgram(){if(this.shaderValidated)return;this.validateShader(this.vertexShader,this.getVertexShaderId()),this.validateShader(this.fragmentShader,this.getFragmentShaderId());const e=this.viewer.getGlContext();try{if(!e.getProgramParameter(this.shaderProgram,e.LINK_STATUS)&&!e.isContextLost()){this.clearGlReferences();const t=e.getProgramInfoLog(this.shaderProgram);r.log.warn(o.WEBGL_ERROR_LOG_TAG+"Could not link shaders for "+this.id+":\n "+t),p(this.getVertexShaderId()),p(this.getFragmentShaderId()),this.initializationFailed=!0}}catch(e){this.initializationFailed=!0,r.log.warn(o.WEBGL_ERROR_LOG_TAG+"Could not link shaders for "+this.id+", and log info retrieval failed. (Try in a different browser to see if it gives you more details.)")}this.shaderValidated=!0}validateShader(e,t){const i=this.viewer.getGlContext();try{e&&(i.getShaderParameter(e,i.COMPILE_STATUS)||i.isContextLost())||(r.log.warn(o.WEBGL_ERROR_LOG_TAG+"Error compiling shader "+t+":\n"+i.getShaderInfoLog(e)),p(t))}catch(e){r.log.debug(o.WEBGL_ERROR_LOG_TAG+"Error getting shader info for: "+t+":\n"+e)}}ensureShaderIsInitialized(){this.shaderProgram||this.reinitialize()}useShader(){this.ensureShaderIsInitialized(),this.validateProgram(),this.viewer.getGlContext().useProgram(this.shaderProgram)}getUniformLocation(e){this.ensureShaderIsInitialized();let t=this.uniformLocations[e];return void 0!==t||(t=this.initializationFailed?null:this.viewer.getGlContext().getUniformLocation(this.shaderProgram,e),this.uniformLocations[e]=t),t}hasUniform(e){return!!this.getUniformLocation(e)}outputUniforms(){const e=this.viewer.getGlContext();let t=e.getProgramParameter(this.shaderProgram,e.ACTIVE_UNIFORMS);if(isNaN(t))return;t=+t.toString(),r.log.debug("Uniforms for shader: "+this.id);const i=function(e){let t="<";for(let i=0;i<e.length;++i)t+=e[i],i<e.length-1&&(t+=", ");return t+=">",t};for(let s=0;s<t;++s){const t=e.getActiveUniform(this.shaderProgram,s);if(t){let s=e.getUniform(this.shaderProgram,this.getUniformLocation(t.name));(s instanceof Float32Array||s instanceof Int32Array||s instanceof Array)&&(s=i(s)),r.log.debug("  Uniform: "+t.name+", size: "+t.size+", type: "+t.type+", value: "+s)}}}outputAttributes(){const e=this.viewer.getGlContext();let t=e.getProgramParameter(this.shaderProgram,e.ACTIVE_ATTRIBUTES);if(isNaN(t))return;const i=["VERTEX_ATTRIB_ARRAY_BUFFER_BINDING","VERTEX_ATTRIB_ARRAY_ENABLED","VERTEX_ATTRIB_ARRAY_SIZE","VERTEX_ATTRIB_ARRAY_STRIDE","VERTEX_ATTRIB_ARRAY_TYPE","VERTEX_ATTRIB_ARRAY_NORMALIZED","CURRENT_VERTEX_ATTRIB"];t=+t.toString(),r.log.debug("Attributes for shader: "+this.id);for(let s=0;s<t;++s){const t=e.getActiveAttrib(this.shaderProgram,s);if(t){const n=this.getAttribLocation(t.name);r.log.debug("  Attribute "+s+": "+t.name+", size: "+t.size+", type: "+t.type),r.log.debug("    Location: "+n),r.log.debug("    Pointer offset: "+e.getVertexAttribOffset(n,e.VERTEX_ATTRIB_ARRAY_POINTER));for(let t=0;t<i.length;++t){const s=i[t],a=e.getVertexAttrib(n,e[s]);"CURRENT_VERTEX_ATTRIB"===s?r.log.debug("    "+s+" : ["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"):r.log.debug("    "+s+" : "+a)}}}}getAttribLocation(e){this.ensureShaderIsInitialized();let t=this.attribLocations[e];return void 0!==t||(t=this.initializationFailed?-1:this.viewer.getGlContext().getAttribLocation(this.shaderProgram,e),this.attribLocations[e]=t),t}hasAttribute(e){return this.getAttribLocation(e)>=0}vertexAttribPointer(e,t){const i=this.getAttribLocation(e);if(i<0)return;const s=this.viewer.getGlContext();if(1===t.secondDimension)s.vertexAttribPointer(i,t.dimension,t.type,t.normalize,t.stride,t.offset);else for(let e=0;e<t.secondDimension;++e)s.vertexAttribPointer(i+e,t.dimension,t.type,t.normalize,t.multiDimensionStride,t.offsetForColumn(e));this.enableVertexAttribArray(e,!0,t.secondDimension)}enableVertexAttribArray(e,t,i){void 0===t&&(t=!0);const s=this.getAttribLocation(e);if(!(s<0))if(i)for(let e=0;e<i;++e)this.viewer.enableVertexAttributeArray(s+e,t);else this.viewer.enableVertexAttributeArray(s,t)}useTexture(e,t){if(!this.hasUniform(e))return;let i;i=t instanceof o.Texture?t.updateAndBindTexture(e):(0,o.bindTexture)(this.viewer,t,e),i<0?this.useBlankTexture(e):(this.boundTextures[e]=i,this.uniform1i(e,i))}setAttribute(e,t){switch(e.dimension){case 1:this.vertexAttrib1f(e.name,t);break;case 2:this.vertexAttrib2fv(e.name,t);break;case 3:this.vertexAttrib3fv(e.name,t);break;case 4:this.vertexAttrib4fv(e.name,t)}}setFloatUniform(e,t){switch(t.length){case 2:this.uniform2fv(e,t);break;case 3:this.uniform3fv(e,t);break;case 4:this.uniform4fv(e,t);break;default:this.uniform1f(e,t)}}setIntUniform(e,t){switch(t.length){case 2:this.uniform2iv(e,t);break;case 3:this.uniform3iv(e,t);break;case 4:this.uniform4iv(e,t);break;default:this.uniform1i(e,t)}}setMatrixUniform(e,t,i=!1){switch(t.length){case 16:this.uniformMatrix4fv(e,i,t);break;case 9:this.uniformMatrix3fv(e,i,t);break;case 4:this.uniformMatrix2fv(e,i,t);break;default:r.log.debug(`Unsupported matrix size in setMatrixUniform. ${e}, length: ${t.length}`)}}useBlankTexture(e){if(!this.hasUniform(e))return;const t=this.viewer.getResources().getBlankTexture().updateAndBindTexture(e);t>=0&&(this.boundTextures[e]=t,this.uniform1i(e,t))}uniform1f(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1f(i,t)}uniform1fv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1fv(i,t)}uniform1i(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1i(i,t)}uniform1iv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform1iv(i,t)}uniform2f(e,t,i){const s=this.getUniformLocation(e);null!==s&&this.viewer.getGlContext().uniform2f(s,t,i)}uniform2fv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform2fv(i,t)}uniform2i(e,t,i){const s=this.getUniformLocation(e);null!==s&&this.viewer.getGlContext().uniform2i(s,t,i)}uniform2iv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform2iv(i,t)}uniform3f(e,t,i,s){const n=this.getUniformLocation(e);null!==n&&this.viewer.getGlContext().uniform3f(n,t,i,s)}uniform3fv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform3fv(i,t)}uniform3i(e,t,i,s){const n=this.getUniformLocation(e);null!==n&&this.viewer.getGlContext().uniform3i(n,t,i,s)}uniform3iv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform3iv(i,t)}uniform4f(e,t,i,s,n){const r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniform4f(r,t,i,s,n)}uniform4fv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform4fv(i,t)}uniform4i(e,t,i,s,n){const r=this.getUniformLocation(e);null!==r&&this.viewer.getGlContext().uniform4i(r,t,i,s,n)}uniform4iv(e,t){const i=this.getUniformLocation(e);null!==i&&this.viewer.getGlContext().uniform4iv(i,t)}uniformMatrix2fv(e,t,i){const s=this.getUniformLocation(e);null!==s&&this.viewer.getGlContext().uniformMatrix2fv(s,t,i)}uniformMatrix3fv(e,t,i){const s=this.getUniformLocation(e);null!==s&&this.viewer.getGlContext().uniformMatrix3fv(s,t,i)}uniformMatrix4fv(e,t,i){const s=this.getUniformLocation(e);null!==s&&this.viewer.getGlContext().uniformMatrix4fv(s,t,i)}vertexAttrib1f(e,t){const i=this.getAttribLocation(e);i<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib1f(i,t))}vertexAttrib1fv(e,t){const i=this.getAttribLocation(e);i<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib1fv(i,t))}vertexAttrib2f(e,t,i){const s=this.getAttribLocation(e);s<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib2f(s,t,i))}vertexAttrib2fv(e,t){const i=this.getAttribLocation(e);i<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib2fv(i,t))}vertexAttrib3f(e,t,i,s){const n=this.getAttribLocation(e);n<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib3f(n,t,i,s))}vertexAttrib3fv(e,t){const i=this.getAttribLocation(e);i<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib3fv(i,t))}vertexAttrib4f(e,t,i,s,n){const r=this.getAttribLocation(e);r<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib4f(r,t,i,s,n))}vertexAttrib4fv(e,t){const i=this.getAttribLocation(e);i<0||(this.disableVertexAttribArrayIfVaoUnavailable(e),this.viewer.getGlContext().vertexAttrib4fv(i,t))}}function p(e){const t=d[e];if(!t||t.length<1)return void r.log.warn('Shader "'+e+'" not found');const i=t.split("\n");for(let e=0;e<i.length;++e)i[e]=e+1+": "+i[e];r.log.warn(o.WEBGL_ERROR_LOG_TAG+e+" source:\n"+i.join("\n"))}t.ShaderProgram=g,g.numericIdIncrementer=0,t.dumpShader=p},750004:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.shadersGlsl=void 0,t.shadersGlsl={blitFunctions:i(688782).Z,compareFunctions:i(693081).Z,constants:i(990402).Z,contactVisualizationFunctions:i(49688).Z,decalFunctions:i(357074).Z,depthNormalFunctions:i(105771).Z,edgeFragmentUtilityFunctions:i(628218).Z,edgeUtilityFunctions:i(244851).Z,fragmentCurvatureUtilityFunctions:i(1189).Z,fragmentLightingUtilityFunctions:i(163888).Z,"fs-OITAccumulation":i(976739).Z,"fs-OITAccumulation-contact":i(511131).Z,"fs-OITAccumulation-decals":i(854478).Z,"fs-OITComposite":i(451533).Z,"fs-OITRevealage":i(581639).Z,"fs-OITRevealage-contact":i(944865).Z,"fs-OITRevealage-decals":i(204671).Z,"fs-backfacesil-faces":i(996029).Z,"fs-blitBodyCheck":i(9854).Z,"fs-compareBlend":i(98606).Z,"fs-debugPickPass":i(28664).Z,"fs-depth-edges":i(870835).Z,"fs-depth-faces":i(378498).Z,"fs-depth-points":i(921395).Z,"fs-draftAngle-faces":i(760762).Z,"fs-draftShadow-faces":i(829614).Z,"fs-draw-draftAnalysis":i(926061).Z,"fs-draw-edges":i(976594).Z,"fs-draw-endcap":i(444144).Z,"fs-draw-endcap-depth":i(380955).Z,"fs-draw-faces":i(214730).Z,"fs-draw-faces-contact":i(385165).Z,"fs-draw-faces-decals":i(368320).Z,"fs-draw-faces-scalarVisualization":i(886577).Z,"fs-draw-points":i(656418).Z,"fs-draw-qualityVisualization":i(540538).Z,"fs-draw-silhouettes":i(122501).Z,"fs-draw-zebraStripes":i(260060).Z,"fs-drawTexture":i(148871).Z,"fs-edgeDetect":i(229076).Z,"fs-endcapMask-faces":i(476002).Z,"fs-endcapMask-faces-simulation":i(486).Z,"fs-gaussianFilter":i(118040).Z,"fs-highlightBuffer-faces":i(82309).Z,"fs-highlightDraw-edges":i(588358).Z,"fs-highlightDraw-points":i(888698).Z,"fs-highlightDraw":i(939060).Z,"fs-highlightMask-faces":i(476100).Z,"fs-normalDepth-faces":i(122422).Z,"fs-normalDepthFilter":i(26550).Z,"fs-normalDepthWithMask-edges":i(516859).Z,"fs-normalDepthWithMask-faces":i(712751).Z,"fs-normalDepthWithMask-points":i(70169).Z,"fs-occlusion":i(998155).Z,"fs-occlusionFilter":i(694883).Z,"fs-pick-alternates-edges":i(702905).Z,"fs-pick-alternates-faces":i(859322).Z,"fs-pick-edges":i(20817).Z,"fs-pick-endcap":i(332617).Z,"fs-pick-faces":i(773472).Z,"fs-pick-points":i(60825).Z,"fs-planeId-faces":i(491981).Z,"fs-previewBlend":i(963399).Z,"fs-retrieveScalar-faces":i(687069).Z,"fs-tintByDepth-edges":i(327053).Z,"fs-tintByDepth-points":i(112259).Z,"fs-tintByNormalDepth-faces":i(152865).Z,"fs-tintByNormalDepth-faces-decals":i(756233).Z,"fs-tintByPlaneId-faces":i(353493).Z,getNormalSign:i(942676).Z,highlightFunctions:i(908582).Z,normalDepthWithMaskFunctions:i(548102).Z,picking:i(716370).Z,planeIdFunctions:i(449368).Z,pointFragmentUtilityFunctions:i(344814).Z,sectionPlaneClippingFunctions:i(904454).Z,sectionPlaneConstants:i(833068).Z,sectionPlaneEndcapFunctions:i(120084).Z,sectionPlaneEndcapMedianFilter:i(616254).Z,sectionPlaneEndcapPatternFunctions:i(331244).Z,sectionPlaneFragmentUtilityFunctions:i(65486).Z,setContactVaryings:i(732512).Z,undercutWeightFunction:i(815277).Z,utilityFunctions:i(31679).Z,vertexPicking:i(129846).Z,vertexUtilityFunctions:i(460942).Z,"vs-OITAccumulation":i(801718).Z,"vs-OITAccumulation-contact":i(907144).Z,"vs-OITAccumulation-decals":i(648135).Z,"vs-OITComposite":i(779506).Z,"vs-OITRevealage":i(886271).Z,"vs-OITRevealage-contact":i(553694).Z,"vs-OITRevealage-decals":i(42884).Z,"vs-backfacesil-faces":i(65790).Z,"vs-blitBodyCheck":i(302339).Z,"vs-compareBlend":i(110884).Z,"vs-debugPickPass":i(355199).Z,"vs-depth-edges":i(973361).Z,"vs-depth-faces":i(550813).Z,"vs-depth-points":i(552863).Z,"vs-draftAngle-faces":i(159158).Z,"vs-draftShadow-faces":i(832464).Z,"vs-draw-draftAnalysis":i(498930).Z,"vs-draw-edges":i(798952).Z,"vs-draw-endcap":i(623212).Z,"vs-draw-endcap-depth":i(910530).Z,"vs-draw-faces":i(625781).Z,"vs-draw-faces-contact":i(185274).Z,"vs-draw-faces-decals":i(548452).Z,"vs-draw-faces-scalarVisualization":i(566607).Z,"vs-draw-points":i(501322).Z,"vs-draw-qualityVisualization":i(960515).Z,"vs-draw-silhouettes":i(585513).Z,"vs-draw-zebraStripes":i(161999).Z,"vs-drawTexture":i(629203).Z,"vs-edgeDetect":i(106814).Z,"vs-endcapMask-faces":i(892862).Z,"vs-endcapMask-faces-simulation":i(834344).Z,"vs-gaussianFilter":i(985242).Z,"vs-highlightBuffer-faces":i(22149).Z,"vs-highlightDraw-edges":i(804101).Z,"vs-highlightDraw-points":i(55841).Z,"vs-highlightDraw":i(167892).Z,"vs-highlightMask-faces":i(643166).Z,"vs-normalDepth-faces":i(976343).Z,"vs-normalDepthFilter":i(217964).Z,"vs-normalDepthWithMask-edges":i(259933).Z,"vs-normalDepthWithMask-faces":i(382880).Z,"vs-normalDepthWithMask-points":i(837259).Z,"vs-occlusion":i(918611).Z,"vs-occlusionFilter":i(903509).Z,"vs-pick-alternates-edges":i(529754).Z,"vs-pick-alternates-faces":i(748916).Z,"vs-pick-edges":i(721161).Z,"vs-pick-endcap":i(780437).Z,"vs-pick-faces":i(278818).Z,"vs-pick-points":i(653069).Z,"vs-planeId-faces":i(231334).Z,"vs-previewBlend":i(977866).Z,"vs-retrieveScalar-faces":i(846779).Z,"vs-tintByDepth-edges":i(843937).Z,"vs-tintByDepth-points":i(840472).Z,"vs-tintByNormalDepth-faces":i(212694).Z,"vs-tintByNormalDepth-faces-decals":i(824594).Z,"vs-tintByPlaneId-faces":i(288213).Z,weightFunctions:i(56380).Z}},865020:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Silhouette=void 0;const s=i(545348),n=i(114924),r=i(804299);class a extends n.UIElement{constructor(e,t){super(t,n.MAIN_SCENEGRAPH_ID),this.idToSilhouetteInfo={},this.sketchProperties=new n.NodeProperties({isPickable:!0,isShowThrough:!0,isDepthTested:!1,primitiveType:n.PrimitiveType.LINES,zOffset:1}),this.worldProperties=new n.NodeProperties({isPickable:!0,isShowThrough:!0,isDepthTested:!0,primitiveType:n.PrimitiveType.LINES,zOffset:1});const i=s.default.getManager();let r;for(this.width=i.getNumber("SKETCH_SILHOUETTE_WIDTH"),this.sketchColor=i.getColor("SKETCH_PREVIEW_COLOR"),this.worldColor=i.getColor("SKETCH_SILHOUETTE_WORLD_COLOR"),this.hoverWidth=i.getNumber("HIGHLIGHT_LINE_WIDTH_MIN"),this.hoverColor=i.getColor("PRE_HIGHLIGHT_COLOR_BORDER"),this.worldStipple=i.getStipple("SKETCH_SILHOUETTE_WORLD_STIPPLE"),r=0;r<e.length;++r){const t=e[r].silhouetteId;this.idToSilhouetteInfo[t]=e[r],this.updateSilhouette(t,!1),this.listenTo(this,n.UiEvents.MOUSE_ENTER+t,this.onMouseEnter),this.listenTo(this,n.UiEvents.MOUSE_LEAVE+t,this.onMouseLeave),this.listenTo(this,n.UiEvents.CLICK+t,this.onMouseClick)}}updateAllSilhouettes(){Object.entries(this.idToSilhouetteInfo).forEach((([e,t])=>{this.updateSilhouette(e,!1)}))}updateSilhouette(e,t){const i=this.idToSilhouetteInfo[e];if(!i)return;(0,n.addColorToIncrement)(t?this.hoverColor:this.worldColor,i.worldMesh),(0,n.addSizeToIncrement)(t?this.hoverWidth:this.width,i.worldMesh),(0,n.addStyleToIncrement)(this.worldStipple,i.worldMesh),this.updateMeshIncrement(e,e,i.worldMesh,this.worldProperties);const s=this.getProjectedMeshId(e),r=(0,n.createMeshIncrementForPolylineLines)(this.viewer,i.sketchPolyline);(0,n.addColorToIncrement)(t?this.hoverColor:this.sketchColor,r),(0,n.addSizeToIncrement)(t?this.hoverWidth:this.width,r),this.updateMeshIncrement(s,e,r,this.sketchProperties)}getProjectedMeshId(e){return e+".ske"}getClearModelSelectionsOnPrehilite(){return!1}onMouseEnter(e){this.updateSilhouette(e.selectionId,!0),(0,n.requestDraw)()}onMouseLeave(e){this.updateSilhouette(e.selectionId,!1),(0,n.requestDraw)()}onMouseClick(e){this.trigger(r.BTGraphicsISilhouette_CLICKED,this,this.idToSilhouetteInfo[e.selectionId].disambiguation,e.selectionId)}removeOtherSilhouettes(e){for(const t in this.idToSilhouetteInfo)t!==e&&(this.removeMeshIncrement(this.getProjectedMeshId(e)),delete this.idToSilhouetteInfo[t])}}t.Silhouette=a},865096:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.resetStaticSilhouetteState=t.SilhouetteTask=t.getSilhouetteIncrement=t.getSilhouettesId=void 0;const s=i(114924),n=i(545348),r=i(223456),a=i(912057),o=i(873896),c=i(225742),l=i(264292),h=i(613199),d=n.default.getManager();let u=new Int32Array(0),g=new Float32Array(0),p=new Int32Array(0),m=0,E=0;const I=1024*d.getNumber("MAX_EDGE_BASED_SILHOUETTE_MEMORY_USE_MB")*1024;function T(){return E>=I}let S=0,f=[];const C=function(e,t,i,s,n,a,c,d,u,g,p,m,E){const I=e.normals[3*p+0],T=e.normals[3*p+1],S=e.normals[3*p+2],f=e.normals[3*m+0],C=e.normals[3*m+1],P=e.normals[3*m+2],v=e.normals[3*E+0],D=e.normals[3*E+1],M=e.normals[3*E+2],y=(0,r.crossProduct)(d-n,u-a,g-c,n-t,a-i,c-s);h.vec3C.normalize(y);let O=I*y[0]+T*y[1]+S*y[2];O<0&&(h.vec3C.negate(y),O*=-1);const _=f*y[0]+C*y[1]+P*y[2],A=v*y[0]+D*y[1]+M*y[2],R=o.Tolerances.FACE_NORMAL_IS_BAD;return(O<R||_<R||A<R)&&l.vec3.set(y,(I+f+v)/3,(T+C+D)/3,(S+P+M)/3),y},P=function(e,t,i,s,n,r,a){let o;o=t<i?t+"__"+i:i+"__"+t;let c=a[o],l=0;void 0!==c?(l=u[c],u[c]=l+1):(c=m,a[o]=c,p[2*c+0]=s,p[2*c+1]=n,u[c]=1,m++),l<2&&(g[6*c+3*l+0]=r[0],g[6*c+3*l+1]=r[1],g[6*c+3*l+2]=r[2])},v=function(e,t,i,s,n){let r=h.vec3C.subtract(t,e,n);h.vec3C.normalize(r),r=h.vec3C.cross(r,i,r);const a=Math.atan2(i[1],i[0]),o=h.vec2C.length(i),c=Math.atan2(i[2],o),d=l.vec3.dot(i,s),u=l.vec3.dot(r,s),g=Math.atan2(u,d);l.vec3.set(n,a,c,g)},D=function(e,t){if(e.indices.length<3||e.indices.length>d.getNumber("MAX_SINGLE_SILHOUETTE_INCREMENT_SIZE"))return null;!function(e){m=0;const t=2*e;u.length<t&&(u=new Int32Array(t),g=new Float32Array(6*t),p=new Int32Array(2*t))}(e.indices.length);const i={},n=function(t,s,n){return function(t,i){return l.vec3.set(i,e.points[3*t+0],e.points[3*t+1],e.points[3*t+2])}(p[2*i[t]+s],n)},r=function(e,t,s){const n=i[e];l.vec3.set(s,g[6*n+3*t+0],g[6*n+3*t+1],g[6*n+3*t+2])};for(let t=2;t<e.indices.length;++t){const n=e.indices[t-2],r=e.indices[t-1],a=e.indices[t];if(!(n===r||r===a||n===a)){const t=e.points[3*n+0],o=e.points[3*n+1],c=e.points[3*n+2],l=(0,s.hashXYZ)(t,o,c),h=e.points[3*r+0],d=e.points[3*r+1],u=e.points[3*r+2],g=(0,s.hashXYZ)(h,d,u),p=e.points[3*a+0],m=e.points[3*a+1],E=e.points[3*a+2],I=(0,s.hashXYZ)(p,m,E),T=C(e,t,o,c,h,d,u,p,m,E,n,r,a);P(0,l,g,n,r,T,i),P(0,g,I,r,a,T,i),P(0,l,I,n,a,T,i)}}const o=function(e){return 2===u[i[e]]},h=[];for(const e in i)o(e)&&h.push(e);const I=h.length;if(0===I)return null;const S=new Float32Array(6*I),f=new Int32Array(2*I),D=new Float32Array(6*I),M=l.vec3.create(),y=l.vec3.create(),O=l.vec3.create(),_=l.vec3.create(),A=l.vec3.create();for(let e=0;e<I;++e){const t=h[e];n(t,0,M),n(t,1,y),r(t,0,O),r(t,1,_),v(M,y,O,_,A),f[2*e]=2*e,f[2*e+1]=2*e+1;for(let t=0;t<3;++t)S[6*e+t]=M[t],S[6*e+3+t]=y[t],D[6*e+t]=A[t],D[6*e+3+t]=A[t]}const R=new s.MeshIncrement(s.PrimitiveType.SILHOUETTES,S,f,t,!0);R.normals=D,R.prepareForBuffering();const N=!T();return E+=e.getTriangleCount()*c.GBTTessellationSetting.SILHOUETTE_BYTES_PER_TRIANGLE,N&&T()&&a.log.info("Edge-based silhouette memory use exhausted"),R};function M(e,t){return e.getFullId()+"_"+t}class y{constructor(e,t,i){this.parentIncrement=e,this.usage=t,this.callback=i,this.key=M(e,t),this.id=(S++,S);const s=this.parentIncrement.getBounds();this.bboxDiameter=s.diameter()}}class O{constructor(e,t){this.parentIncrementGuid=e,this.silhouetteIncrement=t}}function _(e){return e+"_siledges"}function A(e){const t=e.getGloballyUniqueId(),i=function(e){for(let t=f.length-1;t>=0;--t)if(f[t].parentIncrementGuid===e)return f[t];return null}(t);let s=null;if(i)s=i.silhouetteIncrement;else{const i=_(e.id);s=D(e,i),s&&function(e){f.length>=100&&f.shift(),f.push(e)}(new O(t,s))}return s}t.getSilhouettesId=_,t.getSilhouetteIncrement=A;t.SilhouetteTask=class{constructor(e){this.viewer=e,this.silhouetteIncrementToRequest={},this.silhouetteRequestQueue=[],this.silhouetteRequestQueueIsSorted=!1}process(e){if(this.hasPendingWork())for(this.silhouetteRequestQueueIsSorted||(this.silhouetteRequestQueue.sort((function(e,t){return t.bboxDiameter-e.bboxDiameter})),this.silhouetteRequestQueueIsSorted=!0);this.silhouetteRequestQueue.length>0;){const t=this.silhouetteRequestQueue.shift();if(this.silhouetteIncrementToRequest[t.key]!==t.id)continue;if(delete this.silhouetteIncrementToRequest[t.key],T())continue;const i=A(t.parentIncrement);if(i&&(e&&e.addVertexCost(i.vertexCount()),t.callback(t.parentIncrement,i)),e&&e.budgetExceeded())break}}hasPendingWork(){return this.silhouetteRequestQueue.length>0}postSilhouetteRequest(e,t,i){if(!this.viewer.areEdgeSilhouettesEnabled())return;if(T())return;const s=new y(e,t,i);this.silhouetteRequestQueue.push(s),this.silhouetteRequestQueueIsSorted=!1,this.silhouetteIncrementToRequest[s.key]=s.id}clearPendingRequests(){this.silhouetteRequestQueue=[]}clearPendingRequestsForUsage(e){const t=[];for(let i=0;i<this.silhouetteRequestQueue.length;++i){const s=this.silhouetteRequestQueue[i];s.usage!==e&&t.push(s)}this.silhouetteRequestQueue=t,this.silhouetteRequestQueue=this.silhouetteRequestQueue.filter((function(t){return t.usage!==e}))}removePendingRequest(e,t){delete this.silhouetteIncrementToRequest[M(e,t)]}},t.resetStaticSilhouetteState=function(){f=[]}},755735:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Sketch=void 0;const s=i(912057),n=i(114924),r=i(945658),a=i(32620),o=i(264292),c=i(613199);t.Sketch=class{constructor(e,t,i){this.viewer=i,this.dragItems=null,this.dragSequenceId=1,this.showDimensionExpressions_=!1,this.id=e,this.planeMatrix=o.mat4.create(),this.planeMatrixrixInverse=o.mat4.create(),this.appliedTransform=o.mat4.create(),this.computedPlaneMatrix=o.mat4.create(),this.computedInverse=o.mat4.create(),t?(this.planeMatrix[0]=t.m00,this.planeMatrix[1]=t.m10,this.planeMatrix[2]=t.m20,this.planeMatrix[3]=0,this.planeMatrix[4]=t.m01,this.planeMatrix[5]=t.m11,this.planeMatrix[6]=t.m21,this.planeMatrix[7]=0,this.planeMatrix[8]=t.m02,this.planeMatrix[9]=t.m12,this.planeMatrix[10]=t.m22,this.planeMatrix[11]=0,this.planeMatrix[12]=t.m03,this.planeMatrix[13]=t.m13,this.planeMatrix[14]=t.m23,this.planeMatrix[15]=1):s.log.info("invalid plane definition"),this.planeMatrixrixInverse=c.mat4C.set(this.planeMatrix,this.planeMatrixrixInverse),c.mat4C.inverse(this.planeMatrixrixInverse),this.startPt=o.vec3.create(),this.endPt=o.vec3.create(),this.p0=o.vec4.create(),this.p1=o.vec4.create(),this.p2=o.vec4.create(),this.p3=o.vec4.create(),this.updateComputedTransforms()}set showDimensionExpressions(e){this.showDimensionExpressions_=e,this.viewer.getEventDispatcher().trigger(n.SHOW_DIMENSION_EXPRESSIONS_CHANGED,e)}get showDimensionExpressions(){return this.showDimensionExpressions_}updateComputedTransforms(){return c.mat4C.multiply(this.appliedTransform,this.planeMatrix,this.computedPlaneMatrix),c.mat4C.inverse(c.mat4C.multiply(this.appliedTransform,this.planeMatrix,this.computedInverse))}getId(){return this.id}getAppliedTransform(){return this.appliedTransform}getPlaneMatrix(){return this.computedPlaneMatrix}getPlaneMatrixInverse(){return this.computedInverse}setAppliedTransform(e){this.appliedTransform=e,this.updateComputedTransforms()}startPointScreen(e){this.startPt=this.toWorld(e)}endPointScreen(e){this.endPt=this.toWorld(e)}resetState(){this.entityIds=null,this.dragItems=null}toPlane(e){const t=this.toWorld(e);if(!t)return null;let i=o.vec4.create();const s=o.vec4.create();return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=1,i=c.mat4C.multiplyVec4(this.getPlaneMatrixInverse(),s,i),[i[0],i[1],0]}toWorld(e){const t=this.viewer.getPrimaryViewController().camera.getRay(e[0],e[1]);return(0,n.intersectRayPlaneMatrix)(t,this.getPlaneMatrix())}getCanvasCoordinates(e){const t=this.viewer.getCamera(),i=this.planeToWorld(e),s=t.projectWorldPointToCanvas(i);return c.vec3C.scale(s,1/(0,a.getDevicePixelRatio)())}planeVec4ToWorld(e){let t=o.vec4.create();return t=c.mat4C.multiplyVec4(this.getPlaneMatrix(),e,t),o.vec3.fromValues(t[0],t[1],t[2])}planeToWorld(e){return this.planeVec4ToWorld(o.vec4.fromValues(e[0],e[1],0,1))}planeVectorToWorld(e){return this.planeVec4ToWorld(o.vec4.fromValues(e[0],e[1],e[2],0))}worldToPlane(e){let t=o.vec4.create();const i=o.vec4.create();return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1,t=c.mat4C.multiplyVec4(this.getPlaneMatrixInverse(),i,t),[t[0],t[1],t[2]]}getSketchNormal(){const e=[],t=this.getPlaneMatrix();return e[2]=t[10],e[1]=t[9],e[0]=t[8],e}createIncludeNonParallelPlaneFilter(){const e=this.getSketchNormal();return(0,r.makePlaneOrientationFilter)(e)}}},531100:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.deselectEntities=t.createInferenceIcon=t.View=t.ensureTextureAtlas=t.OFFSET_DIRECTION_PIXEL_TOLERANCE=t.IconData=t.AtlasTexture=t.MAX_COLLAPSED_ICONS=t.ELLIPSIS_ID=void 0;const s=i(545348),n=i(912057),r=i(870232),a=i(573879),o=i(193786),c=i(606544),l=i(983673),h=i(736234),d=i(683067),u=i(114924),g=i(264292),p=i(613199),m=i(997687),E=i(322012);t.ELLIPSIS_ID="ellipsis",t.MAX_COLLAPSED_ICONS=5;const I=d.IconSelectionType,T={};T[c.GBTSketchConstraintSolveStatus.BAD]="BAD",T[c.GBTSketchConstraintSolveStatus.DRIVEN]="OK",T[c.GBTSketchConstraintSolveStatus.SOLVED]="OK";const S={};S[I.SELECTED]="SELECTED_COLOR",S[I.PREHILITE]="PREHILITE_COLOR",S[I.MUTED]="MUTED_COLOR",S[I.NOT_SELECTED]="COLOR";const f=function(e,t,i,s){switch(t){case c.GBTSketchConstraintSolveStatus.BAD:e+=":od";break;case c.GBTSketchConstraintSolveStatus.DRIVEN:e+=":dr"}return i===d.IconSelectionType.SELECTED?e+=":s":i===d.IconSelectionType.PREHILITE?e+=":h":i===d.IconSelectionType.MUTED&&(e+=":m"),s&&(e+=":ex"),e};var C;!function(e){e[e.LINE=0]="LINE",e[e.TANGENT_ARC=1]="TANGENT_ARC"}(C||(t.AtlasTexture=C={}));const P=new Map([[C.LINE,"Sketch_Constraints_Grayscale_2_line.svg "],[C.TANGENT_ARC,"Sketch_Constraints_Grayscale_2_tangent-arc.svg "]]),v=new Map([[C.LINE,"line"],[C.TANGENT_ARC,"tangent_arc"]]);class D{constructor(){this.id="",this.selectionId="",this.selected=d.IconSelectionType.NOT_SELECTED,this.constraintType=c.GBTConstraintType.UNKNOWN,this.solveStatus=c.GBTSketchConstraintSolveStatus.SOLVED}static getIcon(e){const t=new D,i=f(v.get(e),c.GBTSketchConstraintSolveStatus.UNKNOWN,d.IconSelectionType.MUTED,!1);return t.id=i,t}}t.IconData=D,t.OFFSET_DIRECTION_PIXEL_TOLERANCE=1;const M=function(e,t,i,s){let r;switch(e){case c.GBTConstraintType.QUADRANT:r="qad";break;case c.GBTConstraintType.COINCIDENT:r="coi";break;case c.GBTConstraintType.PARALLEL:r="par";break;case c.GBTConstraintType.VERTICAL:r="ver";break;case c.GBTConstraintType.HORIZONTAL:r="hoz";break;case c.GBTConstraintType.PERPENDICULAR:r="prp";break;case c.GBTConstraintType.CONCENTRIC:r="con";break;case c.GBTConstraintType.MIDPOINT:r="mid";break;case c.GBTConstraintType.TANGENT:r="tan";break;case c.GBTConstraintType.PIERCE:r="prc";break;case c.GBTConstraintType.EQUAL:r="equ";break;case c.GBTConstraintType.NORMAL:r="nor";break;case c.GBTConstraintType.FIX:r="fix";break;case c.GBTConstraintType.PROJECTED:case c.GBTConstraintType.SILHOUETTED:r="prj";break;case c.GBTConstraintType.OFFSET:r="off";break;case c.GBTConstraintType.MIRROR:r="mir";break;case c.GBTConstraintType.CIRCULAR_PATTERN:r="cpt";break;case c.GBTConstraintType.LINEAR_PATTERN:r="lin";break;case c.GBTConstraintType.INTERSECTED:r="int";break;case c.GBTConstraintType.EQUAL_CURVATURE:r="cur";break;default:r="???",n.log.error("Found a constraint with no atlas key.")}return f(r,t,i,s)},y=function(e,t,i,n,r){const a=s.default.getManager(),o=new u.ImageData;o.id=e;let c="CONSTRAINT_"+(T[t]||"OK")+"_"+(S[i]||"COLOR");return n&&(c+="_EXTERNAL"),o.backgroundColor=a.getColorString(c),o.imageName=r,o},O=function(e,t,i,s,n){s.forEach((function(s){for(let r=0;r<2;r++){const a=1===r;n.push(y(M(e,t,s,a),t,s,a,i))}}))},_=function(e){const t=[],i=[d.IconSelectionType.NOT_SELECTED,d.IconSelectionType.PREHILITE,d.IconSelectionType.SELECTED,d.IconSelectionType.MUTED],n={"Sketch_Constraints_Grayscale_2_Coincident.png":c.GBTConstraintType.COINCIDENT,"Sketch_Constraints_Grayscale_2_Parallel.png":c.GBTConstraintType.PARALLEL,"Sketch_Constraints_Grayscale_2_Vertical.png":c.GBTConstraintType.VERTICAL,"Sketch_Constraints_Grayscale_2_Horizontal.png":c.GBTConstraintType.HORIZONTAL,"Sketch_Constraints_Grayscale_2_Perpendicular.png":c.GBTConstraintType.PERPENDICULAR,"Sketch_Constraints_Grayscale_2_Concentric.png":c.GBTConstraintType.CONCENTRIC,"Sketch_Constraints_Grayscale_2_Midpoint.png":c.GBTConstraintType.MIDPOINT,"Sketch_Constraints_Grayscale_2_Tangent.png":c.GBTConstraintType.TANGENT,"Sketch_Constraints_Grayscale_2_Equal.png":c.GBTConstraintType.EQUAL,"Sketch_Constraints_Grayscale_2_Normal.png":c.GBTConstraintType.NORMAL,"Sketch_Constraints_Grayscale_2_Fix.png":c.GBTConstraintType.FIX,"Sketch_Constraints_Grayscale_2_Use.png":c.GBTConstraintType.PROJECTED,"Sketch_Constraints_Grayscale_2_Offset.png":c.GBTConstraintType.OFFSET,"Sketch_Constraints_Grayscale_2_Mirror.png":c.GBTConstraintType.MIRROR,"Sketch_Constraints_Grayscale_2_CircularPattern.png":c.GBTConstraintType.CIRCULAR_PATTERN,"Sketch_Constraints_Grayscale_2_LinearPattern.png":c.GBTConstraintType.LINEAR_PATTERN,"Sketch_Constraints_Grayscale_2_Pierce.png":c.GBTConstraintType.PIERCE,"Sketch_Constraints_Grayscale_2_Quadrant.png":c.GBTConstraintType.QUADRANT,"Sketch_Constraints_Grayscale_2_Intersection.png":c.GBTConstraintType.INTERSECTED,"Sketch_Constraints_Grayscale_2_Curvature.png":c.GBTConstraintType.EQUAL_CURVATURE};Object.entries(n).forEach((function([e,s]){O(s,c.GBTSketchConstraintSolveStatus.SOLVED,e,i,t)}));const r={"Sketch_Constraints_OverDefined_Coincident.png":c.GBTConstraintType.COINCIDENT,"Sketch_Constraints_OverDefined_Parallel.png":c.GBTConstraintType.PARALLEL,"Sketch_Constraints_OverDefined_Vertical.png":c.GBTConstraintType.VERTICAL,"Sketch_Constraints_OverDefined_Horizontal.png":c.GBTConstraintType.HORIZONTAL,"Sketch_Constraints_OverDefined_Perpendicular.png":c.GBTConstraintType.PERPENDICULAR,"Sketch_Constraints_OverDefined_Concentric.png":c.GBTConstraintType.CONCENTRIC,"Sketch_Constraints_OverDefined_Midpoint.png":c.GBTConstraintType.MIDPOINT,"Sketch_Constraints_OverDefined_Tangent.png":c.GBTConstraintType.TANGENT,"Sketch_Constraints_OverDefined_Equal.png":c.GBTConstraintType.EQUAL,"Sketch_Constraints_OverDefined_Normal.png":c.GBTConstraintType.NORMAL,"Sketch_Constraints_OverDefined_Fix.png":c.GBTConstraintType.FIX,"Sketch_Constraints_OverDefined_Use.png":c.GBTConstraintType.PROJECTED,"Sketch_Constraints_OverDefined_Offset.png":c.GBTConstraintType.OFFSET,"Sketch_Constraints_OverDefined_Mirror.png":c.GBTConstraintType.MIRROR,"Sketch_Constraints_OverDefined_CircularPattern.png":c.GBTConstraintType.CIRCULAR_PATTERN,"Sketch_Constraints_OverDefined_LinearPattern.png":c.GBTConstraintType.LINEAR_PATTERN,"Sketch_Constraints_OverDefined_Pierce.png":c.GBTConstraintType.PIERCE,"Sketch_Constraints_OverDefined_Quadrant.png":c.GBTConstraintType.QUADRANT,"Sketch_Constraints_OverDefined_Intersection.png":c.GBTConstraintType.INTERSECTED,"Sketch_Constraints_OverDefined_Curvature.png":c.GBTConstraintType.EQUAL_CURVATURE};Object.entries(r).forEach((function([e,s]){O(s,c.GBTSketchConstraintSolveStatus.BAD,e,i,t)})),i.forEach((function(e){t.push(y(f("...",c.GBTSketchConstraintSolveStatus.SOLVED,e,!1),c.GBTSketchConstraintSolveStatus.SOLVED,e,!1,"Sketch_Constraints_Ellipsis.png"))}));const a=Object.values(C).filter((e=>"string"==typeof e));for(const e in a){const i=parseInt(e);t.push(y(f(v.get(i),c.GBTSketchConstraintSolveStatus.UNKNOWN,d.IconSelectionType.MUTED,!1),c.GBTSketchConstraintSolveStatus.UNKNOWN,d.IconSelectionType.MUTED,!1,P.get(i)))}const o=s.default.getManager().getNumber("CONSTRAINT_MAX_INDICATOR_SIZE");return(0,u.createAtlasFromResources)(e,o,t,{sourcesHaveTransparency:!1})};function A(e){if(e.getResources().constraintAtlasCreationInitiated)return;e.getResources().constraintAtlasCreationInitiated=!0;e.getTextureAtlasFactory().getAtlas(u.SKETCH_CONSTRAINT_TEXTURE_ATLAS,_.bind(void 0,e)).then((function(t){t?(e.getResources().constraintAtlas=t,e.getResources().constraintMaterial.ambientTexture=t.texture,(0,u.requestDraw)()):n.log.warn("Could not load texture atlas")}),(function(e){n.log.error(e)}))}t.ensureTextureAtlas=A;const R=function(e){return e.selected===d.IconSelectionType.SELECTED};class N extends u.UIElement{constructor(e,i,n,r,a,o){super(o,u.HUD_SCENEGRAPH_ID),this.permanent=a,this.activated=!1,this.isExpanded=!1,this.lastCameraXform=null,this.lastProjectionXform=null,this.hasLeader=!1,this.lastMouseDelta=null,this.isForInference=!1,this.material=o.getResources().constraintMaterial,this.nodeProperties=this.viewer.getResources().typeToNodeProperties[u.sketchinformation.nodePropertiesTypes.OK],this.leaderProperties=new u.NodeProperties({isPickable:!1,primitiveType:u.PrimitiveType.LINES,zOffset:5}),this.model=e,this.reference=this.model.getReference(i),this.referenceIdsChangedSubscription=this.reference.getReferenceIdsChangedObservable().subscribe((([e,t])=>this.onReferenceConstraintIdsChanged(e,t))),this.anchorChangedSubscription=this.reference.getAnchorChangedObservable().subscribe((e=>this.resetLocation(e)));const c=this.reference.constraintIds,l=(0,E.merge)(...c.map((e=>this.model.getConstraint(e))).filter((e=>!!e)).map((e=>e.getConstraintChangedObservable())));this.changeSolveStatusSubscription=l.pipe((0,E.filter)((e=>"change:solveStatus"===e.name)),(0,E.map)((e=>e.constraint))).subscribe((e=>this.onConstraintStatusChanged(e))),this.changeTypeSubscription=l.pipe((0,E.filter)((e=>"change:type"===e.name)),(0,E.map)((e=>e.constraint))).subscribe((e=>this.onConstraintTypeChanged(e))),this.iconData=[],this.worldLocation=n,this.leaderOffset=g.vec3.fromValues(0,0,0),this.ellipsisIcon=new D,this.ellipsisIcon.id=t.ELLIPSIS_ID,this.ellipsisIcon.selectionId=t.ELLIPSIS_ID;const h=s.default.getManager();this.iconSizeConstantName=a?"CONSTRAINT_PERMANENT_INDICATOR_PIXEL_SIZE":"CONSTRAINT_INDICATOR_PIXEL_SIZE",this.iconSize=h.getNumber(this.iconSizeConstantName),this.leaderColor=h.getColor("CONSTRAINT_INDICATOR_LEADER_COLOR"),this.userOffset=g.vec2.fromValues(0,0),this.worldGeometryDirection=r,this.model.constraints.forEach((e=>this.onConstraintAdded(e))),this.listenTo(this.viewer.getEventDispatcher(),u.VIEW_WILL_PICK,this.onViewWillDraw),this.showOnlyOverDefinedSubscription=this.model.showOnlyOverDefinedObservable().subscribe((()=>this.onShowOnlyOverdefinedChanged())),this.showAllConstraintsSubscription=this.model.showAllConstraintsObservable().subscribe((()=>this.onShowAllConstraintsChanged())),A(this.viewer)}showLeader(){this.hasLeader=!0}setUserOffset(e){this.userOffset=g.vec2.fromValues(e[0],-e[1]),this.invalidateDisplay()}getUserOffset(){return g.vec2.fromValues(this.userOffset[0],-this.userOffset[1])}setLocation(e){this.worldLocation=e,this.invalidateDisplay()}setMouseDelta(e){this.lastMouseDelta=e}onConstraintAdded(e){this.reference.constraintIds.indexOf(e.id)>=0&&this.addConstraintIcon(e)}invalidateDisplay(){this.lastCameraXform=null,this.lastProjectionXform=null,this.removeMeshIncrements(),(0,u.requestDraw)()}onConstraintStatusChanged(e){if(this.reference.constraintIds.indexOf(e.id)<0)return;const t=this.iconData.find((t=>t.id===e.id));t&&(t.solveStatus=e.displayStatus,t.constraintType=e.type,this.invalidateDisplay())}onReferenceConstraintIdsChanged(e,t){const i=(0,a.difference)(e,t),s=(0,a.difference)(t,e);i.length>0&&this.invalidateDisplay(),i.forEach((e=>{const t=this.iconData.findIndex((t=>t.id===e));t>-1&&this.iconData.splice(t,1)})),s.forEach((e=>{const t=this.model.getConstraint(e);this.addConstraintIcon(t)}))}onConstraintTypeChanged(e){const t=this.iconData.find((t=>t.id===e.id));t&&(t.constraintType=e.type,this.invalidateDisplay())}addIcon(e,t,i,s){const n=new D;n.id=e,t&&(n.constraintType=t),i&&(n.solveStatus=i),n.isExternal=!!s,this.iconData.push(n),this.invalidateDisplay()}getOffset(e,i){let n;if(this.isForInference)n=g.vec2.fromValues(1,-1);else if(this.lastMouseDelta)n=this.lastMouseDelta[0]>0?g.vec2.fromValues(-this.lastMouseDelta[1],this.lastMouseDelta[0]):g.vec2.fromValues(this.lastMouseDelta[1],-this.lastMouseDelta[0]);else{const i=e.projectWorldPointToViewport(this.worldLocation),s=p.vec3C.add(this.worldLocation,this.worldGeometryDirection,g.vec3.create()),r=e.projectWorldPointToViewport(s),a=p.vec3C.subtract(r,i,g.vec3.create());a[2]=0,n=p.vec3C.length(a)<t.OFFSET_DIRECTION_PIXEL_TOLERANCE?g.vec2.fromValues(-1,1):g.vec2.fromValues(a[1],-a[0])}p.vec2C.normalize(n);const r=.5*i,a=function(e,t){return g.vec2.dot(g.vec2.fromValues(e,t),n)},o=-Math.abs(a(r,.5)),c=-Math.abs(a(r,-.5)),l=s.default.getManager(),h=(this.permanent?l.getNumber("PERMANENT_INFERENCE_OFFSET"):l.getNumber("TEMPORARY_INFERENCE_OFFSET"))-Math.min(o,c),d=-.99*(0,u.getHudLayerDepthRange)(e.getViewport())[1];return[n[0]*h,n[1]*h,d]}onDevicePixelRatioChanged(e){const t=s.default.getManager();this.iconSize=t.getNumber(this.iconSizeConstantName),this.invalidateDisplay()}onAppearanceConstantsUpdated(){A(this.viewer),this.leaderColor=s.default.getManager().getColor("CONSTRAINT_INDICATOR_LEADER_COLOR"),this.invalidateDisplay()}onViewWillDraw(e,t){if(!this.viewer.getResources().constraintAtlas)return;const i=e.getViewMatrixInverse(),s=e.getProjectionMatrix();if(this.lastCameraXform&&this.lastProjectionXform&&g.mat4.equals(i,this.lastCameraXform)&&g.mat4.equals(s,this.lastProjectionXform))return;this.lastCameraXform=i,this.lastProjectionXform=s;let n=e.projectWorldPointToViewport(this.worldLocation);n[2]=0;const r=g.vec3.fromValues(this.userOffset[0],this.userOffset[1],0);n=p.vec3C.add(n,r);const a=p.mat4C.translate(g.mat4.create(),n),o=this.iconSize;p.mat4C.scale(a,[o,o,1]);const c=this.getVisibleIcons(),l=this.getOffset(e,this.getDisplayedIconCount(c));p.mat4C.translate(a,l),a[12]=Math.floor(a[12]),a[13]=Math.floor(a[13]),this.leaderOffset=p.vec3C.subtract(p.vec3C.scale(r,-1/o,g.vec3.create()),l),this.leaderOffset[2]=0,this.setTransform(a),this.hasMeshIncrements()||this.updateIconGraphics(c),this.updateLeaderGraphics(c)}getNodePropertyType(e){let t=NaN;switch(e.solveStatus){case c.GBTSketchConstraintSolveStatus.SOLVED:t=e.isExternal?u.sketchinformation.nodePropertiesTypes.EXTERNAL_AND_OK:u.sketchinformation.nodePropertiesTypes.OK;break;case c.GBTSketchConstraintSolveStatus.BAD:t=u.sketchinformation.nodePropertiesTypes.OVERDEFINED;break;case c.GBTSketchConstraintSolveStatus.DRIVEN:t=u.sketchinformation.nodePropertiesTypes.DRIVEN}return t}updateNodeProperties(e){if(this.isForInference)return void(this.nodeProperties=this.viewer.getResources().inferenceNodeProperties);this.nodeProperties=this.viewer.getResources().typeToNodeProperties[u.sketchinformation.nodePropertiesTypes.OK];let t=u.sketchinformation.nodePropertiesTypes.DRIVEN;const i=this;e.forEach((function(e){const s=i.getNodePropertyType(e);s<t&&(t=s)})),this.nodeProperties=this.viewer.getResources().typeToNodeProperties[t]}onShowOnlyOverdefinedChanged(){this.invalidateDisplay()}onShowAllConstraintsChanged(){this.model.constraintVisibilityOverride=[],this.invalidateDisplay()}showIconIfPermanent(e,t,i,s){return!!e&&(!!t&&(s||i&&e.solveStatus===c.GBTSketchConstraintSolveStatus.BAD))}getVisibleIcons(){let e=[];if(this.isForInference)e=this.iconData;else{const t=this.reference.constraintVisibilities,i=this.reference.constraintIds;for(let s=0;s<i.length;s++){const n=this.iconData.find((e=>e.id===i[s]));if(!n)continue;if(0!==this.model.constraintVisibilityOverride.length&&!1===this.model.showAllConstraints){-1!==this.model.constraintVisibilityOverride.findIndex((e=>e===i[s]))&&e.push(n)}else this.permanent===this.showIconIfPermanent(n,t[s],this.model.showOnlyOverdefined,this.model.showAllConstraints)&&e.push(n)}}return(0,h.sortBy)(e,(function(e){return-2*e.solveStatus-(e.isExternal?1:0)}))}getDisplayedIconCount(e){return this.isExpanded?e.length:Math.min(e.length,t.MAX_COLLAPSED_ICONS+1)}updateIconGraphics(e){if(!this.viewer.getResources().constraintAtlas)return;this.updateNodeProperties(e),this.viewer.getResources().constraintMaterial.ambientTexture=this.viewer.getResources().constraintAtlas.texture;const i=e.length>t.MAX_COLLAPSED_ICONS+1&&!this.isExpanded,s=.5*-this.getDisplayedIconCount(e);e.forEach((function(e,n){if(e.selectionId=""+n,i){if(n>t.MAX_COLLAPSED_ICONS)return void this.removeMeshIncrement(e.id);n===t.MAX_COLLAPSED_ICONS&&(this.removeMeshIncrement(e.id),e=this.ellipsisIcon)}let r,a=e.selected;if(this.activated||(a=d.IconSelectionType.MUTED),e.id===t.ELLIPSIS_ID)r=f("...",c.GBTSketchConstraintSolveStatus.SOLVED,a,!1);else{const t=e.constraintType,i=e.solveStatus,s=e.isExternal;r=M(t,i,a,s)}const o=this.viewer.getResources().constraintAtlas.getTextureCoords(r);if(!o)return;const l=(0,u.createQuad)([s+n,-.5,0],[s+n+1,-.5,0],[s+n,.5,0],e.id,[o.lowS,o.highT],[o.highS,o.lowT]);this.updateMeshIncrement(e.id,e.selectionId,l,this.nodeProperties)}),this)}updateLeaderGraphics(e){if(this.hasLeader&&0!==e.length){const e=[0,0,0],t=this.leaderOffset,i=(0,u.createLine)(e,t,"leader",this.leaderColor,1);this.updateMeshIncrement("leader",u.NO_SELECTION_ID,i,this.leaderProperties)}}addConstraintIcon(e){e&&this.addIcon(e.id,e.type,e.displayStatus,e.isExternal)}onDelete(){const e=this.iconData.filter(R);return 0!==e.length&&this.deleteConstraints(e)}deleteConstraints(e){const t=(0,u.getDrawer)(),i=t.uiSelectionManager.selection,s=t.uiSelectionManager.hoveredSelection;let n=!1;this.model.constraints;if(e.forEach((e=>{const r=this.model.constraints.find((t=>t.id===e.id));r&&(i&&i.uiElement instanceof N&&i.uiElement.iconData.some((function(t){return t===e}))&&(t.uiSelectionManager.selection=null),s&&s.uiElement instanceof N&&s.uiElement.iconData.some((function(t){return t===e}))&&(t.uiSelectionManager.hoveredSelection=null),this.model.removeConstraint(r),n=!0)})),n&&(this.deselectEntities(),!t.uiSelectionManager.selection)){const e=(0,u.getActiveViewer)().getLastMouseMovedEvent();t.doPick(e.offsetX,e.offsetY,!0,!0,null)}return n}expand(){this.isExpanded=!0,this.removeMeshIncrement(t.ELLIPSIS_ID),this.ellipsisIcon.selectionId="",this.invalidateDisplay()}activate(){this.activated||(this.activated=!0,this.invalidateDisplay())}isSelected(){return!!this.iconData.find((e=>e.selected===d.IconSelectionType.SELECTED))}select(e){if(e.selectionId===this.ellipsisIcon.selectionId)return void this.expand();const t=this.iconData.find((t=>t.selectionId===e.selectionId));if(t&&t.selected!==d.IconSelectionType.SELECTED){t.selected=d.IconSelectionType.SELECTED;m.btInjector.CapabilitiesService.checkConstraintManagerCurrentlyEnabled()&&(0,d.getActiveViewerEventDispatcher)().trigger(d.PICK_CONSTRAINT_SELECTED,e.sourcePick),this.invalidateDisplay()}}deselect(e){const t=this.iconData.find((t=>t.selectionId===e.selectionId));t&&t.selected===d.IconSelectionType.SELECTED&&(t.selected=d.IconSelectionType.NOT_SELECTED,this.invalidateDisplay())}hover(e){(0,o.getPreselectionList)().reset(),this.highlightConstraintIcon(e.selectionId)}highlightConstraintIcon(e){let i=null;if(e===this.ellipsisIcon.selectionId)i=this.ellipsisIcon;else{const s=Number(e);!isNaN(s)&&s>t.MAX_COLLAPSED_ICONS&&!this.isExpanded&&this.expand(),i=this.iconData.find((t=>t.selectionId===e))}i&&i.selected===d.IconSelectionType.NOT_SELECTED&&(i.selected=d.IconSelectionType.PREHILITE,this.invalidateDisplay())}dehover(e){let t=null;t=e.selectionId===this.ellipsisIcon.selectionId?this.ellipsisIcon:this.iconData.find((t=>t.selectionId===e.selectionId)),t&&t.selected===d.IconSelectionType.PREHILITE&&(t.selected=d.IconSelectionType.NOT_SELECTED,this.invalidateDisplay())}getConstraint(e){const t=this.iconData.find((t=>t.selectionId===e));return t?this.model.getConstraint(t.id):null}deselectEntities(){w()}selectEntities(e){this.deselectEntities();const t=this.model.id;let i;const s=this.getConstraint(e);if(s){i=s.referenceIds;for(const e of i){const i=this.model.getReference(e);i&&(0,r.highlightReferenceAndAssociatedCurves)(t,i,this.viewer)}}}getClearModelSelectionsOnPrehilite(){return!1}remove(){super.remove(),this.showOnlyOverDefinedSubscription.unsubscribe(),this.showAllConstraintsSubscription.unsubscribe(),this.changeSolveStatusSubscription.unsubscribe(),this.changeTypeSubscription.unsubscribe(),this.referenceIdsChangedSubscription.unsubscribe(),this.anchorChangedSubscription.unsubscribe()}resetLocation(e){e&&this.setLocation(e)}}function w(){(0,o.getSecondaryPreSelectionList)().reset(),(0,o.getSecondarySelectionList)().reset()}t.View=N,t.createInferenceIcon=function(e,t,i){if(0===t.length)return null;const s=new N((0,l.createFakeGraphForConstraints)("inference",t),"inference",e,[0,0,0],!1,i);return s.isForInference=!0,s},t.deselectEntities=w},489564:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.displayEntity=t.createMeshIncrementForPolylineLines=t.createEntityMetaData=t.createPolyline=t.createSplinePolyline=t.createConicPolyline=t.createArcPolyline=t.tessellateArc=t.createEllipsePolyline=t.createCirclePolyline=t.EntityData=void 0;const s=i(327170),n=i(114924),r=i(100168),a=i(606544),o=i(759382),c=i(873896),l=i(264292),h=i(613199);class d{constructor(e,t){this.entityId=e,this.isSubEntity=!1,this.start=null,this.end=null,this.type="unknown",this.subEntities=[],this.mid=null,this.radius=void 0,this.minorRadius=void 0,this.center=null,this.xAxis=null,this.point=null,this.useCenterPointForArcRadius=void 0,this.splineCPData=null,this.splineKnotData=null,this.lowParameter=void 0,this.highParameter=void 0,this.closedSpline=void 0,this.rationalSpline=void 0,this.splineDegree=0,this.offset=0,this.sourceId=void 0,this.bottomLeftCorner=null,this.bottomRightCorner=null,this.topLeftCorner=null,this.rho=0,this.controlPoint=null,this.hasSplineHandlesInSketch=!1,t&&this.update(t)}update(e){const t=this;if(e instanceof a.BTSketchPointDisplayData)this.point=e.getPoint(0),this.type="point";else if(e instanceof a.BTSketchLineDisplayData)this.start=e.getPoint(0),this.end=e.getPoint(1),this.type="line";else if(e instanceof a.BTSketchArcDisplayData)this.start=e.getPoint(0),this.mid=e.getPoint(1),this.end=e.getPoint(2),this.center=e.getPoint(3),this.type="arc";else if(e instanceof a.BTSketchCircleDisplayData){const t=e;this.center=t.getPoint(0),this.radius=t.radius,this.type="circle"}else if(e instanceof a.BTSketchSplineDisplayData){const t=e;this.type="spline",this.closedSpline=t.closed,this.rationalSpline=t.rational,this.splineDegree=t.degree,this.hasSplineHandlesInSketch=e.hasHandlesInSketch;const i=t.controlPointCount,s=i+t.degree+1,n=3*i;if(this.splineCPData=t.points.slice(0,n),this.splineKnotData=t.points.slice(n,n+s),this.offset=t.points[n+s],t.segment){const e=n+s+1;this.start=[t.points[e],t.points[e+1]],this.lowParameter=t.points[e+2],this.end=[t.points[e+3],t.points[e+4]],this.highParameter=t.points[e+5]}else this.lowParameter=this.splineKnotData[this.splineDegree],this.highParameter=this.splineKnotData[this.splineKnotData.length-this.splineDegree-1]}else if(e instanceof a.BTSketchTextDisplayData||e instanceof a.BTSketchImageDisplayData){const i=e instanceof a.BTSketchTextDisplayData;if(i)this.type="text";else{this.type="image";const t=e;this.sourceId=t.sourceId,this.bottomLeftCorner=t.bottomLeftCorner.getVec3(),this.bottomRightCorner=t.bottomRightCorner.getVec3(),this.topLeftCorner=t.topLeftCorner.getVec3()}let s=0;if(t.subEntities.length===e.entities.length)for(s=0;s<t.subEntities.length;s++)t.subEntities[s].update(e.entities[s]);else{t.subEntities=[];const n=i?a.BTMSketchTextEntity.ID_PREFIX:a.BTMSketchImageEntity.ID_PREFIX;e.entities.forEach((function(e){const i=new d(t.entityId+n+"."+s);i.isSubEntity=!0,i.update(e),t.subEntities.push(i),s++}))}}else if(e instanceof a.BTSketchEllipseDisplayData){const t=e;this.type="ellipse",this.center=t.getPoint(0),this.xAxis=t.getPoint(1),this.radius=t.radius,this.minorRadius=t.minorRadius,this.offset=t.offset}else if(e instanceof a.BTSketchEllipticalArcDisplayData){const t=e;this.type="ellipticalArc",this.center=t.getPoint(0),this.xAxis=t.getPoint(1),this.radius=t.radius,this.minorRadius=t.minorRadius,this.lowParameter=t.startParam,this.highParameter=t.endParam,this.offset=t.offset}else if(e instanceof a.BTSketchConicDisplayData){const t=e;this.type="conic",this.start=t.getPoint(0),this.controlPoint=t.getPoint(1),this.end=t.getPoint(2),this.lowParameter=t.points[6],this.highParameter=t.points[7],this.offset=t.offset,this.rho=t.rho}}}function u(e){let t=null;const i=[e.center];if(e.radius>c.Tolerances.ZERO_LENGTH){t=new Array(c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE);const i=2*Math.PI/(c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE-1);let s=0;const n=e.radius;for(let r=0;r<c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE;++r){s=i*r;const a=Math.cos(s),o=Math.sin(s);t[r]=[e.center[0]+a*n,e.center[1]+o*n]}}return{linePoints:t,points:i}}function g(e,t,i){i<t&&(i+=2*Math.PI);let s=null;const n=[e.center],r=e.xAxis,a=[-e.xAxis[1],e.xAxis[0]],o=e.offset;if(e.radius>c.Tolerances.ZERO_LENGTH&&e.minorRadius>c.Tolerances.ZERO_LENGTH){s=[];let n=Math.max((i-t)/(2*Math.PI)*c.Tolerances.NUMBER_OF_POINTS_IN_FULL_CIRCLE,2);n=Math.floor(n);const l=(i-t)/(n-1);let h=0;const d=e.radius,u=e.minorRadius;for(let i=0;i<n;++i){h=l*i+t;const n=Math.cos(h),c=Math.sin(h);let g=r[0]*d*n+a[0]*u*c,p=r[1]*d*n+a[1]*u*c;if(0!==o){const e=r[0]*u*n+a[0]*d*c,t=r[1]*u*n+a[1]*d*c,i=Math.sqrt(e*e+t*t);g+=o*e/i,p+=o*t/i}s[i]=[e.center[0]+g,e.center[1]+p]}}return{linePoints:s,points:n}}t.EntityData=d,t.createCirclePolyline=u,t.createEllipsePolyline=g;const p=function(e,t){return Math.atan2(t[1]-e[1],t[0]-e[0])},m=function(e,t,i){const s=Math.cos(i),n=Math.sin(i);return[e[0]+s*t,e[1]+n*t]};function E(e,t,i,s){const n=.01*Math.PI,r=2+Math.floor(Math.abs(s-i)/n),a=(s-i)/(r-1),o=new Array(r);for(let s=0;s<r;++s)o[s]=m(e,t,i),i+=a;return o}function I(e,t,i,r,a){if((0,s.are2dPointsEqual)(e,i))return null;let o=r;if(a){const s=[0,0],r=[0,0],a=[0,0],c=[0,0];if(!(0,n.getPerpendicularBisector2d)(e,t,s,r)||!(0,n.getPerpendicularBisector2d)(t,i,a,c))return null;const l=[0,0];if(!(0,n.intersectTwoLines2d)(s,r,a,c,l))return null;o=l}let c=p(o,e),l=p(o,i);const h=p(o,t);let d=0;c>l&&(d=c,c=l,l=d),(h<c||h>l)&&(d=c,c=l,l=d+2*Math.PI);const u=e[0]-o[0],g=e[1]-o[1];return{linePoints:E(o,Math.sqrt(u*u+g*g),c,l),points:[e,i,o]}}function T(e){const t=new d(e.entityId);let i=1;return Math.abs(1-e.rho)>c.Tolerances.ZERO_LENGTH?(i=e.rho/(1-e.rho),t.splineKnotData=[0,0,0,1,1,1],t.splineCPData=[e.start[0],e.start[1],1,e.controlPoint[0],e.controlPoint[1],i,e.end[0],e.end[1],1]):(t.splineKnotData=[0,0,0,.5,1,1,1],t.splineCPData=[e.start[0],e.start[1],1,e.controlPoint[0],e.controlPoint[1],i,e.controlPoint[0],e.controlPoint[1],i,e.end[0],e.end[1],1]),t.rationalSpline=!0,t.closedSpline=!1,t.offset=e.offset,t.splineDegree=2,t.lowParameter=e.lowParameter,t.highParameter=e.highParameter,S(t)}function S(e){let t=[];const i=[];if(e.splineCPData&&e.splineCPData.length>0&&e.splineDegree&&e.splineKnotData){const s=[];let n;for(n=0;n<e.splineCPData.length;n+=3)s.push([e.splineCPData[n]*e.splineCPData[n+2],e.splineCPData[n+1]*e.splineCPData[n+2],e.splineCPData[n+2]]);const a=new r.Bspline(e.splineDegree,e.splineKnotData,s,l.vec3,!!e.closedSpline),o=e.splineCPData.length*c.Tolerances.NUMBER_OF_POINTS_PER_BSPLINE_CPOINT,d=Math.min(e.lowParameter,e.highParameter),u=Math.abs(e.highParameter-e.lowParameter)/o;let g,p;for(n=0;n<=o;n++)g=d+n*u,p=a.evaluate(g),t.push([p[0]/p[2],p[1]/p[2]]);if(e.offset&&Math.abs(e.offset)>c.Tolerances.ZERO_LENGTH){const i=[];let s=l.vec2.create(),r=l.vec2.create(),d=!1;if(e.closedSpline){const t=a.domain();d=Math.abs(Math.abs(e.highParameter-e.lowParameter)-t[1]+t[0])<c.Tolerances.ZERO_LENGTH}for(n=0;n<=o;++n)s=0===n?h.vec2C.subtract(t[1],t[0],s):n===o?d?h.vec2C.subtract(t[1],t[0],s):h.vec2C.subtract(t[o],t[o-1],s):h.vec2C.subtract(t[n+1],t[n-1],s),h.vec2C.normalize(s),r=h.vec2C.scale([s[1],-s[0]],e.offset,r),i.push(h.vec2C.add(t[n],r,l.vec2.create()));t=i}e.start&&i.push(e.start),e.end&&i.push(e.end)}return{linePoints:t,points:i}}function f(e,t,i,s){let n=!1,r=!1,c=!1,l=!1;t&&((i||"point"===e.type)&&(n=t.isConstruction),r=t.forPreview,t.isFromSplineHandle&&(c=t.isFromSplineHandle),t.isFromSplineControlPolygon&&(l=t.isFromSplineControlPolygon));const h=t?t.status:a.GBTMGeomStatus.UNKNOWN;return(0,o.createSketchEntity)(i,n,c,l,h,s,r)}function C(e,t){const i=e.getSketch(),s=[],r=[];let a,o=0;if(t.linePoints){const e=t.linePoints.length;let n=0;t.linePoints.forEach((function(t){a=i.planeToWorld(t),s.push(a[0],a[1],a[2]),r.push(o),n>0&&n<e-1&&r.push(o),n++,o++}))}return s.length>0?new n.MeshIncrement(n.PrimitiveType.LINES,s,r):null}t.tessellateArc=E,t.createArcPolyline=I,t.createConicPolyline=T,t.createSplinePolyline=S,t.createPolyline=function(e){switch(e.type){case"line":const t=[e.start,e.end];return{linePoints:t,points:t};case"point":return{linePoints:null,points:[e.point]};case"circle":return u(e);case"arc":return I(e.start,e.mid,e.end,e.center,!e.useCenterPointForArcRadius);case"spline":return S(e);case"ellipse":return g(e,0,2*Math.PI);case"ellipticalArc":if(void 0!==e.lowParameter&&void 0!==e.highParameter)return g(e,e.lowParameter,e.highParameter);break;case"conic":return T(e)}return console.warn("Failed to create polyline for unsupported entity type: "+e.type),{linePoints:null,points:null}},t.createEntityMetaData=f,t.createMeshIncrementForPolylineLines=C,t.displayEntity=function(e,t,i,s,r,a){const o=e.getSketch();if(!o)return;if(!t)return void i.removeEntity(r);let c=null;const l=[],h=[];let d=0;t.points&&t.points.forEach((function(e){c=o.planeToWorld(e),l.push(c[0],c[1],c[2]),h.push(d),d++}));const u=C(e,t);u?i.updateTemporaryEntity(r,u,f(s,a,!0,r)):l.length>0&&i.updateTemporaryEntity(r,new n.MeshIncrement(n.PrimitiveType.POINTS,l,h),f(s,a,!1,r))}},969848:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.SketchPlaneDisplay=void 0;const s=i(114924),n=i(545348),r=i(193786),a=i(606544),o=i(264292),c=i(613199),l=new s.NodeProperties({isPickable:!1,primitiveType:s.PrimitiveType.LINES,isStencilWritten:!1,includedInBlend:!0}),h="text",d=n.default.getManager();class u extends s.UIElement{constructor(e,t,i){super(i),this.name=e,this.featureModel=t,this.minPlanePoint=null,this.maxPlanePoint=null,this.textTexture=null,this.planeMatrix=null,this.planeMatrixInverse=null,this.lineColor=d.getColor("SKETCH_PLANE_LINE_COLOR"),this.textColor=d.getColor("SKETCH_PLANE_TEXT_COLOR"),this.textMaterial=(0,s.createTextureMaterial)(),this.textNodeProperties=new s.NodeProperties({isPickable:!1,isTwoSided:!0,primitiveType:s.PrimitiveType.TRIANGLES,material:this.textMaterial}),this.onPlaneChange(),this.listenTo(t,"change:planeMatrix",this.onPlaneChange),this.listenTo(t,"change:hasRegenError",this.onRegenErrorChange)}remove(){this.destroyText(),this.textMaterial&&(this.textMaterial.destroy(),this.textMaterial=null),super.remove()}destroyText(){this.textTexture&&(this.textTexture.destroy(),this.textTexture=null)}onRegenErrorChange(){this.featureModel.getHasRegenError()===a.GBTNodeStatusType.ERROR!==this.isHidden&&this.onPlaneChange()}onPlaneChange(){this.planeMatrix=null,this.planeMatrixInverse=null,this.destroyText(),this.minPlanePoint=null,this.maxPlanePoint=null;const e=this.featureModel.getHasRegenError()===a.GBTNodeStatusType.ERROR;this.viewer.getSketch()&&!e?(this.planeMatrix=this.viewer.getSketch().getPlaneMatrix(),this.planeMatrixInverse=c.mat4C.inverse(this.planeMatrix,o.mat4.create()),this.show()):this.hide(),(0,s.requestDraw)()}getEntityBoundsCenter(){const e=this.featureModel.parameters[0].getBtParameterForCurrentConfiguration();if(this.featureModel&&this.featureModel.parameters&&this.featureModel.parameters.length>0&&e.getIsAQueryList()&&!e.getIsEmptyQueryList()){const t=e.getQueryListItems()[0],i=t.getDeterministicIds();if(i&&i.length>0){const e=this.viewer.getModelViewManagers().getManager(),n=e.extractMeshIncrement(i[0]);if(n){let t=null;const a=e.getDisplayedElement();if(a instanceof s.PartStudio){const e=(0,r.createSelectionFromDeterministicId)(i[0]);e&&(t=a.getBodyTransform(e.getBodyId(),this.viewer))}return t?c.mat4C.multiplyVec3(t,n.getBounds().center()):n.getBounds().center()}const a=e.getMateConnectorGraphics(null,t.getFeatureId());if(a)return a.worldSpacePosition}}return null}hasBounds(){return!!this.minPlanePoint&&!!this.maxPlanePoint}updateBounds(e){if(!this.planeMatrix||this.hasBounds())return;const t=this.getEntityBoundsCenter();if(!t)return;let i=(0,s.projectWorldToPlane)(t,this.planeMatrixInverse);const n=e.projectWorldPointToViewport(t);if(n[0]<e.getViewportLeft()||n[0]>=e.getViewportWidth()||n[1]<e.getViewportBottom()||n[1]>=e.getViewportHeight()){const t=e.viewportToCanvas([e.getViewportWidth()/2,e.getViewportHeight()/2,0]),n=e.getRay(t[0],t[1]),r=.258819,a=(0,s.intersectRayPlaneMatrix)(n,this.planeMatrix,r);a&&(i=(0,s.projectWorldToPlane)(a,this.planeMatrixInverse))}const r=e.getPixelSizeAtWorldPoint((0,s.unprojectPlaneToWorld)(i,this.planeMatrix)),a=d.getNumber("VIEWPORT_HEIGHT_TO_PLANE_HEIGHT_RATIO")*e.getViewportHeight()*r,o=a*d.getNumber("PLANE_DEFAULT_WIDTH_HEIGHT_RATIO");this.minPlanePoint=[i[0]-o/2,i[1]-a/2],this.maxPlanePoint=[i[0]+o/2,i[1]+a/2];const c=(0,s.unprojectPlaneToWorld)([this.minPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),h=(0,s.unprojectPlaneToWorld)([this.maxPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),u=(0,s.unprojectPlaneToWorld)([this.maxPlanePoint[0],this.maxPlanePoint[1]],this.planeMatrix),g=(0,s.unprojectPlaneToWorld)([this.minPlanePoint[0],this.maxPlanePoint[1]],this.planeMatrix),p=(0,s.createLines)([c,h,h,u,u,g,g,c]);(0,s.addColorToIncrement)(this.lineColor,p),this.updateMeshIncrement("edges",s.NO_SELECTION_ID,p,l)}updateText(e){if(!this.planeMatrix||!this.hasBounds())return;const t=this.getTextTexture(),i=(0,s.unprojectPlaneToWorld)([this.minPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),n=(0,s.unprojectPlaneToWorld)([this.maxPlanePoint[0],this.minPlanePoint[1]],this.planeMatrix),r=(0,s.unprojectPlaneToWorld)([this.minPlanePoint[0],this.maxPlanePoint[1]],this.planeMatrix),a=c.vec3C.subtract(n,i,o.vec3.create()),l=c.vec3C.length(a);c.vec3C.normalize(a);const u=c.vec3C.subtract(r,i,o.vec3.create()),g=c.vec3C.length(u);c.vec3C.normalize(u);const p=1/e.getUnitSizeAtWorldPoint(r);let m=p*t.filledWidthPx,E=p*t.filledHeightPx;const I=p*d.getNumber("PLANE_TEXT_MARGIN");if(m>l-2*I||E>g-2*I){const e=Math.min((l-2*I)/m,(g-2*I)/E);if(e<=0)return void this.removeMeshIncrement(h);m*=e,E*=e}const T=c.vec3C.add(r,c.vec3C.scale(u,-I-E,o.vec3.create()),o.vec3.create());c.vec3C.add(T,c.vec3C.scale(a,I,o.vec3.create()));const S=c.vec3C.add(T,c.vec3C.scale(a,m,o.vec3.create()),o.vec3.create()),f=c.vec3C.add(T,c.vec3C.scale(u,E,o.vec3.create()),o.vec3.create());this.textMaterial.ambientTexture=t;const C=(0,s.createQuad)(T,S,f,void 0,[t.leftCoordinate,t.bottomCoordinate],[t.rightCoordinate,t.topCoordinate]);this.updateMeshIncrement(h,s.NO_SELECTION_ID,C,this.textNodeProperties)}getTextTexture(){return this.textTexture||(this.textTexture=(0,s.createTextureFromText)(this.viewer,this.name,{color:this.textColor,font:d.getString("PLANE_TEXT_FONT"),size:d.getNumber("PLANE_TEXT_HEIGHT_PX"),paddingWithinBorder:d.getNumber("PLANE_TEXT_BACKGROUND_PADDING")})),this.textTexture}onViewWillDraw(e,t){this.updateBounds(e),this.updateText(e)}onAppearanceConstantsUpdated(){this.lineColor=d.getColor("SKETCH_PLANE_LINE_COLOR"),this.textColor=d.getColor("SKETCH_PLANE_TEXT_COLOR"),this.onPlaneChange()}}t.SketchPlaneDisplay=u},766470:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.onViewerDraw=t.hasSpaceballConnected=t.stopActionController=t.initializeSpaceballConnection=t.SpaceballConnection=void 0;const n=i(114924),r=i(912057),a=i(545348),o=i(484790),c=i(997687),l=i(264292);let h=!1;class d{constructor(){this.rayAperture=0,this.hitSelectionOnly=!1,this.mouseCreated=!1,this.mouseIsInMotion=!1,this.hitTestRay=new n.Ray([0,0,0],[0,0,0]),this.connexion=new _3Dconnexion(this),this.connexion.connect()||r.log.trace("Failed to initialize connection to 3Dconnexion NL-Proxy")}logMatrix(e,t){const i=function(t){return e[t].toFixed(2)};console.group(t),console.log(i(0)+" "+i(1)+" "+i(2)+" "+i(3)),console.log(i(4)+" "+i(5)+" "+i(6)+" "+i(7)),console.log(i(8)+" "+i(9)+" "+i(10)+" "+i(11)),console.log(i(12)+" "+i(13)+" "+i(14)+" "+i(15)),console.groupEnd()}logVector(e,t){console.group(t),console.log(e[0].toFixed(2)+" "+e[1].toFixed(2)+" "+e[2].toFixed(2)),console.groupEnd()}logNumber(e,t){console.group(t),console.log(e),console.groupEnd()}onConnect(){this.connexion.create3dmouse(window,"Onshape"),h=!0}onDisconnect(e){r.log.trace("3Dconnexion NL-Proxy disconnected: "+e)}getViewer(){return(0,n.getFocusedViewer)()}getViewController(){const e=this.getViewer();return e?e.getPrimaryViewController():null}getCamera(){const e=this.getViewer();return e?e.getCamera():null}checkState(e){return!!(this.getViewer()&&this.getViewController()&&this.getCamera())||(r.log.trace("Attempted to call spaceball."+e+" with no active document."),!1)}onViewerDraw(e,t){this.checkState("onViewerDraw")&&this.mouseCreated&&this.mouseIsInMotion&&e===this.getViewer()&&this.connexion.update3dcontroller({frame:{time:t}})}getViewMatrix(){return this.checkState("getViewMatrix")?this.getCamera().getFrame():null}getConstructionPlane(){if(!this.checkState("getConstructionPlane"))return null;const e=this.getViewer().getSketch();let t=null;return e&&(t=(0,n.extractPlaneFromMatrix)(e.getPlaneMatrix()),t=Array.prototype.slice.call(t)),t}getViewExtents(){return this.checkState("getViewExtents")?this.getCamera().isOrthographic()?this.getCamera().getExtents():(r.log.info("Tried to get view extents for a non-orthographic camera."),null):null}getFov(){return this.checkState("getFov")?this.getCamera().isOrthographic()?(r.log.info("Tried to get fov for an orthographic camera"),0):(0,n.toRadians)(this.getCamera().getFieldOfView()):0}getViewFrustum(){return this.checkState("getViewFrustum")?this.getCamera().isOrthographic()?(r.log.info("Tried to get frustum for an orthographic camera"),null):this.getCamera().getFrustum():null}getPerspective(){return!!this.checkState("getPerspective")&&this.getCamera().isPerspective()}getViewTarget(){if(!this.checkState("getViewTarget"))return null;const e=this.getCamera().getViewport();return this.getCamera().getRay(e[2]/2,e[3]/2).point}getModelExtents(){if(!this.checkState("getModelExtents"))return null;const e=this.getCamera().getSceneBounds();return e?[e.min[0],e.min[1],e.min[2],e.max[0],e.max[1],e.max[2]]:[-1,-1,-1,1,1,1]}getPivotPosition(){if(!this.checkState("getPivotPosition"))return null;const e=this.getViewController();return e.updateRotationPanCenterForSpaceball(),e.getRotateOrPanCenter()}getLookAt(){if(!this.checkState("getLookAt"))return null;const e=this.getViewer(),t=this.getCamera(),i=this.hitTestRay.evaluate(1),s=t.projectWorldPointToCanvas(i);s[2]=0;const n=t.canvasToWorld(s),r=this.rayAperture/2*t.getUnitSizeAtWorldPoint(n),o=t.getViewport(),c=o[2]*o[3]/a.default.getManager().getNumber("DEPTH_SAMPLES_PER_VIEWPORT"),h=Math.sqrt(c/2),d=(r+h)*(r+h);let u;u=this.hitSelectionOnly?e.retrieveHighlightsOnlyDepthSampling():e.retrieveDepthSampling();let g=null;const p=l.vec2.create();for(let e=0;e<u.length;e++){l.vec2.copy(p,[s[0]-u[e][0],s[1]-u[e][1]]);l.vec2.squaredLength(p)<d&&(!g||u[e][2]<g[2])&&(g=u[e])}return g?t.canvasToWorld(g):null}getSelectionEmpty(){return!this.checkState("getSelectionEmpty")||0===(0,o.getSelectionList)().size()}getSelectionExtents(){if(!this.checkState("getSelectionExtents"))return null;const e=new n.BoundingBox;(0,o.getSelectionList)().each((t=>{e.addBox(this.getViewer().getSelectionFitBounds(t))}));const t=e.getMin(),i=e.getMax();return[t[0],t[1],t[2],i[0],i[1],i[2]]}getPointerPosition(){if(!this.checkState)return null;const e=this.getViewController().getPointerPosition();return this.getCamera().getRay(e[0],e[1]).point}getCoordinateSystem(){return[1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]}getFrontView(){return[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1]}setViewMatrix(e){if(!this.checkState("setViewMatrix"))return;const t=this.getViewer();this.getCamera().setFrame(e),t.setUserIsAdjustingCamera(),t.getEventDispatcher().trigger(n.CHANGE_VIEW)}setViewExtents(e){this.checkState("setViewExtents")&&(this.getCamera().isOrthographic()?this.getCamera().setExtents(e):r.log.info("Tried to get view extents for a non-orthographic camera."))}setFov(e){this.checkState("setFov")&&this.getCamera().setFieldOfView((0,n.toDegrees)(e))}setPivotPosition(e){this.checkState("setPivotPosition")&&this.getViewController().setRotationPivotPosition(e)}setPivotVisible(e){this.checkState("setPivotVisible")&&this.getViewController().setShowRotationPivot(e)}setLookFrom(e){this.hitTestRay.setPoint(e)}setLookDirection(e){this.hitTestRay.setDirection(e)}setLookAperture(e){this.rayAperture=e}setSelectionOnly(e){this.hitSelectionOnly=e}setTransaction(e){this.checkState("setTransaction")&&0===e&&this.getViewer().requestDraw()}onStartMotion(){this.checkState("onStartMotion")&&(this.mouseIsInMotion=!0,this.getViewer().setSuppressMouseMovePick(!0),(0,o.clearPreSelection)(),this.getViewController().setIsSpaceballMoving(!0),this.getViewer().requestDraw())}onStopMotion(){this.checkState("onStopMotion")&&(this.mouseIsInMotion=!1,this.getViewController().setIsSpaceballMoving(!1),this.getViewer().setSuppressMouseMovePick(!1),this.getViewer().doPreHighlightPick())}setActiveCommand(e){e&&(0,n.getActiveViewerEventDispatcher)().trigger(n.SPACEMOUSE_COMMAND,e)}on3dmouseCreated(){h&&(c.btInjector.SpaceballService.initializeSpacemouseCommands(),this.connexion.update3dcontroller({frame:{timingSource:1}}),this.mouseCreated=!0)}update3dcontroller(e){h&&this.mouseCreated&&this.connexion.update3dcontroller(e)}}t.SpaceballConnection=d;let u=null,g=null;t.initializeSpaceballConnection=function(){s("iframe").attr("tabindex","-1"),!(0,n.isSpaceballSupported)()||u||g||(u=new d,g=new n.ActionSetController(u),g.startListeningToEvents())},t.stopActionController=function(){g&&g.stopListeningToEvents()},t.hasSpaceballConnected=function(){return h},t.onViewerDraw=function(e,t){u&&u.onViewerDraw(e,t)}},126049:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.State=void 0;const s=i(912057);t.State=class{constructor(){this.gl=null,this.state={},this.stack=[]}setGlContext(e){this.gl=e,this.callGl("depthMask",!0),this.callGl("depthFunc",this.getGl().LEQUAL)}getGl(){return this.gl}capture(){this.stack.push(this.state),this.state=Object.create(this.state)}restore(){if(0===this.stack.length)return void s.log.warn("Graphics state restore attempted without previous capture");const e=this.state,t=this.stack.pop();for(const i in e)if(e.hasOwnProperty(i)){const e=t[i];e&&this.callGl(i,e[0],e[1],e[2],e[3])}this.state=t}callGl(e,t,i,s,n){const r=this.state[e];if(r&&r[0]===t&&r[1]===i&&r[2]===s&&r[3]===n)return;const a=[t,i,s,n];this.gl[e].apply(this.gl,a),this.state[e]=a}getState(e){return this.state[e]}}},783708:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.TaskManager=t.MEDIUM_INTERACTIVE_BUDGET=t.SMALL_INTERACTIVE_BUDGET=t.Budget=void 0;const s=i(545348),n=i(114924);class r{constructor(e,t){this.timeBudget=e,this.vertexBudget=t,this.startTime=0,this.verticesSpent=0}addVertexCost(e){this.verticesSpent+=e}reset(){this.startTime=(0,n.getTimeInMilliseconds)(),this.verticesSpent=0}budgetExceeded(){return this.verticesSpent>this.vertexBudget||(0,n.getTimeElapsed)(this.startTime)>this.timeBudget}}t.Budget=r,t.SMALL_INTERACTIVE_BUDGET=new r(s.default.getManager().getNumber("GRAPHICS_TASK_SMALL_INTERACTIVE_TIME_BUDGET"),s.default.getManager().getNumber("GRAPHICS_TASK_SMALL_INTERACTIVE_VERTEX_BUDGET")),t.MEDIUM_INTERACTIVE_BUDGET=new r(s.default.getManager().getNumber("GRAPHICS_TASK_MEDIUM_INTERACTIVE_TIME_BUDGET"),s.default.getManager().getNumber("GRAPHICS_TASK_MEDIUM_INTERACTIVE_VERTEX_BUDGET"));t.TaskManager=class{constructor(){this.tasks=[]}addTask(e,t){this.tasks.push({task:e,budget:t})}processWithBudget(e){e&&e.reset();for(let t=0;t<this.tasks.length&&(!e||!e.budgetExceeded());++t)this.tasks[t].task.process(e)}processInteractively(){let e=null;for(let t=0;t<this.tasks.length;++t)if(this.tasks[t].task.hasPendingWork()){e=this.tasks[t].budget;break}e&&this.processWithBudget(e)}complete(){this.processWithBudget(null)}hasPendingWork(){for(let e=0;e<this.tasks.length;++e)if(this.tasks[e].task.hasPendingWork())return!0;return!1}}},996408:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Text=void 0;const s=i(545348),n=i(264292),r=i(683067),a=i(114924),o=i(613199);class c extends a.UIElement{constructor(e,t){super(t,e.sceneGraphId),this.texture=null,this.text="",this.offsetAdjustmentFunction=null,this.drawBox=!1,this.boxOffsetPixels=0,this.backgroundColor=[1,1,1,1],this.backgroundOpacity=0,this.updateOnEachFrame=!0,this.origin=e.origin,this.right=e.right,this.up=e.up,this.heightPx=e.heightPx,this.orientToScreen=!!e.orientToScreen,this.offsetUp=void 0!==e.offsetUp?e.offsetUp:a.BoundingSpot.MID,this.offsetRight=void 0!==e.offsetRight?e.offsetRight:a.BoundingSpot.MID,this.orientToScreen&&(this.right=[1,0,0],this.up=[0,0,1]);const i=s.default.getManager();this.color=e.color||i.getColor("DEFAULT_TEXT_COLOR"),this.font=e.font||i.getString("DEFAULT_TEXT_FONT"),this.material=(0,a.createTextureMaterial)(),this.nodeProperties=new a.NodeProperties(Object.assign({},{isPickable:!1,isTwoSided:!0,primitiveType:a.PrimitiveType.TRIANGLES,isShowThrough:!0,isDepthTested:!1,material:this.material},e.textNodePropertyOptions||{})),this.boxNodeProperties=new a.NodeProperties(Object.assign({},{isPickable:!1,primitiveType:a.PrimitiveType.LINES},e.boxNodePropertyOptions||{}))}remove(){this.destroyText(),this.material&&(this.material.destroy(),this.material=null),super.remove()}destroyText(){this.texture&&(this.texture.destroy(),this.texture=null)}setOffsetAdjustmentFunction(e){const t=this.offsetAdjustmentFunction;return this.offsetAdjustmentFunction=e,t}setDrawBox(e,t,i,s){this.drawBox=e,t&&(this.boxOffsetPixels=t),i&&(this.backgroundColor=i),s&&(this.backgroundOpacity=s),e||this.removeMeshIncrement("box")}setHeightPx(e){this.setHeightAndColor(e)}setText(e){this.text!==e&&(this.destroyText(),this.text=e,this.texture=(0,a.createTextureFromText)(this.viewer,e,{color:this.color,font:this.font,size:this.heightPx}),this.material.ambientTexture=this.texture,(0,a.requestDraw)())}setHeightAndColor(e,t){let i=!1;t&&this.color!==t&&(this.color=t,i=!0),e&&this.heightPx!==e&&(this.heightPx=e,i=!0),i&&this.text&&(this.destroyText(),this.drawBox?this.texture=(0,a.createTextureFromText)(this.viewer,this.text,{color:this.color,font:this.font,size:this.heightPx,paddingWithinBorder:this.boxOffsetPixels,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity}):this.texture=(0,a.createTextureFromText)(this.viewer,this.text,{color:this.color,font:this.font,size:this.heightPx}),this.material.ambientTexture=this.texture,(0,a.requestDraw)())}onViewWillDraw(e){if(!this.texture)return;if(!this.updateOnEachFrame&&this.hasMeshIncrements())return;const t=this.getTextCorners(e);if(this.updateMeshIncrement("text",a.NO_SELECTION_ID,this.createScreenSpaceQuad(e,t.lowerLeft,t.lowerRight,t.upperLeft),this.nodeProperties),this.orientToScreen){const t=n.vec3.clone(e.getUp()),i=n.vec3.create();n.vec3.normalize(i,n.vec3.cross(i,e.getForward(),t));const s=n.vec3.create();n.vec3.normalize(s,n.vec3.cross(s,t,i));const r=n.mat4.fromValues(i[0],i[1],i[2],0,s[0],s[1],s[2],0,t[0],t[1],t[2],0,this.origin[0],this.origin[1],this.origin[2],1);this.setTransform(r)}if(this.drawBox){const e=o.vec3C.scale(o.vec3C.subtract(t.lowerRight,t.lowerLeft,n.vec3.create()),.5),i=o.vec3C.scale(o.vec3C.subtract(t.upperLeft,t.lowerLeft,n.vec3.create()),.5),s=o.vec3C.scale(o.vec3C.add(t.lowerRight,t.upperLeft,n.vec3.create()),.5);this.updateMeshIncrement("box",a.NO_SELECTION_ID,(0,a.createQuadOutline)(s,e,i,this.color,1),this.boxNodeProperties)}}getTextCorners(e){const t=this.origin;this.transform&&o.mat4C.multiplyVec3(this.transform,this.origin,n.vec3.create());const i=e.getPixelSizeAtWorldPoint(t);let s=this.origin;this.orientToScreen&&(s=this.getOffsetOrigin(i));let a=new r.ScreenSpaceData;return a.pixelSize=i,a.lowerLeft=n.vec3.clone(s),a.lowerRight=o.vec3C.add(o.vec3C.scale(this.right,i*this.texture.filledWidthPx,n.vec3.create()),s),a.upperLeft=o.vec3C.add(o.vec3C.scale(this.up,i*this.texture.filledHeightPx,n.vec3.create()),s),this.offsetAdjustmentFunction&&(a=this.offsetAdjustmentFunction(a)),a}getOffsetOrigin(e){return[-this.offsetRight*e*this.texture.filledWidthPx,0,-this.offsetUp*e*this.texture.filledHeightPx]}createScreenSpaceQuad(e,t,i,s){const n=this.orientToScreen?[!1,!1]:(0,a.orientText)(e,this.right,this.up,this.transform);return(0,a.createQuad)(t,i,s,void 0,[n[0]?this.texture.rightCoordinate:this.texture.leftCoordinate,n[1]?this.texture.topCoordinate:this.texture.bottomCoordinate],[n[0]?this.texture.leftCoordinate:this.texture.rightCoordinate,n[1]?this.texture.bottomCoordinate:this.texture.topCoordinate])}}t.Text=c},985612:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createRGBATexture=t.getTextureSize=t.unbindTexture=t.bindTexture=t.Texture=t.TextureDefinition=t.areTexturesPendingLoad=void 0;const s=i(114924),n=i(772687),r=i(142885),a=i(912057),o=new n.StringSet;t.areTexturesPendingLoad=function(){return!o.isEmpty()};t.TextureDefinition=class{constructor(e){this.bytes=null,this.floats=null,this.width=-1,this.height=-1,this.useMipmaps=!1,this.maxAnisotropy=-1,this.canvas=null,this.imageSource="",this.defersRendering=!1,this.internalFormat=e.RGBA,this.format=this.internalFormat,this.minificationFilter=e.NEAREST,this.magnificationFilter=e.NEAREST,this.wrapS=e.CLAMP_TO_EDGE,this.wrapT=e.CLAMP_TO_EDGE}isImage(){return!!this.imageSource}};let c=0;class l extends r.BackboneEventsBaseClass{constructor(e,t,i){super(),this.viewer=e,this.GAUGE_MEMORY_TYPE="Texture",this.creationFunction=null,this.textureDefinition=null,this.waitingForTextureData=!1,this.texture=null,this.textureSize=0,this.textureNeedsUpdate=!1,this.hasTransparency=!0,this.performedImageLoadRetry=!1,(0,s.viewerCheck)(e),"function"==typeof t?this.creationFunction=t:this.textureDefinition=t,this.updateFunction=i,this.id=c.toString(),++c,this.textureDefinition&&this.textureDefinition.isImage()&&this.createTexture(),this.listenTo(this.viewer.getEventDispatcher(),s.SESSION_ENDED,this.onGlContextLostOrDestroyed),this.listenTo(this.viewer.getEventDispatcher(),s.GL_CONTEXT_LOST,this.onGlContextLostOrDestroyed)}destroy(){var e;this.stopListening(),this.texture&&(null===(e=this.viewer.getGlContext())||void 0===e||e.deleteTexture(this.texture),this.viewer.getMemoryGauge().decrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.textureSize)),this.texture=null}setTextureNeedsUpdate(e){this.textureNeedsUpdate=e}createTexture(){if(this.texture)return;const e=this.textureDefinition?this.textureDefinition:this.creationFunction(this.viewer.getGlContext());if(!e)return;const t=this.viewer.getGlContext();if(this.texture=t.createTexture(),this.textureNeedsUpdate=!1,e.isImage())this.loadTextureFromImage(e);else{const i="createTexture temporary";h(this.viewer,this.texture,i)>=0&&(e.bytes?(t.texImage2D(t.TEXTURE_2D,0,e.internalFormat,e.width,e.height,0,e.format,t.UNSIGNED_BYTE,e.bytes),this.setTextureSize(e.width,e.height,e.internalFormat,t.UNSIGNED_BYTE)):e.floats?this.viewer.areFloatTexturesSupported()?(t.texImage2D(t.TEXTURE_2D,0,e.internalFormat,e.width,e.height,0,e.format,t.FLOAT,e.floats),this.setTextureSize(e.width,e.height,e.internalFormat,t.FLOAT)):a.log.warn(s.WEBGL_ERROR_LOG_TAG+"An attempt was made to make a float texture without float texture support"):e.canvas?(t.texImage2D(t.TEXTURE_2D,0,e.internalFormat,e.format,t.UNSIGNED_BYTE,e.canvas),this.setTextureSize(e.canvas.width,e.canvas.height,e.internalFormat,t.UNSIGNED_BYTE)):a.log.warn(s.WEBGL_ERROR_LOG_TAG+"An attempt was made to create a texture without valid input"),this.finishTextureSpecification(e),this.viewer.releaseTextureUnit(i))}}get imageSourceUri(){return this.textureDefinition?this.textureDefinition.imageSource:null}setTextureSize(e,t,i,s){this.textureSize=d(e,t,i,s),this.viewer.getMemoryGauge().incrementMemoryUsage(this.GAUGE_MEMORY_TYPE,this.textureSize)}loadTextureFromImage(e){const t=new Image;this.waitingForTextureData=!0,e.defersRendering&&o.add(this.id),t.onload=()=>{const i=this.viewer.getGlContext();if(!i||!this.texture)return;this.waitingForTextureData=!1;h(this.viewer,this.texture,"loadTextureFromImage")>=0&&(i.texImage2D(i.TEXTURE_2D,0,e.internalFormat,e.format,i.UNSIGNED_BYTE,t),this.setTextureSize(t.width,t.height,e.internalFormat,i.UNSIGNED_BYTE),this.finishTextureSpecification(e),this.viewer.releaseTextureUnit("loadTextureFromImage")),o.remove(this.id),(0,s.requestDraw)()},t.onerror=()=>{if(o.remove(this.id),this.performedImageLoadRetry)a.log.warn("Could not load texture image: "+e.imageSource);else{a.log.info("Initial attempt to load texture image failed: "+e.imageSource),this.performedImageLoadRetry=!0;setTimeout((()=>{this.loadTextureFromImage(e)}),1e4)}(0,s.requestDraw)()};setTimeout((()=>{o.contains(this.id)&&(o.remove(this.id),(0,s.requestDraw)())}),2e3),t.src=e.imageSource}finishTextureSpecification(e){const t=this.viewer.getGlContext(),i=this.viewer.getAnisotropicExtension();i&&e.maxAnisotropy>0&&t.texParameterf(t.TEXTURE_2D,i.TEXTURE_MAX_ANISOTROPY_EXT,e.maxAnisotropy),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e.magnificationFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e.minificationFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,e.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,e.wrapT),e.useMipmaps&&t.generateMipmap(t.TEXTURE_2D)}updateAndBindTexture(e){if((0,s.viewerCheck)(this.viewer),this.texture||this.createTexture(),this.waitingForTextureData)return-1;const t=this.viewer.getGlContext(),i=h(this.viewer,this.texture,e);return i>=0&&this.textureNeedsUpdate&&this.updateFunction&&(t.activeTexture(t.TEXTURE0+i),this.updateFunction(),this.textureNeedsUpdate=!1),i}setHasTransparency(e){this.hasTransparency=e}getHasTransparency(){return this.hasTransparency}onGlContextLostOrDestroyed(){this.texture=null}}function h(e,t,i){(0,s.viewerCheck)(e);const n=e.getOrAllocateTextureUnit(i);return n>=0&&e.bindTextureToUnit(t,n),n}function d(e,t,i,n){return e*t*(0,s.getChannelCountOfGlPixelFormat)(i)*(0,s.sizeOfGlType)(n)}t.Texture=l,t.bindTexture=h,t.unbindTexture=function(e,t){(0,s.viewerCheck)(e);const i=e.getTextureUnit(t);i>=0&&(e.bindTextureToUnit(null,i),e.releaseTextureUnit(t))},t.getTextureSize=d,t.createRGBATexture=function(e,t,i,n){(0,s.viewerCheck)(e);const r=e.getGlContext(),o=r.createTexture(),c="createRGBATexture temporary",l=e.getOrAllocateTextureUnit(c);if(l<0)return null;try{e.bindTextureToUnit(o,l),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t,i,0,r.RGBA,n,null),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e.bindTextureToUnit(null,l),e.releaseTextureUnit(c)}catch(e){throw a.log.warn("BEL-56217 - exception while creating texture with width "+t+", height: "+i+", precision: "+n+", exception: "+e),e}return o}},431008:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.createAtlasFromResources=t.getMaximumTextureSize=t.TextureAtlas=t.ImageData=void 0;const s=i(225072),n=i(114924);t.ImageData=class{constructor(){this.id="",this.imageName="",this.backgroundColor="rgba(0,0,0,0)",this.index=-1}};class r{constructor(e,t){this.viewer=e,this.options=t,this.sources=null,this.imageSize=0,this.gridSize=0,this.textureSize=0,this.texture=null,this.canvas=null,(0,n.viewerCheck)(e)}destroy(){this.texture&&(this.texture.destroy(),this.texture=null)}getCanvasPosition(e){const t=e%this.gridSize,i=(e-t)/this.gridSize;return[t*this.imageSize,i*this.imageSize]}onReceivedImages(e){this.canvas=document.createElement("canvas"),this.canvas.width=this.textureSize,this.canvas.height=this.textureSize,this.options.debugCanvas&&(this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.bottom="0",this.canvas.style.zIndex="1000",document.body.append(this.canvas));const t=this.canvas.getContext("2d");t.fillStyle="rgba(0, 0, 0, 0)",t.fillRect(0,0,this.textureSize,this.textureSize),e.forEach(((e,i)=>{const s=this.sources[i],n=this.getCanvasPosition(i);t.fillStyle=s.backgroundColor,t.fillRect(n[0],n[1],this.imageSize,this.imageSize),e&&t.drawImage(e,n[0],n[1],this.imageSize,this.imageSize)})),this.texture=new n.Texture(this.viewer,(e=>{const i=new n.TextureDefinition(e);if(i.width=this.canvas.width,i.height=this.canvas.height,this.options.clearColorOverride){const e=t.getImageData(0,0,this.canvas.width,this.canvas.height).data;for(let t=0;t<e.length;t+=4)0===e[t+3]&&(e[t]=this.options.clearColorOverride[0],e[t+1]=this.options.clearColorOverride[1],e[t+2]=this.options.clearColorOverride[2],e[t+3]=this.options.clearColorOverride[3]);i.bytes=e}else i.canvas=this.canvas;return i.magnificationFilter=e.LINEAR,i.minificationFilter=e.LINEAR_MIPMAP_LINEAR,i.maxAnisotropy=4,i.useMipmaps=!0,i})),this.texture.setHasTransparency(this.options.sourcesHaveTransparency)}onImageGetFailed(e){}getTextureCoords(e){const t=this.sources.find((t=>t.id===e));if(!t)return null;const i=this.getCanvasPosition(t.index);return{lowS:i[0]/this.textureSize,highS:(i[0]+this.imageSize)/this.textureSize,lowT:i[1]/this.textureSize,highT:(i[1]+this.imageSize)/this.textureSize}}getTextureCoordsOffset(e,t){const i=this.sources.find((t=>t.id===e));if(!i)return null;const s=this.getCanvasPosition(i.index);return{lowS:(s[0]+t)/this.textureSize,highS:(s[0]+this.imageSize-t)/this.textureSize,lowT:(s[1]+t)/this.textureSize,highT:(s[1]+this.imageSize-t)/this.textureSize}}}function a(){return 1024}t.TextureAtlas=r,t.getMaximumTextureSize=a,t.createAtlasFromResources=function(e,t,i,a){const o=Math.ceil(Math.sqrt(i.length)),c=(0,n.getNextPowerOfTwo)(o*t);if(c>1024||0===o)return s.fcall((()=>null));const l=new r(e,a);l.sources=[...i],l.gridSize=o,l.imageSize=t,l.textureSize=c;const h=[];return l.sources.forEach(((e,t)=>{e.index=t;const i=s.defer();h.push(i.promise);const n=new Image;n.onload=function(){i.resolve(n)},n.src="/images/"+e.imageName})),s.all(h).then((e=>(l.onReceivedImages(e),l)),(e=>(l.onImageGetFailed(e),null)))}},817156:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Factory=t.MATE_INDICATOR_ATLAS=t.SKETCH_CONSTRAINT_TEXTURE_ATLAS=void 0,t.SKETCH_CONSTRAINT_TEXTURE_ATLAS="sketch-constraints",t.MATE_INDICATOR_ATLAS="mates";t.Factory=class{constructor(){this.creationPromises={}}getAtlas(e,t){let i=this.creationPromises[e];return i||(i=t(),this.creationPromises[e]=i),i}clearAtlas(e){delete this.creationPromises[e]}}},919458:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.createTextureFromText=t.findTextBounds=t.displayCanvasInDom=t.orientText=t.drawTextIntoCanvas=t.makeRoundedRectanglePath=t.drawBorderIntoCanvas=t.drawBackgroundIntoCanvas=t.createTextCanvas=t.measureTextWidth=t.fillCanvasWithTransparentColor=t.setupContextForText=t.getUtilityContext=t.getBlankCanvas=t.DEFAULT_OPTIONS=t.TextTexture=t.CanvasTextureDefinition=void 0;const n=i(873896),r=i(114924),a=i(912057),o=i(264292),c=i(268154),l=i(613199);class h{constructor(e,t,i,s,n){this.canvas=e,this.filledWidthPx=t,this.filledHeightPx=i,this.leftPixel=s,this.topPixel=n}}t.CanvasTextureDefinition=h;class d extends r.Texture{constructor(e,t){super(e,(e=>this.textureCreationFunction(e))),this.canvasCreationFunction=t,this.width=-1,this.height=-1,this.filledWidthPx=-1,this.filledHeightPx=-1,this.leftCoordinate=-1,this.rightCoordinate=-1,this.bottomCoordinate=-1,this.topCoordinate=-1;this.createTexture()}createTexturedQuad(){return(0,r.createQuad)([0,0,0],[this.filledWidthPx,0,0],[0,this.filledHeightPx,0],"textQuad",[this.leftCoordinate,this.bottomCoordinate],[this.rightCoordinate,this.topCoordinate])}textureCreationFunction(e){const t=this.canvasCreationFunction(e);this.width=t.canvas.width,this.height=t.canvas.height,this.filledWidthPx=t.filledWidthPx,this.filledHeightPx=t.filledHeightPx,this.leftCoordinate=t.leftPixel/t.canvas.width,this.rightCoordinate=this.leftCoordinate+t.filledWidthPx/t.canvas.width,this.topCoordinate=t.topPixel/t.canvas.height,this.bottomCoordinate=this.topCoordinate+t.filledHeightPx/t.canvas.height;const i=new r.TextureDefinition(e);return i.canvas=t.canvas,i.magnificationFilter=e.LINEAR,i.minificationFilter=e.LINEAR_MIPMAP_LINEAR,i.maxAnisotropy=4,i.wrapS=e.CLAMP_TO_EDGE,i.wrapT=e.CLAMP_TO_EDGE,i.useMipmaps=!0,i}}function u(e,t){const i=document.createElement("canvas");return i.width=(0,r.getNextPowerOfTwo)(e),i.height=(0,r.getNextPowerOfTwo)(t),i}t.TextTexture=d,t.DEFAULT_OPTIONS={font:"Arial",heightPx:10,weight:"",color:"#000000"},t.getBlankCanvas=u;let g=null;function p(){if(!g){const e=u(128,128);g=e.getContext("2d",{willReadFrequently:!0})}return g}function m(e,i){i=Object.assign({},t.DEFAULT_OPTIONS,i),e.font=(i.weight?i.weight+" ":"")+i.heightPx+"px "+i.font,e.textAlign="left",e.fillStyle=i.color,e.globalAlpha=1,e.textBaseline="hanging"}t.getUtilityContext=p,t.setupContextForText=m;const E=1;function I(e,t){const i=e.getContext("2d",{willReadFrequently:!0}),s=i.getImageData(0,0,e.width,e.height),n=[t[0],t[1],t[2],E],r=s.data.length/4;for(let e=0;e<r;++e)for(let t=0;t<4;++t)s.data[4*e+t]=n[t];return i.putImageData(s,0,0),n}function T(e,t){const i=p();m(i,t);let s=0;for(let t=0;t<e.length;++t)s=Math.max(s,i.measureText(e[t]).width);return s}function S(e,t){return u(e,t)}function f(e,t,i,s,n,r,a,o){const c=e.getContext("2d",{willReadFrequently:!0});I(e,n),o=(o||0)+1,c.fillStyle="rgba("+n[0]+","+n[1]+","+n[2]+","+r+")",P(c,t,i,s,a,o),c.fill()}function C(e,t,i,s,n,r,a,o,c,l){const h=e.getContext("2d",{willReadFrequently:!0});l||I(e,n),h.strokeStyle="rgba("+n[0]+","+n[1]+","+n[2]+", 1.0)",h.setLineDash([o,c]),h.lineWidth=a;P(h,t,i,s,r+a/2,a/2+1),h.stroke()}function P(e,t,i,s,n,r){const a=r,o=r;t-=2*r,i-=2*r,e.beginPath(),e.moveTo(a+n,o+s),e.arcTo(a+t,o+s,a+t,o+s+i,n),e.arcTo(a+t,o+s+i,a,o+s+i,n),e.arcTo(a,o+s+i,a,o+s,n),e.arcTo(a,o+s,a+t,o+s,n),e.closePath()}function v(e){return e.split("\n")}function D(e,t,i,s,n){const r=i.getContext("2d",{willReadFrequently:!0});m(r,t);const a=v(e);for(let e=0;e<a.length;++e)r.fillText(a[e],s,n+t.heightPx*e);i.filledWithText=e}t.fillCanvasWithTransparentColor=I,t.measureTextWidth=T,t.createTextCanvas=S,t.drawBackgroundIntoCanvas=f,t.drawBorderIntoCanvas=C,t.makeRoundedRectanglePath=P,t.drawTextIntoCanvas=D,t.orientText=function(e,t,i,s){s&&(s=l.mat4C.toMat3(s),t=l.mat3C.multiply(s,t,o.vec3.create()),i=l.mat3C.multiply(s,i,o.vec3.create()));const r=e.getRight(),a=e.getForward(),c=e.up,h=o.vec3.dot(t,r);let d=!1;h<=-n.Tolerances.ZERO_LENGTH?d=!0:h<=n.Tolerances.ZERO_LENGTH&&(d=o.vec3.dot(t,c)<=n.Tolerances.ZERO_LENGTH);const u=d?l.vec3C.scale(t,-1,o.vec3.create()):t,g=l.vec3C.cross(u,a,o.vec3.create());return[d,o.vec3.dot(i,g)<=-n.Tolerances.ZERO_LENGTH]};let M=null;function y(e,t,i,s,n,a){const o=I(e,i);return D(t,s,e,n,n+a),(0,c.isBrowserFirefox)()?function(e,t){const i=new r.BoundingBox2D,s=e.getContext("2d",{willReadFrequently:!0}),n=e.width,a=e.height,o=s.getImageData(0,0,n,a).data;for(let e=0;e<a;++e)for(let s=0;s<n;++s)if(_(o,t,n,a,s,e)){const r=_(o,t,n,a,s-1,e)||_(o,t,n,a,s+1,e),c=_(o,t,n,a,s,e-1)||_(o,t,n,a,s,e+1);r&&c&&i.addPointXY(s,e)}return i}(e,o):function(e,t){const i=new r.BoundingBox2D,s=e.getContext("2d",{willReadFrequently:!0}),n=e.width,a=e.height,o=s.getImageData(0,0,n,a).data;for(let e=0;e<a;++e)for(let s=0;s<n;++s)_(o,t,n,a,s,e)&&i.addPointXY(s,e);return i}(e,o)}t.displayCanvasInDom=function(e){M||(M=s('<div style="z-index:999999;margin:5px;position:fixed;left:0;bottom:0"></div>').appendTo("body")),s(e).css({background:"yellow",margin:"0 5px"}),s(e).appendTo(M)},t.findTextBounds=y;const O=256;function _(e,t,i,s,n,r){if(n<0||n>=i||r<0||r>=s)return!1;const a=4*(r*i+n),o=e.subarray(a,a+4);if(o[3]>E){if(l.vec4C.distanceSquared(t,o)>O)return!0}return!1}t.createTextureFromText=function(e,t,{color:i,font:s,size:n,fontWeight:r,paddingWithinBorder:o,backgroundColor:c,backgroundOpacity:l,backgroundRadius:u,borderColor:g,borderThickness:p,dashLength:m,dashGapLength:E,underlineWidth:P}){return new d(e,(function(e){const d=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2])],M={color:"rgb("+d[0]+","+d[1]+","+d[2]+")",font:s,heightPx:n,weight:r},O=(o=o||0)+(p=p||0),_=Math.max(2,Math.ceil(.25*n)),A=v(t);let R=Math.ceil(T(A,M))+2*O;R=Math.min(R,e.getParameter(e.MAX_TEXTURE_SIZE));const N=n*A.length+2*O,w=S(R,N+2*_),b=w.getContext("2d",{willReadFrequently:!0}),L=y(w,t,d,M,O,_);L.isInitialized()||(a.log.warn("Did not find canvas bounds for text: "+t),L.addPointXY(0,_),L.addPointXY(R,_+N));const B=L.min[1];if(c){f(w,R,N,B-O,[Math.floor(255*c[0]),Math.floor(255*c[1]),Math.floor(255*c[2]),Math.floor(255*l)],l=l||1,u=u||0,p)}else I(w,d);if(g){C(w,R,N,B-O,[Math.floor(255*g[0]),Math.floor(255*g[1]),Math.floor(255*g[2])],u||0,p,m||1,E||0,!!c)}const F=L.getDimensions(),x=O+_+Math.floor((A.length*n-F[1])/(2*A.length));if(P){b.strokeStyle=M.color,b.lineWidth=P,b.beginPath();const e=.95,t=x+Math.floor(n*e)-.5*P;b.moveTo(O,t),b.lineTo(R-O,t),b.stroke()}return D(t,M,w,O,x),new h(w,R,N,0,B-O)}))}},250567:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.generateThumbnails=t.getViewerFitPoints=t.getDataUri=t.getFeatureThumbnailKey=t.getPartThumbnailKey=t.getPartStudioThumbnailKey=t.setSketchNeedsThumbnail=t.removeThumbnailForKey=t.setThumbnailForKey=t.getThumbnailForKey=t.setPartThumbnailNeedsToBeRerendered=void 0;const s=i(114924),n=i(545348),r=i(316641),a=i(193786),o=i(912057),c=i(269399),l=i(606544),h=i(264292),d=window.document.createElement("canvas"),u=window.document.createElement("canvas"),g={},p={};let m={};function E(e,t){const i=(0,s.getTimeInMilliseconds)();g[e]=[i,t]}t.setPartThumbnailNeedsToBeRerendered=function(e){p[e]=!0},t.getThumbnailForKey=function(e){const t=(0,s.getTimeInMilliseconds)(),i=g[e];return i&&t-i[0]<n.default.getManager().getNumber("THUMBNAIL_LOCAL_EXPIRATION_INTERVAL")?i[1]:null},t.setThumbnailForKey=E,t.removeThumbnailForKey=function(e){delete g[e]},t.setSketchNeedsThumbnail=function(e){m[e]=!0};const I=new s.Settings;function T(e,t,i,s){return e+"-"+t+"-"+i+"x"+s}function S(e,t,i,s){return e+"-"+t+"-"+i+"x"+s}function f(e,t,i,s){return e+"-"+t+"-"+i+"x"+s}function C(e,t,i,s){d.width=e,d.height=t,u.width=e/s,u.height=t/s;const n=d.getContext("2d"),r=n.createImageData(e,t);r.data.set(i),n.putImageData(r,0,0);const a=u.getContext("2d");return a.translate(0,t/s),a.scale(1/s,-1/s),a.drawImage(d,0,0),u.toDataURL()}function P(e){const t=e.getPrimaryViewController().getZoomFitTargetCamera(e.getCamera().getFrame(),e.getFitBounds());e.pushCameraState(t),e.getBodyManager().updateForFrame(e.getRenderContext()),e.renderContext.prepareForNextFrame(),e.depthSamplingPass.retrieve(e.getRenderContext(),{includePlanes:!0,performIsolationTest:!0}),e.popCameraState();const i=[];for(let s=0;s<e.depthSamplingPass.points.length;++s)i.push(t.canvasToWorld(e.depthSamplingPass.points[s]));return i}I.enableSSAO=!1,I.enableEdgeSilhouettes=!1,I.enableBackfaceSilhouettes=!1,t.getPartStudioThumbnailKey=T,t.getPartThumbnailKey=S,t.getFeatureThumbnailKey=f,t.getDataUri=C,t.getViewerFitPoints=P,t.generateThumbnails=function(e,t,i){if(!e.getCamera())return;const d=e.getModelViewManagers().getManager(),u=d.partStudios[d.getDisplayedFullElementId()];if(!u)return;c.LeaderFollowController.getController().pauseListeningForRedraw();const v=u.bodyComponent,D=u.sketchComponent,M=r.DocumentClientCache.getSingleton().getComputedData(d.getDisplayedElementId()),y=(0,s.getTimeInMilliseconds)(),O=n.default.getManager().getNumber("THUMBNAIL_PART_RENDER_LIMIT"),_=n.default.getManager().getNumber("THUMBNAIL_PART_RENDER_TIME_LIMIT");u.removeInContextAssemblies();const A=e.getGlContext();if(!A)return;const R=e.getOrCreateFrameBuffer(A.UNSIGNED_BYTE,"",{storageType:A.DEPTH_STENCIL,attachmentType:A.DEPTH_STENCIL_ATTACHMENT});e.setUserIsManipulatingWithTimeout(),e.detailManager.setOverrideSettings(I),e.getEventDispatcher().trigger(s.WILL_RENDER_THUMBNAILS);const N=e.getRenderingMode();e.setRenderingMode(l.GBTGraphicsRenderMode.SHADED_WITH_EDGES),e.getIsolatedOccurrenceManager().clearAllIsolateNoAnimation(),e.disableCurrentLaminarHighlightController();const w=e.getPrimaryViewController();w.isPerspective()&&e.setPrimaryViewController(w.getMatchingOrthographicController()),e.viewManipulator&&e.viewManipulator.hide();const b=e.getCamera().clone();let L=null;const B=(0,s.isOrderIndependentTransparencyEnabled)();(0,s.setOrderIndependentTransparencyEnabled)(!1);const F=u.getHideableFeatureIds(),x=[];for(const e in v.bodyMetaData){const t=v.retrieveBodyMetaData(e);t&&t.shouldProduceLocalThumbnail()&&x.push(e)}const U=[];for(const e in u.sketchComponent.sketchToSketchEntityMapping)m[e]&&U.push(e);const G=M?U.length:0,V=function(e,t,i,s){t&&t.forEach((t=>{const n=e.extractMeshIncrement(t);if(n){const e=h.vec3.create();for(let t=0;t<n.points.length;t+=3*i)e[0]=n.points[t],e[1]=n.points[t+1],e[2]=n.points[t+2],s(e)}return!1}))},H=T(d.getDisplayedElementId(),d.displayedElementMicroversionIdAndConfiguration.getKey(),t,i),k=!(H in g);let W=0;const z=!1;for(let e=0;e<x.length&&W<O;e++){S(d.getDisplayedElementId(),x[e],t,i)in p&&W++}if(k||W>0||G>0){v.getDecalComponent().removeFromScene();for(const e in u.sketchComponent.sketchToSketchEntityMapping)u.imageComponent.onSketchHidden(e);u.planeComponent.getHideableFeatureIds().forEach((function(e){u.planeComponent.hideShowFeature(e,s.Visibility.HIDDEN)}));const t=u.pointBodyComponent.featureToIds.firstKey();t&&u.pointBodyComponent.hideShowFeature(t,s.Visibility.HIDDEN),u.mateConnectorComponent.getHideableFeatureIds().forEach((function(e){u.mateConnectorComponent.hideShowFeature(e,s.Visibility.HIDDEN)})),e.getEdgePointController()&&(e.getEdgePointController().removeAllEdgePointUiElements((0,a.getSelectionList)()),e.getEdgePointController().purgeEdgePointUiElements()),L=(0,s.saveAndClearState)(),e.viewController.setStandardView("Trimetric")}const j=P(e),X=h.vec4.fromValues(0,0,2*t,2*i),q=[1,1,2*t-2,2*i-2];e.setBaseFrameBuffer(R),e.renderContext.pushViewport(X),e.getCamera().setViewport(X),R.update(e.renderContext,X[2],X[3]);const Y=R.width*R.height*4,Z=new Uint8Array(Y);if(R.bindBuffer(),k&&(e.getCamera().zoomToFit(j,1.05,q),e.draw(),A.readPixels(0,0,R.width,R.height,A.RGBA,A.UNSIGNED_BYTE,Z),E(H,C(R.width,R.height,Z,2))),W>0||G>0){for(let e=0;e<F.length;e++)for(let t=0;t<u.components.length;++t)u.components[t].hasFeature(F[e])&&(F[e]in u.sketchComponent.sketchToSketchEntityMapping?u.hideSketch(F[e]):u.components[t].hideShowFeature(F[e],s.Visibility.HIDDEN));for(const e in v.partStudioBodyIdToOccurrenceId)v.setBodyCullingState(v.partStudioBodyIdToOccurrenceId[e],s.CullingState.CULLED,e,z);e.getBodyManager().setVisible(!1)}if(W>0){e.viewController.setStandardView("Trimetric");let n=0;for(let r=0;r<x.length&&n<O&&(0,s.getTimeElapsed)(y)<_;r++){const a=S(d.getDisplayedElementId(),x[r],t,i);if(a in p){const t=v.retrieveBodyMetaData(x[r]);let i=[];t.isOpenCompositeBody?i=v.getInstantiableConstituentIds(t):i.push(x[r]);let o=null;if(t.isComposite){o=[];for(let e=0;e<t.constituentBodyIds.length;++e){v.bodyToEntity.get(t.constituentBodyIds[e])&&(o=o.concat(v.bodyToEntity.get(t.constituentBodyIds[e]).getKeys()))}}else o=v.bodyToEntity.get(x[r]).getKeys();for(let e=0;e<i.length;++e)v.setBodyCullingState(v.partStudioBodyIdToOccurrenceId[i[e]],s.CullingState.VISIBLE,i[e],z),v.hideShowBody(i[e],s.Visibility.VISIBLE,v.partStudioBodyIdToOccurrenceId[i[e]]);const c=2,l=1;e.getCamera().zoomToFit(V.bind(void 0,v,o,c),l,q),e.draw(0,{skipUpdateBodyCulling:!0}),A.readPixels(0,0,R.width,R.height,A.RGBA,A.UNSIGNED_BYTE,Z),E(a,C(R.width,R.height,Z,2));for(let e=0;e<i.length;++e)v.setBodyCullingState(v.partStudioBodyIdToOccurrenceId[i[e]],s.CullingState.CULLED,i[e],z);delete p[a],n++}}}if(G>0)for(let n=0;n<U.length&&!((0,s.getTimeElapsed)(y)>=_);++n){const r=U[n],a=M.computedData[r];if(a&&a.planeMatrix){let n;const o=D.featureToIds.get(r);if(o&&(n=o.getKeys()),!n)continue;const c=f(d.getDisplayedElementId(),r,t,i);u.sketchComponent.hideShowFeature(r,s.Visibility.VISIBLE);const l=a.planeMatrix,h=[l.m00,l.m10,l.m20,0,l.m01,l.m11,l.m21,0,l.m02,l.m12,l.m22,0,0,0,0,1],g=e.getCamera().clone();g.setFrame(h),e.getCamera().copyFrom(g),e.getCamera().zoomToFit(V.bind(void 0,D,n,1),1.05,q),e.draw(0,{skipUpdateBodyCulling:!0}),A.readPixels(0,0,R.width,R.height,A.RGBA,A.UNSIGNED_BYTE,Z),E(c,C(R.width,R.height,Z,2)),u.sketchComponent.hideShowFeature(r,s.Visibility.HIDDEN)}}e.setBaseFrameBufferToDefault(),R.unbindBuffer(),R.destroy(),e.renderContext.popViewport(),e.getCamera().copyFrom(b),e.viewManipulator&&e.viewManipulator.show(),e.detailManager.setOverrideSettings(null),e.setRenderingMode(N),e.setPrimaryViewController(w),e.getBodyManager().setVisible(!0),L&&(0,s.loadState)(L),(0,s.setOrderIndependentTransparencyEnabled)(B),c.LeaderFollowController.resumeListeningForRedraw();const K=(0,s.getTimeInMilliseconds)();m={},e.getEventDispatcher().trigger(s.DID_RENDER_THUMBNAILS),o.log.trace("thumbnailgenerator.generateThumbnail time "+(K-y))}},487747:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.Triad=t.RotationComponentToAxesIndexMap=void 0;const s=i(545348),n=i(713289),r=i(499432),a=i(114924),o=i(264292),c=i(613199),l=s.default.getManager();t.RotationComponentToAxesIndexMap=new Map([[r.ComponentNames.X_ROTATION.toString(),r.OriginAxesIndex.X],[r.ComponentNames.Y_ROTATION.toString(),r.OriginAxesIndex.Y],[r.ComponentNames.Z_ROTATION.toString(),r.OriginAxesIndex.Z]]);const h=[{zeroAngle:[0,1,0],axis:[1,0,0]},{zeroAngle:[0,0,1],axis:[0,1,0]},{zeroAngle:[1,0,0],axis:[0,0,1]}],d=[r.ComponentNames.X_ROTATION,r.ComponentNames.Y_ROTATION,r.ComponentNames.Z_ROTATION],u=[[1,0,0],[0,1,0],[0,0,1]],g=[r.ComponentNames.X_DIRECTION,r.ComponentNames.Y_DIRECTION,r.ComponentNames.Z_DIRECTION],p=[[[1,0,0],[0,1,0]],[[1,0,0],[0,0,1]],[[0,1,0],[0,0,1]]],m=[r.ComponentNames.XY_PLANE,r.ComponentNames.XZ_PLANE,r.ComponentNames.YZ_PLANE],E=[{zeroAngle:[0,0,1],axis:[1,0,0]},{zeroAngle:[0,0,1],axis:[0,1,0]}],I=[r.ComponentNames.X_ROTATION,r.ComponentNames.Y_ROTATION],T=[[0,0,1]],S=[r.ComponentNames.Z_DIRECTION],f=[],C=[],P=[{zeroAngle:[1,0,0],axis:[0,0,1]}],v=[r.ComponentNames.X_ROTATION],D=[[1,0,0],[0,1,0]],M=[r.ComponentNames.X_DIRECTION,r.ComponentNames.Y_DIRECTION],y=[[[1,0,0],[0,1,0]]],O=[r.ComponentNames.XY_PLANE],_=[{scaleDirection:[1,1,0],normal:[0,0,1]}],A=[r.ComponentNames.SCALING];class R extends a.Manipulator{constructor(e,t,i){super(e,i),this.angularDirections=[],this.angularNames=[],this.linearDirections=[],this.linearNames=[],this.planarDirections=[],this.planarNames=[],this.scalingDirections=[],this.scalingNames=[],this.initialTransform=null,this.originalTransform=null,this.childComponents=[],this.scalingPreTransform=null,this.freeDragManipulator=null,this.linearManipulators=[],this.planarManipulators=[],this.angularManipulators=[],this.scalingManipulators=[],this.activeManipulator=null,this.preManipulationAngle=0,this.disableInactiveComponents=!0,this.disabledComponents=new Set,t||(t=n.TriadManipulatorType.FULL),i||(i={displayEditView:!1});let s,c=!0;switch(t){case n.TriadManipulatorType.FULL:this.angularDirections=h,this.angularNames=d,this.linearDirections=u,this.linearNames=g,this.planarDirections=p,this.planarNames=m;break;case n.TriadManipulatorType.PLANE:this.angularDirections=E,this.angularNames=I,this.linearDirections=T,this.linearNames=S,this.planarDirections=f,this.planarNames=C;break;case n.TriadManipulatorType.DRAG:this.angularDirections=[],this.angularNames=[],this.linearDirections=u,this.linearNames=g,this.planarDirections=p,this.planarNames=m,c=!1;break;case n.TriadManipulatorType.SKETCH:this.angularDirections=P,this.angularNames=v,this.linearDirections=D,this.linearNames=M,this.planarDirections=y,this.planarNames=O,this.scalingDirections=_,this.scalingNames=A;break;case n.TriadManipulatorType.EXPLODE_CONVENIENCE_MANIPULATOR:this.angularDirections=h,this.angularNames=d,this.linearDirections=u,this.linearNames=g,this.planarDirections=[],this.planarNames=[],c=!0}this.transform=o.mat4.create(),c&&(this.freeDragManipulator=new a.FreeDrag(this.viewer,i),this.freeDragManipulator.setId(r.ComponentNames.FREE_DRAG),this.freeDragManipulator.setTriadOwnerType(t),this.listenTo(this.freeDragManipulator,n.ManipulatorEvents.VALUE_CHANGED,this.onFreeDragChanged),this.listenTo(this.freeDragManipulator,n.ManipulatorEvents.MANIPULATION_STARTED,this.onFreeDragStarted),this.listenTo(this.freeDragManipulator,n.ManipulatorEvents.MANIPULATION_ENDED,this.onFreeDragEnded),this.childComponents.push(this.freeDragManipulator));const R=this,N=function(e){R.listenTo(R.linearManipulators[e],n.ManipulatorEvents.VALUE_CHANGED,(function(t,i){R.updateFromLinearManipulator(e,i)})),R.listenTo(R.linearManipulators[e],n.ManipulatorEvents.VALUE_EDITED,(function(){R.updateOnEditFromLinearManipulator(e)}))};for(s=0;s<this.linearDirections.length;++s){const e=new a.Linear(this.viewer,i);e.setVisualGap(this.freeDragManipulator?l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX"):0),e.setShaftLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX")),e.setFadeParameters(l.getNumber("MANIPULATOR_TRIAD_LINEAR_FADE_ANGLE_START"),l.getNumber("MANIPULATOR_TRIAD_LINEAR_FADE_ANGLE_END")),e.setId(this.linearNames[s]),e.setTriadOwnerType(t),this.linearManipulators.push(e),this.childComponents.push(e),N(s)}const w=function(e){R.listenTo(R.planarManipulators[e],n.ManipulatorEvents.VALUE_CHANGED,(function(t,i){R.updateFromPlanarManipulator(e,i)}))};for(s=0;s<this.planarDirections.length;++s){const e=new a.Planar(this.viewer,i);e.setVisualGap(l.getNumber("MANIPULATOR_TRIAD_PLANAR_OFFSET_PX")),e.setSideLength(l.getNumber("MANIPULATOR_TRIAD_PLANAR_SIDE_LENGTH_PX")),e.setId(this.planarNames[s]),e.setTriadOwnerType(t),this.planarManipulators.push(e),this.childComponents.push(e),w(s)}const b=function(e){R.listenTo(R.angularManipulators[e],n.ManipulatorEvents.VALUE_CHANGED,(function(){R.updateFromAngularManipulator(e)})),R.listenTo(R.angularManipulators[e],n.ManipulatorEvents.CACHE_TRANSFORM,(function(){R.initialTransform=o.mat4.clone(R.transform)})),R.listenTo(R.angularManipulators[e],n.ManipulatorEvents.VALUE_EDITED,(function(){R.updateOnEditFromAngularManipulator(e)}))},L=l.getNumber("MANIPULATOR_TRIAD_ANGULAR_GAP_PX")+l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX")+l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX")+l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX");for(s=0;s<this.angularDirections.length;++s){const e=new a.Angular(this.viewer,i);e.setRadialOffset(L),e.setFadeParameters(l.getNumber("MANIPULATOR_TRIAD_ANGULAR_FADE_ANGLE_START"),l.getNumber("MANIPULATOR_TRIAD_ANGULAR_FADE_ANGLE_END")),e.setId(this.angularNames[s]),e.setTriadOwnerType(t),this.angularManipulators.push(e),this.childComponents.push(e),b(s)}const B=function(e){R.listenTo(R.scalingManipulators[e],n.ManipulatorEvents.VALUE_CHANGED,(function(t,i){R.updateFromScalingManipulator(e,i)})),R.listenTo(R.scalingManipulators[e],n.ManipulatorEvents.VALUE_EDITED,(function(){R.updateOnEditFromScalingManipulator(e)}))};for(s=0;s<this.scalingDirections.length;++s){const e=new a.ScalingManipulator(this.viewer,i);e.setGapLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX")*Math.sqrt(2)),e.setHeadLength(l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX")),e.setId(this.scalingNames[s]),e.setTriadOwnerType(t),this.scalingManipulators.push(e),this.childComponents.push(e),B(s)}for(s=0;s<this.childComponents.length;++s)this.listenTo(this.childComponents[s],n.ManipulatorEvents.MANIPULATION_STARTED,this.onManipulationStarted),this.listenTo(this.childComponents[s],n.ManipulatorEvents.MANIPULATION_ENDED,this.onManipulationEnded),this.listenTo(this.childComponents[s],a.UiEvents.COMMAND,this.onCommand),this.listenTo(this.childComponents[s],n.ManipulatorEvents.CLICKED,this.onManipulatorClicked),this.listenTo(this.childComponents[s],n.ManipulatorEvents.DOUBLE_CLICKED,this.onManipulatorDoubleClicked);this.preManipulationTransform=o.mat4.clone(this.transform),this.updateComponentManipulators()}onDevicePixelRatioChanged(e){for(let e=0;e<this.planarManipulators.length;++e)this.planarManipulators[e].setVisualGap(l.getNumber("MANIPULATOR_TRIAD_PLANAR_OFFSET_PX")),this.planarManipulators[e].setSideLength(l.getNumber("MANIPULATOR_TRIAD_PLANAR_SIDE_LENGTH_PX"));for(let e=0;e<this.linearManipulators.length;++e)this.linearManipulators[e].setVisualGap(this.freeDragManipulator?l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX"):0),this.linearManipulators[e].setShaftLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX"));const t=l.getNumber("MANIPULATOR_TRIAD_ANGULAR_GAP_PX")+l.getNumber("MANIPULATOR_FREE_DRAG_RADIUS_PX")+l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX")+l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX");for(let e=0;e<this.angularManipulators.length;++e)this.angularManipulators[e].setRadialOffset(t);for(let e=0;e<this.scalingManipulators.length;++e)this.scalingManipulators[e].setGapLength(l.getNumber("MANIPULATOR_TRIAD_LINEAR_SHAFT_LENGTH_PX")),this.scalingManipulators[e].setHeadLength(l.getNumber("MANIPULATOR_LINEAR_HEAD_LENGTH_PX"))}remove(){super.remove();for(let e=0;e<this.childComponents.length;++e)this.childComponents[e].remove()}setIsEnabled(e){for(let t=0;t<this.childComponents.length;++t)this.childComponents[t].setIsEnabled(e)}setDisableInactiveComponents(e){this.disableInactiveComponents=e}setIsLocked(e){this.freeDragManipulator&&this.freeDragManipulator.setIsLocked(e)}onManipulationStarted(e){if(this.preManipulationTransform=o.mat4.clone(this.transform),this.initialTransform||(this.initialTransform=o.mat4.clone(this.transform)),this.originalTransform||(this.originalTransform=o.mat4.clone(this.transform)),this.activeManipulator=e,e!==this.freeDragManipulator&&this.disableInactiveComponents)for(let t=0;t<this.childComponents.length;++t)this.childComponents[t].setIsEnabled(e===this.childComponents[t]);for(let t=0;t<this.scalingManipulators.length;++t)this.scalingManipulators[t]!==e?(this.scalingManipulators[t].resetScale(),this.scalingPreTransform=void 0):this.scalingPreTransform||(this.scalingPreTransform=o.mat4.clone(this.transform));if(e instanceof a.Linear||e instanceof a.Planar)this.trigger(r.TriadEvents.TRANSLATION_START);else if(e instanceof a.Angular){const t=e.getAxis().direction;this.preManipulationAngle=e.getAngle();const i=[this.transform[12],this.transform[13],this.transform[14]];this.trigger(r.TriadEvents.ROTATION_START,i,t)}else e instanceof a.ScalingManipulator&&this.trigger(r.TriadEvents.SCALING_START);this.trigger(n.ManipulatorEvents.MANIPULATION_STARTED)}onManipulationEnded(){this.activeManipulator instanceof a.Angular?this.trigger(r.TriadEvents.ROTATION_END,this.transform):this.activeManipulator instanceof a.Linear||this.activeManipulator instanceof a.Planar?this.trigger(r.TriadEvents.TRANSLATION_END,this.transform):this.activeManipulator instanceof a.ScalingManipulator&&this.trigger(r.TriadEvents.SCALING_END),this.activeManipulator=null,this.preManipulationAngle=0;for(let e=0;e<this.childComponents.length;++e)this.disabledComponents.has(this.childComponents[e].getId())||this.childComponents[e].setIsEnabled(!0);this.updateComponentManipulators(),this.trigger(n.ManipulatorEvents.MANIPULATION_ENDED)}onCommand(e,t){if(t&&e){const i=[];i[r.OriginAxesIndex.Origin]=[this.transform[12],this.transform[13],this.transform[14]],i[r.OriginAxesIndex.X]=[this.transform[0],this.transform[1],this.transform[2]],i[r.OriginAxesIndex.Y]=[this.transform[4],this.transform[5],this.transform[6]],i[r.OriginAxesIndex.Z]=[this.transform[8],this.transform[9],this.transform[10]],this.trigger(r.TriadEvents.COMMAND,e,t.getId(),i)}}onManipulatorClicked(e){this.trigger(n.ManipulatorEvents.CLICKED,e)}onManipulatorDoubleClicked(e,t){this.trigger(r.TriadEvents.DOUBLE_CLICKED,e,t)}updateDefinition(e){this.transform=e,this.updateComponentManipulators()}getTranslationSinceManipulationBegan(){return c.vec4C.subtract(c.mat4C.multiplyVec4(this.transform,[0,0,0,1]),c.mat4C.multiplyVec4(this.preManipulationTransform,[0,0,0,1]))}getMouseRayForFreeDrag(){return this.activeManipulator instanceof a.FreeDrag?this.activeManipulator.getLastMouseRay():null}getActiveRotationAxis(){return this.activeManipulator instanceof a.Angular?this.activeManipulator.getAxis():null}getActiveRotationZeroAngleDirection(){return this.activeManipulator instanceof a.Angular?this.activeManipulator.getZeroAngleDirection():null}getActiveRotationAngle(){return this.activeManipulator instanceof a.Angular?this.activeManipulator.getAngle():0}setActiveRotationAngle(e){if(this.activeManipulator instanceof a.Angular){this.activeManipulator.setAngle(e);const t=c.mat4C.rotate(o.mat4.create(),e,this.activeManipulator.getAxis().direction),i=c.mat4C.toMat3(this.preManipulationTransform);c.mat3C.multiply(c.mat4C.toMat3(t),i,i);for(let e=0;e<3;++e){const t=c.vec3C.normalize([i[3*e+0],i[3*e+1],i[3*e+2]]);this.transform[4*e+0]=t[0],this.transform[4*e+1]=t[1],this.transform[4*e+2]=t[2]}this.updateComponentManipulators()}}updateFromLinearManipulator(e,t){this.updateOrigin(this.linearManipulators[e].getOffsetPosition()),this.trigger(r.TriadEvents.TRANSLATION_CHANGE,this.getTranslationSinceManipulationBegan(),this.linearManipulators[e],t)}updateOnEditFromLinearManipulator(e){const t=this.linearManipulators[e],i=c.vec3C.subtract(t.getEditOffsetPosition(),t.ray.point,o.vec3.create()),s=o.vec4.fromValues(i[0],i[1],i[2],0);this.updateOrigin(t.getEditOffsetPosition()),this.trigger(r.TriadEvents.TRANSLATION_EDIT,s)}updateFromPlanarManipulator(e,t){this.updateOrigin(this.planarManipulators[e].getOffsetPosition()),this.trigger(r.TriadEvents.TRANSLATION_CHANGE,this.getTranslationSinceManipulationBegan(),this.planarManipulators[e],t)}processUpdateFromAngularManipulator(e,t,i){const s=c.mat4C.rotate(o.mat4.create(),i,this.angularManipulators[e].getAxis().direction),n=c.mat4C.toMat3(t);c.mat3C.multiply(c.mat4C.toMat3(s),n,n);for(let e=0;e<3;++e)this.transform[4*e+0]=n[3*e],this.transform[4*e+1]=n[3*e+1],this.transform[4*e+2]=n[3*e+2];this.updateComponentManipulators()}updateFromAngularManipulator(e){this.processUpdateFromAngularManipulator(e,this.preManipulationTransform,this.angularManipulators[e].getAngle()),this.trigger(r.TriadEvents.ROTATION_CHANGE,this.getActiveRotationAngle(),this.getActiveRotationAxis(),this.getActiveRotationZeroAngleDirection())}updateOnEditFromAngularManipulator(e){const t=this.angularManipulators[e],i=t.getAxis().direction,s=[this.transform[12],this.transform[13],this.transform[14]],n=o.mat4.clone(this.transform),a=t.getEditAngleDisplacement();this.processUpdateFromAngularManipulator(e,this.initialTransform,t.getEditAngle()),this.trigger(r.TriadEvents.ROTATION_EDIT,n,a,i,s)}processScalingTransform(e,t){const i=o.mat4.fromValues(e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);this.transform=c.mat4C.multiply(t,i,o.mat4.create())}updateFromScalingManipulator(e,t){this.processScalingTransform(this.scalingManipulators[e].getScale(),this.scalingPreTransform),this.trigger(r.TriadEvents.SCALING_CHANGE)}updateOnEditFromScalingManipulator(e){this.processScalingTransform(this.scalingManipulators[e].getScale(),this.scalingPreTransform),this.trigger(r.TriadEvents.SCALING_EDIT)}updateOrigin(e){for(let t=0;t<3;++t)this.transform[12+t]=e[t];this.updateComponentManipulators()}getOrigin(){return[this.transform[12],this.transform[13],this.transform[14]]}getOriginalOrigin(){return o.vec3.fromValues(this.originalTransform[12],this.originalTransform[13],this.originalTransform[14])}onFreeDragStarted(){this.trigger(r.TriadEvents.REPOSITION_START,this.transform)}onFreeDragChanged(e,t,i,s){this.updateOrigin(e),this.trigger(r.TriadEvents.REPOSITION,t,i,this.transform,s)}onFreeDragEnded(){this.trigger(r.TriadEvents.REPOSITION_END,this.transform)}updateComponentManipulators(){const e=o.vec3.fromValues(this.transform[12],this.transform[13],this.transform[14]);let t;this.freeDragManipulator&&(this.freeDragManipulator!==this.activeManipulator||this.freeDragManipulator.getIsLocked())&&this.freeDragManipulator.updateDefinition(e);const i=c.mat4C.toMat3(this.transform);for(t=0;t<this.linearManipulators.length;++t)if(this.linearManipulators[t]!==this.activeManipulator||this.linearManipulators[t].getIsLocked()){const s=c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.linearDirections[t],o.vec3.create()));this.linearManipulators[t].updateDefinition(e,s)}for(t=0;t<this.planarManipulators.length;++t)if(this.planarManipulators[t]!==this.activeManipulator||this.planarManipulators[t].getIsLocked()){const s=c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.planarDirections[t][0],o.vec3.create())),n=c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.planarDirections[t][1],o.vec3.create()));this.planarManipulators[t].updateDefinition(e,s,n,[0,0])}for(t=0;t<this.angularManipulators.length;++t)(this.angularManipulators[t]!==this.activeManipulator||this.angularManipulators[t].getIsLocked())&&this.angularManipulators[t].updateDefinition(e,c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.angularDirections[t].axis,o.vec3.create())),c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.angularDirections[t].zeroAngle,o.vec3.create())),0);for(t=0;t<this.scalingManipulators.length;++t)if(this.scalingManipulators[t]!==this.activeManipulator||this.scalingManipulators[t].getIsLocked()){const s=c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.scalingDirections[t].scaleDirection,o.vec3.create())),n=c.vec3C.normalize(c.mat3C.multiplyVec3(i,this.scalingDirections[t].normal,o.vec3.create()));this.scalingManipulators[t].updateDefinition(e,n,s)}}updateAngleRange(e,t){for(let i=0;i<this.angularManipulators.length;++i)this.angularManipulators[i].updateLimits(e,t)}updateEditAngleRange(e,t){for(let i=0;i<this.angularManipulators.length;++i)this.angularManipulators[i].updateEditLimits(e,t)}reset(e){this.originalTransform&&this.updateDefinition(o.mat4.clone(this.originalTransform));for(let e=0;e<this.linearManipulators.length;++e){const t=this.linearManipulators[e].initialRay;t&&(t.point=this.getOriginalOrigin())}e.removeEditViewAndHighlights()}disableComponent(e){this.disabledComponents.add(e)}disableXYManipulators(){this.linearManipulators.forEach((e=>{e.getId()!==r.ComponentNames.X_DIRECTION&&e.getId()!==r.ComponentNames.Y_DIRECTION||e.setIsEnabled(!1)})),this.angularManipulators.forEach((e=>{e.getId()!==r.ComponentNames.X_ROTATION&&e.getId()!==r.ComponentNames.Y_ROTATION||e.setIsEnabled(!1)})),this.scalingManipulators.forEach((e=>{e.setIsEnabled(!1)})),this.disableComponent(r.ComponentNames.X_DIRECTION),this.disableComponent(r.ComponentNames.Y_DIRECTION),this.disableComponent(r.ComponentNames.X_ROTATION),this.disableComponent(r.ComponentNames.Y_ROTATION)}enableXYManipulators(){this.disabledComponents.clear()}}t.Triad=R},768125:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.fillInDefaultAttributes=t.UIElement=t.NO_SELECTION_ID=t.UiEvents=void 0;const s=i(142885),n=i(545348),r=i(264292),a=i(912057),o=i(114924),c=i(613199),l=n.default.getManager();var h;!function(e){e.MOUSE_ENTER="mouseenter:",e.MOUSE_MOVE="mousemove:",e.MOUSE_LEAVE="mouseleave:",e.DOUBLE_CLICK="doubleclick:",e.CLICK="click:",e.DRAG_START="dragstart:",e.DRAG="drag:",e.DRAG_STOP="dragstop:",e.SELECT="select:",e.DESELECT="deselect:",e.COMMAND="command:",e.LONG_PRESS_START="longpressstart:",e.LONG_PRESS_END="longpressend:",e.XR_DRAG_START="xrdragstart:",e.XR_DRAG="xrdrag:",e.XR_DRAG_STOP="xrdragstop:"}(h||(t.UiEvents=h={})),t.NO_SELECTION_ID="";const d=new o.IdManager;class u{constructor(e,i){this.nodeProperties=e,this.meshIncrement=i,this.selectionId=t.NO_SELECTION_ID}}class g extends s.BackboneEventsBaseClass{constructor(e,t){super(),this.viewer=e,this.SHARED_DELETION_DETAILS={wasHidden:!1,wasHiddenFromPick:!1,highlights:null},this.nameToMeshIncrement={},this.isHidden=!1,this.isTransparent=!1,this.transform=null,this.normalTransform=null,this.isBeingDragged=!1,this.id="",this.incrementRanges={},this.highlights=[],this.allocatedHighlights=[],this.hasBeenRemoved=!1,this.removeHighlightFromOccurrence=function(e){const t=""+this.graphicsOccurrenceId;let i=null,s=-1;for(let n=0;n<this.allocatedHighlights.length;++n){const r=this.allocatedHighlights[n];if(r.selectionId===t&&e===r.highlightType){i=r,s=n;break}}if(!i)return;this.allocatedHighlights.splice(s,1);const n=this.viewer.getHighlightManager(this.getUsage()),r=n.freeHighlightForSelection(i.highlightType,i.selectionId);if((0,o.idIsValid)(r)){const t=n.constructHighlightForTypeAndInstance(e,r);this.occurrenceData.updateOccurrenceHighlight(o.Action.REMOVE,t,this.getUsage())}},(0,o.viewerCheck)(e),this.sceneGraphId=t||o.MAIN_SCENEGRAPH_ID,this.collectionId=o.COLLECTION_ID_PREFIX+d.getId(),this.graphicsOccurrenceId=this.viewer.getOccurrenceIdManager().getOrCreateIdForName(this.collectionId),this.meshOwnerId=(0,o.getNewOwnerId)(),this.occurrenceData=this.viewer.getOccurrenceDataManager().setOccurrenceTransform(this.graphicsOccurrenceId,r.mat4.create()),this.idManager=new o.NamedIdManager(o.IdSizes.ENTITY),this.viewer.addUIElement(this),this.listenTo(this.viewer.getEventDispatcher(),o.DEVICE_PIXEL_RATIO_CHANGED,this.onDevicePixelRatioChanged),this.occurrenceData.setIsolated(!0),this.occurrenceData.setCanIsolateChange(!1)}getDebugId(){return"UIElement"}getOccurrenceData(){return this.occurrenceData}setIsolated(e){this.occurrenceData.setIsolated(e)}onDevicePixelRatioChanged(e){}onAppearanceConstantsUpdated(){}remove(){this.hasBeenRemoved?a.log.warn("Attempted to remove ui element "+this.getDebugId()+"-"+this.meshOwnerId+" multiple times"):(this.hasBeenRemoved=!0,this.stopListening(),this.viewer&&this.viewer.removeUIElement(this),this.viewer.getOccurrenceDataManager().destroyOccurrenceData(this.graphicsOccurrenceId),this.viewer.getOccurrenceIdManager().removeName(this.collectionId),this.removeMeshIncrements(),this.freeAllocatedHighlights())}freeAllocatedHighlights(){const e=this.viewer.getHighlightManager(this.getUsage());for(let t=0;t<this.allocatedHighlights.length;++t){const i=this.allocatedHighlights[t];e.freeHighlightForSelection(i.highlightType,i.selectionId)}}getMeshManager(){return this.viewer.getUiResourceManager().getMeshManager()}getNode(){return this.viewer.getUiResourceManager().getNode(this.sceneGraphId)}getCollectionId(){return this.collectionId}removeMeshIncrements(){for(const e in this.nameToMeshIncrement)this.removeMeshIncrement(e);this.nameToMeshIncrement={},this.viewer.requestDraw()}hasMeshIncrements(){return!(0,o.isMapEmpty)(this.nameToMeshIncrement)}containsMeshIncrementWithName(e){return this.nameToMeshIncrement.hasOwnProperty(e)}getInstantiatedMeshIncrement(e){return this.nameToMeshIncrement[e]||null}shouldBeClearedWithSelections(){return!0}getId(){return this.id}setId(e){this.id=e}isVisibleToUser(){return!this.isTransparent&&!this.isHidden}hideIncrements(){for(const e in this.nameToMeshIncrement)this.hideInstantiatedMeshIncrement(e,this.nameToMeshIncrement[e])}showIncrements(){for(const e in this.nameToMeshIncrement)this.showInstantiatedMeshIncrement(e,this.nameToMeshIncrement[e])}hideIncrement(e){const t=this.nameToMeshIncrement[e];t&&this.hideInstantiatedMeshIncrement(e,t)}showIncrement(e){const t=this.nameToMeshIncrement[e];t&&this.showInstantiatedMeshIncrement(e,t)}hide(){(0,o.viewerCheck)(this.viewer),this.isVisibleToUser()&&this.hideIncrements(),this.isHidden=!0,this.viewer.requestDraw()}show(){(0,o.viewerCheck)(this.viewer);const e=this.isVisibleToUser();this.isHidden=!1,!e&&this.isVisibleToUser()&&this.showIncrements(),this.viewer.requestDraw()}makeTransparent(){this.isVisibleToUser()&&this.hideIncrements(),this.isTransparent=!0}makeOpaque(){const e=this.isVisibleToUser();this.isTransparent=!1,!e&&this.isVisibleToUser()&&this.showIncrements()}isInteractionEnabled(){return!0}getClearModelSelectionsOnPrehilite(){return!0}getTransform(){return this.transform}setTransform(e){e?(this.transform=r.mat4.clone(e),this.viewer.getOccurrenceDataManager().setOccurrenceTransform(this.graphicsOccurrenceId,e)):(this.transform=null,this.viewer.getOccurrenceDataManager().setOccurrenceTransform(this.graphicsOccurrenceId,r.mat4.create()))}transformPoint(e){return this.transform?c.mat4C.multiplyVec3(this.transform,e,r.vec3.create()):r.vec3.clone(e)}getSelection(e,t){if(this.graphicsOccurrenceId!==e)return a.log.warn("An attempt was made to get a selection from a ui element with the wrong occurrence id"),null;const i=this.idManager.getNameForId(t);if(!i)return null;const s=this.nameToMeshIncrement[i];return s?new o.UISelection(this,s.selectionId,i):null}canPickThrough(){return!1}getModelSelection(e){return null}getPickPriority(e){return null}getUsage(){return o.BTGraphicsUsage.BASE}setIncrementPickId(e,t){t.pickId=this.idManager.getOrCreateIdForName(e)}updateMeshIncrement(e,t,i,s){if(!s)return;p(i);const n=this.removeMeshIncrement(e);i.id=e,this.setIncrementPickId(e,i);const r=new u(s,i);r.selectionId=t;const a=this.getMeshManager().addMeshIncrement(i,this.meshOwnerId);if(a){let e=this.incrementRanges[s.id];if(!e){this.incrementRanges[s.id]=e=new o.IncrementRanges(this.getDebugId()+" - "+s.toString(!0));const t=new o.Style;this.getNode().addOccurrenceGeometryToNode(s,this.occurrenceData,t,e)}e.onIncrementAdded(a)}this.nameToMeshIncrement[e]=r,n&&(n.wasHidden&&this.hideIncrement(e),n.wasHiddenFromPick&&this.hideIncrementFromPick(e),n.highlights&&n.highlights.forEach((t=>{this.addHighlightToIncrement(e,t)}))),this.viewer.requestDraw()}updateIncrementAttribute(e,t,i){const s=this.nameToMeshIncrement[e];if(s){const e=this.getMeshManager().getMeshForIncrement(s.meshIncrement);e&&e.updateIncrementAttribute(t,s.meshIncrement.getFullId(),i)}}removeMeshIncrement(e){const t=this.nameToMeshIncrement[e];let i=null;return t&&(i=this.removeInstantiatedMeshIncrement(e,t),this.viewer.requestDraw()),i}removeInstantiatedMeshIncrement(e,t){this.idManager.removeName(e);const i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId),s=this.SHARED_DELETION_DETAILS;if(i){const e=this.getUsage();s.wasHidden=this.occurrenceData.isIncrementHidden(i,e),s.wasHiddenFromPick=this.occurrenceData.isIncrementHiddenFromPick(i,e),s.highlights=this.occurrenceData.getEntityHighlights(i,e),s.highlights&&this.occurrenceData.removeEntityHighlights(i,e)}else s.wasHidden=!1,s.wasHiddenFromPick=!1,s.highlights=null;if(this.getMeshManager().removeMeshIncrement(e,this.meshOwnerId),i){const e=this.incrementRanges[t.nodeProperties.id];e&&(e.onIncrementRemoved(i),e.isEmpty()&&(this.getNode().removeOccurrenceFromNode(t.nodeProperties,this.graphicsOccurrenceId),delete this.incrementRanges[t.nodeProperties.id]))}return delete this.nameToMeshIncrement[e],s}hideInstantiatedMeshIncrement(e,t){const i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.hideIncrement(i,this.getUsage())}showInstantiatedMeshIncrement(e,t){const i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.showIncrement(i,this.getUsage())}hideIncrementFromPick(e){const t=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);t&&this.occurrenceData.hideIncrementFromPick(t,this.getUsage())}addHighlight(e){(0,o.addHighlightToList)(e,this.highlights)}removeHighlight(e){return(0,o.removeHighlightFromList)(e,this.highlights,!1)>=0}isHighlighted(){return this.highlights.length>0}getHighlight(){return this.isHighlighted()?this.highlights[this.highlights.length-1]:null}triggerMouseEnter(e,t){this.isBeingDragged||this.trigger(h.MOUSE_ENTER+e.selectionId,e,t)}triggerMouseMove(e,t){this.isBeingDragged||this.trigger(h.MOUSE_MOVE+e.selectionId,e,t)}triggerMouseLeave(e,t){this.isBeingDragged||this.trigger(h.MOUSE_LEAVE+e.selectionId,e,t)}triggerClick(e,t){const i={requestSelectedStatus:!1};return this.trigger(h.CLICK+e.selectionId,e,t,i),i.requestSelectedStatus}triggerDoubleClick(e,t){const i={requestSelectedStatus:!1};return this.trigger(h.DOUBLE_CLICK+e.selectionId,e,t,i),i.requestSelectedStatus}triggerSelect(e){this.trigger(h.SELECT+e.selectionId,e)}triggerDeselect(e){this.trigger(h.DESELECT+e.selectionId,e)}triggerDragStart(e,t){const i={requestDrag:!1};return this.trigger(h.DRAG_START+e.selectionId,e,t,i),this.isBeingDragged=i.requestDrag,i.requestDrag}triggerDrag(e,t){this.trigger(h.DRAG+e.selectionId,e,t)}triggerDragStop(e,t){this.trigger(h.DRAG_STOP+e.selectionId,e,t),this.isBeingDragged=!1}triggerXrDragStart(e,t){const i={requestDrag:!1};return this.trigger(h.XR_DRAG_START+e.selectionId,e,t,i),this.isBeingDragged=i.requestDrag,i.requestDrag}triggerXrDrag(e,t){this.trigger(h.XR_DRAG+e.selectionId,e,t)}triggerXrDragStop(e,t){this.trigger(h.XR_DRAG_STOP+e.selectionId,e,t),this.isBeingDragged=!1}triggerLongPressStart(e,t){this.trigger(h.LONG_PRESS_START+e.selectionId,e,t)}triggerLongPressEnd(e,t){this.trigger(h.LONG_PRESS_END+e.selectionId,e,t)}addHighlightToIncrement(e,t){const i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.updateEntityHighlight(o.Action.ADD,t,i,this.getUsage())}removeHighlightFromIncrement(e,t){const i=this.getMeshManager().getIncrementDetails(e,this.meshOwnerId);i&&this.occurrenceData.updateEntityHighlight(o.Action.REMOVE,t,i,this.getUsage())}addNewHighlightToIncrement(e,t){const i=e+"."+this.graphicsOccurrenceId,s=this.viewer.getHighlightManager(this.getUsage()).createHighlightForSelection(t,i);return this.addHighlightToIncrement(e,s),this.allocatedHighlights.push({selectionId:i,highlightType:t}),s}addNewHighlightToOccurrence(e){const t=""+this.graphicsOccurrenceId,i=this.viewer.getHighlightManager(this.getUsage()).createHighlightForSelection(e,t);this.occurrenceData.updateOccurrenceHighlight(o.Action.ADD,i,this.getUsage()),this.allocatedHighlights.push({selectionId:t,highlightType:e})}preventsSketching(){return!0}getFitBounds(){return null}onViewWillDraw(e,t){}isViewManipulator(){return!1}onDefaultUnitsChanged(e){}onIsolateChanged(){}isDimension(){return!1}isManipulator(){return!1}onHighlightColorUpdated(){}}function p(e){if(e.primitiveType===o.PrimitiveType.TRIANGLES||e.primitiveType===o.PrimitiveType.TRIANGLE_STRIP){if(e.colors||(0,o.addColorToIncrement)(l.getColor("DEFAULT_TRIANGLE_COLOR"),e),!e.textureCoordinates){const t=[0,0];(0,o.addTextureCoordinateToIncrement)(t,e)}e.normals||(0,o.addNormalToIncrement)([0,0,1],e)}else e.primitiveType===o.PrimitiveType.LINES?(e.colors||(0,o.addColorToIncrement)(l.getColor("DEFAULT_MATERIAL_COLOR"),e),e.primitiveSizes||(0,o.addSizeToIncrement)(l.getNumber("DEFAULT_LINE_WIDTH"),e),e.primitiveStyles||(0,o.addStyleToIncrement)(l.getStipple("DEFAULT_LINE_STIPPLE"),e)):e.primitiveType===o.PrimitiveType.POINTS&&(e.colors||(0,o.addColorToIncrement)(l.getColor("DEFAULT_MATERIAL_COLOR"),e),e.primitiveSizes||(0,o.addSizeToIncrement)(l.getNumber("DEFAULT_POINT_SIZE"),e),e.primitiveStyles||(0,o.addStyleToIncrement)(l.getPointFont("DEFAULT_POINT_FONT"),e))}t.UIElement=g,t.fillInDefaultAttributes=p},54858:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.isOccurrenceNameForUi=t.COLLECTION_ID_PREFIX=void 0,t.COLLECTION_ID_PREFIX="uielement.",t.isOccurrenceNameForUi=function(e){return!!e&&0===e.indexOf(t.COLLECTION_ID_PREFIX)}},176446:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ResourceManager=void 0;const s=i(114924);t.ResourceManager=class{constructor(e,t){this.viewer=e,this.sceneGraphs=t,this.nodes={},this.meshManager=new s.MeshManager(this.viewer,{bufferAllocationPolicy:s.BufferAllocationPolicy.MEDIUM}),this.onSessionEnded=()=>{this.meshManager.destroy(),this.viewer.getEventDispatcher().off(s.SESSION_ENDED,this.onSessionEnded)},this.viewer.getEventDispatcher().on(s.SESSION_ENDED,this.onSessionEnded)}getMeshManager(){return this.meshManager}getNode(e){if(!this.nodes[e]){const t=new s.Node("uinode");this.nodes[e]=t,this.sceneGraphs.getSceneGraph(e).getRootNode().addChild(t)}return this.nodes[e]}destroyPreviewGraphics(){delete this.nodes[s.PREVIEW_SCENEGRAPH_ID]}clean(){this.meshManager.removeEmptyMeshes();for(const e in this.nodes)this.nodes[e].cleanEmptyMeshNodes()}}},950704:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.UISelectionManager=t.UISelection=void 0;const s=i(193786);t.UISelection=class{constructor(e,t,i){this.selectionId=t,this.meshIncrementId=i,this.sourcePick=null,this.uiElement=e}equals(e){return!!e&&(this.uiElement===e.uiElement&&this.selectionId===e.selectionId)}hideFromPick(){this.uiElement.hideIncrementFromPick(this.meshIncrementId)}canPickThrough(){return this.uiElement.canPickThrough()}getModelSelection(){return this.uiElement.getModelSelection(this)}getPickPriority(){return this.uiElement.getPickPriority(this)}isInteractionEnabled(){return this.uiElement.isInteractionEnabled()}preventsSketching(){return this.uiElement.preventsSketching()}};t.UISelectionManager=class{constructor(){this.hoveredSelection=null,this.selection=null}removeSelectionForUiElement(e){this.hoveredSelection&&this.hoveredSelection.uiElement===e&&(this.hoveredSelection.uiElement.triggerMouseLeave(this.hoveredSelection,{}),this.hoveredSelection=null),this.selection&&this.selection.uiElement===e&&(this.selection=null)}reset(){this.hoveredSelection=null,this.selection=null}getHoveredSelection(){return this.hoveredSelection}isHoveringOverViewManipulator(){return!!this.hoveredSelection&&!!this.hoveredSelection.uiElement&&this.hoveredSelection.uiElement.isViewManipulator()}getSelection(){return this.selection}uiSelectionShouldBeClearedWithSelections(){return!!this.selection&&!!this.selection.uiElement&&!!this.selection.uiElement.shouldBeClearedWithSelections()}overrideHoveredSelection(e){this.hoveredSelection&&e&&this.hoveredSelection.equals(e)||!this.hoveredSelection&&!e||(this.hoveredSelection=e)}setHoveredSelection(e,t){this.hoveredSelection&&e&&this.hoveredSelection.equals(e)||!this.hoveredSelection&&!e?this.hoveredSelection&&this.hoveredSelection.uiElement.triggerMouseMove(this.hoveredSelection,t):(this.hoveredSelection&&(t.nextSelection=e,this.hoveredSelection.uiElement.triggerMouseLeave(this.hoveredSelection,t)),this.hoveredSelection=e,this.hoveredSelection&&this.hoveredSelection.uiElement.triggerMouseEnter(this.hoveredSelection,t))}setSelection(e){(this.selection||e)&&(this.selection&&this.selection.uiElement.triggerDeselect(this.selection),e&&e.equals(this.selection)?this.selection=null:(this.selection=e,this.selection&&((0,s.getSelectionList)().reset(),this.selection.uiElement.triggerSelect(this.selection))))}processUiPick(e,t){let i=null,s=null,n=!1;e.isUIPick()&&e.uiSelection.isInteractionEnabled()&&(s=e.uiSelection),this.setHoveredSelection(s,t),s&&t.click?n=s.uiElement.triggerClick(s,t):s&&t.doubleClick&&(n=s.uiElement.triggerDoubleClick(s,t)),n&&(i=s);return(t.click||t.doubleClick)&&!(s&&!n)&&this.setSelection(i),!!s}handleEmptyUiPick(e,t){e?this.setHoveredSelection(null,t):t.click&&this.setSelection(null)}}},726759:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getPartstudioElementIdFromContextId=t.getAssemblyInContextElementId=t.getColorStringArray=t.getColorString=t.getHasLongPressHandlerCapability=t.getHasFeatureQLVFacePatternCapability=t.setSubtract=t.arraySubtract=t.concatenateUint8Arrays=t.concatenateFloat32Arrays=t.getTimeElapsed=t.getTimeInMilliseconds=t.convertRGBA255ToRGBA=t.convertRGBToRGBA255=t.convertRGBAToRGBA255=t.isMapEmpty=t.decodeAngle=t.decodeDepth=t.decodeFloat=t.DEPTH_PASS_CLEAR_COLOR=t.UNKNOWN_DEPTH=t.PICK_CLEAR_COLOR=t.decodePickingIndex=t.encodePickingIndex=t.convertIntToUcharArray=t.graphicsTakesSelectionPrecedence=t.isInSectionPlaneMode=t.setIsInSectionPlaneMode=t.isInFollowMode=t.setIsInFollowMode=t.requestDrawForInteractiveProcessing=t.forceRequestDraw=t.requestDraw=t.requestDrawUsingAnimationFrame=t.requestDrawUsingTimer=t.removeDrawer=t.getDrawerForId=t.getDrawer=t.getDrawers=t.addDrawer=t.getTagIntCount=t.isSSAOSupported=t.isHighPrecisionFragmentShaderSupported=t.isSpaceballSupported=t.isOrderIndependentTransparencyEnabled=t.setOrderIndependentTransparencyEnabled=t.CullingState=t.visibilityDescriptor=t.Visibility=t.addDebuggableChild=void 0,t.makeSceneDebugObjectFromObject=t.addChildDebugObjectsFromProperties=t.createTextDebugObject=t.zeroOutArrayBuffer=t.imageCaptureToJpeg=t.flipImageVertically=t.cacheCapabilities=void 0;const s=i(912057),n=i(997687),r=i(573879),a=i(268154),o=i(114924),c=i(545348);t.addDebuggableChild=function(e,t){t&&e.children.push(t.makeSceneDebugObject())};let l=!0;var h,d;function u(e){if(!e)return!1;const t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);return!!t&&t.precision>0}!function(e){e[e.HIDDEN=0]="HIDDEN",e[e.VISIBLE=1]="VISIBLE"}(h||(t.Visibility=h={})),t.visibilityDescriptor=function(e){switch(e){case h.HIDDEN:return"hidden";case h.VISIBLE:return"visible"}return"unknown"},function(e){e[e.CULLED=0]="CULLED",e[e.VISIBLE=1]="VISIBLE"}(d||(t.CullingState=d={})),t.setOrderIndependentTransparencyEnabled=function(e){l=e},t.isOrderIndependentTransparencyEnabled=function(){return l},t.isSpaceballSupported=function(){return(0,a.isPlatformWindows)()||(0,a.isPlatformMac)()},t.isHighPrecisionFragmentShaderSupported=u,t.isSSAOSupported=function(e){if((0,a.isPlatformMac)()){const t=(0,o.getRendererInfo)(e);if(new RegExp(".*intel.*[3|4]000.*","i").test(t.glRenderer))return!1}return u(e)},t.getTagIntCount=function(e){return Math.ceil(e.length/5)};const g={};function p(e){for(const t in g)g[t].requestDrawUsingTimer(null,null,e)}function m(e){for(const t in g)g[t].requestDrawUsingAnimationFrame(null,null,e)}t.addDrawer=function(e,t){g[e]=t},t.getDrawers=function(){return g},t.getDrawer=function(){return(0,o.getActiveViewer)()},t.getDrawerForId=function(e){return g[e]},t.removeDrawer=function(e){delete g[e]},t.requestDrawUsingTimer=p,t.requestDrawUsingAnimationFrame=m;let E=p;function I(e){return E(e)}window.requestAnimationFrame&&(E=m),t.requestDraw=I,t.forceRequestDraw=function(){I(!0)},t.requestDrawForInteractiveProcessing=function(){p()};let T=!1;function S(){return T}t.setIsInFollowMode=function(e,t){T=t},t.isInFollowMode=S;let f=!1;function C(){return f}function P(e,t){let i;return t?(i=(e[2]<<16)+(e[1]<<8)+e[0],i/16777215):(i=(e[1]<<8)+e[0],i/16383)}t.setIsInSectionPlaneMode=function(e){f=e},t.isInSectionPlaneMode=C,t.graphicsTakesSelectionPrecedence=function(){return S()||C()},t.convertIntToUcharArray=function(e){const t=new Uint8Array(4);return t[0]=e>>>24&255,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=255&e,t},t.encodePickingIndex=function(e){const t=1/255;return[(e>>>24&255)*t,(e>>>16&255)*t,(e>>>8&255)*t,(255&e)*t]},t.decodePickingIndex=function(e,t,i,s){return(e<<24)+(t<<16)+(i<<8)+s},t.PICK_CLEAR_COLOR=[0,0,0,0],t.UNKNOWN_DEPTH=-1,t.DEPTH_PASS_CLEAR_COLOR=[1,1,1,0],t.decodeFloat=P,t.decodeDepth=function(e,i){return 255*t.DEPTH_PASS_CLEAR_COLOR[3]===e[3]?t.UNKNOWN_DEPTH:P(e,i)},t.decodeAngle=function(e,t){return 0===e[3]?null:P(e,t)*Math.PI},window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)},t.isMapEmpty=function(e){let t;for(t in e)return!1;return!0},t.convertRGBAToRGBA255=function(e){return[(0,o.clamp)(Math.floor(255*e[0]),0,255),(0,o.clamp)(Math.floor(255*e[1]),0,255),(0,o.clamp)(Math.floor(255*e[2]),0,255),(0,o.clamp)(Math.floor(255*e[3]),0,255)]},t.convertRGBToRGBA255=function(e){return[(0,o.clamp)(Math.floor(255*e[0]),0,255),(0,o.clamp)(Math.floor(255*e[1]),0,255),(0,o.clamp)(Math.floor(255*e[2]),0,255),255]},t.convertRGBA255ToRGBA=function(e){return[e[0]/255,e[1]/255,e[2]/255,e[3]/255]};let v=null;function D(){return v()}v=window.performance&&window.performance.now?function(){return window.performance.now()}:function(){return(new Date).getTime()},t.getTimeInMilliseconds=D,t.getTimeElapsed=function(e){return D()-e},t.concatenateFloat32Arrays=function(e,t){const i=new Float32Array(e.length+t.length);return i.set(e),i.set(t,e.length),i},t.concatenateUint8Arrays=function(e,t){const i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i},t.arraySubtract=function(e,t){return 0===e.length?[]:0===t.length?e:1===e.length&&1===t.length?e[0]===t[0]?[]:e:(0,r.difference)(e,t)},t.setSubtract=function(e,t){const i=new Set;return e.forEach((e=>{t.has(e)||i.add(e)})),i};let M=!1,y=!1;t.getHasFeatureQLVFacePatternCapability=function(){return M},t.getHasLongPressHandlerCapability=function(){return y};const O=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];function _(e,t){if(e.length<3)return s.log.warn("Attempting to create a color string with a color of insufficient length"),"#000000";let i="#";for(let s=0;s<3;++s){const n=t?e[s]:0|Math.round(255*e[s]);i+=O[n>>4&15],i+=O[15&n]}return i}t.getColorString=_,t.getColorStringArray=function(e){const t=[];for(let i=0;i<e.length;++i){const s=!0;t.push(_(e[i],s))}return t},t.getAssemblyInContextElementId=function(e,t,i){return e+"."+t+"."+i},t.getPartstudioElementIdFromContextId=function(e){const t=e.split(".");return t.length>1?t[1]:""},t.cacheCapabilities=function(){n.btInjector.CapabilitiesService.isFeatureQLVFacePatternEnabled().then((function(e){M=!0===e})),n.btInjector.CapabilitiesService.isLongPressHandlerEnabled().then((function(e){y=!0===e})),n.btInjector.CapabilitiesService.checkLockBranchFunctionalityCurrentlyEnabled(),n.btInjector.CapabilitiesService.checkNotifyThirdPartiesToSaveCurrentlyEnabled()},t.flipImageVertically=function(e,t,i){const s=4*t,n=new Uint8Array(s),r=Math.floor(i/2);for(let t=0;t<r;++t){const r=e.subarray(t*s,(t+1)*s),a=i-1-t,o=e.subarray(a*s,(a+1)*s);n.set(o),o.set(r),r.set(n)}},t.imageCaptureToJpeg=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");t.width=e.width,t.height=e.height;const s=i.createImageData(e.width,e.height);return s.data.set(e.data),i.putImageData(s,0,0),new Promise(((e,i)=>{t.toBlob((t=>{t?e(t):i("Canvas did not return blob")}),"image/jpeg",c.default.getManager().getNumber("MARKUP_JPG_IMAGE_QUALITY_VALUE"))}))};const A=new ArrayBuffer(1e4),R=new Uint8Array(A);function N(e,t){return{text:e+": ("+t+")",children:[]}}function w(e,t,i){for(const s in t)!t.hasOwnProperty(s)||i&&i.hasOwnProperty(s)||e.push(N(s,t[s]));return e}t.zeroOutArrayBuffer=function(e,t){const i=new Uint8Array(e);for(let e=0;e<t;e+=R.length){let t=R;t.length>i.length-e&&(t=new Uint8Array(A,0,i.length-e)),i.set(t,e)}},t.createTextDebugObject=N,t.addChildDebugObjectsFromProperties=w,t.makeSceneDebugObjectFromObject=function(e,t){return{text:t,children:w([],e)}}},879283:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ScreenOccupancyMap=void 0;const s=i(264292),n=i(873896),r=i(613199),a=i(3693),o=s.vec2.create(),c=s.vec2.create(),l=[];for(let e=0;e<4;++e)l.push(s.vec2.create());const h=new a.BoundingBox2D;t.ScreenOccupancyMap=class{constructor(){this.occupiedBounds=[]}clearOccupiedRegions(){this.occupiedBounds=[]}addOccupiedRegion(e){this.occupiedBounds.push(e)}getUnoccupiedOffsetAlongDirection(e,t){const i=h;i.copyFrom(e);let a=0;for(;;){let e=-1/0,h=!1;const d=i.center(o);for(let n=0;n<this.occupiedBounds.length;++n)if(this.occupiedBounds[n].overlapsWith(i)){h=!0;let i=-1/0;const a=this.occupiedBounds[n].getCorners(l);for(let e=0;e<a.length;++e){const n=s.vec2.dot(t,r.vec2C.subtract(a[e],d,c));n>i&&(i=n)}i>e&&(e=i)}if(!h)break;{let o=1/0;const h=i.getCorners(l);for(let e=0;e<h.length;++e){const i=s.vec2.dot(t,r.vec2C.subtract(h[e],d,c));i<o&&(o=i)}const u=e-o;if(!(u>n.Tolerances.ZERO_LENGTH))break;i.translate(r.vec2C.scale(t,u,c)),a+=u}}return a}}},806159:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getMaximumVerticesPerVbo=t.getIndexElementSize=t.getIndexElementType=t.getIndexBufferType=t.initialize32BitIndexSupport=t.isRendererStringForDedicatedIntel=t.isRendererStringForIntel=t.isRunningIntelGpu=t.getRendererInfo=t.getUnavailableRendererInfo=t.isCpuRenderer=t.getChannelCountOfGlPixelFormat=t.GlPixelFormat=t.sizeOfGlRenderBufferType=t.GlRenderBufferType=t.getGLTarget=t.sizeOfGlType=t.GlDataType=void 0;const s=i(912057),n=i(606544);var r,a,o;function c(e){switch(e){case r.BYTE:case r.UNSIGNED_BYTE:return 1;case r.SHORT:case r.UNSIGNED_SHORT:case r.HALF_FLOAT:return 2;case r.INT:case r.UNSIGNED_INT:case r.FLOAT:return 4;default:return s.log.warn("Unrecognized GL type: 0x"+e.toString(16)),0}}function l(e){if(e){const t=["swiftshader"],i=e.toLowerCase();return t.some((e=>i.includes(e)))}return!1}function h(){return{glVendor:"unavailable",glRenderer:"unavailable",isCpuRenderer:!1}}!function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.HALF_FLOAT=36193]="HALF_FLOAT"}(r||(t.GlDataType=r={})),t.sizeOfGlType=c,t.getGLTarget=function(e,t){return t===n.GBTGraphicsBufferTarget.ARRAY_BUFFER?e.ARRAY_BUFFER:t===n.GBTGraphicsBufferTarget.ELEMENT_ARRAY_BUFFER?e.ELEMENT_ARRAY_BUFFER:null},function(e){e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL"}(a||(t.GlRenderBufferType=a={})),t.sizeOfGlRenderBufferType=function(e){switch(e){case a.STENCIL_INDEX:case a.STENCIL_INDEX8:return 1;case a.RGBA4:case a.RGB5_A1:case a.RGB565:case a.DEPTH_COMPONENT16:return 2;case a.DEPTH_STENCIL:return 4;default:return s.log.warn("Unrecognized GL render buffer type: 0x"+e.toString(16)),0}},function(e){e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(o||(t.GlPixelFormat=o={})),t.getChannelCountOfGlPixelFormat=function(e){switch(e){case o.DEPTH_COMPONENT:case o.ALPHA:case o.LUMINANCE:return 1;case o.LUMINANCE_ALPHA:return 2;case o.RGB:return 3;case o.RGBA:return 4;default:return s.log.warn("Unrecognized GL pixel format: 0x"+e.toString(16)),0}},t.isCpuRenderer=l,t.getUnavailableRendererInfo=h;const d=new Map;function u(e){let t=null;if(e){if(t=d.get(e),t)return t;const i=e.getExtension("WEBGL_debug_renderer_info");if(i){const s=e.getParameter(i.UNMASKED_RENDERER_WEBGL);t={glVendor:e.getParameter(i.UNMASKED_VENDOR_WEBGL),glRenderer:s,isCpuRenderer:l(s)},d.set(e,t)}else t={glVendor:"unavailable",glRenderer:"unavailable",isCpuRenderer:!1}}return t}function g(e){return!!e&&e.toLowerCase().indexOf("intel")>=0}let p;t.getRendererInfo=u,t.isRunningIntelGpu=function(e){return g(u(e).glRenderer)},t.isRendererStringForIntel=g,t.isRendererStringForDedicatedIntel=function(e){if(!e)return!1;const t=e.toLowerCase();return!(t.indexOf("intel")<0)&&(t.indexOf("arc")>=0||t.indexOf("dg1")>=0)};let m=null,E=null,I=null,T=null;t.initialize32BitIndexSupport=function(e){void 0===p?(p=e,p?(m=Uint32Array,E=r.UNSIGNED_INT):(m=Uint16Array,E=r.UNSIGNED_SHORT),I=c(E),T=Math.pow(2,8*I)):p!==e&&s.log.warn("initialize32BitIndexSupport called twice with two different values")},t.getIndexBufferType=function(){if(!m)throw"Attempt to get indexBufferType before gl initialized";return m},t.getIndexElementType=function(){if(!E)throw"Attempt to get indexElementType before gl initialized";return E},t.getIndexElementSize=function(){if(!I)throw"Attempt to get indexElementSize before gl initialized";return I},t.getMaximumVerticesPerVbo=function(){if(!T)throw"Attempt to get maximumVerticesPerVbo before gl initialized "+(new Error).stack;return T}},960743:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.BitShiftId=void 0;const s=i(912057),n=i(114924);t.BitShiftId=class{constructor(){this.id=0,this.shiftCount=0}getId(){return this.id}getShiftCount(){return this.shiftCount}reset(){this.id=0,this.shiftCount=0}addNumber(e,t){this.id|=e<<this.shiftCount,this.shiftCount+=t,this.shiftCount>31&&s.log.warn("BitShiftId exceeded 31 shifts; loss of uniqueness is possible")}addBoolean(e){this.addNumber(e?1:0,1)}getIdWithIdAppended(e){e>=Math.pow(2,n.NUMBER_INTEGER_BITS-this.shiftCount)&&s.log.warn("Lost uniqueness in creating id with getIdWithIdAppended");const t=e*Math.pow(2,this.shiftCount);return this.id+t}}},500021:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.executePerformanceTests=t.Gauge=t.BrowserRefreshRate=t.MINIMUM_REFRESH_RATE_FPS=t.REFRESH_RATE_MEASURE_TIME_MS=t.REFRESH_RATE_MEASURE_SAMPLE_START_TIME_MS=t.EXCELLENT_GPU_RESULTS=t.Results=void 0;const s=i(264292),n=i(788465),r=i(225072),a=i(268154),o=i(114924),c=new o.NodeProperties({primitiveType:o.PrimitiveType.TRIANGLE_STRIP}),l=new o.NodeProperties({primitiveType:o.PrimitiveType.LINES});let h=null,d=null;class u extends o.UIElement{constructor(e,t,i){super(t),this.primitiveType=e;const n=s.mat4.create();switch(n[12]=32*i.random(),n[13]=18*i.random(),n[14]=18*i.random(),this.setTransform(n),h||(h=(0,o.makeSphere)(100,100),d=(0,o.createEdgesFromTriangleStrip)(h)),this.primitiveType){case o.PrimitiveType.TRIANGLE_STRIP:this.updateMeshIncrement("s","s",h,c);break;case o.PrimitiveType.LINES:this.updateMeshIncrement("s","s",d,l)}}getPrimitiveCount(){switch(this.primitiveType){case o.PrimitiveType.TRIANGLE_STRIP:return h.getTriangleCount();case o.PrimitiveType.LINES:return d.getLineCount()}return 0}}class g{constructor(e,t){this.primitiveType=e,this.viewer=t,this.primitiveCount=0,this.spheres=[],this.randomNumberGenerator=new n.MersenneTwister(0)}addPrimitivesToScene(){let e=0;for(;e<75e4;){const t=new u(this.primitiveType,this.viewer,this.randomNumberGenerator);this.spheres.push(t),this.primitiveCount+=t.getPrimitiveCount(),e+=t.getPrimitiveCount()}}getPrimitiveCount(){return this.primitiveCount}remove(){for(let e=0;e<this.spheres.length;++e)this.spheres[e].remove();this.spheres=[]}}class p{constructor(){this.trianglesPerSecond=0,this.trianglesPerSecondMeasurementHaltedEarly=!1,this.linesPerSecond=0,this.linesPerSecondMeasurementHaltedEarly=!1,this.executionTimeMs=0,this.refreshRate=0,this.testSkippedDueToLowRefreshRate=!0}getScore(){return Math.min(this.getModelSize()/t.EXCELLENT_GPU_RESULTS.getModelSize(),1)}getModelSize(){return(5*this.linesPerSecond+this.trianglesPerSecond)/20}}t.Results=p,t.EXCELLENT_GPU_RESULTS=new p,t.EXCELLENT_GPU_RESULTS.trianglesPerSecond=8e7,t.EXCELLENT_GPU_RESULTS.linesPerSecond=6e7,t.REFRESH_RATE_MEASURE_SAMPLE_START_TIME_MS=1500,t.REFRESH_RATE_MEASURE_TIME_MS=3e3,t.MINIMUM_REFRESH_RATE_FPS=45;class m{constructor(){this.deferred=null,this.startTime=null,this.lastFrameTime=null,this.fpsSamples=[]}refreshCallback(){const e=performance.now(),i=e-this.startTime;if(i>=t.REFRESH_RATE_MEASURE_TIME_MS){let e=0;for(let t=0;t<this.fpsSamples.length;++t)e+=this.fpsSamples[t];const t=this.fpsSamples.length>0?e/this.fpsSamples.length:0;this.deferred.resolve(t)}else i>t.REFRESH_RATE_MEASURE_SAMPLE_START_TIME_MS&&null!==this.lastFrameTime&&this.fpsSamples.push(1e3/(e-this.lastFrameTime)),this.lastFrameTime=e,window.requestAnimationFrame((()=>this.refreshCallback()))}measureRefreshRate(){return this.deferred||(this.deferred=r.defer(),this.startTime=window.performance.now(),window.requestAnimationFrame((()=>this.refreshCallback()))),this.deferred.promise}}t.BrowserRefreshRate=m;class E{constructor(e){this.viewer=e,this.deferred=null,this.frameBuffer=null,this.blitPass=null,this.canvasViewport=s.vec4.fromValues(0,0,1,1),this.testViewport=s.vec4.fromValues(0,0,1,1),this.startTime=0,this.results=new p,this.fastFrameThresholdMS=1e3/45}execute(){if(this.deferred)return this.deferred.promise;this.startTime=(0,o.getTimeInMilliseconds)(),this.canvasViewport=this.viewer.getCamera().getViewport(),this.testViewport=s.vec4.fromValues(0,0,1280,720),this.viewer.renderContext.pushViewport(this.canvasViewport),this.viewer.getCamera().setViewport(this.testViewport),this.viewer.renderContext.pushViewport(this.testViewport);const e=this.viewer.getGlContext();this.frameBuffer=this.viewer.getOrCreateFrameBuffer(e.UNSIGNED_BYTE,"",{storageType:e.DEPTH_STENCIL,attachmentType:e.DEPTH_STENCIL_ATTACHMENT}),this.frameBuffer.update(this.viewer.renderContext),this.viewer.renderContext.popViewport(),this.blitPass=new o.BlitFramebufferPass(this.viewer,this.frameBuffer),this.deferred=r.defer();return(new m).measureRefreshRate().then((e=>{this.results.refreshRate=e,e<t.MINIMUM_REFRESH_RATE_FPS?(this.results.testSkippedDueToLowRefreshRate=!0,this.resolve()):(this.results.testSkippedDueToLowRefreshRate=!1,this.measureTrianglesPerSecond())})),this.deferred.promise}resolve(){this.frameBuffer.destroy(),this.viewer.renderContext.popViewport(),this.results.executionTimeMs=(0,o.getTimeElapsed)(this.startTime),this.deferred.resolve(this.results)}measureFrameTime(e){const t=(0,a.isBrowserSafari)()?20:5;let i=!1,s=0,n=0,r=0,c=0;const l={performFrameTiming:!1};this.viewer.getCamera().setViewport(this.testViewport),this.viewer.getPrimaryViewController().setStandardView("XZ"),this.viewer.zoomFit();let h=500;const d=a=>{const u=(0,o.getTimeInMilliseconds)(),g=this.viewer.getPrimaryViewController();if(g.rotateAbout(.0698131701,[0,0,1],g.camera.focalPoint()),r){c+=u-r,++s}i?r=u:(n=u,i=!0);const p=u-n;if(p>500&&2500!==h){c/s>=this.fastFrameThresholdMS&&(h=2500)}s>=t&&p>=h?e(c/s):(this.frameBuffer.bindBuffer(),this.viewer.getCamera().setViewport(this.testViewport),this.viewer.renderContext.pushViewport(this.testViewport),this.viewer.draw(a),this.viewer.renderContext.popViewport(),this.viewer.getCamera().setViewport(this.canvasViewport),this.frameBuffer.unbindBuffer(),this.blitPass.draw(this.viewer.renderContext),this.viewer.requestDraw(d,l,!0))};this.viewer.requestDraw(d,l,!0)}measureTrianglesPerSecond(){this.measurePrimitivesPerSecond(o.PrimitiveType.TRIANGLE_STRIP,t.EXCELLENT_GPU_RESULTS.trianglesPerSecond,((e,t)=>{this.results.trianglesPerSecond=e,this.results.trianglesPerSecondMeasurementHaltedEarly=t,this.measureLinesPerSecond()}))}measureLinesPerSecond(){this.measurePrimitivesPerSecond(o.PrimitiveType.LINES,t.EXCELLENT_GPU_RESULTS.linesPerSecond,((e,t)=>{this.results.linesPerSecond=e,this.results.linesPerSecondMeasurementHaltedEarly=t,this.resolve()}))}measurePrimitivesPerSecond(e,t,i){const s=new g(e,this.viewer);s.addPrimitivesToScene();const n=10*t,r=e=>{const t=s.getPrimitiveCount()/e*1e3;e<this.fastFrameThresholdMS&&t<=n?(s.addPrimitivesToScene(),this.measureFrameTime(r)):(s.remove(),this.viewer.cleanUpOrphanedObjects(),i(t,t>n))};this.measureFrameTime(r)}}t.Gauge=E,t.executePerformanceTests=function(e){return new E(e).execute()}},105113:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.RayVisualization=void 0;const s=i(114924),n=i(545348),r=i(264292),a=i(613199);class o extends s.UIElement{constructor(e,t){super(e),this.POINT_NODE_PROPERTIES=new s.NodeProperties({primitiveType:s.PrimitiveType.POINTS,isPickable:!1}),this.LINE_NODE_PROPERTIES=new s.NodeProperties({primitiveType:s.PrimitiveType.LINES,isPickable:!1,addsToBounds:!1});const i=e.getSceneBounds().diameter(),o=n.default.getManager();if(t.point){const e=(0,s.createPoint)(t.point,void 0,o.getColor("RAY_COLOR"),o.getNumber("RAY_ORIGIN_WIDTH_PX"));this.updateMeshIncrement("point",s.NO_SELECTION_ID,e,this.POINT_NODE_PROPERTIES)}const c=(0,s.createLine)(t.point,a.vec3C.add(a.vec3C.scale(t.direction,i,r.vec3.create()),t.point),void 0,o.getColor("RAY_COLOR"),o.getNumber("RAY_LINE_WIDTH_PX"));this.updateMeshIncrement("line",s.NO_SELECTION_ID,c,this.LINE_NODE_PROPERTIES)}}t.RayVisualization=o},827410:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.viewManipulationSettingsGetManager=void 0;const s=i(450798),n=i(375680),r=i(114924);class a{constructor(){this.mouseKeyFlags={},this.mouseKeyManipulationModeBinding={},this.hasShiftKeyBinding=!1,this.hasControlKeyBinding=!1,this.hasAltKeyBinding=!1,this.mouseKeyFlags[n.MouseButton.MIDDLE]=1,this.mouseKeyFlags[n.MouseButton.RIGHT]=2,this.mouseKeyFlags[s.Keys.SHIFT]=4,this.mouseKeyFlags[s.Keys.CONTROL]=8,this.mouseKeyFlags[s.Keys.ALT]=16}getMouseKeyCombinationID(e,t){let i=0,s=0;for(s=0;s<e.length;++s)i|=this.mouseKeyFlags[e[s]];for(s=0;s<t.length;++s)i|=this.mouseKeyFlags[t[s]];return i}clearMouseKeyManipulationBindings(){this.mouseKeyManipulationModeBinding={},this.hasShiftKeyBinding=!1,this.hasControlKeyBinding=!1,this.hasAltKeyBinding=!1}addMouseKeyManipulationModeBinding(e,t,i){const n=this.getMouseKeyCombinationID(e,t);n>0&&(this.mouseKeyManipulationModeBinding[n]=i,this.hasControlKeyBinding||(this.hasControlKeyBinding=0!=(n&this.mouseKeyFlags[s.Keys.CONTROL])),this.hasShiftKeyBinding||(this.hasShiftKeyBinding=0!=(n&this.mouseKeyFlags[s.Keys.SHIFT])),this.hasAltKeyBinding||(this.hasAltKeyBinding=0!=(n&this.mouseKeyFlags[s.Keys.ALT])))}getManipulationMode(e,t){return this.mouseKeyManipulationModeBinding[this.getMouseKeyCombinationID(e,t)]}isManipulationModeEnabled(e,t,i){const s=this.getMouseKeyCombinationID(t,i);for(const t in this.mouseKeyManipulationModeBinding){const i=parseInt(t,10);if(this.mouseKeyManipulationModeBinding[i]===e){if((s&i)===i)return!0}}return!1}getClosestMode(e,t,i){let s=r.ManipulationMode.NONE,n=0;for(const r in this.mouseKeyManipulationModeBinding){const a=parseInt(r,10),o=this.mouseKeyManipulationModeBinding[a];o!==i&&(this.isManipulationModeEnabled(o,e,t)&&a>n&&(n=a,s=o))}return s}usesShiftKey(){return this.hasShiftKeyBinding}usesControlKey(){return this.hasControlKeyBinding}usesAltKey(){return this.hasAltKeyBinding}}let o=null;t.viewManipulationSettingsGetManager=function(){return o||(o=new a,o.addMouseKeyManipulationModeBinding([n.MouseButton.RIGHT],[],r.ManipulationMode.ROTATE),o.addMouseKeyManipulationModeBinding([n.MouseButton.RIGHT],[s.Keys.ALT],r.ManipulationMode.AXIS_ROTATE),o.addMouseKeyManipulationModeBinding([n.MouseButton.RIGHT],[s.Keys.CONTROL],r.ManipulationMode.PAN),o.addMouseKeyManipulationModeBinding([n.MouseButton.MIDDLE],[],r.ManipulationMode.PAN)),o}},165035:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.OrthographicController=t.PerspectiveController=t.ViewController=t.StandardViews=void 0;const s=i(545348),n=i(264292),r=i(450798),a=i(375680),o=i(912057),c=i(321704),l=i(268154),h=i(873896),d=i(514313),u=i(114924),g=i(613199);var p;!function(e){e[e.RIGHT_FRONT=0]="RIGHT_FRONT",e[e.RIGHT_BACK=1]="RIGHT_BACK",e[e.LEFT_BACK=2]="LEFT_BACK",e[e.LEFT_FRONT=3]="LEFT_FRONT"}(p||(p={}));const m=function(e,t){const i=n.mat4.create();return g.mat4C.rotate(i,e*Math.PI/2+Math.PI/6,[0,0,1]),g.mat4C.rotate(i,t?Math.PI/3:2*Math.PI/3,[1,0,0]),i};t.StandardViews={XY:n.mat4.create(),XYback:[1,0,0,0,0,-1,0,0,0,0,-1,0,0,0,0,1],YZ:[0,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1],YZback:[0,-1,0,0,0,0,1,0,-1,0,0,0,0,0,0,1],XZ:[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],XZback:[-1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1],Isometric:function(){const e=Math.sqrt(.5),t=Math.sqrt(1/3),i=Math.sqrt(1/6);return[e,e,0,0,-i,i,2*i,0,t,-t,t,0,0,0,0,1]}(),Dimetric:function(){const e=n.mat4.create();return g.mat4C.rotate(e,Math.PI/4,[0,0,1]),g.mat4C.rotate(e,Math.PI/3,[1,0,0]),e}(),Trimetric:m(p.RIGHT_FRONT,!0),TrimetricTopRightBack:m(p.RIGHT_BACK,!0),TrimetricTopLeftBack:m(p.LEFT_BACK,!0),TrimetricTopLeftFront:m(p.LEFT_FRONT,!0),TrimetricBottomRightFront:m(p.RIGHT_FRONT,!1),TrimetricBottomRightBack:m(p.RIGHT_BACK,!1),TrimetricBottomLeftBack:m(p.LEFT_BACK,!1),TrimetricBottomLeftFront:m(p.LEFT_FRONT,!1)};const E=s.default.getManager();function I(e,t){return n.vec4.copy(n.vec4.create(),t.getViewport())}class T{constructor(e){this.viewer=e,this.camera=null,this.axisRotateUpAxis=[0,0,1],this.axisRotateCanvasTag="axisRotateView",this.rotateOrPanCenter=[0,0,0],this.haltPostRotationAnimation=!1,this.lastRotationTime=0,this.rotationSpeedX=0,this.rotationSpeedY=0,this.lastButtonState={leftButton:!1,middleButton:!1,rightButton:!1},this.lastCtrlState=!1,this.lastShiftState=!1,this.lastAltState=!1,this.isSpaceballMoving=!1,this.dragZoomCanvasCoordinates=[0,0],(0,u.viewerCheck)(e),this.animationController=e.getAnimationController(),this.manipulationMode=u.ManipulationMode.NONE,this.rotateCenterGraphicsElement=new u.PointElement([0,0,0],u.MAIN_SCENEGRAPH_ID,E.getColor("ROTATION_POINT_COLOR"),E.getNumber("ROTATION_POINT_SIZE"),this.viewer),this.rotateCenterGraphicsElement.setStyle(E.getPointFont("ROTATION_POINT_FONT")),this.rotateCenterGraphicsElement.hide(),this.forcedManipulationMode=u.ManipulationMode.NONE}getViewer(){return this.viewer}destroy(){this.rotateCenterGraphicsElement.remove()}isPerspective(){return!1}isOrthographic(){return!1}getCamera(){return this.camera}getRotateOrPanCenter(){return this.rotateOrPanCenter}getAxisRotateUpAxis(){return this.axisRotateUpAxis}resetInputState(){this.lastButtonState={leftButton:!1,middleButton:!1,rightButton:!1},this.lastCtrlState=!1,this.lastShiftState=!1,this.lastAltState=!1}updateInputState(e,t){let i=!1;return Object.entries(t).forEach((function([e,t]){this.lastButtonState[e]!==t&&(this.lastButtonState[e]=t,i=!0)}),this),(0,u.viewManipulationSettingsGetManager)().usesControlKey()&&e.ctrlKey!==this.lastCtrlState&&(this.lastCtrlState=e.ctrlKey,i=!0),(0,u.viewManipulationSettingsGetManager)().usesShiftKey()&&e.shiftKey!==this.lastShiftState&&(this.lastShiftState=e.shiftKey,i=!0),(0,u.viewManipulationSettingsGetManager)().usesAltKey()&&e.altKey!==this.lastAltState&&(this.lastAltState=e.altKey,i=!0),i}getMouseKeyValues(e,t){const i=[];t.rightButton&&i.push(a.MouseButton.RIGHT),t.middleButton&&i.push(a.MouseButton.MIDDLE),t.leftButton&&i.push(a.MouseButton.LEFT);const s=[];return(0,u.viewManipulationSettingsGetManager)().usesControlKey()&&e.ctrlKey&&s.push(r.Keys.CONTROL),(0,u.viewManipulationSettingsGetManager)().usesShiftKey()&&e.shiftKey&&s.push(r.Keys.SHIFT),(0,u.viewManipulationSettingsGetManager)().usesAltKey()&&e.altKey&&s.push(r.Keys.ALT),{mouseButtonSettings:i,modifierKeys:s}}getManipulationMode(e,t){if(this.forcedManipulationMode!==u.ManipulationMode.NONE&&t.leftButton)return this.forcedManipulationMode;const i=this.getMouseKeyValues(e,t),s=i.mouseButtonSettings,n=i.modifierKeys,r=(0,u.viewManipulationSettingsGetManager)().getManipulationMode(s,n);return r!==u.ManipulationMode.ZOOM&&r!==u.ManipulationMode.AXIS_ROTATE&&r!==u.ManipulationMode.PAN&&r!==u.ManipulationMode.ROTATE?u.ManipulationMode.NONE:r}forceManipulationMode(e){this.forcedManipulationMode=e}getClosestMode(e,t,i){const s=this.getMouseKeyValues(e,t),n=s.mouseButtonSettings,r=s.modifierKeys;return(0,u.viewManipulationSettingsGetManager)().getClosestMode(n,r,i)}updateManipulationMode(e,t){if(!this.updateInputState(e,t))return;const i=this.manipulationMode,s=this.forcedManipulationMode!==u.ManipulationMode.NONE?this.forcedManipulationMode:this.getManipulationMode(e,t);if(s!==u.ManipulationMode.NONE)this.manipulationMode=s;else{const i=this.getClosestMode(e,t,this.manipulationMode);i!==u.ManipulationMode.NONE?this.manipulationMode=i:this.manipulationMode=this.getClosestMode(e,t)}i!==this.manipulationMode&&(!(this.isRotating()||this.isPanning()||this.isAxisRotating())||this.isRotating()&&i===u.ManipulationMode.AXIS_ROTATE||this.isAxisRotating()&&i===u.ManipulationMode.ROTATE||this.updateRotationPanCenter(e),this.isRotating()&&(this.lastRotationTime=(0,u.getTimeInMilliseconds)(),this.rotationSpeedX=0,this.rotationSpeedY=0),(this.isRotating()||this.isAxisRotating())&&E.getNumber("SHOW_ROTATION_POINT")?this.rotateCenterGraphicsElement.show():this.rotateCenterGraphicsElement.hide())}setRotationPivotPosition(e){this.rotateOrPanCenter=e,this.rotateCenterGraphicsElement.updatePosition(this.rotateOrPanCenter)}setShowRotationPivot(e){e?E.getNumber("SHOW_ROTATION_POINT")&&this.rotateCenterGraphicsElement.show():this.rotateCenterGraphicsElement.hide()}setIsSpaceballMoving(e){this.isSpaceballMoving=e}isPanning(){return this.manipulationMode===u.ManipulationMode.PAN}isRotating(){return this.manipulationMode===u.ManipulationMode.ROTATE}isAxisRotating(){return this.manipulationMode===u.ManipulationMode.AXIS_ROTATE}isZooming(){return this.manipulationMode===u.ManipulationMode.ZOOM}isBeingManipulated(){return this.manipulationMode!==u.ManipulationMode.NONE}isBeingForceManipulated(){return this.isBeingManipulated()&&this.manipulationMode===this.forcedManipulationMode}getRotateCenterUnderPoint(e,t){const i=E.getNumber("ROTATION_CENTER_SEARCH_RADIUS"),s=2*i+1,r=2*i+1,a=e-i,o=t-i,c=this.viewer.findDepthsInRect(a,o,s,r,!1);let l=null,h=1/0;const d=n.vec2.create(),p=[e,t];for(let e=0;e<c.length;++e)if(c[e][2]!==u.UNKNOWN_DEPTH){const t=c[e],i=n.vec2.squaredLength(g.vec2C.subtract(t,p,d));i<h&&(l=t,h=i)}return l?this.camera.canvasToWorld(l):null}getRotateCenterBasedOnWindowDepths(e){const t=this.viewer.retrieveDepthSampling(e),i=[0,0,0],s=t.length;for(let e=0;e<s;++e)for(let s=0;s<3;++s)i[s]+=t[e][s];return s>0&&s>=E.getNumber("MIN_SAMPLES_TO_USE_FOR_DEPTH_AVERAGED_ROTATION_CENTER")?this.camera.canvasToWorld([i[0]/s,i[1]/s,i[2]/s]):null}getRotateCenterBasedOnBounds(){const e=this.viewer.getModelViewManagers().getManager().getModelBounds();return e&&e.isInitialized()&&!e.isInfinite()?this.camera.doBoundsFitInViewport(e,this.camera.getViewport(),E.getNumber("MODEL_SIZE_TO_VIEWPORT_ROTATE_BOUNDS_FACTOR"))?e.center():null:n.vec3.create()}getRotateCenterBasedOnCanvasLocationAndBoundsDepth(e,t){const i=this.viewer.getModelViewManagers().getManager().getModelBounds();if(!i||!i.isInitialized()||i.isInfinite())return n.vec3.create();const s=this.camera.getRay(e,t),r=.01*i.diameter();return g.vec3C.add(s.point,g.vec3C.scale(s.direction,Math.max(n.vec3.dot(s.direction,g.vec3C.subtract(i.center(),s.point,n.vec3.create())),r),n.vec3.create()))}getRotateCenterForCanvasLocation(e,t){let i=this.getRotateCenterUnderPoint(e,t);return i||(i=this.getRotateCenterBasedOnWindowDepths({includePlanes:!1}),i||(i=this.getRotateCenterBasedOnWindowDepths({includePlanes:!0}),i||(i=this.getRotateCenterBasedOnBounds(),i||this.getRotateCenterBasedOnCanvasLocationAndBoundsDepth(e,t))))}getRotateCenterForSpaceball(){let e=this.getRotateCenterBasedOnBounds();if(e)return e;const t=[this.camera.getViewportWidth()/2,this.camera.getViewportHeight()/2];return e=this.getRotateCenterUnderPoint(t[0],t[1]),e||(e=this.getRotateCenterBasedOnWindowDepths({includePlanes:!1}),e||(e=this.getRotateCenterBasedOnWindowDepths({includePlanes:!0}),e||this.getRotateCenterBasedOnCanvasLocationAndBoundsDepth(t[0],t[1])))}updateRotationPanCenterForSpaceball(){this.setRotationPivotPosition(this.getRotateCenterForSpaceball())}updateRotationPanCenter(e){this.rotateOrPanCenter=[0,0,0];const t=this.viewer.getCanvasCoordinateFromEvent(e),i=t[0],s=t[1];(this.isRotating()||this.isAxisRotating()||this.isPanning()&&this.isPerspective())&&this.setRotationPivotPosition(this.getRotateCenterForCanvasLocation(i,s))}onDragStart(e,t,i){const s=this.isZooming();this.updateManipulationMode(t,i);if(!s&&this.isZooming()){const t=this.viewer.getCanvasCoordinateFromEvent(e);this.dragZoomCanvasCoordinates[0]=t[0],this.dragZoomCanvasCoordinates[1]=t[1]}return this.haltPostRotationAnimation=this.isBeingManipulated(),this.isBeingManipulated()}zoomOnCanvasPoint(e,t,i){const r=this.camera.viewNormalPlaneAtPoint(this.camera.focalPoint()),a=(0,u.intersectRayPlane)(this.camera.getRay(e,0),r);let c,l=(0,u.intersectRayPlane)(this.camera.getRay(e,t),r);a&&l?(c=g.vec3C.subtract(l,this.camera.getEye(),n.vec3.create()),g.vec3C.normalize(c)):(i=0,c=this.camera.getEye());const h=this.viewer.getSceneBounds().getCorners();i<0&&s.default.getManager().getNumber("USE_CENTRAL_ZOOM_OUT")&&(l=(0,u.intersectRayPlane)(this.camera.getRay(this.camera.getViewportWidth()/2,this.camera.getViewportHeight()/2),r)),l?this.zoomPoint(l,{direction:c},i,h):o.log.debug("No point intersection found for zoomOnCanvasPoint")}zoomOnMouseWheelScroll(e){e.preventDefault();const t=e.originalEvent;let i=0,s=.5;if("mousewheel"===e.type){if(0===t.wheelDelta||t.wheelDeltaX&&Math.abs(t.wheelDeltaX)>Math.abs(t.wheelDeltaY))return!1;s/=120,(0,l.isPlatformWindows)()&&(s*=3),i=s*t.wheelDelta}else{if(0===t.detail||1===t.axis)return!1;i=-s*t.detail}const n=this.viewer.getCanvasCoordinateFromEvent(t),r=n[0],a=n[1];return(0,u.getMouseSettingsManager)().isScrollZoomDefault()||(i=-i),this.zoomOnCanvasPoint(r,a,i),!0}zoomOnDrag(e){if(Math.abs(e)<h.Tolerances.ZERO_LENGTH)return;const t=this.dragZoomCanvasCoordinates[0],i=this.dragZoomCanvasCoordinates[1];e=-1*e/s.default.getManager().getNumber("DRAG_ZOOM_FACTOR"),this.zoomOnCanvasPoint(t,i,e)}onDrag(e,t,i,s,r,a){this.forcedManipulationMode===u.ManipulationMode.NONE&&this.updateManipulationMode(e,t);const o=this.viewer.$el,c=this.camera.viewNormalPlaneAtPoint(this.rotateOrPanCenter),l=function(){const e=(0,u.intersectRayPlane)(this.camera.getRay(r,a),c),t=(0,u.intersectRayPlane)(this.camera.getRay(r+i,a+s),c);return e&&t?(g.vec3C.subtract(t,e),t):null};if(this.isPanning()){const e=l.call(this);e&&this.pan(e)}else if(this.isRotating()){const e=[+o.attr("width"),+o.attr("height")],t=2*Math.PI*E.getNumber("ROTATION_CYCLES_PER_SCREEN")/g.vec2C.length(e);this.rotateAbout(-i*t,this.camera.getUp(),this.rotateOrPanCenter),this.rotateAbout(-s*t,this.camera.getRight(),this.rotateOrPanCenter),this.lastRotationTime=(0,u.getTimeInMilliseconds)(),this.rotationSpeedX=.5*(this.rotationSpeedX+i),this.rotationSpeedY=.5*(this.rotationSpeedY+s),this.tagCanvasWithView("unknown")}else if(this.isAxisRotating()){const e=o.attr("data-view-shown")===this.axisRotateCanvasTag;if(!this.animationController.isCameraAnimating())if(e){const e=[+o.attr("width"),+o.attr("height")],t=2*Math.PI*E.getNumber("ROTATION_CYCLES_PER_SCREEN")/g.vec2C.length(e),n=(0,u.sign)(this.camera.getUp()[2])||1;this.rotateAbout(-i*n*t,this.axisRotateUpAxis,this.rotateOrPanCenter),this.rotateAbout(-s*t,this.camera.getRight(),this.rotateOrPanCenter)}else{const e=Math.asin(n.vec3.dot(this.camera.getRight(),this.axisRotateUpAxis)),t=g.vec3C.cross(this.camera.getRight(),this.axisRotateUpAxis,n.vec3.create()),i=Math.abs(e);if(i<E.getNumber("AXIS_ROTATION_SNAP_TOLERANCE"))this.rotateAbout(-e,t,this.rotateOrPanCenter),this.tagCanvasWithView(this.axisRotateCanvasTag);else{const s=this.camera.clone();s.rotateAbout(-e,t,this.rotateOrPanCenter);const n=E.getNumber(i>Math.PI/4?"CAMERA_SHORT_ANIMATION_TIME_MS":"CAMERA_SNAP_ANIMATION_TIME_MS");this.animateToCustomView(s,n,this.axisRotateCanvasTag)}}}else this.isZooming()&&this.zoomOnDrag(s);this.updateCameraNearFar(),this.afterViewChange()}onDragStop(e){this.isRotating()&&(this.rotateCenterGraphicsElement.hide(),this.performStopRotationAnimation()),this.isAxisRotating()&&this.rotateCenterGraphicsElement.hide(),this.resetInputState(),this.manipulationMode=u.ManipulationMode.NONE}getPointerPosition(){return this.viewer.getCanvasCoordinateFromEvent(this.viewer.getLastMouseMovedEvent())}performStopRotationAnimation(){if(this.viewer.isInteractiveFramerateBelowThreshold())return;this.haltPostRotationAnimation=!1;const e=g.vec2C.length([this.camera.getViewportWidth(),this.camera.getViewportHeight()]),t=2*Math.PI*E.getNumber("ROTATION_CYCLES_PER_SCREEN")/e,i=E.getNumber("ROTATION_INERTIA");let s=1;let n=(0,u.getTimeInMilliseconds)();(0,u.getTimeInMilliseconds)()-this.lastRotationTime<50&&this.animationController.startCameraAnimation((e=>{const r=(0,u.getTimeInMilliseconds)();s*=Math.pow(i,(r-n)/16.666666666666668),n=r;const a=this.rotationSpeedX*s,o=this.rotationSpeedY*s;return!this.haltPostRotationAnimation&&(Math.abs(a)>1||Math.abs(o)>1)?(this.rotateAbout(-a*t,this.camera.getUp(),this.rotateOrPanCenter),this.rotateAbout(-o*t,this.camera.getRight(),this.rotateOrPanCenter),d.AnimationCallbackStatus.ONGOING):d.AnimationCallbackStatus.COMPLETE}))}rotateAbout(e,t,i){this.camera.rotateAbout(e,t,i)}pan(e){this.camera.pan(e)}canZoom(e,t){if(t){const i=new u.BoundingBox;for(let e=0;e<t.length;e++)i.addPoint(t[e]);if(i.diameter()>0){const t=this.camera.getPixelSizeAtWorldPoint(i.center()),n=s.default.getManager().getNumber("MIN_MODEL_PIXEL_SIZE");return!(e>=1&&i.diameter()/t<=e*n||e<=1&&1/t>=e*Math.pow(2,24))}}return!1}adjustCameraToValidZoom(e){if(!e)return!1;const t=this.viewer.getFitBounds();if(!this.canBoundsBeFit(t))return!1;const i=s.default.getManager().getNumber("MIN_MODEL_PIXEL_SIZE"),n=e.getPixelSizeAtWorldPoint(t.center());let r=1;return t.diameter()/n<=i?r=t.diameter()/n/i:1/n>=Math.pow(2,24)&&(r=1/(Math.pow(2,24)*n)),1!==r&&(o.log.debug("Given camera would result in invalid scene zoom. Applying zoom: "+r),e.zoom(r)),!0}zoom(e){}setStandardView(e){const i=t.StandardViews[e];i&&(this.camera.setFrame(i),this.tagCanvasWithView(e))}animateToCustomView(e,t,i){this.animateTo(e,t,i)}animateViewNormalToPlaneMatrix(e,t,i){if(!e)return;let s;const n=I(this.viewer,this.camera);if(this.camera.canBoundsFitInViewport(t,n)){const i=this.camera.viewportToCanvas([n[0]+n[2]/2-this.camera.getViewportLeft(),n[1]+n[3]/2-this.camera.getViewportBottom(),0]);s=this.camera.getCameraRotatedToViewAndTranslated(e,t.center(),i)}else{const t=i?i[0]:this.camera.getViewportWidth()/2,n=i?i[1]:this.camera.getViewportHeight()/2,r=this.getRotateCenterForCanvasLocation(t,n);s=this.camera.getCameraRotatedToView(e,r)}this.animateToCustomView(s,E.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}animateTo(e,t,i){if(this.animationController.isCameraAnimating())return;if(this.tagCanvasWithView(),this.viewer.isInteractiveFramerateBelowThreshold())return this.camera.copyFrom(e),this.updateCameraNearFar(),this.afterViewChange(),this.viewer.getAnimationController().incrementAnimationSequence(),this.tagCanvasWithView(i),void this.viewer.getBodyManager().onUserIsAdjustingCamera();const s=(0,u.getTimeInMilliseconds)(),n=new c.CameraInterpolator(this.camera,e);this.animationController.startCameraAnimation((e=>{const r=(0,u.getTimeInMilliseconds)();let a;const c=r-s;a=c>=t?1:c/t,a=a*a*a*(a*(6*a-15)+10);const l=n.interpolate(a);return(0,u.areVectorsEqual)(this.camera.getViewport(),l.viewport)?(this.camera.copyFrom(l),this.updateCameraNearFar(),r-s<t?d.AnimationCallbackStatus.ONGOING:(this.tagCanvasWithView(i),this.viewer.getBodyManager().onUserIsAdjustingCamera(),this.viewer.getEventDispatcher().trigger(u.CHANGE_VIEW,null),d.AnimationCallbackStatus.COMPLETE)):(o.log.trace("Camera viewport changed mid-animation, terminating animation early"),d.AnimationCallbackStatus.COMPLETE)}))}tagCanvasWithView(e){e?this.viewer.$el.attr("data-view-shown",e):this.viewer.$el.attr("data-view-shown","unknown")}getViewportCenter(){const e=I(this.viewer,this.camera);return n.vec2.fromValues(e[0]+e[2]/2,e[1]+e[3]/2)}canBoundsBeFit(e){const t=e.isInitialized()&&!e.isInfinite();return t||o.log.warn("An attempt was made to fit a camera with invalid bounds"),t}animateToFrameWithZoomFit(e,t,i,s,n,r){if(!this.canBoundsBeFit(t))return;const a=this.getZoomFitTargetCamera(e,t,n,r);this.adjustCameraToValidZoom(a)&&this.animateTo(a,i,s)}getZoomFitTargetCamera(e,t,i,s){const n=t.getCorners();let r=null;i||(r=I(this.viewer,this.camera));const a=this.camera.clone();a.setFrame(e);let o=s;return o||(o=E.getNumber("CAMERA_ZOOM_TO_FIT_PADDING")),a.zoomToFit(n,o,r),a.updateNearFar(),a}animateToStandardView(e,i){if(!this.canBoundsBeFit(i))return;const s=t.StandardViews[e];s&&this.animateToFrameWithZoomFit(s,i,E.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),e)}animateToStandardViewIgnoringUIPanels(e,i,s){if(!this.canBoundsBeFit(i))return;const n=t.StandardViews[e];n&&this.animateToFrameWithZoomFit(n,i,E.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),e,!0,s)}animateZoomToFit(e){if(!this.canBoundsBeFit(e))return;const t=e.getCorners(),i=I(this.viewer,this.camera),s=this.camera.clone();s.zoomToFit(t,E.getNumber("CAMERA_ZOOM_TO_FIT_PADDING"),i),this.adjustCameraToValidZoom(s)&&this.animateTo(s,E.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}zoomFitCamera(e,t,i){if(!this.canBoundsBeFit(e))return;const s=e.getCorners(),n=this.camera.clone();n.zoomToFit(s,E.getNumber("CAMERA_ZOOM_TO_FIT_PADDING"),t),n.updateNearFar(s),this.adjustCameraToValidZoom(n)&&(this.camera=n,this.afterViewChange(i))}zoomFit(e,t){this.animationController.haltCameraAnimation(),this.zoomFitCamera(e,I(this.viewer,this.camera),t)}zoomFitWithoutPanels(e){this.zoomFitCamera(e)}animateRotation(e,t,i,s){let n=0;const r=(0,u.getTimeInMilliseconds)();if(s||(s=this.camera.focalPoint()),this.tagCanvasWithView(),this.viewer.isInteractiveFramerateBelowThreshold())return this.rotateAbout(t,e,s),this.updateCameraNearFar(),void this.afterViewChange();this.animationController.startAnimation((a=>{if(Math.abs(n)<Math.abs(t)){if(!this.viewer.isReadyForDrawing())return;const a=(0,u.getTimeInMilliseconds)(),o=Math.min(a-r,i)/i*t,c=o-n;return this.rotateAbout(c,e,s),this.updateCameraNearFar(),n=o,a-r<=i?d.AnimationCallbackStatus.ONGOING:(this.viewer.getEventDispatcher().trigger(u.CHANGE_VIEW,null),d.AnimationCallbackStatus.COMPLETE)}}))}rotateInDirection(e,t){const i=this.camera.up,s=this.camera.direction,r=g.vec3C.cross(s,i,n.vec3.create());switch(e){case"left":this.animateRotation(i,t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"right":this.animateRotation(i,-t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"up":this.animateRotation(r,t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"down":this.animateRotation(r,-t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"clockwise":this.animateRotation(s,-t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"counterclockwise":this.animateRotation(s,t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"));break;case"180":this.animateRotation(i,Math.PI,E.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}}animatePan(e,t){const i=this.camera.clone(),s=i.getPixelSizeAtWorldPoint(i.getSceneBounds().center()),r=g.vec3C.add(g.vec3C.scale(i.getRight(),s*-e,n.vec3.create()),g.vec3C.scale(i.getUp(),s*-t,n.vec3.create()));i.pan(r),this.animateTo(i,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"))}panRight(){this.animatePan(E.getNumber("DEFAULT_PAN_AMOUNT_PX"),0)}panLeft(){this.animatePan(-E.getNumber("DEFAULT_PAN_AMOUNT_PX"),0)}panUp(){this.animatePan(0,E.getNumber("DEFAULT_PAN_AMOUNT_PX"))}panDown(){this.animatePan(0,-E.getNumber("DEFAULT_PAN_AMOUNT_PX"))}animateZoom(e){const t=this.camera.clone();t.zoom(e),this.adjustCameraToValidZoom(t)&&this.animateTo(t,E.getNumber("CAMERA_SHORT_ANIMATION_TIME_MS"))}zoomIn(){this.animateZoom(1/E.getNumber("DEFAULT_ZOOM_FACTOR"))}zoomOut(){this.animateZoom(E.getNumber("DEFAULT_ZOOM_FACTOR"))}zoomPoint(e,t,i,s){}updateCameraNearFar(){const e=this.viewer.getSceneGraphs().getMainSceneGraph().getBounds();e.isFinite()&&this.camera.updateNearFar(e.getCorners())}getMatchingOrthographicController(){return null}getMatchingPerspectiveController(){return null}afterViewChange(e){e||this.viewer.getEventDispatcher().trigger(u.CHANGE_VIEW,null),this.viewer.requestDraw()}}t.ViewController=T;class S extends T{constructor(e,t){super(e),this.camera=new u.PerspectiveCamera(t)}isPerspective(){return!0}clone(){const e=new S(this.viewer);return e.camera=this.camera.clone(),e.forcedManipulationMode=this.forcedManipulationMode,e}zoom(e){const t=this.camera,i=Math.max(t.distanceToCenter(),t.getMinDistance())*e/6;t.dolly(i),t.updateNearFar()}zoomPoint(e,t,i,s){const n=Math.pow(2,-i/6);if(this.canZoom(n,s)){const e=this.camera,n=Math.max(e.distanceToCenter(),e.getMinDistance())*i/6;e.dollyAlong(n,t.direction),e.updateNearFar(s)}}getMatchingOrthographicController(){const e=new f(this.viewer);return e.camera=this.camera.getOrthographicCamera(),e.forcedManipulationMode=this.forcedManipulationMode,e}}t.PerspectiveController=S;class f extends T{constructor(e,t){super(e),this.camera=new u.OrthographicCamera(t)}isOrthographic(){return!0}zoom(e){const t=Math.pow(2,-e/6);this.camera.zoom(t)}zoomPoint(e,t,i,s){const n=Math.pow(2,-i/6);this.canZoom(n,s)&&this.camera.zoomPoint(e,t,n,s)}clone(){const e=new f(this.viewer);return e.camera=this.camera.clone(),e.forcedManipulationMode=this.forcedManipulationMode,e}getMatchingPerspectiveController(){const e=new S(this.viewer);return e.camera=this.camera.getPerspectiveCamera(),e.forcedManipulationMode=this.forcedManipulationMode,e}}t.OrthographicController=f},312742:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.getDisplayDataTimerLoggingOptions=t.createTestViewer=t.Viewer=t.ElementLoadState=void 0;const n=i(599430),r=i(545348),a=i(869363),o=i(7401),c=i(905898),l=i(719347),h=i(196207),d=i(269399),u=i(997687),g=i(270651),p=i(912057),m=i(197134),E=i(537321),I=i(323884),T=i(225072),S=i(193786),f=i(606544),C=i(461989),P=i(736234),v=i(573879),D=i(268154),M=i(632675),y=i(723617),O=i(32620),_=i(772687),A=i(550122),R=i(873896),N=i(119965),w=i(520498),b=i(114924),L=i(683067),B=i(123085),F=i(695519),x=i(322012),U=i(264292),G=i(613199),V=i(33632),H=i(264292),k=i(585614),W=1600,z=1200;U.glMatrix.setMatrixArrayType(Array);{const e=window;e.vec2=H.vec2,e.vec3=H.vec3,e.vec4=H.vec4,e.mat2=H.mat2,e.mat3=H.mat3,e.mat4=H.mat4,e.quat4=H.quat}let j=0;function X(e,t){return Math.floor(e*t)}if(window.matchMedia){window.matchMedia("print").addListener((function(e){e.matches?(0,b.beforePrint)():(0,b.afterPrint)()}))}window.onbeforeprint=b.beforePrint,window.onafterprint=b.afterPrint;const q=r.default.getManager();class Y{constructor(e){this.elementId=e,this.camera=null,this.userEnabledAggressiveRefinement=!1,this.activeSectionPlanes=[],this.zebraStripeCount=q.getNumber("ZEBRA_STRIPE_COUNT"),this.zebraStripeRotation=q.getNumber("ZEBRA_STRIPE_ROTATION"),this.zebraStripeEdgesOn=!0,this.renderingMode=f.GBTGraphicsRenderMode.SHADED_WITH_EDGES,this.smoothEdgeStyle=f.GBTSmoothEdgeStyle.VISIBLE}}var Z;!function(e){e[e.VIEWER_DESTROYED=-1]="VIEWER_DESTROYED",e[e.WAITING_FOR_DISPLAY_DATA=0]="WAITING_FOR_DISPLAY_DATA",e[e.WAITING_FOR_COMPARE_DISPLAY_DATA=1]="WAITING_FOR_COMPARE_DISPLAY_DATA",e[e.LOADING_DISPLAY_DATA=2]="LOADING_DISPLAY_DATA",e[e.LOADED_DISPLAY_DATA=3]="LOADED_DISPLAY_DATA",e[e.LOADED_ALL_DATA=4]="LOADED_ALL_DATA"}(Z||(t.ElementLoadState=Z={}));const K={performFrameTiming:!0},Q={performFrameTiming:!1};let $={antialias:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"};const J=localStorage.getItem("osWebGlContextOptions");if(J)try{p.log.info("Using custom set of WebGL context options: "+J),$=JSON.parse(J)}catch(e){p.log.warn("Failed to use custom WebGL context options: "+J)}const ee={};class te extends n.View{constructor(e){super(e),this.viewerPreferences=new V.ViewerPreferences,this.shouldUpdatePairedViewer=!1,this.scalarRetrievalPasses=[],this.hasMouseOver=!1,this.boundVAO=null,this.areOptimizedBuffersEnabled=!1,this.doClearDisplayDataCacheBeforeLoadingElement=!1,this.loggedPickIssue=!1,this.renderModeSubject=new x.Subject,this.isBrowserTabVisible="visible"===document.visibilityState,this.debugCamera=null,this.isSynchingView=!0,this.themeChangeSubscription=null,j=r.default.getManager().getNumber("PICK_WINDOW_PREVENT_CULL_MARGIN_PIXELS"),this.areOptimizedBuffersEnabled=u.btInjector.CapabilitiesService.checkUseDisplayDataGPUBuffersCurrentlyEnabled();"true"===localStorage.getItem("osOptimizedBuffersPreviouslyEnabled")!==this.areOptimizedBuffersEnabled&&(this.doClearDisplayDataCacheBeforeLoadingElement=!0),localStorage.setItem("osOptimizedBuffersPreviouslyEnabled",JSON.stringify(this.areOptimizedBuffersEnabled))}bindVao(e){this.boundVAO!==e&&(this.getVertexArrayExtension().bindVertexArrayOES(e),this.boundVAO=e)}initialize(e){if(this.eventDispatcher=new b.EventDispatcher,this.gl=null,this.requestDraw=this.requestDrawUsingTimer,window.requestAnimationFrame&&(this.requestDraw=this.requestDrawUsingAnimationFrame),this.areVertexArrayObjectsAvailable=!!this.getVertexArrayExtension(),this.timeOfContextLoss=null,this.extensions={},this.highlightVertexTexturesSupported=null,this.SSAOFilteringSupported=null,this.highPrecisionSupportedInFragmentShader=null,this.hidden=!1,this.readyState=!1,this.isForFlattenedDisplay=e&&e.isForFlattenedDisplay,this.isForPreviousVersionDisplay=e&&e.isForPreviousVersionDisplay,this.renderContext=new b.RenderContext(this),this.handleContextLoss=e=>{!function(e,t){const i=e.getMemoryGauge().getUsageDetails(),s={};Object.entries(i).forEach((([e,t])=>{s[e]=(t/1048576).toFixed(1)+" MB"})),p.log.warn(b.WEBGL_ERROR_LOG_TAG+"The WebGL context was lost. Memory usage at time of loss: "+JSON.stringify(s)),e.gl=null,e.timeOfContextLoss=(0,b.getTimeInMilliseconds)(),e.getEventDispatcher().trigger(b.GL_CONTEXT_LOST),e.showWebGLContextLostMessage(),t.preventDefault()}(this,e)},this.handleContextRestored=e=>{!function(e,t){e.getGlContext()&&(p.log.info("A context restore was received without a context loss - simulating"),e.gl=null,e.getEventDispatcher().trigger(b.GL_CONTEXT_LOST)),e.setupGlContext(),p.log.warn(b.WEBGL_ERROR_LOG_TAG+"The WebGL context was restored after "+(0,b.getTimeElapsed)(e.timeOfContextLoss).toFixed(0)+" ms"),e.timeOfContextLoss=null,e.getEventDispatcher().trigger(b.GL_CONTEXT_RESTORED,e.getGlContext()),e.onResize(),e.requestDraw(),e.hideWebGLContextLostMessage(),t.preventDefault()}(this,e)},!this.el)return void(this.viewerDestroyed=!0);this.el.addEventListener("webglcontextlost",this.handleContextLoss),this.el.addEventListener("webglcontextrestored",this.handleContextRestored);const t=e&&e.hidden;if(e&&e.glContext)this.gl=e.glContext,this.onNewGlContext();else if(!t&&(this.setupGlContext(),!this.gl))return;t&&this.hide(),this.rendererInfo=(0,b.getRendererInfo)(this.gl),(0,g.setLoggingRendererInfo)(this.rendererInfo),this.glSyncEveryFrame=!1,this.occurrenceDataManager=new b.DataManager(this),this.modelViewManagers=new b.ModelViewManagers(this.occurrenceDataManager,this),this.sceneGraphs=new b.SceneGraphs,this.uiResourceManager=new b.ResourceManager(this,this.sceneGraphs),this.uiSelectionManager=new b.UISelectionManager,this.edgePointController=null,this.silhouetteTask=new b.SilhouetteTask(this),this.occurrenceIdManager=new b.OccurrenceIdManager(this);e&&e.dontSetActive||((0,w.setActiveViewer)(this),(0,b.getActiveViewerEventDispatcher)().trigger(b.ACTIVE_VIEWER_SET)),this.getIsForFlattenedDisplay()||(this.curvatureAnalysisManager=new b.CurvatureAnalysisManager(this)),this.disableAutomaticDrawing=e&&e.disableAutomaticDrawing,this.disableViewManipulator=e&&e.disableViewManipulator,this.instantiatedShaders={},this.badShaders={},this.attribVertexEnabled={},this.boundTextures={},this.listenTo(this.getEventDispatcher(),b.SESSION_ENDED,this.onSessionEnded),this.listenTo(this.getEventDispatcher(),b.GL_CONTEXT_LOST,this.onGlContextLost),this.listenTo(this.getEventDispatcher(),b.GL_CONTEXT_RESTORED,this.onGlContextRestored),this.listenTo(this.getEventDispatcher(),b.VIEW_DID_DRAW,this.onViewDidDrawSynchronizeLocalView),(0,b.prepareShaderCode)(this),(0,b.addDrawer)(this.getViewerId(),this),this.animationController=new b.AnimationController(this),this.viewController=null,this.viewInitialized=!1,this.frameTimer=new b.FrameTimer(this),this.detailManager=new b.DetailManager(u.btInjector.AnalyticsService,this,this.frameTimer),this.loadTimer=null,this.bodyLoadTimer=null,this.elementLoadState=Z.WAITING_FOR_DISPLAY_DATA,this.shouldWaitForCompareDisplayData=!0,this.readyToUpdateElementLoadState=!1,this.receivedFeatureData=!1,this.receivedAssemblyDefinition=!1,this.isReadyForDrawOnLinkOpen=!0,this.initializedForDrawing=!1,this.renderingMode=f.GBTGraphicsRenderMode.SHADED_WITH_EDGES,this.drawPasses=[],this.mainDrawPass=null,this.combinedPickPass=null,this.depthRetrievalPass=null,this.draftAngleRetrievalPass=null,this.depthSamplingPass=null,this.uiElements={},this.elementToPerElementState={},this.activeElementId="",this.printCanvas=null,this.suppressModelSelection=!1,this.queuedBaseData=null,this.selectionMapperForQueuedBase=null,this.queuedDisplayData=[],this.haveUnitsBeenReceived=!1,this.elementUnitChangedSubscription=(0,m.getCurrentDocumentSettingsModel)().elementUnitChangedObservable.subscribe((()=>this.requestDraw())),this.memoryGauge=new b.MemoryGauge,this.boxSelectionDeferred=null,this.cursorStack=[],this.selectionCursor=b.Cursor.DEFAULT,this.lastMouseLocation=[-1,-1],this.frustumToPreventCulling=null;e&&e.disableSpaceball||(0,b.initializeSpaceballConnection)(),this.canEdit=!0,this.timestampOfLastDraw=0,this.averagePickDuration=-1,this.pickRadius=q.getNumber("MOUSE_PICK_RADIUS_PX"),this.bodyLoadTasks=new b.BodyLoadTasks(this),this.bodyLoadTask=this.bodyLoadTasks.getLoadTask(),this.bodyManager=new b.BodyManager(this,this.bodyLoadTasks.getUnloadTask()),this.modelViewManagers.getManager().setBodyLoadTasks(this.bodyLoadTasks),this.isolatedOccurrenceManager=new b.IsolatedOccurrencesManager(this),this.taskManager=new b.TaskManager,this.taskManager.addTask(this.bodyLoadTasks.getUnloadTask(),b.SMALL_INTERACTIVE_BUDGET),this.taskManager.addTask(this.bodyLoadTask,b.MEDIUM_INTERACTIVE_BUDGET),this.taskManager.addTask(this.silhouetteTask,b.SMALL_INTERACTIVE_BUDGET),this.lastDevicePixelRatio=0,this.recordCapabilitiesTimeout=null,this.hidden||(this.recordCapabilitiesTimeout=window.setTimeout((()=>{(0,b.recordWebClientCapabilities)(this.gl),this.recordCapabilitiesTimeout=null}),5e3)),this.MAX_TEXTURE_UNITS=8,this.textureNameToUnitMap={},this.textureUnitToNameMap={},this.textureAtlasFactory=null,this.sharedFrameBuffers={},this.sharedRenderBuffers={},this.resources=new b.Resources(this),this.activeElementPreviewManager=null;const i=(e,t)=>{let i=null;const s=this.pick(e,t);for(let e=0;e<s.length&&!i;++e)i=s[e].getModelSelection();let n;this.getModelViewManagers().getManager().displayingPartStudio()&&i&&i.isModifiable()&&(n=(0,S.getFeatureAssociatedWithSelection)(i),n&&n.getCanBeEdited()&&n.getIsComputed()&&(0,c.getCommandDispatcher)().trigger(o.commands.SHOW_DIMENSIONS_FOR_NODE_WITH_ID,n.getNodeId()))};this.inputHandler=null;e&&e.disableInput||(this.inputHandler=new b.InputHandler(i,this)),this.sketch=null,this.returnToPerspective=!1,this.viewManipulator=null,e&&e.disableViewManipulator||(this.viewManipulator=new b.ViewManipulator(this,e.contextMenuMgr)),this.pickPassCount=0,this.drawTimer=null,this.standardRequestCallbackQueued=!1,this.inRequestDrawCallback=!1,this.referenceHighlights=new b.ReferenceHighlights(this),this.highlightManager=new b.HighlightManager(this.referenceHighlights),this.compareHighlightManager=new b.HighlightManager(this.referenceHighlights),this.compareHighlightManager.usage=b.BTGraphicsUsage.PREVIEW,this.selectionsToKeepHiddenFromPick=[],this.performBodyCheck=!1,this.bodyCheckPass=new b.BodyCheckPass(this),this.hasElementPreviewLoaded=!1,this.storedCameraState=null,this.contextLossTimeout=null,this.zoomToSelectionBounds=null,this.listenTo(this.getEventDispatcher(),b.CANVAS_MOUSEENTER,this.onMouseEnter),this.listenTo(this.getEventDispatcher(),b.CANVAS_MOUSELEAVE,this.onMouseLeave),this.latestDisplayDataUsageSubscription=(0,b.getEditState)().latestDisplayDataUsageChangedObservable.subscribe((()=>this.onDisplayDataUsageChange())),this.listenTo((0,b.getActiveViewerEventDispatcher)(),b.DEFAULT_UNITS_CHANGED,this.onDefaultUnitsChanged),this.filteredEntitiesHighlightController=null,this.interferenceCallId="",this.xrController=new b.XrController(this),this.localDisplayDataCacheCleared=!1,this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=!1,this.smoothEdgeStyle=f.GBTSmoothEdgeStyle.VISIBLE,this.browserTabVisibilityHandler=()=>this.onBrowserTabVisibilityChanged(),document.addEventListener("visibilitychange",this.browserTabVisibilityHandler),this.themeChangeSubscription=a.ThemeTokens.getThemeChangedObservable().subscribe((()=>this.onAppearanceConstantsUpdated()))}onViewDidDrawSynchronizeLocalView(){this.pairedViewer&&this.getIsSynchingView()&&this.shouldUpdatePairedViewer&&this.syncPairedView(),this.shouldUpdatePairedViewer=!0}onViewerReactivated(){this.getBodyManager().resetSelectionListHandlers(),this.isolatedOccurrenceManager.setUpListeners(),this.modelViewManagers.getManager().resetSelectionListHandlers(),this.clearElementPreview(),this.elementToPerElementState={},this.localDisplayDataCacheCleared=!1;const e=this.getModelViewManagers().getManager().getSimulationManager();e&&e.onDocumentChange(),this.resetViewState()}showWebGLContextLostMessage(){const e=this.getModelViewManagers().getManager();if(e.displayingPartStudio()||e.displayingAssembly()){const e=s('<div class="context-loss-message">'+i18n("One moment…")+"</div>").appendTo(this.$el.parent());this.clearContextLossTimeout(),this.contextLossTimeout=window.setTimeout((()=>{e.html(k())}),r.default.getManager().getNumber("WEBGL_CONTEXT_WARNING_TIMEOUT_MS")),this.viewManipulator&&this.viewManipulator.hide()}}clearContextLossTimeout(){(0,P.isNumber)(this.contextLossTimeout)&&(window.clearTimeout(this.contextLossTimeout),this.contextLossTimeout=null)}hideWebGLContextLostMessage(){const e=this.$el.parent().find(".context-loss-message");e.length>0&&(e.remove(),this.viewManipulator&&!this.hidden&&this.viewManipulator.show())}getEventDispatcher(){return this.eventDispatcher}setEventDispatcher(e){this.eventDispatcher=e}getOccurrenceIdManager(){return this.occurrenceIdManager}getActiveElementId(){return this.activeElementId}getBodyManager(){return this.bodyManager}getIdForOccurrence(e){return e?this.occurrenceIdManager.getIdForName(e.getPathAsString()):b.PART_STUDIO_ELEMENT_ID}getModelViewManagers(){return this.modelViewManagers}isReadyToUpdateElementLoadState(){return this.readyToUpdateElementLoadState}getReceivedFeatureData(){return this.receivedFeatureData}getSceneGraphs(){return this.sceneGraphs}getUiResourceManager(){return this.uiResourceManager}getOccurrenceDataManager(){return this.occurrenceDataManager}getIsolatedOccurrenceManager(){return this.isolatedOccurrenceManager}getUISelectionManager(){return this.uiSelectionManager}getSilhouetteTask(){return this.silhouetteTask}areEdgeSilhouettesEnabled(){return this.detailManager.areFullDetailEdgeSilhouettesEnabled()}isInteractiveFramerateBelowThreshold(){return this.detailManager.isInteractiveFramerateBelowThreshold()}areInteractiveDetailsSignficantlyReduced(){return this.detailManager.getInteractiveSettings().lowLevelBodyProportion>0}isInteractiveSsaoEnabled(){return this.detailManager.isInteractiveSsaoEnabled()}areInteractiveSilhouettesEnabled(){return this.detailManager.areInteractiveSilhouettesEnabled()}getEdgePointController(){return this.edgePointController}createEdgePointController(){this.edgePointController&&this.edgePointController.disable(),this.edgePointController=new b.EdgePointController(this)}getDefaultStandardView(){return this.getIsForFlattenedDisplay()?"XY":"Trimetric"}onMouseEnter(){(0,b.setFocusedViewer)(this),this.hasMouseOver=!0}onMouseLeave(){this.hasMouseOver=!1}getHasMouseOver(){return this.hasMouseOver}getIsForFlattenedDisplay(){return!!this.isForFlattenedDisplay}getIsForPreviousVersionDisplay(){return!!this.isForPreviousVersionDisplay}getIsPrimaryViewer(){return!this.getIsForFlattenedDisplay()&&!this.getIsForPreviousVersionDisplay()}getSupportsPreview(){return!this.getIsForPreviousVersionDisplay()}requestDrawUsingTimer(e,t,i){t=t||K;const s=this;if(!this.drawTimer||i){if(!e){if(this.disableAutomaticDrawing)return;e=function(){s.drawTimer=null;s.draw(undefined,t)}}this.drawTimer=window.setTimeout(e,10)}}requestDrawUsingAnimationFrame(e,t,i){if(this.isOngoingRenderLoopRunning)return;t=t||K;const s=this;if(i||e||!this.standardRequestCallbackQueued&&!this.inRequestDrawCallback){if(e){const t=e;e=e=>{this.inRequestDrawCallback=!0,t(e),this.inRequestDrawCallback=!1}}else{if(this.disableAutomaticDrawing)return;e=function(e){s.standardRequestCallbackQueued=!1,s.inRequestDrawCallback=!0,s.draw(e,t),s.inRequestDrawCallback=!1},s.standardRequestCallbackQueued=!0}window.requestAnimationFrame(e)}}setInRequestDrawCallback(e){this.inRequestDrawCallback=e}forceRequestDraw(e){this.requestDraw(void 0,e,!0)}requestDrawForInteractiveProcessing(){this.requestDrawUsingTimer(undefined,Q)}resetPickPassCount(){this.pickPassCount=0}notifyOfPickPassCount(e){e>this.pickPassCount&&(this.pickPassCount=e)}getPickPassCount(){return this.pickPassCount}onGlContextLost(){this.resetCachedState(),this.resetSharedBuffers(),this.memoryGauge.reset(),this.frameTimer.onContextLost()}onGlContextRestored(){this.frameTimer.onContextRestored()}onSessionEnded(){this.resetShaders(),this.resetSharedBuffers(),this.resources.reset()}bindTextureToUnit(e,t){this.boundTextures[t]!==e&&(this.gl.activeTexture(this.gl.TEXTURE0+t),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.boundTextures[t]=e)}getSketch(){return this.sketch}setSketch(e){this.sketch&&(e&&this.sketch.id===e.id||this.getModelViewManagers().getManager().displaySketchAsInactive(this.sketch.id),this.sketch=null);const t=this.getPrimaryViewController();e?(e.viewer=this,this.sketch=e,this.getModelViewManagers().getManager().displaySketchAsActive(this.sketch.id),t&&t.isPerspective()&&(this.returnToPerspective=!0,this.setPrimaryViewController(t.getMatchingOrthographicController())),(0,b.getActiveViewerEventDispatcher)().trigger(b.SPACEMOUSE_ACTION_SET_CHANGED,b.ActionIds.SKETCH)):this.returnToPerspective&&(t&&t.isOrthographic()&&this.setPrimaryViewController(t.getMatchingPerspectiveController()),this.returnToPerspective=!1),this.getInputHandler()&&this.getInputHandler().setSketch(this.sketch),this.sketch||(0,b.getActiveViewerEventDispatcher)().trigger(b.SPACEMOUSE_ACTION_SET_CHANGED,b.ActionIds.PART_STUDIO)}disableCurrentLaminarHighlightController(){const e=this.getFilteredEntitiesHighlightController();e&&(e.disable(),this.setFilteredEntitiesHighlightController(null))}clearSketch(e){this.sketch===e?this.setSketch(null):p.log.info("sketch to be cleared does not match the current sketch")}setHoveredSelection(e){if(this.clearHoveredSelection(),e instanceof S.Selection)(0,S.updatePreselectionList)(e);else if(e instanceof b.UISelection){const t=this.getUISelectionManager();t&&t.setHoveredSelection(e,{})}}clearHoveredSelection(){const e=this.getUISelectionManager();e&&e.setHoveredSelection(null,{});(0,S.handleEmptyPick)(!0,!1)}getInputHandler(){return this.inputHandler}setSuppressMouseMovePick(e){this.inputHandler&&this.inputHandler.setSuppressMouseMovePick(e)}getLastMouseMovedEvent(){return this.inputHandler?this.inputHandler.getLastMouseMovedEvent():null}getLastMouseLocation(){return this.lastMouseLocation}getFrustumToPreventCulling(){return this.frustumToPreventCulling}getResources(){return this.resources}setViewInitialized(e){this.viewInitialized=e}resetCachedState(){this.attribVertexEnabled={},this.boundTextures={}}resetShaders(){this.instantiatedShaders={},this.resetCachedState()}resetSharedBuffers(){this.sharedFrameBuffers={},this.sharedRenderBuffers={}}getOrCreateFrameBuffer(e,t,i){if(!t)return new b.FrameBuffer(this,e,t,i);let s=this.sharedFrameBuffers[t];return s||(this.sharedFrameBuffers[t]=s=new b.FrameBuffer(this,e,t,i)),s}getOrCreateRenderBuffer(e,t,i){const s=i.id;let n=null;if(!s)return n=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,n),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,i.storageType,e,t),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),n;const r=this.sharedRenderBuffers[s];return r&&r.width===e&&r.height===t?r.buffer:(n=this.gl.createRenderbuffer(),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,n),this.gl.renderbufferStorage(this.gl.RENDERBUFFER,i.storageType,e,t),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.sharedRenderBuffers[s]={buffer:n,width:e,height:t},n)}resetExtensions(){const e=Object.keys(this.extensions);this.extensions={};for(let t=0;t<e.length;++t)this.getExtension(e[t])}getExtension(e){if(!this.gl)return null;let t=this.extensions[e];return void 0!==t||(t=this.gl.getExtension(e),this.extensions[e]=t),t}isExtensionSupported(e){return!!this.getExtension(e)}areFloatTexturesSupported(){return this.isExtensionSupported("OES_texture_float")}isFloatBufferBlendingSupported(){return this.isExtensionSupported("EXT_float_blend")}are32BitIndicesSupported(){return this.isExtensionSupported("OES_element_index_uint")}areShaderDerivativesSupported(){return!!this.getExtension("OES_standard_derivatives")}isHighPrecisionFragmentShaderSupported(){return(0,b.isHighPrecisionFragmentShaderSupported)(this.gl)}getAnisotropicExtension(){return this.getExtension("EXT_texture_filter_anisotropic")||this.getExtension("WEBKIT_EXT_texture_filter_anisotropic")}getDrawbuffersExtension(){return this.getExtension("WEBGL_draw_buffers")||this.getExtension("EXT_draw_buffers")}getVertexArrayExtension(){return this.getExtension("OES_vertex_array_object")}getHalfFloatType(){const e=this.getExtension("OES_texture_half_float");return e?e.HALF_FLOAT_OES:0}getDefaultFloatTextureType(){return this.getHalfFloatType()||this.gl.FLOAT}getHighPrecisionFloatTextureType(){return this.gl.FLOAT}getReferenceHighlights(){return this.referenceHighlights}getHighlightManager(e){return b.BTGraphicsUsage.PREVIEW===e?this.compareHighlightManager:this.highlightManager}resetHighlightManagers(){this.highlightManager=new b.HighlightManager(null),this.compareHighlightManager=new b.HighlightManager(null)}updateHighlightColors(e){L.highlightTypesThatChangeColor.forEach((t=>{this.getReferenceHighlights().updateHighlightColor(t,e)})),(0,b.updateMateConnectorSelectedColor)(e);for(const e in this.uiElements)this.uiElements[e].onHighlightColorUpdated()}areHighlightVertexTexturesSupported(){if(null===this.highlightVertexTexturesSupported)if(this.gl){const e=this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.highlightVertexTexturesSupported=e>1}else p.log.warn("An attempt was made to evaluate whether or not highlight vertex textures are supported before the gl context was initialized");return!!this.highlightVertexTexturesSupported}getRendererInfo(){return this.rendererInfo}isSSAOFilteringSupported(){return null===this.SSAOFilteringSupported&&(this.SSAOFilteringSupported=!/intel/gi.test(this.rendererInfo.glRenderer)),this.SSAOFilteringSupported}isHighPrecisionSupportedInFragmentShader(){if(null!==this.highPrecisionSupportedInFragmentShader)return this.highPrecisionSupportedInFragmentShader;if(!this.gl)return!1;const e=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT);return this.highPrecisionSupportedInFragmentShader=0!==e.precision,this.highPrecisionSupportedInFragmentShader}supportsOrderIndependentTranslucency(){return this.areFloatTexturesSupported()}supportsGraphicalSectionPlanes(){return this.areFloatTexturesSupported()&&this.isFloatBufferBlendingSupported()}getIsExcludingItemsForSection(){return(0,F.getActiveSectionViewState)().getIsExcludingItemsForSection()}supportsDraftAnalysis(){return this.areFloatTexturesSupported()}getTextureAtlasFactory(){return this.textureAtlasFactory||(this.textureAtlasFactory=new b.Factory),this.textureAtlasFactory}debugGetAllocatedTextureUnitsString(){const e=Object.keys(this.textureNameToUnitMap);let t="Texture allocation: ";for(let i=0;i<e.length;++i)t+=e[i]+": "+this.textureNameToUnitMap[e[i]]+", ";return t}getOrAllocateTextureUnit(e){if(this.textureNameToUnitMap.hasOwnProperty(e))return this.textureNameToUnitMap[e];let t=0;for(;t<this.MAX_TEXTURE_UNITS&&this.textureUnitToNameMap[t];)t++;return t>=this.MAX_TEXTURE_UNITS?(p.log.error("Ran out of texture units (max "+this.MAX_TEXTURE_UNITS+") storing "+e+". Allocation: "+this.debugGetAllocatedTextureUnitsString()),-1):(this.textureNameToUnitMap[e]=t,this.textureUnitToNameMap[t]=e,t)}releaseTextureUnit(e){if(!this.textureNameToUnitMap.hasOwnProperty(e))return void p.log.error("Could not find texture unit for "+e);const t=this.textureNameToUnitMap[e];delete this.textureNameToUnitMap[e],delete this.textureUnitToNameMap[t]}getTextureUnit(e){return this.textureNameToUnitMap[e]}getGlContext(){return this.gl}getShader(e){let t=this.instantiatedShaders[e];return t||(t=new b.ShaderProgram(this,e),this.instantiatedShaders[e]=t),t}enableVertexAttributeArray(e,t){(this.areVertexArrayObjectsAvailable||this.attribVertexEnabled[e]!==t)&&(t?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e),this.areVertexArrayObjectsAvailable||(this.attribVertexEnabled[e]=t))}disableAllVertexAttributeArrays(){for(const e in this.attribVertexEnabled)this.enableVertexAttributeArray(+e,!1)}setupGlContext(){if(this.gl=null,!(this.el instanceof HTMLCanvasElement))return;let e=null;const t=["webgl","experimental-webgl","webkit-3d","moz-webgl"];for(let i=0;i<t.length;++i){try{e=this.el.getContext(t[i],$),e instanceof WebGLRenderingContext||e instanceof CaptureContext||(e=null)}catch(e){}if(e)break}e&&(this.gl=e,this.onNewGlContext())}onNewGlContext(){this.gl&&(this.gl.frontFace(this.gl.CCW),this.gl.enable(this.gl.DEPTH_TEST)),this.resetExtensions(),this.rendererInfo=(0,b.getRendererInfo)(this.gl),(0,g.setLoggingRendererInfo)(this.rendererInfo),this.glSyncEveryFrame=(0,D.isPlatformMac)()&&(0,D.isBrowserSafari)()&&/intel/i.test(this.rendererInfo.glVendor),this.renderContext.onNewContext(this.gl),(0,b.initialize32BitIndexSupport)(this.are32BitIndicesSupported()),(0,b.setRendererInfo)(this.rendererInfo)}getWebGlSupport(){let e=N.CoreWebGlSupport.SUPPORTED;return this.el?window.WebGLRenderingContext?this.gl||(e=N.CoreWebGlSupport.OTHER_PROBLEM):e=N.CoreWebGlSupport.MISSING:e=N.CoreWebGlSupport.OTHER_PROBLEM,e}getViewerId(){return this.cid}getFrameTimer(){return this.frameTimer}setDevicePixelRatioOverride(e){const t=X(Math.max(this.$el.width(),1),e),i=X(Math.max(this.$el.height(),1),e);(0,O.setDevicePixelRatioOverride)(e),this.el.width=t,this.el.height=i,this.getCamera().setViewportFromCanvasElement(this.$el),this.stopBoxSelection(),this.draw()}onResize(e){e=void 0===e||e;const t=this.getGlContext();if(!t)return;if(!this.el)return;let i=(0,O.getDevicePixelRatioWithoutOverride)(),s=X(Math.max(this.$el.width(),1),i),n=X(Math.max(this.$el.height(),1),i);if((0,D.isBrowserSafari)()){const e=X(screen.width,i),t=X(screen.height,i);if(s>e||n>t){const r=Math.min(e/s,t/n);p.log.info("Canvas dimensions exceeded screen size, scaling by a factor of: "+r.toFixed(4)),i*=r,(0,O.setDevicePixelRatioOverride)(i),s=X(Math.max(this.$el.width(),1),i),n=X(Math.max(this.$el.height(),1),i)}else(0,O.clearDevicePixelRatioOverride)()}this.el.width=s,this.el.height=n,t.viewportWidth=this.el.width,t.viewportHeight=this.el.height,t.aspectRatio=this.el.width/this.el.height,this.mainDrawPass&&(this.setUserIsManipulatingWithTimeout(),this.getCamera().setViewportFromCanvasElement(this.$el),this.stopBoxSelection(),e&&this.requestDraw())}pushCameraState(e){let t=e;t||(t=this.getCamera()),this.renderContext.setActiveCamera(t),this.renderContext.pushModelViewMatrix(t.getViewMatrix()),this.renderContext.pushProjectionMatrix(t.getProjectionMatrix()),this.renderContext.pushViewport(t.getViewport())}popCameraState(){this.renderContext.popModelViewMatrix(),this.renderContext.popProjectionMatrix(),this.renderContext.popViewport()}setBaseFrameBuffer(e){this.baseFrameBuffer=e}setBaseFrameBufferToDefault(){this.baseFrameBuffer=null}getBaseFrameBufferWidth(){return this.baseFrameBuffer?this.baseFrameBuffer.getWidth():this.getCamera().getCanvasWidth()}getBaseFrameBufferHeight(){return this.baseFrameBuffer?this.baseFrameBuffer.getHeight():this.getCamera().getCanvasHeight()}onComputedData(e){if(e.elementId!==this.activeElementId)return;(this.modelViewManagers.getPreviewManager()||this.modelViewManagers.getManager()).processManagedData(e),this.readyAndUpdateElementLoadState(e.elementId)}readyAndUpdateElementLoadState(e){e===this.activeElementId&&(this.readyToUpdateElementLoadState=!0,this.updateElementLoadState())}onFeatureData(e){e===this.activeElementId&&(this.receivedFeatureData=!0,this.updateElementLoadState())}onAssemblyDefinition(e){e===this.activeElementId&&(this.receivedAssemblyDefinition=!0,this.readyToUpdateElementLoadState=!0,this.updateElementLoadState())}setWaitingForLinkOpen(){this.isReadyForDrawOnLinkOpen=!1}onReadyForDrawOnLinkOpen(){this.isReadyForDrawOnLinkOpen=!0,this.updateElementLoadState()}prepareElementDisplayData(){this.elementLoadState===Z.LOADING_DISPLAY_DATA&&(this.modelViewManagers.getManager().getModelBounds(),this.loadingDisplayDataTimer.report(),this.loadingDisplayDataTimer=null,this.elementLoadState=Z.LOADED_DISPLAY_DATA,this.updateElementLoadState())}updateElementLoadState(){const e=this.modelViewManagers.getManager();this.elementLoadState!==Z.LOADED_DISPLAY_DATA||!this.readyToUpdateElementLoadState||!this.isReadyForDrawOnLinkOpen||!this.receivedFeatureData&&e.displayingPartStudio()||!this.receivedAssemblyDefinition&&e.displayingAssembly()||(this.getEventDispatcher().trigger(b.ELEMENT_VIEW_INITIALIZED,this.activeElementId),this.elementLoadState=Z.LOADED_ALL_DATA,this.clearElementPreview(),this.bodyLoadTask.hasPendingWork()?(this.doesControlBodySpinner()&&(0,C.TaskBeeperManagerGetSingleton)().startBodyLoadBeeper(),this.bodyLoadTimer=new l.Timer("Loading bodies, isForFlattened: "+this.getIsForFlattenedDisplay(),ie())):this.doesControlBodySpinner()&&(0,C.TaskBeeperManagerGetSingleton)().stopBodyLoadBeeper(),this.loadTimer&&(this.loadTimer.report(),this.loadTimer=null),this.setReadyState(!0),this.requestDraw())}hasPendingBodiesToLoad(){return this.bodyLoadTask.hasPendingWork()}getPendingBodiesToLoadPromise(){return this.bodyLoadTask.getTaskFinishedPromise()}hasPendingWork(){return this.bodyLoadTask.hasPendingWork()||this.taskManager.hasPendingWork()}doesControlBodySpinner(){return!this.getIsForFlattenedDisplay()}getRenderContext(){return this.renderContext}getMemoryGauge(){return this.memoryGauge}getRenderingMode(){return this.renderingMode}preventChangeToRenderMode(e){var t;return!!(null===(t=this.getCurvatureAnalysisManager())||void 0===t?void 0:t.preventChangeToRenderMode(e))||!!this.preventZebraStripesDuringInterferenceDetection(e)}preventZebraStripesDuringInterferenceDetection(e){const t=i18n("Zebra stripes are not supported during interference detection");if(void 0===e&&this.renderingMode===f.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION)return u.btInjector.MessageBubbleService.showMessageWithAutoDismiss(t,"warning"),this.setRenderingMode(f.GBTGraphicsRenderMode.SHADED_WITH_EDGES),!0;if(e===f.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION){if(h.DocumentController.getOpenDocumentController().isInterferenceDetectionActive())return u.btInjector.MessageBubbleService.showMessageWithAutoDismiss(t,"warning"),!0}return!1}setRenderingMode(e){var t,i;if(this.preventChangeToRenderMode(e))return;this.renderingMode=e,this.renderContext.setRenderingMode(e),this.mainDrawPass.setRenderingMode(e),this.combinedPickPass.setRenderingMode(e);const s=this.getModelViewManagers().getManager().getSimulationManager();s&&s.onRenderingModeChanged(),null===(t=this.getCurvatureAnalysisManager())||void 0===t||t.onRenderingModeChanged(),null===(i=this.getThicknessAnalysisManager())||void 0===i||i.onRenderingModeChanged(),this.renderModeSubject.next(e),this.requestDraw()}toggleDebugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle(){this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=!this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle}debugIsShowingSilhouetteEdgesOnNonVisibleTangentEdgeStyle(){return this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle}showTangencyInformationMissingMessage(){this.localDisplayDataCacheCleared||(p.log.trace("Unknown smoothness status edge found, clearing local display data cache"),(0,c.getCommandDispatcher)().trigger(o.commands.CLEAR_LOCAL_DISPLAY_DATA_CACHE),this.localDisplayDataCacheCleared=!0),u.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("Render mode could not be applied. Necessary information is missing in older display data."),"warning")}getSmoothEdgesRenderStyle(){return this.smoothEdgeStyle}setSmoothEdgesRenderStyle(e){if(this.smoothEdgeStyle===e)return;this.smoothEdgeStyle=e,this.getIsForFlattenedDisplay()||(0,b.applySmoothEdgesRenderingStyleChanges)(e);const t=this.getModelViewManagers();if(t.getManager().refreshSmoothEdgesForAllPartStudios()){if(t.previewManagerExists()&&t.getPreviewManager().refreshSmoothEdgesForAllPartStudios(),!this.getIsForFlattenedDisplay()){const t=d.LeaderFollowController.getController();t&&t.onSmoothEdgeStyleChanged(this);const i=h.DocumentController.getOpenDocumentController();if(i){const t=i.getSheetMetalViewer();t&&this!==t&&this.getActiveElementId()===t.getActiveElementId()&&(t.setSmoothEdgesRenderStyle(e),t.requestDraw())}}}else this.setSmoothEdgesRenderStyle(f.GBTSmoothEdgeStyle.VISIBLE)}initializeForDrawing(){this.initializedForDrawing||(this.onResize(),this.mainDrawPass=new b.MainDrawPass(this),this.drawPasses.push(this.mainDrawPass),this.combinedPickPass=new b.CombinedPickPass(this,this.mainDrawPass),this.mainDrawPass.getDebugDrawPickPass().setPickPass(this.combinedPickPass),this.drawPasses.push(this.combinedPickPass),this.depthRetrievalPass=new b.DepthRetrievalPass(this),this.drawPasses.push(this.depthRetrievalPass),this.draftAngleRetrievalPass=new b.DraftAngleRetrievalPass(this),this.drawPasses.push(this.draftAngleRetrievalPass),this.depthSamplingPass=new b.DepthSamplingPass(this),this.drawPasses.push(this.depthSamplingPass),this.mainDrawPass.prepareShaders(),this.combinedPickPass.prepareShaders(),this.depthRetrievalPass.prepareShaders(),this.depthSamplingPass.prepareShaders(),this.viewController||(this.viewController=new b.OrthographicController(this),this.viewController.getCamera().setViewportFromCanvasElement(this.$el),this.viewController.setStandardView(this.getDefaultStandardView())),this.initializedForDrawing=!0,(0,D.isPlatformChromebook)()&&(0,D.getChromeVersion)()>=107&&this.mainDrawPass.setClearColor(1,1,1,1))}initializeView(){if(!this.viewInitialized){const e=this.getCamera(),t=e.getViewportWidth()*e.getViewportHeight()>=q.getNumber("MIN_MODEL_PIXEL_SIZE"),i=this.getModelBounds();if(t&&i.isInitialized()&&i.isExtensive()){const e=!0;this.zoomFit(e),this.viewInitialized=!0}this.findDepthsInRect(0,0,1,1)}}hasResourcesNeededForDrawing(){const e=!this.isForFlattenedDisplay||this.modelViewManagers.getManager().hasSelectedSheetmetalModelId();return(this.hasElementPreviewLoaded||this.elementLoadState===Z.LOADED_ALL_DATA)&&!(0,b.areTexturesPendingLoad)()&&e}isReadyForDrawing(){return!!this.getGlContext()&&this.initializedForDrawing&&this.hasResourcesNeededForDrawing()}getFilteredEntitiesHighlightController(){return this.filteredEntitiesHighlightController}setFilteredEntitiesHighlightController(e){return this.filteredEntitiesHighlightController=e,this.filteredEntitiesHighlightController}draw(e,t){if(this.viewerDestroyed)return;const i=this.getGlContext();if(!i)return;t=t||ee;const s=(0,O.getDevicePixelRatio)();if(s!==this.lastDevicePixelRatio){t.forPrint||this.el.width===X(this.$el.width(),s)&&this.el.height===X(this.$el.height(),s)||this.onResize(!1),this.lastDevicePixelRatio=s;const e=t.camera||this.getCamera();this.getEventDispatcher().trigger(b.DEVICE_PIXEL_RATIO_CHANGED,e),this.resources.onDevicePixelRatioChanged();for(const t in this.uiElements)this.uiElements[t].onDevicePixelRatioChanged(e);this.resetPickRadius()}if(e){if(e===this.timestampOfLastDraw)return;this.timestampOfLastDraw=e,(0,b.onViewerDraw)(this,e)}if(this.initializeForDrawing(),this.prepareElementDisplayData(),!this.hasResourcesNeededForDrawing())return void(this.hidden||this.processPendingWork());this.initializeView(),t.performFrameTiming&&this.frameTimer.onDrawStart(),this.renderContext.setDetailSettings(this.detailManager.getDetailSettings()),(0,b.getCounters)().resetCounters();const n=t.camera?t.camera:this.getCamera();this.triggerOnViewWillDraw(n),this.processPendingWork(),this.cleanUpOrphanedObjects(),n.setSceneBounds(this.getSceneBounds()),this.pushCameraState(n),t.skipUpdateBodyCulling||this.bodyManager.updateForFrame(this.renderContext,!0),this.renderContext.prepareForNextFrame(),this.mainDrawPass.drawInputs(this.renderContext),this.mainDrawPass.draw(this.renderContext),this.popCameraState(),this.getEventDispatcher().trigger(b.VIEW_DID_DRAW,this),this.memoryGauge.addToStatistics(),(0,b.getCounters)().updateModel(),this.performBodyCheckAsNeeded(),this.glSyncEveryFrame&&i.finish(),t.performFrameTiming&&this.frameTimer.onDrawEnd()}triggerOnViewWillDraw(e){const t=(0,m.getCurrentDocumentSettingsModel)();this.getEventDispatcher().trigger(b.VIEW_WILL_DRAW,e,t);for(const i in this.uiElements)this.uiElements[i].onViewWillDraw(e,t)}processPendingWork(){this.taskManager.hasPendingWork()&&!this.frameTimer.userIsInteracting()&&(this.taskManager.processInteractively(),this.requestDrawForInteractiveProcessing()),this.bodyLoadTask.hasPendingWork()||(this.bodyLoadTimer&&(this.doesControlBodySpinner()&&(0,C.TaskBeeperManagerGetSingleton)().stopBodyLoadBeeper(),this.bodyManager.initiateAutomaticRetrieval(),this.bodyLoadTimer.report(),this.frameTimer.resetTimings(),this.bodyLoadTimer=null),this.hasResourcesNeededForDrawing()||this.modelViewManagers.getManager().getMeshManager().compileBuffers())}performBodyCheckAsNeeded(){this.performBodyCheck&&this.areFloatTexturesSupported()&&!this.bodyLoadTask.hasPendingWork()&&this.modelViewManagers.getManager().displayingPartStudio()&&(this.bodyCheckPass.draw(this.renderContext),this.performBodyCheck=!1)}cleanUpOrphanedObjects(){this.getUiResourceManager().clean(),(0,b.cleanUpParentlessNodes)(),this.disableAllVertexAttributeArrays()}getSceneBounds(){let e=new b.BoundingBox;const t=this.sceneGraphs.getMainSceneGraph().getRootNode().getBoundingBox({includeHiddenBounds:this.renderContext.getIsPickingHiddenOccurrences()}),i=this.sceneGraphs.getPreviewSceneGraph().getRootNode().getBoundingBox();e.addBox(t),e.addBox(i);const s=this.modelViewManagers.getManager().getSimulationManager();s&&e.addBox(s.getSimulationBounds());return(!e.isInitialized()||!e.isExtensive())&&this.hasElementPreviewLoaded&&this.activeElementPreviewManager&&e.addBox(this.activeElementPreviewManager.getModelBounds()),this.zoomToSelectionBounds&&this.zoomToSelectionBounds.isFinite()&&e.addBox(this.zoomToSelectionBounds),e.isInitialized()&&e.isExtensive()||(e=this.getDefaultBounds()),e}getDefaultBounds(){const e=new b.BoundingBox;return e.set([-1,-1,-1],[1,1,1]),e}getModelBounds(e){const t=new b.BoundingBox,i=this.modelViewManagers.getManager().getModelBounds(e);i&&t.addBox(i,null);const s=this.modelViewManagers.getPreviewManager();return s&&t.addBox(s.getModelBounds(e),null),t.isInitialized()&&t.isExtensive()||!this.hasElementPreviewLoaded||!this.activeElementPreviewManager||t.addBox(this.activeElementPreviewManager.getModelBounds()),t}getUiElementsBounds(){const e=new b.BoundingBox;for(const t in this.uiElements){const i=this.uiElements[t];i.isVisibleToUser()&&e.addBox(i.getFitBounds(),i.getTransform())}return e}getFitBounds(e){let t=this.getUiElementsBounds();if(t.addBox(this.getModelBounds()),!t.isInitialized()||!t.isExtensive())return this.getSceneBounds();if((0,b.getSectionPlaneCount)()>0&&this.isReadyForDrawing()){e||(e=this.getCamera().getFrame());const i=this.getPrimaryViewController().getZoomFitTargetCamera(e,t,!0);this.pushCameraState(i),(0,b.makePlaneEquationMatrixDirty)(),this.bodyManager.updateForFrame(this.renderContext,!1),this.depthSamplingPass.retrieve(this.renderContext,{numSamples:q.getNumber("HIGH_QUALITY_DEPTH_SAMPLES_PER_VIEWPORT"),performIsolationTest:!1}),this.popCameraState();const s=new b.BoundingBox;for(let e=0;e<this.depthSamplingPass.points.length;++e)s.addPoint(i.canvasToWorld(this.depthSamplingPass.points[e]));if(!s.isInitialized()||!s.isExtensive())return this.getSceneBounds();s.maxDimension()/t.maxDimension()<.9&&s.scale(q.getNumber("CAMERA_ZOOM_TO_FIT_SECTION_PLANE_EXTRA_SLOP")),t=s}return t}getAnimationController(){return this.animationController}getPrimaryViewController(){return this.viewController}getCamera(){return this.debugCamera?this.debugCamera:this.viewController?this.viewController.getCamera():null}setPrimaryViewController(e){this.viewController!==e&&(this.viewController&&this.viewController.destroy(),this.viewController=e,this.requestDraw())}setPickRadius(e){this.pickRadius=e}resetPickRadius(){this.setPickRadius(q.getNumber("MOUSE_PICK_RADIUS_PX"))}pick(e,t,i){return this.pickIteratively(e,t,this.getDefaultPickTerminationEvaluator(),i)}getDefaultPickTerminationEvaluator(){let e=0;return(t,i)=>++e>100||this.combinedPickPass.updatePickMask(t,this.renderingMode,i)}pickIteratively(e,t,i,s){const n=[];let r,a;const o=2*this.pickRadius+1,c=2*this.pickRadius+1,l=e-this.pickRadius,h=t-this.pickRadius;let d=!1,u=0;const g={},m=this.modelViewManagers.getManagerForUsage((0,b.getPickUsage)()),E=this.getRenderingMode();for(;;){const e=this.pickInRect(l,h,o,c,{pickHiddenOccurrences:!!s&&!!s.pickHiddenOccurrences,cameraOverride:s?s.cameraOverride:null});if(e.length<1)break;for(r=0;r<e.length;++r){a=e[r];const t=a.getModelSelection();if(t){const e=t.getIdForCollection();if(!e||g[e])continue;g[e]=e}a.fromPass=u,n.push(a)}if(i(e,s))break;for(r=0;r<e.length;++r)e[r].canPickThrough(E,this,s)&&(this.hidePick(e[r],m),d=!0);++u}return this.combinedPickPass.clearPickMask(),d&&this.resetIdsHiddenFromPick(),s&&s.altKey?(0,B.pickSortWithTranslucency)(n,(e=>{const t=e.getModelSelection();if(null===t)return p.log.warn("Cannot determine translucency of pick element for sorting, assuming default opacity."),!1;if(t.entityMetaData&&t.entityMetaData.isTranslucent())return!0;const i=t.getOccurrence(),s=e.getOccurrenceId(),n=m.getPartStudioDataFromOccurrence(i);if(!n)return!1;const r=n.getBodyComponent().getFaceColor(e.deterministicId,s);return r&&r[3]<1})):n.sort(B.basicPickSort)}pickMany(e,t,i,s){const n=2*i+1,r=2*i+1,a=e-i,o=t-i;return this.pickManyInRect(a,o,n,r,!0,!1,s)}pickInRect(e,t,i,s,n){if(!this.isReadyForDrawing())return[];const r=n&&n.cameraOverride?n.cameraOverride:this.getCamera();this.getEventDispatcher().trigger(b.VIEW_WILL_PICK,r,(0,m.getCurrentDocumentSettingsModel)());const a=null==n?void 0:n.pickHiddenOccurrences;let o,c;this.renderContext.setIsPickingHiddenOccurrences(a),r.setSceneBounds(this.getSceneBounds()),this.pushCameraState(r),this.combinedPickPass.setPickRect(e,t,i,s,n&&n.sampleLimit),n&&n.doNotAffectFrustumCulling||(this.frustumToPreventCulling=this.combinedPickPass.getPickFrustum(this.renderContext,j)),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),n&&n.nodeFilterOverride?this.combinedPickPass.setNodeFilterOverride(n.nodeFilterOverride):this.combinedPickPass.setNodeFilterOverride(null),this.combinedPickPass.setPickFromPreview((0,b.pickFromPreview)()||!!n&&!!n.forcePreviewPick),this.combinedPickPass.draw(this.renderContext),this.renderContext.setIsPickingHiddenOccurrences(!1),this.popCameraState();const l=this.combinedPickPass.gatherPicksFromPickPass(),h=[];let d;const u=this.modelViewManagers.getManagerForUsage(this.combinedPickPass.getUsage());for(c in l){c=+c;const e=this.getOccurrenceIdManager().getNameForId(+c);e||c===b.NO_ID||this.loggedPickIssue||(p.log.warn("Did not find valid occurrence name for occurrence id: "+c),this.loggedPickIssue=!0);let t=null,i=null;const s=(0,b.isOccurrenceNameForUi)(e);if(s){if(i=this.uiElements[e],!i){this.loggedPickIssue||(p.log.warn("Could not find ui element with name: "+e),this.loggedPickIssue=!0);continue}}else e&&"PART_STUDIO_SKETCHES"!==e&&0!==e.indexOf("body.")&&(t=f.BTOccurrence.getOccurrenceFromPathString(e));for(o in l[c]){if(d=l[c][o],s){if(d.uiSelection=i.getSelection(d.occurrenceId,d.primitiveId),!d.uiSelection){this.loggedPickIssue||(p.log.warn("Could not find owner of mouse pick"),this.loggedPickIssue=!0);continue}d.uiSelection.sourcePick=d}else{if(this.bodyManager.isBodyManagerOccurrence(t)){a?this.bodyManager.updatePickData(d)&&h.push(d):n&&n.bodyPicks?n.bodyPicks.push(d):this.bodyManager.pickedOccurrenceId(d.primitiveId);continue}{if(d.deterministicId=u.getDeterministicIdForPickId(t,d.primitiveId),!d.deterministicId){this.loggedPickIssue||(p.log.warn("Did not find picked entity's deterministic id"),this.loggedPickIssue=!0);continue}const e=u.retrieveEntityMetaData(t,d.deterministicId);if(d.featureIdList=u.retrieveAssociatedFeatureIds(t,d.deterministicId),e)d.entityMetaData=e;else if(d.bodyMetaData=u.retrieveBodyMetaData(t,d.deterministicId),!d.bodyMetaData){this.loggedPickIssue||(p.log.warn("Did not find picked deterministic id's metadata"),this.loggedPickIssue=!0);continue}d.occurrence=t}}h.push(d)}}return this.mainDrawPass.getDebugDrawPickPass().getEnabled()&&this.requestDraw(),h}retrieveVisiblePicks(e,t,i,s){if(!this.combinedPickPass)return p.log.warn("Pick pass is not initialized"),null;this.combinedPickPass.setEnablePickViewportScaling(!1);const n=this.pickInRect(e,t,i,s);return this.combinedPickPass.setEnablePickViewportScaling(!0),n}getUiElements(){return this.uiElements}pickManyInRect(e,t,i,s,n,r,a){this.combinedPickPass.setPickAlternatesEnabled(!0),this.renderContext.setBackFacePicking(n),r&&this.subtractEntitiesIntersectingBox(e,t,i,s);const o=this.pickManyInRectInternal(e,t,i,s,a);return this.renderContext.setBackFacePicking(!1),this.combinedPickPass.setPickAlternatesEnabled(!1),this.resetIdsHiddenFromPick(),o}subtractEntitiesIntersectingBox(e,t,i,s){const n=Math.max(e-1,0),r=Math.max(t-1,0),a=Math.min(t+s,this.getCamera().getViewportHeight()-1),o=Math.min(e+i,this.getCamera().getViewportWidth()-1);this.pickAllInBox(n,r,o-n,1),this.pickAllInBox(n,a,o-n,1),a-r>2&&(this.pickAllInBox(n,r+1,1,a-r-2),this.pickAllInBox(o,r+1,1,a-r-2))}pickAllInBox(e,t,i,s){this.pickManyInRectInternal(e,t,i,s,void 0,void 0,!0)}performingBoxSelection(){return!!this.boxSelectionDeferred}performBoxSelection(e,t,i,s,n){if(this.performingBoxSelection())return null;if(0===i||0===s)return null;(0,C.TaskBeeperManagerGetSingleton)().startBoxSelectionBeeper(),(0,S.clearBoxSelectionPreviewSelectionList)(),this.combinedPickPass.setPickAlternatesEnabled(!0),this.combinedPickPass.setIsBoxSelecting(!0),this.renderContext.setBackFacePicking(!0),n&&this.subtractEntitiesIntersectingBox(e,t,i,s),this.boxSelectionDeferred=T.defer();const r=this.boxSelectionDeferred.promise,a=this,o=function(){if(!a.performingBoxSelection())return;a.setUserIsManipulatingWithTimeout();const n=a.pickManyInRectInternal(e,t,i,s,void 0,15,!0);n.length>0?((0,S.addPicksToBoxSelectionPreview)(n),(0,b.getActiveViewerEventDispatcher)().trigger(L.PICKS_BOX_SELECTED,n),a.draw(),setTimeout(o,45)):((0,S.completeBoxSelection)(),a.stopBoxSelection())};return setTimeout(o,10),r}setSuppressNonIsolatedPicks(e){this.combinedPickPass.setSuppressNonIsolatedPicks(e)}stopBoxSelection(){this.performingBoxSelection()&&(this.renderContext.setBackFacePicking(!1),this.combinedPickPass.setIsBoxSelecting(!1),this.combinedPickPass.setPickAlternatesEnabled(!1),this.resetIdsHiddenFromPick(),this.boxSelectionDeferred.resolve(),this.boxSelectionDeferred=null,(0,C.TaskBeeperManagerGetSingleton)().stopBoxSelectionBeeper(),(0,S.clearBoxSelectionPreviewSelectionList)(),this.processQueuedDisplayData(),this.doPreHighlightPick(!0),(0,b.getActiveViewerEventDispatcher)().trigger(L.BOX_SELECTION_FINISHED))}canProcessDisplayData(){return this.haveUnitsBeenReceived&&!this.performingBoxSelection()}processQueuedDisplayData(e){if(e&&this.stopBoxSelection(),this.canProcessDisplayData()){for(let e=0;e<this.queuedDisplayData.length;++e){const t=this.queuedDisplayData[e];t.displayData instanceof f.BTPartStudioDisplayData?this.onNewPartStudioDisplayData(t.displayData,t.selectionMapper):t.displayData instanceof f.BTRootAssemblyDisplayData&&this.onRootAssemblyDisplayData(t.displayData)}this.queuedDisplayData=[]}}setUnitsReceived(e){this.haveUnitsBeenReceived=e,e&&this.processQueuedDisplayData()}isPickFromHiddenOccurrence(e){const t=this.occurrenceDataManager.getOccurrenceData(e.occurrenceId);return t&&t.getVisibility()===b.Visibility.HIDDEN}resetIdsHiddenFromPick(){this.occurrenceDataManager.resetHiddenFromPick(),(0,b.resetSectionPlanesHiddenFromPick)();const e=this.getModelViewManagers().getManager();for(let t=0;t<this.selectionsToKeepHiddenFromPick.length;++t){const i=this.selectionsToKeepHiddenFromPick[t],s=e.getEntityIdsForSelection(i),n=e.getOccurrenceIdForSelection(i),r=i.getOccurrence();if((0,b.isIdValid)(n))for(let t=0;s&&t<s.length;++t)e.hideEntityFromPick(s[t],n,r)}}setSelectionsToKeepHiddenFromPick(e){this.selectionsToKeepHiddenFromPick=e,this.resetIdsHiddenFromPick()}resetSelectionsToKeepHiddenFromPick(){this.setSelectionsToKeepHiddenFromPick([])}getClosestPointAtPixel(e,t,i){const s=2*i+1,n=2*i+1,r=e-i,a=t-i,o=this.findDepthsInRect(r,a,s,n);let c=null,l=1/0;for(let e=0;e<o.length;++e)if(o[e][2]!==b.UNKNOWN_DEPTH){const t=o[e],i=t[2];i<l&&(c=t,l=i)}return c?(c[0]=e,c[1]=t,this.getCamera().canvasToWorld(c)):null}pickManyInRectInternal(e,t,i,s,n,r,a){const o=[];let c=new _.StringSet;const l=new _.StringSet,h=(0,b.getTimeInMilliseconds)();let d=!1;const u=a?(0,S.getCurrentBoxSelectionFilter)():(0,S.getCurrentSelectionQueryFilter)();if(a){d=(0,S.getAllowedBoxSelections)().allowsBodies}const g=this.modelViewManagers.getManagerForUsage((0,b.getPickUsage)());let m=0;do{const r=this.pickInRect(e,t,i,s),a=new _.StringSet;for(let e=0;e<r.length;++e){const t=r[e];t.fromPass=m;let i=!0,s=t.getId();const h=t.getBodyId();if(h&&d){const e=h+A.ID_SEPARATOR+t.occurrenceId;l.contains(e)?i=!1:!u||u.doesBodyLevelSelectionPass(t.getModelSelection())?(g.hideBodyFromPick(h,t.occurrenceId,t.occurrence),l.add(e),s=e):this.hidePick(t,g)}else this.hidePick(t,g);if(c.contains(s))return p.log.warn("The same pick was found twice, when it should have been hidden"),[];if(a.add(s),i&&o.push(t),n&&o.length>=n)break}if(0===r.length||n&&o.length>=n)break;c=a,++m}while(void 0===r||(0,b.getTimeInMilliseconds)()-h<r);return o}hidePick(e,t){e.isUIPick()?e.uiSelection.hideFromPick():!e.deterministicId&&e.isBodyPick()?this.bodyManager.hideBodyFromPick(e):t.hideEntityFromPick(e.getIncrementId(),e.occurrenceId,e.occurrence),(0,b.hideSectionPlaneFromPick)(e.occurrenceId)}findDepthsInRect(e,t,i,s,n,r){return this.isReadyForDrawing()?(this.pushCameraState(r),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),n=void 0===n||n,this.depthRetrievalPass.setPickRect(e,t,i,s),this.depthRetrievalPass.retrieve(this.renderContext,n),this.popCameraState(),this.depthRetrievalPass.points):[]}findDraftAngle(e,t,i,s,n){return s=s||1,n=n||1,this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.draftAngleRetrievalPass.setOccurrenceIds(this.mainDrawPass.draftAnalysisPass.getIdsToParts()),this.draftAngleRetrievalPass.setDirection(e),this.draftAngleRetrievalPass.setPickRect(t,i,s,n),this.draftAngleRetrievalPass.retrieve(this.renderContext),this.popCameraState(),this.draftAngleRetrievalPass.points):[]}findScalarVisualizationScalar(e,t,i,s,n,r){if(!this.isReadyForDrawing())return[];n=n||1,r=r||1;let a=this.scalarRetrievalPasses.find((t=>t.managerNodeId===e));a||(a=new b.ScalarRetrievalPass(this,e),this.scalarRetrievalPasses.push(a),this.drawPasses.push(a)),this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),a.setPickRect(i,s,n,r);const o=a.retrieve(this.renderContext,t);return this.popCameraState(),o}retrieveSelectionPosition(e){return this.retrieveCanvasLocationWorldPosition(e.getPickLocation())}retrieveCanvasLocationWorldPosition(e){if(!this.isReadyForDrawing())return null;const t=e;if(!t)return null;this.depthRetrievalPass.setRetrieveFromPreview(!1);const i=this.findDepthsInRect(t[0],t[1],1,1);return this.depthRetrievalPass.setRetrieveFromPreview(!0),i.length>0&&i[0][2]!==b.UNKNOWN_DEPTH?this.getCamera().canvasToWorld(i[0]):null}retrieveDepthSampling(e){return this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.depthSamplingPass.retrieve(this.renderContext,e),this.popCameraState(),this.depthSamplingPass.points):[]}retrieveHighlightsOnlyDepthSampling(){return this.isReadyForDrawing()?(this.pushCameraState(),this.renderContext.setDetailSettings(this.detailManager.getInteractiveSettings()),this.bodyManager.updateForFrame(this.renderContext,!1),this.depthSamplingPass.retrieve(this.renderContext,{useHighlightsOnly:!0}),this.popCameraState(),this.depthSamplingPass.points):[]}addUIElement(e){this.uiElements[e.getCollectionId()]=e}removeUIElement(e){delete this.uiElements[e.getCollectionId()],this.uiSelectionManager.removeSelectionForUiElement(e)}destroy(){var e,t;if(this.viewerDestroyed)return;this.selectOtherView&&this.selectOtherView.destroy(),this.areSectionPlanesEnabled()&&(0,b.removeSectionPlanes)(!1),(0,b.clearPlaneEquationIds)(),this.stopBoxSelection();const i=this.uiElements;this.uiElements={};for(const e in i)i[e]&&i[e].remove();this.referenceHighlights.destroy(),this.resetHighlightManagers(),this.getEventDispatcher()&&this.getEventDispatcher().trigger(b.SESSION_ENDED),this.sceneGraphs.destroySceneGraphs(),this.cleanUpOrphanedObjects(),this.getOccurrenceIdManager().reset(),(0,b.stopActionController)(),this.el.removeEventListener("webglcontextlost",this.handleContextLoss,!1),this.el.removeEventListener("webglcontextrestored",this.handleContextRestored,!1),this.el.width=0,this.el.height=0,this.renderContext.destroy(),this.bodyManager.destroy(),(0,b.resetStaticSilhouetteState)(),(0,b.removeDrawer)(this.getViewerId()),this.resetPickPassCount(),(0,P.isNumber)(this.recordCapabilitiesTimeout)&&(clearTimeout(this.recordCapabilitiesTimeout),this.recordCapabilitiesTimeout=null),(0,P.isNumber)(this.drawTimer)&&(clearTimeout(this.drawTimer),this.drawTimer=null),this.remove(),this.$el.off(),this.elementUnitChangedSubscription.unsubscribe(),this.modelViewManagers.clearTheManagers(),this.sceneGraphs.destroySceneGraphs(),this.occurrenceDataManager.destroy(),this.isolatedOccurrenceManager.destroy(),this.edgePointController&&this.edgePointController.disable(),this.inputHandler&&this.inputHandler.remove(),null===(e=this.themeChangeSubscription)||void 0===e||e.unsubscribe(),null===(t=this.latestDisplayDataUsageSubscription)||void 0===t||t.unsubscribe(),this.printCanvas&&this.onAfterPrint(),this===(0,b.getActiveViewer)()&&(0,w.setActiveViewer)(null),this===(0,b.getFocusedViewer)()&&(0,b.setFocusedViewer)(null),document.removeEventListener("visibilitychange",this.browserTabVisibilityHandler),(0,y.clearObject)(this),this.viewerDestroyed=!0}setBaseHighlightsEnabled(e){this.renderContext.setBaseHighlightsEnabled(e)}visualizeInferenceSceneGraph(e){this.mainDrawPass&&(this.mainDrawPass.visualizeInferenceSceneGraph(e),this.requestDraw())}getCanvasCoordinateFromEvent(e){if(!e)return[0,0];const t=this.el.getBoundingClientRect(),i=(0,O.getDevicePixelRatio)();return[(e.pageX-t.left)*i,(e.pageY-t.top)*i]}getPageCoordinateFromCanvasXY(e,t){const i=(0,O.getDevicePixelRatio)(),s=this.el.getBoundingClientRect();return[e/i+s.left,t/i+s.top]}zoomFit(e){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().zoomFit(this.getFitBounds(),e)}rotateInDirection(e){this.rotateInDirectionWithAngle(e,r.default.getManager().getNumber("ROTATE_ANGLE")*Math.PI/180)}rotateIncrementallyInDirection(e){this.rotateInDirectionWithAngle(e,r.default.getManager().getNumber("INCREMENTAL_ROTATE_ANGLE")*Math.PI/180)}rotateInDirectionWithAngle(e,t){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().rotateInDirection(e,t)}animateToStandardView(e){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().animateToStandardView(e,this.getFitBounds(b.StandardViews[e]))}animateToStandardViewIgnoringUIPanels(e,t){this.resetZoomToSelectionBounds(),this.getPrimaryViewController().animateToStandardViewIgnoringUIPanels(e,this.getFitBounds(b.StandardViews[e]),t)}animateZoomFit(e){e?this.zoomToSelectionBounds=e:this.resetZoomToSelectionBounds(),this.getPrimaryViewController().animateZoomToFit(e||this.getFitBounds())}resetZoomToSelectionBounds(){this.zoomToSelectionBounds=null}animateZoomToRectangle(e,t,i,s){const n=[e,t,0],r=this.getCamera().canvasToWorld(n),a=[e+i,t+s,0],o=this.getCamera().canvasToWorld(a),c=new b.BoundingBox;c.addPoint(r),c.addPoint(o),this.animateZoomFit(c)}animateTo(e){this.resetZoomToSelectionBounds(),this.animateToWithBounds(e,this.getFitBounds(e))}animateToWithBounds(e,t){this.getPrimaryViewController().animateToFrameWithZoomFit(e,t,q.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"))}animateRotation(e,t,i){this.getPrimaryViewController().animateRotation(e,t,q.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),i)}setWaitingForDisplayData(){this.elementLoadState=Z.WAITING_FOR_DISPLAY_DATA,this.waitingForDisplayDataTimer=new l.Timer("Waiting for display data",ie())}setWaitingForCompareDisplayData(){this.elementLoadState=Z.WAITING_FOR_COMPARE_DISPLAY_DATA}stopWaitingForCompareDisplayData(){if(this.elementLoadState===Z.WAITING_FOR_COMPARE_DISPLAY_DATA){const e=!1;this.setGraphicsLoading(e,0)}this.elementLoadState===Z.WAITING_FOR_DISPLAY_DATA&&(this.shouldWaitForCompareDisplayData=!1)}setGraphicsLoading(e,t){this.waitingForDisplayDataTimer.report(),this.waitingForDisplayDataTimer=null,this.loadingDisplayDataTimer=new l.Timer("Loading display data on client",ie()),this.elementLoadState=Z.LOADING_DISPLAY_DATA,this.getEventDispatcher().trigger(b.ELEMENT_GRAPHICS_LOADING,this.activeElementId,e,t),this.shouldWaitForCompareDisplayData=!0,this.requestDrawForInteractiveProcessing()}onNewPartStudioDisplayData(e,t){if(this.getIsPrimaryViewer()&&e.isReadyForMetricsReporting()&&(this.eventDispatcher.trigger(L.EVENT_NEEDS_ANGULAR_BROADCAST,L.PART_STUDIO_TIMES,e.deserializeDurationInMillis,e.fromDisplayCache,e._serializedByteLength,e.elementId),e.resetTimes()),!this.canProcessDisplayData())return void this.queuedDisplayData.push({displayData:e,selectionMapper:t});const i=new l.Timer("Viewer.onNewPartStudioDisplayData",{setTraceId:!0}),s=this.activeElementId===e.elementId||this.activeElementId===e.forCachedElement,n=this.elementLoadState===Z.WAITING_FOR_DISPLAY_DATA,r=this.elementLoadState===Z.WAITING_FOR_COMPARE_DISPLAY_DATA;let a=!1;if(!s)return void p.log.info("Received display data for inactive element: "+e.elementId);if((0,b.isUsageCompare)()){const t=e.usage===f.GBTDisplayDataUsage.BASE,i=e.usage===f.GBTDisplayDataUsage.COMPARE_TARGET;if(n&&t)this.shouldWaitForCompareDisplayData?this.setWaitingForCompareDisplayData():a=!0;else if(r&&i)a=!0;else if(n&&i)return}else n&&(a=!0);if(a){const t=e.microversionIdAndConfigurationInterval.hasFromMicroversion()&&e.microversionIdAndConfigurationInterval.from.equals(e.microversionIdAndConfigurationInterval.to);this.setGraphicsLoading(e.fromDisplayCache||t,e.fromDisplayCache||t?100:0)}const o=this.isForFlattenedDisplay&&this.viewInitialized&&!this.isHidden();let c=!1;if(o){const e=this.getModelBounds({doNotBoundTemporarySketchEntities:!0});c=!e.isInitialized()||this.getCamera().doBoundsFitInViewport(e)}if(this.queuedBaseData&&this.queuedBaseData.elementId===e.elementId&&(this.queuedBaseData.incremental||this.modelViewManagers.resetPreviewManager(),t=this.selectionMapperForQueuedBase,this.modelViewManagers.getManager().processPartStudioDisplayData(this.queuedBaseData,t),this.queuedBaseData=null,this.selectionMapperForQueuedBase=null),e.usage===f.GBTDisplayDataUsage.PREVIEW_BEFORE)return this.queuedBaseData=e,void(this.selectionMapperForQueuedBase=t);let d=this.modelViewManagers.getManager();switch(e.usage){case f.GBTDisplayDataUsage.PREVIEW_AFTER:case f.GBTDisplayDataUsage.PREVIEW_FINAL:case f.GBTDisplayDataUsage.COMPARE_TARGET:d=this.modelViewManagers.getPreviewManager(e)}const u=h.DocumentController.activeFeatureControllerIsSketch(),g=e.usage===f.GBTDisplayDataUsage.PREVIEW_FINAL&&!u;this.setSuppressModelSelection(g),this.setBaseHighlightsEnabled(!g),this.isForPreviousVersionDisplay&&this.setSuppressModelSelection(!0),this.mainDrawPass&&this.mainDrawPass.updateHideInteriorSelections(),this.getSupportsPreview()&&((0,b.getEditState)().latestDisplayDataUsage=e.usage);const m=d.processPartStudioDisplayData(e,t);e.usage!==f.GBTDisplayDataUsage.BASE?(this.bodyLoadTasks.completeTasks(),this.getIsForFlattenedDisplay()||m||this.bodyManager.initiateAutomaticRetrieval()):(this.bodyLoadTask.performInitialLoad(),this.bodyLoadTask.hasPendingWork()||this.getIsForFlattenedDisplay()||m||this.bodyManager.initiateAutomaticRetrieval()),this.setUserIsManipulatingWithTimeout(),e.usage===f.GBTDisplayDataUsage.BASE&&(this.performBodyCheck=!0),this.requestDrawForInteractiveProcessing(),this.detailManager.updateFromLoadedScene(),o&&c&&this.getModelBounds().isInitialized()&&this.animateZoomFit(),i.report()}onNewInsertableDisplayData(e){this.getModelViewManagers().getManager().processReceivedInsertableDisplayData(e)}onRootAssemblyDisplayData(e,t,i){if(!this.getIsForFlattenedDisplay()&&e.isReadyForMetricsReporting()&&(this.eventDispatcher.trigger(L.EVENT_NEEDS_ANGULAR_BROADCAST,L.ASSEMBLY_TIMES,e.deserializeDurationInMillis,e.fromDisplayCache,e._serializedByteLength,e.elementId),e.resetTimes()),!this.canProcessDisplayData())return void this.queuedDisplayData.push({displayData:e,selectionMapper:null});if(!(this.activeElementId===e.elementId||t&&this.activeElementId===t.elementId))return void p.log.info("Received display data for inactive element: "+e.elementId);if(this.elementLoadState===Z.WAITING_FOR_DISPLAY_DATA&&this.activeElementId===e.elementId&&!i){const t=e.fromDisplayCache?100:e.getPartstudioDisplayDataNoopPercent();this.setGraphicsLoading(e.fromDisplayCache,t)}const s=this.bodyLoadTask.hasPendingWork();this.modelViewManagers.getManager().processRootAssemblyDisplayData(e,t),!s&&this.bodyLoadTask.hasPendingWork()&&this.bodyLoadTask.performInitialLoad(),e.isCollapsible&&this.setUserIsManipulatingWithTimeout(),this.detailManager.updateFromLoadedScene()}destroyPreviewGraphics(){E.PartList.resetPartListToBase(this.activeElementId),this.modelViewManagers.resetPreviewManager(),(0,b.resetUsage)(),this.mainDrawPass&&this.mainDrawPass.setHideSelectionInterior(!1),this.requestDraw()}setForceHideInteriorSelections(e){this.mainDrawPass.setForceHideInteriorSelections(e)}updateLastMouseLocation(e){this.lastMouseLocation=this.getCanvasCoordinateFromEvent(e)}resetLastMouseLocation(){this.lastMouseLocation=[-1,-1]}raycast(e,t,i,s){let n=-1,r=null;const a=U.vec3.create(),o=this.getCamera().getRay(e,t);let c=U.mat4.create();s&&(o.point=G.mat4C.multiplyVec3(s,o.point,U.vec3.create()),o.direction=U.vec3.clone(G.mat4C.multiplyVec3(s,U.vec3.fromValues(o.direction[0],o.direction[1],o.direction[2]),U.vec3.create())),c=G.mat4C.inverse(s));const l=i.points,h=i.indices,d=function(e){return e*=3,U.vec3.fromValues(l[e],l[e+1],l[e+2])},u=R.Tolerances.ZERO_LENGTH,g=this.getCamera(),p=U.vec2.fromValues(e,t),m=U.vec3.create(),E=U.vec3.create(),I=U.vec3.create(),T=U.vec3.create(),f=U.vec3.create();for(let e=0;e<h.length-2;e++){if(h[e+2]===h[e+1]||h[e+1]===h[e]||h[e]===h[e+2])continue;const t=[d(h[e]),d(h[e+1]),d(h[e+2])];G.vec3C.subtract(t[1],t[0],E),G.vec3C.subtract(t[2],t[0],I),G.vec3C.cross(o.direction,I,T);const i=U.vec3.dot(T,E);if(Math.abs(i)<u)continue;const s=1/i;G.vec3C.subtract(o.point,t[0],m);const l=U.vec3.dot(m,T)*s;if(l<0||l>1)continue;G.vec3C.cross(m,E,f);const S=U.vec3.dot(o.direction,f)*s;if(S<0||l+S>1)continue;const C=U.vec3.dot(I,f)*s;if(!(C<u)&&(n<0||n>C)){n=C,r=null;for(let e=0;e<3;e++)if(G.vec2C.dist(g.projectWorldPointToCanvas(G.mat4C.multiplyVec3(c,t[e],U.vec3.create())),p)<12){r=t[e],G.vec3C.cross(E,I,a);break}}}return new S.MeshPointData(r,a)}doPick(e,t,i,s,n){const r=(0,b.pickFromPreview)()&&!this.modelViewManagers.getPreviewManager();if(this.performingBoxSelection()||r)return!1;(n=n||{}).mouseX=e,n.mouseY=t,n.camera=this.getCamera(),n.click&&(this.getEventDispatcher().trigger(b.CLOSE_MATE_DOF_CHOOSER),this.getEventDispatcher().trigger(b.CLOSE_SELECT_OTHER));const a=(0,b.getTimeInMilliseconds)(),o=this.pick(e,t,n);let c=!1;for(let e=0;e<o.length&&!c;++e){const t=o[e],r=t.getModelSelection();if(r&&!this.suppressModelSelection)c=(0,S.processSelection)(r,i,s,n),c&&this.uiSelectionManager.handleEmptyUiPick(i,n);else if(t.isUIPick()&&(c=this.uiSelectionManager.processUiPick(t,n),c&&!this.suppressModelSelection)){const e=t.getUISelection();e&&!e.getClearModelSelectionsOnPrehilite()||(0,S.handleEmptyPick)(i,!0,n)}}c||(this.suppressModelSelection||(0,S.handleEmptyPick)(i,!1,n),this.uiSelectionManager.handleEmptyUiPick(i,n)),c&&i&&this.setUserIsManipulatingWithTimeout();const l=(0,b.getTimeInMilliseconds)()-a;return this.averagePickDuration<0?this.averagePickDuration=l:this.averagePickDuration=.8*this.averagePickDuration+.2*l,c}doPreHighlightPick(e){this.doPick(this.lastMouseLocation[0],this.lastMouseLocation[1],!0,!0,{skipPreHighlight:e,shiftKey:this.inputHandler.getAltHeld()})}onDoubleClick(e,t,i){const s={};s.mouseX=e,s.mouseY=t,s.camera=this.getCamera(),s.doubleClick=!0,s.altKey=i.altKey;const n=this.pick(e,t,s);let r=!1;for(let e=0;e<n.length&&!r;++e){const t=n[e];t.isUIPick()&&(r=this.uiSelectionManager.processUiPick(t,s))}return r}getAveragePickDuration(){return Math.max(0,this.averagePickDuration)}setSuppressModelSelection(e){this.suppressModelSelection=e,this.suppressModelSelection&&this.stopBoxSelection()}getSuppressModelSelection(){return this.suppressModelSelection}getCameraPropertiesForElement(e){let t=null;const i={graphicsElementId:e=e||"",isValid:!1,projectionType:"",viewMatrix:U.mat4.create(),projectionMatrix:U.mat4.create(),verticalFieldOfView:0,viewportHeight:0,viewportWidth:0};if(this.elementToPerElementState&&this.elementToPerElementState.hasOwnProperty(e)){const s=this.elementToPerElementState[e];s&&(t=s.camera,t&&(i.isValid=!0,t.isOrthographic()?i.projectionType="orthographic":t.isPerspective()&&(i.projectionType="perspective"),i.viewMatrix=t.getViewMatrix(),i.projectionMatrix=t.getProjectionMatrix(),i.verticalFieldOfView=t.getFieldOfView(),i.viewportHeight=t.getViewportHeight(),i.viewportWidth=t.getViewportWidth()))}return i}closeSelectOtherView(){this.selectOtherView.close()}resetActiveElement(){this.modelViewManagers.getManager().resetDisplayedElement()}setActiveElement(e,t,i,s,n){if(!this.selectOtherView){const e={viewer:this};this.selectOtherView=new I.SelectOtherView(e)}if(this.selectOtherView.setActiveElement(s,n),e===this.activeElementId)return;if(this.loadTimer=new l.Timer("Time from element switch to graphics display",ie()),(0,b.isUsageCompare)()||this.destroyPreviewGraphics(),(0,b.isUsageBase)()&&!i&&(0,b.generateThumbnails)(this,70,40),this.activeElementId&&this.elementToPerElementState&&this.viewInitialized){const e=this.getCamera();if(e){let t=this.elementToPerElementState[this.activeElementId];t||(t=this.elementToPerElementState[this.activeElementId]=new Y(this.activeElementId)),t.camera=e.clone(),t.renderingMode=this.renderingMode,t.smoothEdgeStyle=this.smoothEdgeStyle,t.activeFilteredEntitiesHighlightController=this.filteredEntitiesHighlightController,t.userEnabledAggressiveRefinement=this.bodyManager.getUserEnabledAggressiveRefinement(),t.activeFilteredEntitiesHighlightController&&t.activeFilteredEntitiesHighlightController.disable(),this.isForFlattenedDisplay||(t.sectionViewState=(0,b.saveAndClearState)())}}let r=!1;s&&(r=s.getIsPublicationItem()),this.modelViewManagers.getManager().onChangeActiveElement(e,t,r),this.draw(),this.activeElementId=e||"";const a=t===f.GBTElementType.PARTSTUDIO||t===f.GBTElementType.ASSEMBLY,o=this.elementToPerElementState[this.activeElementId];if(a&&o){const e=o.camera;e&&(this.viewController.isPerspective()!==e.isPerspective()&&(this.viewController.isPerspective()?this.viewController=new b.OrthographicController(this):this.viewController=new b.PerspectiveController(this)),e.setViewportFromCanvasElement(this.$el),this.getCamera().copyFrom(e)),this.setZebraStripeEdgesOn(o.zebraStripeEdgesOn),this.setRenderingMode(o.renderingMode),t!==f.GBTElementType.PARTSTUDIO&&t!==f.GBTElementType.ASSEMBLY||this.setSmoothEdgesRenderStyle(o.smoothEdgeStyle),this.setFilteredEntitiesHighlightController(o.activeFilteredEntitiesHighlightController),o.activeFilteredEntitiesHighlightController&&o.activeFilteredEntitiesHighlightController.enable(),this.isForFlattenedDisplay||(0,b.loadState)(o.sectionViewState),this.bodyManager.setUserEnabledAggressiveRefinement(o.userEnabledAggressiveRefinement),"number"==typeof o.zebraStripeCount&&this.setZebraStripeCount(o.zebraStripeCount),"number"==typeof o.zebraStripeRotation&&this.setZebraStripeRotation(o.zebraStripeRotation),this.viewInitialized=!0}else this.viewController&&this.resetViewState();this.setWaitingForDisplayData(),this.readyToUpdateElementLoadState=!1,this.receivedFeatureData=!1,this.receivedAssemblyDefinition=!1,this.averagePickDuration=-1,this.frameTimer.resetTimings(),this.detailManager.onSettingStateChange(),this.uiSelectionManager.reset(),this.bodyManager.resetOccurrenceRetrieval(),(0,b.resetStaticSilhouetteState)(),this.resetLastMouseLocation(),this.setReadyState(!1);let c=b.ActionIds.UNSUPPORTED;t===f.GBTElementType.PARTSTUDIO?c=b.ActionIds.PART_STUDIO:t===f.GBTElementType.ASSEMBLY?c=b.ActionIds.ASSEMBLY:this.hideWebGLContextLostMessage(),(0,b.getActiveViewerEventDispatcher)().trigger(b.SPACEMOUSE_ACTION_SET_CHANGED,c)}resetViewState(){var e,t;this.initializedForDrawing&&(this.viewInitialized=!1,this.viewController.isPerspective()&&(this.viewController=this.viewController.getMatchingOrthographicController()),this.viewController.setStandardView(this.getDefaultStandardView()),u.btInjector.CapabilitiesService.isAngularViewcubeMenuEnabled().then((e=>{e?u.btInjector.UserSettingsService.getUserSettings().then((e=>{this.viewerPreferences.renderingMode=Number(e.graphicsRenderMode),this.viewerPreferences.smoothEdge=Number(e.graphicsSmoothEdge),this.setSmoothEdgesRenderStyle(Number(e.graphicsSmoothEdge)),this.setRenderingMode(Number(e.graphicsRenderMode))})):(this.setRenderingMode(f.GBTGraphicsRenderMode.SHADED_WITH_EDGES),this.setSmoothEdgesRenderStyle(f.GBTSmoothEdgeStyle.VISIBLE))})),this.setFilteredEntitiesHighlightController(null),this.filteredEntitiesHighlightController&&this.filteredEntitiesHighlightController.disable(),this.bodyManager.setUserEnabledAggressiveRefinement(!1),this.debugShowSilhouetteEdgesOnNonVisibleTangentEdgeStyle=!1,null===(e=this.mainDrawPass)||void 0===e||e.setZebraStripeCount(q.getNumber("ZEBRA_STRIPE_COUNT")),null===(t=this.mainDrawPass)||void 0===t||t.setZebraStripeRotation(q.getNumber("ZEBRA_STRIPE_ROTATION")))}getViewerPreferences(){return this.viewerPreferences}resetViewerPreferences(){this.viewerPreferences.renderingMode=this.getRenderingMode(),this.viewerPreferences.smoothEdge=this.getSmoothEdgesRenderStyle()}updateCanvasVisibility(){this.readyState&&!this.hidden?(this.$el.show(),this.viewManipulator&&this.viewManipulator.show()):(this.$el.hide(),this.viewManipulator&&this.viewManipulator.hide())}setReadyState(e){this.readyState=e,e?this.storedCameraState&&(this.updateCamera(this.storedCameraState),this.storedCameraState=null):this===(0,b.getFocusedViewer)()&&(0,b.setFocusedViewer)(null),this.updateCanvasVisibility()}isHidden(){return this.hidden}hide(){this.hidden=!0,this.updateCanvasVisibility()}show(){this.hidden=!1,this.gl||this.setupGlContext(),this.updateCanvasVisibility(),this.modelViewManagers.getManager().onViewerShown()}setSelectionCountCursor(e){this.selectionCursor=e,0===this.cursorStack.length&&this.$el.css({cursor:e})}pushCursor(e){this.$el.css({cursor:e}),this.cursorStack.push(e)}peekCursor(){return this.cursorStack&&this.cursorStack.length>0?this.cursorStack[this.cursorStack.length-1]:null}popCursor(){0!==this.cursorStack.length?(this.cursorStack.pop(),this.cursorStack.length>0?this.$el.css({cursor:this.cursorStack[this.cursorStack.length-1]}):this.$el.css({cursor:this.selectionCursor})):p.log.warn("Tried to pop a cursor off an empty stack in the graphics viewer")}removeTopOccurrenceOfCursor(e,t){if(0===this.cursorStack.length&&!t)return void p.log.warn("Tried to remove a cursor from an empty stack in the graphics viewer");const i=(0,v.findLastIndex)(this.cursorStack,(function(t){return t===e}));i<0?t||p.log.warn("Tried to remove a cursor not present on stack in graphics viewer"):i===this.cursorStack.length-1?this.popCursor():this.cursorStack.splice(i,1)}onBeforePrint(){const e=this.getCamera().getViewport();this.printCanvas||(this.printToCanvas(e[2],e[3],e[2],e[3]),s(this.printCanvas).css({width:"100%"}));const t=s("body");t.addClass("printing"),t.append(this.printCanvas)}onAfterPrint(){s(this.printCanvas).remove(),this.printCanvas=null,s("body").removeClass("printing")}printToCanvas(e,t,i,s,n){if(!this.isReadyForDrawing())return;this.viewManipulator&&this.viewManipulator.hide();const r=this.getCamera(),a=r.clone();let o=null;n&&(o={previousOverride:(0,O.getDevicePixelRatioOverride)()},(0,O.setDevicePixelRatioOverride)(n));const c=r.getViewportWidth(),l=r.getViewportHeight(),h=e/i,d=i*h,u=s*h,g=c*h,p=l*h,m=(c-i)/2*h,E=(l-s)/2*h;a.setViewport([0,0,g,p]);const I=d,T=u,S=1024,f=1024,C=1042,P=1042,v=this.el.width,D=this.el.height;this.el.width=Math.max(C,v),this.el.height=Math.max(P,D),a.setCanvasDimensions(this.el.width,this.el.height);const M=Math.ceil(I/S),y=Math.ceil(T/f);this.printCanvas=document.createElement("canvas"),this.printCanvas.id="print-canvas",this.printCanvas.width=I,this.printCanvas.height=T;const _=this.printCanvas.getContext("2d"),A=new Uint8Array(4343056),R=_.createImageData(S,f),N=this.getGlContext(),w=[0,0,C,P];this.frameTimer.resetInteractionStatus();for(let e=0;e<y;++e)for(let t=0;t<M;++t){w[0]=m+t*S-9,w[1]=E+e*f-9,a.setTileViewport(w);const i=null;this.draw(i,{forPrint:!0,camera:a}),N.readPixels(0,0,C,P,N.RGBA,N.UNSIGNED_BYTE,A);for(let e=0;e<f;++e)for(let t=0;t<S;++t){const i=4*((f-e-1)*S+t),s=4*((e+9)*C+t+9),n=1/(A[s+3]/255);R.data[i]=A[s]*n,R.data[i+1]=A[s+1]*n,R.data[i+2]=A[s+2]*n,R.data[i+3]=A[s+3]}_.putImageData(R,t*S,e*f)}this.el.width=v,this.el.height=D,this.viewManipulator&&this.viewManipulator.show(),o&&(o.previousOverride?(0,O.setDevicePixelRatioOverride)(o.previousOverride):(0,O.clearDevicePixelRatioOverride)()),this.draw()}createPrintView(e,t,i,n,r,a,o){const c=11800,l=this.mainDrawPass.getClearColor();this.mainDrawPass.setClearColor(0,0,0,0);let h=null;if(o){h=o*c/q.getNumber("DEFAULT_LINE_WIDTH")}this.printToCanvas(e*c,t*c,n,r,h),s(this.printCanvas).css({width:100*e+"cm",height:100*t+"cm"}),a?this.printCanvas.toBlob((e=>{(0,M.saveBlob)(e,i+".png"),this.onAfterPrint()})):window.print(),this.mainDrawPass.setClearColor(l[0],l[1],l[2],l[3])}getEntityCanvasLocation(e){const t=this.modelViewManagers.getManager().extractMeshIncrement(e);if(t&&t.points&&t.points.length>=3){const e=[t.points[0],t.points[1],t.points[2]];return this.getCamera().projectWorldPointToCanvas(e)}return null}triggerContextLoss(e){const t=this.getExtension("WEBGL_lose_context");t?(t.loseContext(),setTimeout((function(){t.restoreContext()}),e||500)):alert("This system does not support the context loss extension")}toggleDebugDrawPickPass(){const e=this.mainDrawPass.getDebugDrawPickPass();e.setEnabled(!e.getEnabled())}isMouseInsideViewManipulator(){return!!this.viewManipulator&&this.viewManipulator.isMouseInside()}setCanEdit(e){this.canEdit=e}getCanEdit(){return this.canEdit}completeTasks(){this.taskManager.complete(),this.draw()}getSelectionFitBounds(e){if(!e)return null;const t=this.getModelViewManagers().getManagerForUsage(e.getUsage());if(!t)return null;const i=t.getSelectionFitBounds(e);if(this.getIsForFlattenedDisplay()&&i){const s=t.getDisplayedElement();if(s instanceof b.PartStudio){const t=s.getBodyTransform(e.getBodyId(),this);if(t)return i.createTransformedCopy(t)}}return i}retrieveViewportAsImage(e){const t=e.width,i=e.height,s=this.getCamera().clone();this.getCamera().setViewport([0,0,t,i]),this.getCamera().setCanvasDimensions(t,i);let n=this.getFitBounds();e.zoomToSelection&&(n=new b.BoundingBox,(0,S.getSelectionList)().each((e=>{n.addBox(this.getSelectionFitBounds(e))})),n.isFinite()&&n.isExtensive()||p.log.warn("zoomToSelection was requested in retrieveZoomedFitViewport but a valid bounds was not found")),(0,b.setForcePredictableHatching)(!0),void 0===e.zoomToFit&&(e.zoomToFit=!0),e.zoomToFit&&this.getPrimaryViewController().zoomFitWithoutPanels(n),!e.showViewCube&&this.viewManipulator&&this.viewManipulator.hide(),e.useInteractiveSettings?this.frameTimer.setUserIsAdjustingCamera():this.frameTimer.resetInteractionStatus(),this.mainDrawPass.setClearColor(1,1,1,1),this.draw();const r=new Uint8Array(t*i*4),a=this.getGlContext();return a&&a.readPixels(0,0,t,i,a.RGBA,a.UNSIGNED_BYTE,r),(0,b.flipImageVertically)(r,t,i),this.getCamera().copyFrom(s),this.mainDrawPass.setClearColor(0,0,0,0),!e.showViewCube&&this.viewManipulator&&this.viewManipulator.show(),(0,b.setForcePredictableHatching)(!1),{width:t,height:i,data:r}}retrievePrintedCanvasPixels(e){const t=this.createPrintOfCanvas(e.width,e.height,W,z,!0),i=this.printCanvas.getContext("2d").getImageData(0,0,W,z);return this.removePrintOfCanvas(t),{width:W,height:z,data:i.data}}printToCanvasRenderingContext(e,t,i,s,n){const r=(0,O.getDevicePixelRatio)(),a=r*i,o=r*s;this.getEventDispatcher().trigger(b.BEFORE_MARKUP_IMAGE_GENERATION);const c=this.createPrintOfCanvas(a,o,a,o);this.getEventDispatcher().trigger(b.AFTER_MARKUP_IMAGE_GENERATION),n.drawImage(this.printCanvas,e,t,i,s),this.removePrintOfCanvas(c)}createPrintOfCanvas(e,t,i,s,n){const r=this.getCamera().clone();return this.getCamera().setViewport([0,0,e,t]),n&&this.getPrimaryViewController().zoomFitWithoutPanels(this.getFitBounds()),this.printToCanvas(i,s,e,t),r}removePrintOfCanvas(e){s(this.printCanvas).remove(),this.getCamera().copyFrom(e)}getViewData(e,t){const i=new f.BTViewData,s=this.getCamera();let n=s.getFrame();if(e){const t=this.modelViewManagers.getManager().getOccurrenceTransform(e);if(t){const e=G.mat4C.inverse(t,U.mat4.create());n=G.mat4C.multiply(e,n,U.mat4.create())}}i.viewMatrix=n,i.isPerspective=s.isPerspective();const r=s;r.top&&r.bottom&&r.right&&r.left?i.cameraViewport=[r.top,r.bottom,r.right,r.left]:i.cameraViewport=[0,0,0,0];const a=s;a.angle?i.angle=a.angle:i.angle=0;const o=function(e){const t=new f.BTVector3d;return t.x=e[0],t.y=e[1],t.z=e[2],t},c=[];return(0,b.getCurrentSectionPlaneParameters)().forEach((function(e){const t=new f.BTSectionPlaneParameters;t.center=o(e.center),t.tangent=o(e.tangent),t.normal=o(e.normal),c.push(t)})),i.sectionPlaneParameters=c,t||(i.sectionViewData=(0,F.getSerializableSectionViewData)()),i}getViewDataWithPersistentSectionedItemQueries(e){return(0,F.getSerializableSectionViewDataWithPersistentQueries)().then((e=>{const t=this.getViewData(null,!0);return t.sectionViewData=e,t}))}animateToView(e,t){const i=this.getCameraForViewData(e,t);this.prepareViewControllerForNewCamera(e.isPerspective);const s=r.default.getManager();this.getPrimaryViewController().animateToCustomView(i,s.getNumber("CAMERA_LONG_ANIMATION_TIME_MS"),e.name)}prepareViewControllerForNewCamera(e){const t=this.getPrimaryViewController();e?t.isOrthographic()&&this.setPrimaryViewController(t.getMatchingPerspectiveController()):t.isPerspective()&&this.setPrimaryViewController(t.getMatchingOrthographicController())}getCameraForViewData(e,t){const i=this.getCamera();i.setSceneBounds(this.getSceneBounds());let s=e.viewMatrix;const n=e.cameraViewport,r=e.angle;if(t){const e=f.BTOccurrence.getOccurrenceFromPathString(t),i=this.modelViewManagers.getManager().getOccurrenceTransform(e);i&&(s=G.mat4C.multiply(i,s,U.mat4.create()))}let a;return e.isPerspective?(a=i.getPerspectiveCamera(),a.angle=r):(a=i.getOrthographicCamera(),a.top=n[0],a.bottom=n[1],a.right=n[2],a.left=n[3],a.correctAspectRatio()),a.setFrame(s),a}animateIsolation(e,t){const i=r.default.getManager().getNumber("ISOLATE_CONTEXT_TRANSITION_TIME_MS"),s=(0,b.getTimeInMilliseconds)();this.animationController.startAnimation((n=>{const r=(0,b.getTimeElapsed)(s),a=Math.min((0,b.smoothstep)(0,1,r/i),1);let o=L.AnimationCallbackStatus.ONGOING;return a>=1&&(o=L.AnimationCallbackStatus.COMPLETE,t&&t()),(0,b.setTransparencyTransition)(e?a:1-a),o}))}onIsolateChanged(){for(const e in this.uiElements)this.uiElements[e].onIsolateChanged()}setUserIsManipulatingWithTimeout(){this.frameTimer.setUserIsManipulatingWithTimeout()}setUserIsAdjustingCamera(){this.bodyManager.onUserIsAdjustingCamera(),this.frameTimer.setUserIsAdjustingCamera()}setSystemIsAnimating(){this.frameTimer.setSystemIsAnimating()}executePerformanceTests(){return this.elementLoadState=Z.LOADED_ALL_DATA,(0,b.setRetinaDisplayMode)(b.RetinaDisplayMode.OFF),this.initializeForDrawing(),this.onResize(),this.viewInitialized=!0,(0,b.executePerformanceTests)(this)}getInteractiveFrameDetails(){return this.frameTimer.getTimingDetails(L.FrameType.INTERACTIVE)}getPingStats(){if(!this.isReadyForDrawing()||!this.isBrowserTabVisible||this.taskManager.hasPendingWork())return null;const e=this.getInteractiveFrameDetails(),t=this.getCamera();return e&&e.hasTimings()&&t?{framerate:e.getAverageFramerate(),triangleCount:this.modelViewManagers.getManager().getInstantiatedTriangleCount(),pixelCount:t.getViewportWidth()*t.getViewportHeight()}:null}areSectionPlanesEnabled(){return!this.isForFlattenedDisplay}onDisplayDataUsageChange(){this.detailManager.onSettingStateChange()}onDefaultUnitsChanged(e){for(const t in this.uiElements)this.uiElements[t].onDefaultUnitsChanged(e)}setDraftAnalysisPullDirection(e){this.mainDrawPass.setDraftAnalysisPullDirection(e),this.requestDraw()}setDraftAnalysisMinimumAngle(e){this.mainDrawPass.setDraftAnalysisMinimumAngle(e),this.requestDraw()}setDraftAnalysisParts(e){this.mainDrawPass.setDraftAnalysisParts(e),this.requestDraw()}setDraftAnalysisShowUndercut(e){this.mainDrawPass.setDraftAnalysisShowUndercut(e),this.requestDraw()}clearDraftAnalysis(){this.setDraftAnalysisPullDirection(null),this.setDraftAnalysisMinimumAngle(f.BTDraftAnalysis.DEFAULT_MINIMUM_ANGLE_RADIANS),this.setDraftAnalysisParts([])}getRenderingModeOfElement(e){const t=this.elementToPerElementState[e];return t?t.renderingMode:null}updateElementPreviewNodeVisibility(e){const t=this.getModelViewManagers().getManager().getElementRootNode().getParent();if(t)for(let i=0;i<t.getChildCount();++i)t.getChildByIndex(i).setVisible(!e);const i=this.getModelViewManagers().getManager().getElementPreviewRootNode();i&&i.setVisible(e)}onElementPreviewDisplayData(e){p.log.trace("Invoking onElementPreviewDisplayData for element "+e.elementId),this.activeElementId===e.elementId&&this.elementLoadState!==Z.LOADED_ALL_DATA?(this.activeElementPreviewManager=new b.ElementPreviewManager(this),this.activeElementPreviewManager.processGLDisplayDataResponse(e),this.hasElementPreviewLoaded=!0,this.setReadyState(!0),this.updateElementPreviewNodeVisibility(!0),this.requestDraw(),this.getEventDispatcher().trigger(b.ELEMENT_PREVIEW_GRAPHICS_LOADED,this.activeElementId),p.log.trace("Drawing Preview for element "+e.elementId)):p.log.trace("Skipping processing previewDisplayData because display data has been loaded "+e.elementId)}clearElementPreview(){this.updateElementPreviewNodeVisibility(!1),this.activeElementPreviewManager&&(p.log.trace("Removing elementPreviewManager for elementId "+this.activeElementId),this.activeElementPreviewManager.destroy(),this.activeElementPreviewManager=null,this.requestDraw()),this.hasElementPreviewLoaded=!1}getCameraData(e){const t={camera:null,cameraExtents:null};let i=G.mat4C.inverse(e,U.mat4.create());return i||(i=U.mat4.create()),t.camera=this.getCamera().clone(),t.camera.setFrame(G.mat4C.multiply(i,t.camera.getFrame())),this.getCamera().isOrthographic()&&(t.cameraExtents=this.getCamera().getExtents()),t}updateCamera(e){const t=e.camera;t&&e.honorPerspective&&this.prepareViewControllerForNewCamera(t.isPerspective());const i=this.getCamera();i.isOrthographic()&&e.cameraExtents&&i.setExtents(e.cameraExtents),t&&(e.honorPerspective?i.copyFrom(t):i.copyFrom(t.getOrthographicCamera())),i.setViewportFromCanvasElement(this.$el),this.setViewInitialized(!0)}storeCameraState(e){this.storedCameraState=e}setInterferenceCallId(e){this.interferenceCallId=e}getInterferenceCallId(){return this.interferenceCallId}createDistanceDisplay(e,t){return new b.DistanceDisplay(e,t,this)}createAngleDisplay(e,t,i,s,n,r){return new b.AngleDisplay(e,t,i,s,n,r,this)}getDimensionComponent(){const e=this.getModelViewManagers().getManager().getDisplayedPartStudio();return e?e.getDimensionComponent():null}createCombDisplay(e,t,i,s,n){return new b.CombDisplay(e,t,i,s,n,this)}createAngularDimension(e,t){return new b.AngularDimension(this,e,t)}createCurveLengthDimension(e,t){return new b.CurveLengthDimension(this,e,t)}createLinearDimension(e,t){return new b.LinearDimension(this,e,t)}createEllipseDiameterDimension(e,t){return new b.EllipseDiameterDimension(this,e,t)}createRadialDimension(e,t){return new b.RadialDimension(this,e,t)}createArcLengthDimension(e,t){return new b.ArcLengthDimension(this,e,t)}createCenterlineDimension(e,t){return new b.CenterlineDimension(this,e,t)}createCountDimension(e,t){return new b.CountDimension(this,e,t)}createAngularWithArrowManipulator(){return new b.AngularWithArrow(this)}createLinearManipulator(e){return new b.Linear(this,e)}createPlanarManipulator(e){return new b.Planar(this,e)}createTriadManipulator(e,t){return new b.Triad(this,e,t)}createFeatureManipulator(e,t){return(0,b.createManipulator)(e,this,t)}createLinearToolPreview(e,t,i,s,n){return(0,b.createLinearToolPreview)(e,t,i,s,this,n)}createAngularToolPreview(e,t,i,s,n){return(0,b.createAngularToolPreview)(e,t,i,s,n,this)}createAxes(e){return new b.Axes(this,e)}createEmptyBoundingBox(){return new b.BoundingBox}createOrthographicCamera(){return new b.OrthographicCamera}createPerspectiveCamera(){return new b.PerspectiveCamera}createCommentIndicator(e,t){return new b.CommentIndicator(e,t,this)}createCenterOfMassIndicator(e){return new b.CenterOfMassIndicator(e,this)}createFeatureDisplay(e){return new b.Display(e,this)}createControlPointGridDisplay(e,t,i){return new b.ControlPointGridDisplay(e,t,i,this)}createEdgeCurvatureDisplay(e,t,i,s,n,r){return new b.EdgeCurvatureDisplay(e,t,i,s,n,this,r)}createDihedralDisplay(e,t,i,s){return new b.DihedralCombDisplay(e,t,i,s,0,0,!1,this)}createDihedralExtremaDisplay(e,t,i,s,n){return new b.DihedralExtremaDisplay(e,t,i,s,n,this)}createFixedMateIndicator(e,t){return new b.FixedMateIndicator(e,t,this)}createImageDisplay(e,t,i,s,n,r,a,o,c,l){return new b.ImageDisplay(e,t,i,s,n,r,a,this,o,c,l)}createInferenceDisplay(e,t){return new b.InferenceDisplay(e,this,t)}createInferencePicker(e,t,i){return new b.InferencePicker(this,e,t,i)}createInterferenceDisplay(e,t,i,s,n,r,a){return new b.InterferenceDisplay(e,this,t,i,s,n,r,a)}createFilteredEntitiesHighlightController(e){return new b.FilteredEntitiesHighlightController(this,e)}createMateConnectorManager(){return this.activeMateConnectorManager=new b.Manager,this.activeMateConnectorManager}destroyMateConnectorManager(){this.activeMateConnectorManager&&(this.activeMateConnectorManager.destroy(),this.activeMateConnectorManager=null)}getMateConnectorManager(){return this.activeMateConnectorManager}setMateConnectorInteractionEnabled(e){b.MateConnector.setInteractionEnabled(e)}createMeshIncrement(e,t,i,s,n){return new b.MeshIncrement(e,t,i,s,n)}createSnapIndicator(){return new b.SnapIndicator(this)}createPointElement(e,t,i,s,n){return new b.PointElement(e,t,i,s,this,n)}createSilhouette(e){return new b.Silhouette(e,this)}canUserEnableAggressiveRefinement(){return this.renderingMode!==f.GBTGraphicsRenderMode.SIMULATION_RESULTS&&this.renderingMode!==f.GBTGraphicsRenderMode.SHADED_CURVATURE_VISUALIZATION}getUserEnabledAggressiveRefinement(){return this.bodyManager.getUserEnabledAggressiveRefinement()}setUserEnabledAggressiveRefinement(e){return this.getUserEnabledAggressiveRefinement()||!e||this.canUserEnableAggressiveRefinement()?(this.bodyManager.setUserEnabledAggressiveRefinement(e),!0):(u.btInjector.MessageBubbleService.showMessageWithAutoDismiss(i18n("Viewing in high quality is disabled for this view mode."),"warning"),!1)}getOrCreateActiveElementViewerState(){let e=this.elementToPerElementState[this.activeElementId];return void 0===e&&(e=this.elementToPerElementState[this.activeElementId]=new Y(this.activeElementId)),e}getActiveElementViewerState(){return this.elementToPerElementState[this.activeElementId]}setZebraStripeCount(e){var t;this.getOrCreateActiveElementViewerState().zebraStripeCount=e,null===(t=this.mainDrawPass)||void 0===t||t.setZebraStripeCount(e)}setZebraStripeRotation(e){var t;this.getOrCreateActiveElementViewerState().zebraStripeRotation=e,null===(t=this.mainDrawPass)||void 0===t||t.setZebraStripeRotation(e)}getZebraStripeCount(){var e,t;return null!==(t=null===(e=this.getActiveElementViewerState())||void 0===e?void 0:e.zebraStripeCount)&&void 0!==t?t:q.getNumber("ZEBRA_STRIPE_COUNT")}getZebraStripeRotation(){var e,t;return null!==(t=null===(e=this.getActiveElementViewerState())||void 0===e?void 0:e.zebraStripeRotation)&&void 0!==t?t:q.getNumber("ZEBRA_STRIPE_ROTATION")}getZebraStripeEdgesOn(){var e,t;return null===(t=null===(e=this.getActiveElementViewerState())||void 0===e?void 0:e.zebraStripeEdgesOn)||void 0===t||t}setZebraStripeEdgesOn(e){this.getOrCreateActiveElementViewerState().zebraStripeEdgesOn=e,this.renderingMode===f.GBTGraphicsRenderMode.CURVATURE_VISUALIZATION&&this.setRenderingMode(this.renderingMode),this.requestDraw()}getRenderModeObservable(){return this.renderModeSubject.asObservable()}logDisplayDataRefinementState(){p.log.info("Display data refinement state logged. Details:\n\n"+this.bodyManager.getDisplayDataRefinementState())}unloadSelectedBodies(){(0,S.getSelectionList)().each((e=>{this.bodyManager.unloadSelectionBody(e)}))}isIsolateEffectInUseForVisualization(){const e=this.modelViewManagers.getManager().getSimulationManager();return!!e&&e.isIsolateEffectActive()}getAreOptimizedBuffersEnabled(){return this.areOptimizedBuffersEnabled}onBrowserTabVisibilityChanged(){switch(document.visibilityState){case"hidden":this.isBrowserTabVisible=!1;break;case"visible":this.isBrowserTabVisible=!0,this.frameTimer.resetTimings()}}getCurvatureAnalysisManager(){return this.curvatureAnalysisManager}getThicknessAnalysisManager(){var e,t;return null!==(t=null===(e=this.modelViewManagers.getManager())||void 0===e?void 0:e.getThicknessAnalysisManager())&&void 0!==t?t:null}getXrController(){return this.xrController}get isOngoingRenderLoopRunning(){var e;return null===(e=this.xrController)||void 0===e?void 0:e.getIsXrRunning()}getXrInputCamera(e){const t=new b.OrthographicCamera;t.setFrame(U.mat4.multiply(U.mat4.create(),this.xrController.modelTransformInverse,e.worldSpacePose)),t.setViewportFromCanvasElement(this.$el);const i=1e-4,s=t.getViewportWidth()*i*.5,n=t.getViewportHeight()*i*.5;t.setExtentsByComponent(-s,s,-n,n),t.sceneBounds=this.getSceneBounds();const r=b.XR_POINTER_TIP_Z_OFFSET,a=Math.max(t.near+.001,U.vec3.dot(t.getForward(),U.vec3.subtract(U.vec3.create(),t.sceneBounds.center(),t.getEye()))+t.sceneBounds.diameter()/2);return t.setNearFar(r,a),t}pickWithXrInput(e){if(e.picks)return e.picks;const t=this.getXrInputCamera(e),i=t.getViewportWidth()/2,s=t.getViewportHeight()/2;return e.picks=this.pickIteratively(i,s,this.getDefaultPickTerminationEvaluator(),{cameraOverride:t}),e.picks}getDepthForXrInput(e){const t=this.getXrInputCamera(e),i=t.getViewportWidth()/2,s=t.getViewportHeight()/2,n=this.findDepthsInRect(i-2,s-2,5,5,!1,t);if(0===n.length)return-1;let r=0;const a=e.modelSpaceRay;for(const e of n)r+=a.findPositionOfPoint(t.canvasToWorld(e));return r/n.length}getIsSynchingView(){return this.isSynchingView}setIsSynchingView(e){this.isSynchingView=e,this.pairedViewer&&(this.pairedViewer.isSynchingView=e)}setShouldUpdatePairedViewer(e){this.shouldUpdatePairedViewer=e}syncPairedView(){this.pairedViewer.updateCamera(this.getCameraData(U.mat4.identity(U.mat4.create()))),this.pairedViewer.setShouldUpdatePairedViewer(!1),this.pairedViewer.requestDraw()}onAppearanceConstantsUpdated(){this.resources.onAppearanceConstantsUpdated();for(const e of Object.values(this.uiElements))e.onAppearanceConstantsUpdated();const e=this.getReferenceHighlights();Object.values(e.highlights).forEach((t=>{e.updateHighlightColor(t.type)})),this.getModelViewManagers().onAppearanceConstantsUpdated(),this.requestDraw()}}function ie(){if(localStorage.getItem("osDisplayDataTimersLoggingEnabled"))return{logResult:!0}}t.Viewer=te,t.createTestViewer=function(e){return new te({el:e,disableAutomaticDrawing:!0,disableInput:!0,disableViewManipulator:!0})},t.getDisplayDataTimerLoggingOptions=ie},649480:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.retrieveViewportAsImage=t.getViewerForDebugOrTestPurposes=t.getActiveViewerCanvasCoordinateFromEvent=t.afterPrint=t.beforePrint=t.getActiveViewerSceneGraphs=t.getActiveViewerModelViewManagers=t.getActiveViewerOccurrenceDataManager=t.getActiveViewerSketch=t.setBaseHighlightsEnabled=t.getActiveViewer=t.setForceHideInteriorSelections=void 0;const s=i(520498),n=i(114924);function r(){return(0,s.getActiveViewer)()}t.setForceHideInteriorSelections=function(e){const t=r();t&&t.setForceHideInteriorSelections(e)},t.getActiveViewer=r,t.setBaseHighlightsEnabled=function(e){const t=r();t&&t.setBaseHighlightsEnabled(e)},t.getActiveViewerSketch=function(){const e=r();return e?e.getSketch():null},t.getActiveViewerOccurrenceDataManager=function(){return r().getOccurrenceDataManager()},t.getActiveViewerModelViewManagers=function(){const e=r();return e?e.getModelViewManagers():null},t.getActiveViewerSceneGraphs=function(){return r().getSceneGraphs()};t.beforePrint=function(){r()&&r().onBeforePrint()};function a(e){const t=(0,n.getCurrentActiveViewerSet)();return t?e?t.sheetMetalViewer:r():null}t.afterPrint=function(){r()&&r().onAfterPrint()},t.getActiveViewerCanvasCoordinateFromEvent=function(e){const t=r();return t?t.getCanvasCoordinateFromEvent(e):[e.pageX,e.pageY]},t.getViewerForDebugOrTestPurposes=a,t.retrieveViewportAsImage=function(e){if(!(0,n.getCurrentActiveViewerSet)())return null;const t=a(e.useFlattenedView);return t?e.usePrint?t.retrievePrintedCanvasPixels(e):t.retrieveViewportAsImage(e):null}},493428:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.sketchinformation=t.Resources=t.NodePropertiesTypes=void 0;const s=i(736234),n=i(114924),r=i(142885);var a;!function(e){e[e.OVERDEFINED=1]="OVERDEFINED",e[e.EXTERNAL_AND_OK=2]="EXTERNAL_AND_OK",e[e.OK=3]="OK",e[e.DRIVEN=4]="DRIVEN"}(a||(t.NodePropertiesTypes=a={}));const o=function(e){const t=this.viewer.getReferenceHighlights(),i=new Uint8Array(4*t.sortedHighlights.length);for(let e=0;e<t.sortedHighlights.length;e++){const s=(0,n.convertRGBAToRGBA255)(t.sortedHighlights[e].color1);for(let t=0;t<4;t++)i[4*e+t]=s[t]}const s=new n.TextureDefinition(e);return s.bytes=i,s.width=i.length/4,s.height=1,s},c={isVisible:!0,isTwoSided:!0,priority:n.RenderOrderPriority.HIGHER,primitiveType:n.PrimitiveType.TRIANGLES,isShowThrough:!0,isDepthTested:!1};class l extends r.BackboneEventsBaseClass{constructor(e){super(),this.viewer=e,this.blitQuad=null,this.highlightColorTexture=null,this.blankTexture=null,this.primitiveRestartBuffer=null,this.constraintAtlas=null,this.typeToNodeProperties={},this.constraintAtlasCreationInitiated=!1,this.commentIndicatorAtlas=null,this.commentIndicatorAtlasCreationInitiated=!1,this.dimensionAtlas=null,this.dimensionAtlasCurrentPixelRatio=0,this.dimensionAtlasTargetPixelRatio=0,this.centerOfMassIndicatorNodeProperties=null,this.scalarVisualizationTextures=new Map,this.imageTextureCache=new Map,(0,n.viewerCheck)(e),this.constraintMaterial=(0,n.createTextureMaterial)(),(0,s.each)(a,function(e){this.typeToNodeProperties[e]=new n.NodeProperties({isPickable:!0,primitiveType:n.PrimitiveType.TRIANGLES,material:this.constraintMaterial,isVisible:!0,zOffset:e})}.bind(this)),this.inferenceNodeProperties=new n.NodeProperties({isPickable:!1,primitiveType:n.PrimitiveType.TRIANGLES,material:this.constraintMaterial,isVisible:!0,zOffset:0}),this.listenTo(this.viewer.getEventDispatcher(),n.GL_CONTEXT_RESTORED,this.onGlContextRestored),this.commentIndicatorMaterial=(0,n.createTextureMaterial)(),this.commentIndicatorNodeProperties=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLES,material:this.commentIndicatorMaterial}),this.dimensionMaterial=(0,n.createTextureMaterial)(),this.dimensionNodeProperties=[new n.NodeProperties(Object.assign({isPickable:!0,material:this.dimensionMaterial},c)),new n.NodeProperties(Object.assign({isPickable:!1,material:this.dimensionMaterial},c))]}onGlContextRestored(){this.constraintAtlas&&(this.constraintMaterial.ambientTexture=this.constraintAtlas.texture)}reset(){this.blitQuad&&(this.blitQuad.remove(),this.blitQuad=null),this.blankTexture&&(this.blankTexture.destroy(),this.blankTexture=null),this.invalidateHighlightTexture(),this.constraintMaterial.destroy(),this.mateIndicatorGlyphResources&&this.mateIndicatorGlyphResources.destroy(),this.loadGlyphResources&&this.loadGlyphResources.destroy(),this.commentIndicatorMaterial.destroy(),this.dimensionMaterial.destroy(),this.stopListening(),this.primitiveRestartBuffer&&(this.primitiveRestartBuffer.destroy(),this.primitiveRestartBuffer=null)}getBlitNode(){if(!this.blitQuad){const e=new n.NodeProperties({primitiveType:n.PrimitiveType.TRIANGLES,isPickable:!0,isTwoSided:!0,material:null});this.blitQuad=new n.Quad([-1,-1,0],[1,-1,0],[-1,1,0],e,this.viewer,"blit"),this.blitQuad.getOccurrenceData().setShouldSetOccurrenceUniform(!1)}return this.blitQuad.getNode()}getHighlightTexture(){return this.highlightColorTexture||(this.highlightColorTexture=new n.Texture(this.viewer,o)),this.highlightColorTexture}invalidateHighlightTexture(){this.highlightColorTexture&&(this.highlightColorTexture.destroy(),this.highlightColorTexture=null)}getBlankTexture(){if(!this.blankTexture){const e=this.viewer.getGlContext(),t=new n.TextureDefinition(e);t.width=2,t.height=2,t.bytes=new Uint8Array(t.width*t.height*4),this.blankTexture=new n.Texture(this.viewer,t)}return this.blankTexture}getImageTexture(e){let t=this.imageTextureCache.get(e);if(!t){const i=this.viewer.getGlContext(),s=new n.TextureDefinition(i);s.imageSource=e,s.wrapS=i.CLAMP_TO_EDGE,s.wrapT=i.CLAMP_TO_EDGE,t=new n.Texture(this.viewer,s),t.hasTransparency=!1,this.imageTextureCache.set(e,t)}return t}onDevicePixelRatioChanged(){var e;null===(e=this.loadGlyphResources)||void 0===e||e.onDevicePixelRatioChanged()}onAppearanceConstantsUpdated(){var e;this.constraintAtlasCreationInitiated=!1,this.constraintAtlas&&(this.constraintAtlas.destroy(),this.constraintAtlas=null),this.viewer.getTextureAtlasFactory().clearAtlas(n.SKETCH_CONSTRAINT_TEXTURE_ATLAS),null===(e=this.loadGlyphResources)||void 0===e||e.reinitialize()}}t.Resources=l,t.sketchinformation={nodePropertiesTypes:a},t.sketchinformation.nodePropertiesTypes=a},161656:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.removeGraphicsViewers=t.preserveViewersForDocumentId=t.initializePreviousVersionViewer=t.getOrCreateViewerSet=t.getCurrentActiveViewerSet=t.PREVIOUS_VERSION_CANVAS_SELECTOR=void 0;const n=i(427134),r=i(606544),a=i(114924),o=i(119965);let c=null,l=null;const h="#canvas",d="previous-version-canvas";t.PREVIOUS_VERSION_CANVAS_SELECTOR=`#${d}`,t.getCurrentActiveViewerSet=function(){return c},t.getOrCreateViewerSet=function(e){var i;if(e=e||{},c)l=null,s(h).replaceWith(c.mainViewer.$el),(null===(i=c.previousVersionViewer)||void 0===i?void 0:i.$el)&&s(t.PREVIOUS_VERSION_CANVAS_SELECTOR).replaceWith(c.previousVersionViewer.$el),c.mainViewer.onViewerReactivated(),c.previousVersionViewer&&c.previousVersionViewer.onViewerReactivated(),c.sheetMetalViewer&&c.sheetMetalViewer.onViewerReactivated();else{const t={mainViewer:new a.Viewer({el:h,contextMenuMgr:e.contextMenuMgr})};if(t.mainViewer.getWebGlSupport()!==o.CoreWebGlSupport.SUPPORTED)return t;if(e.createSheetMetalViewer){t.partStudioToAlternateMapping=new n.PartStudioAlternateEntityMapping;const i=s("<canvas/>",{id:"sheetmetalcanvas","data-view-shown":"unknown"});t.sheetMetalViewer=new a.Viewer({el:i,dontSetActive:!0,isForFlattenedDisplay:!0,hidden:!0,contextMenuMgr:e.contextMenuMgr})}c=t}return c},t.initializePreviousVersionViewer=function(e,t){if(e.previousVersionViewer)return;const i=s("<canvas/>",{id:d,"data-view-shown":"unknown"});e.previousVersionViewer=new a.Viewer({el:i,dontSetActive:!0,isForFlattenedDisplay:!1,isForPreviousVersionDisplay:!0,hidden:!1,contextMenuMgr:t}),e.mainViewer.pairedViewer=e.previousVersionViewer,e.previousVersionViewer.pairedViewer=e.mainViewer,e.previousVersionViewer.setSuppressModelSelection(!0)},t.preserveViewersForDocumentId=function(e){l=e},t.removeGraphicsViewers=function(){c&&(c.mainViewer.setActiveElement(null,r.GBTElementType.UNKNOWN,!0,null,null),c.mainViewer.setUnitsReceived(!1),c.mainViewer.$el.detach(),c.sheetMetalViewer&&(c.sheetMetalViewer.setActiveElement(null,r.GBTElementType.UNKNOWN,!0,null,null),c.sheetMetalViewer.setUnitsReceived(!1),c.sheetMetalViewer.$el.detach()))}},360071:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.ViewFrustum=t.ClippingPlaneNames=void 0;const s=i(264292),n=i(728616);var r;!function(e){e.RIGHT="Right",e.LEFT="Left",e.TOP="Top",e.BOTTOM="Bottom",e.NEAR="Near",e.FAR="Far"}(r||(t.ClippingPlaneNames=r={}));class a{constructor(e,t,i,s){const n=Math.sqrt(e*e+t*t+i*i);this.normal=[e/n,t/n,i/n],this.d=s/n}}t.ViewFrustum=class{constructor(e,t){this.clippingPlanes={},this.clippingMatrix=s.mat4.create(),e&&t&&this.updateClippingPlanes(e,t)}updateClippingPlanes(e,t){e&&t&&(this.clippingMatrix[0]=e[0]*t[0]+e[1]*t[4]+e[2]*t[8]+e[3]*t[12],this.clippingMatrix[1]=e[0]*t[1]+e[1]*t[5]+e[2]*t[9]+e[3]*t[13],this.clippingMatrix[2]=e[0]*t[2]+e[1]*t[6]+e[2]*t[10]+e[3]*t[14],this.clippingMatrix[3]=e[0]*t[3]+e[1]*t[7]+e[2]*t[11]+e[3]*t[15],this.clippingMatrix[4]=e[4]*t[0]+e[5]*t[4]+e[6]*t[8]+e[7]*t[12],this.clippingMatrix[5]=e[4]*t[1]+e[5]*t[5]+e[6]*t[9]+e[7]*t[13],this.clippingMatrix[6]=e[4]*t[2]+e[5]*t[6]+e[6]*t[10]+e[7]*t[14],this.clippingMatrix[7]=e[4]*t[3]+e[5]*t[7]+e[6]*t[11]+e[7]*t[15],this.clippingMatrix[8]=e[8]*t[0]+e[9]*t[4]+e[10]*t[8]+e[11]*t[12],this.clippingMatrix[9]=e[8]*t[1]+e[9]*t[5]+e[10]*t[9]+e[11]*t[13],this.clippingMatrix[10]=e[8]*t[2]+e[9]*t[6]+e[10]*t[10]+e[11]*t[14],this.clippingMatrix[11]=e[8]*t[3]+e[9]*t[7]+e[10]*t[11]+e[11]*t[15],this.clippingMatrix[12]=e[12]*t[0]+e[13]*t[4]+e[14]*t[8]+e[15]*t[12],this.clippingMatrix[13]=e[12]*t[1]+e[13]*t[5]+e[14]*t[9]+e[15]*t[13],this.clippingMatrix[14]=e[12]*t[2]+e[13]*t[6]+e[14]*t[10]+e[15]*t[14],this.clippingMatrix[15]=e[12]*t[3]+e[13]*t[7]+e[14]*t[11]+e[15]*t[15],this.updateClippingPlane(r.BOTTOM,this.clippingMatrix[3]+this.clippingMatrix[1],this.clippingMatrix[7]+this.clippingMatrix[5],this.clippingMatrix[11]+this.clippingMatrix[9],this.clippingMatrix[15]+this.clippingMatrix[13]),this.updateClippingPlane(r.TOP,this.clippingMatrix[3]-this.clippingMatrix[1],this.clippingMatrix[7]-this.clippingMatrix[5],this.clippingMatrix[11]-this.clippingMatrix[9],this.clippingMatrix[15]-this.clippingMatrix[13]),this.updateClippingPlane(r.LEFT,this.clippingMatrix[3]+this.clippingMatrix[0],this.clippingMatrix[7]+this.clippingMatrix[4],this.clippingMatrix[11]+this.clippingMatrix[8],this.clippingMatrix[15]+this.clippingMatrix[12]),this.updateClippingPlane(r.RIGHT,this.clippingMatrix[3]-this.clippingMatrix[0],this.clippingMatrix[7]-this.clippingMatrix[4],this.clippingMatrix[11]-this.clippingMatrix[8],this.clippingMatrix[15]-this.clippingMatrix[12]))}updateClippingPlane(e,t,i,s,n){if(this.clippingPlanes[e]){const r=Math.sqrt(t*t+i*i+s*s),a=[t/r,i/r,s/r],o=n/r;this.clippingPlanes[e].normal=a,this.clippingPlanes[e].d=o}else this.clippingPlanes[e]=new a(t,i,s,n)}getSphereFrustumIntersection(e,t){let i=this.clippingPlanes[r.BOTTOM],s=i.normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d;return s<-t?n.IntersectionType.OUTSIDE:(i=this.clippingPlanes[r.TOP],s=i.normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d,s<-t?n.IntersectionType.OUTSIDE:(i=this.clippingPlanes[r.RIGHT],s=i.normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d,s<-t?n.IntersectionType.OUTSIDE:(i=this.clippingPlanes[r.LEFT],s=i.normal[0]*e[0]+i.normal[1]*e[1]+i.normal[2]*e[2]+i.d,s<-t?n.IntersectionType.OUTSIDE:n.IntersectionType.INSIDE)))}}},542042:function(e,t,i){var s,n=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.ViewManipulator=t.DropdownButton=t.ViewManipulatorButtons=t.MANIPULATOR_BUTTONS_ID=t.MANIPULATOR_ID=t.isTrimetricCorner=t.SelectionIds=t.setViewCubeMenuMgrInstance=t.viewCubeMenuMgrInstance=t.VIEW_MANIPULATOR_EVENT=void 0;const r=i(389496),a=i(599430),o=i(114924),c=i(545348),l=i(997687),h=i(805261),d=i(342416),u=i(586594),g=i(32620),p=i(264292),m=i(613199),E=i(29856),I=c.default.getManager();var T;function S(e){return 0===e.indexOf("Trimetric")}t.VIEW_MANIPULATOR_EVENT="viewManipulatorEvent",t.viewCubeMenuMgrInstance=null,t.setViewCubeMenuMgrInstance=function(e){t.viewCubeMenuMgrInstance=e},function(e){e.TOP="Top",e.BOTTOM="Bottom",e.FRONT="Front",e.BACK="Back",e.RIGHT="Right",e.LEFT="Left",e.TRIMETRIC_TOP_RIGHT_FRONT="Trimetric",e.TRIMETRIC_TOP_LEFT_FRONT="TrimetricTopLeftFront",e.TRIMETRIC_TOP_RIGHT_BACK="TrimetricTopRightBack",e.TRIMETRIC_TOP_LEFT_BACK="TrimetricTopLeftBack",e.TRIMETRIC_BOTTOM_RIGHT_FRONT="TrimetricBottomRightFront",e.TRIMETRIC_BOTTOM_LEFT_FRONT="TrimetricBottomLeftFront",e.TRIMETRIC_BOTTOM_RIGHT_BACK="TrimetricBottomRightBack",e.TRIMETRIC_BOTTOM_LEFT_BACK="TrimetricBottomLeftBack",e.LEFT_ARROW="LeftArrow",e.RIGHT_ARROW="RightArrow",e.UP_ARROW="UpArrow",e.DOWN_ARROW="DownArrow",e.CW_ARROW="CwArrow",e.CCW_ARROW="CcwArrow",e.VIEW_CONTROL_ICON="ViewCtrlIcon"}(T||(t.SelectionIds=T={})),t.isTrimetricCorner=S;const f=new o.NodeProperties({primitiveType:o.PrimitiveType.TRIANGLES,material:o.UNLIT_COLOR_FROM_ATTRIBUTE,zOffset:2}),C=new o.NodeProperties({isPickable:!1,primitiveType:o.PrimitiveType.LINES,isVisible:!1}),P=new o.NodeProperties({isPickable:!1,primitiveType:o.PrimitiveType.LINES}),v=P,D=new o.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,isStencilTested:!0,primitiveType:o.PrimitiveType.LINES}),M=new o.NodeProperties({isPickable:!1,primitiveType:o.PrimitiveType.TRIANGLES,material:null}),y=new o.NodeProperties({isPickable:!1,isShowThrough:!0,isDepthTested:!1,primitiveType:o.PrimitiveType.TRIANGLES,material:null});let O;const _=.5,A=.5*I.getNumber("VIEW_CUBE_ARROW_WIDTH"),R=.5*I.getNumber("VIEW_CUBE_ARROW_HEIGHT"),N=_-R;function w(){return(_-2*A)/1.6-I.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX")/O/1.5}let b;t.MANIPULATOR_ID="viewmanipulator",t.MANIPULATOR_BUTTONS_ID="viewmanipulatorbuttons";const L=".highlight";class B extends o.UIElement{constructor(e){super(e,o.HUD_SCENEGRAPH_ID),this.staticIncrements=null,this.cubeCenter=[0,0,0],this.setId(t.MANIPULATOR_BUTTONS_ID),this.highlightedId=o.NO_SELECTION_ID;for(const e of Object.values(T))this.listenTo(this,o.UiEvents.CLICK+e,this.onMouseClick),this.listenTo(this,o.UiEvents.MOUSE_ENTER+e,this.onMouseEnter),this.listenTo(this,o.UiEvents.MOUSE_LEAVE+e,this.onMouseLeave),e===T.VIEW_CONTROL_ICON&&this.listenTo(this.viewer.getEventDispatcher(),o.VIEW_CONTAINER_MENU_INVOKED,this.unselectViewControlIcon)}onDevicePixelRatioChanged(e){this.staticIncrements=null,this.updateGraphics()}setCubeCenter(e){this.cubeCenter=e}getStaticIncrements(){if(this.staticIncrements)return this.staticIncrements;const e=this;this.staticIncrements={};const t=function(t,i,s,n){m.vec3C.scale(i,O),m.vec3C.scale(s,O),m.vec3C.scale(n,O);const r=t+"Face",a=(0,o.createTriangle)(i,s,n);e.staticIncrements[r]={selection:t,data:a,type:f,color:I.getColor("VIEW_CUBE_ARROW_COLOR")}};t(T.LEFT_ARROW,[-.5,0,-.5],[-N,-A,-.5],[-N,A,-.5]),t(T.RIGHT_ARROW,[_,0,-.5],[N,A,-.5],[N,-A,-.5]),t(T.UP_ARROW,[0,_,-.5],[-A,N,-.5],[A,N,-.5]),t(T.DOWN_ARROW,[0,-.5,-.5],[A,-N,-.5],[-A,-N,-.5]);const i=Math.sin(Math.PI/4),s=Math.cos(Math.PI/4),n=Math.sin(Math.PI/4-R/_),r=Math.cos(Math.PI/4-R/_);t(T.CW_ARROW,[s*_,i*_,-.5],[s*(_-2*A),i*(_-2*A),-.5],[r*(_-A),n*(_-A),-.5]),t(T.CCW_ARROW,[-s*(_-2*A),i*(_-2*A),-.5],[-s*_,i*_,-.5],[-r*(_-A),n*(_-A),-.5]);const a=function(t,i,s){const n=Math.ceil(36*Math.abs(s-i)/Math.PI),r=(_-A-I.getNumber("VIEW_CUBE_ARROW_ARC_WIDTH")/2)*O,a=(_-A+I.getNumber("VIEW_CUBE_ARROW_ARC_WIDTH")/2)*O,c=(0,o.getCirclePoints)([0,0,0],r,[0,0,1],n,[1,0,0],i,s),l=(0,o.getCirclePoints)([0,0,0],a,[0,0,1],n,[1,0,0],i,s),h=(l.length+c.length)/3,d=new Float32Array(3*h);for(let e=0;e<h/2;++e)d[6*e+0]=c[3*e+0],d[6*e+1]=c[3*e+1],d[6*e+2]=c[3*e+2],d[6*e+3]=l[3*e+0],d[6*e+4]=l[3*e+1],d[6*e+5]=l[3*e+2];const u=t+"ArcFace",g=new Float32Array(3*h);for(let e=0;e<h;++e)g[3*e+0]=0,g[3*e+1]=0,g[3*e+2]=1;const p=new Int32Array(6*(h/2-1));for(let e=0;e<h/2-1;++e)p[6*e+0]=2*e+0,p[6*e+1]=2*e+1,p[6*e+2]=2*e+2,p[6*e+3]=2*e+1,p[6*e+4]=2*e+3,p[6*e+5]=2*e+2;const m=new o.MeshIncrement(o.PrimitiveType.TRIANGLES,d,p);m.normals=g,e.staticIncrements[u]={selection:t,data:m,type:f,color:I.getColor("VIEW_CUBE_ARROW_COLOR")}};return a(T.CW_ARROW,.25*Math.PI,.4*Math.PI),a(T.CCW_ARROW,.6*Math.PI,.75*Math.PI),e.staticIncrements}updateGraphics(){this.updateIncrementsOnEntity(T.LEFT_ARROW,"Face"),this.updateIncrementsOnEntity(T.RIGHT_ARROW,"Face"),this.updateIncrementsOnEntity(T.UP_ARROW,"Face"),this.updateIncrementsOnEntity(T.DOWN_ARROW,"Face"),this.updateIncrementsOnEntity(T.CW_ARROW,"Face"),this.updateIncrementsOnEntity(T.CCW_ARROW,"Face"),this.updateIncrementsOnEntity(T.CW_ARROW,"ArcFace"),this.updateIncrementsOnEntity(T.CCW_ARROW,"ArcFace")}updateIncrementsOnEntity(e,t){const i=this,s=this.getStaticIncrements();(s[e+t].type===f||s[e+t].type===P&&s[e+t].color)&&(0,o.addColorToIncrement)(i.highlightedId===s[e+t].selection?I.getColor("VIEW_CUBE_FACE_HIGHLIGHT"):s[e+t].color,s[e+t].data),this.updateMeshIncrement(e+t,s[e+t].selection,s[e+t].data.clone(),s[e+t].type)}updateTransform(){const e=p.mat4.create();e[12]=this.cubeCenter[0],e[13]=this.cubeCenter[1],e[14]=this.cubeCenter[2],this.setTransform(e),this.hasMeshIncrements()||this.updateGraphics()}onMouseClick(e,i,s){let n;this.trigger(t.VIEW_MANIPULATOR_EVENT,e.selectionId),l.btInjector.AnalyticsService.trackEventForDocumentId("VIEW_CUBE_COMMAND","click_"+e.selectionId,(0,h.getModelId)()),T.LEFT_ARROW===e.selectionId?n="left":T.RIGHT_ARROW===e.selectionId?n="right":T.UP_ARROW===e.selectionId?n="up":T.DOWN_ARROW===e.selectionId?n="down":T.CW_ARROW===e.selectionId?n="clockwise":T.CCW_ARROW===e.selectionId&&(n="counterclockwise"),n&&(i.shiftKey?this.viewer.rotateIncrementallyInDirection(n):this.viewer.rotateInDirection(n),s.requestSelectedStatus=!1)}unselectViewControlIcon(){this.highlightedId===T.VIEW_CONTROL_ICON&&(this.highlightedId=o.NO_SELECTION_ID,this.updateGraphics()),this.viewer.requestDraw()}onMouseEnter(e,t){this.highlightedId=e.selectionId,this.updateGraphics(),this.viewer.requestDraw()}onMouseLeave(e,t){this.highlightedId===e.selectionId&&(this.highlightedId=o.NO_SELECTION_ID,this.updateGraphics()),this.viewer.requestDraw()}isViewManipulator(){return!0}}t.ViewManipulatorButtons=B;const F="label",x="label.showthrough",U=(0,o.toRadians)(I.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_START_ANGLE")),G=(0,o.toRadians)(I.getNumber("VIEW_CUBE_AXIS_LABEL_FADE_END_ANGLE"));class V extends o.UIElement{constructor(e,t,i,s){super(s,o.HUD_SCENEGRAPH_ID),this.label=e,this.direction=t,this.colorName=i,this.labelTexture=null,this.center=[0,0,0,0],this.cubeCenter=p.vec3.create(),this.lastSetOpacity=-1,this.nodeProperties=new o.NodeProperties(M),this.nodeProperties.material=(0,o.createTextureMaterial)(),this.nodeProperties.updateId(),this.showThroughNodeProperties=new o.NodeProperties(y),this.showThroughNodeProperties.material=this.nodeProperties.material,this.showThroughNodeProperties.updateId(),this.ensureTexture()}onDevicePixelRatioChanged(e){this.refreshGraphics()}onAppearanceConstantsUpdated(){this.refreshGraphics()}refreshGraphics(){this.labelTexture&&(this.labelTexture.destroy(),this.labelTexture=null),this.viewer.getGlContext()&&(this.ensureTexture(),this.updateIncrements())}remove(){this.labelTexture&&this.labelTexture.destroy(),this.nodeProperties.material&&(this.nodeProperties.material.destroy(),this.nodeProperties.material=null),super.remove()}updateIncrements(){const e=I.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX"),t=this.labelTexture.filledWidthPx,i=(0,o.createQuad)([-t/2,-e/2,0],[t/2,-e/2,0],[-t/2,e/2,0],void 0,[this.labelTexture.leftCoordinate,this.labelTexture.bottomCoordinate],[this.labelTexture.rightCoordinate,this.labelTexture.topCoordinate]);(0,o.addColorToIncrement)([1,1,1,.5],i),this.updateMeshIncrement(F,o.NO_SELECTION_ID,i,this.nodeProperties);const s=i.clone();(0,o.addColorToIncrement)([1,1,1,I.getNumber("VIEW_CUBE_HIDDEN_AXIS_OPACITY")],s),this.updateMeshIncrement(x,o.NO_SELECTION_ID,s,this.showThroughNodeProperties);const n=O*b,r=I.getNumber("VIEW_CUBE_AXIS_GAP"),a=[-n-r,-n-r,-n-r],c=Math.sqrt(t*t+e*e)/2+3,l=m.vec3C.add(m.vec3C.scale(this.direction,2*n+c,p.vec3.create()),a);this.center=[l[0],l[1],l[2],0]}ensureTexture(){this.viewer.getGlContext()&&(this.labelTexture||(this.labelTexture=(0,o.createTextureFromText)(this.viewer,this.label,{color:I.getColor(this.colorName),font:I.getString("VIEW_CUBE_TEXT_FONT"),size:I.getNumber("VIEW_CUBE_AXIS_TEXT_HEIGHT_PX")}),this.nodeProperties.material.ambientTexture=this.labelTexture,this.showThroughNodeProperties.material.ambientTexture=this.labelTexture,this.updateIncrements()))}setCubeCenter(e){this.cubeCenter=e}setOpacity(e){if(e===this.lastSetOpacity)return;const t=new Uint8Array([255,255,255,255*e]);this.updateIncrementAttribute(F,o.Attributes.COLOR,t),t[3]=255*Math.min(e,I.getNumber("VIEW_CUBE_HIDDEN_AXIS_OPACITY")),this.updateIncrementAttribute(x,o.Attributes.COLOR,t),this.lastSetOpacity=e}updateTransform(e){const t=Math.acos(Math.abs(p.vec3.dot(e.getForward(),this.direction))),i=(0,o.smoothstep)(G,U,t);this.setOpacity(i);const s=m.mat4C.multiplyVec4(e.getViewMatrix(),this.center,p.vec4.create()),n=m.vec3C.add(s,this.cubeCenter);this.setTransform(m.mat4C.translate(p.mat4.create(),n))}}let H=class extends a.View{constructor(e,t){super(t),this.contextMenuMgr=e}initialize(e){this.viewer=e.viewer,this.parentManipulator=e.parentManipulator,this.mouseMoveFunction=e=>this.onMouseMove(e),this.mouseUpFunction=e=>this.onMouseUp(e),this.distanceDraggedPx=0,this.rightPostion=-1,this.topPosition=-1,this.$el.hide(),this.$el.html(E()),this.$el.attr("data-bs-original-title",i18n("Camera and render options"));const t=I.getNumber("VIEW_CUBE_SCREEN_SIZE_PX")/(0,g.getDevicePixelRatio)();this.$el.find(".os-view-cube-bounds").css({width:t+"px",height:t+"px",right:0,bottom:"5px"})}appendToCanvasParent(){this.$el.appendTo(this.viewer.$el.parent()),this.delegateEvents()}position(e,t){this.rightPostion===e&&this.topPosition===t||(this.$el.css({right:e,top:t}),this.rightPostion=e,this.topPosition=t)}onClick(){this.distanceDraggedPx<=I.getNumber("LEFT_MOUSE_DRAG_DISTANCE_TOLERANCE")&&l.btInjector.CapabilitiesService.isAngularViewcubeMenuEnabled().then((e=>{e?t.viewCubeMenuMgrInstance.toggleViewCubeMenuVisibility(this.$el,this.viewer):this.$el.hasClass("os-dropdown-open")?this.contextMenuMgr.closeAllContextMenus():n("#content-div .viewControlPopup").osContextMenu()})),this.distanceDraggedPx=0}getCanvasPositionFromEvent(e){const t=this.viewer.getCanvasCoordinateFromEvent(e);return{mouseX:t[0],mouseY:t[1]}}onMouseDown(e){this.viewer.isReadyForDrawing()&&(l.btInjector.FlyoutService.collapseAllFlyouts(),1===e.which&&(this.parentManipulator.setDragStart(this.getCanvasPositionFromEvent(e)),n(document).on("mousemove",this.mouseMoveFunction),n(document).on("mouseup",this.mouseUpFunction)))}onMouseMove(e){this.viewer.isReadyForDrawing()&&(this.distanceDraggedPx+=this.parentManipulator.updateDragPosition(this.getCanvasPositionFromEvent(e)))}onMouseUp(e){n(document).off("mousemove",this.mouseMoveFunction),n(document).off("mouseup",this.mouseUpFunction)}};t.DropdownButton=H,t.DropdownButton=H=r.__decorate([(0,u.BackboneViewProperties)({className:"os-graphics-dropdown",events:{click:"onClick",mousedown:"onMouseDown"}}),r.__metadata("design:paramtypes",["function"==typeof(s=void 0!==d.IContextMenuMgr&&d.IContextMenuMgr)?s:Object,Object])],H);class k extends o.UIElement{constructor(e,i){super(e,o.HUD_SCENEGRAPH_ID),this.contextMenuMgr=i,this.labelTextures={},this.labelProperties={},this.topRightCorner=p.vec3.create(),this.center=p.vec3.create(),this.staticIncrements=null,this.axisLabels={},this.dropdownButton=null,this.i18next=i18n,"function"!=typeof this.i18next&&(this.i18next=function(e){return e}),O=I.getNumber("VIEW_CUBE_SCREEN_SIZE_PX"),b=w(),this.setId(t.MANIPULATOR_ID),this.highlightedId=o.NO_SELECTION_ID,this.oldDevicePixelRatio=(0,g.getDevicePixelRatio)(),this.manipulatorButtons=new B(this.viewer),this.listenTo(this.viewer.getEventDispatcher(),o.GL_CONTEXT_RESTORED,this.ensureTextures);for(const e of Object.values(T))this.listenTo(this,o.UiEvents.CLICK+e,this.onMouseClick),this.listenTo(this,o.UiEvents.MOUSE_ENTER+e,this.onMouseEnter),this.listenTo(this,o.UiEvents.MOUSE_LEAVE+e,this.onMouseLeave),this.listenTo(this,o.UiEvents.DRAG_START+e,this.onDragStart),this.listenTo(this,o.UiEvents.DRAG+e,this.onDrag),this.listenTo(this,o.UiEvents.DRAG_STOP+e,this.onDragStop),this.listenTo(this.manipulatorButtons,o.UiEvents.DRAG_START+e,this.onDragStart),this.listenTo(this.manipulatorButtons,o.UiEvents.DRAG+e,this.onDrag),this.listenTo(this.manipulatorButtons,o.UiEvents.DRAG_STOP+e,this.onDragStop);this.axisLabels.X=new V("X",[1,0,0],"X_AXIS_COLOR",this.viewer),this.axisLabels.Y=new V("Y",[0,1,0],"Y_AXIS_COLOR",this.viewer),this.axisLabels.Z=new V("Z",[0,0,1],"Z_AXIS_COLOR",this.viewer),this.viewer.getIsPrimaryViewer()&&(this.dropdownButton=new H(i,{viewer:this.viewer,parentManipulator:this})),this.ensureTextures()}onDevicePixelRatioChanged(e){const t=(0,g.getDevicePixelRatio)();m.vec3C.scale(this.topRightCorner,t/this.oldDevicePixelRatio),this.oldDevicePixelRatio=t,O=I.getNumber("VIEW_CUBE_SCREEN_SIZE_PX"),b=w(),this.refreshGraphics(),this.updateDropdownPosition()}onAppearanceConstantsUpdated(){this.refreshGraphics()}refreshGraphics(){this.staticIncrements=null,this.destroyTextures(),this.viewer.getGlContext()&&(this.ensureTextures(),this.updateGraphics())}destroyTextures(){Object.values(this.labelTextures).forEach((function(e){e.destroy()})),this.labelTextures={}}remove(){Object.values(this.labelProperties).forEach((function(e){e.material&&(e.material.destroy(),e.material=null)})),this.dropdownButton&&this.dropdownButton.remove(),super.remove()}hide(){super.hide(),this.manipulatorButtons.hide(),Object.values(this.axisLabels).forEach((function(e){e.hide()})),this.dropdownButton&&this.dropdownButton.$el.hide()}show(){super.show(),this.manipulatorButtons.show(),Object.values(this.axisLabels).forEach((function(e){e.show()})),this.dropdownButton&&(this.dropdownButton.appendToCanvasParent(),this.dropdownButton.$el.show())}getPickPriority(e){return S(e.selectionId)?o.PickPriority.UI+5:o.PickPriority.UI}onViewWillDraw(e,t){this.updateTransform(e),this.manipulatorButtons.updateTransform();for(const t in this.axisLabels)this.axisLabels[t].updateTransform(e)}ensureTextures(){if(!this.viewer.getGlContext())return;const e=this,t=function(t,i,s,n){e.labelTextures[t]||(e.labelTextures[t]=(0,o.createTextureFromText)(e.viewer,i,{color:n?I.getColor("VIEW_CUBE_TEXT_COLOR_HIGHLIGHT"):I.getColor("VIEW_CUBE_TEXT_COLOR"),font:I.getString("VIEW_CUBE_TEXT_FONT"),size:s,paddingWithinBorder:I.getNumber("VIEW_CUBE_TEXT_BACKGROUND_PADDING")}));let r=e.labelProperties[t];r||(r=new o.NodeProperties(M),r.material=(0,o.createTextureMaterial)(),e.labelProperties[t]=r),r.material.ambientTexture=e.labelTextures[t],r.updateId()},i=function(e,i,s){t(e,i,s,!1),t(e+L,i,s,!0)};i(T.TOP,this.i18next("Top"),I.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),i(T.BOTTOM,this.i18next("Bottom"),I.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),i(T.FRONT,this.i18next("Front"),I.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),i(T.BACK,this.i18next("Back"),I.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),i(T.RIGHT,this.i18next("Right"),I.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX")),i(T.LEFT,this.i18next("Left"),I.getNumber("VIEW_CUBE_TEXT_HEIGHT_PX"));for(const e in this.axisLabels)this.axisLabels[e].ensureTexture()}updateCenter(e){const t=e.getViewport(),i=-(0,o.getHudLayerDepthRange)(t)[0]-.5*O;this.center=m.vec3C.add([t[0]+t[2]-O/2,t[1]+t[3]-O/2,i],this.topRightCorner);const s=t[0]+I.getNumber("VIEW_CUBE_LEFT_MARGIN_PX")+O/2,n=t[1]+I.getNumber("VIEW_CUBE_BOTTOM_MARGIN_PX")+O/2,r=t[0]+t[2]-I.getNumber("VIEW_CUBE_RIGHT_MARGIN_PX")-O/2,a=t[1]+t[3]-I.getNumber("VIEW_CUBE_TOP_MARGIN_PX")-O/2;this.center[0]=Math.min(Math.max(s,this.center[0]),r),this.center[1]=Math.min(Math.max(n,this.center[1]),a),this.topRightCorner=[this.center[0]+O/2-t[0]-t[2],this.center[1]+O/2-t[1]-t[3],0],this.updateDropdownPosition();for(const e in this.axisLabels)this.axisLabels[e].setCubeCenter(this.center);this.manipulatorButtons.setCubeCenter(this.center)}getStaticIncrements(){if(this.staticIncrements)return this.staticIncrements;const e=this;this.staticIncrements={};const t=function(t,i,s,n){m.vec3C.scale(i,O),m.vec3C.scale(s,O),m.vec3C.scale(n,O);const r=m.vec3C.subtract(s,i,p.vec3.create()),a=m.vec3C.subtract(n,i,p.vec3.create()),c=m.vec3C.add(i,m.vec3C.scale(m.vec3C.add(r,a,p.vec3.create()),.5),p.vec3.create()),l=m.vec3C.length(r),h=m.vec3C.length(a);m.vec3C.scale(r,1/l),m.vec3C.scale(a,1/h);const d=(l+h)/2*I.getNumber("VIEW_CUBE_CORNER_SIZE"),u=t+"Front",g=l*I.getNumber("VIEW_CUBE_FRONT_SIZE"),E=h*I.getNumber("VIEW_CUBE_FRONT_SIZE");let T=m.vec3C.add(m.vec3C.scale(r,-.5*g,p.vec3.create()),m.vec3C.scale(a,-.5*E,p.vec3.create()),p.vec3.create());T=m.vec3C.add(T,c);const S=m.vec3C.add(m.vec3C.scale(r,g,p.vec3.create()),T),P=m.vec3C.add(m.vec3C.scale(a,E,p.vec3.create()),T),v=(0,o.createRoundedRectangle)(T,S,P,d,9);e.staticIncrements[u]={selection:t,data:v,type:f,color:I.getColor("VIEW_CUBE_FRONT_COLOR")};const D=t+"Edge",M=v.points;let y=M.length/3;const _=new Int32Array(2*y);for(let e=0;e<y;++e)_[2*e]=e,_[2*e+1]=(e+1)%y;const A=new o.MeshIncrement(o.PrimitiveType.LINES,M,_);e.staticIncrements[D]={selection:t,data:A,type:C,color:I.getColor("VIEW_CUBE_EDGE_HIGHLIGHT")};const R=t+"Back",N=l*I.getNumber("VIEW_CUBE_BACK_SIZE"),w=h*I.getNumber("VIEW_CUBE_BACK_SIZE");let b=m.vec3C.add(m.vec3C.scale(r,-.5*N,p.vec3.create()),m.vec3C.scale(a,-.5*w,p.vec3.create()),p.vec3.create());b=m.vec3C.add(b,c);const B=m.vec3C.add(m.vec3C.scale(r,N,p.vec3.create()),b),F=m.vec3C.add(m.vec3C.scale(a,w,p.vec3.create()),b),x=(0,o.createRoundedRectangle)(b,F,B,d,9);e.staticIncrements[R]={selection:t,data:x,type:f,color:I.getColor("VIEW_CUBE_BACK_COLOR")};const U=t+"BackEdge",G=x.points;y=M.length/3;const V=new Int32Array(2*y);for(let e=0;e<y;++e)V[2*e]=e,V[2*e+1]=(e+1)%y;const H=new o.MeshIncrement(o.PrimitiveType.LINES,G,V);e.staticIncrements[U]={selection:t,data:H,type:C,color:I.getColor("VIEW_CUBE_EDGE_HIGHLIGHT")};const k=t+"Label",W=e.labelTextures[t],z=W.filledWidthPx,j=W.filledHeightPx,X=(l-z)/2,q=(h-j)/2,Y=m.vec3C.add(m.vec3C.scale(r,X,p.vec3.create()),m.vec3C.scale(a,q,p.vec3.create()),p.vec3.create());m.vec3C.add(Y,i);const Z=m.vec3C.add(Y,m.vec3C.scale(r,z,p.vec3.create()),p.vec3.create()),K=m.vec3C.add(Y,m.vec3C.scale(a,j,p.vec3.create()),p.vec3.create()),Q=(0,o.createQuad)(Y,Z,K,void 0,[W.leftCoordinate,W.bottomCoordinate],[W.rightCoordinate,W.topCoordinate]);e.staticIncrements[k]={selection:t,data:Q,type:e.labelProperties[t],color:null},e.staticIncrements[k+L]={selection:t,data:Q,type:e.labelProperties[t+L],color:null}},i=b;t(T.TOP,[-i,-i,i],[i,-i,i],[-i,i,i]),t(T.BOTTOM,[-i,i,-i],[i,i,-i],[-i,-i,-i]),t(T.FRONT,[-i,-i,-i],[i,-i,-i],[-i,-i,i]),t(T.BACK,[i,i,-i],[-i,i,-i],[i,i,i]),t(T.RIGHT,[i,-i,-i],[i,i,-i],[i,-i,i]),t(T.LEFT,[-i,i,-i],[-i,-i,-i],[-i,i,i]);const s=function(t,i,s,n){m.vec3C.scale(i,O),n*=O;const r=t+"Face",a=(0,o.createDisc)(i,n,s,36);e.staticIncrements[r]={selection:t,data:a,type:f,color:I.getColor("VIEW_CUBE_FRONT_COLOR")};const c=t+"Edge",l=a.points,h=l.length/3,d=new Int32Array(2*h);for(let e=0;e<h;++e)d[2*e]=e,d[2*e+1]=(e+1)%h;const u=new o.MeshIncrement(o.PrimitiveType.LINES,l,d);e.staticIncrements[c]={selection:t,data:u,type:C,color:I.getColor("VIEW_CUBE_EDGE_HIGHLIGHT")}},n=.8*i,r=.24*i;return s(T.TRIMETRIC_TOP_RIGHT_FRONT,[n,-n,n],[1,-1,1],r),s(T.TRIMETRIC_TOP_LEFT_FRONT,[-n,-n,n],[-1,-1,1],r),s(T.TRIMETRIC_TOP_RIGHT_BACK,[n,n,n],[1,1,1],r),s(T.TRIMETRIC_TOP_LEFT_BACK,[-n,n,n],[-1,1,1],r),s(T.TRIMETRIC_BOTTOM_RIGHT_FRONT,[n,-n,-n],[1,-1,-1],r),s(T.TRIMETRIC_BOTTOM_LEFT_FRONT,[-n,-n,-n],[-1,-1,-1],r),s(T.TRIMETRIC_BOTTOM_RIGHT_BACK,[n,n,-n],[1,1,-1],r),s(T.TRIMETRIC_BOTTOM_LEFT_BACK,[-n,n,-n],[-1,1,-1],r),e.staticIncrements}updateGraphics(){const e=T,t=[e.TOP,e.BOTTOM,e.FRONT,e.BACK,e.LEFT,e.RIGHT];let i;for(i=0;i<t.length;i++)this.updateIncrementsOnEntity(t[i],"Front"),this.updateIncrementsOnEntity(t[i],"Edge"),this.updateIncrementsOnEntity(t[i],"Back"),this.updateIncrementsOnEntity(t[i],"BackEdge"),this.highlightedId===t[i]?(this.removeMeshIncrement(t[i]+"Label"),this.updateIncrementsOnEntity(t[i],"Label"+L)):(this.removeMeshIncrement(t[i]+"Label"+L),this.updateIncrementsOnEntity(t[i],"Label"));const s=[e.TRIMETRIC_TOP_RIGHT_FRONT,e.TRIMETRIC_TOP_LEFT_FRONT,e.TRIMETRIC_TOP_RIGHT_BACK,e.TRIMETRIC_TOP_LEFT_BACK,e.TRIMETRIC_BOTTOM_RIGHT_FRONT,e.TRIMETRIC_BOTTOM_LEFT_FRONT,e.TRIMETRIC_BOTTOM_RIGHT_BACK,e.TRIMETRIC_BOTTOM_LEFT_BACK];for(i=0;i<s.length;i++)this.updateIncrementsOnEntity(s[i],"Face"),this.updateIncrementsOnEntity(s[i],"Edge");this.addAxes()}addAxes(){const e=this,t=function(t,i,s){const n=O*b,r=I.getNumber("VIEW_CUBE_AXIS_GAP"),a=[-n-r,-n-r,-n-r],c=m.vec3C.add(m.vec3C.scale(i,2*n,p.vec3.create()),a),l=(0,o.createLine)(a,c);(0,o.addSizeToIncrement)(I.getNumber("VIEW_CUBE_AXIS_WIDTH"),l),(0,o.addColorToIncrement)(s,l),e.updateMeshIncrement(t,o.NO_SELECTION_ID,l,v);const h=l.clone();(0,o.addStyleToIncrement)(I.getStipple("VIEW_CUBE_HIDDEN_AXIS_STIPPLE"),h);const d=s.slice(0);d[3]=I.getNumber("VIEW_CUBE_HIDDEN_AXIS_OPACITY"),(0,o.addColorToIncrement)(d,h),e.updateMeshIncrement(t+".st",o.NO_SELECTION_ID,h,D)};t("X",[1,0,0],I.getColor("X_AXIS_COLOR")),t("Y",[0,1,0],I.getColor("Y_AXIS_COLOR")),t("Z",[0,0,1],I.getColor("Z_AXIS_COLOR"))}updateIncrementsOnEntity(e,t){const i=this,s=this.getStaticIncrements();s[e+t].type===f?(0,o.addColorToIncrement)(i.highlightedId===s[e+t].selection?I.getColor("VIEW_CUBE_FACE_HIGHLIGHT"):s[e+t].color,s[e+t].data):s[e+t].type===P&&(0,o.addColorToIncrement)(s[e+t].color,s[e+t].data),this.updateMeshIncrement(e+t,s[e+t].selection,s[e+t].data.clone(),s[e+t].type)}updateTransform(e){this.updateCenter(e);const t=p.mat4.create();t[12]=this.center[0],t[13]=this.center[1],t[14]=this.center[2];const i=m.mat4C.lookAt([0,0,0,1],e.direction,e.up,p.mat4.create()),s=m.mat4C.multiply(t,i,p.mat4.create());this.setTransform(s),this.hasMeshIncrements()||this.updateGraphics()}isMouseInside(){return this.highlightedId!==o.NO_SELECTION_ID||this.manipulatorButtons.highlightedId!==o.NO_SELECTION_ID}onMouseClick(e,i,s){this.trigger(t.VIEW_MANIPULATOR_EVENT,e.selectionId),l.btInjector.AnalyticsService.trackEventForDocumentId("VIEW_CUBE_COMMAND","click_"+e.selectionId,(0,h.getModelId)()),T.TOP===e.selectionId?this.viewer.animateToStandardView("XY"):T.BOTTOM===e.selectionId?this.viewer.animateToStandardView("XYback"):T.FRONT===e.selectionId?this.viewer.animateToStandardView("XZ"):T.BACK===e.selectionId?this.viewer.animateToStandardView("XZback"):T.RIGHT===e.selectionId?this.viewer.animateToStandardView("YZ"):T.LEFT===e.selectionId?this.viewer.animateToStandardView("YZback"):S(e.selectionId)&&this.viewer.animateToStandardView(e.selectionId),s.requestSelectedStatus=!1}onMouseEnter(e,t){this.highlightedId=e.selectionId,this.updateGraphics(),this.viewer.requestDraw()}onMouseLeave(e,t){this.highlightedId===e.selectionId&&(this.highlightedId=o.NO_SELECTION_ID,this.updateGraphics()),this.viewer.requestDraw()}onDragStart(e,t,i){i.requestDrag=!0,this.setDragStart(t)}onDrag(e,t){this.updateDragPosition(t)}setDragStart(e){this.dragStart=[e.mouseX,e.mouseY]}updateDragPosition(e){this.topRightCorner[0]+=e.mouseX-this.dragStart[0],this.topRightCorner[1]+=-(e.mouseY-this.dragStart[1]);const t=Math.abs(e.mouseX-this.dragStart[0])+Math.abs(e.mouseY-this.dragStart[1]);return this.setDragStart(e),this.manipulatorButtons.updateGraphics(),this.updateDropdownPosition(),this.viewer.requestDraw(),t}updateDropdownPosition(){if(this.dropdownButton){const e=(0,g.getDevicePixelRatio)(),t=I.getNumber("VIEW_CUBE_SCREEN_SIZE_PX");this.dropdownButton.position(-this.topRightCorner[0]/e,(-this.topRightCorner[1]+t)/e-this.dropdownButton.$el.height()+5)}}onDragStop(e,t){delete this.dragStart,this.viewer.requestDraw()}isViewManipulator(){return!0}}t.ViewManipulator=k},21656:function(e,t,i){var s=i(185956);Object.defineProperty(t,"__esModule",{value:!0}),t.StateCachingGLContext=t.UniformAttribRepeatingGLContext=t.StateRepeatingGLContext=t.SkipProgramsGLContext=t.AssignIdGLContext=t.CallCountingGLContext=t.GLContext=void 0;const n=i(736234),r=i(912057);class a{constructor(e){this.gl=e;for(const t in this.gl)"gl"!==t&&("function"==typeof e[t]?t in this||(this[t]=function(e,t,i){return function(){return i.apply(e,arguments)}}(this.gl,0,this.gl[t])):function(e,t){e[t]=e.gl[t]}(this,t))}apply(){}printState(){r.log.debug("BLEND \t\t"+this.gl.isEnabled(this.gl.BLEND)),r.log.debug("CULL_FACE \t\t"+this.gl.isEnabled(this.gl.CULL_FACE)),r.log.debug("DEPTH_TEST \t\t"+this.gl.isEnabled(this.gl.DEPTH_TEST)),r.log.debug("DITHER \t\t"+this.gl.isEnabled(this.gl.DITHER)),r.log.debug("POLYGON_OFFSET_FILL \t\t"+this.gl.isEnabled(this.gl.POLYGON_OFFSET_FILL)),r.log.debug("SAMPLE_ALPHA_TO_COVERAGE \t\t"+this.gl.isEnabled(this.gl.SAMPLE_ALPHA_TO_COVERAGE)),r.log.debug("SAMPLE_COVERAGE \t\t"+this.gl.isEnabled(this.gl.SAMPLE_COVERAGE)),r.log.debug("SCISSOR_TEST \t\t"+this.gl.isEnabled(this.gl.SCISSOR_TEST)),r.log.debug("STENCIL_TEST \t\t"+this.gl.isEnabled(this.gl.STENCIL_TEST)),r.log.debug("\n")}}t.GLContext=a;t.CallCountingGLContext=class{constructor(e,t){this.callCounts={},t=void 0!==t&&t,this.gl=e;for(const i in this.gl)"gl"!==i&&"callCounts"!==i&&"printCallStats"!==i&&("function"==typeof e[i]?i in this||(this[i]=function(e,i,s){return function(){return t&&(i in this.callCounts?this.callCounts[i]++:this.callCounts[i]=1),r.log.debug(s.toString()),s.apply(e,arguments)}}(this.gl,i,this.gl[i])):function(e,t){e[t]=e.gl[t]}(this,i))}printCallStats(){let e=[];for(const t in this.callCounts)e.push([t,this.callCounts[t]]);e=e.sort((function(e,t){return t[1]-e[1]}));for(const t in e)r.log.debug(e[t][0]+" "+e[t][1])}};class o extends a{constructor(e){super(e),this.nextId=1,this.uniqueIds=new Map}assignNextId(e){e.tempId=this.nextId,this.uniqueIds.set(e,this.nextId),this.nextId++}createProgram(){const e=this.gl.createProgram();return this.assignNextId(e),e}}t.AssignIdGLContext=o;t.SkipProgramsGLContext=class extends a{constructor(e){super(new o(e)),this.currentProgram=null,this.programFlags=[],this.programNames={},this.programSources=[]}getProgramFlags(){return this.programFlags}setProgramFlags(e){this.programFlags=e}onlyProgram(e){for(let t=0;t<this.programFlags.length;t++)this.programFlags[t]=e===t}allButProgram(e){for(let t=0;t<this.programFlags.length;t++)this.programFlags[t]=e!==t}allPrograms(){for(let e=0;e<this.programFlags.length;e++)this.programFlags[e]=!0}noPrograms(){for(let e=0;e<this.programFlags.length;e++)this.programFlags[e]=!1}createProgram(e){const t=super.createProgram();return this.programNames[t.tempId]=e,t}useProgram(e){this.currentProgram=e,this.gl.useProgram(e),e.tempId in this.programFlags||(this.programFlags[e.tempId]=!0)}drawArrays(e,t,i){this.programFlags[this.currentProgram.tempId]&&this.gl.drawArrays(e,t,i)}drawElements(e,t,i,s){this.programFlags[this.currentProgram.tempId]&&this.gl.drawElements(e,t,i,s)}};t.StateRepeatingGLContext=class extends a{constructor(e,t,i){super(e),this.numChanges=t,this.numRepeats=i}enable(e){this.gl.enable(e);for(let t=0;t<this.numChanges;t++)this.gl.disable(e),this.gl.enable(e);for(let t=0;t<this.numRepeats;t++)this.gl.enable(e)}disable(e){this.gl.disable(e);for(let t=0;t<this.numChanges;t++)this.gl.enable(e),this.gl.disable(e);for(let t=0;t<this.numRepeats;t++)this.gl.disable(e)}enableVertexAttribArray(e){this.gl.enableVertexAttribArray(e);for(let t=0;t<this.numChanges;t++)this.gl.disableVertexAttribArray(e),this.gl.enableVertexAttribArray(e);for(let t=0;t<this.numRepeats;t++)this.gl.enableVertexAttribArray(e)}disableVertexAttribArray(e){this.gl.disableVertexAttribArray(e);for(let t=0;t<this.numChanges;t++)this.gl.enableVertexAttribArray(e),this.gl.disableVertexAttribArray(e);for(let t=0;t<this.numRepeats;t++)this.gl.disableVertexAttribArray(e)}useProgram(e){this.gl.useProgram(e);for(let t=0;t<this.numChanges;t++)this.gl.useProgram(null),this.gl.useProgram(e);for(let t=0;t<this.numRepeats;t++)this.gl.useProgram(e)}activeTexture(e){this.gl.activeTexture(e);for(let t=0;t<this.numChanges;t++)this.gl.activeTexture(this.gl.TEXTURE25),this.gl.activeTexture(e);for(let t=0;t<this.numRepeats;t++)this.gl.activeTexture(e)}bindTexture(e,t){this.gl.bindTexture(e,t);for(let i=0;i<this.numChanges;i++)this.gl.bindTexture(e,null),this.gl.bindTexture(e,t);for(let i=0;i<this.numRepeats;i++)this.gl.bindTexture(e,t)}};t.UniformAttribRepeatingGLContext=class extends a{constructor(e,t,i){super(e),this.numChanges=t,this.numRepeats=i;const n=function(e){return function(){e.apply(this.gl,arguments);for(let t=0;t<this.numRepeats;t++)e.apply(this.gl,arguments)}},r=this;for(let e=1;e<=4;e++)s.each(["f","i","fv","iv"],(function(t,i){let s="uniform"+e+i;r[s]=n(r.gl[s]),e>1&&(s="uniformMatrix"+e+i,r[s]=n(r.gl[s]))}));for(let e=1;e<=4;e++)s.each(["f","fv"],(function(t,i){const s="vertexAttrib"+e+i;r[s]=n(r.gl[s])}))}};t.StateCachingGLContext=class extends a{constructor(e){super(e),this.programUniforms=[],this.attributes=[],this.state=new Map,this.attribarraystate=new Map,this.currentProgram=e.getParameter(e.CURRENT_PROGRAM),this.currentProgramSent=e.getParameter(e.CURRENT_PROGRAM),this.activeTextureUnit=e.getParameter(e.ACTIVE_TEXTURE),this.activeTextureUnitSent=e.getParameter(e.ACTIVE_TEXTURE),this.textureUnits=new Map}getUniformLocation(e,t){const i=this.gl.getUniformLocation(e,t),s=this.programUniforms[e.tempId].length;return i&&(i.tempId=s,this.programUniforms[e.tempId][i.tempId]=null),i}apply(){this.applyProgram(),this.applyAttributes()}applyProgram(){this.currentProgramSent!==this.currentProgram&&(this.gl.useProgram(this.currentProgram),this.currentProgramSent=this.currentProgram);const e=this.programUniforms[this.currentProgram.tempId];if(e)for(let t=0;t<e.length;t++){const i=e[t];if(i){if(i[2])continue;const e=i[0],t=i[1];e.apply(this.gl,t),i[2]=!0}}}applyAttributes(){for(let e=0;e<this.attributes.length;e++){const t=this.attributes[e];if(t){if(t[2])continue;const e=t[0],i=t[1];e.apply(this.gl,i),t[2]=!0}}}createProgram(){const e=this.gl.createProgram();return this.programUniforms[e.tempId]=[],e}useProgram(e){this.currentProgram=e}deleteProgram(e){return this.gl.deleteProgram(e)}getCurrentProgramUniforms(){let e=this.programUniforms[this.currentProgram.tempId];return e||(e=[],this.programUniforms[this.currentProgram.tempId]=e),e}uniform1f(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,n=i[s];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform1f,n[2]=n[2]&&n[1][1]===t,n[1][1]=t):i[s]=[this.gl.uniform1f,[e,t],!1]}uniform1i(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,n=i[s];n&&n[1].length===arguments.length?(n[0]=this.gl.uniform1i,n[2]=n[2]&&n[1][1]===t,n[1][1]=t):i[s]=[this.gl.uniform1i,[e,t],!1]}uniform2f(e,t,i){const s=this.getCurrentProgramUniforms(),n=e.tempId,r=s[n];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform2f,r[2]=r[2]&&r[1][1]===t&&r[1][2]===i,r[1][1]=t,r[1][2]=i):s[n]=[this.gl.uniform2f,[e,t,i],!1]}uniform2i(e,t,i){const s=this.getCurrentProgramUniforms(),n=e.tempId,r=s[n];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform2i,r[2]=r[2]&&r[1][1]===t&&r[1][2]===i,r[1][1]=t,r[1][2]=i):s[n]=[this.gl.uniform2i,[e,t,i],!1]}uniform3f(e,t,i,s){const n=this.getCurrentProgramUniforms(),r=e.tempId,a=n[r];a&&a[1].length===arguments.length?(a[0]=this.gl.uniform3f,a[2]=a[2]&&a[1][1]===t&&a[1][2]===i&&a[1][3]===s,a[1][1]=t,a[1][2]=i,a[1][3]=s):n[r]=[this.gl.uniform3f,[e,t,i,s],!1]}uniform3i(e,t,i,s){const n=this.getCurrentProgramUniforms(),r=e.tempId,a=n[r];a&&a[1].length===arguments.length?(a[0]=this.gl.uniform3i,a[2]=a[2]&&a[1][1]===t&&a[1][2]===i&&a[1][3]===s,a[1][1]=t,a[1][2]=i,a[1][3]=s):n[r]=[this.gl.uniform3i,[e,t,i,s],!1]}uniform4f(e,t,i,s,n){const r=this.getCurrentProgramUniforms(),a=e.tempId,o=r[a];o&&o[1].length===arguments.length?(o[0]=this.gl.uniform4f,o[2]=o[2]&&o[1][1]===t&&o[1][2]===i&&o[1][3]===s&&(o[1][4]=n),o[1][1]=t,o[1][2]=i,o[1][3]=s,o[1][4]=n):r[a]=[this.gl.uniform4f,[e,t,i,s,n],!1]}uniform4i(e,t,i,s,n){const r=this.getCurrentProgramUniforms(),a=e.tempId,o=r[a];o&&o[1].length===arguments.length?(o[0]=this.gl.uniform4i,o[2]=o[2]&&o[1][1]===t&&o[1][2]===i&&o[1][3]===s&&(o[1][4]=n),o[1][1]=t,o[1][2]=i,o[1][3]=s,o[1][4]=n):r[a]=[this.gl.uniform4i,[e,t,i,s,n],!1]}uniform1fv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform1fv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform1fv,[e,t],!1]}uniform1iv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform1iv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform1iv,[e,t],!1]}uniform2fv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform2fv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform2fv,[e,t],!1]}uniform2iv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform2iv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform2iv,[e,t],!1]}uniform3fv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform3fv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform3fv,[e,t],!1]}uniform3iv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform3iv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform3iv,[e,t],!1]}uniform4fv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform4fv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform4fv,[e,t],!1]}uniform4iv(e,t){const i=this.getCurrentProgramUniforms(),s=e.tempId,r=i[s];r&&r[1].length===arguments.length?(r[0]=this.gl.uniform4iv,r[2]=r[2]&&(0,n.isEqual)(r[1][1],t),r[1][1]=t):i[s]=[this.gl.uniform4iv,[e,t],!1]}uniformMatrix2fv(e,t,i){const s=this.getCurrentProgramUniforms(),r=e.tempId,a=s[r];a&&a[1].length===arguments.length?(a[0]=this.gl.uniformMatrix2fv,a[2]=a[2]&&a[1][1]===t&&(0,n.isEqual)(a[1][2],i),a[1][1]=t,a[1][2]=i):s[r]=[this.gl.uniformMatrix2fv,[e,t,i],!1]}uniformMatrix3fv(e,t,i){const s=this.getCurrentProgramUniforms(),r=e.tempId,a=s[r];a&&a[1].length===arguments.length?(a[0]=this.gl.uniformMatrix3fv,a[2]=a[2]&&a[1][1]===t&&(0,n.isEqual)(a[1][2],i),a[1][1]=t,a[1][2]=i):s[r]=[this.gl.uniformMatrix3fv,[e,t,i],!1]}uniformMatrix4fv(e,t,i){const s=this.getCurrentProgramUniforms(),r=e.tempId,a=s[r];a&&a[1].length===arguments.length?(a[0]=this.gl.uniformMatrix4fv,a[2]=a[2]&&a[1][1]===t&&(0,n.isEqual)(a[1][2],i),a[1][1]=t,a[1][2]=i):s[r]=[this.gl.uniformMatrix4fv,[e,t,i],!1]}vertexAttrib1f(e,t){const i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib1f,i[2]=i[2]&&i[1][1]===t,i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib1f,[e,t],!1]}vertexAttrib2f(e,t,i){const s=this.attributes[e];s&&s[1].length===arguments.length?(s[0]=this.gl.vertexAttrib2f,s[2]=s[2]&&s[1][1]===t&&s[1][2]===i,s[1][1]=t,s[1][2]=i):this.attributes[e]=[this.gl.vertexAttrib2f,[e,t,i],!1]}vertexAttrib3f(e,t,i,s){const n=this.attributes[e];n&&n[1].length===arguments.length?(n[0]=this.gl.vertexAttrib3f,n[2]=n[2]&&n[1][1]===t&&n[1][2]===i&&n[1][3]===s,n[1][1]=t,n[1][2]=i,n[1][3]=s):this.attributes[e]=[this.gl.vertexAttrib3f,[e,t,i,s],!1]}vertexAttrib4f(e,t,i,s,n){const r=this.attributes[e];r&&r[1].length===arguments.length?(r[0]=this.gl.vertexAttrib4f,r[2]=r[2]&&r[1][1]===t&&r[1][2]===i&&r[1][3]===s&&r[1][4]===n,r[1][1]=t,r[1][2]=i,r[1][3]=s,r[1][4]=n):this.attributes[e]=[this.gl.vertexAttrib4f,[e,t,i,s,n],!1]}vertexAttrib1fv(e,t){const i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib1fv,i[2]=i[2]&&(0,n.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib1fv,[e,t],!1]}vertexAttrib2fv(e,t){const i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib2fv,i[2]=i[2]&&(0,n.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib2fv,[e,t],!1]}vertexAttrib3fv(e,t){const i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib3fv,i[2]=i[2]&&(0,n.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib3fv,[e,t],!1]}vertexAttrib4fv(e,t){const i=this.attributes[e];i&&i[1].length===arguments.length?(i[0]=this.gl.vertexAttrib4fv,i[2]=i[2]&&(0,n.isEqual)(i[1][1],t),i[1][1]=t):this.attributes[e]=[this.gl.vertexAttrib4fv,[e,t],!1]}drawArrays(e,t,i){this.apply(),this.gl.drawArrays(e,t,i)}drawElements(e,t,i,s){this.apply(),this.gl.drawElements(e,t,i,s)}}},131621:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrCommentController=void 0;const s=i(7401),n=i(905898),r=i(264292),a=i(912057),o=i(683067),c=i(114924),l=window.SpeechRecognition||window.webkitSpeechRecognition;t.XrCommentController=class{constructor(e,t){this.viewer=e,this.commentStarted=!1,this.commentImage=null,this.recognition=null,this.recognitionResult="",this.lastPreviewedText="",this.textPreview=null,t.addGamepadButtonHandler(this),l?(this.recognition=new l,this.recognition.continuous=!0,this.recognition.lang="en-US",this.recognition.interimResults=!0,this.recognition.onstart=()=>{a.log.trace("Speech recognition started")},this.recognition.onerror=e=>{a.log.info("Speech recognition error: "+e.error),this.abortComment()},this.recognition.onresult=e=>this.processRecognitionResult(e),this.recognition.onend=()=>{this.finishComment()}):a.log.debug("Speech recognition not available")}checkMicrophonePermission(){return new Promise(((e,t)=>{const i="os-microphone-permission-check-completed";if(localStorage.getItem(i))e();else{const s=new l;function n(){s.abort(),localStorage.setItem(i,"true"),e()}s.continuous=!0,s.lang="en-US",s.interimResults=!0,s.onstart=n,s.onerror=n,s.start()}}))}onGamepadButtonDown(e){return!(!this.commentStarted||!this.isAbortCommentButton(e))||!!this.recognition&&this.isDoCommentButton(e)}onGamepadButtonDrag(e){}onGamepadButtonUp(e){this.isDoCommentButton(e)?this.commentStarted?this.stopRecognition():this.startComment():this.isAbortCommentButton(e)&&this.abortComment()}isDoCommentButton(e){return e.buttonNumber===o.XrButton.A&&e.handType===o.XRHandType.NON_DOMINANT}isAbortCommentButton(e){return e.buttonNumber===o.XrButton.B&&e.handType===o.XRHandType.NON_DOMINANT}startComment(){this.commentStarted||(this.commentStarted=!0,this.recognitionResult="",this.lastPreviewedText="",this.viewer.getXrController().getIsXrRunning()?(this.viewer.getXrController().captureViewportImage().then((e=>{this.commentImage=e})).finally((()=>{this.startRecognition()})),this.updateTextPositionFromCamera(this.viewer.getXrController().getCamera())):(this.commentImage=this.viewer.retrieveViewportAsImage({width:this.viewer.getCamera().getCanvasWidth(),height:this.viewer.getCamera().getCanvasHeight(),useFlattenedView:!1,usePrint:!1,zoomToFit:!1,zoomToSelection:!1,showViewCube:!0}),this.updateTextPositionFromCamera(this.viewer.getCamera()),this.startRecognition()))}startRecognition(){this.updateTextDisplay("Listening for comment…"),this.recognition.start()}processRecognitionResult(e){if(void 0===e.results)return a.log.debug("Speech recognition gave no result"),void this.abortComment();let t="";for(let i=e.resultIndex;i<e.results.length;++i)e.results[i].isFinal?this.recognitionResult+=e.results[i][0].transcript:t+=e.results[i][0].transcript;this.updateTextDisplay(this.recognitionResult+t)}stopRecognition(){this.recognition.stop()}finishComment(){if(!this.commentStarted)return;if(this.commentStarted=!1,!this.commentImage)return void a.log.warn("No image for xr comment");const e=this.recognitionResult;e?(0,c.imageCaptureToJpeg)(this.commentImage).then((t=>{const i={isNew:!0,elementId:this.viewer.getActiveElementId(),attachment:new File([t],"XR view.jpg")};(0,n.getCommandDispatcher)().trigger(s.commands.PUBLISH_NEW_COMMENT,e,i)})):a.log.trace("Cannot post comment without message"),this.clearTextDisplay(),this.recognitionResult="",this.commentImage=null}abortComment(){this.clearTextDisplay(),this.commentStarted=!1,this.commentImage=null,this.recognition.abort()}updateTextPositionFromCamera(e){this.textPreviewRight=r.vec3.copy(r.vec3.create(),e.getRight()),this.textPreviewUp=r.vec3.copy(r.vec3.create(),e.getUp());this.textPreviewOrigin=r.vec3.add(r.vec3.create(),e.getEye(),r.vec3.scale(r.vec3.create(),e.getForward(),1.5))}clearTextDisplay(){this.textPreview&&(this.textPreview.remove(),this.textPreview=null)}updateTextDisplay(e){if(this.lastPreviewedText===e)return;this.clearTextDisplay(),this.lastPreviewedText=e;let t="New comment:\n\n";const i=e.split(" ");let s=0;for(let e=0;e<i.length;++e)s>0&&(t+=" ",s+=1),t+=i[e],s+=i[e].length,s>=50&&(t+="\n",s=0);t+="\n\nLeft A: confirm     Left B: cancel",this.textPreview=new c.Text({origin:this.textPreviewOrigin,right:this.textPreviewRight,up:this.textPreviewUp,heightPx:20},this.viewer),this.textPreview.setText(t),this.textPreview.updateOnEachFrame=!1}}},406304:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrController=void 0;const s=i(545348),n=i(264292),r=i(997687),a=i(185956),o=i(912057),c=i(268154),l=i(683067),h=i(905311),d=i(114924);t.XrController=class{constructor(e){this.viewer=e,this.supportedSessionTypes=new Set,this.activeSessionType=null,this.startingSession=!1,this.animationFrameCallback=null,this.overrideCamera=new d.XrCamera,this.modelViewInitialized=!1,this.modelTransform_=n.mat4.create(),this.modelTransformInverse_=n.mat4.create(),this.orderIndependentTransparencyEnabledOutsideXr=!0,this.xrInputDispatcher=new d.XrInputDispatcher(this.viewer,this),this.xrSelectionHandler=new d.XrSelectionHandler(this.viewer),this.xrInputDispatcher.addSelectHandler(this.xrSelectionHandler),this.xrInputDispatcher.addGamepadButtonHandler(this),this.xrViewController=new d.XrViewController(e,this.xrInputDispatcher),this.xrMarkupController=new d.XrMarkupController(e,this.xrInputDispatcher),this.xrCommentController=new d.XrCommentController(e,this.xrInputDispatcher),this.animationFrameCallback=(e,t)=>this.onAnimationFrame(e,t),r.btInjector.CapabilitiesService.isWebxrEnabled().then((t=>{if(!t)return;const i=(0,d.getXrSystem)();i&&(i.isSessionSupported("immersive-vr").then((e=>{e&&this.supportedSessionTypes.add(h.XrSessionType.VR)})),i.isSessionSupported("immersive-ar").then((e=>{e&&this.supportedSessionTypes.add(h.XrSessionType.AR)}))),this.xrBaseFrameBuffer=new d.FrameBuffer(e)}))}getSupportedSessionTypes(){return this.supportedSessionTypes}getActiveSessionType(){return this.activeSessionType}get xrReferenceSpace(){return this.xrReferenceSpace_}set modelTransform(e){this.modelTransform_=e,n.mat4.invert(this.modelTransformInverse_,e),this.xrInputDisplay&&this.xrInputDisplay.onModelTransformChange(this.modelTransformInverse_)}get modelTransform(){return this.modelTransform_}get modelTransformInverse(){return this.modelTransformInverse_}startXr(e){if(this.startingSession)return void o.log.info("Attempt to start xr while session start was already pending");if(this.xrSession)throw new Error("XR session already in progress");if(!e)throw new Error("Invalid XrSessionType "+e);if(!this.supportedSessionTypes.has(e))throw new Error("Attempt to start unsuppported XrSessionType "+e);const t=this.viewer.getGlContext();(null==t?void 0:t.makeXRCompatible)?(this.modelViewInitialized=!1,this.startingSession=!0,this.xrCommentController.checkMicrophonePermission().finally((()=>{t.makeXRCompatible().then((()=>this.startXrSession(e))).catch((e=>{o.log.warn("Error making context xr compatible: "+e)})).finally((()=>{this.startingSession=!1}))}))):o.log.warn("Could not make XR compatible context")}startXrSession(e){const t=(0,d.getXrSystem)();t?t.requestSession(e).then((t=>(this.activeSessionType=e,this.xrSession=t,this.xrInputDispatcher.setXrSession(this.xrSession),(0,c.isPlatformMetaQuest)()&&this.reduceDetailForSession(),this.xrSession.updateRenderState({baseLayer:new XRWebGLLayer(this.xrSession,this.viewer.getGlContext())})))).then((()=>{this.startXrRendering()})).catch((e=>{o.log.warn("Failed to create xr session: "+e)})):o.log.warn("Could not get xr system")}stopXr(){this.xrSession&&((0,c.isPlatformMetaQuest)()&&this.restoreNonXrDetail(),this.xrInputDispatcher.resetXrSession(),this.xrSession.end().catch((e=>{o.log.debug("XR session end failed: "+e)})).finally((()=>{this.viewer.viewManipulator.show(),this.viewer.forceRequestDraw()})),this.modelTransform=n.mat4.identity(n.mat4.create()),this.removeInputDisplay(),this.xrMarkupController.clearMarkup(),a(".exit-xr-button").remove(),this.xrSession=null,this.activeSessionType=null,this.viewer.getAnimationController().requestAnimationFrameIfNeeded())}getIsXrRunning(){return!!this.xrSession}getXrInputDispatcher(){return this.xrInputDispatcher}startXrRendering(){this.xrSession.requestReferenceSpace("local").then((e=>{this.xrReferenceSpace_=e,this.lastXrFrameTimeMs=(0,d.getTimeInMilliseconds)(),this.xrSession.requestAnimationFrame(this.animationFrameCallback);const t=this.activeSessionType===h.XrSessionType.AR?i18n("Exit AR"):i18n("Exit VR");a(`<button class="btn btn-default exit-xr-button" type="button">${t}</button>`).appendTo(".canvas-container").click((()=>{this.stopXr()}))})).catch((e=>{o.log.warn("Failed to get xr reference space: "+e)}))}onAnimationFrame(e,t){var i,s;if(!this.xrSession)return;this.updateInput(t),this.viewer.setInRequestDrawCallback(!0);const r=t.getViewerPose(this.xrReferenceSpace_);if(!r)return o.log.debug("No pose found for device"),void this.xrSession.requestAnimationFrame(this.animationFrameCallback);const a=null===(s=null===(i=this.xrSession)||void 0===i?void 0:i.renderState)||void 0===s?void 0:s.baseLayer;if(!a)return;this.viewer.setSystemIsAnimating(),this.viewer.getAnimationController().advanceAnimation(e);const c=this.viewer.getGlContext();if(!c)return;c.bindFramebuffer(c.FRAMEBUFFER,a.framebuffer),this.xrBaseFrameBuffer.setExternalFrameBuffer(this.getFrameBufferWidth(),this.getFrameBufferHeight(),a.framebuffer),this.viewer.setBaseFrameBuffer(this.xrBaseFrameBuffer),this.activeSessionType===h.XrSessionType.VR&&(c.clearColor(1,1,1,1),c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT));for(let e=0;e<r.views.length;++e){const t=r.views[e];this.overrideCamera.setTransforms(this.modelTransform_,t.transform.inverse.matrix,t.projectionMatrix),this.lastXrViewMatrixInverse=n.mat4.copy(n.mat4.create(),t.transform.inverse.matrix),this.initializeModelView();const i=a.getViewport(t);this.overrideCamera.setViewport([i.x,i.y,i.width,i.height]);const s=null;this.viewer.draw(s,{camera:this.overrideCamera,performFrameTiming:0===e}),this.imageCaptureSuccessCallback&&"right"===t.eye&&this.performImageCapture(i)}const u=(0,d.getTimeInMilliseconds)();u-this.lastXrFrameTimeMs>=5e3&&(o.log.debug("XR frame rate: "+this.viewer.getFrameTimer().getAverageFrameRate(l.FrameType.INTERACTIVE)+" fps"),this.lastXrFrameTimeMs=u),c.bindFramebuffer(c.FRAMEBUFFER,null),this.viewer.setBaseFrameBufferToDefault(),this.viewer.setInRequestDrawCallback(!1),this.xrSession.requestAnimationFrame(this.animationFrameCallback)}getCamera(){return this.overrideCamera}captureViewportImage(){return new Promise(((e,t)=>{this.imageCaptureSuccessCallback=e,this.imageCaptureErrorCallback=t}))}performImageCapture(e){const t=this.viewer.getGlContext();if(!this.imageCaptureSuccessCallback||!t)return;const i=s.default.getManager().getNumber("XR_COMMENT_VIEW_CAPTURE_PROPORTION"),n=Math.floor(e.width*i),r=Math.floor(e.height*i),a=e.x+Math.floor(n/2),o=e.y+Math.floor(r/2),c=new Uint8Array(n*r*4);t.readPixels(a,o,n,r,t.RGBA,t.UNSIGNED_BYTE,c),(0,d.flipImageVertically)(c,n,r),this.imageCaptureSuccessCallback({width:n,height:r,data:c}),this.imageCaptureSuccessCallback=null,this.imageCaptureErrorCallback=null}getFrameBufferWidth(){var e;return(null===(e=this.xrSession)||void 0===e?void 0:e.renderState)&&this.xrSession.renderState.baseLayer?this.xrSession.renderState.baseLayer.framebufferWidth:null}getFrameBufferHeight(){var e;return(null===(e=this.xrSession)||void 0===e?void 0:e.renderState)&&this.xrSession.renderState.baseLayer?this.xrSession.renderState.baseLayer.framebufferHeight:null}initializeModelView(){this.modelViewInitialized||(this.viewer.viewManipulator.hide(),this.xrViewController.initializeModelView(this.overrideCamera),this.modelViewInitialized=!0)}updateInput(e){var t;const i=null===(t=this.xrSession)||void 0===t?void 0:t.inputSources;if(!i)return;this.xrInputDispatcher.onFrameStart(e);let s=null;for(let e=0;e<i.length;++e)if(i[e].handedness===this.xrInputDispatcher.primaryControllerHandedness){s=i[e];break}if(!s||!this.xrSession)return void this.removeInputDisplay();const n=e.getPose(s.targetRaySpace,this.xrReferenceSpace_);n&&n.transform&&(this.xrInputDisplay||(this.xrInputDisplay=new d.XrInputDisplay(this.viewer,this.modelTransformInverse)),this.xrInputDisplay.update(n.transform.matrix,n.transform.inverse.matrix))}removeInputDisplay(){this.xrInputDisplay&&(this.xrInputDisplay.remove(),this.xrInputDisplay=null)}getDominantXrInputDisplay(){return this.xrInputDisplay}onGamepadButtonDown(e){return this.isStopXrButton(e)}onGamepadButtonDrag(e){}onGamepadButtonUp(e){this.isStopXrButton(e)&&this.stopXr()}isStopXrButton(e){return e.buttonNumber===l.XrButton.B&&e.handType===l.XRHandType.DOMINANT}reduceDetailForSession(){this.orderIndependentTransparencyEnabledOutsideXr=(0,d.isOrderIndependentTransparencyEnabled)(),(0,d.setOrderIndependentTransparencyEnabled)(!1)}restoreNonXrDetail(){(0,d.setOrderIndependentTransparencyEnabled)(this.orderIndependentTransparencyEnabledOutsideXr)}}},212751:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrInputDispatcher=t.XrGamepadButtonPressEvent=t.XrInputEvent=t.XrEventEnum=void 0;const s=i(264292),n=i(912057),r=i(683067),a=i(613199),o=i(3693),c=i(726759);var l;!function(e){e.select="select",e.selectstart="selectstart",e.selectend="selectend",e.squeeze="squeeze",e.squeezestart="squeezestart",e.squeezeend="squeezeend"}(l||(t.XrEventEnum=l={}));class h{constructor(e,t,i,s){this.worldSpacePose=e,this.worldSpaceRay=t,this.modelSpacePose=i,this.modelSpaceRay=s}}t.XrInputEvent=h;class d{constructor(e,t,i){this.handType=e,this.buttonNumber=t,this.xrInputEvent=i}}t.XrGamepadButtonPressEvent=d;class u{constructor(e,t,i){this.handType=e,this.gamepad=t,this.xrInputEvent=i}}class g{}t.XrInputDispatcher=class{constructor(e,t){this.viewer=e,this.xrController=t,this.eventToCallback=new Map,this.selectHandlers=[],this.activeSelectHandler=null,this.activeSelectSource=null,this.squeezeHandlers=[],this.activeSqueezeHandler=null,this.activeSqueezeSource=null,this.gamepadButtonStates=[],this.gamepadButtonHandlers=[],this.activeGamepadButtonHandlers=new Map,this.gamepadAxesHandlers=[],this.activeGamepadAxesHandler=[null,null],this.primaryControllerHandedness_=null,this.resetGamepadState()}resetGamepadState(){this.gamepadButtonStates=[],this.activeGamepadButtonHandlers=new Map;for(let e=r.XRHandType.DOMINANT;e<=r.XRHandType.NON_DOMINANT;++e){const t=[],i=new Map;for(let e=0;e<10;++e)t.push(new g),i.set(e,null);this.gamepadButtonStates.push(t),this.activeGamepadButtonHandlers.set(e,i)}}destroy(){this.removeXrSessionListeners()}get primaryControllerHandedness(){return this.primaryControllerHandedness_}setXrSession(e){this.xrSession!==e?(this.xrSession&&this.resetXrSession(),this.xrSession=e,this.bindListener(l.select,this.onSelect),this.bindListener(l.selectstart,this.onSelectStart),this.bindListener(l.selectend,this.onSelectEnd),this.bindListener(l.squeeze,this.onSqueeze),this.bindListener(l.squeezestart,this.onSqueezeStart),this.bindListener(l.squeezeend,this.onSqueezeEnd)):n.log.debug("Called setXrSession twice for same session")}resetXrSession(){this.removeXrSessionListeners(),this.xrSession=null}removeXrSessionListeners(){for(const[e,t]of this.eventToCallback)this.xrSession.removeEventListener(e,t);this.eventToCallback.clear()}addHandler(e,t){t.indexOf(e)<0&&t.unshift(e)}removeHandler(e,t){const i=t.indexOf(e);i>=0&&t.splice(i,1)}addSelectHandler(e){this.addHandler(e,this.selectHandlers)}removeSelectHandler(e){this.removeHandler(e,this.selectHandlers),this.activeSelectHandler===e&&(this.activeSelectHandler=null)}addSqueezeHandler(e){this.addHandler(e,this.squeezeHandlers)}removeSqueezeHandler(e){this.removeHandler(e,this.squeezeHandlers),this.activeSqueezeHandler===e&&(this.activeSqueezeHandler=null)}addGamepadButtonHandler(e){this.addHandler(e,this.gamepadButtonHandlers)}removeGamepadButtonHandler(e){this.removeHandler(e,this.gamepadButtonHandlers);for(const[t,i]of this.activeGamepadButtonHandlers)for(const[t,s]of i)s===e&&i.set(t,null)}addGamepadAxesHandler(e){this.addHandler(e,this.gamepadAxesHandlers)}removeGamepadAxesHandler(e){this.removeHandler(e,this.gamepadAxesHandlers);for(let t=0;t<this.activeGamepadAxesHandler.length;++t)this.activeGamepadAxesHandler[t]===e&&(this.activeGamepadAxesHandler[t]=null)}onFrameStart(e){const t=new Map;if(this.activeSelectSource&&this.activeSelectHandler){const i=this.getOsEventFromFrameAndSource(e,this.activeSelectSource,t);i&&this.activeSelectHandler.onXrSelectDrag(i)}if(this.activeSqueezeSource&&this.activeSqueezeHandler){const i=this.getOsEventFromFrameAndSource(e,this.activeSqueezeSource,t);i&&this.activeSqueezeHandler.onXrSqueezeDrag(i)}let i,s;this.primaryControllerHandedness_||this.initializeHandedness();for(let e=0;e<this.xrSession.inputSources.length;++e)this.xrSession.inputSources[e].gamepad&&(this.xrSession.inputSources[e].handedness===this.primaryControllerHandedness?i||(i=this.xrSession.inputSources[e]):s||(s=this.xrSession.inputSources[e]));i&&this.updateGamepadState(r.XRHandType.DOMINANT,i,e,t),s&&this.updateGamepadState(r.XRHandType.NON_DOMINANT,s,e,t)}updateGamepadState(e,t,i,s){const r=t.gamepad;if(t.gamepad){for(let a=0;a<r.buttons.length;++a){if(a>=10){n.log.debug("Trying to track a button beyond what we support: "+a);continue}const o=r.buttons[a],l=this.gamepadButtonStates[e][a],h=this.activeGamepadButtonHandlers.get(e).get(a);if(o.pressed&&!l.timePressed){l.timePressed=(0,c.getTimeInMilliseconds)();const n=new d(e,a,this.getOsEventFromFrameAndSource(i,t,s));for(const t of this.gamepadButtonHandlers)if(t.onGamepadButtonDown(n)){this.activeGamepadButtonHandlers.get(e).set(a,t);break}}else if(!o.pressed&&l.timePressed){if(l.timePressed=null,h){const n=new d(e,a,this.getOsEventFromFrameAndSource(i,t,s));h.onGamepadButtonUp(n),this.activeGamepadButtonHandlers.get(e).set(a,null)}}else if(o.pressed&&h){const n=new d(e,a,this.getOsEventFromFrameAndSource(i,t,s));h.onGamepadButtonDrag(n)}}if(this.activeGamepadAxesHandler[e]){const n=new u(e,r,this.getOsEventFromFrameAndSource(i,t,s));this.activeGamepadAxesHandler[e].onGamepadAxesUpdate(n)||(this.activeGamepadAxesHandler[e]=null)}else if(this.gamepadButtonHandlers.length>0){const n=new u(e,r,this.getOsEventFromFrameAndSource(i,t,s));for(const t of this.gamepadAxesHandlers)t.onGamepadAxesUpdate(n)&&(this.activeGamepadAxesHandler[e]=t)}}else n.log.warn("Should only update with gamepad input sources")}initializeHandedness(){let e,t;for(let i=0;i<this.xrSession.inputSources.length;++i)this.xrSession.inputSources[i].gamepad&&("right"===this.xrSession.inputSources[i].handedness?e=!0:"left"===this.xrSession.inputSources[i].handedness&&(t=!0));e?this.primaryControllerHandedness_="right":t&&(this.primaryControllerHandedness_="left")}bindListener(e,t){const i=e=>{t.bind(this)(this.getOsEventFromSourceEvent(e),e)};this.xrSession.addEventListener(e,i),this.eventToCallback.set(e,i)}getOsEventFromSourceEvent(e){return this.getOsEventFromFrameAndSource(e.frame,e.inputSource)}getOsEventFromFrameAndSource(e,t,i){const n=null==i?void 0:i.get(t);if(n)return n;const r=e.getPose(t.targetRaySpace,this.xrController.xrReferenceSpace);if(!(null==r?void 0:r.transform))return null;const c=this.xrController.modelTransformInverse,l=a.mat4C.multiplyVec3(r.transform.matrix,[0,0,0]),d=a.mat4C.multiplyVec3(c,l,s.vec3.create()),u=a.mat4C.multiplyVec4(r.transform.matrix,[0,0,-1,0]),g=a.mat4C.multiplyVec4(c,u,s.vec4.create()),p=new o.Ray(l,u),m=new o.Ray(d,g),E=s.mat4.multiply(s.mat4.create(),c,r.transform.matrix),I=new h(r.transform.matrix,p,E,m);return i&&i.set(t,I),I}onSelectStart(e,t){for(let t=0;t<this.selectHandlers.length;++t)if(this.selectHandlers[t].onXrSelectStart(e)){this.activeSelectHandler=this.selectHandlers[t];break}this.activeSelectSource=t.inputSource}onSelect(e,t){if(t.inputSource.handedness!==this.primaryControllerHandedness_){this.primaryControllerHandedness_=t.inputSource.handedness;const e=this.gamepadButtonStates[r.XRHandType.DOMINANT];return this.gamepadButtonStates[r.XRHandType.DOMINANT]=this.gamepadButtonStates[r.XRHandType.NON_DOMINANT],void(this.gamepadButtonStates[r.XRHandType.NON_DOMINANT]=e)}this.activeSelectHandler&&this.activeSelectHandler.onXrSelect(e)}onSelectEnd(e,t){this.activeSelectHandler&&(this.activeSelectHandler.onXrSelectEnd(e),this.activeSelectHandler=null),this.activeSelectSource=null}onSqueezeStart(e,t){for(let t=0;t<this.squeezeHandlers.length;++t)if(this.squeezeHandlers[t].onXrSqueezeStart(e)){this.activeSqueezeHandler=this.squeezeHandlers[t];break}this.activeSqueezeSource=t.inputSource}onSqueeze(e,t){this.activeSqueezeHandler&&this.activeSqueezeHandler.onXrSqueeze(e)}onSqueezeEnd(e,t){this.activeSqueezeHandler&&(this.activeSqueezeHandler.onXrSqueezeEnd(e),this.activeSqueezeHandler=null),this.activeSqueezeSource=null}}},714235:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrInputDisplay=t.XR_POINTER_TIP_Z_OFFSET=void 0;const s=i(315931),n=i(264292),r=i(98357),a=i(837454),o=i(768125);t.XR_POINTER_TIP_Z_OFFSET=.102;const c=[[-.032,0,0],[.032,0,0],[-.032,0,0],[0,-.038,0],[.032,0,0],[0,-.038,0],[0,0,-t.XR_POINTER_TIP_Z_OFFSET],[-.032,0,0],[0,0,-t.XR_POINTER_TIP_Z_OFFSET],[.032,0,0],[0,0,-t.XR_POINTER_TIP_Z_OFFSET],[0,-.038,0]],l=new a.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!1,isDepthTested:!0,priority:a.RenderOrderPriority.DEFAULT,primitiveType:s.PrimitiveType.LINES}),h=l.cloneAndModify({addsToBounds:!1});class d extends o.UIElement{constructor(e,t){super(e),this.modelTransformInverse=t,this.color=[1,0,0,1],this.pose=n.mat4.create(),this.combinedTransform=n.mat4.create(),this.hidePointerRay_=!1;const i=(0,r.createLines)(c,null,this.color);this.updateMeshIncrement("LINES",o.NO_SELECTION_ID,i,l)}update(e,i){if(!this.hidePointerRay_){const e=(0,r.createLines)([[0,0,-t.XR_POINTER_TIP_Z_OFFSET],[0,0,-10]],null,this.color);this.updateMeshIncrement("RAY",o.NO_SELECTION_ID,e,h)}n.mat4.copy(this.pose,e),this.updateTransform()}onModelTransformChange(e){this.modelTransformInverse=e,this.updateTransform()}hidePointerRay(){this.removeMeshIncrement("RAY"),this.hidePointerRay_=!0}showPointerRay(){this.hidePointerRay_=!1}updateTransform(){n.mat4.multiply(this.combinedTransform,this.modelTransformInverse,this.pose),this.setTransform(this.combinedTransform)}}t.XrInputDisplay=d},649805:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrLineMarkup=void 0;const s=i(114924),n=new s.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!1,isDepthTested:!0,priority:s.RenderOrderPriority.DEFAULT,primitiveType:s.PrimitiveType.LINES});class r extends s.UIElement{constructor(e,t,i){super(e);const r=(0,s.createLines)(t,null,i,2);this.updateMeshIncrement("LINES",s.NO_SELECTION_ID,r,n)}}t.XrLineMarkup=r},110575:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrMarkupController=void 0;const s=i(683067),n=i(114924),r=i(264292),a=[1,0,0,1];t.XrMarkupController=class{constructor(e,t){this.viewer=e,this.lineMarkup=[],this.inProgressLine=[],this.inProgressMarkup=null,t.addGamepadButtonHandler(this)}clearMarkup(){for(const e of this.lineMarkup)e.remove();this.lineMarkup=[]}onGamepadButtonDown(e){return this.isDrawMarkupButton(e)?(this.inProgressLine=[],this.updateLineMarkupWithCurrentPosition(e),this.viewer.getXrController().getDominantXrInputDisplay().hidePointerRay(),!0):this.isClearMarkupButton(e)}onGamepadButtonDrag(e){this.isDrawMarkupButton(e)&&this.updateLineMarkupWithCurrentPosition(e)}onGamepadButtonUp(e){this.isDrawMarkupButton(e)?(this.inProgressMarkup&&(this.lineMarkup.push(this.inProgressMarkup),this.inProgressMarkup=null,this.inProgressLine=[]),this.viewer.getXrController().getDominantXrInputDisplay().showPointerRay()):this.isClearMarkupButton(e)&&this.clearMarkup()}updateLineMarkupWithCurrentPosition(e){const t=e.xrInputEvent.modelSpaceRay.evaluate(n.XR_POINTER_TIP_Z_OFFSET);if(0===this.inProgressLine.length)return void this.inProgressLine.push(t);const i=this.inProgressLine[this.inProgressLine.length-1];r.vec3.dist(i,t)<1e-4||(1===this.inProgressLine.length||this.inProgressLine.push(i),this.inProgressLine.push(t),this.inProgressMarkup&&this.inProgressMarkup.remove(),this.inProgressMarkup=new n.XrLineMarkup(this.viewer,this.inProgressLine,a))}isDrawMarkupButton(e){return e.buttonNumber===s.XrButton.A&&e.handType===s.XRHandType.DOMINANT}isClearMarkupButton(e){return e.buttonNumber===s.XrButton.B&&e.handType===s.XRHandType.NON_DOMINANT}}},394082:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrSelectionHandler=void 0;const s=i(912057),n=i(484790);t.XrSelectionHandler=class{constructor(e){this.viewer=e,this.draggedUiElement=null}onXrSelectStart(e){this.draggedUiElement=null;const t=this.handleEvent(e,!0);return!(!t.handledUiSelection||!t.handledUiSelection.uiElement.triggerXrDragStart(t.handledUiSelection,e))&&(this.draggedUiElement=t.handledUiSelection,!0)}onXrSelectDrag(e){this.draggedUiElement&&this.draggedUiElement.uiElement.triggerXrDrag(this.draggedUiElement,e)}onXrSelect(e){this.draggedUiElement&&s.log.debug("Had dragged ui element during xr select event")}onXrSelectEnd(e){this.draggedUiElement&&(this.draggedUiElement.uiElement.triggerXrDragStop(this.draggedUiElement,e),this.draggedUiElement=null)}handleEvent(e,t){const i=this.viewer.pickWithXrInput(e),s={};s.click=!t;let r=!1;const a=this.viewer.getUISelectionManager(),o={handledUiSelection:null};for(let e=0;e<i.length&&!r;++e){const c=i[e],l=c.getModelSelection();if(l&&!this.viewer.getSuppressModelSelection())r=(0,n.processSelection)(l,t,true,s),r&&a.handleEmptyUiPick(t,s);else if(c.isUIPick()&&(r=a.processUiPick(c,{}),r&&!this.viewer.getSuppressModelSelection())){const e=c.getUISelection();e&&!e.getClearModelSelectionsOnPrehilite()||(0,n.handleEmptyPick)(t,!0),o.handledUiSelection=c.uiSelection}}return r||this.viewer.getSuppressModelSelection()||(0,n.handleEmptyPick)(t,!1),o}}},725584:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrTeleportPreview=void 0;const s=i(264292),n=i(114924),r=new n.NodeProperties({isVisible:!0,isPickable:!1,isTwoSided:!0,isShowThrough:!0,isDepthTested:!1,priority:n.RenderOrderPriority.DEFAULT,primitiveType:n.PrimitiveType.LINES}),a=[0,1,0,1],o=[0,0,1];class c extends n.UIElement{constructor(e){super(e);const t=(0,n.createCircle)([0,0,0],.5,o,128);(0,n.addColorToIncrement)(a,t),(0,n.addSizeToIncrement)(2,t),this.updateMeshIncrement("preview_circle",n.NO_SELECTION_ID,t,r)}updateLocation(e){const t=s.mat4.create();s.mat4.translate(t,t,e),this.setTransform(t)}}t.XrTeleportPreview=c},336937:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.getXrSystem=t.Y_UP_TO_OS=t.OS_TO_Y_UP=void 0;const s=i(264292);t.OS_TO_Y_UP=s.mat4.rotateX(s.mat4.create(),s.mat4.identity(s.mat4.create()),-Math.PI/2),t.Y_UP_TO_OS=s.mat4.invert(s.mat4.create(),t.OS_TO_Y_UP),t.getXrSystem=function(){return navigator.xr}},860409:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.XrViewController=void 0;const s=i(264292),n=i(912057),r=i(683067),a=i(114924);var o;!function(e){e[e.NONE=0]="NONE",e[e.FORWARD=1]="FORWARD",e[e.ROTATE_LEFT=2]="ROTATE_LEFT",e[e.ROTATE_RIGHT=3]="ROTATE_RIGHT"}(o||(o={}));t.XrViewController=class{constructor(e,t){this.viewer=e,this.initialModelTransform=null,this.initialWorldTransformInverse=null,this.activeTeleportMode=o.NONE,this.teleportPreview=null,this.modelCamera=new a.OrthographicCamera,t.addSqueezeHandler(this),t.addGamepadAxesHandler(this)}initializeModelView(e){const t=this.viewer.getCamera(),i=this.viewer.getModelViewManagers().getManager().getModelBounds();if(!i.isInitialized()||!i.isFinite())return void n.log.warn("Could not initialize xr view with bounds: "+i);const r=[e.getDirection()[0],0,e.getDirection()[2]];let o;s.vec3.normalize(r,r);const c=this.viewer.retrieveCanvasLocationWorldPosition([t.getCanvasWidth()/2,t.getCanvasHeight()/2]);if(c){const e=t.getPixelSizeAtWorldPoint(c),n=t.getCanvasHeight()*e,r=2;if(i.diameter()>n*r){const e=n/2/Math.tan((0,a.toRadians)(a.DEFAULT_PERSPECTIVE_FOV/2)),i=s.vec3.scaleAndAdd(s.vec3.create(),c,t.getForward(),-e);return void this.setModelTransform(this.getTransform(i,t.getForward()))}}if(!o){const t=.4+i.diameter()/5,n=s.vec3.add(s.vec3.create(),e.getEye(),s.vec3.scale(s.vec3.create(),r,t));n[1]-=i.diameter()/2,o=s.mat4.translate(s.mat4.create(),s.mat4.identity(s.mat4.create()),n)}this.setModelTransform(s.mat4.multiply(s.mat4.create(),o,a.OS_TO_Y_UP))}onXrSqueezeStart(e){return this.initialWorldTransformInverse=s.mat4.invert(s.mat4.create(),e.worldSpacePose),this.initialModelTransform=s.mat4.copy(s.mat4.create(),this.viewer.getXrController().modelTransform),!0}onXrSqueezeDrag(e){const t=s.mat4.multiply(s.mat4.create(),e.worldSpacePose,this.initialWorldTransformInverse);this.setModelTransform(s.mat4.multiply(s.mat4.create(),t,this.initialModelTransform))}onXrSqueeze(e){}onXrSqueezeEnd(e){this.initialWorldTransformInverse=null,this.initialModelTransform=null}onGamepadAxesUpdate(e){if(e.handType===r.XRHandType.NON_DOMINANT)return!1;const t=Math.abs(e.gamepad.axes[2])>=.5&&(this.activeTeleportMode===o.NONE||this.activeTeleportMode===o.ROTATE_LEFT||this.activeTeleportMode===o.ROTATE_RIGHT),i=e.gamepad.axes[3]<-.5&&(this.activeTeleportMode===o.NONE||this.activeTeleportMode===o.FORWARD);if(t)e.gamepad.axes[2]<0?(this.updateRotationTeleport(45),this.activeTeleportMode=o.ROTATE_LEFT):(this.updateRotationTeleport(-45),this.activeTeleportMode=o.ROTATE_RIGHT);else if(i)this.updateTeleportLocationAndPreview(e),this.activeTeleportMode=o.FORWARD;else{if(this.activeTeleportMode!==o.NONE){this.teleportPreview&&(this.teleportPreview.remove(),this.teleportPreview=null);const e=s.vec3.fromValues(this.xrTeleportLocation[0],this.xrTeleportLocation[1],this.xrTeleportLocation[2]);this.setModelTransform(this.getTransform(e,this.xrTeleportDirection))}this.activeTeleportMode=o.NONE}return this.activeTeleportMode!==o.NONE}updateRotationTeleport(e){const t=this.viewer.getXrController().getCamera().getViewMatrixInverse(),i=s.mat4.rotateY(s.mat4.create(),s.mat4.create(),(0,a.toRadians)(e));s.mat4.multiply(i,this.viewer.getXrController().lastXrViewMatrixInverse,i);const n=s.vec4.transformMat4(s.vec4.create(),[0,0,-1,0],i);this.xrTeleportDirection=s.vec4.transformMat4(s.vec4.create(),n,t),this.xrTeleportLocation=s.vec3.transformMat4(s.vec3.create(),[0,0,0],t)}updateTeleportLocationAndPreview(e){this.teleportPreview||(this.teleportPreview=new a.XrTeleportPreview(this.viewer));const t=this.viewer.getDepthForXrInput(e.xrInputEvent);t<0&&n.log.debug("Teleport depth distance was negative: "+t.toFixed(3)),this.teleportPreview.show();const i=e.xrInputEvent.modelSpaceRay.evaluate(t);this.xrTeleportLocation=s.vec3.copy(s.vec3.create(),i);this.xrTeleportLocation[2]+=1.7;const r=s.vec4.transformMat4(s.vec4.create(),[0,0,-1,0],this.viewer.getXrController().lastXrViewMatrixInverse);this.xrTeleportDirection=s.vec4.transformMat4(s.vec4.create(),r,this.viewer.getXrController().getCamera().getViewMatrixInverse()),this.teleportPreview.updateLocation(i)}setModelTransform(e){this.viewer.getXrController().modelTransform=e}getTransform(e,t){const i=s.vec3.fromValues(t[0],t[1],0);s.vec3.normalize(i,i);const n=s.vec3.fromValues(0,0,1);return this.modelCamera.setViewPositionAndOrientation(e,i,n),this.modelCamera.getViewMatrix()}}},87892:function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.inZoom=t.setZoomModeEnabled=t.getZoomModeEnabled=t.toggleZoomModifierEnabled=t.getZoomToWindowState=t.ZoomToWindowState=void 0;const s=i(322012);let n=null;class r{constructor(){this._zoomModifierEnabled=!1,this.zoomModeEnabledSubject=new s.BehaviorSubject(!1)}get zoomModeEnabledObservable(){return this.zoomModeEnabledSubject.asObservable().pipe((0,s.distinctUntilChanged)())}get zoomModeEnabled(){return this.zoomModeEnabledSubject.getValue()}set zoomModeEnabled(e){this.zoomModeEnabledSubject.next(e)}}function a(){return n||(n=new r),n}function o(){return a().zoomModeEnabled}t.ZoomToWindowState=r,t.getZoomToWindowState=a,t.toggleZoomModifierEnabled=function(){const e=a().zoomModeEnabled;a().zoomModeEnabled=!e},t.getZoomModeEnabled=o,t.setZoomModeEnabled=function(e){a().zoomModeEnabled=e},t.inZoom=function(){return o()}}}]);